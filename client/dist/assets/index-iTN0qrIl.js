var VF=Object.defineProperty;var WF=(t,s,r)=>s in t?VF(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var wv=(t,s,r)=>WF(t,typeof s!="symbol"?s+"":s,r);function GF(t,s){for(var r=0;r<s.length;r++){const a=s[r];if(typeof a!="string"&&!Array.isArray(a)){for(const n in a)if(n!=="default"&&!(n in t)){const i=Object.getOwnPropertyDescriptor(a,n);i&&Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:()=>a[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var _re=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jj(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var _v={exports:{}},SA={},Sv={exports:{}},Ar={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K1;function KF(){if(K1)return Ar;K1=1;var t=Symbol.for("react.element"),s=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),l=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),h=Symbol.iterator;function m(P){return P===null||typeof P!="object"?null:(P=h&&P[h]||P["@@iterator"],typeof P=="function"?P:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,x={};function b(P,C,k){this.props=P,this.context=C,this.refs=x,this.updater=k||p}b.prototype.isReactComponent={},b.prototype.setState=function(P,C){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,C,"setState")},b.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function y(){}y.prototype=b.prototype;function j(P,C,k){this.props=P,this.context=C,this.refs=x,this.updater=k||p}var N=j.prototype=new y;N.constructor=j,g(N,b.prototype),N.isPureReactComponent=!0;var _=Array.isArray,F=Object.prototype.hasOwnProperty,I={current:null},w={key:!0,ref:!0,__self:!0,__source:!0};function E(P,C,k){var B,G={},O=null,K=null;if(C!=null)for(B in C.ref!==void 0&&(K=C.ref),C.key!==void 0&&(O=""+C.key),C)F.call(C,B)&&!w.hasOwnProperty(B)&&(G[B]=C[B]);var J=arguments.length-2;if(J===1)G.children=k;else if(1<J){for(var te=Array(J),se=0;se<J;se++)te[se]=arguments[se+2];G.children=te}if(P&&P.defaultProps)for(B in J=P.defaultProps,J)G[B]===void 0&&(G[B]=J[B]);return{$$typeof:t,type:P,key:O,ref:K,props:G,_owner:I.current}}function W(P,C){return{$$typeof:t,type:P.type,key:C,ref:P.ref,props:P.props,_owner:P._owner}}function R(P){return typeof P=="object"&&P!==null&&P.$$typeof===t}function U(P){var C={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(k){return C[k]})}var T=/\/+/g;function Y(P,C){return typeof P=="object"&&P!==null&&P.key!=null?U(""+P.key):C.toString(36)}function H(P,C,k,B,G){var O=typeof P;(O==="undefined"||O==="boolean")&&(P=null);var K=!1;if(P===null)K=!0;else switch(O){case"string":case"number":K=!0;break;case"object":switch(P.$$typeof){case t:case s:K=!0}}if(K)return K=P,G=G(K),P=B===""?"."+Y(K,0):B,_(G)?(k="",P!=null&&(k=P.replace(T,"$&/")+"/"),H(G,C,k,"",function(se){return se})):G!=null&&(R(G)&&(G=W(G,k+(!G.key||K&&K.key===G.key?"":(""+G.key).replace(T,"$&/")+"/")+P)),C.push(G)),1;if(K=0,B=B===""?".":B+":",_(P))for(var J=0;J<P.length;J++){O=P[J];var te=B+Y(O,J);K+=H(O,C,k,te,G)}else if(te=m(P),typeof te=="function")for(P=te.call(P),J=0;!(O=P.next()).done;)O=O.value,te=B+Y(O,J++),K+=H(O,C,k,te,G);else if(O==="object")throw C=String(P),Error("Objects are not valid as a React child (found: "+(C==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":C)+"). If you meant to render a collection of children, use an array instead.");return K}function M(P,C,k){if(P==null)return P;var B=[],G=0;return H(P,B,"","",function(O){return C.call(k,O,G++)}),B}function q(P){if(P._status===-1){var C=P._result;C=C(),C.then(function(k){(P._status===0||P._status===-1)&&(P._status=1,P._result=k)},function(k){(P._status===0||P._status===-1)&&(P._status=2,P._result=k)}),P._status===-1&&(P._status=0,P._result=C)}if(P._status===1)return P._result.default;throw P._result}var z={current:null},Q={transition:null},L={ReactCurrentDispatcher:z,ReactCurrentBatchConfig:Q,ReactCurrentOwner:I};function V(){throw Error("act(...) is not supported in production builds of React.")}return Ar.Children={map:M,forEach:function(P,C,k){M(P,function(){C.apply(this,arguments)},k)},count:function(P){var C=0;return M(P,function(){C++}),C},toArray:function(P){return M(P,function(C){return C})||[]},only:function(P){if(!R(P))throw Error("React.Children.only expected to receive a single React element child.");return P}},Ar.Component=b,Ar.Fragment=r,Ar.Profiler=n,Ar.PureComponent=j,Ar.StrictMode=a,Ar.Suspense=d,Ar.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,Ar.act=V,Ar.cloneElement=function(P,C,k){if(P==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+P+".");var B=g({},P.props),G=P.key,O=P.ref,K=P._owner;if(C!=null){if(C.ref!==void 0&&(O=C.ref,K=I.current),C.key!==void 0&&(G=""+C.key),P.type&&P.type.defaultProps)var J=P.type.defaultProps;for(te in C)F.call(C,te)&&!w.hasOwnProperty(te)&&(B[te]=C[te]===void 0&&J!==void 0?J[te]:C[te])}var te=arguments.length-2;if(te===1)B.children=k;else if(1<te){J=Array(te);for(var se=0;se<te;se++)J[se]=arguments[se+2];B.children=J}return{$$typeof:t,type:P.type,key:G,ref:O,props:B,_owner:K}},Ar.createContext=function(P){return P={$$typeof:l,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},P.Provider={$$typeof:i,_context:P},P.Consumer=P},Ar.createElement=E,Ar.createFactory=function(P){var C=E.bind(null,P);return C.type=P,C},Ar.createRef=function(){return{current:null}},Ar.forwardRef=function(P){return{$$typeof:o,render:P}},Ar.isValidElement=R,Ar.lazy=function(P){return{$$typeof:c,_payload:{_status:-1,_result:P},_init:q}},Ar.memo=function(P,C){return{$$typeof:u,type:P,compare:C===void 0?null:C}},Ar.startTransition=function(P){var C=Q.transition;Q.transition={};try{P()}finally{Q.transition=C}},Ar.unstable_act=V,Ar.useCallback=function(P,C){return z.current.useCallback(P,C)},Ar.useContext=function(P){return z.current.useContext(P)},Ar.useDebugValue=function(){},Ar.useDeferredValue=function(P){return z.current.useDeferredValue(P)},Ar.useEffect=function(P,C){return z.current.useEffect(P,C)},Ar.useId=function(){return z.current.useId()},Ar.useImperativeHandle=function(P,C,k){return z.current.useImperativeHandle(P,C,k)},Ar.useInsertionEffect=function(P,C){return z.current.useInsertionEffect(P,C)},Ar.useLayoutEffect=function(P,C){return z.current.useLayoutEffect(P,C)},Ar.useMemo=function(P,C){return z.current.useMemo(P,C)},Ar.useReducer=function(P,C,k){return z.current.useReducer(P,C,k)},Ar.useRef=function(P){return z.current.useRef(P)},Ar.useState=function(P){return z.current.useState(P)},Ar.useSyncExternalStore=function(P,C,k){return z.current.useSyncExternalStore(P,C,k)},Ar.useTransition=function(){return z.current.useTransition()},Ar.version="18.3.1",Ar}var z1;function Yh(){return z1||(z1=1,Sv.exports=KF()),Sv.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y1;function zF(){if(Y1)return SA;Y1=1;var t=Yh(),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function l(o,d,u){var c,h={},m=null,p=null;u!==void 0&&(m=""+u),d.key!==void 0&&(m=""+d.key),d.ref!==void 0&&(p=d.ref);for(c in d)a.call(d,c)&&!i.hasOwnProperty(c)&&(h[c]=d[c]);if(o&&o.defaultProps)for(c in d=o.defaultProps,d)h[c]===void 0&&(h[c]=d[c]);return{$$typeof:s,type:o,key:m,ref:p,props:h,_owner:n.current}}return SA.Fragment=r,SA.jsx=l,SA.jsxs=l,SA}var X1;function YF(){return X1||(X1=1,_v.exports=zF()),_v.exports}var e=YF(),f=Yh();const Is=jj(f),XF=GF({__proto__:null,default:Is},[f]);var Vp={},Cv={exports:{}},nl={},kv={exports:{}},Ev={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var J1;function JF(){return J1||(J1=1,(function(t){function s(Q,L){var V=Q.length;Q.push(L);e:for(;0<V;){var P=V-1>>>1,C=Q[P];if(0<n(C,L))Q[P]=L,Q[V]=C,V=P;else break e}}function r(Q){return Q.length===0?null:Q[0]}function a(Q){if(Q.length===0)return null;var L=Q[0],V=Q.pop();if(V!==L){Q[0]=V;e:for(var P=0,C=Q.length,k=C>>>1;P<k;){var B=2*(P+1)-1,G=Q[B],O=B+1,K=Q[O];if(0>n(G,V))O<C&&0>n(K,G)?(Q[P]=K,Q[O]=V,P=O):(Q[P]=G,Q[B]=V,P=B);else if(O<C&&0>n(K,V))Q[P]=K,Q[O]=V,P=O;else break e}}return L}function n(Q,L){var V=Q.sortIndex-L.sortIndex;return V!==0?V:Q.id-L.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var l=Date,o=l.now();t.unstable_now=function(){return l.now()-o}}var d=[],u=[],c=1,h=null,m=3,p=!1,g=!1,x=!1,b=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function N(Q){for(var L=r(u);L!==null;){if(L.callback===null)a(u);else if(L.startTime<=Q)a(u),L.sortIndex=L.expirationTime,s(d,L);else break;L=r(u)}}function _(Q){if(x=!1,N(Q),!g)if(r(d)!==null)g=!0,q(F);else{var L=r(u);L!==null&&z(_,L.startTime-Q)}}function F(Q,L){g=!1,x&&(x=!1,y(E),E=-1),p=!0;var V=m;try{for(N(L),h=r(d);h!==null&&(!(h.expirationTime>L)||Q&&!U());){var P=h.callback;if(typeof P=="function"){h.callback=null,m=h.priorityLevel;var C=P(h.expirationTime<=L);L=t.unstable_now(),typeof C=="function"?h.callback=C:h===r(d)&&a(d),N(L)}else a(d);h=r(d)}if(h!==null)var k=!0;else{var B=r(u);B!==null&&z(_,B.startTime-L),k=!1}return k}finally{h=null,m=V,p=!1}}var I=!1,w=null,E=-1,W=5,R=-1;function U(){return!(t.unstable_now()-R<W)}function T(){if(w!==null){var Q=t.unstable_now();R=Q;var L=!0;try{L=w(!0,Q)}finally{L?Y():(I=!1,w=null)}}else I=!1}var Y;if(typeof j=="function")Y=function(){j(T)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,M=H.port2;H.port1.onmessage=T,Y=function(){M.postMessage(null)}}else Y=function(){b(T,0)};function q(Q){w=Q,I||(I=!0,Y())}function z(Q,L){E=b(function(){Q(t.unstable_now())},L)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Q){Q.callback=null},t.unstable_continueExecution=function(){g||p||(g=!0,q(F))},t.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):W=0<Q?Math.floor(1e3/Q):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_getFirstCallbackNode=function(){return r(d)},t.unstable_next=function(Q){switch(m){case 1:case 2:case 3:var L=3;break;default:L=m}var V=m;m=L;try{return Q()}finally{m=V}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Q,L){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var V=m;m=Q;try{return L()}finally{m=V}},t.unstable_scheduleCallback=function(Q,L,V){var P=t.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?P+V:P):V=P,Q){case 1:var C=-1;break;case 2:C=250;break;case 5:C=1073741823;break;case 4:C=1e4;break;default:C=5e3}return C=V+C,Q={id:c++,callback:L,priorityLevel:Q,startTime:V,expirationTime:C,sortIndex:-1},V>P?(Q.sortIndex=V,s(u,Q),r(d)===null&&Q===r(u)&&(x?(y(E),E=-1):x=!0,z(_,V-P))):(Q.sortIndex=C,s(d,Q),g||p||(g=!0,q(F))),Q},t.unstable_shouldYield=U,t.unstable_wrapCallback=function(Q){var L=m;return function(){var V=m;m=L;try{return Q.apply(this,arguments)}finally{m=V}}}})(Ev)),Ev}var Z1;function ZF(){return Z1||(Z1=1,kv.exports=JF()),kv.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ew;function e3(){if(ew)return nl;ew=1;var t=Yh(),s=ZF();function r(A){for(var v="https://reactjs.org/docs/error-decoder.html?invariant="+A,S=1;S<arguments.length;S++)v+="&args[]="+encodeURIComponent(arguments[S]);return"Minified React error #"+A+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,n={};function i(A,v){l(A,v),l(A+"Capture",v)}function l(A,v){for(n[A]=v,A=0;A<v.length;A++)a.add(v[A])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),d=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,c={},h={};function m(A){return d.call(h,A)?!0:d.call(c,A)?!1:u.test(A)?h[A]=!0:(c[A]=!0,!1)}function p(A,v,S,ee){if(S!==null&&S.type===0)return!1;switch(typeof v){case"function":case"symbol":return!0;case"boolean":return ee?!1:S!==null?!S.acceptsBooleans:(A=A.toLowerCase().slice(0,5),A!=="data-"&&A!=="aria-");default:return!1}}function g(A,v,S,ee){if(v===null||typeof v>"u"||p(A,v,S,ee))return!0;if(ee)return!1;if(S!==null)switch(S.type){case 3:return!v;case 4:return v===!1;case 5:return isNaN(v);case 6:return isNaN(v)||1>v}return!1}function x(A,v,S,ee,ce,pe,We){this.acceptsBooleans=v===2||v===3||v===4,this.attributeName=ee,this.attributeNamespace=ce,this.mustUseProperty=S,this.propertyName=A,this.type=v,this.sanitizeURL=pe,this.removeEmptyString=We}var b={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(A){b[A]=new x(A,0,!1,A,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(A){var v=A[0];b[v]=new x(v,1,!1,A[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(A){b[A]=new x(A,2,!1,A.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(A){b[A]=new x(A,2,!1,A,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(A){b[A]=new x(A,3,!1,A.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(A){b[A]=new x(A,3,!0,A,null,!1,!1)}),["capture","download"].forEach(function(A){b[A]=new x(A,4,!1,A,null,!1,!1)}),["cols","rows","size","span"].forEach(function(A){b[A]=new x(A,6,!1,A,null,!1,!1)}),["rowSpan","start"].forEach(function(A){b[A]=new x(A,5,!1,A.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function j(A){return A[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(A){var v=A.replace(y,j);b[v]=new x(v,1,!1,A,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(A){var v=A.replace(y,j);b[v]=new x(v,1,!1,A,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(A){var v=A.replace(y,j);b[v]=new x(v,1,!1,A,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(A){b[A]=new x(A,1,!1,A.toLowerCase(),null,!1,!1)}),b.xlinkHref=new x("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(A){b[A]=new x(A,1,!1,A.toLowerCase(),null,!0,!0)});function N(A,v,S,ee){var ce=b.hasOwnProperty(v)?b[v]:null;(ce!==null?ce.type!==0:ee||!(2<v.length)||v[0]!=="o"&&v[0]!=="O"||v[1]!=="n"&&v[1]!=="N")&&(g(v,S,ce,ee)&&(S=null),ee||ce===null?m(v)&&(S===null?A.removeAttribute(v):A.setAttribute(v,""+S)):ce.mustUseProperty?A[ce.propertyName]=S===null?ce.type===3?!1:"":S:(v=ce.attributeName,ee=ce.attributeNamespace,S===null?A.removeAttribute(v):(ce=ce.type,S=ce===3||ce===4&&S===!0?"":""+S,ee?A.setAttributeNS(ee,v,S):A.setAttribute(v,S))))}var _=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,F=Symbol.for("react.element"),I=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),W=Symbol.for("react.profiler"),R=Symbol.for("react.provider"),U=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),Y=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),z=Symbol.for("react.offscreen"),Q=Symbol.iterator;function L(A){return A===null||typeof A!="object"?null:(A=Q&&A[Q]||A["@@iterator"],typeof A=="function"?A:null)}var V=Object.assign,P;function C(A){if(P===void 0)try{throw Error()}catch(S){var v=S.stack.trim().match(/\n( *(at )?)/);P=v&&v[1]||""}return`
`+P+A}var k=!1;function B(A,v){if(!A||k)return"";k=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(v)if(v=function(){throw Error()},Object.defineProperty(v.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(v,[])}catch(Vt){var ee=Vt}Reflect.construct(A,[],v)}else{try{v.call()}catch(Vt){ee=Vt}A.call(v.prototype)}else{try{throw Error()}catch(Vt){ee=Vt}A()}}catch(Vt){if(Vt&&ee&&typeof Vt.stack=="string"){for(var ce=Vt.stack.split(`
`),pe=ee.stack.split(`
`),We=ce.length-1,pt=pe.length-1;1<=We&&0<=pt&&ce[We]!==pe[pt];)pt--;for(;1<=We&&0<=pt;We--,pt--)if(ce[We]!==pe[pt]){if(We!==1||pt!==1)do if(We--,pt--,0>pt||ce[We]!==pe[pt]){var _t=`
`+ce[We].replace(" at new "," at ");return A.displayName&&_t.includes("<anonymous>")&&(_t=_t.replace("<anonymous>",A.displayName)),_t}while(1<=We&&0<=pt);break}}}finally{k=!1,Error.prepareStackTrace=S}return(A=A?A.displayName||A.name:"")?C(A):""}function G(A){switch(A.tag){case 5:return C(A.type);case 16:return C("Lazy");case 13:return C("Suspense");case 19:return C("SuspenseList");case 0:case 2:case 15:return A=B(A.type,!1),A;case 11:return A=B(A.type.render,!1),A;case 1:return A=B(A.type,!0),A;default:return""}}function O(A){if(A==null)return null;if(typeof A=="function")return A.displayName||A.name||null;if(typeof A=="string")return A;switch(A){case w:return"Fragment";case I:return"Portal";case W:return"Profiler";case E:return"StrictMode";case Y:return"Suspense";case H:return"SuspenseList"}if(typeof A=="object")switch(A.$$typeof){case U:return(A.displayName||"Context")+".Consumer";case R:return(A._context.displayName||"Context")+".Provider";case T:var v=A.render;return A=A.displayName,A||(A=v.displayName||v.name||"",A=A!==""?"ForwardRef("+A+")":"ForwardRef"),A;case M:return v=A.displayName||null,v!==null?v:O(A.type)||"Memo";case q:v=A._payload,A=A._init;try{return O(A(v))}catch{}}return null}function K(A){var v=A.type;switch(A.tag){case 24:return"Cache";case 9:return(v.displayName||"Context")+".Consumer";case 10:return(v._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return A=v.render,A=A.displayName||A.name||"",v.displayName||(A!==""?"ForwardRef("+A+")":"ForwardRef");case 7:return"Fragment";case 5:return v;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return O(v);case 8:return v===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof v=="function")return v.displayName||v.name||null;if(typeof v=="string")return v}return null}function J(A){switch(typeof A){case"boolean":case"number":case"string":case"undefined":return A;case"object":return A;default:return""}}function te(A){var v=A.type;return(A=A.nodeName)&&A.toLowerCase()==="input"&&(v==="checkbox"||v==="radio")}function se(A){var v=te(A)?"checked":"value",S=Object.getOwnPropertyDescriptor(A.constructor.prototype,v),ee=""+A[v];if(!A.hasOwnProperty(v)&&typeof S<"u"&&typeof S.get=="function"&&typeof S.set=="function"){var ce=S.get,pe=S.set;return Object.defineProperty(A,v,{configurable:!0,get:function(){return ce.call(this)},set:function(We){ee=""+We,pe.call(this,We)}}),Object.defineProperty(A,v,{enumerable:S.enumerable}),{getValue:function(){return ee},setValue:function(We){ee=""+We},stopTracking:function(){A._valueTracker=null,delete A[v]}}}}function ae(A){A._valueTracker||(A._valueTracker=se(A))}function ne(A){if(!A)return!1;var v=A._valueTracker;if(!v)return!0;var S=v.getValue(),ee="";return A&&(ee=te(A)?A.checked?"true":"false":A.value),A=ee,A!==S?(v.setValue(A),!0):!1}function ue(A){if(A=A||(typeof document<"u"?document:void 0),typeof A>"u")return null;try{return A.activeElement||A.body}catch{return A.body}}function oe(A,v){var S=v.checked;return V({},v,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:S??A._wrapperState.initialChecked})}function le(A,v){var S=v.defaultValue==null?"":v.defaultValue,ee=v.checked!=null?v.checked:v.defaultChecked;S=J(v.value!=null?v.value:S),A._wrapperState={initialChecked:ee,initialValue:S,controlled:v.type==="checkbox"||v.type==="radio"?v.checked!=null:v.value!=null}}function X(A,v){v=v.checked,v!=null&&N(A,"checked",v,!1)}function me(A,v){X(A,v);var S=J(v.value),ee=v.type;if(S!=null)ee==="number"?(S===0&&A.value===""||A.value!=S)&&(A.value=""+S):A.value!==""+S&&(A.value=""+S);else if(ee==="submit"||ee==="reset"){A.removeAttribute("value");return}v.hasOwnProperty("value")?Ie(A,v.type,S):v.hasOwnProperty("defaultValue")&&Ie(A,v.type,J(v.defaultValue)),v.checked==null&&v.defaultChecked!=null&&(A.defaultChecked=!!v.defaultChecked)}function we(A,v,S){if(v.hasOwnProperty("value")||v.hasOwnProperty("defaultValue")){var ee=v.type;if(!(ee!=="submit"&&ee!=="reset"||v.value!==void 0&&v.value!==null))return;v=""+A._wrapperState.initialValue,S||v===A.value||(A.value=v),A.defaultValue=v}S=A.name,S!==""&&(A.name=""),A.defaultChecked=!!A._wrapperState.initialChecked,S!==""&&(A.name=S)}function Ie(A,v,S){(v!=="number"||ue(A.ownerDocument)!==A)&&(S==null?A.defaultValue=""+A._wrapperState.initialValue:A.defaultValue!==""+S&&(A.defaultValue=""+S))}var _e=Array.isArray;function Fe(A,v,S,ee){if(A=A.options,v){v={};for(var ce=0;ce<S.length;ce++)v["$"+S[ce]]=!0;for(S=0;S<A.length;S++)ce=v.hasOwnProperty("$"+A[S].value),A[S].selected!==ce&&(A[S].selected=ce),ce&&ee&&(A[S].defaultSelected=!0)}else{for(S=""+J(S),v=null,ce=0;ce<A.length;ce++){if(A[ce].value===S){A[ce].selected=!0,ee&&(A[ce].defaultSelected=!0);return}v!==null||A[ce].disabled||(v=A[ce])}v!==null&&(v.selected=!0)}}function Le(A,v){if(v.dangerouslySetInnerHTML!=null)throw Error(r(91));return V({},v,{value:void 0,defaultValue:void 0,children:""+A._wrapperState.initialValue})}function rt(A,v){var S=v.value;if(S==null){if(S=v.children,v=v.defaultValue,S!=null){if(v!=null)throw Error(r(92));if(_e(S)){if(1<S.length)throw Error(r(93));S=S[0]}v=S}v==null&&(v=""),S=v}A._wrapperState={initialValue:J(S)}}function He(A,v){var S=J(v.value),ee=J(v.defaultValue);S!=null&&(S=""+S,S!==A.value&&(A.value=S),v.defaultValue==null&&A.defaultValue!==S&&(A.defaultValue=S)),ee!=null&&(A.defaultValue=""+ee)}function st(A){var v=A.textContent;v===A._wrapperState.initialValue&&v!==""&&v!==null&&(A.value=v)}function De(A){switch(A){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Te(A,v){return A==null||A==="http://www.w3.org/1999/xhtml"?De(v):A==="http://www.w3.org/2000/svg"&&v==="foreignObject"?"http://www.w3.org/1999/xhtml":A}var Ce,Pe=(function(A){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(v,S,ee,ce){MSApp.execUnsafeLocalFunction(function(){return A(v,S,ee,ce)})}:A})(function(A,v){if(A.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in A)A.innerHTML=v;else{for(Ce=Ce||document.createElement("div"),Ce.innerHTML="<svg>"+v.valueOf().toString()+"</svg>",v=Ce.firstChild;A.firstChild;)A.removeChild(A.firstChild);for(;v.firstChild;)A.appendChild(v.firstChild)}});function fe(A,v){if(v){var S=A.firstChild;if(S&&S===A.lastChild&&S.nodeType===3){S.nodeValue=v;return}}A.textContent=v}var he={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ue=["Webkit","ms","Moz","O"];Object.keys(he).forEach(function(A){Ue.forEach(function(v){v=v+A.charAt(0).toUpperCase()+A.substring(1),he[v]=he[A]})});function Ye(A,v,S){return v==null||typeof v=="boolean"||v===""?"":S||typeof v!="number"||v===0||he.hasOwnProperty(A)&&he[A]?(""+v).trim():v+"px"}function Ke(A,v){A=A.style;for(var S in v)if(v.hasOwnProperty(S)){var ee=S.indexOf("--")===0,ce=Ye(S,v[S],ee);S==="float"&&(S="cssFloat"),ee?A.setProperty(S,ce):A[S]=ce}}var Je=V({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function xe(A,v){if(v){if(Je[A]&&(v.children!=null||v.dangerouslySetInnerHTML!=null))throw Error(r(137,A));if(v.dangerouslySetInnerHTML!=null){if(v.children!=null)throw Error(r(60));if(typeof v.dangerouslySetInnerHTML!="object"||!("__html"in v.dangerouslySetInnerHTML))throw Error(r(61))}if(v.style!=null&&typeof v.style!="object")throw Error(r(62))}}function ye(A,v){if(A.indexOf("-")===-1)return typeof v.is=="string";switch(A){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ae=null;function be(A){return A=A.target||A.srcElement||window,A.correspondingUseElement&&(A=A.correspondingUseElement),A.nodeType===3?A.parentNode:A}var Ee=null,dt=null,mt=null;function it(A){if(A=Qd(A)){if(typeof Ee!="function")throw Error(r(280));var v=A.stateNode;v&&(v=Ku(v),Ee(A.stateNode,A.type,v))}}function ht(A){dt?mt?mt.push(A):mt=[A]:dt=A}function ft(){if(dt){var A=dt,v=mt;if(mt=dt=null,it(A),v)for(A=0;A<v.length;A++)it(v[A])}}function Rt(A,v){return A(v)}function Ge(){}var at=!1;function je(A,v,S){if(at)return A(v,S);at=!0;try{return Rt(A,v,S)}finally{at=!1,(dt!==null||mt!==null)&&(Ge(),ft())}}function Se(A,v){var S=A.stateNode;if(S===null)return null;var ee=Ku(S);if(ee===null)return null;S=ee[v];e:switch(v){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(ee=!ee.disabled)||(A=A.type,ee=!(A==="button"||A==="input"||A==="select"||A==="textarea")),A=!ee;break e;default:A=!1}if(A)return null;if(S&&typeof S!="function")throw Error(r(231,v,typeof S));return S}var nt=!1;if(o)try{var Ze={};Object.defineProperty(Ze,"passive",{get:function(){nt=!0}}),window.addEventListener("test",Ze,Ze),window.removeEventListener("test",Ze,Ze)}catch{nt=!1}function gt(A,v,S,ee,ce,pe,We,pt,_t){var Vt=Array.prototype.slice.call(arguments,3);try{v.apply(S,Vt)}catch(us){this.onError(us)}}var jt=!1,Mt=null,Ne=!1,ke=null,qe={onError:function(A){jt=!0,Mt=A}};function ge(A,v,S,ee,ce,pe,We,pt,_t){jt=!1,Mt=null,gt.apply(qe,arguments)}function Me(A,v,S,ee,ce,pe,We,pt,_t){if(ge.apply(this,arguments),jt){if(jt){var Vt=Mt;jt=!1,Mt=null}else throw Error(r(198));Ne||(Ne=!0,ke=Vt)}}function Ve(A){var v=A,S=A;if(A.alternate)for(;v.return;)v=v.return;else{A=v;do v=A,(v.flags&4098)!==0&&(S=v.return),A=v.return;while(A)}return v.tag===3?S:null}function vt(A){if(A.tag===13){var v=A.memoizedState;if(v===null&&(A=A.alternate,A!==null&&(v=A.memoizedState)),v!==null)return v.dehydrated}return null}function St(A){if(Ve(A)!==A)throw Error(r(188))}function xt(A){var v=A.alternate;if(!v){if(v=Ve(A),v===null)throw Error(r(188));return v!==A?null:A}for(var S=A,ee=v;;){var ce=S.return;if(ce===null)break;var pe=ce.alternate;if(pe===null){if(ee=ce.return,ee!==null){S=ee;continue}break}if(ce.child===pe.child){for(pe=ce.child;pe;){if(pe===S)return St(ce),A;if(pe===ee)return St(ce),v;pe=pe.sibling}throw Error(r(188))}if(S.return!==ee.return)S=ce,ee=pe;else{for(var We=!1,pt=ce.child;pt;){if(pt===S){We=!0,S=ce,ee=pe;break}if(pt===ee){We=!0,ee=ce,S=pe;break}pt=pt.sibling}if(!We){for(pt=pe.child;pt;){if(pt===S){We=!0,S=pe,ee=ce;break}if(pt===ee){We=!0,ee=pe,S=ce;break}pt=pt.sibling}if(!We)throw Error(r(189))}}if(S.alternate!==ee)throw Error(r(190))}if(S.tag!==3)throw Error(r(188));return S.stateNode.current===S?A:v}function Ct(A){return A=xt(A),A!==null?Tt(A):null}function Tt(A){if(A.tag===5||A.tag===6)return A;for(A=A.child;A!==null;){var v=Tt(A);if(v!==null)return v;A=A.sibling}return null}var bt=s.unstable_scheduleCallback,Jt=s.unstable_cancelCallback,Gt=s.unstable_shouldYield,Ht=s.unstable_requestPaint,es=s.unstable_now,js=s.unstable_getCurrentPriorityLevel,Zs=s.unstable_ImmediatePriority,Xs=s.unstable_UserBlockingPriority,Hs=s.unstable_NormalPriority,Bs=s.unstable_LowPriority,Ln=s.unstable_IdlePriority,br=null,mr=null;function Ja(A){if(mr&&typeof mr.onCommitFiberRoot=="function")try{mr.onCommitFiberRoot(br,A,void 0,(A.current.flags&128)===128)}catch{}}var Tr=Math.clz32?Math.clz32:Za,ta=Math.log,fl=Math.LN2;function Za(A){return A>>>=0,A===0?32:31-(ta(A)/fl|0)|0}var Sa=64,Ci=4194304;function Vi(A){switch(A&-A){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return A&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return A&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return A}}function va(A,v){var S=A.pendingLanes;if(S===0)return 0;var ee=0,ce=A.suspendedLanes,pe=A.pingedLanes,We=S&268435455;if(We!==0){var pt=We&~ce;pt!==0?ee=Vi(pt):(pe&=We,pe!==0&&(ee=Vi(pe)))}else We=S&~ce,We!==0?ee=Vi(We):pe!==0&&(ee=Vi(pe));if(ee===0)return 0;if(v!==0&&v!==ee&&(v&ce)===0&&(ce=ee&-ee,pe=v&-v,ce>=pe||ce===16&&(pe&4194240)!==0))return v;if((ee&4)!==0&&(ee|=S&16),v=A.entangledLanes,v!==0)for(A=A.entanglements,v&=ee;0<v;)S=31-Tr(v),ce=1<<S,ee|=A[S],v&=~ce;return ee}function en(A,v){switch(A){case 1:case 2:case 4:return v+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Pa(A,v){for(var S=A.suspendedLanes,ee=A.pingedLanes,ce=A.expirationTimes,pe=A.pendingLanes;0<pe;){var We=31-Tr(pe),pt=1<<We,_t=ce[We];_t===-1?((pt&S)===0||(pt&ee)!==0)&&(ce[We]=en(pt,v)):_t<=v&&(A.expiredLanes|=pt),pe&=~pt}}function co(A){return A=A.pendingLanes&-1073741825,A!==0?A:A&1073741824?1073741824:0}function Jo(){var A=Sa;return Sa<<=1,(Sa&4194240)===0&&(Sa=64),A}function Il(A){for(var v=[],S=0;31>S;S++)v.push(A);return v}function xn(A,v,S){A.pendingLanes|=v,v!==536870912&&(A.suspendedLanes=0,A.pingedLanes=0),A=A.eventTimes,v=31-Tr(v),A[v]=S}function Pc(A,v){var S=A.pendingLanes&~v;A.pendingLanes=v,A.suspendedLanes=0,A.pingedLanes=0,A.expiredLanes&=v,A.mutableReadLanes&=v,A.entangledLanes&=v,v=A.entanglements;var ee=A.eventTimes;for(A=A.expirationTimes;0<S;){var ce=31-Tr(S),pe=1<<ce;v[ce]=0,ee[ce]=-1,A[ce]=-1,S&=~pe}}function uo(A,v){var S=A.entangledLanes|=v;for(A=A.entanglements;S;){var ee=31-Tr(S),ce=1<<ee;ce&v|A[ee]&v&&(A[ee]|=v),S&=~ce}}var hr=0;function Ll(A){return A&=-A,1<A?4<A?(A&268435455)!==0?16:536870912:4:1}var Zo,ec,Uc,ki,mo,Dl=!1,Wi=[],Ir=null,Yn=null,Xn=null,Os=new Map,ho=new Map,Gi=[],Ki="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ua(A,v){switch(A){case"focusin":case"focusout":Ir=null;break;case"dragenter":case"dragleave":Yn=null;break;case"mouseover":case"mouseout":Xn=null;break;case"pointerover":case"pointerout":Os.delete(v.pointerId);break;case"gotpointercapture":case"lostpointercapture":ho.delete(v.pointerId)}}function Jn(A,v,S,ee,ce,pe){return A===null||A.nativeEvent!==pe?(A={blockedOn:v,domEventName:S,eventSystemFlags:ee,nativeEvent:pe,targetContainers:[ce]},v!==null&&(v=Qd(v),v!==null&&ec(v)),A):(A.eventSystemFlags|=ee,v=A.targetContainers,ce!==null&&v.indexOf(ce)===-1&&v.push(ce),A)}function Ao(A,v,S,ee,ce){switch(v){case"focusin":return Ir=Jn(Ir,A,v,S,ee,ce),!0;case"dragenter":return Yn=Jn(Yn,A,v,S,ee,ce),!0;case"mouseover":return Xn=Jn(Xn,A,v,S,ee,ce),!0;case"pointerover":var pe=ce.pointerId;return Os.set(pe,Jn(Os.get(pe)||null,A,v,S,ee,ce)),!0;case"gotpointercapture":return pe=ce.pointerId,ho.set(pe,Jn(ho.get(pe)||null,A,v,S,ee,ce)),!0}return!1}function fo(A){var v=cc(A.target);if(v!==null){var S=Ve(v);if(S!==null){if(v=S.tag,v===13){if(v=vt(S),v!==null){A.blockedOn=v,mo(A.priority,function(){Uc(S)});return}}else if(v===3&&S.stateNode.current.memoizedState.isDehydrated){A.blockedOn=S.tag===3?S.stateNode.containerInfo:null;return}}}A.blockedOn=null}function tc(A){if(A.blockedOn!==null)return!1;for(var v=A.targetContainers;0<v.length;){var S=It(A.domEventName,A.eventSystemFlags,v[0],A.nativeEvent);if(S===null){S=A.nativeEvent;var ee=new S.constructor(S.type,S);Ae=ee,S.target.dispatchEvent(ee),Ae=null}else return v=Qd(S),v!==null&&ec(v),A.blockedOn=S,!1;v.shift()}return!0}function sc(A,v,S){tc(A)&&S.delete(v)}function Pu(){Dl=!1,Ir!==null&&tc(Ir)&&(Ir=null),Yn!==null&&tc(Yn)&&(Yn=null),Xn!==null&&tc(Xn)&&(Xn=null),Os.forEach(sc),ho.forEach(sc)}function Ra(A,v){A.blockedOn===v&&(A.blockedOn=null,Dl||(Dl=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,Pu)))}function Dn(A){function v(ce){return Ra(ce,A)}if(0<Wi.length){Ra(Wi[0],A);for(var S=1;S<Wi.length;S++){var ee=Wi[S];ee.blockedOn===A&&(ee.blockedOn=null)}}for(Ir!==null&&Ra(Ir,A),Yn!==null&&Ra(Yn,A),Xn!==null&&Ra(Xn,A),Os.forEach(v),ho.forEach(v),S=0;S<Gi.length;S++)ee=Gi[S],ee.blockedOn===A&&(ee.blockedOn=null);for(;0<Gi.length&&(S=Gi[0],S.blockedOn===null);)fo(S),S.blockedOn===null&&Gi.shift()}var gn=_.ReactCurrentBatchConfig,po=!0;function Be(A,v,S,ee){var ce=hr,pe=gn.transition;gn.transition=null;try{hr=1,ut(A,v,S,ee)}finally{hr=ce,gn.transition=pe}}function lt(A,v,S,ee){var ce=hr,pe=gn.transition;gn.transition=null;try{hr=4,ut(A,v,S,ee)}finally{hr=ce,gn.transition=pe}}function ut(A,v,S,ee){if(po){var ce=It(A,v,S,ee);if(ce===null)Vu(A,v,ee,yt,S),Ua(A,ee);else if(Ao(ce,A,v,S,ee))ee.stopPropagation();else if(Ua(A,ee),v&4&&-1<Ki.indexOf(A)){for(;ce!==null;){var pe=Qd(ce);if(pe!==null&&Zo(pe),pe=It(A,v,S,ee),pe===null&&Vu(A,v,ee,yt,S),pe===ce)break;ce=pe}ce!==null&&ee.stopPropagation()}else Vu(A,v,ee,null,S)}}var yt=null;function It(A,v,S,ee){if(yt=null,A=be(ee),A=cc(A),A!==null)if(v=Ve(A),v===null)A=null;else if(S=v.tag,S===13){if(A=vt(v),A!==null)return A;A=null}else if(S===3){if(v.stateNode.current.memoizedState.isDehydrated)return v.tag===3?v.stateNode.containerInfo:null;A=null}else v!==A&&(A=null);return yt=A,null}function Lt(A){switch(A){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(js()){case Zs:return 1;case Xs:return 4;case Hs:case Bs:return 16;case Ln:return 536870912;default:return 16}default:return 16}}var qt=null,ss=null,$t=null;function ms(){if($t)return $t;var A,v=ss,S=v.length,ee,ce="value"in qt?qt.value:qt.textContent,pe=ce.length;for(A=0;A<S&&v[A]===ce[A];A++);var We=S-A;for(ee=1;ee<=We&&v[S-ee]===ce[pe-ee];ee++);return $t=ce.slice(A,1<ee?1-ee:void 0)}function Ns(A){var v=A.keyCode;return"charCode"in A?(A=A.charCode,A===0&&v===13&&(A=13)):A=v,A===10&&(A=13),32<=A||A===13?A:0}function rs(){return!0}function ns(){return!1}function os(A){function v(S,ee,ce,pe,We){this._reactName=S,this._targetInst=ce,this.type=ee,this.nativeEvent=pe,this.target=We,this.currentTarget=null;for(var pt in A)A.hasOwnProperty(pt)&&(S=A[pt],this[pt]=S?S(pe):pe[pt]);return this.isDefaultPrevented=(pe.defaultPrevented!=null?pe.defaultPrevented:pe.returnValue===!1)?rs:ns,this.isPropagationStopped=ns,this}return V(v.prototype,{preventDefault:function(){this.defaultPrevented=!0;var S=this.nativeEvent;S&&(S.preventDefault?S.preventDefault():typeof S.returnValue!="unknown"&&(S.returnValue=!1),this.isDefaultPrevented=rs)},stopPropagation:function(){var S=this.nativeEvent;S&&(S.stopPropagation?S.stopPropagation():typeof S.cancelBubble!="unknown"&&(S.cancelBubble=!0),this.isPropagationStopped=rs)},persist:function(){},isPersistent:rs}),v}var fs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(A){return A.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},or=os(fs),cn=V({},fs,{view:0,detail:0}),aa=os(cn),pr,na,tr,ba=V({},cn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ws,button:0,buttons:0,relatedTarget:function(A){return A.relatedTarget===void 0?A.fromElement===A.srcElement?A.toElement:A.fromElement:A.relatedTarget},movementX:function(A){return"movementX"in A?A.movementX:(A!==tr&&(tr&&A.type==="mousemove"?(pr=A.screenX-tr.screenX,na=A.screenY-tr.screenY):na=pr=0,tr=A),pr)},movementY:function(A){return"movementY"in A?A.movementY:na}}),Zn=os(ba),Pl=V({},ba,{dataTransfer:0}),rr=os(Pl),zr=V({},cn,{relatedTarget:0}),ei=os(zr),Rc=V({},fs,{animationName:0,elapsedTime:0,pseudoElement:0}),rc=os(Rc),Uu=V({},fs,{clipboardData:function(A){return"clipboardData"in A?A.clipboardData:window.clipboardData}}),ie=os(Uu),Qe=V({},fs,{data:0}),At=os(Qe),Nt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Dt={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zt={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function cs(A){var v=this.nativeEvent;return v.getModifierState?v.getModifierState(A):(A=zt[A])?!!v[A]:!1}function ws(){return cs}var Rs=V({},cn,{key:function(A){if(A.key){var v=Nt[A.key]||A.key;if(v!=="Unidentified")return v}return A.type==="keypress"?(A=Ns(A),A===13?"Enter":String.fromCharCode(A)):A.type==="keydown"||A.type==="keyup"?Dt[A.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ws,charCode:function(A){return A.type==="keypress"?Ns(A):0},keyCode:function(A){return A.type==="keydown"||A.type==="keyup"?A.keyCode:0},which:function(A){return A.type==="keypress"?Ns(A):A.type==="keydown"||A.type==="keyup"?A.keyCode:0}}),sr=os(Rs),er=V({},ba,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),xr=os(er),ia=V({},cn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ws}),fa=os(ia),Ca=V({},fs,{propertyName:0,elapsedTime:0,pseudoElement:0}),vn=os(Ca),tn=V({},ba,{deltaX:function(A){return"deltaX"in A?A.deltaX:"wheelDeltaX"in A?-A.wheelDeltaX:0},deltaY:function(A){return"deltaY"in A?A.deltaY:"wheelDeltaY"in A?-A.wheelDeltaY:"wheelDelta"in A?-A.wheelDelta:0},deltaZ:0,deltaMode:0}),pl=os(tn),Ei=[9,13,27,32],zi=o&&"CompositionEvent"in window,ac=null;o&&"documentMode"in document&&(ac=document.documentMode);var Ru=o&&"TextEvent"in window&&!ac,Sd=o&&(!zi||ac&&8<ac&&11>=ac),Oc=" ",Cd=!1;function kd(A,v){switch(A){case"keyup":return Ei.indexOf(v.keyCode)!==-1;case"keydown":return v.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mc(A){return A=A.detail,typeof A=="object"&&"data"in A?A.data:null}var pa=!1;function Ed(A,v){switch(A){case"compositionend":return Mc(v);case"keypress":return v.which!==32?null:(Cd=!0,Oc);case"textInput":return A=v.data,A===Oc&&Cd?null:A;default:return null}}function Bd(A,v){if(pa)return A==="compositionend"||!zi&&kd(A,v)?(A=ms(),$t=ss=qt=null,pa=!1,A):null;switch(A){case"paste":return null;case"keypress":if(!(v.ctrlKey||v.altKey||v.metaKey)||v.ctrlKey&&v.altKey){if(v.char&&1<v.char.length)return v.char;if(v.which)return String.fromCharCode(v.which)}return null;case"compositionend":return Sd&&v.locale!=="ko"?null:v.data;default:return null}}var Fd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Td(A){var v=A&&A.nodeName&&A.nodeName.toLowerCase();return v==="input"?!!Fd[A.type]:v==="textarea"}function Pn(A,v,S,ee){ht(ee),v=$m(v,"onChange"),0<v.length&&(S=new or("onChange","change",null,S,ee),A.push({event:S,listeners:v}))}var Qc=null,xo=null;function Qm(A){qu(A,0)}function Un(A){var v=Yc(A);if(ne(v))return A}function Id(A,v){if(A==="change")return v}var Ou=!1;if(o){var Ld;if(o){var Ul="oninput"in document;if(!Ul){var nc=document.createElement("div");nc.setAttribute("oninput","return;"),Ul=typeof nc.oninput=="function"}Ld=Ul}else Ld=!1;Ou=Ld&&(!document.documentMode||9<document.documentMode)}function Rn(){Qc&&(Qc.detachEvent("onpropertychange",bn),xo=Qc=null)}function bn(A){if(A.propertyName==="value"&&Un(xo)){var v=[];Pn(v,xo,A,be(A)),je(Qm,v)}}function ic(A,v,S){A==="focusin"?(Rn(),Qc=v,xo=S,Qc.attachEvent("onpropertychange",bn)):A==="focusout"&&Rn()}function go(A){if(A==="selectionchange"||A==="keyup"||A==="keydown")return Un(xo)}function vo(A,v){if(A==="click")return Un(v)}function Dd(A,v){if(A==="input"||A==="change")return Un(v)}function bo(A,v){return A===v&&(A!==0||1/A===1/v)||A!==A&&v!==v}var wr=typeof Object.is=="function"?Object.is:bo;function yo(A,v){if(wr(A,v))return!0;if(typeof A!="object"||A===null||typeof v!="object"||v===null)return!1;var S=Object.keys(A),ee=Object.keys(v);if(S.length!==ee.length)return!1;for(ee=0;ee<S.length;ee++){var ce=S[ee];if(!d.call(v,ce)||!wr(A[ce],v[ce]))return!1}return!0}function yn(A){for(;A&&A.firstChild;)A=A.firstChild;return A}function Bi(A,v){var S=yn(A);A=0;for(var ee;S;){if(S.nodeType===3){if(ee=A+S.textContent.length,A<=v&&ee>=v)return{node:S,offset:v-A};A=ee}e:{for(;S;){if(S.nextSibling){S=S.nextSibling;break e}S=S.parentNode}S=void 0}S=yn(S)}}function Hc(A,v){return A&&v?A===v?!0:A&&A.nodeType===3?!1:v&&v.nodeType===3?Hc(A,v.parentNode):"contains"in A?A.contains(v):A.compareDocumentPosition?!!(A.compareDocumentPosition(v)&16):!1:!1}function Mu(){for(var A=window,v=ue();v instanceof A.HTMLIFrameElement;){try{var S=typeof v.contentWindow.location.href=="string"}catch{S=!1}if(S)A=v.contentWindow;else break;v=ue(A.document)}return v}function qc(A){var v=A&&A.nodeName&&A.nodeName.toLowerCase();return v&&(v==="input"&&(A.type==="text"||A.type==="search"||A.type==="tel"||A.type==="url"||A.type==="password")||v==="textarea"||A.contentEditable==="true")}function $c(A){var v=Mu(),S=A.focusedElem,ee=A.selectionRange;if(v!==S&&S&&S.ownerDocument&&Hc(S.ownerDocument.documentElement,S)){if(ee!==null&&qc(S)){if(v=ee.start,A=ee.end,A===void 0&&(A=v),"selectionStart"in S)S.selectionStart=v,S.selectionEnd=Math.min(A,S.value.length);else if(A=(v=S.ownerDocument||document)&&v.defaultView||window,A.getSelection){A=A.getSelection();var ce=S.textContent.length,pe=Math.min(ee.start,ce);ee=ee.end===void 0?pe:Math.min(ee.end,ce),!A.extend&&pe>ee&&(ce=ee,ee=pe,pe=ce),ce=Bi(S,pe);var We=Bi(S,ee);ce&&We&&(A.rangeCount!==1||A.anchorNode!==ce.node||A.anchorOffset!==ce.offset||A.focusNode!==We.node||A.focusOffset!==We.offset)&&(v=v.createRange(),v.setStart(ce.node,ce.offset),A.removeAllRanges(),pe>ee?(A.addRange(v),A.extend(We.node,We.offset)):(v.setEnd(We.node,We.offset),A.addRange(v)))}}for(v=[],A=S;A=A.parentNode;)A.nodeType===1&&v.push({element:A,left:A.scrollLeft,top:A.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<v.length;S++)A=v[S],A.element.scrollLeft=A.left,A.element.scrollTop=A.top}}var Vc=o&&"documentMode"in document&&11>=document.documentMode,Fi=null,jo=null,Rl=null,No=!1;function wo(A,v,S){var ee=S.window===S?S.document:S.nodeType===9?S:S.ownerDocument;No||Fi==null||Fi!==ue(ee)||(ee=Fi,"selectionStart"in ee&&qc(ee)?ee={start:ee.selectionStart,end:ee.selectionEnd}:(ee=(ee.ownerDocument&&ee.ownerDocument.defaultView||window).getSelection(),ee={anchorNode:ee.anchorNode,anchorOffset:ee.anchorOffset,focusNode:ee.focusNode,focusOffset:ee.focusOffset}),Rl&&yo(Rl,ee)||(Rl=ee,ee=$m(jo,"onSelect"),0<ee.length&&(v=new or("onSelect","select",null,v,S),A.push({event:v,listeners:ee}),v.target=Fi)))}function lc(A,v){var S={};return S[A.toLowerCase()]=v.toLowerCase(),S["Webkit"+A]="webkit"+v,S["Moz"+A]="moz"+v,S}var dn={animationend:lc("Animation","AnimationEnd"),animationiteration:lc("Animation","AnimationIteration"),animationstart:lc("Animation","AnimationStart"),transitionend:lc("Transition","TransitionEnd")},ti={},Qr={};o&&(Qr=document.createElement("div").style,"AnimationEvent"in window||(delete dn.animationend.animation,delete dn.animationiteration.animation,delete dn.animationstart.animation),"TransitionEvent"in window||delete dn.transitionend.transition);function Lr(A){if(ti[A])return ti[A];if(!dn[A])return A;var v=dn[A],S;for(S in v)if(v.hasOwnProperty(S)&&S in Qr)return ti[A]=v[S];return A}var xa=Lr("animationend"),ka=Lr("animationiteration"),Ol=Lr("animationstart"),Pd=Lr("transitionend"),Wc=new Map,Qu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ml(A,v){Wc.set(A,v),i(v,[A])}for(var Ud=0;Ud<Qu.length;Ud++){var On=Qu[Ud],Yi=On.toLowerCase(),Hm=On[0].toUpperCase()+On.slice(1);Ml(Yi,"on"+Hm)}Ml(xa,"onAnimationEnd"),Ml(ka,"onAnimationIteration"),Ml(Ol,"onAnimationStart"),Ml("dblclick","onDoubleClick"),Ml("focusin","onFocus"),Ml("focusout","onBlur"),Ml(Pd,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var oc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),up=new Set("cancel close invalid load scroll toggle".split(" ").concat(oc));function Hu(A,v,S){var ee=A.type||"unknown-event";A.currentTarget=S,Me(ee,v,void 0,A),A.currentTarget=null}function qu(A,v){v=(v&4)!==0;for(var S=0;S<A.length;S++){var ee=A[S],ce=ee.event;ee=ee.listeners;e:{var pe=void 0;if(v)for(var We=ee.length-1;0<=We;We--){var pt=ee[We],_t=pt.instance,Vt=pt.currentTarget;if(pt=pt.listener,_t!==pe&&ce.isPropagationStopped())break e;Hu(ce,pt,Vt),pe=_t}else for(We=0;We<ee.length;We++){if(pt=ee[We],_t=pt.instance,Vt=pt.currentTarget,pt=pt.listener,_t!==pe&&ce.isPropagationStopped())break e;Hu(ce,pt,Vt),pe=_t}}}if(Ne)throw A=ke,Ne=!1,ke=null,A}function Hr(A,v){var S=v[ri];S===void 0&&(S=v[ri]=new Set);var ee=A+"__bubble";S.has(ee)||($u(v,A,2,!1),S.add(ee))}function qm(A,v,S){var ee=0;v&&(ee|=4),$u(S,A,ee,v)}var Rd="_reactListening"+Math.random().toString(36).slice(2);function Gc(A){if(!A[Rd]){A[Rd]=!0,a.forEach(function(S){S!=="selectionchange"&&(up.has(S)||qm(S,!1,A),qm(S,!0,A))});var v=A.nodeType===9?A:A.ownerDocument;v===null||v[Rd]||(v[Rd]=!0,qm("selectionchange",!1,v))}}function $u(A,v,S,ee){switch(Lt(v)){case 1:var ce=Be;break;case 4:ce=lt;break;default:ce=ut}S=ce.bind(null,v,S,A),ce=void 0,!nt||v!=="touchstart"&&v!=="touchmove"&&v!=="wheel"||(ce=!0),ee?ce!==void 0?A.addEventListener(v,S,{capture:!0,passive:ce}):A.addEventListener(v,S,!0):ce!==void 0?A.addEventListener(v,S,{passive:ce}):A.addEventListener(v,S,!1)}function Vu(A,v,S,ee,ce){var pe=ee;if((v&1)===0&&(v&2)===0&&ee!==null)e:for(;;){if(ee===null)return;var We=ee.tag;if(We===3||We===4){var pt=ee.stateNode.containerInfo;if(pt===ce||pt.nodeType===8&&pt.parentNode===ce)break;if(We===4)for(We=ee.return;We!==null;){var _t=We.tag;if((_t===3||_t===4)&&(_t=We.stateNode.containerInfo,_t===ce||_t.nodeType===8&&_t.parentNode===ce))return;We=We.return}for(;pt!==null;){if(We=cc(pt),We===null)return;if(_t=We.tag,_t===5||_t===6){ee=pe=We;continue e}pt=pt.parentNode}}ee=ee.return}je(function(){var Vt=pe,us=be(S),As=[];e:{var ds=Wc.get(A);if(ds!==void 0){var Cs=or,Fs=A;switch(A){case"keypress":if(Ns(S)===0)break e;case"keydown":case"keyup":Cs=sr;break;case"focusin":Fs="focus",Cs=ei;break;case"focusout":Fs="blur",Cs=ei;break;case"beforeblur":case"afterblur":Cs=ei;break;case"click":if(S.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Cs=Zn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Cs=rr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Cs=fa;break;case xa:case ka:case Ol:Cs=rc;break;case Pd:Cs=vn;break;case"scroll":Cs=aa;break;case"wheel":Cs=pl;break;case"copy":case"cut":case"paste":Cs=ie;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Cs=xr}var Ds=(v&4)!==0,Ha=!Ds&&A==="scroll",Ot=Ds?ds!==null?ds+"Capture":null:ds;Ds=[];for(var Bt=Vt,Qt;Bt!==null;){Qt=Bt;var xs=Qt.stateNode;if(Qt.tag===5&&xs!==null&&(Qt=xs,Ot!==null&&(xs=Se(Bt,Ot),xs!=null&&Ds.push(Wu(Bt,xs,Qt)))),Ha)break;Bt=Bt.return}0<Ds.length&&(ds=new Cs(ds,Fs,null,S,us),As.push({event:ds,listeners:Ds}))}}if((v&7)===0){e:{if(ds=A==="mouseover"||A==="pointerover",Cs=A==="mouseout"||A==="pointerout",ds&&S!==Ae&&(Fs=S.relatedTarget||S.fromElement)&&(cc(Fs)||Fs[jn]))break e;if((Cs||ds)&&(ds=us.window===us?us:(ds=us.ownerDocument)?ds.defaultView||ds.parentWindow:window,Cs?(Fs=S.relatedTarget||S.toElement,Cs=Vt,Fs=Fs?cc(Fs):null,Fs!==null&&(Ha=Ve(Fs),Fs!==Ha||Fs.tag!==5&&Fs.tag!==6)&&(Fs=null)):(Cs=null,Fs=Vt),Cs!==Fs)){if(Ds=Zn,xs="onMouseLeave",Ot="onMouseEnter",Bt="mouse",(A==="pointerout"||A==="pointerover")&&(Ds=xr,xs="onPointerLeave",Ot="onPointerEnter",Bt="pointer"),Ha=Cs==null?ds:Yc(Cs),Qt=Fs==null?ds:Yc(Fs),ds=new Ds(xs,Bt+"leave",Cs,S,us),ds.target=Ha,ds.relatedTarget=Qt,xs=null,cc(us)===Vt&&(Ds=new Ds(Ot,Bt+"enter",Fs,S,us),Ds.target=Qt,Ds.relatedTarget=Ha,xs=Ds),Ha=xs,Cs&&Fs)t:{for(Ds=Cs,Ot=Fs,Bt=0,Qt=Ds;Qt;Qt=Kc(Qt))Bt++;for(Qt=0,xs=Ot;xs;xs=Kc(xs))Qt++;for(;0<Bt-Qt;)Ds=Kc(Ds),Bt--;for(;0<Qt-Bt;)Ot=Kc(Ot),Qt--;for(;Bt--;){if(Ds===Ot||Ot!==null&&Ds===Ot.alternate)break t;Ds=Kc(Ds),Ot=Kc(Ot)}Ds=null}else Ds=null;Cs!==null&&mp(As,ds,Cs,Ds,!1),Fs!==null&&Ha!==null&&mp(As,Ha,Fs,Ds,!0)}}e:{if(ds=Vt?Yc(Vt):window,Cs=ds.nodeName&&ds.nodeName.toLowerCase(),Cs==="select"||Cs==="input"&&ds.type==="file")var Us=Id;else if(Td(ds))if(Ou)Us=Dd;else{Us=go;var qs=ic}else(Cs=ds.nodeName)&&Cs.toLowerCase()==="input"&&(ds.type==="checkbox"||ds.type==="radio")&&(Us=vo);if(Us&&(Us=Us(A,Vt))){Pn(As,Us,S,us);break e}qs&&qs(A,ds,Vt),A==="focusout"&&(qs=ds._wrapperState)&&qs.controlled&&ds.type==="number"&&Ie(ds,"number",ds.value)}switch(qs=Vt?Yc(Vt):window,A){case"focusin":(Td(qs)||qs.contentEditable==="true")&&(Fi=qs,jo=Vt,Rl=null);break;case"focusout":Rl=jo=Fi=null;break;case"mousedown":No=!0;break;case"contextmenu":case"mouseup":case"dragend":No=!1,wo(As,S,us);break;case"selectionchange":if(Vc)break;case"keydown":case"keyup":wo(As,S,us)}var $s;if(zi)e:{switch(A){case"compositionstart":var Js="onCompositionStart";break e;case"compositionend":Js="onCompositionEnd";break e;case"compositionupdate":Js="onCompositionUpdate";break e}Js=void 0}else pa?kd(A,S)&&(Js="onCompositionEnd"):A==="keydown"&&S.keyCode===229&&(Js="onCompositionStart");Js&&(Sd&&S.locale!=="ko"&&(pa||Js!=="onCompositionStart"?Js==="onCompositionEnd"&&pa&&($s=ms()):(qt=us,ss="value"in qt?qt.value:qt.textContent,pa=!0)),qs=$m(Vt,Js),0<qs.length&&(Js=new At(Js,A,null,S,us),As.push({event:Js,listeners:qs}),$s?Js.data=$s:($s=Mc(S),$s!==null&&(Js.data=$s)))),($s=Ru?Ed(A,S):Bd(A,S))&&(Vt=$m(Vt,"onBeforeInput"),0<Vt.length&&(us=new At("onBeforeInput","beforeinput",null,S,us),As.push({event:us,listeners:Vt}),us.data=$s))}qu(As,v)})}function Wu(A,v,S){return{instance:A,listener:v,currentTarget:S}}function $m(A,v){for(var S=v+"Capture",ee=[];A!==null;){var ce=A,pe=ce.stateNode;ce.tag===5&&pe!==null&&(ce=pe,pe=Se(A,S),pe!=null&&ee.unshift(Wu(A,pe,ce)),pe=Se(A,v),pe!=null&&ee.push(Wu(A,pe,ce))),A=A.return}return ee}function Kc(A){if(A===null)return null;do A=A.return;while(A&&A.tag!==5);return A||null}function mp(A,v,S,ee,ce){for(var pe=v._reactName,We=[];S!==null&&S!==ee;){var pt=S,_t=pt.alternate,Vt=pt.stateNode;if(_t!==null&&_t===ee)break;pt.tag===5&&Vt!==null&&(pt=Vt,ce?(_t=Se(S,pe),_t!=null&&We.unshift(Wu(S,_t,pt))):ce||(_t=Se(S,pe),_t!=null&&We.push(Wu(S,_t,pt)))),S=S.return}We.length!==0&&A.push({event:v,listeners:We})}var Rg=/\r\n?/g,Og=/\u0000|\uFFFD/g;function hp(A){return(typeof A=="string"?A:""+A).replace(Rg,`
`).replace(Og,"")}function Vm(A,v,S){if(v=hp(v),hp(A)!==v&&S)throw Error(r(425))}function Od(){}var Gu=null,zc=null;function cA(A,v){return A==="textarea"||A==="noscript"||typeof v.children=="string"||typeof v.children=="number"||typeof v.dangerouslySetInnerHTML=="object"&&v.dangerouslySetInnerHTML!==null&&v.dangerouslySetInnerHTML.__html!=null}var dA=typeof setTimeout=="function"?setTimeout:void 0,Ap=typeof clearTimeout=="function"?clearTimeout:void 0,fp=typeof Promise=="function"?Promise:void 0,Mg=typeof queueMicrotask=="function"?queueMicrotask:typeof fp<"u"?function(A){return fp.resolve(null).then(A).catch(Qg)}:dA;function Qg(A){setTimeout(function(){throw A})}function uA(A,v){var S=v,ee=0;do{var ce=S.nextSibling;if(A.removeChild(S),ce&&ce.nodeType===8)if(S=ce.data,S==="/$"){if(ee===0){A.removeChild(ce),Dn(v);return}ee--}else S!=="$"&&S!=="$?"&&S!=="$!"||ee++;S=ce}while(S);Dn(v)}function Mn(A){for(;A!=null;A=A.nextSibling){var v=A.nodeType;if(v===1||v===3)break;if(v===8){if(v=A.data,v==="$"||v==="$!"||v==="$?")break;if(v==="/$")return null}}return A}function Xi(A){A=A.previousSibling;for(var v=0;A;){if(A.nodeType===8){var S=A.data;if(S==="$"||S==="$!"||S==="$?"){if(v===0)return A;v--}else S==="/$"&&v++}A=A.previousSibling}return null}var si=Math.random().toString(36).slice(2),Ql="__reactFiber$"+si,Md="__reactProps$"+si,jn="__reactContainer$"+si,ri="__reactEvents$"+si,Hg="__reactListeners$"+si,qg="__reactHandles$"+si;function cc(A){var v=A[Ql];if(v)return v;for(var S=A.parentNode;S;){if(v=S[jn]||S[Ql]){if(S=v.alternate,v.child!==null||S!==null&&S.child!==null)for(A=Xi(A);A!==null;){if(S=A[Ql])return S;A=Xi(A)}return v}A=S,S=A.parentNode}return null}function Qd(A){return A=A[Ql]||A[jn],!A||A.tag!==5&&A.tag!==6&&A.tag!==13&&A.tag!==3?null:A}function Yc(A){if(A.tag===5||A.tag===6)return A.stateNode;throw Error(r(33))}function Ku(A){return A[Md]||null}var mA=[],_o=-1;function xl(A){return{current:A}}function Dr(A){0>_o||(A.current=mA[_o],mA[_o]=null,_o--)}function Rr(A,v){_o++,mA[_o]=A.current,A.current=v}var dc={},un=xl(dc),ai=xl(!1),Xc=dc;function Hd(A,v){var S=A.type.contextTypes;if(!S)return dc;var ee=A.stateNode;if(ee&&ee.__reactInternalMemoizedUnmaskedChildContext===v)return ee.__reactInternalMemoizedMaskedChildContext;var ce={},pe;for(pe in S)ce[pe]=v[pe];return ee&&(A=A.stateNode,A.__reactInternalMemoizedUnmaskedChildContext=v,A.__reactInternalMemoizedMaskedChildContext=ce),ce}function ni(A){return A=A.childContextTypes,A!=null}function Wm(){Dr(ai),Dr(un)}function pp(A,v,S){if(un.current!==dc)throw Error(r(168));Rr(un,v),Rr(ai,S)}function hA(A,v,S){var ee=A.stateNode;if(v=v.childContextTypes,typeof ee.getChildContext!="function")return S;ee=ee.getChildContext();for(var ce in ee)if(!(ce in v))throw Error(r(108,K(A)||"Unknown",ce));return V({},S,ee)}function Jc(A){return A=(A=A.stateNode)&&A.__reactInternalMemoizedMergedChildContext||dc,Xc=un.current,Rr(un,A),Rr(ai,ai.current),!0}function xp(A,v,S){var ee=A.stateNode;if(!ee)throw Error(r(169));S?(A=hA(A,v,Xc),ee.__reactInternalMemoizedMergedChildContext=A,Dr(ai),Dr(un),Rr(un,A)):Dr(ai),Rr(ai,S)}var So=null,zu=!1,D=!1;function re(A){So===null?So=[A]:So.push(A)}function de(A){zu=!0,re(A)}function ve(){if(!D&&So!==null){D=!0;var A=0,v=hr;try{var S=So;for(hr=1;A<S.length;A++){var ee=S[A];do ee=ee(!0);while(ee!==null)}So=null,zu=!1}catch(ce){throw So!==null&&(So=So.slice(A+1)),bt(Zs,ve),ce}finally{hr=v,D=!1}}return null}var Oe=[],$e=0,ze=null,Xe=0,et=[],ot=0,wt=null,Pt=1,Ut="";function Ft(A,v){Oe[$e++]=Xe,Oe[$e++]=ze,ze=A,Xe=v}function as(A,v,S){et[ot++]=Pt,et[ot++]=Ut,et[ot++]=wt,wt=A;var ee=Pt;A=Ut;var ce=32-Tr(ee)-1;ee&=~(1<<ce),S+=1;var pe=32-Tr(v)+ce;if(30<pe){var We=ce-ce%5;pe=(ee&(1<<We)-1).toString(32),ee>>=We,ce-=We,Pt=1<<32-Tr(v)+ce|S<<ce|ee,Ut=pe+A}else Pt=1<<pe|S<<ce|ee,Ut=A}function Kt(A){A.return!==null&&(Ft(A,1),as(A,1,0))}function kt(A){for(;A===ze;)ze=Oe[--$e],Oe[$e]=null,Xe=Oe[--$e],Oe[$e]=null;for(;A===wt;)wt=et[--ot],et[ot]=null,Ut=et[--ot],et[ot]=null,Pt=et[--ot],et[ot]=null}var Et=null,Xt=null,Yt=!1,ts=null;function _s(A,v){var S=Gl(5,null,null,0);S.elementType="DELETED",S.stateNode=v,S.return=A,v=A.deletions,v===null?(A.deletions=[S],A.flags|=16):v.push(S)}function bs(A,v){switch(A.tag){case 5:var S=A.type;return v=v.nodeType!==1||S.toLowerCase()!==v.nodeName.toLowerCase()?null:v,v!==null?(A.stateNode=v,Et=A,Xt=Mn(v.firstChild),!0):!1;case 6:return v=A.pendingProps===""||v.nodeType!==3?null:v,v!==null?(A.stateNode=v,Et=A,Xt=null,!0):!1;case 13:return v=v.nodeType!==8?null:v,v!==null?(S=wt!==null?{id:Pt,overflow:Ut}:null,A.memoizedState={dehydrated:v,treeContext:S,retryLane:1073741824},S=Gl(18,null,null,0),S.stateNode=v,S.return=A,A.child=S,Et=A,Xt=null,!0):!1;default:return!1}}function Ms(A){return(A.mode&1)!==0&&(A.flags&128)===0}function ys(A){if(Yt){var v=Xt;if(v){var S=v;if(!bs(A,v)){if(Ms(A))throw Error(r(418));v=Mn(S.nextSibling);var ee=Et;v&&bs(A,v)?_s(ee,S):(A.flags=A.flags&-4097|2,Yt=!1,Et=A)}}else{if(Ms(A))throw Error(r(418));A.flags=A.flags&-4097|2,Yt=!1,Et=A}}}function jr(A){for(A=A.return;A!==null&&A.tag!==5&&A.tag!==3&&A.tag!==13;)A=A.return;Et=A}function Nr(A){if(A!==Et)return!1;if(!Yt)return jr(A),Yt=!0,!1;var v;if((v=A.tag!==3)&&!(v=A.tag!==5)&&(v=A.type,v=v!=="head"&&v!=="body"&&!cA(A.type,A.memoizedProps)),v&&(v=Xt)){if(Ms(A))throw gr(),Error(r(418));for(;v;)_s(A,v),v=Mn(v.nextSibling)}if(jr(A),A.tag===13){if(A=A.memoizedState,A=A!==null?A.dehydrated:null,!A)throw Error(r(317));e:{for(A=A.nextSibling,v=0;A;){if(A.nodeType===8){var S=A.data;if(S==="/$"){if(v===0){Xt=Mn(A.nextSibling);break e}v--}else S!=="$"&&S!=="$!"&&S!=="$?"||v++}A=A.nextSibling}Xt=null}}else Xt=Et?Mn(A.stateNode.nextSibling):null;return!0}function gr(){for(var A=Xt;A;)A=Mn(A.nextSibling)}function nr(){Xt=Et=null,Yt=!1}function Pr(A){ts===null?ts=[A]:ts.push(A)}var Or=_.ReactCurrentBatchConfig;function zs(A,v,S){if(A=S.ref,A!==null&&typeof A!="function"&&typeof A!="object"){if(S._owner){if(S=S._owner,S){if(S.tag!==1)throw Error(r(309));var ee=S.stateNode}if(!ee)throw Error(r(147,A));var ce=ee,pe=""+A;return v!==null&&v.ref!==null&&typeof v.ref=="function"&&v.ref._stringRef===pe?v.ref:(v=function(We){var pt=ce.refs;We===null?delete pt[pe]:pt[pe]=We},v._stringRef=pe,v)}if(typeof A!="string")throw Error(r(284));if(!S._owner)throw Error(r(290,A))}return A}function la(A,v){throw A=Object.prototype.toString.call(v),Error(r(31,A==="[object Object]"?"object with keys {"+Object.keys(v).join(", ")+"}":A))}function Qn(A){var v=A._init;return v(A._payload)}function ya(A){function v(Ot,Bt){if(A){var Qt=Ot.deletions;Qt===null?(Ot.deletions=[Bt],Ot.flags|=16):Qt.push(Bt)}}function S(Ot,Bt){if(!A)return null;for(;Bt!==null;)v(Ot,Bt),Bt=Bt.sibling;return null}function ee(Ot,Bt){for(Ot=new Map;Bt!==null;)Bt.key!==null?Ot.set(Bt.key,Bt):Ot.set(Bt.index,Bt),Bt=Bt.sibling;return Ot}function ce(Ot,Bt){return Ot=eu(Ot,Bt),Ot.index=0,Ot.sibling=null,Ot}function pe(Ot,Bt,Qt){return Ot.index=Qt,A?(Qt=Ot.alternate,Qt!==null?(Qt=Qt.index,Qt<Bt?(Ot.flags|=2,Bt):Qt):(Ot.flags|=2,Bt)):(Ot.flags|=1048576,Bt)}function We(Ot){return A&&Ot.alternate===null&&(Ot.flags|=2),Ot}function pt(Ot,Bt,Qt,xs){return Bt===null||Bt.tag!==6?(Bt=gv(Qt,Ot.mode,xs),Bt.return=Ot,Bt):(Bt=ce(Bt,Qt),Bt.return=Ot,Bt)}function _t(Ot,Bt,Qt,xs){var Us=Qt.type;return Us===w?us(Ot,Bt,Qt.props.children,xs,Qt.key):Bt!==null&&(Bt.elementType===Us||typeof Us=="object"&&Us!==null&&Us.$$typeof===q&&Qn(Us)===Bt.type)?(xs=ce(Bt,Qt.props),xs.ref=zs(Ot,Bt,Qt),xs.return=Ot,xs):(xs=Up(Qt.type,Qt.key,Qt.props,null,Ot.mode,xs),xs.ref=zs(Ot,Bt,Qt),xs.return=Ot,xs)}function Vt(Ot,Bt,Qt,xs){return Bt===null||Bt.tag!==4||Bt.stateNode.containerInfo!==Qt.containerInfo||Bt.stateNode.implementation!==Qt.implementation?(Bt=vv(Qt,Ot.mode,xs),Bt.return=Ot,Bt):(Bt=ce(Bt,Qt.children||[]),Bt.return=Ot,Bt)}function us(Ot,Bt,Qt,xs,Us){return Bt===null||Bt.tag!==7?(Bt=rm(Qt,Ot.mode,xs,Us),Bt.return=Ot,Bt):(Bt=ce(Bt,Qt),Bt.return=Ot,Bt)}function As(Ot,Bt,Qt){if(typeof Bt=="string"&&Bt!==""||typeof Bt=="number")return Bt=gv(""+Bt,Ot.mode,Qt),Bt.return=Ot,Bt;if(typeof Bt=="object"&&Bt!==null){switch(Bt.$$typeof){case F:return Qt=Up(Bt.type,Bt.key,Bt.props,null,Ot.mode,Qt),Qt.ref=zs(Ot,null,Bt),Qt.return=Ot,Qt;case I:return Bt=vv(Bt,Ot.mode,Qt),Bt.return=Ot,Bt;case q:var xs=Bt._init;return As(Ot,xs(Bt._payload),Qt)}if(_e(Bt)||L(Bt))return Bt=rm(Bt,Ot.mode,Qt,null),Bt.return=Ot,Bt;la(Ot,Bt)}return null}function ds(Ot,Bt,Qt,xs){var Us=Bt!==null?Bt.key:null;if(typeof Qt=="string"&&Qt!==""||typeof Qt=="number")return Us!==null?null:pt(Ot,Bt,""+Qt,xs);if(typeof Qt=="object"&&Qt!==null){switch(Qt.$$typeof){case F:return Qt.key===Us?_t(Ot,Bt,Qt,xs):null;case I:return Qt.key===Us?Vt(Ot,Bt,Qt,xs):null;case q:return Us=Qt._init,ds(Ot,Bt,Us(Qt._payload),xs)}if(_e(Qt)||L(Qt))return Us!==null?null:us(Ot,Bt,Qt,xs,null);la(Ot,Qt)}return null}function Cs(Ot,Bt,Qt,xs,Us){if(typeof xs=="string"&&xs!==""||typeof xs=="number")return Ot=Ot.get(Qt)||null,pt(Bt,Ot,""+xs,Us);if(typeof xs=="object"&&xs!==null){switch(xs.$$typeof){case F:return Ot=Ot.get(xs.key===null?Qt:xs.key)||null,_t(Bt,Ot,xs,Us);case I:return Ot=Ot.get(xs.key===null?Qt:xs.key)||null,Vt(Bt,Ot,xs,Us);case q:var qs=xs._init;return Cs(Ot,Bt,Qt,qs(xs._payload),Us)}if(_e(xs)||L(xs))return Ot=Ot.get(Qt)||null,us(Bt,Ot,xs,Us,null);la(Bt,xs)}return null}function Fs(Ot,Bt,Qt,xs){for(var Us=null,qs=null,$s=Bt,Js=Bt=0,Sn=null;$s!==null&&Js<Qt.length;Js++){$s.index>Js?(Sn=$s,$s=null):Sn=$s.sibling;var Br=ds(Ot,$s,Qt[Js],xs);if(Br===null){$s===null&&($s=Sn);break}A&&$s&&Br.alternate===null&&v(Ot,$s),Bt=pe(Br,Bt,Js),qs===null?Us=Br:qs.sibling=Br,qs=Br,$s=Sn}if(Js===Qt.length)return S(Ot,$s),Yt&&Ft(Ot,Js),Us;if($s===null){for(;Js<Qt.length;Js++)$s=As(Ot,Qt[Js],xs),$s!==null&&(Bt=pe($s,Bt,Js),qs===null?Us=$s:qs.sibling=$s,qs=$s);return Yt&&Ft(Ot,Js),Us}for($s=ee(Ot,$s);Js<Qt.length;Js++)Sn=Cs($s,Ot,Js,Qt[Js],xs),Sn!==null&&(A&&Sn.alternate!==null&&$s.delete(Sn.key===null?Js:Sn.key),Bt=pe(Sn,Bt,Js),qs===null?Us=Sn:qs.sibling=Sn,qs=Sn);return A&&$s.forEach(function(tu){return v(Ot,tu)}),Yt&&Ft(Ot,Js),Us}function Ds(Ot,Bt,Qt,xs){var Us=L(Qt);if(typeof Us!="function")throw Error(r(150));if(Qt=Us.call(Qt),Qt==null)throw Error(r(151));for(var qs=Us=null,$s=Bt,Js=Bt=0,Sn=null,Br=Qt.next();$s!==null&&!Br.done;Js++,Br=Qt.next()){$s.index>Js?(Sn=$s,$s=null):Sn=$s.sibling;var tu=ds(Ot,$s,Br.value,xs);if(tu===null){$s===null&&($s=Sn);break}A&&$s&&tu.alternate===null&&v(Ot,$s),Bt=pe(tu,Bt,Js),qs===null?Us=tu:qs.sibling=tu,qs=tu,$s=Sn}if(Br.done)return S(Ot,$s),Yt&&Ft(Ot,Js),Us;if($s===null){for(;!Br.done;Js++,Br=Qt.next())Br=As(Ot,Br.value,xs),Br!==null&&(Bt=pe(Br,Bt,Js),qs===null?Us=Br:qs.sibling=Br,qs=Br);return Yt&&Ft(Ot,Js),Us}for($s=ee(Ot,$s);!Br.done;Js++,Br=Qt.next())Br=Cs($s,Ot,Js,Br.value,xs),Br!==null&&(A&&Br.alternate!==null&&$s.delete(Br.key===null?Js:Br.key),Bt=pe(Br,Bt,Js),qs===null?Us=Br:qs.sibling=Br,qs=Br);return A&&$s.forEach(function($F){return v(Ot,$F)}),Yt&&Ft(Ot,Js),Us}function Ha(Ot,Bt,Qt,xs){if(typeof Qt=="object"&&Qt!==null&&Qt.type===w&&Qt.key===null&&(Qt=Qt.props.children),typeof Qt=="object"&&Qt!==null){switch(Qt.$$typeof){case F:e:{for(var Us=Qt.key,qs=Bt;qs!==null;){if(qs.key===Us){if(Us=Qt.type,Us===w){if(qs.tag===7){S(Ot,qs.sibling),Bt=ce(qs,Qt.props.children),Bt.return=Ot,Ot=Bt;break e}}else if(qs.elementType===Us||typeof Us=="object"&&Us!==null&&Us.$$typeof===q&&Qn(Us)===qs.type){S(Ot,qs.sibling),Bt=ce(qs,Qt.props),Bt.ref=zs(Ot,qs,Qt),Bt.return=Ot,Ot=Bt;break e}S(Ot,qs);break}else v(Ot,qs);qs=qs.sibling}Qt.type===w?(Bt=rm(Qt.props.children,Ot.mode,xs,Qt.key),Bt.return=Ot,Ot=Bt):(xs=Up(Qt.type,Qt.key,Qt.props,null,Ot.mode,xs),xs.ref=zs(Ot,Bt,Qt),xs.return=Ot,Ot=xs)}return We(Ot);case I:e:{for(qs=Qt.key;Bt!==null;){if(Bt.key===qs)if(Bt.tag===4&&Bt.stateNode.containerInfo===Qt.containerInfo&&Bt.stateNode.implementation===Qt.implementation){S(Ot,Bt.sibling),Bt=ce(Bt,Qt.children||[]),Bt.return=Ot,Ot=Bt;break e}else{S(Ot,Bt);break}else v(Ot,Bt);Bt=Bt.sibling}Bt=vv(Qt,Ot.mode,xs),Bt.return=Ot,Ot=Bt}return We(Ot);case q:return qs=Qt._init,Ha(Ot,Bt,qs(Qt._payload),xs)}if(_e(Qt))return Fs(Ot,Bt,Qt,xs);if(L(Qt))return Ds(Ot,Bt,Qt,xs);la(Ot,Qt)}return typeof Qt=="string"&&Qt!==""||typeof Qt=="number"?(Qt=""+Qt,Bt!==null&&Bt.tag===6?(S(Ot,Bt.sibling),Bt=ce(Bt,Qt),Bt.return=Ot,Ot=Bt):(S(Ot,Bt),Bt=gv(Qt,Ot.mode,xs),Bt.return=Ot,Ot=Bt),We(Ot)):S(Ot,Bt)}return Ha}var Oa=ya(!0),kr=ya(!1),Nn=xl(null),wn=null,oa=null,Ma=null;function mn(){Ma=oa=wn=null}function ii(A){var v=Nn.current;Dr(Nn),A._currentValue=v}function Ji(A,v,S){for(;A!==null;){var ee=A.alternate;if((A.childLanes&v)!==v?(A.childLanes|=v,ee!==null&&(ee.childLanes|=v)):ee!==null&&(ee.childLanes&v)!==v&&(ee.childLanes|=v),A===S)break;A=A.return}}function ca(A,v){wn=A,Ma=oa=null,A=A.dependencies,A!==null&&A.firstContext!==null&&((A.lanes&v)!==0&&(sl=!0),A.firstContext=null)}function Ea(A){var v=A._currentValue;if(Ma!==A)if(A={context:A,memoizedValue:v,next:null},oa===null){if(wn===null)throw Error(r(308));oa=A,wn.dependencies={lanes:0,firstContext:A}}else oa=oa.next=A;return v}var Ti=null;function uc(A){Ti===null?Ti=[A]:Ti.push(A)}function Co(A,v,S,ee){var ce=v.interleaved;return ce===null?(S.next=S,uc(v)):(S.next=ce.next,ce.next=S),v.interleaved=S,Er(A,ee)}function Er(A,v){A.lanes|=v;var S=A.alternate;for(S!==null&&(S.lanes|=v),S=A,A=A.return;A!==null;)A.childLanes|=v,S=A.alternate,S!==null&&(S.childLanes|=v),S=A,A=A.return;return S.tag===3?S.stateNode:null}var Hl=!1;function Gm(A){A.updateQueue={baseState:A.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function AA(A,v){A=A.updateQueue,v.updateQueue===A&&(v.updateQueue={baseState:A.baseState,firstBaseUpdate:A.firstBaseUpdate,lastBaseUpdate:A.lastBaseUpdate,shared:A.shared,effects:A.effects})}function Zi(A,v){return{eventTime:A,lane:v,tag:0,payload:null,callback:null,next:null}}function el(A,v,S){var ee=A.updateQueue;if(ee===null)return null;if(ee=ee.shared,(_r&2)!==0){var ce=ee.pending;return ce===null?v.next=v:(v.next=ce.next,ce.next=v),ee.pending=v,Er(A,S)}return ce=ee.interleaved,ce===null?(v.next=v,uc(ee)):(v.next=ce.next,ce.next=v),ee.interleaved=v,Er(A,S)}function Zc(A,v,S){if(v=v.updateQueue,v!==null&&(v=v.shared,(S&4194240)!==0)){var ee=v.lanes;ee&=A.pendingLanes,S|=ee,v.lanes=S,uo(A,S)}}function tl(A,v){var S=A.updateQueue,ee=A.alternate;if(ee!==null&&(ee=ee.updateQueue,S===ee)){var ce=null,pe=null;if(S=S.firstBaseUpdate,S!==null){do{var We={eventTime:S.eventTime,lane:S.lane,tag:S.tag,payload:S.payload,callback:S.callback,next:null};pe===null?ce=pe=We:pe=pe.next=We,S=S.next}while(S!==null);pe===null?ce=pe=v:pe=pe.next=v}else ce=pe=v;S={baseState:ee.baseState,firstBaseUpdate:ce,lastBaseUpdate:pe,shared:ee.shared,effects:ee.effects},A.updateQueue=S;return}A=S.lastBaseUpdate,A===null?S.firstBaseUpdate=v:A.next=v,S.lastBaseUpdate=v}function ko(A,v,S,ee){var ce=A.updateQueue;Hl=!1;var pe=ce.firstBaseUpdate,We=ce.lastBaseUpdate,pt=ce.shared.pending;if(pt!==null){ce.shared.pending=null;var _t=pt,Vt=_t.next;_t.next=null,We===null?pe=Vt:We.next=Vt,We=_t;var us=A.alternate;us!==null&&(us=us.updateQueue,pt=us.lastBaseUpdate,pt!==We&&(pt===null?us.firstBaseUpdate=Vt:pt.next=Vt,us.lastBaseUpdate=_t))}if(pe!==null){var As=ce.baseState;We=0,us=Vt=_t=null,pt=pe;do{var ds=pt.lane,Cs=pt.eventTime;if((ee&ds)===ds){us!==null&&(us=us.next={eventTime:Cs,lane:0,tag:pt.tag,payload:pt.payload,callback:pt.callback,next:null});e:{var Fs=A,Ds=pt;switch(ds=v,Cs=S,Ds.tag){case 1:if(Fs=Ds.payload,typeof Fs=="function"){As=Fs.call(Cs,As,ds);break e}As=Fs;break e;case 3:Fs.flags=Fs.flags&-65537|128;case 0:if(Fs=Ds.payload,ds=typeof Fs=="function"?Fs.call(Cs,As,ds):Fs,ds==null)break e;As=V({},As,ds);break e;case 2:Hl=!0}}pt.callback!==null&&pt.lane!==0&&(A.flags|=64,ds=ce.effects,ds===null?ce.effects=[pt]:ds.push(pt))}else Cs={eventTime:Cs,lane:ds,tag:pt.tag,payload:pt.payload,callback:pt.callback,next:null},us===null?(Vt=us=Cs,_t=As):us=us.next=Cs,We|=ds;if(pt=pt.next,pt===null){if(pt=ce.shared.pending,pt===null)break;ds=pt,pt=ds.next,ds.next=null,ce.lastBaseUpdate=ds,ce.shared.pending=null}}while(!0);if(us===null&&(_t=As),ce.baseState=_t,ce.firstBaseUpdate=Vt,ce.lastBaseUpdate=us,v=ce.shared.interleaved,v!==null){ce=v;do We|=ce.lane,ce=ce.next;while(ce!==v)}else pe===null&&(ce.shared.lanes=0);Zu|=We,A.lanes=We,A.memoizedState=As}}function ed(A,v,S){if(A=v.effects,v.effects=null,A!==null)for(v=0;v<A.length;v++){var ee=A[v],ce=ee.callback;if(ce!==null){if(ee.callback=null,ee=S,typeof ce!="function")throw Error(r(191,ce));ce.call(ee)}}}var qd={},Ii=xl(qd),$d=xl(qd),mc=xl(qd);function Eo(A){if(A===qd)throw Error(r(174));return A}function Vd(A,v){switch(Rr(mc,v),Rr($d,A),Rr(Ii,qd),A=v.nodeType,A){case 9:case 11:v=(v=v.documentElement)?v.namespaceURI:Te(null,"");break;default:A=A===8?v.parentNode:v,v=A.namespaceURI||null,A=A.tagName,v=Te(v,A)}Dr(Ii),Rr(Ii,v)}function ql(){Dr(Ii),Dr($d),Dr(mc)}function gp(A){Eo(mc.current);var v=Eo(Ii.current),S=Te(v,A.type);v!==S&&(Rr($d,A),Rr(Ii,S))}function fA(A){$d.current===A&&(Dr(Ii),Dr($d))}var Jr=xl(0);function gl(A){for(var v=A;v!==null;){if(v.tag===13){var S=v.memoizedState;if(S!==null&&(S=S.dehydrated,S===null||S.data==="$?"||S.data==="$!"))return v}else if(v.tag===19&&v.memoizedProps.revealOrder!==void 0){if((v.flags&128)!==0)return v}else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===A)break;for(;v.sibling===null;){if(v.return===null||v.return===A)return null;v=v.return}v.sibling.return=v.return,v=v.sibling}return null}var pA=[];function xA(){for(var A=0;A<pA.length;A++)pA[A]._workInProgressVersionPrimary=null;pA.length=0}var Km=_.ReactCurrentDispatcher,zm=_.ReactCurrentBatchConfig,$l=0,sa=null,Ba=null,ja=null,Wd=!1,Bo=!1,Gd=0,$g=0;function Qa(){throw Error(r(321))}function Ym(A,v){if(v===null)return!1;for(var S=0;S<v.length&&S<A.length;S++)if(!wr(A[S],v[S]))return!1;return!0}function Yu(A,v,S,ee,ce,pe){if($l=pe,sa=v,v.memoizedState=null,v.updateQueue=null,v.lanes=0,Km.current=A===null||A.memoizedState===null?pF:xF,A=S(ee,ce),Bo){pe=0;do{if(Bo=!1,Gd=0,25<=pe)throw Error(r(301));pe+=1,ja=Ba=null,v.updateQueue=null,Km.current=gF,A=S(ee,ce)}while(Bo)}if(Km.current=Np,v=Ba!==null&&Ba.next!==null,$l=0,ja=Ba=sa=null,Wd=!1,v)throw Error(r(300));return A}function Vl(){var A=Gd!==0;return Gd=0,A}function vl(){var A={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ja===null?sa.memoizedState=ja=A:ja=ja.next=A,ja}function Li(){if(Ba===null){var A=sa.alternate;A=A!==null?A.memoizedState:null}else A=Ba.next;var v=ja===null?sa.memoizedState:ja.next;if(v!==null)ja=v,Ba=A;else{if(A===null)throw Error(r(310));Ba=A,A={memoizedState:Ba.memoizedState,baseState:Ba.baseState,baseQueue:Ba.baseQueue,queue:Ba.queue,next:null},ja===null?sa.memoizedState=ja=A:ja=ja.next=A}return ja}function Xu(A,v){return typeof v=="function"?v(A):v}function Xm(A){var v=Li(),S=v.queue;if(S===null)throw Error(r(311));S.lastRenderedReducer=A;var ee=Ba,ce=ee.baseQueue,pe=S.pending;if(pe!==null){if(ce!==null){var We=ce.next;ce.next=pe.next,pe.next=We}ee.baseQueue=ce=pe,S.pending=null}if(ce!==null){pe=ce.next,ee=ee.baseState;var pt=We=null,_t=null,Vt=pe;do{var us=Vt.lane;if(($l&us)===us)_t!==null&&(_t=_t.next={lane:0,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null}),ee=Vt.hasEagerState?Vt.eagerState:A(ee,Vt.action);else{var As={lane:us,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null};_t===null?(pt=_t=As,We=ee):_t=_t.next=As,sa.lanes|=us,Zu|=us}Vt=Vt.next}while(Vt!==null&&Vt!==pe);_t===null?We=ee:_t.next=pt,wr(ee,v.memoizedState)||(sl=!0),v.memoizedState=ee,v.baseState=We,v.baseQueue=_t,S.lastRenderedState=ee}if(A=S.interleaved,A!==null){ce=A;do pe=ce.lane,sa.lanes|=pe,Zu|=pe,ce=ce.next;while(ce!==A)}else ce===null&&(S.lanes=0);return[v.memoizedState,S.dispatch]}function hc(A){var v=Li(),S=v.queue;if(S===null)throw Error(r(311));S.lastRenderedReducer=A;var ee=S.dispatch,ce=S.pending,pe=v.memoizedState;if(ce!==null){S.pending=null;var We=ce=ce.next;do pe=A(pe,We.action),We=We.next;while(We!==ce);wr(pe,v.memoizedState)||(sl=!0),v.memoizedState=pe,v.baseQueue===null&&(v.baseState=pe),S.lastRenderedState=pe}return[pe,ee]}function vp(){}function gA(A,v){var S=sa,ee=Li(),ce=v(),pe=!wr(ee.memoizedState,ce);if(pe&&(ee.memoizedState=ce,sl=!0),ee=ee.queue,eh(yp.bind(null,S,ee,A),[A]),ee.getSnapshot!==v||pe||ja!==null&&ja.memoizedState.tag&1){if(S.flags|=2048,Di(9,vA.bind(null,S,ee,ce,v),void 0,null),_n===null)throw Error(r(349));($l&30)!==0||bp(S,v,ce)}return ce}function bp(A,v,S){A.flags|=16384,A={getSnapshot:v,value:S},v=sa.updateQueue,v===null?(v={lastEffect:null,stores:null},sa.updateQueue=v,v.stores=[A]):(S=v.stores,S===null?v.stores=[A]:S.push(A))}function vA(A,v,S,ee){v.value=S,v.getSnapshot=ee,Kd(v)&&Jm(A)}function yp(A,v,S){return S(function(){Kd(v)&&Jm(A)})}function Kd(A){var v=A.getSnapshot;A=A.value;try{var S=v();return!wr(A,S)}catch{return!0}}function Jm(A){var v=Er(A,1);v!==null&&Do(v,A,1,-1)}function Ju(A){var v=vl();return typeof A=="function"&&(A=A()),v.memoizedState=v.baseState=A,A={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xu,lastRenderedState:A},v.queue=A,A=A.dispatch=fF.bind(null,sa,A),[v.memoizedState,A]}function Di(A,v,S,ee){return A={tag:A,create:v,destroy:S,deps:ee,next:null},v=sa.updateQueue,v===null?(v={lastEffect:null,stores:null},sa.updateQueue=v,v.lastEffect=A.next=A):(S=v.lastEffect,S===null?v.lastEffect=A.next=A:(ee=S.next,S.next=A,A.next=ee,v.lastEffect=A)),A}function Fo(){return Li().memoizedState}function bl(A,v,S,ee){var ce=vl();sa.flags|=A,ce.memoizedState=Di(1|v,S,void 0,ee===void 0?null:ee)}function td(A,v,S,ee){var ce=Li();ee=ee===void 0?null:ee;var pe=void 0;if(Ba!==null){var We=Ba.memoizedState;if(pe=We.destroy,ee!==null&&Ym(ee,We.deps)){ce.memoizedState=Di(v,S,pe,ee);return}}sa.flags|=A,ce.memoizedState=Di(1|v,S,pe,ee)}function Zm(A,v){return bl(8390656,8,A,v)}function eh(A,v){return td(2048,8,A,v)}function jp(A,v){return td(4,2,A,v)}function th(A,v){return td(4,4,A,v)}function sh(A,v){if(typeof v=="function")return A=A(),v(A),function(){v(null)};if(v!=null)return A=A(),v.current=A,function(){v.current=null}}function WN(A,v,S){return S=S!=null?S.concat([A]):null,td(4,4,sh.bind(null,v,A),S)}function Vg(){}function GN(A,v){var S=Li();v=v===void 0?null:v;var ee=S.memoizedState;return ee!==null&&v!==null&&Ym(v,ee[1])?ee[0]:(S.memoizedState=[A,v],A)}function KN(A,v){var S=Li();v=v===void 0?null:v;var ee=S.memoizedState;return ee!==null&&v!==null&&Ym(v,ee[1])?ee[0]:(A=A(),S.memoizedState=[A,v],A)}function zN(A,v,S){return($l&21)===0?(A.baseState&&(A.baseState=!1,sl=!0),A.memoizedState=S):(wr(S,v)||(S=Jo(),sa.lanes|=S,Zu|=S,A.baseState=!0),v)}function hF(A,v){var S=hr;hr=S!==0&&4>S?S:4,A(!0);var ee=zm.transition;zm.transition={};try{A(!1),v()}finally{hr=S,zm.transition=ee}}function YN(){return Li().memoizedState}function AF(A,v,S){var ee=Jd(A);if(S={lane:ee,action:S,hasEagerState:!1,eagerState:null,next:null},XN(A))JN(v,S);else if(S=Co(A,v,S,ee),S!==null){var ce=Ui();Do(S,A,ee,ce),ZN(S,v,ee)}}function fF(A,v,S){var ee=Jd(A),ce={lane:ee,action:S,hasEagerState:!1,eagerState:null,next:null};if(XN(A))JN(v,ce);else{var pe=A.alternate;if(A.lanes===0&&(pe===null||pe.lanes===0)&&(pe=v.lastRenderedReducer,pe!==null))try{var We=v.lastRenderedState,pt=pe(We,S);if(ce.hasEagerState=!0,ce.eagerState=pt,wr(pt,We)){var _t=v.interleaved;_t===null?(ce.next=ce,uc(v)):(ce.next=_t.next,_t.next=ce),v.interleaved=ce;return}}catch{}finally{}S=Co(A,v,ce,ee),S!==null&&(ce=Ui(),Do(S,A,ee,ce),ZN(S,v,ee))}}function XN(A){var v=A.alternate;return A===sa||v!==null&&v===sa}function JN(A,v){Bo=Wd=!0;var S=A.pending;S===null?v.next=v:(v.next=S.next,S.next=v),A.pending=v}function ZN(A,v,S){if((S&4194240)!==0){var ee=v.lanes;ee&=A.pendingLanes,S|=ee,v.lanes=S,uo(A,S)}}var Np={readContext:Ea,useCallback:Qa,useContext:Qa,useEffect:Qa,useImperativeHandle:Qa,useInsertionEffect:Qa,useLayoutEffect:Qa,useMemo:Qa,useReducer:Qa,useRef:Qa,useState:Qa,useDebugValue:Qa,useDeferredValue:Qa,useTransition:Qa,useMutableSource:Qa,useSyncExternalStore:Qa,useId:Qa,unstable_isNewReconciler:!1},pF={readContext:Ea,useCallback:function(A,v){return vl().memoizedState=[A,v===void 0?null:v],A},useContext:Ea,useEffect:Zm,useImperativeHandle:function(A,v,S){return S=S!=null?S.concat([A]):null,bl(4194308,4,sh.bind(null,v,A),S)},useLayoutEffect:function(A,v){return bl(4194308,4,A,v)},useInsertionEffect:function(A,v){return bl(4,2,A,v)},useMemo:function(A,v){var S=vl();return v=v===void 0?null:v,A=A(),S.memoizedState=[A,v],A},useReducer:function(A,v,S){var ee=vl();return v=S!==void 0?S(v):v,ee.memoizedState=ee.baseState=v,A={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:A,lastRenderedState:v},ee.queue=A,A=A.dispatch=AF.bind(null,sa,A),[ee.memoizedState,A]},useRef:function(A){var v=vl();return A={current:A},v.memoizedState=A},useState:Ju,useDebugValue:Vg,useDeferredValue:function(A){return vl().memoizedState=A},useTransition:function(){var A=Ju(!1),v=A[0];return A=hF.bind(null,A[1]),vl().memoizedState=A,[v,A]},useMutableSource:function(){},useSyncExternalStore:function(A,v,S){var ee=sa,ce=vl();if(Yt){if(S===void 0)throw Error(r(407));S=S()}else{if(S=v(),_n===null)throw Error(r(349));($l&30)!==0||bp(ee,v,S)}ce.memoizedState=S;var pe={value:S,getSnapshot:v};return ce.queue=pe,Zm(yp.bind(null,ee,pe,A),[A]),ee.flags|=2048,Di(9,vA.bind(null,ee,pe,S,v),void 0,null),S},useId:function(){var A=vl(),v=_n.identifierPrefix;if(Yt){var S=Ut,ee=Pt;S=(ee&~(1<<32-Tr(ee)-1)).toString(32)+S,v=":"+v+"R"+S,S=Gd++,0<S&&(v+="H"+S.toString(32)),v+=":"}else S=$g++,v=":"+v+"r"+S.toString(32)+":";return A.memoizedState=v},unstable_isNewReconciler:!1},xF={readContext:Ea,useCallback:GN,useContext:Ea,useEffect:eh,useImperativeHandle:WN,useInsertionEffect:jp,useLayoutEffect:th,useMemo:KN,useReducer:Xm,useRef:Fo,useState:function(){return Xm(Xu)},useDebugValue:Vg,useDeferredValue:function(A){var v=Li();return zN(v,Ba.memoizedState,A)},useTransition:function(){var A=Xm(Xu)[0],v=Li().memoizedState;return[A,v]},useMutableSource:vp,useSyncExternalStore:gA,useId:YN,unstable_isNewReconciler:!1},gF={readContext:Ea,useCallback:GN,useContext:Ea,useEffect:eh,useImperativeHandle:WN,useInsertionEffect:jp,useLayoutEffect:th,useMemo:KN,useReducer:hc,useRef:Fo,useState:function(){return hc(Xu)},useDebugValue:Vg,useDeferredValue:function(A){var v=Li();return Ba===null?v.memoizedState=A:zN(v,Ba.memoizedState,A)},useTransition:function(){var A=hc(Xu)[0],v=Li().memoizedState;return[A,v]},useMutableSource:vp,useSyncExternalStore:gA,useId:YN,unstable_isNewReconciler:!1};function To(A,v){if(A&&A.defaultProps){v=V({},v),A=A.defaultProps;for(var S in A)v[S]===void 0&&(v[S]=A[S]);return v}return v}function Wg(A,v,S,ee){v=A.memoizedState,S=S(ee,v),S=S==null?v:V({},v,S),A.memoizedState=S,A.lanes===0&&(A.updateQueue.baseState=S)}var wp={isMounted:function(A){return(A=A._reactInternals)?Ve(A)===A:!1},enqueueSetState:function(A,v,S){A=A._reactInternals;var ee=Ui(),ce=Jd(A),pe=Zi(ee,ce);pe.payload=v,S!=null&&(pe.callback=S),v=el(A,pe,ce),v!==null&&(Do(v,A,ce,ee),Zc(v,A,ce))},enqueueReplaceState:function(A,v,S){A=A._reactInternals;var ee=Ui(),ce=Jd(A),pe=Zi(ee,ce);pe.tag=1,pe.payload=v,S!=null&&(pe.callback=S),v=el(A,pe,ce),v!==null&&(Do(v,A,ce,ee),Zc(v,A,ce))},enqueueForceUpdate:function(A,v){A=A._reactInternals;var S=Ui(),ee=Jd(A),ce=Zi(S,ee);ce.tag=2,v!=null&&(ce.callback=v),v=el(A,ce,ee),v!==null&&(Do(v,A,ee,S),Zc(v,A,ee))}};function e1(A,v,S,ee,ce,pe,We){return A=A.stateNode,typeof A.shouldComponentUpdate=="function"?A.shouldComponentUpdate(ee,pe,We):v.prototype&&v.prototype.isPureReactComponent?!yo(S,ee)||!yo(ce,pe):!0}function t1(A,v,S){var ee=!1,ce=dc,pe=v.contextType;return typeof pe=="object"&&pe!==null?pe=Ea(pe):(ce=ni(v)?Xc:un.current,ee=v.contextTypes,pe=(ee=ee!=null)?Hd(A,ce):dc),v=new v(S,pe),A.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=wp,A.stateNode=v,v._reactInternals=A,ee&&(A=A.stateNode,A.__reactInternalMemoizedUnmaskedChildContext=ce,A.__reactInternalMemoizedMaskedChildContext=pe),v}function s1(A,v,S,ee){A=v.state,typeof v.componentWillReceiveProps=="function"&&v.componentWillReceiveProps(S,ee),typeof v.UNSAFE_componentWillReceiveProps=="function"&&v.UNSAFE_componentWillReceiveProps(S,ee),v.state!==A&&wp.enqueueReplaceState(v,v.state,null)}function Gg(A,v,S,ee){var ce=A.stateNode;ce.props=S,ce.state=A.memoizedState,ce.refs={},Gm(A);var pe=v.contextType;typeof pe=="object"&&pe!==null?ce.context=Ea(pe):(pe=ni(v)?Xc:un.current,ce.context=Hd(A,pe)),ce.state=A.memoizedState,pe=v.getDerivedStateFromProps,typeof pe=="function"&&(Wg(A,v,pe,S),ce.state=A.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof ce.getSnapshotBeforeUpdate=="function"||typeof ce.UNSAFE_componentWillMount!="function"&&typeof ce.componentWillMount!="function"||(v=ce.state,typeof ce.componentWillMount=="function"&&ce.componentWillMount(),typeof ce.UNSAFE_componentWillMount=="function"&&ce.UNSAFE_componentWillMount(),v!==ce.state&&wp.enqueueReplaceState(ce,ce.state,null),ko(A,S,ce,ee),ce.state=A.memoizedState),typeof ce.componentDidMount=="function"&&(A.flags|=4194308)}function rh(A,v){try{var S="",ee=v;do S+=G(ee),ee=ee.return;while(ee);var ce=S}catch(pe){ce=`
Error generating stack: `+pe.message+`
`+pe.stack}return{value:A,source:v,stack:ce,digest:null}}function Kg(A,v,S){return{value:A,source:null,stack:S??null,digest:v??null}}function zg(A,v){try{console.error(v.value)}catch(S){setTimeout(function(){throw S})}}var vF=typeof WeakMap=="function"?WeakMap:Map;function r1(A,v,S){S=Zi(-1,S),S.tag=3,S.payload={element:null};var ee=v.value;return S.callback=function(){Fp||(Fp=!0,dv=ee),zg(A,v)},S}function a1(A,v,S){S=Zi(-1,S),S.tag=3;var ee=A.type.getDerivedStateFromError;if(typeof ee=="function"){var ce=v.value;S.payload=function(){return ee(ce)},S.callback=function(){zg(A,v)}}var pe=A.stateNode;return pe!==null&&typeof pe.componentDidCatch=="function"&&(S.callback=function(){zg(A,v),typeof ee!="function"&&(Yd===null?Yd=new Set([this]):Yd.add(this));var We=v.stack;this.componentDidCatch(v.value,{componentStack:We!==null?We:""})}),S}function n1(A,v,S){var ee=A.pingCache;if(ee===null){ee=A.pingCache=new vF;var ce=new Set;ee.set(v,ce)}else ce=ee.get(v),ce===void 0&&(ce=new Set,ee.set(v,ce));ce.has(S)||(ce.add(S),A=IF.bind(null,A,v,S),v.then(A,A))}function i1(A){do{var v;if((v=A.tag===13)&&(v=A.memoizedState,v=v!==null?v.dehydrated!==null:!0),v)return A;A=A.return}while(A!==null);return null}function l1(A,v,S,ee,ce){return(A.mode&1)===0?(A===v?A.flags|=65536:(A.flags|=128,S.flags|=131072,S.flags&=-52805,S.tag===1&&(S.alternate===null?S.tag=17:(v=Zi(-1,1),v.tag=2,el(S,v,1))),S.lanes|=1),A):(A.flags|=65536,A.lanes=ce,A)}var bF=_.ReactCurrentOwner,sl=!1;function Pi(A,v,S,ee){v.child=A===null?kr(v,null,S,ee):Oa(v,A.child,S,ee)}function o1(A,v,S,ee,ce){S=S.render;var pe=v.ref;return ca(v,ce),ee=Yu(A,v,S,ee,pe,ce),S=Vl(),A!==null&&!sl?(v.updateQueue=A.updateQueue,v.flags&=-2053,A.lanes&=~ce,sd(A,v,ce)):(Yt&&S&&Kt(v),v.flags|=1,Pi(A,v,ee,ce),v.child)}function c1(A,v,S,ee,ce){if(A===null){var pe=S.type;return typeof pe=="function"&&!xv(pe)&&pe.defaultProps===void 0&&S.compare===null&&S.defaultProps===void 0?(v.tag=15,v.type=pe,d1(A,v,pe,ee,ce)):(A=Up(S.type,null,ee,v,v.mode,ce),A.ref=v.ref,A.return=v,v.child=A)}if(pe=A.child,(A.lanes&ce)===0){var We=pe.memoizedProps;if(S=S.compare,S=S!==null?S:yo,S(We,ee)&&A.ref===v.ref)return sd(A,v,ce)}return v.flags|=1,A=eu(pe,ee),A.ref=v.ref,A.return=v,v.child=A}function d1(A,v,S,ee,ce){if(A!==null){var pe=A.memoizedProps;if(yo(pe,ee)&&A.ref===v.ref)if(sl=!1,v.pendingProps=ee=pe,(A.lanes&ce)!==0)(A.flags&131072)!==0&&(sl=!0);else return v.lanes=A.lanes,sd(A,v,ce)}return Yg(A,v,S,ee,ce)}function u1(A,v,S){var ee=v.pendingProps,ce=ee.children,pe=A!==null?A.memoizedState:null;if(ee.mode==="hidden")if((v.mode&1)===0)v.memoizedState={baseLanes:0,cachePool:null,transitions:null},Rr(nh,yl),yl|=S;else{if((S&1073741824)===0)return A=pe!==null?pe.baseLanes|S:S,v.lanes=v.childLanes=1073741824,v.memoizedState={baseLanes:A,cachePool:null,transitions:null},v.updateQueue=null,Rr(nh,yl),yl|=A,null;v.memoizedState={baseLanes:0,cachePool:null,transitions:null},ee=pe!==null?pe.baseLanes:S,Rr(nh,yl),yl|=ee}else pe!==null?(ee=pe.baseLanes|S,v.memoizedState=null):ee=S,Rr(nh,yl),yl|=ee;return Pi(A,v,ce,S),v.child}function m1(A,v){var S=v.ref;(A===null&&S!==null||A!==null&&A.ref!==S)&&(v.flags|=512,v.flags|=2097152)}function Yg(A,v,S,ee,ce){var pe=ni(S)?Xc:un.current;return pe=Hd(v,pe),ca(v,ce),S=Yu(A,v,S,ee,pe,ce),ee=Vl(),A!==null&&!sl?(v.updateQueue=A.updateQueue,v.flags&=-2053,A.lanes&=~ce,sd(A,v,ce)):(Yt&&ee&&Kt(v),v.flags|=1,Pi(A,v,S,ce),v.child)}function h1(A,v,S,ee,ce){if(ni(S)){var pe=!0;Jc(v)}else pe=!1;if(ca(v,ce),v.stateNode===null)Sp(A,v),t1(v,S,ee),Gg(v,S,ee,ce),ee=!0;else if(A===null){var We=v.stateNode,pt=v.memoizedProps;We.props=pt;var _t=We.context,Vt=S.contextType;typeof Vt=="object"&&Vt!==null?Vt=Ea(Vt):(Vt=ni(S)?Xc:un.current,Vt=Hd(v,Vt));var us=S.getDerivedStateFromProps,As=typeof us=="function"||typeof We.getSnapshotBeforeUpdate=="function";As||typeof We.UNSAFE_componentWillReceiveProps!="function"&&typeof We.componentWillReceiveProps!="function"||(pt!==ee||_t!==Vt)&&s1(v,We,ee,Vt),Hl=!1;var ds=v.memoizedState;We.state=ds,ko(v,ee,We,ce),_t=v.memoizedState,pt!==ee||ds!==_t||ai.current||Hl?(typeof us=="function"&&(Wg(v,S,us,ee),_t=v.memoizedState),(pt=Hl||e1(v,S,pt,ee,ds,_t,Vt))?(As||typeof We.UNSAFE_componentWillMount!="function"&&typeof We.componentWillMount!="function"||(typeof We.componentWillMount=="function"&&We.componentWillMount(),typeof We.UNSAFE_componentWillMount=="function"&&We.UNSAFE_componentWillMount()),typeof We.componentDidMount=="function"&&(v.flags|=4194308)):(typeof We.componentDidMount=="function"&&(v.flags|=4194308),v.memoizedProps=ee,v.memoizedState=_t),We.props=ee,We.state=_t,We.context=Vt,ee=pt):(typeof We.componentDidMount=="function"&&(v.flags|=4194308),ee=!1)}else{We=v.stateNode,AA(A,v),pt=v.memoizedProps,Vt=v.type===v.elementType?pt:To(v.type,pt),We.props=Vt,As=v.pendingProps,ds=We.context,_t=S.contextType,typeof _t=="object"&&_t!==null?_t=Ea(_t):(_t=ni(S)?Xc:un.current,_t=Hd(v,_t));var Cs=S.getDerivedStateFromProps;(us=typeof Cs=="function"||typeof We.getSnapshotBeforeUpdate=="function")||typeof We.UNSAFE_componentWillReceiveProps!="function"&&typeof We.componentWillReceiveProps!="function"||(pt!==As||ds!==_t)&&s1(v,We,ee,_t),Hl=!1,ds=v.memoizedState,We.state=ds,ko(v,ee,We,ce);var Fs=v.memoizedState;pt!==As||ds!==Fs||ai.current||Hl?(typeof Cs=="function"&&(Wg(v,S,Cs,ee),Fs=v.memoizedState),(Vt=Hl||e1(v,S,Vt,ee,ds,Fs,_t)||!1)?(us||typeof We.UNSAFE_componentWillUpdate!="function"&&typeof We.componentWillUpdate!="function"||(typeof We.componentWillUpdate=="function"&&We.componentWillUpdate(ee,Fs,_t),typeof We.UNSAFE_componentWillUpdate=="function"&&We.UNSAFE_componentWillUpdate(ee,Fs,_t)),typeof We.componentDidUpdate=="function"&&(v.flags|=4),typeof We.getSnapshotBeforeUpdate=="function"&&(v.flags|=1024)):(typeof We.componentDidUpdate!="function"||pt===A.memoizedProps&&ds===A.memoizedState||(v.flags|=4),typeof We.getSnapshotBeforeUpdate!="function"||pt===A.memoizedProps&&ds===A.memoizedState||(v.flags|=1024),v.memoizedProps=ee,v.memoizedState=Fs),We.props=ee,We.state=Fs,We.context=_t,ee=Vt):(typeof We.componentDidUpdate!="function"||pt===A.memoizedProps&&ds===A.memoizedState||(v.flags|=4),typeof We.getSnapshotBeforeUpdate!="function"||pt===A.memoizedProps&&ds===A.memoizedState||(v.flags|=1024),ee=!1)}return Xg(A,v,S,ee,pe,ce)}function Xg(A,v,S,ee,ce,pe){m1(A,v);var We=(v.flags&128)!==0;if(!ee&&!We)return ce&&xp(v,S,!1),sd(A,v,pe);ee=v.stateNode,bF.current=v;var pt=We&&typeof S.getDerivedStateFromError!="function"?null:ee.render();return v.flags|=1,A!==null&&We?(v.child=Oa(v,A.child,null,pe),v.child=Oa(v,null,pt,pe)):Pi(A,v,pt,pe),v.memoizedState=ee.state,ce&&xp(v,S,!0),v.child}function A1(A){var v=A.stateNode;v.pendingContext?pp(A,v.pendingContext,v.pendingContext!==v.context):v.context&&pp(A,v.context,!1),Vd(A,v.containerInfo)}function f1(A,v,S,ee,ce){return nr(),Pr(ce),v.flags|=256,Pi(A,v,S,ee),v.child}var Jg={dehydrated:null,treeContext:null,retryLane:0};function Zg(A){return{baseLanes:A,cachePool:null,transitions:null}}function p1(A,v,S){var ee=v.pendingProps,ce=Jr.current,pe=!1,We=(v.flags&128)!==0,pt;if((pt=We)||(pt=A!==null&&A.memoizedState===null?!1:(ce&2)!==0),pt?(pe=!0,v.flags&=-129):(A===null||A.memoizedState!==null)&&(ce|=1),Rr(Jr,ce&1),A===null)return ys(v),A=v.memoizedState,A!==null&&(A=A.dehydrated,A!==null)?((v.mode&1)===0?v.lanes=1:A.data==="$!"?v.lanes=8:v.lanes=1073741824,null):(We=ee.children,A=ee.fallback,pe?(ee=v.mode,pe=v.child,We={mode:"hidden",children:We},(ee&1)===0&&pe!==null?(pe.childLanes=0,pe.pendingProps=We):pe=Rp(We,ee,0,null),A=rm(A,ee,S,null),pe.return=v,A.return=v,pe.sibling=A,v.child=pe,v.child.memoizedState=Zg(S),v.memoizedState=Jg,A):ev(v,We));if(ce=A.memoizedState,ce!==null&&(pt=ce.dehydrated,pt!==null))return yF(A,v,We,ee,pt,ce,S);if(pe){pe=ee.fallback,We=v.mode,ce=A.child,pt=ce.sibling;var _t={mode:"hidden",children:ee.children};return(We&1)===0&&v.child!==ce?(ee=v.child,ee.childLanes=0,ee.pendingProps=_t,v.deletions=null):(ee=eu(ce,_t),ee.subtreeFlags=ce.subtreeFlags&14680064),pt!==null?pe=eu(pt,pe):(pe=rm(pe,We,S,null),pe.flags|=2),pe.return=v,ee.return=v,ee.sibling=pe,v.child=ee,ee=pe,pe=v.child,We=A.child.memoizedState,We=We===null?Zg(S):{baseLanes:We.baseLanes|S,cachePool:null,transitions:We.transitions},pe.memoizedState=We,pe.childLanes=A.childLanes&~S,v.memoizedState=Jg,ee}return pe=A.child,A=pe.sibling,ee=eu(pe,{mode:"visible",children:ee.children}),(v.mode&1)===0&&(ee.lanes=S),ee.return=v,ee.sibling=null,A!==null&&(S=v.deletions,S===null?(v.deletions=[A],v.flags|=16):S.push(A)),v.child=ee,v.memoizedState=null,ee}function ev(A,v){return v=Rp({mode:"visible",children:v},A.mode,0,null),v.return=A,A.child=v}function _p(A,v,S,ee){return ee!==null&&Pr(ee),Oa(v,A.child,null,S),A=ev(v,v.pendingProps.children),A.flags|=2,v.memoizedState=null,A}function yF(A,v,S,ee,ce,pe,We){if(S)return v.flags&256?(v.flags&=-257,ee=Kg(Error(r(422))),_p(A,v,We,ee)):v.memoizedState!==null?(v.child=A.child,v.flags|=128,null):(pe=ee.fallback,ce=v.mode,ee=Rp({mode:"visible",children:ee.children},ce,0,null),pe=rm(pe,ce,We,null),pe.flags|=2,ee.return=v,pe.return=v,ee.sibling=pe,v.child=ee,(v.mode&1)!==0&&Oa(v,A.child,null,We),v.child.memoizedState=Zg(We),v.memoizedState=Jg,pe);if((v.mode&1)===0)return _p(A,v,We,null);if(ce.data==="$!"){if(ee=ce.nextSibling&&ce.nextSibling.dataset,ee)var pt=ee.dgst;return ee=pt,pe=Error(r(419)),ee=Kg(pe,ee,void 0),_p(A,v,We,ee)}if(pt=(We&A.childLanes)!==0,sl||pt){if(ee=_n,ee!==null){switch(We&-We){case 4:ce=2;break;case 16:ce=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:ce=32;break;case 536870912:ce=268435456;break;default:ce=0}ce=(ce&(ee.suspendedLanes|We))!==0?0:ce,ce!==0&&ce!==pe.retryLane&&(pe.retryLane=ce,Er(A,ce),Do(ee,A,ce,-1))}return pv(),ee=Kg(Error(r(421))),_p(A,v,We,ee)}return ce.data==="$?"?(v.flags|=128,v.child=A.child,v=LF.bind(null,A),ce._reactRetry=v,null):(A=pe.treeContext,Xt=Mn(ce.nextSibling),Et=v,Yt=!0,ts=null,A!==null&&(et[ot++]=Pt,et[ot++]=Ut,et[ot++]=wt,Pt=A.id,Ut=A.overflow,wt=v),v=ev(v,ee.children),v.flags|=4096,v)}function x1(A,v,S){A.lanes|=v;var ee=A.alternate;ee!==null&&(ee.lanes|=v),Ji(A.return,v,S)}function tv(A,v,S,ee,ce){var pe=A.memoizedState;pe===null?A.memoizedState={isBackwards:v,rendering:null,renderingStartTime:0,last:ee,tail:S,tailMode:ce}:(pe.isBackwards=v,pe.rendering=null,pe.renderingStartTime=0,pe.last=ee,pe.tail=S,pe.tailMode=ce)}function g1(A,v,S){var ee=v.pendingProps,ce=ee.revealOrder,pe=ee.tail;if(Pi(A,v,ee.children,S),ee=Jr.current,(ee&2)!==0)ee=ee&1|2,v.flags|=128;else{if(A!==null&&(A.flags&128)!==0)e:for(A=v.child;A!==null;){if(A.tag===13)A.memoizedState!==null&&x1(A,S,v);else if(A.tag===19)x1(A,S,v);else if(A.child!==null){A.child.return=A,A=A.child;continue}if(A===v)break e;for(;A.sibling===null;){if(A.return===null||A.return===v)break e;A=A.return}A.sibling.return=A.return,A=A.sibling}ee&=1}if(Rr(Jr,ee),(v.mode&1)===0)v.memoizedState=null;else switch(ce){case"forwards":for(S=v.child,ce=null;S!==null;)A=S.alternate,A!==null&&gl(A)===null&&(ce=S),S=S.sibling;S=ce,S===null?(ce=v.child,v.child=null):(ce=S.sibling,S.sibling=null),tv(v,!1,ce,S,pe);break;case"backwards":for(S=null,ce=v.child,v.child=null;ce!==null;){if(A=ce.alternate,A!==null&&gl(A)===null){v.child=ce;break}A=ce.sibling,ce.sibling=S,S=ce,ce=A}tv(v,!0,S,null,pe);break;case"together":tv(v,!1,null,null,void 0);break;default:v.memoizedState=null}return v.child}function Sp(A,v){(v.mode&1)===0&&A!==null&&(A.alternate=null,v.alternate=null,v.flags|=2)}function sd(A,v,S){if(A!==null&&(v.dependencies=A.dependencies),Zu|=v.lanes,(S&v.childLanes)===0)return null;if(A!==null&&v.child!==A.child)throw Error(r(153));if(v.child!==null){for(A=v.child,S=eu(A,A.pendingProps),v.child=S,S.return=v;A.sibling!==null;)A=A.sibling,S=S.sibling=eu(A,A.pendingProps),S.return=v;S.sibling=null}return v.child}function jF(A,v,S){switch(v.tag){case 3:A1(v),nr();break;case 5:gp(v);break;case 1:ni(v.type)&&Jc(v);break;case 4:Vd(v,v.stateNode.containerInfo);break;case 10:var ee=v.type._context,ce=v.memoizedProps.value;Rr(Nn,ee._currentValue),ee._currentValue=ce;break;case 13:if(ee=v.memoizedState,ee!==null)return ee.dehydrated!==null?(Rr(Jr,Jr.current&1),v.flags|=128,null):(S&v.child.childLanes)!==0?p1(A,v,S):(Rr(Jr,Jr.current&1),A=sd(A,v,S),A!==null?A.sibling:null);Rr(Jr,Jr.current&1);break;case 19:if(ee=(S&v.childLanes)!==0,(A.flags&128)!==0){if(ee)return g1(A,v,S);v.flags|=128}if(ce=v.memoizedState,ce!==null&&(ce.rendering=null,ce.tail=null,ce.lastEffect=null),Rr(Jr,Jr.current),ee)break;return null;case 22:case 23:return v.lanes=0,u1(A,v,S)}return sd(A,v,S)}var v1,sv,b1,y1;v1=function(A,v){for(var S=v.child;S!==null;){if(S.tag===5||S.tag===6)A.appendChild(S.stateNode);else if(S.tag!==4&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===v)break;for(;S.sibling===null;){if(S.return===null||S.return===v)return;S=S.return}S.sibling.return=S.return,S=S.sibling}},sv=function(){},b1=function(A,v,S,ee){var ce=A.memoizedProps;if(ce!==ee){A=v.stateNode,Eo(Ii.current);var pe=null;switch(S){case"input":ce=oe(A,ce),ee=oe(A,ee),pe=[];break;case"select":ce=V({},ce,{value:void 0}),ee=V({},ee,{value:void 0}),pe=[];break;case"textarea":ce=Le(A,ce),ee=Le(A,ee),pe=[];break;default:typeof ce.onClick!="function"&&typeof ee.onClick=="function"&&(A.onclick=Od)}xe(S,ee);var We;S=null;for(Vt in ce)if(!ee.hasOwnProperty(Vt)&&ce.hasOwnProperty(Vt)&&ce[Vt]!=null)if(Vt==="style"){var pt=ce[Vt];for(We in pt)pt.hasOwnProperty(We)&&(S||(S={}),S[We]="")}else Vt!=="dangerouslySetInnerHTML"&&Vt!=="children"&&Vt!=="suppressContentEditableWarning"&&Vt!=="suppressHydrationWarning"&&Vt!=="autoFocus"&&(n.hasOwnProperty(Vt)?pe||(pe=[]):(pe=pe||[]).push(Vt,null));for(Vt in ee){var _t=ee[Vt];if(pt=ce!=null?ce[Vt]:void 0,ee.hasOwnProperty(Vt)&&_t!==pt&&(_t!=null||pt!=null))if(Vt==="style")if(pt){for(We in pt)!pt.hasOwnProperty(We)||_t&&_t.hasOwnProperty(We)||(S||(S={}),S[We]="");for(We in _t)_t.hasOwnProperty(We)&&pt[We]!==_t[We]&&(S||(S={}),S[We]=_t[We])}else S||(pe||(pe=[]),pe.push(Vt,S)),S=_t;else Vt==="dangerouslySetInnerHTML"?(_t=_t?_t.__html:void 0,pt=pt?pt.__html:void 0,_t!=null&&pt!==_t&&(pe=pe||[]).push(Vt,_t)):Vt==="children"?typeof _t!="string"&&typeof _t!="number"||(pe=pe||[]).push(Vt,""+_t):Vt!=="suppressContentEditableWarning"&&Vt!=="suppressHydrationWarning"&&(n.hasOwnProperty(Vt)?(_t!=null&&Vt==="onScroll"&&Hr("scroll",A),pe||pt===_t||(pe=[])):(pe=pe||[]).push(Vt,_t))}S&&(pe=pe||[]).push("style",S);var Vt=pe;(v.updateQueue=Vt)&&(v.flags|=4)}},y1=function(A,v,S,ee){S!==ee&&(v.flags|=4)};function bA(A,v){if(!Yt)switch(A.tailMode){case"hidden":v=A.tail;for(var S=null;v!==null;)v.alternate!==null&&(S=v),v=v.sibling;S===null?A.tail=null:S.sibling=null;break;case"collapsed":S=A.tail;for(var ee=null;S!==null;)S.alternate!==null&&(ee=S),S=S.sibling;ee===null?v||A.tail===null?A.tail=null:A.tail.sibling=null:ee.sibling=null}}function li(A){var v=A.alternate!==null&&A.alternate.child===A.child,S=0,ee=0;if(v)for(var ce=A.child;ce!==null;)S|=ce.lanes|ce.childLanes,ee|=ce.subtreeFlags&14680064,ee|=ce.flags&14680064,ce.return=A,ce=ce.sibling;else for(ce=A.child;ce!==null;)S|=ce.lanes|ce.childLanes,ee|=ce.subtreeFlags,ee|=ce.flags,ce.return=A,ce=ce.sibling;return A.subtreeFlags|=ee,A.childLanes=S,v}function NF(A,v,S){var ee=v.pendingProps;switch(kt(v),v.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return li(v),null;case 1:return ni(v.type)&&Wm(),li(v),null;case 3:return ee=v.stateNode,ql(),Dr(ai),Dr(un),xA(),ee.pendingContext&&(ee.context=ee.pendingContext,ee.pendingContext=null),(A===null||A.child===null)&&(Nr(v)?v.flags|=4:A===null||A.memoizedState.isDehydrated&&(v.flags&256)===0||(v.flags|=1024,ts!==null&&(hv(ts),ts=null))),sv(A,v),li(v),null;case 5:fA(v);var ce=Eo(mc.current);if(S=v.type,A!==null&&v.stateNode!=null)b1(A,v,S,ee,ce),A.ref!==v.ref&&(v.flags|=512,v.flags|=2097152);else{if(!ee){if(v.stateNode===null)throw Error(r(166));return li(v),null}if(A=Eo(Ii.current),Nr(v)){ee=v.stateNode,S=v.type;var pe=v.memoizedProps;switch(ee[Ql]=v,ee[Md]=pe,A=(v.mode&1)!==0,S){case"dialog":Hr("cancel",ee),Hr("close",ee);break;case"iframe":case"object":case"embed":Hr("load",ee);break;case"video":case"audio":for(ce=0;ce<oc.length;ce++)Hr(oc[ce],ee);break;case"source":Hr("error",ee);break;case"img":case"image":case"link":Hr("error",ee),Hr("load",ee);break;case"details":Hr("toggle",ee);break;case"input":le(ee,pe),Hr("invalid",ee);break;case"select":ee._wrapperState={wasMultiple:!!pe.multiple},Hr("invalid",ee);break;case"textarea":rt(ee,pe),Hr("invalid",ee)}xe(S,pe),ce=null;for(var We in pe)if(pe.hasOwnProperty(We)){var pt=pe[We];We==="children"?typeof pt=="string"?ee.textContent!==pt&&(pe.suppressHydrationWarning!==!0&&Vm(ee.textContent,pt,A),ce=["children",pt]):typeof pt=="number"&&ee.textContent!==""+pt&&(pe.suppressHydrationWarning!==!0&&Vm(ee.textContent,pt,A),ce=["children",""+pt]):n.hasOwnProperty(We)&&pt!=null&&We==="onScroll"&&Hr("scroll",ee)}switch(S){case"input":ae(ee),we(ee,pe,!0);break;case"textarea":ae(ee),st(ee);break;case"select":case"option":break;default:typeof pe.onClick=="function"&&(ee.onclick=Od)}ee=ce,v.updateQueue=ee,ee!==null&&(v.flags|=4)}else{We=ce.nodeType===9?ce:ce.ownerDocument,A==="http://www.w3.org/1999/xhtml"&&(A=De(S)),A==="http://www.w3.org/1999/xhtml"?S==="script"?(A=We.createElement("div"),A.innerHTML="<script><\/script>",A=A.removeChild(A.firstChild)):typeof ee.is=="string"?A=We.createElement(S,{is:ee.is}):(A=We.createElement(S),S==="select"&&(We=A,ee.multiple?We.multiple=!0:ee.size&&(We.size=ee.size))):A=We.createElementNS(A,S),A[Ql]=v,A[Md]=ee,v1(A,v,!1,!1),v.stateNode=A;e:{switch(We=ye(S,ee),S){case"dialog":Hr("cancel",A),Hr("close",A),ce=ee;break;case"iframe":case"object":case"embed":Hr("load",A),ce=ee;break;case"video":case"audio":for(ce=0;ce<oc.length;ce++)Hr(oc[ce],A);ce=ee;break;case"source":Hr("error",A),ce=ee;break;case"img":case"image":case"link":Hr("error",A),Hr("load",A),ce=ee;break;case"details":Hr("toggle",A),ce=ee;break;case"input":le(A,ee),ce=oe(A,ee),Hr("invalid",A);break;case"option":ce=ee;break;case"select":A._wrapperState={wasMultiple:!!ee.multiple},ce=V({},ee,{value:void 0}),Hr("invalid",A);break;case"textarea":rt(A,ee),ce=Le(A,ee),Hr("invalid",A);break;default:ce=ee}xe(S,ce),pt=ce;for(pe in pt)if(pt.hasOwnProperty(pe)){var _t=pt[pe];pe==="style"?Ke(A,_t):pe==="dangerouslySetInnerHTML"?(_t=_t?_t.__html:void 0,_t!=null&&Pe(A,_t)):pe==="children"?typeof _t=="string"?(S!=="textarea"||_t!=="")&&fe(A,_t):typeof _t=="number"&&fe(A,""+_t):pe!=="suppressContentEditableWarning"&&pe!=="suppressHydrationWarning"&&pe!=="autoFocus"&&(n.hasOwnProperty(pe)?_t!=null&&pe==="onScroll"&&Hr("scroll",A):_t!=null&&N(A,pe,_t,We))}switch(S){case"input":ae(A),we(A,ee,!1);break;case"textarea":ae(A),st(A);break;case"option":ee.value!=null&&A.setAttribute("value",""+J(ee.value));break;case"select":A.multiple=!!ee.multiple,pe=ee.value,pe!=null?Fe(A,!!ee.multiple,pe,!1):ee.defaultValue!=null&&Fe(A,!!ee.multiple,ee.defaultValue,!0);break;default:typeof ce.onClick=="function"&&(A.onclick=Od)}switch(S){case"button":case"input":case"select":case"textarea":ee=!!ee.autoFocus;break e;case"img":ee=!0;break e;default:ee=!1}}ee&&(v.flags|=4)}v.ref!==null&&(v.flags|=512,v.flags|=2097152)}return li(v),null;case 6:if(A&&v.stateNode!=null)y1(A,v,A.memoizedProps,ee);else{if(typeof ee!="string"&&v.stateNode===null)throw Error(r(166));if(S=Eo(mc.current),Eo(Ii.current),Nr(v)){if(ee=v.stateNode,S=v.memoizedProps,ee[Ql]=v,(pe=ee.nodeValue!==S)&&(A=Et,A!==null))switch(A.tag){case 3:Vm(ee.nodeValue,S,(A.mode&1)!==0);break;case 5:A.memoizedProps.suppressHydrationWarning!==!0&&Vm(ee.nodeValue,S,(A.mode&1)!==0)}pe&&(v.flags|=4)}else ee=(S.nodeType===9?S:S.ownerDocument).createTextNode(ee),ee[Ql]=v,v.stateNode=ee}return li(v),null;case 13:if(Dr(Jr),ee=v.memoizedState,A===null||A.memoizedState!==null&&A.memoizedState.dehydrated!==null){if(Yt&&Xt!==null&&(v.mode&1)!==0&&(v.flags&128)===0)gr(),nr(),v.flags|=98560,pe=!1;else if(pe=Nr(v),ee!==null&&ee.dehydrated!==null){if(A===null){if(!pe)throw Error(r(318));if(pe=v.memoizedState,pe=pe!==null?pe.dehydrated:null,!pe)throw Error(r(317));pe[Ql]=v}else nr(),(v.flags&128)===0&&(v.memoizedState=null),v.flags|=4;li(v),pe=!1}else ts!==null&&(hv(ts),ts=null),pe=!0;if(!pe)return v.flags&65536?v:null}return(v.flags&128)!==0?(v.lanes=S,v):(ee=ee!==null,ee!==(A!==null&&A.memoizedState!==null)&&ee&&(v.child.flags|=8192,(v.mode&1)!==0&&(A===null||(Jr.current&1)!==0?hn===0&&(hn=3):pv())),v.updateQueue!==null&&(v.flags|=4),li(v),null);case 4:return ql(),sv(A,v),A===null&&Gc(v.stateNode.containerInfo),li(v),null;case 10:return ii(v.type._context),li(v),null;case 17:return ni(v.type)&&Wm(),li(v),null;case 19:if(Dr(Jr),pe=v.memoizedState,pe===null)return li(v),null;if(ee=(v.flags&128)!==0,We=pe.rendering,We===null)if(ee)bA(pe,!1);else{if(hn!==0||A!==null&&(A.flags&128)!==0)for(A=v.child;A!==null;){if(We=gl(A),We!==null){for(v.flags|=128,bA(pe,!1),ee=We.updateQueue,ee!==null&&(v.updateQueue=ee,v.flags|=4),v.subtreeFlags=0,ee=S,S=v.child;S!==null;)pe=S,A=ee,pe.flags&=14680066,We=pe.alternate,We===null?(pe.childLanes=0,pe.lanes=A,pe.child=null,pe.subtreeFlags=0,pe.memoizedProps=null,pe.memoizedState=null,pe.updateQueue=null,pe.dependencies=null,pe.stateNode=null):(pe.childLanes=We.childLanes,pe.lanes=We.lanes,pe.child=We.child,pe.subtreeFlags=0,pe.deletions=null,pe.memoizedProps=We.memoizedProps,pe.memoizedState=We.memoizedState,pe.updateQueue=We.updateQueue,pe.type=We.type,A=We.dependencies,pe.dependencies=A===null?null:{lanes:A.lanes,firstContext:A.firstContext}),S=S.sibling;return Rr(Jr,Jr.current&1|2),v.child}A=A.sibling}pe.tail!==null&&es()>ih&&(v.flags|=128,ee=!0,bA(pe,!1),v.lanes=4194304)}else{if(!ee)if(A=gl(We),A!==null){if(v.flags|=128,ee=!0,S=A.updateQueue,S!==null&&(v.updateQueue=S,v.flags|=4),bA(pe,!0),pe.tail===null&&pe.tailMode==="hidden"&&!We.alternate&&!Yt)return li(v),null}else 2*es()-pe.renderingStartTime>ih&&S!==1073741824&&(v.flags|=128,ee=!0,bA(pe,!1),v.lanes=4194304);pe.isBackwards?(We.sibling=v.child,v.child=We):(S=pe.last,S!==null?S.sibling=We:v.child=We,pe.last=We)}return pe.tail!==null?(v=pe.tail,pe.rendering=v,pe.tail=v.sibling,pe.renderingStartTime=es(),v.sibling=null,S=Jr.current,Rr(Jr,ee?S&1|2:S&1),v):(li(v),null);case 22:case 23:return fv(),ee=v.memoizedState!==null,A!==null&&A.memoizedState!==null!==ee&&(v.flags|=8192),ee&&(v.mode&1)!==0?(yl&1073741824)!==0&&(li(v),v.subtreeFlags&6&&(v.flags|=8192)):li(v),null;case 24:return null;case 25:return null}throw Error(r(156,v.tag))}function wF(A,v){switch(kt(v),v.tag){case 1:return ni(v.type)&&Wm(),A=v.flags,A&65536?(v.flags=A&-65537|128,v):null;case 3:return ql(),Dr(ai),Dr(un),xA(),A=v.flags,(A&65536)!==0&&(A&128)===0?(v.flags=A&-65537|128,v):null;case 5:return fA(v),null;case 13:if(Dr(Jr),A=v.memoizedState,A!==null&&A.dehydrated!==null){if(v.alternate===null)throw Error(r(340));nr()}return A=v.flags,A&65536?(v.flags=A&-65537|128,v):null;case 19:return Dr(Jr),null;case 4:return ql(),null;case 10:return ii(v.type._context),null;case 22:case 23:return fv(),null;case 24:return null;default:return null}}var Cp=!1,oi=!1,_F=typeof WeakSet=="function"?WeakSet:Set,Es=null;function ah(A,v){var S=A.ref;if(S!==null)if(typeof S=="function")try{S(null)}catch(ee){Fa(A,v,ee)}else S.current=null}function rv(A,v,S){try{S()}catch(ee){Fa(A,v,ee)}}var j1=!1;function SF(A,v){if(Gu=po,A=Mu(),qc(A)){if("selectionStart"in A)var S={start:A.selectionStart,end:A.selectionEnd};else e:{S=(S=A.ownerDocument)&&S.defaultView||window;var ee=S.getSelection&&S.getSelection();if(ee&&ee.rangeCount!==0){S=ee.anchorNode;var ce=ee.anchorOffset,pe=ee.focusNode;ee=ee.focusOffset;try{S.nodeType,pe.nodeType}catch{S=null;break e}var We=0,pt=-1,_t=-1,Vt=0,us=0,As=A,ds=null;t:for(;;){for(var Cs;As!==S||ce!==0&&As.nodeType!==3||(pt=We+ce),As!==pe||ee!==0&&As.nodeType!==3||(_t=We+ee),As.nodeType===3&&(We+=As.nodeValue.length),(Cs=As.firstChild)!==null;)ds=As,As=Cs;for(;;){if(As===A)break t;if(ds===S&&++Vt===ce&&(pt=We),ds===pe&&++us===ee&&(_t=We),(Cs=As.nextSibling)!==null)break;As=ds,ds=As.parentNode}As=Cs}S=pt===-1||_t===-1?null:{start:pt,end:_t}}else S=null}S=S||{start:0,end:0}}else S=null;for(zc={focusedElem:A,selectionRange:S},po=!1,Es=v;Es!==null;)if(v=Es,A=v.child,(v.subtreeFlags&1028)!==0&&A!==null)A.return=v,Es=A;else for(;Es!==null;){v=Es;try{var Fs=v.alternate;if((v.flags&1024)!==0)switch(v.tag){case 0:case 11:case 15:break;case 1:if(Fs!==null){var Ds=Fs.memoizedProps,Ha=Fs.memoizedState,Ot=v.stateNode,Bt=Ot.getSnapshotBeforeUpdate(v.elementType===v.type?Ds:To(v.type,Ds),Ha);Ot.__reactInternalSnapshotBeforeUpdate=Bt}break;case 3:var Qt=v.stateNode.containerInfo;Qt.nodeType===1?Qt.textContent="":Qt.nodeType===9&&Qt.documentElement&&Qt.removeChild(Qt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(xs){Fa(v,v.return,xs)}if(A=v.sibling,A!==null){A.return=v.return,Es=A;break}Es=v.return}return Fs=j1,j1=!1,Fs}function yA(A,v,S){var ee=v.updateQueue;if(ee=ee!==null?ee.lastEffect:null,ee!==null){var ce=ee=ee.next;do{if((ce.tag&A)===A){var pe=ce.destroy;ce.destroy=void 0,pe!==void 0&&rv(v,S,pe)}ce=ce.next}while(ce!==ee)}}function kp(A,v){if(v=v.updateQueue,v=v!==null?v.lastEffect:null,v!==null){var S=v=v.next;do{if((S.tag&A)===A){var ee=S.create;S.destroy=ee()}S=S.next}while(S!==v)}}function av(A){var v=A.ref;if(v!==null){var S=A.stateNode;switch(A.tag){case 5:A=S;break;default:A=S}typeof v=="function"?v(A):v.current=A}}function N1(A){var v=A.alternate;v!==null&&(A.alternate=null,N1(v)),A.child=null,A.deletions=null,A.sibling=null,A.tag===5&&(v=A.stateNode,v!==null&&(delete v[Ql],delete v[Md],delete v[ri],delete v[Hg],delete v[qg])),A.stateNode=null,A.return=null,A.dependencies=null,A.memoizedProps=null,A.memoizedState=null,A.pendingProps=null,A.stateNode=null,A.updateQueue=null}function w1(A){return A.tag===5||A.tag===3||A.tag===4}function _1(A){e:for(;;){for(;A.sibling===null;){if(A.return===null||w1(A.return))return null;A=A.return}for(A.sibling.return=A.return,A=A.sibling;A.tag!==5&&A.tag!==6&&A.tag!==18;){if(A.flags&2||A.child===null||A.tag===4)continue e;A.child.return=A,A=A.child}if(!(A.flags&2))return A.stateNode}}function nv(A,v,S){var ee=A.tag;if(ee===5||ee===6)A=A.stateNode,v?S.nodeType===8?S.parentNode.insertBefore(A,v):S.insertBefore(A,v):(S.nodeType===8?(v=S.parentNode,v.insertBefore(A,S)):(v=S,v.appendChild(A)),S=S._reactRootContainer,S!=null||v.onclick!==null||(v.onclick=Od));else if(ee!==4&&(A=A.child,A!==null))for(nv(A,v,S),A=A.sibling;A!==null;)nv(A,v,S),A=A.sibling}function iv(A,v,S){var ee=A.tag;if(ee===5||ee===6)A=A.stateNode,v?S.insertBefore(A,v):S.appendChild(A);else if(ee!==4&&(A=A.child,A!==null))for(iv(A,v,S),A=A.sibling;A!==null;)iv(A,v,S),A=A.sibling}var Hn=null,Io=!1;function zd(A,v,S){for(S=S.child;S!==null;)S1(A,v,S),S=S.sibling}function S1(A,v,S){if(mr&&typeof mr.onCommitFiberUnmount=="function")try{mr.onCommitFiberUnmount(br,S)}catch{}switch(S.tag){case 5:oi||ah(S,v);case 6:var ee=Hn,ce=Io;Hn=null,zd(A,v,S),Hn=ee,Io=ce,Hn!==null&&(Io?(A=Hn,S=S.stateNode,A.nodeType===8?A.parentNode.removeChild(S):A.removeChild(S)):Hn.removeChild(S.stateNode));break;case 18:Hn!==null&&(Io?(A=Hn,S=S.stateNode,A.nodeType===8?uA(A.parentNode,S):A.nodeType===1&&uA(A,S),Dn(A)):uA(Hn,S.stateNode));break;case 4:ee=Hn,ce=Io,Hn=S.stateNode.containerInfo,Io=!0,zd(A,v,S),Hn=ee,Io=ce;break;case 0:case 11:case 14:case 15:if(!oi&&(ee=S.updateQueue,ee!==null&&(ee=ee.lastEffect,ee!==null))){ce=ee=ee.next;do{var pe=ce,We=pe.destroy;pe=pe.tag,We!==void 0&&((pe&2)!==0||(pe&4)!==0)&&rv(S,v,We),ce=ce.next}while(ce!==ee)}zd(A,v,S);break;case 1:if(!oi&&(ah(S,v),ee=S.stateNode,typeof ee.componentWillUnmount=="function"))try{ee.props=S.memoizedProps,ee.state=S.memoizedState,ee.componentWillUnmount()}catch(pt){Fa(S,v,pt)}zd(A,v,S);break;case 21:zd(A,v,S);break;case 22:S.mode&1?(oi=(ee=oi)||S.memoizedState!==null,zd(A,v,S),oi=ee):zd(A,v,S);break;default:zd(A,v,S)}}function C1(A){var v=A.updateQueue;if(v!==null){A.updateQueue=null;var S=A.stateNode;S===null&&(S=A.stateNode=new _F),v.forEach(function(ee){var ce=DF.bind(null,A,ee);S.has(ee)||(S.add(ee),ee.then(ce,ce))})}}function Lo(A,v){var S=v.deletions;if(S!==null)for(var ee=0;ee<S.length;ee++){var ce=S[ee];try{var pe=A,We=v,pt=We;e:for(;pt!==null;){switch(pt.tag){case 5:Hn=pt.stateNode,Io=!1;break e;case 3:Hn=pt.stateNode.containerInfo,Io=!0;break e;case 4:Hn=pt.stateNode.containerInfo,Io=!0;break e}pt=pt.return}if(Hn===null)throw Error(r(160));S1(pe,We,ce),Hn=null,Io=!1;var _t=ce.alternate;_t!==null&&(_t.return=null),ce.return=null}catch(Vt){Fa(ce,v,Vt)}}if(v.subtreeFlags&12854)for(v=v.child;v!==null;)k1(v,A),v=v.sibling}function k1(A,v){var S=A.alternate,ee=A.flags;switch(A.tag){case 0:case 11:case 14:case 15:if(Lo(v,A),Ac(A),ee&4){try{yA(3,A,A.return),kp(3,A)}catch(Ds){Fa(A,A.return,Ds)}try{yA(5,A,A.return)}catch(Ds){Fa(A,A.return,Ds)}}break;case 1:Lo(v,A),Ac(A),ee&512&&S!==null&&ah(S,S.return);break;case 5:if(Lo(v,A),Ac(A),ee&512&&S!==null&&ah(S,S.return),A.flags&32){var ce=A.stateNode;try{fe(ce,"")}catch(Ds){Fa(A,A.return,Ds)}}if(ee&4&&(ce=A.stateNode,ce!=null)){var pe=A.memoizedProps,We=S!==null?S.memoizedProps:pe,pt=A.type,_t=A.updateQueue;if(A.updateQueue=null,_t!==null)try{pt==="input"&&pe.type==="radio"&&pe.name!=null&&X(ce,pe),ye(pt,We);var Vt=ye(pt,pe);for(We=0;We<_t.length;We+=2){var us=_t[We],As=_t[We+1];us==="style"?Ke(ce,As):us==="dangerouslySetInnerHTML"?Pe(ce,As):us==="children"?fe(ce,As):N(ce,us,As,Vt)}switch(pt){case"input":me(ce,pe);break;case"textarea":He(ce,pe);break;case"select":var ds=ce._wrapperState.wasMultiple;ce._wrapperState.wasMultiple=!!pe.multiple;var Cs=pe.value;Cs!=null?Fe(ce,!!pe.multiple,Cs,!1):ds!==!!pe.multiple&&(pe.defaultValue!=null?Fe(ce,!!pe.multiple,pe.defaultValue,!0):Fe(ce,!!pe.multiple,pe.multiple?[]:"",!1))}ce[Md]=pe}catch(Ds){Fa(A,A.return,Ds)}}break;case 6:if(Lo(v,A),Ac(A),ee&4){if(A.stateNode===null)throw Error(r(162));ce=A.stateNode,pe=A.memoizedProps;try{ce.nodeValue=pe}catch(Ds){Fa(A,A.return,Ds)}}break;case 3:if(Lo(v,A),Ac(A),ee&4&&S!==null&&S.memoizedState.isDehydrated)try{Dn(v.containerInfo)}catch(Ds){Fa(A,A.return,Ds)}break;case 4:Lo(v,A),Ac(A);break;case 13:Lo(v,A),Ac(A),ce=A.child,ce.flags&8192&&(pe=ce.memoizedState!==null,ce.stateNode.isHidden=pe,!pe||ce.alternate!==null&&ce.alternate.memoizedState!==null||(cv=es())),ee&4&&C1(A);break;case 22:if(us=S!==null&&S.memoizedState!==null,A.mode&1?(oi=(Vt=oi)||us,Lo(v,A),oi=Vt):Lo(v,A),Ac(A),ee&8192){if(Vt=A.memoizedState!==null,(A.stateNode.isHidden=Vt)&&!us&&(A.mode&1)!==0)for(Es=A,us=A.child;us!==null;){for(As=Es=us;Es!==null;){switch(ds=Es,Cs=ds.child,ds.tag){case 0:case 11:case 14:case 15:yA(4,ds,ds.return);break;case 1:ah(ds,ds.return);var Fs=ds.stateNode;if(typeof Fs.componentWillUnmount=="function"){ee=ds,S=ds.return;try{v=ee,Fs.props=v.memoizedProps,Fs.state=v.memoizedState,Fs.componentWillUnmount()}catch(Ds){Fa(ee,S,Ds)}}break;case 5:ah(ds,ds.return);break;case 22:if(ds.memoizedState!==null){F1(As);continue}}Cs!==null?(Cs.return=ds,Es=Cs):F1(As)}us=us.sibling}e:for(us=null,As=A;;){if(As.tag===5){if(us===null){us=As;try{ce=As.stateNode,Vt?(pe=ce.style,typeof pe.setProperty=="function"?pe.setProperty("display","none","important"):pe.display="none"):(pt=As.stateNode,_t=As.memoizedProps.style,We=_t!=null&&_t.hasOwnProperty("display")?_t.display:null,pt.style.display=Ye("display",We))}catch(Ds){Fa(A,A.return,Ds)}}}else if(As.tag===6){if(us===null)try{As.stateNode.nodeValue=Vt?"":As.memoizedProps}catch(Ds){Fa(A,A.return,Ds)}}else if((As.tag!==22&&As.tag!==23||As.memoizedState===null||As===A)&&As.child!==null){As.child.return=As,As=As.child;continue}if(As===A)break e;for(;As.sibling===null;){if(As.return===null||As.return===A)break e;us===As&&(us=null),As=As.return}us===As&&(us=null),As.sibling.return=As.return,As=As.sibling}}break;case 19:Lo(v,A),Ac(A),ee&4&&C1(A);break;case 21:break;default:Lo(v,A),Ac(A)}}function Ac(A){var v=A.flags;if(v&2){try{e:{for(var S=A.return;S!==null;){if(w1(S)){var ee=S;break e}S=S.return}throw Error(r(160))}switch(ee.tag){case 5:var ce=ee.stateNode;ee.flags&32&&(fe(ce,""),ee.flags&=-33);var pe=_1(A);iv(A,pe,ce);break;case 3:case 4:var We=ee.stateNode.containerInfo,pt=_1(A);nv(A,pt,We);break;default:throw Error(r(161))}}catch(_t){Fa(A,A.return,_t)}A.flags&=-3}v&4096&&(A.flags&=-4097)}function CF(A,v,S){Es=A,E1(A)}function E1(A,v,S){for(var ee=(A.mode&1)!==0;Es!==null;){var ce=Es,pe=ce.child;if(ce.tag===22&&ee){var We=ce.memoizedState!==null||Cp;if(!We){var pt=ce.alternate,_t=pt!==null&&pt.memoizedState!==null||oi;pt=Cp;var Vt=oi;if(Cp=We,(oi=_t)&&!Vt)for(Es=ce;Es!==null;)We=Es,_t=We.child,We.tag===22&&We.memoizedState!==null?T1(ce):_t!==null?(_t.return=We,Es=_t):T1(ce);for(;pe!==null;)Es=pe,E1(pe),pe=pe.sibling;Es=ce,Cp=pt,oi=Vt}B1(A)}else(ce.subtreeFlags&8772)!==0&&pe!==null?(pe.return=ce,Es=pe):B1(A)}}function B1(A){for(;Es!==null;){var v=Es;if((v.flags&8772)!==0){var S=v.alternate;try{if((v.flags&8772)!==0)switch(v.tag){case 0:case 11:case 15:oi||kp(5,v);break;case 1:var ee=v.stateNode;if(v.flags&4&&!oi)if(S===null)ee.componentDidMount();else{var ce=v.elementType===v.type?S.memoizedProps:To(v.type,S.memoizedProps);ee.componentDidUpdate(ce,S.memoizedState,ee.__reactInternalSnapshotBeforeUpdate)}var pe=v.updateQueue;pe!==null&&ed(v,pe,ee);break;case 3:var We=v.updateQueue;if(We!==null){if(S=null,v.child!==null)switch(v.child.tag){case 5:S=v.child.stateNode;break;case 1:S=v.child.stateNode}ed(v,We,S)}break;case 5:var pt=v.stateNode;if(S===null&&v.flags&4){S=pt;var _t=v.memoizedProps;switch(v.type){case"button":case"input":case"select":case"textarea":_t.autoFocus&&S.focus();break;case"img":_t.src&&(S.src=_t.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(v.memoizedState===null){var Vt=v.alternate;if(Vt!==null){var us=Vt.memoizedState;if(us!==null){var As=us.dehydrated;As!==null&&Dn(As)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}oi||v.flags&512&&av(v)}catch(ds){Fa(v,v.return,ds)}}if(v===A){Es=null;break}if(S=v.sibling,S!==null){S.return=v.return,Es=S;break}Es=v.return}}function F1(A){for(;Es!==null;){var v=Es;if(v===A){Es=null;break}var S=v.sibling;if(S!==null){S.return=v.return,Es=S;break}Es=v.return}}function T1(A){for(;Es!==null;){var v=Es;try{switch(v.tag){case 0:case 11:case 15:var S=v.return;try{kp(4,v)}catch(_t){Fa(v,S,_t)}break;case 1:var ee=v.stateNode;if(typeof ee.componentDidMount=="function"){var ce=v.return;try{ee.componentDidMount()}catch(_t){Fa(v,ce,_t)}}var pe=v.return;try{av(v)}catch(_t){Fa(v,pe,_t)}break;case 5:var We=v.return;try{av(v)}catch(_t){Fa(v,We,_t)}}}catch(_t){Fa(v,v.return,_t)}if(v===A){Es=null;break}var pt=v.sibling;if(pt!==null){pt.return=v.return,Es=pt;break}Es=v.return}}var kF=Math.ceil,Ep=_.ReactCurrentDispatcher,lv=_.ReactCurrentOwner,Wl=_.ReactCurrentBatchConfig,_r=0,_n=null,sn=null,qn=0,yl=0,nh=xl(0),hn=0,jA=null,Zu=0,Bp=0,ov=0,NA=null,rl=null,cv=0,ih=1/0,rd=null,Fp=!1,dv=null,Yd=null,Tp=!1,Xd=null,Ip=0,wA=0,uv=null,Lp=-1,Dp=0;function Ui(){return(_r&6)!==0?es():Lp!==-1?Lp:Lp=es()}function Jd(A){return(A.mode&1)===0?1:(_r&2)!==0&&qn!==0?qn&-qn:Or.transition!==null?(Dp===0&&(Dp=Jo()),Dp):(A=hr,A!==0||(A=window.event,A=A===void 0?16:Lt(A.type)),A)}function Do(A,v,S,ee){if(50<wA)throw wA=0,uv=null,Error(r(185));xn(A,S,ee),((_r&2)===0||A!==_n)&&(A===_n&&((_r&2)===0&&(Bp|=S),hn===4&&Zd(A,qn)),al(A,ee),S===1&&_r===0&&(v.mode&1)===0&&(ih=es()+500,zu&&ve()))}function al(A,v){var S=A.callbackNode;Pa(A,v);var ee=va(A,A===_n?qn:0);if(ee===0)S!==null&&Jt(S),A.callbackNode=null,A.callbackPriority=0;else if(v=ee&-ee,A.callbackPriority!==v){if(S!=null&&Jt(S),v===1)A.tag===0?de(L1.bind(null,A)):re(L1.bind(null,A)),Mg(function(){(_r&6)===0&&ve()}),S=null;else{switch(Ll(ee)){case 1:S=Zs;break;case 4:S=Xs;break;case 16:S=Hs;break;case 536870912:S=Ln;break;default:S=Hs}S=H1(S,I1.bind(null,A))}A.callbackPriority=v,A.callbackNode=S}}function I1(A,v){if(Lp=-1,Dp=0,(_r&6)!==0)throw Error(r(327));var S=A.callbackNode;if(lh()&&A.callbackNode!==S)return null;var ee=va(A,A===_n?qn:0);if(ee===0)return null;if((ee&30)!==0||(ee&A.expiredLanes)!==0||v)v=Pp(A,ee);else{v=ee;var ce=_r;_r|=2;var pe=P1();(_n!==A||qn!==v)&&(rd=null,ih=es()+500,tm(A,v));do try{FF();break}catch(pt){D1(A,pt)}while(!0);mn(),Ep.current=pe,_r=ce,sn!==null?v=0:(_n=null,qn=0,v=hn)}if(v!==0){if(v===2&&(ce=co(A),ce!==0&&(ee=ce,v=mv(A,ce))),v===1)throw S=jA,tm(A,0),Zd(A,ee),al(A,es()),S;if(v===6)Zd(A,ee);else{if(ce=A.current.alternate,(ee&30)===0&&!EF(ce)&&(v=Pp(A,ee),v===2&&(pe=co(A),pe!==0&&(ee=pe,v=mv(A,pe))),v===1))throw S=jA,tm(A,0),Zd(A,ee),al(A,es()),S;switch(A.finishedWork=ce,A.finishedLanes=ee,v){case 0:case 1:throw Error(r(345));case 2:sm(A,rl,rd);break;case 3:if(Zd(A,ee),(ee&130023424)===ee&&(v=cv+500-es(),10<v)){if(va(A,0)!==0)break;if(ce=A.suspendedLanes,(ce&ee)!==ee){Ui(),A.pingedLanes|=A.suspendedLanes&ce;break}A.timeoutHandle=dA(sm.bind(null,A,rl,rd),v);break}sm(A,rl,rd);break;case 4:if(Zd(A,ee),(ee&4194240)===ee)break;for(v=A.eventTimes,ce=-1;0<ee;){var We=31-Tr(ee);pe=1<<We,We=v[We],We>ce&&(ce=We),ee&=~pe}if(ee=ce,ee=es()-ee,ee=(120>ee?120:480>ee?480:1080>ee?1080:1920>ee?1920:3e3>ee?3e3:4320>ee?4320:1960*kF(ee/1960))-ee,10<ee){A.timeoutHandle=dA(sm.bind(null,A,rl,rd),ee);break}sm(A,rl,rd);break;case 5:sm(A,rl,rd);break;default:throw Error(r(329))}}}return al(A,es()),A.callbackNode===S?I1.bind(null,A):null}function mv(A,v){var S=NA;return A.current.memoizedState.isDehydrated&&(tm(A,v).flags|=256),A=Pp(A,v),A!==2&&(v=rl,rl=S,v!==null&&hv(v)),A}function hv(A){rl===null?rl=A:rl.push.apply(rl,A)}function EF(A){for(var v=A;;){if(v.flags&16384){var S=v.updateQueue;if(S!==null&&(S=S.stores,S!==null))for(var ee=0;ee<S.length;ee++){var ce=S[ee],pe=ce.getSnapshot;ce=ce.value;try{if(!wr(pe(),ce))return!1}catch{return!1}}}if(S=v.child,v.subtreeFlags&16384&&S!==null)S.return=v,v=S;else{if(v===A)break;for(;v.sibling===null;){if(v.return===null||v.return===A)return!0;v=v.return}v.sibling.return=v.return,v=v.sibling}}return!0}function Zd(A,v){for(v&=~ov,v&=~Bp,A.suspendedLanes|=v,A.pingedLanes&=~v,A=A.expirationTimes;0<v;){var S=31-Tr(v),ee=1<<S;A[S]=-1,v&=~ee}}function L1(A){if((_r&6)!==0)throw Error(r(327));lh();var v=va(A,0);if((v&1)===0)return al(A,es()),null;var S=Pp(A,v);if(A.tag!==0&&S===2){var ee=co(A);ee!==0&&(v=ee,S=mv(A,ee))}if(S===1)throw S=jA,tm(A,0),Zd(A,v),al(A,es()),S;if(S===6)throw Error(r(345));return A.finishedWork=A.current.alternate,A.finishedLanes=v,sm(A,rl,rd),al(A,es()),null}function Av(A,v){var S=_r;_r|=1;try{return A(v)}finally{_r=S,_r===0&&(ih=es()+500,zu&&ve())}}function em(A){Xd!==null&&Xd.tag===0&&(_r&6)===0&&lh();var v=_r;_r|=1;var S=Wl.transition,ee=hr;try{if(Wl.transition=null,hr=1,A)return A()}finally{hr=ee,Wl.transition=S,_r=v,(_r&6)===0&&ve()}}function fv(){yl=nh.current,Dr(nh)}function tm(A,v){A.finishedWork=null,A.finishedLanes=0;var S=A.timeoutHandle;if(S!==-1&&(A.timeoutHandle=-1,Ap(S)),sn!==null)for(S=sn.return;S!==null;){var ee=S;switch(kt(ee),ee.tag){case 1:ee=ee.type.childContextTypes,ee!=null&&Wm();break;case 3:ql(),Dr(ai),Dr(un),xA();break;case 5:fA(ee);break;case 4:ql();break;case 13:Dr(Jr);break;case 19:Dr(Jr);break;case 10:ii(ee.type._context);break;case 22:case 23:fv()}S=S.return}if(_n=A,sn=A=eu(A.current,null),qn=yl=v,hn=0,jA=null,ov=Bp=Zu=0,rl=NA=null,Ti!==null){for(v=0;v<Ti.length;v++)if(S=Ti[v],ee=S.interleaved,ee!==null){S.interleaved=null;var ce=ee.next,pe=S.pending;if(pe!==null){var We=pe.next;pe.next=ce,ee.next=We}S.pending=ee}Ti=null}return A}function D1(A,v){do{var S=sn;try{if(mn(),Km.current=Np,Wd){for(var ee=sa.memoizedState;ee!==null;){var ce=ee.queue;ce!==null&&(ce.pending=null),ee=ee.next}Wd=!1}if($l=0,ja=Ba=sa=null,Bo=!1,Gd=0,lv.current=null,S===null||S.return===null){hn=1,jA=v,sn=null;break}e:{var pe=A,We=S.return,pt=S,_t=v;if(v=qn,pt.flags|=32768,_t!==null&&typeof _t=="object"&&typeof _t.then=="function"){var Vt=_t,us=pt,As=us.tag;if((us.mode&1)===0&&(As===0||As===11||As===15)){var ds=us.alternate;ds?(us.updateQueue=ds.updateQueue,us.memoizedState=ds.memoizedState,us.lanes=ds.lanes):(us.updateQueue=null,us.memoizedState=null)}var Cs=i1(We);if(Cs!==null){Cs.flags&=-257,l1(Cs,We,pt,pe,v),Cs.mode&1&&n1(pe,Vt,v),v=Cs,_t=Vt;var Fs=v.updateQueue;if(Fs===null){var Ds=new Set;Ds.add(_t),v.updateQueue=Ds}else Fs.add(_t);break e}else{if((v&1)===0){n1(pe,Vt,v),pv();break e}_t=Error(r(426))}}else if(Yt&&pt.mode&1){var Ha=i1(We);if(Ha!==null){(Ha.flags&65536)===0&&(Ha.flags|=256),l1(Ha,We,pt,pe,v),Pr(rh(_t,pt));break e}}pe=_t=rh(_t,pt),hn!==4&&(hn=2),NA===null?NA=[pe]:NA.push(pe),pe=We;do{switch(pe.tag){case 3:pe.flags|=65536,v&=-v,pe.lanes|=v;var Ot=r1(pe,_t,v);tl(pe,Ot);break e;case 1:pt=_t;var Bt=pe.type,Qt=pe.stateNode;if((pe.flags&128)===0&&(typeof Bt.getDerivedStateFromError=="function"||Qt!==null&&typeof Qt.componentDidCatch=="function"&&(Yd===null||!Yd.has(Qt)))){pe.flags|=65536,v&=-v,pe.lanes|=v;var xs=a1(pe,pt,v);tl(pe,xs);break e}}pe=pe.return}while(pe!==null)}R1(S)}catch(Us){v=Us,sn===S&&S!==null&&(sn=S=S.return);continue}break}while(!0)}function P1(){var A=Ep.current;return Ep.current=Np,A===null?Np:A}function pv(){(hn===0||hn===3||hn===2)&&(hn=4),_n===null||(Zu&268435455)===0&&(Bp&268435455)===0||Zd(_n,qn)}function Pp(A,v){var S=_r;_r|=2;var ee=P1();(_n!==A||qn!==v)&&(rd=null,tm(A,v));do try{BF();break}catch(ce){D1(A,ce)}while(!0);if(mn(),_r=S,Ep.current=ee,sn!==null)throw Error(r(261));return _n=null,qn=0,hn}function BF(){for(;sn!==null;)U1(sn)}function FF(){for(;sn!==null&&!Gt();)U1(sn)}function U1(A){var v=Q1(A.alternate,A,yl);A.memoizedProps=A.pendingProps,v===null?R1(A):sn=v,lv.current=null}function R1(A){var v=A;do{var S=v.alternate;if(A=v.return,(v.flags&32768)===0){if(S=NF(S,v,yl),S!==null){sn=S;return}}else{if(S=wF(S,v),S!==null){S.flags&=32767,sn=S;return}if(A!==null)A.flags|=32768,A.subtreeFlags=0,A.deletions=null;else{hn=6,sn=null;return}}if(v=v.sibling,v!==null){sn=v;return}sn=v=A}while(v!==null);hn===0&&(hn=5)}function sm(A,v,S){var ee=hr,ce=Wl.transition;try{Wl.transition=null,hr=1,TF(A,v,S,ee)}finally{Wl.transition=ce,hr=ee}return null}function TF(A,v,S,ee){do lh();while(Xd!==null);if((_r&6)!==0)throw Error(r(327));S=A.finishedWork;var ce=A.finishedLanes;if(S===null)return null;if(A.finishedWork=null,A.finishedLanes=0,S===A.current)throw Error(r(177));A.callbackNode=null,A.callbackPriority=0;var pe=S.lanes|S.childLanes;if(Pc(A,pe),A===_n&&(sn=_n=null,qn=0),(S.subtreeFlags&2064)===0&&(S.flags&2064)===0||Tp||(Tp=!0,H1(Hs,function(){return lh(),null})),pe=(S.flags&15990)!==0,(S.subtreeFlags&15990)!==0||pe){pe=Wl.transition,Wl.transition=null;var We=hr;hr=1;var pt=_r;_r|=4,lv.current=null,SF(A,S),k1(S,A),$c(zc),po=!!Gu,zc=Gu=null,A.current=S,CF(S),Ht(),_r=pt,hr=We,Wl.transition=pe}else A.current=S;if(Tp&&(Tp=!1,Xd=A,Ip=ce),pe=A.pendingLanes,pe===0&&(Yd=null),Ja(S.stateNode),al(A,es()),v!==null)for(ee=A.onRecoverableError,S=0;S<v.length;S++)ce=v[S],ee(ce.value,{componentStack:ce.stack,digest:ce.digest});if(Fp)throw Fp=!1,A=dv,dv=null,A;return(Ip&1)!==0&&A.tag!==0&&lh(),pe=A.pendingLanes,(pe&1)!==0?A===uv?wA++:(wA=0,uv=A):wA=0,ve(),null}function lh(){if(Xd!==null){var A=Ll(Ip),v=Wl.transition,S=hr;try{if(Wl.transition=null,hr=16>A?16:A,Xd===null)var ee=!1;else{if(A=Xd,Xd=null,Ip=0,(_r&6)!==0)throw Error(r(331));var ce=_r;for(_r|=4,Es=A.current;Es!==null;){var pe=Es,We=pe.child;if((Es.flags&16)!==0){var pt=pe.deletions;if(pt!==null){for(var _t=0;_t<pt.length;_t++){var Vt=pt[_t];for(Es=Vt;Es!==null;){var us=Es;switch(us.tag){case 0:case 11:case 15:yA(8,us,pe)}var As=us.child;if(As!==null)As.return=us,Es=As;else for(;Es!==null;){us=Es;var ds=us.sibling,Cs=us.return;if(N1(us),us===Vt){Es=null;break}if(ds!==null){ds.return=Cs,Es=ds;break}Es=Cs}}}var Fs=pe.alternate;if(Fs!==null){var Ds=Fs.child;if(Ds!==null){Fs.child=null;do{var Ha=Ds.sibling;Ds.sibling=null,Ds=Ha}while(Ds!==null)}}Es=pe}}if((pe.subtreeFlags&2064)!==0&&We!==null)We.return=pe,Es=We;else e:for(;Es!==null;){if(pe=Es,(pe.flags&2048)!==0)switch(pe.tag){case 0:case 11:case 15:yA(9,pe,pe.return)}var Ot=pe.sibling;if(Ot!==null){Ot.return=pe.return,Es=Ot;break e}Es=pe.return}}var Bt=A.current;for(Es=Bt;Es!==null;){We=Es;var Qt=We.child;if((We.subtreeFlags&2064)!==0&&Qt!==null)Qt.return=We,Es=Qt;else e:for(We=Bt;Es!==null;){if(pt=Es,(pt.flags&2048)!==0)try{switch(pt.tag){case 0:case 11:case 15:kp(9,pt)}}catch(Us){Fa(pt,pt.return,Us)}if(pt===We){Es=null;break e}var xs=pt.sibling;if(xs!==null){xs.return=pt.return,Es=xs;break e}Es=pt.return}}if(_r=ce,ve(),mr&&typeof mr.onPostCommitFiberRoot=="function")try{mr.onPostCommitFiberRoot(br,A)}catch{}ee=!0}return ee}finally{hr=S,Wl.transition=v}}return!1}function O1(A,v,S){v=rh(S,v),v=r1(A,v,1),A=el(A,v,1),v=Ui(),A!==null&&(xn(A,1,v),al(A,v))}function Fa(A,v,S){if(A.tag===3)O1(A,A,S);else for(;v!==null;){if(v.tag===3){O1(v,A,S);break}else if(v.tag===1){var ee=v.stateNode;if(typeof v.type.getDerivedStateFromError=="function"||typeof ee.componentDidCatch=="function"&&(Yd===null||!Yd.has(ee))){A=rh(S,A),A=a1(v,A,1),v=el(v,A,1),A=Ui(),v!==null&&(xn(v,1,A),al(v,A));break}}v=v.return}}function IF(A,v,S){var ee=A.pingCache;ee!==null&&ee.delete(v),v=Ui(),A.pingedLanes|=A.suspendedLanes&S,_n===A&&(qn&S)===S&&(hn===4||hn===3&&(qn&130023424)===qn&&500>es()-cv?tm(A,0):ov|=S),al(A,v)}function M1(A,v){v===0&&((A.mode&1)===0?v=1:(v=Ci,Ci<<=1,(Ci&130023424)===0&&(Ci=4194304)));var S=Ui();A=Er(A,v),A!==null&&(xn(A,v,S),al(A,S))}function LF(A){var v=A.memoizedState,S=0;v!==null&&(S=v.retryLane),M1(A,S)}function DF(A,v){var S=0;switch(A.tag){case 13:var ee=A.stateNode,ce=A.memoizedState;ce!==null&&(S=ce.retryLane);break;case 19:ee=A.stateNode;break;default:throw Error(r(314))}ee!==null&&ee.delete(v),M1(A,S)}var Q1;Q1=function(A,v,S){if(A!==null)if(A.memoizedProps!==v.pendingProps||ai.current)sl=!0;else{if((A.lanes&S)===0&&(v.flags&128)===0)return sl=!1,jF(A,v,S);sl=(A.flags&131072)!==0}else sl=!1,Yt&&(v.flags&1048576)!==0&&as(v,Xe,v.index);switch(v.lanes=0,v.tag){case 2:var ee=v.type;Sp(A,v),A=v.pendingProps;var ce=Hd(v,un.current);ca(v,S),ce=Yu(null,v,ee,A,ce,S);var pe=Vl();return v.flags|=1,typeof ce=="object"&&ce!==null&&typeof ce.render=="function"&&ce.$$typeof===void 0?(v.tag=1,v.memoizedState=null,v.updateQueue=null,ni(ee)?(pe=!0,Jc(v)):pe=!1,v.memoizedState=ce.state!==null&&ce.state!==void 0?ce.state:null,Gm(v),ce.updater=wp,v.stateNode=ce,ce._reactInternals=v,Gg(v,ee,A,S),v=Xg(null,v,ee,!0,pe,S)):(v.tag=0,Yt&&pe&&Kt(v),Pi(null,v,ce,S),v=v.child),v;case 16:ee=v.elementType;e:{switch(Sp(A,v),A=v.pendingProps,ce=ee._init,ee=ce(ee._payload),v.type=ee,ce=v.tag=UF(ee),A=To(ee,A),ce){case 0:v=Yg(null,v,ee,A,S);break e;case 1:v=h1(null,v,ee,A,S);break e;case 11:v=o1(null,v,ee,A,S);break e;case 14:v=c1(null,v,ee,To(ee.type,A),S);break e}throw Error(r(306,ee,""))}return v;case 0:return ee=v.type,ce=v.pendingProps,ce=v.elementType===ee?ce:To(ee,ce),Yg(A,v,ee,ce,S);case 1:return ee=v.type,ce=v.pendingProps,ce=v.elementType===ee?ce:To(ee,ce),h1(A,v,ee,ce,S);case 3:e:{if(A1(v),A===null)throw Error(r(387));ee=v.pendingProps,pe=v.memoizedState,ce=pe.element,AA(A,v),ko(v,ee,null,S);var We=v.memoizedState;if(ee=We.element,pe.isDehydrated)if(pe={element:ee,isDehydrated:!1,cache:We.cache,pendingSuspenseBoundaries:We.pendingSuspenseBoundaries,transitions:We.transitions},v.updateQueue.baseState=pe,v.memoizedState=pe,v.flags&256){ce=rh(Error(r(423)),v),v=f1(A,v,ee,S,ce);break e}else if(ee!==ce){ce=rh(Error(r(424)),v),v=f1(A,v,ee,S,ce);break e}else for(Xt=Mn(v.stateNode.containerInfo.firstChild),Et=v,Yt=!0,ts=null,S=kr(v,null,ee,S),v.child=S;S;)S.flags=S.flags&-3|4096,S=S.sibling;else{if(nr(),ee===ce){v=sd(A,v,S);break e}Pi(A,v,ee,S)}v=v.child}return v;case 5:return gp(v),A===null&&ys(v),ee=v.type,ce=v.pendingProps,pe=A!==null?A.memoizedProps:null,We=ce.children,cA(ee,ce)?We=null:pe!==null&&cA(ee,pe)&&(v.flags|=32),m1(A,v),Pi(A,v,We,S),v.child;case 6:return A===null&&ys(v),null;case 13:return p1(A,v,S);case 4:return Vd(v,v.stateNode.containerInfo),ee=v.pendingProps,A===null?v.child=Oa(v,null,ee,S):Pi(A,v,ee,S),v.child;case 11:return ee=v.type,ce=v.pendingProps,ce=v.elementType===ee?ce:To(ee,ce),o1(A,v,ee,ce,S);case 7:return Pi(A,v,v.pendingProps,S),v.child;case 8:return Pi(A,v,v.pendingProps.children,S),v.child;case 12:return Pi(A,v,v.pendingProps.children,S),v.child;case 10:e:{if(ee=v.type._context,ce=v.pendingProps,pe=v.memoizedProps,We=ce.value,Rr(Nn,ee._currentValue),ee._currentValue=We,pe!==null)if(wr(pe.value,We)){if(pe.children===ce.children&&!ai.current){v=sd(A,v,S);break e}}else for(pe=v.child,pe!==null&&(pe.return=v);pe!==null;){var pt=pe.dependencies;if(pt!==null){We=pe.child;for(var _t=pt.firstContext;_t!==null;){if(_t.context===ee){if(pe.tag===1){_t=Zi(-1,S&-S),_t.tag=2;var Vt=pe.updateQueue;if(Vt!==null){Vt=Vt.shared;var us=Vt.pending;us===null?_t.next=_t:(_t.next=us.next,us.next=_t),Vt.pending=_t}}pe.lanes|=S,_t=pe.alternate,_t!==null&&(_t.lanes|=S),Ji(pe.return,S,v),pt.lanes|=S;break}_t=_t.next}}else if(pe.tag===10)We=pe.type===v.type?null:pe.child;else if(pe.tag===18){if(We=pe.return,We===null)throw Error(r(341));We.lanes|=S,pt=We.alternate,pt!==null&&(pt.lanes|=S),Ji(We,S,v),We=pe.sibling}else We=pe.child;if(We!==null)We.return=pe;else for(We=pe;We!==null;){if(We===v){We=null;break}if(pe=We.sibling,pe!==null){pe.return=We.return,We=pe;break}We=We.return}pe=We}Pi(A,v,ce.children,S),v=v.child}return v;case 9:return ce=v.type,ee=v.pendingProps.children,ca(v,S),ce=Ea(ce),ee=ee(ce),v.flags|=1,Pi(A,v,ee,S),v.child;case 14:return ee=v.type,ce=To(ee,v.pendingProps),ce=To(ee.type,ce),c1(A,v,ee,ce,S);case 15:return d1(A,v,v.type,v.pendingProps,S);case 17:return ee=v.type,ce=v.pendingProps,ce=v.elementType===ee?ce:To(ee,ce),Sp(A,v),v.tag=1,ni(ee)?(A=!0,Jc(v)):A=!1,ca(v,S),t1(v,ee,ce),Gg(v,ee,ce,S),Xg(null,v,ee,!0,A,S);case 19:return g1(A,v,S);case 22:return u1(A,v,S)}throw Error(r(156,v.tag))};function H1(A,v){return bt(A,v)}function PF(A,v,S,ee){this.tag=A,this.key=S,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=v,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=ee,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Gl(A,v,S,ee){return new PF(A,v,S,ee)}function xv(A){return A=A.prototype,!(!A||!A.isReactComponent)}function UF(A){if(typeof A=="function")return xv(A)?1:0;if(A!=null){if(A=A.$$typeof,A===T)return 11;if(A===M)return 14}return 2}function eu(A,v){var S=A.alternate;return S===null?(S=Gl(A.tag,v,A.key,A.mode),S.elementType=A.elementType,S.type=A.type,S.stateNode=A.stateNode,S.alternate=A,A.alternate=S):(S.pendingProps=v,S.type=A.type,S.flags=0,S.subtreeFlags=0,S.deletions=null),S.flags=A.flags&14680064,S.childLanes=A.childLanes,S.lanes=A.lanes,S.child=A.child,S.memoizedProps=A.memoizedProps,S.memoizedState=A.memoizedState,S.updateQueue=A.updateQueue,v=A.dependencies,S.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext},S.sibling=A.sibling,S.index=A.index,S.ref=A.ref,S}function Up(A,v,S,ee,ce,pe){var We=2;if(ee=A,typeof A=="function")xv(A)&&(We=1);else if(typeof A=="string")We=5;else e:switch(A){case w:return rm(S.children,ce,pe,v);case E:We=8,ce|=8;break;case W:return A=Gl(12,S,v,ce|2),A.elementType=W,A.lanes=pe,A;case Y:return A=Gl(13,S,v,ce),A.elementType=Y,A.lanes=pe,A;case H:return A=Gl(19,S,v,ce),A.elementType=H,A.lanes=pe,A;case z:return Rp(S,ce,pe,v);default:if(typeof A=="object"&&A!==null)switch(A.$$typeof){case R:We=10;break e;case U:We=9;break e;case T:We=11;break e;case M:We=14;break e;case q:We=16,ee=null;break e}throw Error(r(130,A==null?A:typeof A,""))}return v=Gl(We,S,v,ce),v.elementType=A,v.type=ee,v.lanes=pe,v}function rm(A,v,S,ee){return A=Gl(7,A,ee,v),A.lanes=S,A}function Rp(A,v,S,ee){return A=Gl(22,A,ee,v),A.elementType=z,A.lanes=S,A.stateNode={isHidden:!1},A}function gv(A,v,S){return A=Gl(6,A,null,v),A.lanes=S,A}function vv(A,v,S){return v=Gl(4,A.children!==null?A.children:[],A.key,v),v.lanes=S,v.stateNode={containerInfo:A.containerInfo,pendingChildren:null,implementation:A.implementation},v}function RF(A,v,S,ee,ce){this.tag=v,this.containerInfo=A,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Il(0),this.expirationTimes=Il(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Il(0),this.identifierPrefix=ee,this.onRecoverableError=ce,this.mutableSourceEagerHydrationData=null}function bv(A,v,S,ee,ce,pe,We,pt,_t){return A=new RF(A,v,S,pt,_t),v===1?(v=1,pe===!0&&(v|=8)):v=0,pe=Gl(3,null,null,v),A.current=pe,pe.stateNode=A,pe.memoizedState={element:ee,isDehydrated:S,cache:null,transitions:null,pendingSuspenseBoundaries:null},Gm(pe),A}function OF(A,v,S){var ee=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:I,key:ee==null?null:""+ee,children:A,containerInfo:v,implementation:S}}function q1(A){if(!A)return dc;A=A._reactInternals;e:{if(Ve(A)!==A||A.tag!==1)throw Error(r(170));var v=A;do{switch(v.tag){case 3:v=v.stateNode.context;break e;case 1:if(ni(v.type)){v=v.stateNode.__reactInternalMemoizedMergedChildContext;break e}}v=v.return}while(v!==null);throw Error(r(171))}if(A.tag===1){var S=A.type;if(ni(S))return hA(A,S,v)}return v}function $1(A,v,S,ee,ce,pe,We,pt,_t){return A=bv(S,ee,!0,A,ce,pe,We,pt,_t),A.context=q1(null),S=A.current,ee=Ui(),ce=Jd(S),pe=Zi(ee,ce),pe.callback=v??null,el(S,pe,ce),A.current.lanes=ce,xn(A,ce,ee),al(A,ee),A}function Op(A,v,S,ee){var ce=v.current,pe=Ui(),We=Jd(ce);return S=q1(S),v.context===null?v.context=S:v.pendingContext=S,v=Zi(pe,We),v.payload={element:A},ee=ee===void 0?null:ee,ee!==null&&(v.callback=ee),A=el(ce,v,We),A!==null&&(Do(A,ce,We,pe),Zc(A,ce,We)),We}function Mp(A){if(A=A.current,!A.child)return null;switch(A.child.tag){case 5:return A.child.stateNode;default:return A.child.stateNode}}function V1(A,v){if(A=A.memoizedState,A!==null&&A.dehydrated!==null){var S=A.retryLane;A.retryLane=S!==0&&S<v?S:v}}function yv(A,v){V1(A,v),(A=A.alternate)&&V1(A,v)}function MF(){return null}var W1=typeof reportError=="function"?reportError:function(A){console.error(A)};function jv(A){this._internalRoot=A}Qp.prototype.render=jv.prototype.render=function(A){var v=this._internalRoot;if(v===null)throw Error(r(409));Op(A,v,null,null)},Qp.prototype.unmount=jv.prototype.unmount=function(){var A=this._internalRoot;if(A!==null){this._internalRoot=null;var v=A.containerInfo;em(function(){Op(null,A,null,null)}),v[jn]=null}};function Qp(A){this._internalRoot=A}Qp.prototype.unstable_scheduleHydration=function(A){if(A){var v=ki();A={blockedOn:null,target:A,priority:v};for(var S=0;S<Gi.length&&v!==0&&v<Gi[S].priority;S++);Gi.splice(S,0,A),S===0&&fo(A)}};function Nv(A){return!(!A||A.nodeType!==1&&A.nodeType!==9&&A.nodeType!==11)}function Hp(A){return!(!A||A.nodeType!==1&&A.nodeType!==9&&A.nodeType!==11&&(A.nodeType!==8||A.nodeValue!==" react-mount-point-unstable "))}function G1(){}function QF(A,v,S,ee,ce){if(ce){if(typeof ee=="function"){var pe=ee;ee=function(){var Vt=Mp(We);pe.call(Vt)}}var We=$1(v,ee,A,0,null,!1,!1,"",G1);return A._reactRootContainer=We,A[jn]=We.current,Gc(A.nodeType===8?A.parentNode:A),em(),We}for(;ce=A.lastChild;)A.removeChild(ce);if(typeof ee=="function"){var pt=ee;ee=function(){var Vt=Mp(_t);pt.call(Vt)}}var _t=bv(A,0,!1,null,null,!1,!1,"",G1);return A._reactRootContainer=_t,A[jn]=_t.current,Gc(A.nodeType===8?A.parentNode:A),em(function(){Op(v,_t,S,ee)}),_t}function qp(A,v,S,ee,ce){var pe=S._reactRootContainer;if(pe){var We=pe;if(typeof ce=="function"){var pt=ce;ce=function(){var _t=Mp(We);pt.call(_t)}}Op(v,We,A,ce)}else We=QF(S,v,A,ce,ee);return Mp(We)}Zo=function(A){switch(A.tag){case 3:var v=A.stateNode;if(v.current.memoizedState.isDehydrated){var S=Vi(v.pendingLanes);S!==0&&(uo(v,S|1),al(v,es()),(_r&6)===0&&(ih=es()+500,ve()))}break;case 13:em(function(){var ee=Er(A,1);if(ee!==null){var ce=Ui();Do(ee,A,1,ce)}}),yv(A,1)}},ec=function(A){if(A.tag===13){var v=Er(A,134217728);if(v!==null){var S=Ui();Do(v,A,134217728,S)}yv(A,134217728)}},Uc=function(A){if(A.tag===13){var v=Jd(A),S=Er(A,v);if(S!==null){var ee=Ui();Do(S,A,v,ee)}yv(A,v)}},ki=function(){return hr},mo=function(A,v){var S=hr;try{return hr=A,v()}finally{hr=S}},Ee=function(A,v,S){switch(v){case"input":if(me(A,S),v=S.name,S.type==="radio"&&v!=null){for(S=A;S.parentNode;)S=S.parentNode;for(S=S.querySelectorAll("input[name="+JSON.stringify(""+v)+'][type="radio"]'),v=0;v<S.length;v++){var ee=S[v];if(ee!==A&&ee.form===A.form){var ce=Ku(ee);if(!ce)throw Error(r(90));ne(ee),me(ee,ce)}}}break;case"textarea":He(A,S);break;case"select":v=S.value,v!=null&&Fe(A,!!S.multiple,v,!1)}},Rt=Av,Ge=em;var HF={usingClientEntryPoint:!1,Events:[Qd,Yc,Ku,ht,ft,Av]},_A={findFiberByHostInstance:cc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},qF={bundleType:_A.bundleType,version:_A.version,rendererPackageName:_A.rendererPackageName,rendererConfig:_A.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_.ReactCurrentDispatcher,findHostInstanceByFiber:function(A){return A=Ct(A),A===null?null:A.stateNode},findFiberByHostInstance:_A.findFiberByHostInstance||MF,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $p=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$p.isDisabled&&$p.supportsFiber)try{br=$p.inject(qF),mr=$p}catch{}}return nl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=HF,nl.createPortal=function(A,v){var S=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Nv(v))throw Error(r(200));return OF(A,v,null,S)},nl.createRoot=function(A,v){if(!Nv(A))throw Error(r(299));var S=!1,ee="",ce=W1;return v!=null&&(v.unstable_strictMode===!0&&(S=!0),v.identifierPrefix!==void 0&&(ee=v.identifierPrefix),v.onRecoverableError!==void 0&&(ce=v.onRecoverableError)),v=bv(A,1,!1,null,null,S,!1,ee,ce),A[jn]=v.current,Gc(A.nodeType===8?A.parentNode:A),new jv(v)},nl.findDOMNode=function(A){if(A==null)return null;if(A.nodeType===1)return A;var v=A._reactInternals;if(v===void 0)throw typeof A.render=="function"?Error(r(188)):(A=Object.keys(A).join(","),Error(r(268,A)));return A=Ct(v),A=A===null?null:A.stateNode,A},nl.flushSync=function(A){return em(A)},nl.hydrate=function(A,v,S){if(!Hp(v))throw Error(r(200));return qp(null,A,v,!0,S)},nl.hydrateRoot=function(A,v,S){if(!Nv(A))throw Error(r(405));var ee=S!=null&&S.hydratedSources||null,ce=!1,pe="",We=W1;if(S!=null&&(S.unstable_strictMode===!0&&(ce=!0),S.identifierPrefix!==void 0&&(pe=S.identifierPrefix),S.onRecoverableError!==void 0&&(We=S.onRecoverableError)),v=$1(v,null,A,1,S??null,ce,!1,pe,We),A[jn]=v.current,Gc(A),ee)for(A=0;A<ee.length;A++)S=ee[A],ce=S._getVersion,ce=ce(S._source),v.mutableSourceEagerHydrationData==null?v.mutableSourceEagerHydrationData=[S,ce]:v.mutableSourceEagerHydrationData.push(S,ce);return new Qp(v)},nl.render=function(A,v,S){if(!Hp(v))throw Error(r(200));return qp(null,A,v,!1,S)},nl.unmountComponentAtNode=function(A){if(!Hp(A))throw Error(r(40));return A._reactRootContainer?(em(function(){qp(null,null,A,!1,function(){A._reactRootContainer=null,A[jn]=null})}),!0):!1},nl.unstable_batchedUpdates=Av,nl.unstable_renderSubtreeIntoContainer=function(A,v,S,ee){if(!Hp(S))throw Error(r(200));if(A==null||A._reactInternals===void 0)throw Error(r(38));return qp(A,v,S,!1,ee)},nl.version="18.3.1-next-f1338f8080-20240426",nl}var tw;function zC(){if(tw)return Cv.exports;tw=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(s){console.error(s)}}return t(),Cv.exports=e3(),Cv.exports}var sw;function t3(){if(sw)return Vp;sw=1;var t=zC();return Vp.createRoot=t.createRoot,Vp.hydrateRoot=t.hydrateRoot,Vp}var s3=t3();const r3=jj(s3);zC();/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function gf(){return gf=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},gf.apply(this,arguments)}var mu;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(mu||(mu={}));const rw="popstate";function a3(t){t===void 0&&(t={});function s(a,n){let{pathname:i,search:l,hash:o}=a.location;return ry("",{pathname:i,search:l,hash:o},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function r(a,n){return typeof n=="string"?n:o0(n)}return i3(s,r,null,t)}function _a(t,s){if(t===!1||t===null||typeof t>"u")throw new Error(s)}function Nj(t,s){if(!t){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function n3(){return Math.random().toString(36).substr(2,8)}function aw(t,s){return{usr:t.state,key:t.key,idx:s}}function ry(t,s,r,a){return r===void 0&&(r=null),gf({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof s=="string"?Xh(s):s,{state:r,key:s&&s.key||a||n3()})}function o0(t){let{pathname:s="/",search:r="",hash:a=""}=t;return r&&r!=="?"&&(s+=r.charAt(0)==="?"?r:"?"+r),a&&a!=="#"&&(s+=a.charAt(0)==="#"?a:"#"+a),s}function Xh(t){let s={};if(t){let r=t.indexOf("#");r>=0&&(s.hash=t.substr(r),t=t.substr(0,r));let a=t.indexOf("?");a>=0&&(s.search=t.substr(a),t=t.substr(0,a)),t&&(s.pathname=t)}return s}function i3(t,s,r,a){a===void 0&&(a={});let{window:n=document.defaultView,v5Compat:i=!1}=a,l=n.history,o=mu.Pop,d=null,u=c();u==null&&(u=0,l.replaceState(gf({},l.state,{idx:u}),""));function c(){return(l.state||{idx:null}).idx}function h(){o=mu.Pop;let b=c(),y=b==null?null:b-u;u=b,d&&d({action:o,location:x.location,delta:y})}function m(b,y){o=mu.Push;let j=ry(x.location,b,y);u=c()+1;let N=aw(j,u),_=x.createHref(j);try{l.pushState(N,"",_)}catch(F){if(F instanceof DOMException&&F.name==="DataCloneError")throw F;n.location.assign(_)}i&&d&&d({action:o,location:x.location,delta:1})}function p(b,y){o=mu.Replace;let j=ry(x.location,b,y);u=c();let N=aw(j,u),_=x.createHref(j);l.replaceState(N,"",_),i&&d&&d({action:o,location:x.location,delta:0})}function g(b){let y=n.location.origin!=="null"?n.location.origin:n.location.href,j=typeof b=="string"?b:o0(b);return j=j.replace(/ $/,"%20"),_a(y,"No window.location.(origin|href) available to create URL for href: "+j),new URL(j,y)}let x={get action(){return o},get location(){return t(n,l)},listen(b){if(d)throw new Error("A history only accepts one active listener");return n.addEventListener(rw,h),d=b,()=>{n.removeEventListener(rw,h),d=null}},createHref(b){return s(n,b)},createURL:g,encodeLocation(b){let y=g(b);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:m,replace:p,go(b){return l.go(b)}};return x}var nw;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(nw||(nw={}));function l3(t,s,r){return r===void 0&&(r="/"),o3(t,s,r)}function o3(t,s,r,a){let n=typeof s=="string"?Xh(s):s,i=Hh(n.pathname||"/",r);if(i==null)return null;let l=YC(t);c3(l);let o=null;for(let d=0;o==null&&d<l.length;++d){let u=b3(i);o=g3(l[d],u)}return o}function YC(t,s,r,a){s===void 0&&(s=[]),r===void 0&&(r=[]),a===void 0&&(a="");let n=(i,l,o)=>{let d={relativePath:o===void 0?i.path||"":o,caseSensitive:i.caseSensitive===!0,childrenIndex:l,route:i};d.relativePath.startsWith("/")&&(_a(d.relativePath.startsWith(a),'Absolute route path "'+d.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),d.relativePath=d.relativePath.slice(a.length));let u=yu([a,d.relativePath]),c=r.concat(d);i.children&&i.children.length>0&&(_a(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),YC(i.children,s,c,u)),!(i.path==null&&!i.index)&&s.push({path:u,score:p3(u,i.index),routesMeta:c})};return t.forEach((i,l)=>{var o;if(i.path===""||!((o=i.path)!=null&&o.includes("?")))n(i,l);else for(let d of XC(i.path))n(i,l,d)}),s}function XC(t){let s=t.split("/");if(s.length===0)return[];let[r,...a]=s,n=r.endsWith("?"),i=r.replace(/\?$/,"");if(a.length===0)return n?[i,""]:[i];let l=XC(a.join("/")),o=[];return o.push(...l.map(d=>d===""?i:[i,d].join("/"))),n&&o.push(...l),o.map(d=>t.startsWith("/")&&d===""?"/":d)}function c3(t){t.sort((s,r)=>s.score!==r.score?r.score-s.score:x3(s.routesMeta.map(a=>a.childrenIndex),r.routesMeta.map(a=>a.childrenIndex)))}const d3=/^:[\w-]+$/,u3=3,m3=2,h3=1,A3=10,f3=-2,iw=t=>t==="*";function p3(t,s){let r=t.split("/"),a=r.length;return r.some(iw)&&(a+=f3),s&&(a+=m3),r.filter(n=>!iw(n)).reduce((n,i)=>n+(d3.test(i)?u3:i===""?h3:A3),a)}function x3(t,s){return t.length===s.length&&t.slice(0,-1).every((a,n)=>a===s[n])?t[t.length-1]-s[s.length-1]:0}function g3(t,s,r){let{routesMeta:a}=t,n={},i="/",l=[];for(let o=0;o<a.length;++o){let d=a[o],u=o===a.length-1,c=i==="/"?s:s.slice(i.length)||"/",h=ay({path:d.relativePath,caseSensitive:d.caseSensitive,end:u},c),m=d.route;if(!h)return null;Object.assign(n,h.params),l.push({params:n,pathname:yu([i,h.pathname]),pathnameBase:_3(yu([i,h.pathnameBase])),route:m}),h.pathnameBase!=="/"&&(i=yu([i,h.pathnameBase]))}return l}function ay(t,s){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,a]=v3(t.path,t.caseSensitive,t.end),n=s.match(r);if(!n)return null;let i=n[0],l=i.replace(/(.)\/+$/,"$1"),o=n.slice(1);return{params:a.reduce((u,c,h)=>{let{paramName:m,isOptional:p}=c;if(m==="*"){let x=o[h]||"";l=i.slice(0,i.length-x.length).replace(/(.)\/+$/,"$1")}const g=o[h];return p&&!g?u[m]=void 0:u[m]=(g||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:l,pattern:t}}function v3(t,s,r){s===void 0&&(s=!1),r===void 0&&(r=!0),Nj(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let a=[],n="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,o,d)=>(a.push({paramName:o,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(a.push({paramName:"*"}),n+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?n+="\\/*$":t!==""&&t!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,s?void 0:"i"),a]}function b3(t){try{return t.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return Nj(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+s+").")),t}}function Hh(t,s){if(s==="/")return t;if(!t.toLowerCase().startsWith(s.toLowerCase()))return null;let r=s.endsWith("/")?s.length-1:s.length,a=t.charAt(r);return a&&a!=="/"?null:t.slice(r)||"/"}const y3=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,j3=t=>y3.test(t);function N3(t,s){s===void 0&&(s="/");let{pathname:r,search:a="",hash:n=""}=typeof t=="string"?Xh(t):t,i;if(r)if(j3(r))i=r;else{if(r.includes("//")){let l=r;r=r.replace(/\/\/+/g,"/"),Nj(!1,"Pathnames cannot have embedded double slashes - normalizing "+(l+" -> "+r))}r.startsWith("/")?i=lw(r.substring(1),"/"):i=lw(r,s)}else i=s;return{pathname:i,search:S3(a),hash:C3(n)}}function lw(t,s){let r=s.replace(/\/+$/,"").split("/");return t.split("/").forEach(n=>{n===".."?r.length>1&&r.pop():n!=="."&&r.push(n)}),r.length>1?r.join("/"):"/"}function Bv(t,s,r,a){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+s+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function w3(t){return t.filter((s,r)=>r===0||s.route.path&&s.route.path.length>0)}function wj(t,s){let r=w3(t);return s?r.map((a,n)=>n===r.length-1?a.pathname:a.pathnameBase):r.map(a=>a.pathnameBase)}function _j(t,s,r,a){a===void 0&&(a=!1);let n;typeof t=="string"?n=Xh(t):(n=gf({},t),_a(!n.pathname||!n.pathname.includes("?"),Bv("?","pathname","search",n)),_a(!n.pathname||!n.pathname.includes("#"),Bv("#","pathname","hash",n)),_a(!n.search||!n.search.includes("#"),Bv("#","search","hash",n)));let i=t===""||n.pathname==="",l=i?"/":n.pathname,o;if(l==null)o=r;else{let h=s.length-1;if(!a&&l.startsWith("..")){let m=l.split("/");for(;m[0]==="..";)m.shift(),h-=1;n.pathname=m.join("/")}o=h>=0?s[h]:"/"}let d=N3(n,o),u=l&&l!=="/"&&l.endsWith("/"),c=(i||l===".")&&r.endsWith("/");return!d.pathname.endsWith("/")&&(u||c)&&(d.pathname+="/"),d}const yu=t=>t.join("/").replace(/\/\/+/g,"/"),_3=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),S3=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,C3=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function k3(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const JC=["post","put","patch","delete"];new Set(JC);const E3=["get",...JC];new Set(E3);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function vf(){return vf=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},vf.apply(this,arguments)}const K0=f.createContext(null),ZC=f.createContext(null),yd=f.createContext(null),z0=f.createContext(null),jd=f.createContext({outlet:null,matches:[],isDataRoute:!1}),ek=f.createContext(null);function B3(t,s){let{relative:r}=s===void 0?{}:s;Jh()||_a(!1);let{basename:a,navigator:n}=f.useContext(yd),{hash:i,pathname:l,search:o}=Y0(t,{relative:r}),d=l;return a!=="/"&&(d=l==="/"?a:yu([a,l])),n.createHref({pathname:d,search:o,hash:i})}function Jh(){return f.useContext(z0)!=null}function Ur(){return Jh()||_a(!1),f.useContext(z0).location}function tk(t){f.useContext(yd).static||f.useLayoutEffect(t)}function ps(){let{isDataRoute:t}=f.useContext(jd);return t?q3():F3()}function F3(){Jh()||_a(!1);let t=f.useContext(K0),{basename:s,future:r,navigator:a}=f.useContext(yd),{matches:n}=f.useContext(jd),{pathname:i}=Ur(),l=JSON.stringify(wj(n,r.v7_relativeSplatPath)),o=f.useRef(!1);return tk(()=>{o.current=!0}),f.useCallback(function(u,c){if(c===void 0&&(c={}),!o.current)return;if(typeof u=="number"){a.go(u);return}let h=_j(u,JSON.parse(l),i,c.relative==="path");t==null&&s!=="/"&&(h.pathname=h.pathname==="/"?s:yu([s,h.pathname])),(c.replace?a.replace:a.push)(h,c.state,c)},[s,a,l,i,t])}function Ps(){let{matches:t}=f.useContext(jd),s=t[t.length-1];return s?s.params:{}}function Y0(t,s){let{relative:r}=s===void 0?{}:s,{future:a}=f.useContext(yd),{matches:n}=f.useContext(jd),{pathname:i}=Ur(),l=JSON.stringify(wj(n,a.v7_relativeSplatPath));return f.useMemo(()=>_j(t,JSON.parse(l),i,r==="path"),[t,l,i,r])}function T3(t,s){return I3(t,s)}function I3(t,s,r,a){Jh()||_a(!1);let{navigator:n}=f.useContext(yd),{matches:i}=f.useContext(jd),l=i[i.length-1],o=l?l.params:{};l&&l.pathname;let d=l?l.pathnameBase:"/";l&&l.route;let u=Ur(),c;if(s){var h;let b=typeof s=="string"?Xh(s):s;d==="/"||(h=b.pathname)!=null&&h.startsWith(d)||_a(!1),c=b}else c=u;let m=c.pathname||"/",p=m;if(d!=="/"){let b=d.replace(/^\//,"").split("/");p="/"+m.replace(/^\//,"").split("/").slice(b.length).join("/")}let g=l3(t,{pathname:p}),x=R3(g&&g.map(b=>Object.assign({},b,{params:Object.assign({},o,b.params),pathname:yu([d,n.encodeLocation?n.encodeLocation(b.pathname).pathname:b.pathname]),pathnameBase:b.pathnameBase==="/"?d:yu([d,n.encodeLocation?n.encodeLocation(b.pathnameBase).pathname:b.pathnameBase])})),i,r,a);return s&&x?f.createElement(z0.Provider,{value:{location:vf({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:mu.Pop}},x):x}function L3(){let t=H3(),s=k3(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,n={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return f.createElement(f.Fragment,null,f.createElement("h2",null,"Unexpected Application Error!"),f.createElement("h3",{style:{fontStyle:"italic"}},s),r?f.createElement("pre",{style:n},r):null,null)}const D3=f.createElement(L3,null);class P3 extends f.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,r){return r.location!==s.location||r.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:r.error,location:r.location,revalidation:s.revalidation||r.revalidation}}componentDidCatch(s,r){console.error("React Router caught the following error during render",s,r)}render(){return this.state.error!==void 0?f.createElement(jd.Provider,{value:this.props.routeContext},f.createElement(ek.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function U3(t){let{routeContext:s,match:r,children:a}=t,n=f.useContext(K0);return n&&n.static&&n.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=r.route.id),f.createElement(jd.Provider,{value:s},a)}function R3(t,s,r,a){var n;if(s===void 0&&(s=[]),r===void 0&&(r=null),a===void 0&&(a=null),t==null){var i;if(!r)return null;if(r.errors)t=r.matches;else if((i=a)!=null&&i.v7_partialHydration&&s.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let l=t,o=(n=r)==null?void 0:n.errors;if(o!=null){let c=l.findIndex(h=>h.route.id&&(o==null?void 0:o[h.route.id])!==void 0);c>=0||_a(!1),l=l.slice(0,Math.min(l.length,c+1))}let d=!1,u=-1;if(r&&a&&a.v7_partialHydration)for(let c=0;c<l.length;c++){let h=l[c];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(u=c),h.route.id){let{loaderData:m,errors:p}=r,g=h.route.loader&&m[h.route.id]===void 0&&(!p||p[h.route.id]===void 0);if(h.route.lazy||g){d=!0,u>=0?l=l.slice(0,u+1):l=[l[0]];break}}}return l.reduceRight((c,h,m)=>{let p,g=!1,x=null,b=null;r&&(p=o&&h.route.id?o[h.route.id]:void 0,x=h.route.errorElement||D3,d&&(u<0&&m===0?($3("route-fallback"),g=!0,b=null):u===m&&(g=!0,b=h.route.hydrateFallbackElement||null)));let y=s.concat(l.slice(0,m+1)),j=()=>{let N;return p?N=x:g?N=b:h.route.Component?N=f.createElement(h.route.Component,null):h.route.element?N=h.route.element:N=c,f.createElement(U3,{match:h,routeContext:{outlet:c,matches:y,isDataRoute:r!=null},children:N})};return r&&(h.route.ErrorBoundary||h.route.errorElement||m===0)?f.createElement(P3,{location:r.location,revalidation:r.revalidation,component:x,error:p,children:j(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):j()},null)}var sk=(function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t})(sk||{}),rk=(function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t})(rk||{});function O3(t){let s=f.useContext(K0);return s||_a(!1),s}function M3(t){let s=f.useContext(ZC);return s||_a(!1),s}function Q3(t){let s=f.useContext(jd);return s||_a(!1),s}function ak(t){let s=Q3(),r=s.matches[s.matches.length-1];return r.route.id||_a(!1),r.route.id}function H3(){var t;let s=f.useContext(ek),r=M3(),a=ak();return s!==void 0?s:(t=r.errors)==null?void 0:t[a]}function q3(){let{router:t}=O3(sk.UseNavigateStable),s=ak(rk.UseNavigateStable),r=f.useRef(!1);return tk(()=>{r.current=!0}),f.useCallback(function(n,i){i===void 0&&(i={}),r.current&&(typeof n=="number"?t.navigate(n):t.navigate(n,vf({fromRouteId:s},i)))},[t,s])}const ow={};function $3(t,s,r){ow[t]||(ow[t]=!0)}function V3(t,s){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function dd(t){let{to:s,replace:r,state:a,relative:n}=t;Jh()||_a(!1);let{future:i,static:l}=f.useContext(yd),{matches:o}=f.useContext(jd),{pathname:d}=Ur(),u=ps(),c=_j(s,wj(o,i.v7_relativeSplatPath),d,n==="path"),h=JSON.stringify(c);return f.useEffect(()=>u(JSON.parse(h),{replace:r,state:a,relative:n}),[u,h,n,r,a]),null}function tt(t){_a(!1)}function W3(t){let{basename:s="/",children:r=null,location:a,navigationType:n=mu.Pop,navigator:i,static:l=!1,future:o}=t;Jh()&&_a(!1);let d=s.replace(/^\/*/,"/"),u=f.useMemo(()=>({basename:d,navigator:i,static:l,future:vf({v7_relativeSplatPath:!1},o)}),[d,o,i,l]);typeof a=="string"&&(a=Xh(a));let{pathname:c="/",search:h="",hash:m="",state:p=null,key:g="default"}=a,x=f.useMemo(()=>{let b=Hh(c,d);return b==null?null:{location:{pathname:b,search:h,hash:m,state:p,key:g},navigationType:n}},[d,c,h,m,p,g,n]);return x==null?null:f.createElement(yd.Provider,{value:u},f.createElement(z0.Provider,{children:r,value:x}))}function hl(t){let{children:s,location:r}=t;return T3(ny(s),r)}new Promise(()=>{});function ny(t,s){s===void 0&&(s=[]);let r=[];return f.Children.forEach(t,(a,n)=>{if(!f.isValidElement(a))return;let i=[...s,n];if(a.type===f.Fragment){r.push.apply(r,ny(a.props.children,i));return}a.type!==tt&&_a(!1),!a.props.index||!a.props.children||_a(!1);let l={id:a.props.id||i.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(l.children=ny(a.props.children,i)),r.push(l)}),r}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function c0(){return c0=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},c0.apply(this,arguments)}function nk(t,s){if(t==null)return{};var r={},a=Object.keys(t),n,i;for(i=0;i<a.length;i++)n=a[i],!(s.indexOf(n)>=0)&&(r[n]=t[n]);return r}function G3(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function K3(t,s){return t.button===0&&(!s||s==="_self")&&!G3(t)}function iy(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((s,r)=>{let a=t[r];return s.concat(Array.isArray(a)?a.map(n=>[r,n]):[[r,a]])},[]))}function z3(t,s){let r=iy(t);return s&&s.forEach((a,n)=>{r.has(n)||s.getAll(n).forEach(i=>{r.append(n,i)})}),r}const Y3=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],X3=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],J3="6";try{window.__reactRouterVersion=J3}catch{}const Z3=f.createContext({isTransitioning:!1}),eT="startTransition",cw=XF[eT];function tT(t){let{basename:s,children:r,future:a,window:n}=t,i=f.useRef();i.current==null&&(i.current=a3({window:n,v5Compat:!0}));let l=i.current,[o,d]=f.useState({action:l.action,location:l.location}),{v7_startTransition:u}=a||{},c=f.useCallback(h=>{u&&cw?cw(()=>d(h)):d(h)},[d,u]);return f.useLayoutEffect(()=>l.listen(c),[l,c]),f.useEffect(()=>V3(a),[a]),f.createElement(W3,{basename:s,children:r,location:o.location,navigationType:o.action,navigator:l,future:a})}const sT=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",rT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Re=f.forwardRef(function(s,r){let{onClick:a,relative:n,reloadDocument:i,replace:l,state:o,target:d,to:u,preventScrollReset:c,viewTransition:h}=s,m=nk(s,Y3),{basename:p}=f.useContext(yd),g,x=!1;if(typeof u=="string"&&rT.test(u)&&(g=u,sT))try{let N=new URL(window.location.href),_=u.startsWith("//")?new URL(N.protocol+u):new URL(u),F=Hh(_.pathname,p);_.origin===N.origin&&F!=null?u=F+_.search+_.hash:x=!0}catch{}let b=B3(u,{relative:n}),y=nT(u,{replace:l,state:o,target:d,preventScrollReset:c,relative:n,viewTransition:h});function j(N){a&&a(N),N.defaultPrevented||y(N)}return f.createElement("a",c0({},m,{href:g||b,onClick:x||i?a:j,ref:r,target:d}))}),dw=f.forwardRef(function(s,r){let{"aria-current":a="page",caseSensitive:n=!1,className:i="",end:l=!1,style:o,to:d,viewTransition:u,children:c}=s,h=nk(s,X3),m=Y0(d,{relative:h.relative}),p=Ur(),g=f.useContext(ZC),{navigator:x,basename:b}=f.useContext(yd),y=g!=null&&iT(m)&&u===!0,j=x.encodeLocation?x.encodeLocation(m).pathname:m.pathname,N=p.pathname,_=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;n||(N=N.toLowerCase(),_=_?_.toLowerCase():null,j=j.toLowerCase()),_&&b&&(_=Hh(_,b)||_);const F=j!=="/"&&j.endsWith("/")?j.length-1:j.length;let I=N===j||!l&&N.startsWith(j)&&N.charAt(F)==="/",w=_!=null&&(_===j||!l&&_.startsWith(j)&&_.charAt(j.length)==="/"),E={isActive:I,isPending:w,isTransitioning:y},W=I?a:void 0,R;typeof i=="function"?R=i(E):R=[i,I?"active":null,w?"pending":null,y?"transitioning":null].filter(Boolean).join(" ");let U=typeof o=="function"?o(E):o;return f.createElement(Re,c0({},h,{"aria-current":W,className:R,ref:r,style:U,to:d,viewTransition:u}),typeof c=="function"?c(E):c)});var ly;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(ly||(ly={}));var uw;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(uw||(uw={}));function aT(t){let s=f.useContext(K0);return s||_a(!1),s}function nT(t,s){let{target:r,replace:a,state:n,preventScrollReset:i,relative:l,viewTransition:o}=s===void 0?{}:s,d=ps(),u=Ur(),c=Y0(t,{relative:l});return f.useCallback(h=>{if(K3(h,r)){h.preventDefault();let m=a!==void 0?a:o0(u)===o0(c);d(t,{replace:m,state:n,preventScrollReset:i,relative:l,viewTransition:o})}},[u,d,c,a,n,r,t,i,l,o])}function Vf(t){let s=f.useRef(iy(t)),r=f.useRef(!1),a=Ur(),n=f.useMemo(()=>z3(a.search,r.current?null:s.current),[a.search]),i=ps(),l=f.useCallback((o,d)=>{const u=iy(typeof o=="function"?o(n):o);r.current=!0,i("?"+u,d)},[i,n]);return[n,l]}function iT(t,s){s===void 0&&(s={});let r=f.useContext(Z3);r==null&&_a(!1);let{basename:a}=aT(ly.useViewTransitionState),n=Y0(t,{relative:s.relative});if(!r.isTransitioning)return!1;let i=Hh(r.currentLocation.pathname,a)||r.currentLocation.pathname,l=Hh(r.nextLocation.pathname,a)||r.nextLocation.pathname;return ay(n.pathname,l)!=null||ay(n.pathname,i)!=null}function ik(t){var s,r,a="";if(typeof t=="string"||typeof t=="number")a+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(s=0;s<n;s++)t[s]&&(r=ik(t[s]))&&(a&&(a+=" "),a+=r)}else for(r in t)t[r]&&(a&&(a+=" "),a+=r);return a}function hu(){for(var t,s,r=0,a="",n=arguments.length;r<n;r++)(t=arguments[r])&&(s=ik(t))&&(a&&(a+=" "),a+=s);return a}const bf=t=>typeof t=="number"&&!isNaN(t),xm=t=>typeof t=="string",kl=t=>typeof t=="function",Hx=t=>xm(t)||kl(t)?t:null,oy=t=>f.isValidElement(t)||xm(t)||kl(t)||bf(t);function lT(t,s,r){r===void 0&&(r=300);const{scrollHeight:a,style:n}=t;requestAnimationFrame(()=>{n.minHeight="initial",n.height=a+"px",n.transition=`all ${r}ms`,requestAnimationFrame(()=>{n.height="0",n.padding="0",n.margin="0",setTimeout(s,r)})})}function X0(t){let{enter:s,exit:r,appendPosition:a=!1,collapse:n=!0,collapseDuration:i=300}=t;return function(l){let{children:o,position:d,preventExitTransition:u,done:c,nodeRef:h,isIn:m,playToast:p}=l;const g=a?`${s}--${d}`:s,x=a?`${r}--${d}`:r,b=f.useRef(0);return f.useLayoutEffect(()=>{const y=h.current,j=g.split(" "),N=_=>{_.target===h.current&&(p(),y.removeEventListener("animationend",N),y.removeEventListener("animationcancel",N),b.current===0&&_.type!=="animationcancel"&&y.classList.remove(...j))};y.classList.add(...j),y.addEventListener("animationend",N),y.addEventListener("animationcancel",N)},[]),f.useEffect(()=>{const y=h.current,j=()=>{y.removeEventListener("animationend",j),n?lT(y,c,i):c()};m||(u?j():(b.current=1,y.className+=` ${x}`,y.addEventListener("animationend",j)))},[m]),Is.createElement(Is.Fragment,null,o)}}function mw(t,s){return t!=null?{content:t.content,containerId:t.props.containerId,id:t.props.toastId,theme:t.props.theme,type:t.props.type,data:t.props.data||{},isLoading:t.props.isLoading,icon:t.props.icon,status:s}:{}}const Qi=new Map;let yf=[];const cy=new Set,oT=t=>cy.forEach(s=>s(t)),lk=()=>Qi.size>0;function ok(t,s){var r;if(s)return!((r=Qi.get(s))==null||!r.isToastActive(t));let a=!1;return Qi.forEach(n=>{n.isToastActive(t)&&(a=!0)}),a}function ck(t,s){oy(t)&&(lk()||yf.push({content:t,options:s}),Qi.forEach(r=>{r.buildToast(t,s)}))}function hw(t,s){Qi.forEach(r=>{s!=null&&s!=null&&s.containerId?(s==null?void 0:s.containerId)===r.id&&r.toggle(t,s==null?void 0:s.id):r.toggle(t,s==null?void 0:s.id)})}function cT(t){const{subscribe:s,getSnapshot:r,setProps:a}=f.useRef((function(i){const l=i.containerId||1;return{subscribe(o){const d=(function(c,h,m){let p=1,g=0,x=[],b=[],y=[],j=h;const N=new Map,_=new Set,F=()=>{y=Array.from(N.values()),_.forEach(E=>E())},I=E=>{b=E==null?[]:b.filter(W=>W!==E),F()},w=E=>{const{toastId:W,onOpen:R,updateId:U,children:T}=E.props,Y=U==null;E.staleId&&N.delete(E.staleId),N.set(W,E),b=[...b,E.props.toastId].filter(H=>H!==E.staleId),F(),m(mw(E,Y?"added":"updated")),Y&&kl(R)&&R(f.isValidElement(T)&&T.props)};return{id:c,props:j,observe:E=>(_.add(E),()=>_.delete(E)),toggle:(E,W)=>{N.forEach(R=>{W!=null&&W!==R.props.toastId||kl(R.toggle)&&R.toggle(E)})},removeToast:I,toasts:N,clearQueue:()=>{g-=x.length,x=[]},buildToast:(E,W)=>{if((C=>{let{containerId:k,toastId:B,updateId:G}=C;const O=k?k!==c:c!==1,K=N.has(B)&&G==null;return O||K})(W))return;const{toastId:R,updateId:U,data:T,staleId:Y,delay:H}=W,M=()=>{I(R)},q=U==null;q&&g++;const z={...j,style:j.toastStyle,key:p++,...Object.fromEntries(Object.entries(W).filter(C=>{let[k,B]=C;return B!=null})),toastId:R,updateId:U,data:T,closeToast:M,isIn:!1,className:Hx(W.className||j.toastClassName),bodyClassName:Hx(W.bodyClassName||j.bodyClassName),progressClassName:Hx(W.progressClassName||j.progressClassName),autoClose:!W.isLoading&&(Q=W.autoClose,L=j.autoClose,Q===!1||bf(Q)&&Q>0?Q:L),deleteToast(){const C=N.get(R),{onClose:k,children:B}=C.props;kl(k)&&k(f.isValidElement(B)&&B.props),m(mw(C,"removed")),N.delete(R),g--,g<0&&(g=0),x.length>0?w(x.shift()):F()}};var Q,L;z.closeButton=j.closeButton,W.closeButton===!1||oy(W.closeButton)?z.closeButton=W.closeButton:W.closeButton===!0&&(z.closeButton=!oy(j.closeButton)||j.closeButton);let V=E;f.isValidElement(E)&&!xm(E.type)?V=f.cloneElement(E,{closeToast:M,toastProps:z,data:T}):kl(E)&&(V=E({closeToast:M,toastProps:z,data:T}));const P={content:V,props:z,staleId:Y};j.limit&&j.limit>0&&g>j.limit&&q?x.push(P):bf(H)?setTimeout(()=>{w(P)},H):w(P)},setProps(E){j=E},setToggle:(E,W)=>{N.get(E).toggle=W},isToastActive:E=>b.some(W=>W===E),getSnapshot:()=>y}})(l,i,oT);Qi.set(l,d);const u=d.observe(o);return yf.forEach(c=>ck(c.content,c.options)),yf=[],()=>{u(),Qi.delete(l)}},setProps(o){var d;(d=Qi.get(l))==null||d.setProps(o)},getSnapshot(){var o;return(o=Qi.get(l))==null?void 0:o.getSnapshot()}}})(t)).current;a(t);const n=f.useSyncExternalStore(s,r,r);return{getToastToRender:function(i){if(!n)return[];const l=new Map;return t.newestOnTop&&n.reverse(),n.forEach(o=>{const{position:d}=o.props;l.has(d)||l.set(d,[]),l.get(d).push(o)}),Array.from(l,o=>i(o[0],o[1]))},isToastActive:ok,count:n==null?void 0:n.length}}function dT(t){const[s,r]=f.useState(!1),[a,n]=f.useState(!1),i=f.useRef(null),l=f.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:o,pauseOnHover:d,closeToast:u,onClick:c,closeOnClick:h}=t;var m,p;function g(){r(!0)}function x(){r(!1)}function b(N){const _=i.current;l.canDrag&&_&&(l.didMove=!0,s&&x(),l.delta=t.draggableDirection==="x"?N.clientX-l.start:N.clientY-l.start,l.start!==N.clientX&&(l.canCloseOnClick=!1),_.style.transform=`translate3d(${t.draggableDirection==="x"?`${l.delta}px, var(--y)`:`0, calc(${l.delta}px + var(--y))`},0)`,_.style.opacity=""+(1-Math.abs(l.delta/l.removalDistance)))}function y(){document.removeEventListener("pointermove",b),document.removeEventListener("pointerup",y);const N=i.current;if(l.canDrag&&l.didMove&&N){if(l.canDrag=!1,Math.abs(l.delta)>l.removalDistance)return n(!0),t.closeToast(),void t.collapseAll();N.style.transition="transform 0.2s, opacity 0.2s",N.style.removeProperty("transform"),N.style.removeProperty("opacity")}}(p=Qi.get((m={id:t.toastId,containerId:t.containerId,fn:r}).containerId||1))==null||p.setToggle(m.id,m.fn),f.useEffect(()=>{if(t.pauseOnFocusLoss)return document.hasFocus()||x(),window.addEventListener("focus",g),window.addEventListener("blur",x),()=>{window.removeEventListener("focus",g),window.removeEventListener("blur",x)}},[t.pauseOnFocusLoss]);const j={onPointerDown:function(N){if(t.draggable===!0||t.draggable===N.pointerType){l.didMove=!1,document.addEventListener("pointermove",b),document.addEventListener("pointerup",y);const _=i.current;l.canCloseOnClick=!0,l.canDrag=!0,_.style.transition="none",t.draggableDirection==="x"?(l.start=N.clientX,l.removalDistance=_.offsetWidth*(t.draggablePercent/100)):(l.start=N.clientY,l.removalDistance=_.offsetHeight*(t.draggablePercent===80?1.5*t.draggablePercent:t.draggablePercent)/100)}},onPointerUp:function(N){const{top:_,bottom:F,left:I,right:w}=i.current.getBoundingClientRect();N.nativeEvent.type!=="touchend"&&t.pauseOnHover&&N.clientX>=I&&N.clientX<=w&&N.clientY>=_&&N.clientY<=F?x():g()}};return o&&d&&(j.onMouseEnter=x,t.stacked||(j.onMouseLeave=g)),h&&(j.onClick=N=>{c&&c(N),l.canCloseOnClick&&u()}),{playToast:g,pauseToast:x,isRunning:s,preventExitTransition:a,toastRef:i,eventHandlers:j}}function uT(t){let{delay:s,isRunning:r,closeToast:a,type:n="default",hide:i,className:l,style:o,controlledProgress:d,progress:u,rtl:c,isIn:h,theme:m}=t;const p=i||d&&u===0,g={...o,animationDuration:`${s}ms`,animationPlayState:r?"running":"paused"};d&&(g.transform=`scaleX(${u})`);const x=hu("Toastify__progress-bar",d?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${m}`,`Toastify__progress-bar--${n}`,{"Toastify__progress-bar--rtl":c}),b=kl(l)?l({rtl:c,type:n,defaultClassName:x}):hu(x,l),y={[d&&u>=1?"onTransitionEnd":"onAnimationEnd"]:d&&u<1?null:()=>{h&&a()}};return Is.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":p},Is.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${m} Toastify__progress-bar--${n}`}),Is.createElement("div",{role:"progressbar","aria-hidden":p?"true":"false","aria-label":"notification timer",className:b,style:g,...y}))}let mT=1;const dk=()=>""+mT++;function hT(t){return t&&(xm(t.toastId)||bf(t.toastId))?t.toastId:dk()}function ZA(t,s){return ck(t,s),s.toastId}function d0(t,s){return{...s,type:s&&s.type||t,toastId:hT(s)}}function Wp(t){return(s,r)=>ZA(s,d0(t,r))}function ct(t,s){return ZA(t,d0("default",s))}ct.loading=(t,s)=>ZA(t,d0("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...s})),ct.promise=function(t,s,r){let a,{pending:n,error:i,success:l}=s;n&&(a=xm(n)?ct.loading(n,r):ct.loading(n.render,{...r,...n}));const o={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},d=(c,h,m)=>{if(h==null)return void ct.dismiss(a);const p={type:c,...o,...r,data:m},g=xm(h)?{render:h}:h;return a?ct.update(a,{...p,...g}):ct(g.render,{...p,...g}),m},u=kl(t)?t():t;return u.then(c=>d("success",l,c)).catch(c=>d("error",i,c)),u},ct.success=Wp("success"),ct.info=Wp("info"),ct.error=Wp("error"),ct.warning=Wp("warning"),ct.warn=ct.warning,ct.dark=(t,s)=>ZA(t,d0("default",{theme:"dark",...s})),ct.dismiss=function(t){(function(s){var r;if(lk()){if(s==null||xm(r=s)||bf(r))Qi.forEach(a=>{a.removeToast(s)});else if(s&&("containerId"in s||"id"in s)){const a=Qi.get(s.containerId);a?a.removeToast(s.id):Qi.forEach(n=>{n.removeToast(s.id)})}}else yf=yf.filter(a=>s!=null&&a.options.toastId!==s)})(t)},ct.clearWaitingQueue=function(t){t===void 0&&(t={}),Qi.forEach(s=>{!s.props.limit||t.containerId&&s.id!==t.containerId||s.clearQueue()})},ct.isActive=ok,ct.update=function(t,s){s===void 0&&(s={});const r=((a,n)=>{var i;let{containerId:l}=n;return(i=Qi.get(l||1))==null?void 0:i.toasts.get(a)})(t,s);if(r){const{props:a,content:n}=r,i={delay:100,...a,...s,toastId:s.toastId||t,updateId:dk()};i.toastId!==t&&(i.staleId=t);const l=i.render||n;delete i.render,ZA(l,i)}},ct.done=t=>{ct.update(t,{progress:1})},ct.onChange=function(t){return cy.add(t),()=>{cy.delete(t)}},ct.play=t=>hw(!0,t),ct.pause=t=>hw(!1,t);const AT=typeof window<"u"?f.useLayoutEffect:f.useEffect,Gp=t=>{let{theme:s,type:r,isLoading:a,...n}=t;return Is.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:s==="colored"?"currentColor":`var(--toastify-icon-color-${r})`,...n})},Fv={info:function(t){return Is.createElement(Gp,{...t},Is.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(t){return Is.createElement(Gp,{...t},Is.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(t){return Is.createElement(Gp,{...t},Is.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(t){return Is.createElement(Gp,{...t},Is.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return Is.createElement("div",{className:"Toastify__spinner"})}},fT=t=>{const{isRunning:s,preventExitTransition:r,toastRef:a,eventHandlers:n,playToast:i}=dT(t),{closeButton:l,children:o,autoClose:d,onClick:u,type:c,hideProgressBar:h,closeToast:m,transition:p,position:g,className:x,style:b,bodyClassName:y,bodyStyle:j,progressClassName:N,progressStyle:_,updateId:F,role:I,progress:w,rtl:E,toastId:W,deleteToast:R,isIn:U,isLoading:T,closeOnClick:Y,theme:H}=t,M=hu("Toastify__toast",`Toastify__toast-theme--${H}`,`Toastify__toast--${c}`,{"Toastify__toast--rtl":E},{"Toastify__toast--close-on-click":Y}),q=kl(x)?x({rtl:E,position:g,type:c,defaultClassName:M}):hu(M,x),z=(function(P){let{theme:C,type:k,isLoading:B,icon:G}=P,O=null;const K={theme:C,type:k};return G===!1||(kl(G)?O=G({...K,isLoading:B}):f.isValidElement(G)?O=f.cloneElement(G,K):B?O=Fv.spinner():(J=>J in Fv)(k)&&(O=Fv[k](K))),O})(t),Q=!!w||!d,L={closeToast:m,type:c,theme:H};let V=null;return l===!1||(V=kl(l)?l(L):f.isValidElement(l)?f.cloneElement(l,L):(function(P){let{closeToast:C,theme:k,ariaLabel:B="close"}=P;return Is.createElement("button",{className:`Toastify__close-button Toastify__close-button--${k}`,type:"button",onClick:G=>{G.stopPropagation(),C(G)},"aria-label":B},Is.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},Is.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))})(L)),Is.createElement(p,{isIn:U,done:R,position:g,preventExitTransition:r,nodeRef:a,playToast:i},Is.createElement("div",{id:W,onClick:u,"data-in":U,className:q,...n,style:b,ref:a},Is.createElement("div",{...U&&{role:I},className:kl(y)?y({type:c}):hu("Toastify__toast-body",y),style:j},z!=null&&Is.createElement("div",{className:hu("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!T})},z),Is.createElement("div",null,o)),V,Is.createElement(uT,{...F&&!Q?{key:`pb-${F}`}:{},rtl:E,theme:H,delay:d,isRunning:s,isIn:U,closeToast:m,hide:h,type:c,style:_,className:N,controlledProgress:Q,progress:w||0})))},J0=function(t,s){return s===void 0&&(s=!1),{enter:`Toastify--animate Toastify__${t}-enter`,exit:`Toastify--animate Toastify__${t}-exit`,appendPosition:s}},pT=X0(J0("bounce",!0));X0(J0("slide",!0));X0(J0("zoom"));X0(J0("flip"));const xT={position:"top-right",transition:pT,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"};function gT(t){let s={...xT,...t};const r=t.stacked,[a,n]=f.useState(!0),i=f.useRef(null),{getToastToRender:l,isToastActive:o,count:d}=cT(s),{className:u,style:c,rtl:h,containerId:m}=s;function p(x){const b=hu("Toastify__toast-container",`Toastify__toast-container--${x}`,{"Toastify__toast-container--rtl":h});return kl(u)?u({position:x,rtl:h,defaultClassName:b}):hu(b,Hx(u))}function g(){r&&(n(!0),ct.play())}return AT(()=>{if(r){var x;const b=i.current.querySelectorAll('[data-in="true"]'),y=12,j=(x=s.position)==null?void 0:x.includes("top");let N=0,_=0;Array.from(b).reverse().forEach((F,I)=>{const w=F;w.classList.add("Toastify__toast--stacked"),I>0&&(w.dataset.collapsed=`${a}`),w.dataset.pos||(w.dataset.pos=j?"top":"bot");const E=N*(a?.2:1)+(a?0:y*I);w.style.setProperty("--y",`${j?E:-1*E}px`),w.style.setProperty("--g",`${y}`),w.style.setProperty("--s",""+(1-(a?_:0))),N+=w.offsetHeight,_+=.025})}},[a,d,r]),Is.createElement("div",{ref:i,className:"Toastify",id:m,onMouseEnter:()=>{r&&(n(!1),ct.pause())},onMouseLeave:g},l((x,b)=>{const y=b.length?{...c}:{...c,pointerEvents:"none"};return Is.createElement("div",{className:p(x),style:y,key:`container-${x}`},b.map(j=>{let{content:N,props:_}=j;return Is.createElement(fT,{..._,stacked:r,collapseAll:g,isIn:o(_.toastId,_.containerId),style:_.style,key:`toast-${_.key}`},N)}))}))}function uk(t,s){return function(){return t.apply(s,arguments)}}const{toString:vT}=Object.prototype,{getPrototypeOf:Sj}=Object,{iterator:Z0,toStringTag:mk}=Symbol,eg=(t=>s=>{const r=vT.call(s);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Ko=t=>(t=t.toLowerCase(),s=>eg(s)===t),tg=t=>s=>typeof s===t,{isArray:Zh}=Array,qh=tg("undefined");function Wf(t){return t!==null&&!qh(t)&&t.constructor!==null&&!qh(t.constructor)&&cl(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const hk=Ko("ArrayBuffer");function bT(t){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(t):s=t&&t.buffer&&hk(t.buffer),s}const yT=tg("string"),cl=tg("function"),Ak=tg("number"),Gf=t=>t!==null&&typeof t=="object",jT=t=>t===!0||t===!1,qx=t=>{if(eg(t)!=="object")return!1;const s=Sj(t);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(mk in t)&&!(Z0 in t)},NT=t=>{if(!Gf(t)||Wf(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},wT=Ko("Date"),_T=Ko("File"),ST=Ko("Blob"),CT=Ko("FileList"),kT=t=>Gf(t)&&cl(t.pipe),ET=t=>{let s;return t&&(typeof FormData=="function"&&t instanceof FormData||cl(t.append)&&((s=eg(t))==="formdata"||s==="object"&&cl(t.toString)&&t.toString()==="[object FormData]"))},BT=Ko("URLSearchParams"),[FT,TT,IT,LT]=["ReadableStream","Request","Response","Headers"].map(Ko),DT=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Kf(t,s,{allOwnKeys:r=!1}={}){if(t===null||typeof t>"u")return;let a,n;if(typeof t!="object"&&(t=[t]),Zh(t))for(a=0,n=t.length;a<n;a++)s.call(null,t[a],a,t);else{if(Wf(t))return;const i=r?Object.getOwnPropertyNames(t):Object.keys(t),l=i.length;let o;for(a=0;a<l;a++)o=i[a],s.call(null,t[o],o,t)}}function fk(t,s){if(Wf(t))return null;s=s.toLowerCase();const r=Object.keys(t);let a=r.length,n;for(;a-- >0;)if(n=r[a],s===n.toLowerCase())return n;return null}const hm=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,pk=t=>!qh(t)&&t!==hm;function dy(){const{caseless:t,skipUndefined:s}=pk(this)&&this||{},r={},a=(n,i)=>{const l=t&&fk(r,i)||i;qx(r[l])&&qx(n)?r[l]=dy(r[l],n):qx(n)?r[l]=dy({},n):Zh(n)?r[l]=n.slice():(!s||!qh(n))&&(r[l]=n)};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&Kf(arguments[n],a);return r}const PT=(t,s,r,{allOwnKeys:a}={})=>(Kf(s,(n,i)=>{r&&cl(n)?t[i]=uk(n,r):t[i]=n},{allOwnKeys:a}),t),UT=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),RT=(t,s,r,a)=>{t.prototype=Object.create(s.prototype,a),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:s.prototype}),r&&Object.assign(t.prototype,r)},OT=(t,s,r,a)=>{let n,i,l;const o={};if(s=s||{},t==null)return s;do{for(n=Object.getOwnPropertyNames(t),i=n.length;i-- >0;)l=n[i],(!a||a(l,t,s))&&!o[l]&&(s[l]=t[l],o[l]=!0);t=r!==!1&&Sj(t)}while(t&&(!r||r(t,s))&&t!==Object.prototype);return s},MT=(t,s,r)=>{t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=s.length;const a=t.indexOf(s,r);return a!==-1&&a===r},QT=t=>{if(!t)return null;if(Zh(t))return t;let s=t.length;if(!Ak(s))return null;const r=new Array(s);for(;s-- >0;)r[s]=t[s];return r},HT=(t=>s=>t&&s instanceof t)(typeof Uint8Array<"u"&&Sj(Uint8Array)),qT=(t,s)=>{const a=(t&&t[Z0]).call(t);let n;for(;(n=a.next())&&!n.done;){const i=n.value;s.call(t,i[0],i[1])}},$T=(t,s)=>{let r;const a=[];for(;(r=t.exec(s))!==null;)a.push(r);return a},VT=Ko("HTMLFormElement"),WT=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,a,n){return a.toUpperCase()+n}),Aw=(({hasOwnProperty:t})=>(s,r)=>t.call(s,r))(Object.prototype),GT=Ko("RegExp"),xk=(t,s)=>{const r=Object.getOwnPropertyDescriptors(t),a={};Kf(r,(n,i)=>{let l;(l=s(n,i,t))!==!1&&(a[i]=l||n)}),Object.defineProperties(t,a)},KT=t=>{xk(t,(s,r)=>{if(cl(t)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const a=t[r];if(cl(a)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},zT=(t,s)=>{const r={},a=n=>{n.forEach(i=>{r[i]=!0})};return Zh(t)?a(t):a(String(t).split(s)),r},YT=()=>{},XT=(t,s)=>t!=null&&Number.isFinite(t=+t)?t:s;function JT(t){return!!(t&&cl(t.append)&&t[mk]==="FormData"&&t[Z0])}const ZT=t=>{const s=new Array(10),r=(a,n)=>{if(Gf(a)){if(s.indexOf(a)>=0)return;if(Wf(a))return a;if(!("toJSON"in a)){s[n]=a;const i=Zh(a)?[]:{};return Kf(a,(l,o)=>{const d=r(l,n+1);!qh(d)&&(i[o]=d)}),s[n]=void 0,i}}return a};return r(t,0)},eI=Ko("AsyncFunction"),tI=t=>t&&(Gf(t)||cl(t))&&cl(t.then)&&cl(t.catch),gk=((t,s)=>t?setImmediate:s?((r,a)=>(hm.addEventListener("message",({source:n,data:i})=>{n===hm&&i===r&&a.length&&a.shift()()},!1),n=>{a.push(n),hm.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",cl(hm.postMessage)),sI=typeof queueMicrotask<"u"?queueMicrotask.bind(hm):typeof process<"u"&&process.nextTick||gk,rI=t=>t!=null&&cl(t[Z0]),Wt={isArray:Zh,isArrayBuffer:hk,isBuffer:Wf,isFormData:ET,isArrayBufferView:bT,isString:yT,isNumber:Ak,isBoolean:jT,isObject:Gf,isPlainObject:qx,isEmptyObject:NT,isReadableStream:FT,isRequest:TT,isResponse:IT,isHeaders:LT,isUndefined:qh,isDate:wT,isFile:_T,isBlob:ST,isRegExp:GT,isFunction:cl,isStream:kT,isURLSearchParams:BT,isTypedArray:HT,isFileList:CT,forEach:Kf,merge:dy,extend:PT,trim:DT,stripBOM:UT,inherits:RT,toFlatObject:OT,kindOf:eg,kindOfTest:Ko,endsWith:MT,toArray:QT,forEachEntry:qT,matchAll:$T,isHTMLForm:VT,hasOwnProperty:Aw,hasOwnProp:Aw,reduceDescriptors:xk,freezeMethods:KT,toObjectSet:zT,toCamelCase:WT,noop:YT,toFiniteNumber:XT,findKey:fk,global:hm,isContextDefined:pk,isSpecCompliantForm:JT,toJSONObject:ZT,isAsyncFn:eI,isThenable:tI,setImmediate:gk,asap:sI,isIterable:rI};function ir(t,s,r,a,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",s&&(this.code=s),r&&(this.config=r),a&&(this.request=a),n&&(this.response=n,this.status=n.status?n.status:null)}Wt.inherits(ir,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Wt.toJSONObject(this.config),code:this.code,status:this.status}}});const vk=ir.prototype,bk={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{bk[t]={value:t}});Object.defineProperties(ir,bk);Object.defineProperty(vk,"isAxiosError",{value:!0});ir.from=(t,s,r,a,n,i)=>{const l=Object.create(vk);Wt.toFlatObject(t,l,function(c){return c!==Error.prototype},u=>u!=="isAxiosError");const o=t&&t.message?t.message:"Error",d=s==null&&t?t.code:s;return ir.call(l,o,d,r,a,n),t&&l.cause==null&&Object.defineProperty(l,"cause",{value:t,configurable:!0}),l.name=t&&t.name||"Error",i&&Object.assign(l,i),l};const aI=null;function uy(t){return Wt.isPlainObject(t)||Wt.isArray(t)}function yk(t){return Wt.endsWith(t,"[]")?t.slice(0,-2):t}function fw(t,s,r){return t?t.concat(s).map(function(n,i){return n=yk(n),!r&&i?"["+n+"]":n}).join(r?".":""):s}function nI(t){return Wt.isArray(t)&&!t.some(uy)}const iI=Wt.toFlatObject(Wt,{},null,function(s){return/^is[A-Z]/.test(s)});function sg(t,s,r){if(!Wt.isObject(t))throw new TypeError("target must be an object");s=s||new FormData,r=Wt.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,b){return!Wt.isUndefined(b[x])});const a=r.metaTokens,n=r.visitor||c,i=r.dots,l=r.indexes,d=(r.Blob||typeof Blob<"u"&&Blob)&&Wt.isSpecCompliantForm(s);if(!Wt.isFunction(n))throw new TypeError("visitor must be a function");function u(g){if(g===null)return"";if(Wt.isDate(g))return g.toISOString();if(Wt.isBoolean(g))return g.toString();if(!d&&Wt.isBlob(g))throw new ir("Blob is not supported. Use a Buffer instead.");return Wt.isArrayBuffer(g)||Wt.isTypedArray(g)?d&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function c(g,x,b){let y=g;if(g&&!b&&typeof g=="object"){if(Wt.endsWith(x,"{}"))x=a?x:x.slice(0,-2),g=JSON.stringify(g);else if(Wt.isArray(g)&&nI(g)||(Wt.isFileList(g)||Wt.endsWith(x,"[]"))&&(y=Wt.toArray(g)))return x=yk(x),y.forEach(function(N,_){!(Wt.isUndefined(N)||N===null)&&s.append(l===!0?fw([x],_,i):l===null?x:x+"[]",u(N))}),!1}return uy(g)?!0:(s.append(fw(b,x,i),u(g)),!1)}const h=[],m=Object.assign(iI,{defaultVisitor:c,convertValue:u,isVisitable:uy});function p(g,x){if(!Wt.isUndefined(g)){if(h.indexOf(g)!==-1)throw Error("Circular reference detected in "+x.join("."));h.push(g),Wt.forEach(g,function(y,j){(!(Wt.isUndefined(y)||y===null)&&n.call(s,y,Wt.isString(j)?j.trim():j,x,m))===!0&&p(y,x?x.concat(j):[j])}),h.pop()}}if(!Wt.isObject(t))throw new TypeError("data must be an object");return p(t),s}function pw(t){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(a){return s[a]})}function Cj(t,s){this._pairs=[],t&&sg(t,this,s)}const jk=Cj.prototype;jk.append=function(s,r){this._pairs.push([s,r])};jk.toString=function(s){const r=s?function(a){return s.call(this,a,pw)}:pw;return this._pairs.map(function(n){return r(n[0])+"="+r(n[1])},"").join("&")};function lI(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Nk(t,s,r){if(!s)return t;const a=r&&r.encode||lI;Wt.isFunction(r)&&(r={serialize:r});const n=r&&r.serialize;let i;if(n?i=n(s,r):i=Wt.isURLSearchParams(s)?s.toString():new Cj(s,r).toString(a),i){const l=t.indexOf("#");l!==-1&&(t=t.slice(0,l)),t+=(t.indexOf("?")===-1?"?":"&")+i}return t}class xw{constructor(){this.handlers=[]}use(s,r,a){return this.handlers.push({fulfilled:s,rejected:r,synchronous:a?a.synchronous:!1,runWhen:a?a.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){Wt.forEach(this.handlers,function(a){a!==null&&s(a)})}}const wk={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},oI=typeof URLSearchParams<"u"?URLSearchParams:Cj,cI=typeof FormData<"u"?FormData:null,dI=typeof Blob<"u"?Blob:null,uI={isBrowser:!0,classes:{URLSearchParams:oI,FormData:cI,Blob:dI},protocols:["http","https","file","blob","url","data"]},kj=typeof window<"u"&&typeof document<"u",my=typeof navigator=="object"&&navigator||void 0,mI=kj&&(!my||["ReactNative","NativeScript","NS"].indexOf(my.product)<0),hI=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",AI=kj&&window.location.href||"http://localhost",fI=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:kj,hasStandardBrowserEnv:mI,hasStandardBrowserWebWorkerEnv:hI,navigator:my,origin:AI},Symbol.toStringTag,{value:"Module"})),bi={...fI,...uI};function pI(t,s){return sg(t,new bi.classes.URLSearchParams,{visitor:function(r,a,n,i){return bi.isNode&&Wt.isBuffer(r)?(this.append(a,r.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...s})}function xI(t){return Wt.matchAll(/\w+|\[(\w*)]/g,t).map(s=>s[0]==="[]"?"":s[1]||s[0])}function gI(t){const s={},r=Object.keys(t);let a;const n=r.length;let i;for(a=0;a<n;a++)i=r[a],s[i]=t[i];return s}function _k(t){function s(r,a,n,i){let l=r[i++];if(l==="__proto__")return!0;const o=Number.isFinite(+l),d=i>=r.length;return l=!l&&Wt.isArray(n)?n.length:l,d?(Wt.hasOwnProp(n,l)?n[l]=[n[l],a]:n[l]=a,!o):((!n[l]||!Wt.isObject(n[l]))&&(n[l]=[]),s(r,a,n[l],i)&&Wt.isArray(n[l])&&(n[l]=gI(n[l])),!o)}if(Wt.isFormData(t)&&Wt.isFunction(t.entries)){const r={};return Wt.forEachEntry(t,(a,n)=>{s(xI(a),n,r,0)}),r}return null}function vI(t,s,r){if(Wt.isString(t))try{return(s||JSON.parse)(t),Wt.trim(t)}catch(a){if(a.name!=="SyntaxError")throw a}return(r||JSON.stringify)(t)}const zf={transitional:wk,adapter:["xhr","http","fetch"],transformRequest:[function(s,r){const a=r.getContentType()||"",n=a.indexOf("application/json")>-1,i=Wt.isObject(s);if(i&&Wt.isHTMLForm(s)&&(s=new FormData(s)),Wt.isFormData(s))return n?JSON.stringify(_k(s)):s;if(Wt.isArrayBuffer(s)||Wt.isBuffer(s)||Wt.isStream(s)||Wt.isFile(s)||Wt.isBlob(s)||Wt.isReadableStream(s))return s;if(Wt.isArrayBufferView(s))return s.buffer;if(Wt.isURLSearchParams(s))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let o;if(i){if(a.indexOf("application/x-www-form-urlencoded")>-1)return pI(s,this.formSerializer).toString();if((o=Wt.isFileList(s))||a.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return sg(o?{"files[]":s}:s,d&&new d,this.formSerializer)}}return i||n?(r.setContentType("application/json",!1),vI(s)):s}],transformResponse:[function(s){const r=this.transitional||zf.transitional,a=r&&r.forcedJSONParsing,n=this.responseType==="json";if(Wt.isResponse(s)||Wt.isReadableStream(s))return s;if(s&&Wt.isString(s)&&(a&&!this.responseType||n)){const l=!(r&&r.silentJSONParsing)&&n;try{return JSON.parse(s,this.parseReviver)}catch(o){if(l)throw o.name==="SyntaxError"?ir.from(o,ir.ERR_BAD_RESPONSE,this,null,this.response):o}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:bi.classes.FormData,Blob:bi.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Wt.forEach(["delete","get","head","post","put","patch"],t=>{zf.headers[t]={}});const bI=Wt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),yI=t=>{const s={};let r,a,n;return t&&t.split(`
`).forEach(function(l){n=l.indexOf(":"),r=l.substring(0,n).trim().toLowerCase(),a=l.substring(n+1).trim(),!(!r||s[r]&&bI[r])&&(r==="set-cookie"?s[r]?s[r].push(a):s[r]=[a]:s[r]=s[r]?s[r]+", "+a:a)}),s},gw=Symbol("internals");function CA(t){return t&&String(t).trim().toLowerCase()}function $x(t){return t===!1||t==null?t:Wt.isArray(t)?t.map($x):String(t)}function jI(t){const s=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let a;for(;a=r.exec(t);)s[a[1]]=a[2];return s}const NI=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Tv(t,s,r,a,n){if(Wt.isFunction(a))return a.call(this,s,r);if(n&&(s=r),!!Wt.isString(s)){if(Wt.isString(a))return s.indexOf(a)!==-1;if(Wt.isRegExp(a))return a.test(s)}}function wI(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,r,a)=>r.toUpperCase()+a)}function _I(t,s){const r=Wt.toCamelCase(" "+s);["get","set","has"].forEach(a=>{Object.defineProperty(t,a+r,{value:function(n,i,l){return this[a].call(this,s,n,i,l)},configurable:!0})})}let dl=class{constructor(s){s&&this.set(s)}set(s,r,a){const n=this;function i(o,d,u){const c=CA(d);if(!c)throw new Error("header name must be a non-empty string");const h=Wt.findKey(n,c);(!h||n[h]===void 0||u===!0||u===void 0&&n[h]!==!1)&&(n[h||d]=$x(o))}const l=(o,d)=>Wt.forEach(o,(u,c)=>i(u,c,d));if(Wt.isPlainObject(s)||s instanceof this.constructor)l(s,r);else if(Wt.isString(s)&&(s=s.trim())&&!NI(s))l(yI(s),r);else if(Wt.isObject(s)&&Wt.isIterable(s)){let o={},d,u;for(const c of s){if(!Wt.isArray(c))throw TypeError("Object iterator must return a key-value pair");o[u=c[0]]=(d=o[u])?Wt.isArray(d)?[...d,c[1]]:[d,c[1]]:c[1]}l(o,r)}else s!=null&&i(r,s,a);return this}get(s,r){if(s=CA(s),s){const a=Wt.findKey(this,s);if(a){const n=this[a];if(!r)return n;if(r===!0)return jI(n);if(Wt.isFunction(r))return r.call(this,n,a);if(Wt.isRegExp(r))return r.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,r){if(s=CA(s),s){const a=Wt.findKey(this,s);return!!(a&&this[a]!==void 0&&(!r||Tv(this,this[a],a,r)))}return!1}delete(s,r){const a=this;let n=!1;function i(l){if(l=CA(l),l){const o=Wt.findKey(a,l);o&&(!r||Tv(a,a[o],o,r))&&(delete a[o],n=!0)}}return Wt.isArray(s)?s.forEach(i):i(s),n}clear(s){const r=Object.keys(this);let a=r.length,n=!1;for(;a--;){const i=r[a];(!s||Tv(this,this[i],i,s,!0))&&(delete this[i],n=!0)}return n}normalize(s){const r=this,a={};return Wt.forEach(this,(n,i)=>{const l=Wt.findKey(a,i);if(l){r[l]=$x(n),delete r[i];return}const o=s?wI(i):String(i).trim();o!==i&&delete r[i],r[o]=$x(n),a[o]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const r=Object.create(null);return Wt.forEach(this,(a,n)=>{a!=null&&a!==!1&&(r[n]=s&&Wt.isArray(a)?a.join(", "):a)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,r])=>s+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...r){const a=new this(s);return r.forEach(n=>a.set(n)),a}static accessor(s){const a=(this[gw]=this[gw]={accessors:{}}).accessors,n=this.prototype;function i(l){const o=CA(l);a[o]||(_I(n,l),a[o]=!0)}return Wt.isArray(s)?s.forEach(i):i(s),this}};dl.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Wt.reduceDescriptors(dl.prototype,({value:t},s)=>{let r=s[0].toUpperCase()+s.slice(1);return{get:()=>t,set(a){this[r]=a}}});Wt.freezeMethods(dl);function Iv(t,s){const r=this||zf,a=s||r,n=dl.from(a.headers);let i=a.data;return Wt.forEach(t,function(o){i=o.call(r,i,n.normalize(),s?s.status:void 0)}),n.normalize(),i}function Sk(t){return!!(t&&t.__CANCEL__)}function eA(t,s,r){ir.call(this,t??"canceled",ir.ERR_CANCELED,s,r),this.name="CanceledError"}Wt.inherits(eA,ir,{__CANCEL__:!0});function Ck(t,s,r){const a=r.config.validateStatus;!r.status||!a||a(r.status)?t(r):s(new ir("Request failed with status code "+r.status,[ir.ERR_BAD_REQUEST,ir.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function SI(t){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return s&&s[1]||""}function CI(t,s){t=t||10;const r=new Array(t),a=new Array(t);let n=0,i=0,l;return s=s!==void 0?s:1e3,function(d){const u=Date.now(),c=a[i];l||(l=u),r[n]=d,a[n]=u;let h=i,m=0;for(;h!==n;)m+=r[h++],h=h%t;if(n=(n+1)%t,n===i&&(i=(i+1)%t),u-l<s)return;const p=c&&u-c;return p?Math.round(m*1e3/p):void 0}}function kI(t,s){let r=0,a=1e3/s,n,i;const l=(u,c=Date.now())=>{r=c,n=null,i&&(clearTimeout(i),i=null),t(...u)};return[(...u)=>{const c=Date.now(),h=c-r;h>=a?l(u,c):(n=u,i||(i=setTimeout(()=>{i=null,l(n)},a-h)))},()=>n&&l(n)]}const u0=(t,s,r=3)=>{let a=0;const n=CI(50,250);return kI(i=>{const l=i.loaded,o=i.lengthComputable?i.total:void 0,d=l-a,u=n(d),c=l<=o;a=l;const h={loaded:l,total:o,progress:o?l/o:void 0,bytes:d,rate:u||void 0,estimated:u&&o&&c?(o-l)/u:void 0,event:i,lengthComputable:o!=null,[s?"download":"upload"]:!0};t(h)},r)},vw=(t,s)=>{const r=t!=null;return[a=>s[0]({lengthComputable:r,total:t,loaded:a}),s[1]]},bw=t=>(...s)=>Wt.asap(()=>t(...s)),EI=bi.hasStandardBrowserEnv?((t,s)=>r=>(r=new URL(r,bi.origin),t.protocol===r.protocol&&t.host===r.host&&(s||t.port===r.port)))(new URL(bi.origin),bi.navigator&&/(msie|trident)/i.test(bi.navigator.userAgent)):()=>!0,BI=bi.hasStandardBrowserEnv?{write(t,s,r,a,n,i,l){if(typeof document>"u")return;const o=[`${t}=${encodeURIComponent(s)}`];Wt.isNumber(r)&&o.push(`expires=${new Date(r).toUTCString()}`),Wt.isString(a)&&o.push(`path=${a}`),Wt.isString(n)&&o.push(`domain=${n}`),i===!0&&o.push("secure"),Wt.isString(l)&&o.push(`SameSite=${l}`),document.cookie=o.join("; ")},read(t){if(typeof document>"u")return null;const s=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return s?decodeURIComponent(s[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function FI(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function TI(t,s){return s?t.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):t}function kk(t,s,r){let a=!FI(s);return t&&(a||r==!1)?TI(t,s):s}const yw=t=>t instanceof dl?{...t}:t;function Sm(t,s){s=s||{};const r={};function a(u,c,h,m){return Wt.isPlainObject(u)&&Wt.isPlainObject(c)?Wt.merge.call({caseless:m},u,c):Wt.isPlainObject(c)?Wt.merge({},c):Wt.isArray(c)?c.slice():c}function n(u,c,h,m){if(Wt.isUndefined(c)){if(!Wt.isUndefined(u))return a(void 0,u,h,m)}else return a(u,c,h,m)}function i(u,c){if(!Wt.isUndefined(c))return a(void 0,c)}function l(u,c){if(Wt.isUndefined(c)){if(!Wt.isUndefined(u))return a(void 0,u)}else return a(void 0,c)}function o(u,c,h){if(h in s)return a(u,c);if(h in t)return a(void 0,u)}const d={url:i,method:i,data:i,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:o,headers:(u,c,h)=>n(yw(u),yw(c),h,!0)};return Wt.forEach(Object.keys({...t,...s}),function(c){const h=d[c]||n,m=h(t[c],s[c],c);Wt.isUndefined(m)&&h!==o||(r[c]=m)}),r}const Ek=t=>{const s=Sm({},t);let{data:r,withXSRFToken:a,xsrfHeaderName:n,xsrfCookieName:i,headers:l,auth:o}=s;if(s.headers=l=dl.from(l),s.url=Nk(kk(s.baseURL,s.url,s.allowAbsoluteUrls),t.params,t.paramsSerializer),o&&l.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),Wt.isFormData(r)){if(bi.hasStandardBrowserEnv||bi.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if(Wt.isFunction(r.getHeaders)){const d=r.getHeaders(),u=["content-type","content-length"];Object.entries(d).forEach(([c,h])=>{u.includes(c.toLowerCase())&&l.set(c,h)})}}if(bi.hasStandardBrowserEnv&&(a&&Wt.isFunction(a)&&(a=a(s)),a||a!==!1&&EI(s.url))){const d=n&&i&&BI.read(i);d&&l.set(n,d)}return s},II=typeof XMLHttpRequest<"u",LI=II&&function(t){return new Promise(function(r,a){const n=Ek(t);let i=n.data;const l=dl.from(n.headers).normalize();let{responseType:o,onUploadProgress:d,onDownloadProgress:u}=n,c,h,m,p,g;function x(){p&&p(),g&&g(),n.cancelToken&&n.cancelToken.unsubscribe(c),n.signal&&n.signal.removeEventListener("abort",c)}let b=new XMLHttpRequest;b.open(n.method.toUpperCase(),n.url,!0),b.timeout=n.timeout;function y(){if(!b)return;const N=dl.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),F={data:!o||o==="text"||o==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:N,config:t,request:b};Ck(function(w){r(w),x()},function(w){a(w),x()},F),b=null}"onloadend"in b?b.onloadend=y:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(y)},b.onabort=function(){b&&(a(new ir("Request aborted",ir.ECONNABORTED,t,b)),b=null)},b.onerror=function(_){const F=_&&_.message?_.message:"Network Error",I=new ir(F,ir.ERR_NETWORK,t,b);I.event=_||null,a(I),b=null},b.ontimeout=function(){let _=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const F=n.transitional||wk;n.timeoutErrorMessage&&(_=n.timeoutErrorMessage),a(new ir(_,F.clarifyTimeoutError?ir.ETIMEDOUT:ir.ECONNABORTED,t,b)),b=null},i===void 0&&l.setContentType(null),"setRequestHeader"in b&&Wt.forEach(l.toJSON(),function(_,F){b.setRequestHeader(F,_)}),Wt.isUndefined(n.withCredentials)||(b.withCredentials=!!n.withCredentials),o&&o!=="json"&&(b.responseType=n.responseType),u&&([m,g]=u0(u,!0),b.addEventListener("progress",m)),d&&b.upload&&([h,p]=u0(d),b.upload.addEventListener("progress",h),b.upload.addEventListener("loadend",p)),(n.cancelToken||n.signal)&&(c=N=>{b&&(a(!N||N.type?new eA(null,t,b):N),b.abort(),b=null)},n.cancelToken&&n.cancelToken.subscribe(c),n.signal&&(n.signal.aborted?c():n.signal.addEventListener("abort",c)));const j=SI(n.url);if(j&&bi.protocols.indexOf(j)===-1){a(new ir("Unsupported protocol "+j+":",ir.ERR_BAD_REQUEST,t));return}b.send(i||null)})},DI=(t,s)=>{const{length:r}=t=t?t.filter(Boolean):[];if(s||r){let a=new AbortController,n;const i=function(u){if(!n){n=!0,o();const c=u instanceof Error?u:this.reason;a.abort(c instanceof ir?c:new eA(c instanceof Error?c.message:c))}};let l=s&&setTimeout(()=>{l=null,i(new ir(`timeout ${s} of ms exceeded`,ir.ETIMEDOUT))},s);const o=()=>{t&&(l&&clearTimeout(l),l=null,t.forEach(u=>{u.unsubscribe?u.unsubscribe(i):u.removeEventListener("abort",i)}),t=null)};t.forEach(u=>u.addEventListener("abort",i));const{signal:d}=a;return d.unsubscribe=()=>Wt.asap(o),d}},PI=function*(t,s){let r=t.byteLength;if(r<s){yield t;return}let a=0,n;for(;a<r;)n=a+s,yield t.slice(a,n),a=n},UI=async function*(t,s){for await(const r of RI(t))yield*PI(r,s)},RI=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const s=t.getReader();try{for(;;){const{done:r,value:a}=await s.read();if(r)break;yield a}}finally{await s.cancel()}},jw=(t,s,r,a)=>{const n=UI(t,s);let i=0,l,o=d=>{l||(l=!0,a&&a(d))};return new ReadableStream({async pull(d){try{const{done:u,value:c}=await n.next();if(u){o(),d.close();return}let h=c.byteLength;if(r){let m=i+=h;r(m)}d.enqueue(new Uint8Array(c))}catch(u){throw o(u),u}},cancel(d){return o(d),n.return()}},{highWaterMark:2})},Nw=64*1024,{isFunction:Kp}=Wt,OI=(({Request:t,Response:s})=>({Request:t,Response:s}))(Wt.global),{ReadableStream:ww,TextEncoder:_w}=Wt.global,Sw=(t,...s)=>{try{return!!t(...s)}catch{return!1}},MI=t=>{t=Wt.merge.call({skipUndefined:!0},OI,t);const{fetch:s,Request:r,Response:a}=t,n=s?Kp(s):typeof fetch=="function",i=Kp(r),l=Kp(a);if(!n)return!1;const o=n&&Kp(ww),d=n&&(typeof _w=="function"?(g=>x=>g.encode(x))(new _w):async g=>new Uint8Array(await new r(g).arrayBuffer())),u=i&&o&&Sw(()=>{let g=!1;const x=new r(bi.origin,{body:new ww,method:"POST",get duplex(){return g=!0,"half"}}).headers.has("Content-Type");return g&&!x}),c=l&&o&&Sw(()=>Wt.isReadableStream(new a("").body)),h={stream:c&&(g=>g.body)};n&&["text","arrayBuffer","blob","formData","stream"].forEach(g=>{!h[g]&&(h[g]=(x,b)=>{let y=x&&x[g];if(y)return y.call(x);throw new ir(`Response type '${g}' is not supported`,ir.ERR_NOT_SUPPORT,b)})});const m=async g=>{if(g==null)return 0;if(Wt.isBlob(g))return g.size;if(Wt.isSpecCompliantForm(g))return(await new r(bi.origin,{method:"POST",body:g}).arrayBuffer()).byteLength;if(Wt.isArrayBufferView(g)||Wt.isArrayBuffer(g))return g.byteLength;if(Wt.isURLSearchParams(g)&&(g=g+""),Wt.isString(g))return(await d(g)).byteLength},p=async(g,x)=>{const b=Wt.toFiniteNumber(g.getContentLength());return b??m(x)};return async g=>{let{url:x,method:b,data:y,signal:j,cancelToken:N,timeout:_,onDownloadProgress:F,onUploadProgress:I,responseType:w,headers:E,withCredentials:W="same-origin",fetchOptions:R}=Ek(g),U=s||fetch;w=w?(w+"").toLowerCase():"text";let T=DI([j,N&&N.toAbortSignal()],_),Y=null;const H=T&&T.unsubscribe&&(()=>{T.unsubscribe()});let M;try{if(I&&u&&b!=="get"&&b!=="head"&&(M=await p(E,y))!==0){let P=new r(x,{method:"POST",body:y,duplex:"half"}),C;if(Wt.isFormData(y)&&(C=P.headers.get("content-type"))&&E.setContentType(C),P.body){const[k,B]=vw(M,u0(bw(I)));y=jw(P.body,Nw,k,B)}}Wt.isString(W)||(W=W?"include":"omit");const q=i&&"credentials"in r.prototype,z={...R,signal:T,method:b.toUpperCase(),headers:E.normalize().toJSON(),body:y,duplex:"half",credentials:q?W:void 0};Y=i&&new r(x,z);let Q=await(i?U(Y,R):U(x,z));const L=c&&(w==="stream"||w==="response");if(c&&(F||L&&H)){const P={};["status","statusText","headers"].forEach(G=>{P[G]=Q[G]});const C=Wt.toFiniteNumber(Q.headers.get("content-length")),[k,B]=F&&vw(C,u0(bw(F),!0))||[];Q=new a(jw(Q.body,Nw,k,()=>{B&&B(),H&&H()}),P)}w=w||"text";let V=await h[Wt.findKey(h,w)||"text"](Q,g);return!L&&H&&H(),await new Promise((P,C)=>{Ck(P,C,{data:V,headers:dl.from(Q.headers),status:Q.status,statusText:Q.statusText,config:g,request:Y})})}catch(q){throw H&&H(),q&&q.name==="TypeError"&&/Load failed|fetch/i.test(q.message)?Object.assign(new ir("Network Error",ir.ERR_NETWORK,g,Y),{cause:q.cause||q}):ir.from(q,q&&q.code,g,Y)}}},QI=new Map,Bk=t=>{let s=t&&t.env||{};const{fetch:r,Request:a,Response:n}=s,i=[a,n,r];let l=i.length,o=l,d,u,c=QI;for(;o--;)d=i[o],u=c.get(d),u===void 0&&c.set(d,u=o?new Map:MI(s)),c=u;return u};Bk();const Ej={http:aI,xhr:LI,fetch:{get:Bk}};Wt.forEach(Ej,(t,s)=>{if(t){try{Object.defineProperty(t,"name",{value:s})}catch{}Object.defineProperty(t,"adapterName",{value:s})}});const Cw=t=>`- ${t}`,HI=t=>Wt.isFunction(t)||t===null||t===!1;function qI(t,s){t=Wt.isArray(t)?t:[t];const{length:r}=t;let a,n;const i={};for(let l=0;l<r;l++){a=t[l];let o;if(n=a,!HI(a)&&(n=Ej[(o=String(a)).toLowerCase()],n===void 0))throw new ir(`Unknown adapter '${o}'`);if(n&&(Wt.isFunction(n)||(n=n.get(s))))break;i[o||"#"+l]=n}if(!n){const l=Object.entries(i).map(([d,u])=>`adapter ${d} `+(u===!1?"is not supported by the environment":"is not available in the build"));let o=r?l.length>1?`since :
`+l.map(Cw).join(`
`):" "+Cw(l[0]):"as no adapter specified";throw new ir("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n}const Fk={getAdapter:qI,adapters:Ej};function Lv(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new eA(null,t)}function kw(t){return Lv(t),t.headers=dl.from(t.headers),t.data=Iv.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Fk.getAdapter(t.adapter||zf.adapter,t)(t).then(function(a){return Lv(t),a.data=Iv.call(t,t.transformResponse,a),a.headers=dl.from(a.headers),a},function(a){return Sk(a)||(Lv(t),a&&a.response&&(a.response.data=Iv.call(t,t.transformResponse,a.response),a.response.headers=dl.from(a.response.headers))),Promise.reject(a)})}const Tk="1.13.2",rg={};["object","boolean","number","function","string","symbol"].forEach((t,s)=>{rg[t]=function(a){return typeof a===t||"a"+(s<1?"n ":" ")+t}});const Ew={};rg.transitional=function(s,r,a){function n(i,l){return"[Axios v"+Tk+"] Transitional option '"+i+"'"+l+(a?". "+a:"")}return(i,l,o)=>{if(s===!1)throw new ir(n(l," has been removed"+(r?" in "+r:"")),ir.ERR_DEPRECATED);return r&&!Ew[l]&&(Ew[l]=!0,console.warn(n(l," has been deprecated since v"+r+" and will be removed in the near future"))),s?s(i,l,o):!0}};rg.spelling=function(s){return(r,a)=>(console.warn(`${a} is likely a misspelling of ${s}`),!0)};function $I(t,s,r){if(typeof t!="object")throw new ir("options must be an object",ir.ERR_BAD_OPTION_VALUE);const a=Object.keys(t);let n=a.length;for(;n-- >0;){const i=a[n],l=s[i];if(l){const o=t[i],d=o===void 0||l(o,i,t);if(d!==!0)throw new ir("option "+i+" must be "+d,ir.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new ir("Unknown option "+i,ir.ERR_BAD_OPTION)}}const Vx={assertOptions:$I,validators:rg},fc=Vx.validators;let gm=class{constructor(s){this.defaults=s||{},this.interceptors={request:new xw,response:new xw}}async request(s,r){try{return await this._request(s,r)}catch(a){if(a instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const i=n.stack?n.stack.replace(/^.+\n/,""):"";try{a.stack?i&&!String(a.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(a.stack+=`
`+i):a.stack=i}catch{}}throw a}}_request(s,r){typeof s=="string"?(r=r||{},r.url=s):r=s||{},r=Sm(this.defaults,r);const{transitional:a,paramsSerializer:n,headers:i}=r;a!==void 0&&Vx.assertOptions(a,{silentJSONParsing:fc.transitional(fc.boolean),forcedJSONParsing:fc.transitional(fc.boolean),clarifyTimeoutError:fc.transitional(fc.boolean)},!1),n!=null&&(Wt.isFunction(n)?r.paramsSerializer={serialize:n}:Vx.assertOptions(n,{encode:fc.function,serialize:fc.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Vx.assertOptions(r,{baseUrl:fc.spelling("baseURL"),withXsrfToken:fc.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let l=i&&Wt.merge(i.common,i[r.method]);i&&Wt.forEach(["delete","get","head","post","put","patch","common"],g=>{delete i[g]}),r.headers=dl.concat(l,i);const o=[];let d=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(r)===!1||(d=d&&x.synchronous,o.unshift(x.fulfilled,x.rejected))});const u=[];this.interceptors.response.forEach(function(x){u.push(x.fulfilled,x.rejected)});let c,h=0,m;if(!d){const g=[kw.bind(this),void 0];for(g.unshift(...o),g.push(...u),m=g.length,c=Promise.resolve(r);h<m;)c=c.then(g[h++],g[h++]);return c}m=o.length;let p=r;for(;h<m;){const g=o[h++],x=o[h++];try{p=g(p)}catch(b){x.call(this,b);break}}try{c=kw.call(this,p)}catch(g){return Promise.reject(g)}for(h=0,m=u.length;h<m;)c=c.then(u[h++],u[h++]);return c}getUri(s){s=Sm(this.defaults,s);const r=kk(s.baseURL,s.url,s.allowAbsoluteUrls);return Nk(r,s.params,s.paramsSerializer)}};Wt.forEach(["delete","get","head","options"],function(s){gm.prototype[s]=function(r,a){return this.request(Sm(a||{},{method:s,url:r,data:(a||{}).data}))}});Wt.forEach(["post","put","patch"],function(s){function r(a){return function(i,l,o){return this.request(Sm(o||{},{method:s,headers:a?{"Content-Type":"multipart/form-data"}:{},url:i,data:l}))}}gm.prototype[s]=r(),gm.prototype[s+"Form"]=r(!0)});let VI=class Ik{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(i){r=i});const a=this;this.promise.then(n=>{if(!a._listeners)return;let i=a._listeners.length;for(;i-- >0;)a._listeners[i](n);a._listeners=null}),this.promise.then=n=>{let i;const l=new Promise(o=>{a.subscribe(o),i=o}).then(n);return l.cancel=function(){a.unsubscribe(i)},l},s(function(i,l,o){a.reason||(a.reason=new eA(i,l,o),r(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const r=this._listeners.indexOf(s);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const s=new AbortController,r=a=>{s.abort(a)};return this.subscribe(r),s.signal.unsubscribe=()=>this.unsubscribe(r),s.signal}static source(){let s;return{token:new Ik(function(n){s=n}),cancel:s}}};function WI(t){return function(r){return t.apply(null,r)}}function GI(t){return Wt.isObject(t)&&t.isAxiosError===!0}const hy={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(hy).forEach(([t,s])=>{hy[s]=t});function Lk(t){const s=new gm(t),r=uk(gm.prototype.request,s);return Wt.extend(r,gm.prototype,s,{allOwnKeys:!0}),Wt.extend(r,s,null,{allOwnKeys:!0}),r.create=function(n){return Lk(Sm(t,n))},r}const Ya=Lk(zf);Ya.Axios=gm;Ya.CanceledError=eA;Ya.CancelToken=VI;Ya.isCancel=Sk;Ya.VERSION=Tk;Ya.toFormData=sg;Ya.AxiosError=ir;Ya.Cancel=Ya.CanceledError;Ya.all=function(s){return Promise.all(s)};Ya.spread=WI;Ya.isAxiosError=GI;Ya.mergeConfig=Sm;Ya.AxiosHeaders=dl;Ya.formToJSON=t=>_k(Wt.isHTMLForm(t)?new FormData(t):t);Ya.getAdapter=Fk.getAdapter;Ya.HttpStatusCode=hy;Ya.default=Ya;const{Axios:kre,AxiosError:Ere,CanceledError:Bre,isCancel:Fre,CancelToken:Tre,VERSION:Ire,all:Lre,Cancel:Dre,isAxiosError:Pre,spread:Ure,toFormData:Rre,AxiosHeaders:Ore,HttpStatusCode:Mre,formToJSON:Qre,getAdapter:Hre,mergeConfig:qre}=Ya;function KI(){const t=self.crypto||window.crypto;if(t!=null&&t.randomUUID)return t.randomUUID();const s=new Uint8Array(16);((t==null?void 0:t.getRandomValues)||(n=>n))(s),s[6]=s[6]&15|64,s[8]=s[8]&63|128;const a=Array.from(s,n=>n.toString(16).padStart(2,"0")).join("");return`${a.slice(0,8)}-${a.slice(8,12)}-${a.slice(12,16)}-${a.slice(16,20)}-${a.slice(20)}`}const zI="omnisuite_offline",YI=1,Sc="queue";function ag(){return new Promise((t,s)=>{const r=indexedDB.open(zI,YI);r.onupgradeneeded=a=>{const n=r.result;if(!n.objectStoreNames.contains(Sc)){const i=n.createObjectStore(Sc,{keyPath:"id"});i.createIndex("status","status",{unique:!1}),i.createIndex("createdAt","createdAt",{unique:!1})}},r.onsuccess=()=>t(r.result),r.onerror=()=>s(r.error)})}async function Dk(t){const s=await ag();return new Promise((r,a)=>{const n=s.transaction(Sc,"readwrite");n.objectStore(Sc).put(t),n.oncomplete=()=>r(t),n.onerror=()=>a(n.error)})}async function XI(){const t=await ag();return new Promise((s,r)=>{const l=t.transaction(Sc,"readonly").objectStore(Sc).index("status").getAll("pending");l.onsuccess=()=>s(l.result||[]),l.onerror=()=>r(l.error)})}async function Bw(t,s,r){const a=await ag();return new Promise((n,i)=>{const l=a.transaction(Sc,"readwrite"),o=l.objectStore(Sc),d=o.get(t);d.onsuccess=()=>{const u=d.result;if(!u)return n(null);u.status=s,u.response=r||null,o.put(u)},l.oncomplete=()=>n(!0),l.onerror=()=>i(l.error)})}async function Bj(){const t=await ag();return new Promise((s,r)=>{const i=t.transaction(Sc,"readonly").objectStore(Sc).getAll();i.onsuccess=()=>s(i.result||[]),i.onerror=()=>r(i.error)})}const JI=5;let Wx=[],Fl={pending:0,failed:0,completed:0,items:[]},Dv=!1,Fw=null;function Yf(t,s){Fl=(s==null?void 0:s.snapshot)||Fl;for(const r of Wx)try{r({event:t,payload:s,snapshot:Fl})}catch{}}async function $h(){const t=await Bj(),s=t.filter(n=>n.status==="pending").length,r=t.filter(n=>n.status==="failed").length,a=t.filter(n=>n.status==="completed").length;Fl={pending:s,failed:r,completed:a,items:t},Yf("update",{snapshot:Fl})}function ZI(t){return Wx.push(t),t({event:"init",payload:{},snapshot:Fl}),()=>{Wx=Wx.filter(s=>s!==t)}}function Pk(){return Fl}async function eL({method:t,url:s,data:r,headers:a}){const n=KI(),i={id:n,method:t,url:s,data:r,headers:{...a||{},"x-idempotency-key":n,"x-transaction-id":n},status:"pending",retries:0,createdAt:Date.now()};return await Dk(i),await $h(),Yf("queued",{id:n,item:i,snapshot:Fl}),navigator.onLine&&MA(),{id:n,queued:!0,offline:!navigator.onLine}}async function Fj(t){try{const s=await Z.request({method:t.method,url:t.url,data:t.data,headers:t.headers});return await Bw(t.id,"completed",(s==null?void 0:s.data)||null),await $h(),!0}catch{if(t.retries+=1,t.retries>=JI)return await Bw(t.id,"failed",null),await $h(),!1;const s=Math.min(3e4,1e3*2**t.retries);return await new Promise(r=>setTimeout(r,s)),Fj(t)}}async function MA(){if(Dv)return;Dv=!0;const t=await XI();for(const s of t)await Fj(s);await $h(),Yf("synced",{snapshot:Fl}),Dv=!1}function tL(){window.addEventListener("online",()=>{rL(),MA()}),navigator.onLine&&MA(),Fw||(Fw=setInterval(()=>{navigator.onLine&&MA()},3e4)),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&navigator.onLine&&MA()})}async function sL(t){const r=(Fl.items||await Bj()).find(a=>a.id===t);return r?(r.retries=0,r.status="pending",await Dk(r),await $h(),Yf("retry",{id:t,snapshot:Fl}),Fj(r)):!1}async function rL(){const s=(Fl.items||await Bj()).filter(r=>r.status==="failed");for(const r of s)await sL(r.id);await $h(),Yf("retryAll",{snapshot:Fl})}const Z=Ya.create({headers:{"Content-Type":"application/json"},transformRequest:[(t,s)=>t&&typeof t=="object"&&!(t instanceof FormData)?JSON.stringify(t):t]}),aL="";let ld=aL;ld&&(/^https?:\/\//i.test(ld)||(ld=ld.startsWith("/")?ld:`/${ld}`));const nL=typeof window<"u"&&window.location?String(window.location.hostname||""):"";ld||/^serianamart\.omnisuite-erp\.com$/i.test(nL)&&(ld="https://serianaserver.omnisuite-erp.com/api");Z.defaults.baseURL=ld||"/api";tL();Z.interceptors.request.use(async t=>{var r,a,n;const s=String(t.method||"get").toLowerCase();if(["post","put","patch","delete"].includes(s)){const i=(t==null?void 0:t.__skipOfflineQueue)===!0||((r=t==null?void 0:t.headers)==null?void 0:r["x-skip-offline-queue"])==="1"||((a=t==null?void 0:t.headers)==null?void 0:a["x-skip-offline-queue"])===1||((n=t==null?void 0:t.headers)==null?void 0:n["x-skip-offline-queue"])===!0;if(!navigator.onLine&&!i){const l=await eL({method:s,url:t.url,data:t.data,headers:t.headers});return Promise.reject({isOfflineQueued:!0,queued:l,config:t,snapshot:Pk()})}}return t},t=>Promise.reject(t));Z.interceptors.request.use(t=>{const s=localStorage.getItem("token");return s&&!new Set(["/register","/login"]).has(String(t.url||""))&&(t.headers.Authorization=`Bearer ${s}`),t},t=>Promise.reject(t));Z.interceptors.response.use(t=>t&&typeof t=="object"?t:{data:t,status:200,statusText:"OK",headers:{},config:(t==null?void 0:t.config)||{}},t=>{var s,r,a,n;return t&&t.isOfflineQueued?Promise.resolve({data:{queued:!0,offline:!0,id:(s=t.queued)==null?void 0:s.id,snapshot:t.snapshot},status:202,statusText:"Accepted (queued)",headers:{},config:t.config}):(((r=t.response)==null?void 0:r.status)===401&&((n=(a=t.config)==null?void 0:a.headers)!=null&&n.Authorization)&&(localStorage.clear(),window.location.href="/login"),Promise.reject({message:t.message,response:t.response,config:t.config,isAxiosError:!0}))});function Tw(t){t?Z.defaults.headers.common.Authorization=`Bearer ${t}`:delete Z.defaults.headers.common.Authorization}function iL({companyId:t,branchId:s}){t&&(Z.defaults.headers.common["x-company-id"]=String(t)),s&&(Z.defaults.headers.common["x-branch-id"]=String(s))}function lL(t){const s=t&&typeof t.id<"u"?Number(t.id):t&&typeof t.sub<"u"?Number(t.sub):null;s&&Number.isFinite(s)?Z.defaults.headers.common["x-user-id"]=String(s):delete Z.defaults.headers.common["x-user-id"]}const Uk=f.createContext(null),Pv="omnisuite.auth";function oL({children:t}){const[s,r]=f.useState(null),[a,n]=f.useState({sub:0,id:0,username:"dev",email:"dev@local",permissions:["*"],companyIds:[1],branchIds:[1]}),[i,l]=f.useState({companyId:1,branchId:1}),[o,d]=f.useState(!1),[u,c]=f.useState({patterns:[],modules:[]});f.useEffect(()=>{const b=localStorage.getItem(Pv);if(b)try{const y=JSON.parse(b);y!=null&&y.token&&(r(y.token),n(y.user||null),l(y.scope||{companyId:1,branchId:1}))}catch{}d(!0)},[]),f.useLayoutEffect(()=>{Tw(s)},[s]),f.useLayoutEffect(()=>{iL(i)},[i]),f.useLayoutEffect(()=>{lL(a||null)},[a]),f.useEffect(()=>{localStorage.setItem(Pv,JSON.stringify({token:s,user:a,scope:i}))},[s,a,i]);async function h({username:b,password:y}){const j=await Z.post("/login",{username:b,password:y});return r(j.data.token),n(j.data.user),c({patterns:[],modules:[]}),j.data}f.useEffect(()=>{c({patterns:[],modules:[]})},[s,a]);async function m(){try{if(typeof window<"u"&&"serviceWorker"in navigator){const y=await(await navigator.serviceWorker.ready).pushManager.getSubscription();if(y&&y.endpoint){try{await Z.delete("/push/unsubscribe",{data:{subscription:y.toJSON()}})}catch{}try{await y.unsubscribe()}catch{}}}}catch{}r(null),n(null),l({companyId:1,branchId:1}),Tw(null);try{localStorage.removeItem(Pv)}catch{}c({patterns:[],modules:[]})}function p(b,y="view"){if(!Array.isArray(u.patterns)||u.patterns.length===0)return!1;const j=String(b||""),N=u.patterns.find(_=>_.pattern===j)||u.patterns.find(_=>_.regex.test(j));return N?y==="create"?!!N.can_create:y==="edit"?!!N.can_edit:y==="delete"?!!N.can_delete:!!N.can_view:!1}function g(b){if(!Array.isArray(u.modules)||u.modules.length===0)return!1;const y=String(b||""),j=y.toLowerCase().trim();let N=y;if(j.includes("administration")?N="Administration":j.includes("inventory")?N="Inventory":j.includes("sales")?N="Sales":j.includes("purchase")?N="Purchase":j.includes("finance")?N="Finance":j.includes("human resources")?N="Human Resources":j.includes("project management")?N="Project Management":j.includes("service management")?N="Service Management":j.includes("maintenance")?N="Maintenance":j.includes("production")?N="Production":j.includes("business intelligence")?N="Business Intelligence":j.includes("pos")&&(N="POS"),u.modules.includes(N)||u.modules.includes(y))return!0;const _=Array.isArray(u.patterns)?u.patterns:[],F=I=>_.some(w=>w.can_view&&String(w.pattern||w.path||"").startsWith(I));return N==="Administration"?F("/administration/"):N==="Inventory"?F("/inventory/"):N==="Sales"?F("/sales/"):N==="Purchase"?F("/purchase/"):N==="Finance"?F("/finance/"):N==="Human Resources"?F("/human-resources/"):N==="Project Management"?F("/project-management/"):N==="Service Management"?F("/service-management/"):N==="Maintenance"?F("/maintenance/"):N==="Production"?F("/production/"):N==="Business Intelligence"?F("/business-intelligence/"):N==="POS"?F("/pos/"):!1}const x=f.useMemo(()=>({token:s,user:a,scope:i,initialized:o,setScope:l,login:h,logout:m,hasAccess:p,hasModuleAccess:g}),[s,a,i,o,u]);return e.jsx(Uk.Provider,{value:x,children:t})}function Kr(){const t=f.useContext(Uk);return t||{token:null,user:null,scope:{companyId:1,branchId:1},initialized:!0,setScope:()=>{},login:async()=>({}),logout:()=>{},hasAccess:()=>!0,hasModuleAccess:()=>!0}}const Bn={administration:{name:"Administration",icon:"",features:[{key:"users",label:"User Management",type:"feature"},{key:"user-permissions",label:"User Permissions",type:"feature"},{key:"user-overrides",label:"Exceptional Permissions",type:"feature"},{key:"roles",label:"Role Setup",type:"feature"},{key:"companies",label:"Company Setup",type:"feature"},{key:"branches",label:"Branch Setup",type:"feature"},{key:"workflows",label:"Workflows",type:"feature"},{key:"templates",label:"Document Templates",type:"feature"},{key:"reports",label:"System Reports",type:"feature"},{key:"settings",label:"System Settings",type:"feature"}],dashboards:[{key:"system-overview",label:"System Overview Dashboard",type:"dashboard"},{key:"user-activity",label:"User Activity Dashboard",type:"dashboard"}]},sales:{name:"Sales",icon:"",features:[{key:"quotations",label:"Quotations",type:"feature"},{key:"sales-orders",label:"Sales Orders",type:"feature"},{key:"invoices",label:"Invoices",type:"feature"},{key:"delivery",label:"Delivery Management",type:"feature"},{key:"customers",label:"Customer Management",type:"feature"},{key:"reports",label:"Sales Reports",type:"feature"},{key:"returns",label:"Sales Returns",type:"feature"},{key:"price-setup",label:"Price Setup",type:"feature"},{key:"discount-schemes",label:"Discount Schemes",type:"feature"},{key:"customer-credit",label:"Customer Credit",type:"feature"},{key:"bulk-upload",label:"Bulk Customer Upload",type:"feature"}],dashboards:[{key:"sales-overview",label:"Sales Overview Dashboard",type:"dashboard"},{key:"revenue-analytics",label:"Revenue Analytics Dashboard",type:"dashboard"},{key:"customer-analytics",label:"Customer Analytics Dashboard",type:"dashboard"}]},purchase:{name:"Purchase",icon:"",features:[{key:"direct-purchase",label:"Direct Purchase",type:"feature"},{key:"rfqs",label:"Request for Quotation",type:"feature"},{key:"supplier-quotations",label:"Supplier Quotations",type:"feature"},{key:"quotation-analysis",label:"Quotation Analysis",type:"feature"},{key:"purchase-orders-local",label:"Local Purchase Orders",type:"feature"},{key:"purchase-orders-import",label:"Import Purchase Orders",type:"feature"},{key:"shipping-advice",label:"Shipping Advice",type:"feature"},{key:"port-clearances",label:"Port Clearances",type:"feature"},{key:"purchase-bills-local",label:"Local Purchase Bills",type:"feature"},{key:"purchase-bills-import",label:"Import Purchase Bills",type:"feature"},{key:"suppliers",label:"Suppliers",type:"feature"},{key:"reports",label:"Reports",type:"feature"}],dashboards:[{key:"procurement-overview",label:"Procurement Overview Dashboard",type:"dashboard"},{key:"supplier-analytics",label:"Supplier Analytics Dashboard",type:"dashboard"}]},inventory:{name:"Inventory",icon:"",features:[{key:"material-requisitions",label:"Material Requisitions",type:"feature"},{key:"stock-upload",label:"Stock Upload",type:"feature"},{key:"stock-updation",label:"Stock Updation",type:"feature"},{key:"stock-adjustment",label:"Stock Adjustment",type:"feature"},{key:"stock-transfer",label:"Stock Transfer",type:"feature"},{key:"items",label:"Item Management",type:"feature"},{key:"categories",label:"Item Categories",type:"feature"},{key:"warehouses",label:"Warehouse Management",type:"feature"},{key:"stock-taking",label:"Stock Taking",type:"feature"},{key:"reports",label:"Inventory Reports",type:"feature"}],dashboards:[{key:"inventory-overview",label:"Inventory Overview Dashboard",type:"dashboard"},{key:"stock-analytics",label:"Stock Analytics Dashboard",type:"dashboard"}]},finance:{name:"Finance",icon:"",features:[{key:"journal-voucher",label:"Journal Entry",type:"feature"},{key:"payment-voucher",label:"Make Payment",type:"feature"},{key:"receipt-voucher",label:"Receive Payment",type:"feature"},{key:"contra-voucher",label:"Contra Entry",type:"feature"},{key:"chart-of-accounts",label:"Chart of Accounts",type:"feature"},{key:"account-groups",label:"Account Groups",type:"feature"},{key:"fiscal-years",label:"Fiscal Years",type:"feature"},{key:"budget",label:"Budget Management",type:"feature"},{key:"bank-reconciliation",label:"Bank Reconciliation",type:"feature"},{key:"fixed-assets",label:"Fixed Assets",type:"feature"}],dashboards:[{key:"financial-overview",label:"Financial Overview Dashboard",type:"dashboard"},{key:"cash-flow",label:"Cash Flow Dashboard",type:"dashboard"},{key:"budget-analysis",label:"Budget Analysis Dashboard",type:"dashboard"}]},"human-resources":{name:"Human Resources",icon:"",features:[{key:"employees",label:"Employee Setup",type:"feature"},{key:"departments",label:"Departments",type:"feature"},{key:"designations",label:"Designations",type:"feature"},{key:"attendance",label:"Attendance Management",type:"feature"},{key:"leave-setup",label:"Leave Setup",type:"feature"},{key:"leave-management",label:"Leave Management",type:"feature"},{key:"payroll",label:"Payroll Processing",type:"feature"},{key:"promotions",label:"Promotions",type:"feature"},{key:"medical-policies",label:"Medical Policies",type:"feature"},{key:"hr-reports",label:"HR Reports",type:"feature"}],dashboards:[{key:"hr-overview",label:"HR Overview Dashboard",type:"dashboard"},{key:"attendance-dashboard",label:"Attendance Dashboard",type:"dashboard"},{key:"payroll-dashboard",label:"Payroll Dashboard",type:"dashboard"}]},maintenance:{name:"Maintenance",icon:"",features:[{key:"assets",label:"Asset Management",type:"feature"},{key:"work-orders",label:"Work Orders",type:"feature"},{key:"pm-schedules",label:"PM Schedules",type:"feature"},{key:"maintenance-reports",label:"Maintenance Reports",type:"feature"}],dashboards:[{key:"maintenance-overview",label:"Maintenance Overview Dashboard",type:"dashboard"},{key:"asset-analytics",label:"Asset Analytics Dashboard",type:"dashboard"}]},production:{name:"Production",icon:"",features:[{key:"bom",label:"Bills of Materials",type:"feature"},{key:"work-orders",label:"Work Orders",type:"feature"},{key:"production-planning",label:"Production Planning",type:"feature"},{key:"job-cards",label:"Job Cards",type:"feature"},{key:"production-reports",label:"Production Reports",type:"feature"}],dashboards:[{key:"production-overview",label:"Production Overview Dashboard",type:"dashboard"},{key:"efficiency-analytics",label:"Efficiency Analytics Dashboard",type:"dashboard"}]},"project-management":{name:"Project Management",icon:"",features:[{key:"projects",label:"Projects",type:"feature"},{key:"tasks",label:"Task Management",type:"feature"},{key:"milestones",label:"Milestones",type:"feature"},{key:"resources",label:"Resource Management",type:"feature"},{key:"project-reports",label:"Project Reports",type:"feature"}],dashboards:[{key:"project-overview",label:"Project Overview Dashboard",type:"dashboard"},{key:"resource-utilization",label:"Resource Utilization Dashboard",type:"dashboard"}]},pos:{name:"Point of Sale",icon:"",features:[{key:"sales-entry",label:"Sales Entry",type:"feature"},{key:"day-management",label:"Start/End Business Day",type:"feature"},{key:"cash-collection",label:"Cash Collection",type:"feature"},{key:"invoices",label:"POS Invoices",type:"feature"},{key:"post-to-finance",label:"Post to Finance",type:"feature"},{key:"returns",label:"POS Returns",type:"feature"},{key:"register",label:"POS Register",type:"feature"},{key:"setup",label:"POS Setup",type:"feature"}],dashboards:[{key:"pos-overview",label:"POS Overview Dashboard",type:"dashboard"},{key:"sales-analytics",label:"Sales Analytics Dashboard",type:"dashboard"}]},"business-intelligence":{name:"Business Intelligence",icon:"",features:[{key:"dashboards",label:"Dashboard Management",type:"feature"},{key:"reports",label:"Custom Reports",type:"feature"},{key:"data-sources",label:"Data Sources",type:"feature"},{key:"analytics",label:"Analytics",type:"feature"}],dashboards:[{key:"bi-overview",label:"BI Overview Dashboard",type:"dashboard"},{key:"executive-dashboard",label:"Executive Dashboard",type:"dashboard"}]},"service-management":{name:"Service Management",icon:"",features:[{key:"service-requests",label:"Service Requests",type:"feature"},{key:"service-confirmations",label:"Service Confirmations",type:"feature"},{key:"billing",label:"Service Billing",type:"feature"},{key:"service-reports",label:"Service Reports",type:"feature"}],dashboards:[{key:"service-overview",label:"Service Overview Dashboard",type:"dashboard"},{key:"billing-analytics",label:"Billing Analytics Dashboard",type:"dashboard"}]}};function Iw(){return Object.keys(Bn)}function Uv(t){const s=Bn[t];return s?s.features.map(r=>({module_key:t,feature_key:`${t}:${r.key}`,label:r.label,type:r.type,path:`/${t}/${r.key}`})):[]}function Rv(t){const s=Bn[t];return s?s.dashboards.map(r=>({module_key:t,feature_key:`${t}:${r.key}`,label:r.label,type:r.type,path:`/${t}/${r.key}`})):[]}const Rk=f.createContext(),Ls=()=>{const t=f.useContext(Rk);if(!t)throw new Error("usePermission must be used within a PermissionProvider");return t},cL=({children:t})=>{const{user:s}=Kr(),[r,a]=f.useState(new Set),[n,i]=f.useState([]),[l,o]=f.useState(new Set),[d,u]=f.useState(!0),[c,h]=f.useState(null),[m,p]=f.useState(()=>new Map),[g,x]=f.useState(()=>new Map),[b,y]=f.useState(()=>new Set),[j,N]=f.useState(()=>{if(typeof localStorage>"u")return{view:void 0,create:void 0,edit:void 0,delete:void 0};try{const te=se=>{const ae=localStorage.getItem(se);if(ae==="1")return!0};return{view:te("rbac_allow_all_view"),create:te("rbac_allow_all_create"),edit:te("rbac_allow_all_edit"),delete:te("rbac_allow_all_delete")}}catch{return{view:void 0,create:void 0,edit:void 0,delete:void 0}}});f.useEffect(()=>{try{if(typeof localStorage<"u"){const te=(se,ae)=>{ae===!0?localStorage.setItem(se,"1"):ae===!1?localStorage.setItem(se,"0"):localStorage.removeItem(se)};te("rbac_allow_all_view",j.view),te("rbac_allow_all_create",j.create),te("rbac_allow_all_edit",j.edit),te("rbac_allow_all_delete",j.delete)}}catch{}},[j]);const _=async()=>{var te,se,ae,ne;try{u(!0),h(null);const ue=Number((s==null?void 0:s.id)||(s==null?void 0:s.sub)||0);if(!Number.isFinite(ue)||!ue){a(new Set),i([]),o(new Set);return}const oe=await Z.get("/admin/user-permissions"),le=Array.isArray((te=oe.data)==null?void 0:te.modules)?oe.data.modules:[],X=Array.isArray((se=oe.data)==null?void 0:se.permissions)?oe.data.permissions:[],me=Array.isArray((ae=oe.data)==null?void 0:ae.role_features)?oe.data.role_features:[],we=await Z.get(`/admin/users/${ue}/feature-permissions`).catch(()=>({data:{items:[]}})),Ie=Array.isArray((ne=we==null?void 0:we.data)==null?void 0:ne.items)?we.data.items:[],_e=new Map(Ie.map(Le=>[String(Le.feature_key||"").trim(),{feature_key:String(Le.feature_key||"").trim(),can_view:!!Le.can_view,can_create:!!Le.can_create,can_edit:!!Le.can_edit,can_delete:!!Le.can_delete}])),Fe=X.map(Le=>{const rt=String((Le==null?void 0:Le.feature_key)||"").trim(),He=String((Le==null?void 0:Le.module_key)||"").trim(),st=rt.includes(":")?rt:He?`${He}:${rt}`:rt,De=_e.get(st);return De?{module_key:He,feature_key:st,can_view:De.can_view,can_create:De.can_create,can_edit:De.can_edit,can_delete:De.can_delete}:Le});a(new Set(le.map(Le=>String(Le||"").trim()).filter(Boolean)));for(const[Le,rt]of _e.entries())if(!Fe.find(He=>String(He.feature_key||"")===Le)){const[He]=Le.split(":");Fe.push({module_key:He,feature_key:Le,can_view:rt.can_view,can_create:rt.can_create,can_edit:rt.can_edit,can_delete:rt.can_delete})}i(Fe),o(new Set(me.map(Le=>String(Le||"").trim()).filter(Boolean)));try{window.dispatchEvent(new Event("rbac:updated"))}catch{}}catch(ue){console.error("Failed to load permissions:",ue),h(ue.message),a(new Set),i([]),o(new Set)}finally{u(!1)}},[F,I]=f.useState(()=>new Map),[w,E]=f.useState(!1),W=async()=>{var te;try{const se=await Z.get("/access/dashboard-permissions"),ae=Array.isArray((te=se.data)==null?void 0:te.items)?se.data.items:[],ne=new Map,ue=new Map;for(const oe of ae){const le=String(oe.module_key||""),X=oe.card_key?"card":oe.ticker_key?"ticker":"dashboard",me=String(oe.card_key||oe.ticker_key||oe.dashboard_key||""),we=`${le}|${X}|${me}`;ne.set(we,Number(oe.can_view)===1);const Ie=ue.get(le)||new Set;Ie.add(X),ue.set(le,Ie)}I(ne),E(!0)}catch{I(new Map),E(!0)}},R=te=>{const ae=(String(te||"").trim()||"/").split("/").filter(Boolean);if(ae.length>=2){const ne=ae[ae.length-1];return ne==="new"||ne==="create"?`/${ae.slice(0,ae.length-1).join("/")}`:/^[0-9]+$/.test(ne)||/^[0-9a-fA-F-]{8,}$/.test(ne)?`/${ae.slice(0,ae.length-1).join("/")}`:`/${ae.slice(0,2).join("/")}`}return ae.length===1?`/${ae[0]}`:"/"},U=async te=>{const se=R(te);if(!se)return null;if(g.has(se))return g.get(se);if(b.has(se))return null;y(ae=>new Set(ae).add(se));try{const ae=await Z.get(`/admin/page-permissions?path=${encodeURIComponent(se)}`),ne=(ae==null?void 0:ae.data)||{},ue={can_view:!!ne.can_view,can_create:!!ne.can_create,can_edit:!!ne.can_edit,can_delete:!!ne.can_delete};x(oe=>{const le=new Map(oe);return le.set(se,ue),le});try{window.dispatchEvent(new Event("rbac:updated"))}catch{}return ue}catch{return null}finally{y(ae=>{const ne=new Set(ae);return ne.delete(se),ne})}},T=te=>{const se=R(te);return se&&g.get(se)||null},Y=(te,se="view")=>{const ae=T(te);if(!ae)return null;const ne=se==="view"?"can_view":se==="create"?"can_create":se==="edit"?"can_edit":se==="delete"?"can_delete":`can_${se}`;return ae[ne]===!0},H=f.useMemo(()=>{const te=new Map;for(const se of n||[]){const ae=String((se==null?void 0:se.feature_key)||"").trim(),ne=String((se==null?void 0:se.module_key)||"").trim();if(!ae)continue;const ue=ae.includes(":")?ae:ne?`${ne}:${ae}`:ae,oe={module_key:ne,feature_key:ue,can_view:!!se.can_view,can_create:!!se.can_create,can_edit:!!se.can_edit,can_delete:!!se.can_delete,raw_feature_key:ae};te.set(ue,oe),ae.includes(":")||te.set(ae,oe)}return te},[n]),M=f.useMemo(()=>r.has("*")||H.has("*"),[r,H]),q=te=>{const se=String(te||"");return se?r.has(se):!1},z=(te,se)=>{if(!q(te))return!1;if(M)return!0;const ae=`${te}:${se}`;return H.has(ae)},Q=(te,se)=>{if(!q(te))return!1;if(M)return!0;const ae=`${te}:${se}`;return H.has(ae)},L=(te,se)=>{const ae=String(te||""),ne=String(se||"");if(!ae||!ne)return!1;if(M)return!0;if(!q(ae))return!1;const ue=`${ae}:${ne}`;return!!(l.has(ue)||ae==="purchase"&&(ne==="direct-purchase"&&l.has("purchase:direct-purchases")||ne==="direct-purchases"&&l.has("purchase:direct-purchase")))},V=te=>{const se=String(te||"").trim();return se?M?!0:l.has(se):!1},P=(te,se="view")=>{const ae=String(te||"");if(!ae)return!1;if(ae==="/"||ae==="/dashboard"||M||j.view)return!0;const ne=ae.split("/").filter(Boolean);if(ne[0]==="home"){const me=String(ne[1]||"");return me?V(`home:${me}`):!0}const ue=String(ne[0]||"");if(!ue||!q(ue))return!1;if(ne.length===1)return!0;const oe=Bn[ue],le=String(ne[1]||"");return!le||!oe||!((oe.features||[]).some(me=>String(me.key)===le)||(oe.dashboards||[]).some(me=>String(me.key)===le))?!0:L(ue,le)},C=(te,se="view")=>{const ae=String(te||"").trim();if(!ae)return!1;if(M)return!0;try{const X=typeof window<"u"&&window.location&&window.location.pathname||"/",me=R?R(X):X;if(me&&g&&g.has(me)){const we=g.get(me),Ie=se==="view"?"can_view":se==="create"?"can_create":se==="edit"?"can_edit":se==="delete"?"can_delete":`can_${se}`;if(typeof(we==null?void 0:we[Ie])=="boolean")return we[Ie]===!0}else U&&me&&U(me)}catch{}const ne=m.get(ae);if(ne){const X=se==="view"?"can_view":se==="create"?"can_create":se==="edit"?"can_edit":se==="delete"?"can_delete":`can_${se}`;if(typeof ne[X]=="boolean")return!!ne[X]}const ue=se==="delete"?"delete":se==="create"?"create":se==="edit"?"edit":"view";if(j&&Object.prototype.hasOwnProperty.call(j,ue)&&typeof j[ue]=="boolean")return j[ue]===!0;const oe=H.get(ae);if(!oe)return!1;const le=se==="view"?"can_view":se==="create"?"can_create":se==="edit"?"can_edit":se==="delete"?"can_delete":`can_${se}`;return oe[le]===!0},k=()=>Object.keys(Bn).filter(te=>q(te)),B=te=>{if(!q(te))return[];const se=Bn[te];return se?M?se.features||[]:(se.features||[]).filter(ae=>l.has(`${te}:${ae.key}`)):[]},G=te=>{if(!q(te))return[];const se=Bn[te];return se?M?se.dashboards||[]:(se.dashboards||[]).filter(ae=>l.has(`${te}:${ae.key}`)):[]},O=te=>{const se=Bn[te];if(!se)return[];const ae=[];return q(te)?((se.features||[]).forEach(ne=>{z(te,ne.key)||ae.push(`${te}:${ne.key}`)}),ae):((se.features||[]).forEach(ne=>{ae.push(`${te}:${ne.key}`)}),ae)},K=async()=>{await _(),await W()};f.useEffect(()=>{_()},[s==null?void 0:s.id]),f.useEffect(()=>{W()},[s==null?void 0:s.id]),f.useEffect(()=>{function te(){K()}return window.addEventListener("rbac:changed",te),()=>window.removeEventListener("rbac:changed",te)},[]);const J={modules:r,permissions:n,roleFeatures:l,loading:d,error:c,isModuleEnabled:q,isFeatureEnabled:z,isDashboardEnabled:Q,canAccessPath:P,canAccessFeatureKey:L,hasRoleFeature:V,canPerformAction:C,getEnabledModules:k,getEnabledFeatures:B,getEnabledDashboards:G,getDisabledFeatures:O,refreshPermissions:K,MODULES_REGISTRY:Bn,globalOverrides:j,setGlobalOverrides:N,sessionOverrides:m,setSessionOverrides:p,pagePermsByPath:g,ensurePagePerms:U,getPagePerms:T,canPerformPageAction:Y,basePathFrom:R,canViewDashboardElement:(te,se,ae)=>{const ne=String(te||""),ue=String(se||""),le=String(ae||"").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");if(!w)return!0;let X=!1;for(const we of F.keys())if(we.startsWith(`${ne}|${ue}|`)){X=!0;break}if(!X)return!0;const me=`${ne}|${ue}|${le}`;return F.get(me)===!0},setActionSessionOverride:(te,se,ae)=>{const ne=se==="can_view"?"can_view":se==="can_create"?"can_create":se==="can_edit"?"can_edit":se==="can_delete"?"can_delete":se,ue=String(te||"").trim();if(!(!ue||!ne)){p(oe=>{const le=new Map(oe),X=le.get(ue)||{};return le.set(ue,{...X,[ne]:!!ae}),le});try{window.dispatchEvent(new Event("rbac:updated"))}catch{}}},clearSessionOverrides:()=>{p(new Map);try{window.dispatchEvent(new Event("rbac:updated"))}catch{}}};return e.jsx(Rk.Provider,{value:J,children:t})},Ok=f.createContext(null),Lw="omnisuite.theme";function dL({children:t}){const[s,r]=f.useState("light");f.useEffect(()=>{const i=localStorage.getItem(Lw);if(i==="light"||i==="dark"){r(i);return}const l=typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches;r(l?"light":"dark")},[]),f.useEffect(()=>{s==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem(Lw,s)},[s]);function a(){r(i=>i==="dark"?"light":"dark")}const n=f.useMemo(()=>({theme:s,setTheme:r,toggleTheme:a}),[s]);return e.jsx(Ok.Provider,{value:n,children:t})}function Mk(){const t=f.useContext(Ok);if(!t)throw new Error("useTheme must be used within ThemeProvider");return t}function Dw({children:t}){const{token:s,initialized:r,user:a,scope:n,setScope:i}=Kr(),{loading:l,canAccessPath:o}=Ls(),d=Ur();if(!r||typeof l<"u"&&l)return null;if(!s)return e.jsx(dd,{to:"/login",replace:!0,state:{from:d}});const u=Array.isArray(a==null?void 0:a.branchIds)?a.branchIds.map(Number).filter(m=>Number.isFinite(m)):[],c=Number(n==null?void 0:n.branchId);if(u.length<=1){const m=u[0];if(Number.isFinite(m)&&c!==m){const p=Array.isArray(a==null?void 0:a.companyIds)?a.companyIds.map(Number).filter(x=>Number.isFinite(x)):[],g=p.length===1?p[0]:(n==null?void 0:n.companyId)||1;i(x=>({...x,companyId:g,branchId:m}))}if(d.pathname==="/select-branch"){const p=typeof sessionStorage<"u"?sessionStorage.getItem("last_path"):null,g=p&&p!=="/login"?p:"/";return e.jsx(dd,{to:g,replace:!0})}}else{if(d.pathname==="/select-branch")return t;if(!u.includes(c))return e.jsx(dd,{to:"/select-branch",replace:!0})}const h=d.pathname;return h==="/"||h==="/dashboard"||!o(h),t}const Tj="/assets/OMNISUITE_LOGO_CLEAR-E0tTLZi8.png",Ij="/assets/BACKGROUND-DBCOBMBw.jpg";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uL=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),mL=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,r,a)=>a?a.toUpperCase():r.toLowerCase()),Pw=t=>{const s=mL(t);return s.charAt(0).toUpperCase()+s.slice(1)},Qk=(...t)=>t.filter((s,r,a)=>!!s&&s.trim()!==""&&a.indexOf(s)===r).join(" ").trim(),hL=t=>{for(const s in t)if(s.startsWith("aria-")||s==="role"||s==="title")return!0};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var AL={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fL=f.forwardRef(({color:t="currentColor",size:s=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:n="",children:i,iconNode:l,...o},d)=>f.createElement("svg",{ref:d,...AL,width:s,height:s,stroke:t,strokeWidth:a?Number(r)*24/Number(s):r,className:Qk("lucide",n),...!i&&!hL(o)&&{"aria-hidden":"true"},...o},[...l.map(([u,c])=>f.createElement(u,c)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=(t,s)=>{const r=f.forwardRef(({className:a,...n},i)=>f.createElement(fL,{ref:i,iconNode:s,className:Qk(`lucide-${uL(Pw(t))}`,`lucide-${t}`,a),...n}));return r.displayName=Pw(t),r};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pL=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],xL=Aa("arrow-down",pL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gL=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Xf=Aa("arrow-left",gL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vL=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],bL=Aa("check",vL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],jL=Aa("circle-alert",yL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NL=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],wL=Aa("circle-check-big",NL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _L=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Cc=Aa("download",_L);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SL=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Lj=Aa("eye-off",SL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CL=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Dj=Aa("eye",CL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kL=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Pj=Aa("file-text",kL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EL=[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]],Uw=Aa("folder-tree",EL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BL=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],FL=Aa("funnel",BL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TL=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],IL=Aa("mail",TL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LL=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Au=Aa("package",LL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DL=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Ec=Aa("plus",DL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PL=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],tA=Aa("printer",PL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UL=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],RL=Aa("rotate-ccw",UL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OL=[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]],Rw=Aa("ruler",OL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ML=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],sA=Aa("save",ML);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QL=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Jf=Aa("search",QL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HL=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],kh=Aa("square-pen",HL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qL=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ol=Aa("trash-2",qL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $L=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],VL=Aa("trash",$L);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WL=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ay=Aa("triangle-alert",WL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GL=[["path",{d:"M18 21V10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1v11",key:"pb2vm6"}],["path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 1.132-1.803l7.95-3.974a2 2 0 0 1 1.837 0l7.948 3.974A2 2 0 0 1 22 8z",key:"doq5xv"}],["path",{d:"M6 13h12",key:"yf64js"}],["path",{d:"M6 17h12",key:"1jwigz"}]],KL=Aa("warehouse",GL);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zL=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Hk=Aa("x",zL);function YL(){const t=ps(),s=Ur(),{login:r,setScope:a}=Kr(),[n,i]=f.useState(""),[l,o]=f.useState(""),[d,u]=f.useState(null),[c,h]=f.useState(!1),[m,p]=f.useState(!1);async function g(x){var b,y,j,N,_,F;x.preventDefault(),u(null),h(!0);try{const I=await r({username:n,password:l}),w=Array.isArray((b=I==null?void 0:I.user)==null?void 0:b.branchIds)?I.user.branchIds.map(Number).filter(W=>Number.isFinite(W)):[],E=Array.isArray((y=I==null?void 0:I.user)==null?void 0:y.companyIds)?I.user.companyIds.map(Number).filter(W=>Number.isFinite(W)):[];if(w.length===1){const W=w[0];let R=E.length===1?E[0]:null;if(!R)try{const T=await Z.get("/admin/branches"),H=(Array.isArray((j=T.data)==null?void 0:j.items)?T.data.items:[]).find(M=>Number(M.id)===Number(W));H&&(R=Number(H.company_id))}catch{R=E[0]||1}a(T=>({...T,companyId:R||T.companyId||1,branchId:W}));let U="/";try{const T=(N=s==null?void 0:s.state)==null?void 0:N.from,Y=T&&typeof T.pathname=="string"?T.pathname+(T.search||""):null,H=typeof sessionStorage<"u"?sessionStorage.getItem("last_path"):null,M=Y||H;M&&!/^\/(login|reset-password|forgot-password)$/.test(M)&&(U=M)}catch{}t(U,{replace:!0})}else t("/select-branch",{replace:!0})}catch(I){const w=((F=(_=I==null?void 0:I.response)==null?void 0:_.data)==null?void 0:F.message)||(I==null?void 0:I.message)||"Login failed";u(w),ct.error(w)}finally{h(!1)}}return e.jsx("div",{className:"min-h-screen grid place-items-center bg-gradient-to-br from-brand-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 p-6",style:{backgroundImage:`url(${Ij})`,backgroundSize:"cover",backgroundPosition:"center"},children:e.jsx("div",{className:"w-full max-w-[400px]",children:e.jsxs("div",{className:"card shadow-erp-lg p-8",style:{backgroundColor:"rgba(255,255,255,0.7)"},children:[e.jsx("div",{className:"flex items-center gap-4 mb-8 ml-7",children:e.jsxs("div",{children:[e.jsx("div",{className:"items-center ml-9 mt-3 mb-4",children:e.jsx("img",{src:Tj,alt:"OmniSuite",className:"h-14 w-auto"})}),e.jsx("div",{className:"items-center text-xl font-bold text-slate-600 dark:text-slate-400 mb-0 mt-4",children:"Enterprise Resource Planning"})]})}),d?e.jsx("div",{className:"mb-4 rounded-lg border border-status-error/30 bg-red-50 dark:bg-red-900/20 px-4 py-3 text-status-error text-sm",children:d}):null,e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Username"}),e.jsx("input",{type:"text",className:"input",value:n,onChange:x=>i(x.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:m?"text":"password",className:"input pr-10",value:l,onChange:x=>o(x.target.value),required:!0}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-2 flex items-center text-slate-500",onClick:()=>p(x=>!x),"aria-label":m?"Hide password":"Show password",children:m?e.jsx(Lj,{size:18}):e.jsx(Dj,{size:18})})]})]}),e.jsx("button",{type:"submit",className:"btn-primary w-full mt-6",disabled:c,children:c?"Signing in":"Sign in"}),e.jsx("div",{className:"mt-3 text-right",children:e.jsx(Re,{to:"/forgot-password",className:"text-sm text-brand-700 hover:underline",children:"Forgot password?"})})]})]})})})}function XL(){const t=ps(),[s,r]=f.useState(""),[a,n]=f.useState(""),[i,l]=f.useState(!1),[o,d]=f.useState(null);async function u(c){var h,m;c.preventDefault(),d(null),l(!0);try{await Z.post("/forgot-password/request-otp",{username:s,email:a}),ct.success("OTP sent to your registered email"),t("/reset-password",{replace:!0})}catch(p){const g=((m=(h=p==null?void 0:p.response)==null?void 0:h.data)==null?void 0:m.message)||(p==null?void 0:p.message)||"Failed to request OTP";d(g),ct.error(g)}finally{l(!1)}}return e.jsx("div",{className:"min-h-screen grid place-items-center bg-gradient-to-br from-brand-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 p-6",style:{backgroundImage:`url(${Ij})`,backgroundSize:"cover",backgroundPosition:"center"},children:e.jsx("div",{className:"w-full max-w-[420px]",children:e.jsxs("div",{className:"card shadow-erp-lg p-8",style:{backgroundColor:"rgba(255,255,255,0.7)"},children:[e.jsx("div",{className:"flex items-center gap-4 mb-6 ml-7",children:e.jsxs("div",{children:[e.jsx("div",{className:"items-center ml-9 mt-3 mb-3",children:e.jsx("img",{src:Tj,alt:"OmniSuite",className:"h-14 w-auto"})}),e.jsx("div",{className:"items-center text-xl font-bold text-slate-600 dark:text-slate-400 mb-0 mt-2",children:"Password Reset"})]})}),o?e.jsx("div",{className:"mb-4 rounded-lg border border-status-error/30 bg-red-50 dark:bg-red-900/20 px-4 py-3 text-status-error text-sm",children:o}):null,e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Username"}),e.jsx("input",{type:"text",className:"input",value:s,onChange:c=>r(c.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Email"}),e.jsx("input",{type:"email",className:"input",value:a,onChange:c=>n(c.target.value),required:!0})]}),e.jsx("button",{type:"submit",className:"btn-primary w-full mt-4",disabled:i,children:i?"Sending OTP":"Send OTP"}),e.jsx("div",{className:"mt-3 text-right",children:e.jsx(Re,{to:"/login",className:"text-sm text-brand-700 hover:underline",children:"Back to login"})})]})]})})})}function JL(){const t=ps(),[s,r]=f.useState(""),[a,n]=f.useState(""),[i,l]=f.useState(""),[o,d]=f.useState(!1),[u,c]=f.useState(null),[h,m]=f.useState(!1);async function p(g){var x,b;g.preventDefault(),c(null),d(!0);try{await Z.post("/forgot-password/reset",{username:s,otp:a,new_password:i}),ct.success("Password reset successfully"),t("/login",{replace:!0})}catch(y){const j=((b=(x=y==null?void 0:y.response)==null?void 0:x.data)==null?void 0:b.message)||(y==null?void 0:y.message)||"Failed to reset password";c(j),ct.error(j)}finally{d(!1)}}return e.jsx("div",{className:"min-h-screen grid place-items-center bg-gradient-to-br from-brand-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 p-6",style:{backgroundImage:`url(${Ij})`,backgroundSize:"cover",backgroundPosition:"center"},children:e.jsx("div",{className:"w-full max-w-[420px]",children:e.jsxs("div",{className:"card shadow-erp-lg p-8",style:{backgroundColor:"rgba(255,255,255,0.7)"},children:[e.jsx("div",{className:"flex items-center gap-4 mb-6 ml-7",children:e.jsxs("div",{children:[e.jsx("div",{className:"items-center ml-9 mt-3 mb-3",children:e.jsx("img",{src:Tj,alt:"OmniSuite",className:"h-14 w-auto"})}),e.jsx("div",{className:"items-center text-xl font-bold text-slate-600 dark:text-slate-400 mb-0 mt-2",children:"Enter OTP and New Password"})]})}),u?e.jsx("div",{className:"mb-4 rounded-lg border border-status-error/30 bg-red-50 dark:bg-red-900/20 px-4 py-3 text-status-error text-sm",children:u}):null,e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Username"}),e.jsx("input",{type:"text",className:"input",value:s,onChange:g=>r(g.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"OTP Code"}),e.jsx("input",{type:"text",className:"input",value:a,onChange:g=>n(g.target.value),inputMode:"numeric",pattern:"\\\\d{6}",placeholder:"6-digit code",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:h?"text":"password",className:"input pr-10",value:i,onChange:g=>l(g.target.value),required:!0}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-2 flex items-center text-slate-500",onClick:()=>m(g=>!g),"aria-label":h?"Hide password":"Show password",children:h?e.jsx(Lj,{size:18}):e.jsx(Dj,{size:18})})]})]}),e.jsx("button",{type:"submit",className:"btn-primary w-full mt-4",disabled:o,children:o?"Resetting":"Reset Password"}),e.jsx("div",{className:"mt-3 text-right",children:e.jsx(Re,{to:"/login",className:"text-sm text-brand-700 hover:underline",children:"Back to login"})})]})]})})})}var Ov={exports:{}},Mv={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ow;function ZL(){if(Ow)return Mv;Ow=1;var t=Yh();function s(d,u){return d===u&&(d!==0||1/d===1/u)||d!==d&&u!==u}var r=typeof Object.is=="function"?Object.is:s,a=t.useSyncExternalStore,n=t.useRef,i=t.useEffect,l=t.useMemo,o=t.useDebugValue;return Mv.useSyncExternalStoreWithSelector=function(d,u,c,h,m){var p=n(null);if(p.current===null){var g={hasValue:!1,value:null};p.current=g}else g=p.current;p=l(function(){function b(F){if(!y){if(y=!0,j=F,F=h(F),m!==void 0&&g.hasValue){var I=g.value;if(m(I,F))return N=I}return N=F}if(I=N,r(j,F))return I;var w=h(F);return m!==void 0&&m(I,w)?(j=F,I):(j=F,N=w)}var y=!1,j,N,_=c===void 0?null:c;return[function(){return b(u())},_===null?void 0:function(){return b(_())}]},[u,c,h,m]);var x=a(d,p[0],p[1]);return i(function(){g.hasValue=!0,g.value=x},[x]),o(x),x},Mv}var Mw;function e6(){return Mw||(Mw=1,Ov.exports=ZL()),Ov.exports}var t6=e6();function s6(t){t()}function r6(){let t=null,s=null;return{clear(){t=null,s=null},notify(){s6(()=>{let r=t;for(;r;)r.callback(),r=r.next})},get(){const r=[];let a=t;for(;a;)r.push(a),a=a.next;return r},subscribe(r){let a=!0;const n=s={callback:r,next:null,prev:s};return n.prev?n.prev.next=n:t=n,function(){!a||t===null||(a=!1,n.next?n.next.prev=n.prev:s=n.prev,n.prev?n.prev.next=n.next:t=n.next)}}}}var Qw={notify(){},get:()=>[]};function a6(t,s){let r,a=Qw,n=0,i=!1;function l(x){c();const b=a.subscribe(x);let y=!1;return()=>{y||(y=!0,b(),h())}}function o(){a.notify()}function d(){g.onStateChange&&g.onStateChange()}function u(){return i}function c(){n++,r||(r=t.subscribe(d),a=r6())}function h(){n--,r&&n===0&&(r(),r=void 0,a.clear(),a=Qw)}function m(){i||(i=!0,c())}function p(){i&&(i=!1,h())}const g={addNestedSub:l,notifyNestedSubs:o,handleChangeWrapper:d,isSubscribed:u,trySubscribe:m,tryUnsubscribe:p,getListeners:()=>a};return g}var n6=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",i6=n6(),l6=()=>typeof navigator<"u"&&navigator.product==="ReactNative",o6=l6(),c6=()=>i6||o6?f.useLayoutEffect:f.useEffect,d6=c6(),Qv=Symbol.for("react-redux-context"),Hv=typeof globalThis<"u"?globalThis:{};function u6(){if(!f.createContext)return{};const t=Hv[Qv]??(Hv[Qv]=new Map);let s=t.get(f.createContext);return s||(s=f.createContext(null),t.set(f.createContext,s)),s}var _u=u6();function m6(t){const{children:s,context:r,serverState:a,store:n}=t,i=f.useMemo(()=>{const d=a6(n);return{store:n,subscription:d,getServerState:a?()=>a:void 0}},[n,a]),l=f.useMemo(()=>n.getState(),[n]);d6(()=>{const{subscription:d}=i;return d.onStateChange=d.notifyNestedSubs,d.trySubscribe(),l!==n.getState()&&d.notifyNestedSubs(),()=>{d.tryUnsubscribe(),d.onStateChange=void 0}},[i,l]);const o=r||_u;return f.createElement(o.Provider,{value:i},s)}var h6=m6;function Uj(t=_u){return function(){return f.useContext(t)}}var qk=Uj();function $k(t=_u){const s=t===_u?qk:Uj(t),r=()=>{const{store:a}=s();return a};return Object.assign(r,{withTypes:()=>r}),r}var A6=$k();function f6(t=_u){const s=t===_u?A6:$k(t),r=()=>s().dispatch;return Object.assign(r,{withTypes:()=>r}),r}var Rj=f6(),p6=(t,s)=>t===s;function x6(t=_u){const s=t===_u?qk:Uj(t),r=(a,n={})=>{const{equalityFn:i=p6}=typeof n=="function"?{equalityFn:n}:n,l=s(),{store:o,subscription:d,getServerState:u}=l;f.useRef(!0);const c=f.useCallback({[a.name](m){return a(m)}}[a.name],[a]),h=t6.useSyncExternalStoreWithSelector(d.addNestedSub,o.getState,u||o.getState,c,i);return f.useDebugValue(h),h};return Object.assign(r,{withTypes:()=>r}),r}var ud=x6();function Vn(t){return`Minified Redux error #${t}; visit https://redux.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var g6=typeof Symbol=="function"&&Symbol.observable||"@@observable",Hw=g6,qv=()=>Math.random().toString(36).substring(7).split("").join("."),v6={INIT:`@@redux/INIT${qv()}`,REPLACE:`@@redux/REPLACE${qv()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${qv()}`},m0=v6;function Oj(t){if(typeof t!="object"||t===null)return!1;let s=t;for(;Object.getPrototypeOf(s)!==null;)s=Object.getPrototypeOf(s);return Object.getPrototypeOf(t)===s||Object.getPrototypeOf(t)===null}function Vk(t,s,r){if(typeof t!="function")throw new Error(Vn(2));if(typeof s=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(Vn(0));if(typeof s=="function"&&typeof r>"u"&&(r=s,s=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(Vn(1));return r(Vk)(t,s)}let a=t,n=s,i=new Map,l=i,o=0,d=!1;function u(){l===i&&(l=new Map,i.forEach((b,y)=>{l.set(y,b)}))}function c(){if(d)throw new Error(Vn(3));return n}function h(b){if(typeof b!="function")throw new Error(Vn(4));if(d)throw new Error(Vn(5));let y=!0;u();const j=o++;return l.set(j,b),function(){if(y){if(d)throw new Error(Vn(6));y=!1,u(),l.delete(j),i=null}}}function m(b){if(!Oj(b))throw new Error(Vn(7));if(typeof b.type>"u")throw new Error(Vn(8));if(typeof b.type!="string")throw new Error(Vn(17));if(d)throw new Error(Vn(9));try{d=!0,n=a(n,b)}finally{d=!1}return(i=l).forEach(j=>{j()}),b}function p(b){if(typeof b!="function")throw new Error(Vn(10));a=b,m({type:m0.REPLACE})}function g(){const b=h;return{subscribe(y){if(typeof y!="object"||y===null)throw new Error(Vn(11));function j(){const _=y;_.next&&_.next(c())}return j(),{unsubscribe:b(j)}},[Hw](){return this}}}return m({type:m0.INIT}),{dispatch:m,subscribe:h,getState:c,replaceReducer:p,[Hw]:g}}function b6(t){Object.keys(t).forEach(s=>{const r=t[s];if(typeof r(void 0,{type:m0.INIT})>"u")throw new Error(Vn(12));if(typeof r(void 0,{type:m0.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Vn(13))})}function y6(t){const s=Object.keys(t),r={};for(let i=0;i<s.length;i++){const l=s[i];typeof t[l]=="function"&&(r[l]=t[l])}const a=Object.keys(r);let n;try{b6(r)}catch(i){n=i}return function(l={},o){if(n)throw n;let d=!1;const u={};for(let c=0;c<a.length;c++){const h=a[c],m=r[h],p=l[h],g=m(p,o);if(typeof g>"u")throw o&&o.type,new Error(Vn(14));u[h]=g,d=d||g!==p}return d=d||a.length!==Object.keys(l).length,d?u:l}}function h0(...t){return t.length===0?s=>s:t.length===1?t[0]:t.reduce((s,r)=>(...a)=>s(r(...a)))}function j6(...t){return s=>(r,a)=>{const n=s(r,a);let i=()=>{throw new Error(Vn(15))};const l={getState:n.getState,dispatch:(d,...u)=>i(d,...u)},o=t.map(d=>d(l));return i=h0(...o)(n.dispatch),{...n,dispatch:i}}}function N6(t){return Oj(t)&&"type"in t&&typeof t.type=="string"}var Wk=Symbol.for("immer-nothing"),qw=Symbol.for("immer-draftable"),qi=Symbol.for("immer-state");function Ho(t,...s){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var El=Object,Vh=El.getPrototypeOf,A0="constructor",ng="prototype",fy="configurable",f0="enumerable",Gx="writable",jf="value",xd=t=>!!t&&!!t[qi];function Go(t){var s;return t?Gk(t)||lg(t)||!!t[qw]||!!((s=t[A0])!=null&&s[qw])||og(t)||cg(t):!1}var w6=El[ng][A0].toString(),$w=new WeakMap;function Gk(t){if(!t||!Mj(t))return!1;const s=Vh(t);if(s===null||s===El[ng])return!0;const r=El.hasOwnProperty.call(s,A0)&&s[A0];if(r===Object)return!0;if(!jh(r))return!1;let a=$w.get(r);return a===void 0&&(a=Function.toString.call(r),$w.set(r,a)),a===w6}function ig(t,s,r=!0){Zf(t)===0?(r?Reflect.ownKeys(t):El.keys(t)).forEach(n=>{s(n,t[n],t)}):t.forEach((a,n)=>s(n,a,t))}function Zf(t){const s=t[qi];return s?s.type_:lg(t)?1:og(t)?2:cg(t)?3:0}var Vw=(t,s,r=Zf(t))=>r===2?t.has(s):El[ng].hasOwnProperty.call(t,s),py=(t,s,r=Zf(t))=>r===2?t.get(s):t[s],p0=(t,s,r,a=Zf(t))=>{a===2?t.set(s,r):a===3?t.add(r):t[s]=r};function _6(t,s){return t===s?t!==0||1/t===1/s:t!==t&&s!==s}var lg=Array.isArray,og=t=>t instanceof Map,cg=t=>t instanceof Set,Mj=t=>typeof t=="object",jh=t=>typeof t=="function",$v=t=>typeof t=="boolean";function S6(t){const s=+t;return Number.isInteger(s)&&String(s)===t}var od=t=>t.copy_||t.base_,Qj=t=>t.modified_?t.copy_:t.base_;function xy(t,s){if(og(t))return new Map(t);if(cg(t))return new Set(t);if(lg(t))return Array[ng].slice.call(t);const r=Gk(t);if(s===!0||s==="class_only"&&!r){const a=El.getOwnPropertyDescriptors(t);delete a[qi];let n=Reflect.ownKeys(a);for(let i=0;i<n.length;i++){const l=n[i],o=a[l];o[Gx]===!1&&(o[Gx]=!0,o[fy]=!0),(o.get||o.set)&&(a[l]={[fy]:!0,[Gx]:!0,[f0]:o[f0],[jf]:t[l]})}return El.create(Vh(t),a)}else{const a=Vh(t);if(a!==null&&r)return{...t};const n=El.create(a);return El.assign(n,t)}}function Hj(t,s=!1){return dg(t)||xd(t)||!Go(t)||(Zf(t)>1&&El.defineProperties(t,{set:zp,add:zp,clear:zp,delete:zp}),El.freeze(t),s&&ig(t,(r,a)=>{Hj(a,!0)},!1)),t}function C6(){Ho(2)}var zp={[jf]:C6};function dg(t){return t===null||!Mj(t)?!0:El.isFrozen(t)}var x0="MapSet",gy="Patches",Ww="ArrayMethods",Kk={};function Cm(t){const s=Kk[t];return s||Ho(0,t),s}var Gw=t=>!!Kk[t],Nf,zk=()=>Nf,k6=(t,s)=>({drafts_:[],parent_:t,immer_:s,canAutoFreeze_:!0,unfinalizedDrafts_:0,handledSet_:new Set,processedForPatches_:new Set,mapSetPlugin_:Gw(x0)?Cm(x0):void 0,arrayMethodsPlugin_:Gw(Ww)?Cm(Ww):void 0});function Kw(t,s){s&&(t.patchPlugin_=Cm(gy),t.patches_=[],t.inversePatches_=[],t.patchListener_=s)}function vy(t){by(t),t.drafts_.forEach(E6),t.drafts_=null}function by(t){t===Nf&&(Nf=t.parent_)}var zw=t=>Nf=k6(Nf,t);function E6(t){const s=t[qi];s.type_===0||s.type_===1?s.revoke_():s.revoked_=!0}function Yw(t,s){s.unfinalizedDrafts_=s.drafts_.length;const r=s.drafts_[0];if(t!==void 0&&t!==r){r[qi].modified_&&(vy(s),Ho(4)),Go(t)&&(t=Xw(s,t));const{patchPlugin_:n}=s;n&&n.generateReplacementPatches_(r[qi].base_,t,s)}else t=Xw(s,r);return B6(s,t,!0),vy(s),s.patches_&&s.patchListener_(s.patches_,s.inversePatches_),t!==Wk?t:void 0}function Xw(t,s){if(dg(s))return s;const r=s[qi];if(!r)return g0(s,t.handledSet_,t);if(!ug(r,t))return s;if(!r.modified_)return r.base_;if(!r.finalized_){const{callbacks_:a}=r;if(a)for(;a.length>0;)a.pop()(t);Jk(r,t)}return r.copy_}function B6(t,s,r=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&Hj(s,r)}function Yk(t){t.finalized_=!0,t.scope_.unfinalizedDrafts_--}var ug=(t,s)=>t.scope_===s,F6=[];function Xk(t,s,r,a){const n=od(t),i=t.type_;if(a!==void 0&&py(n,a,i)===s){p0(n,a,r,i);return}if(!t.draftLocations_){const o=t.draftLocations_=new Map;ig(n,(d,u)=>{if(xd(u)){const c=o.get(u)||[];c.push(d),o.set(u,c)}})}const l=t.draftLocations_.get(s)??F6;for(const o of l)p0(n,o,r,i)}function T6(t,s,r){t.callbacks_.push(function(n){var o;const i=s;if(!i||!ug(i,n))return;(o=n.mapSetPlugin_)==null||o.fixSetContents(i);const l=Qj(i);Xk(t,i.draft_??i,l,r),Jk(i,n)})}function Jk(t,s){var a;if(t.modified_&&!t.finalized_&&(t.type_===3||t.type_===1&&t.allIndicesReassigned_||(((a=t.assigned_)==null?void 0:a.size)??0)>0)){const{patchPlugin_:n}=s;if(n){const i=n.getPath(t);i&&n.generatePatches_(t,i,s)}Yk(t)}}function I6(t,s,r){const{scope_:a}=t;if(xd(r)){const n=r[qi];ug(n,a)&&n.callbacks_.push(function(){Kx(t);const l=Qj(n);Xk(t,r,l,s)})}else Go(r)&&t.callbacks_.push(function(){const i=od(t);t.type_===3?i.has(r)&&g0(r,a.handledSet_,a):py(i,s,t.type_)===r&&a.drafts_.length>1&&(t.assigned_.get(s)??!1)===!0&&t.copy_&&g0(py(t.copy_,s,t.type_),a.handledSet_,a)})}function g0(t,s,r){return!r.immer_.autoFreeze_&&r.unfinalizedDrafts_<1||xd(t)||s.has(t)||!Go(t)||dg(t)||(s.add(t),ig(t,(a,n)=>{if(xd(n)){const i=n[qi];if(ug(i,r)){const l=Qj(i);p0(t,a,l,t.type_),Yk(i)}}else Go(n)&&g0(n,s,r)})),t}function L6(t,s){const r=lg(t),a={type_:r?1:0,scope_:s?s.scope_:zk(),modified_:!1,finalized_:!1,assigned_:void 0,parent_:s,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1,callbacks_:void 0};let n=a,i=v0;r&&(n=[a],i=wf);const{revoke:l,proxy:o}=Proxy.revocable(n,i);return a.draft_=o,a.revoke_=l,[o,a]}var v0={get(t,s){if(s===qi)return t;let r=t.scope_.arrayMethodsPlugin_;const a=t.type_===1&&typeof s=="string";if(a&&r!=null&&r.isArrayOperationMethod(s))return r.createMethodInterceptor(t,s);const n=od(t);if(!Vw(n,s,t.type_))return D6(t,n,s);const i=n[s];if(t.finalized_||!Go(i)||a&&t.operationMethod&&(r!=null&&r.isMutatingArrayMethod(t.operationMethod))&&S6(s))return i;if(i===Vv(t.base_,s)){Kx(t);const l=t.type_===1?+s:s,o=jy(t.scope_,i,t,l);return t.copy_[l]=o}return i},has(t,s){return s in od(t)},ownKeys(t){return Reflect.ownKeys(od(t))},set(t,s,r){const a=Zk(od(t),s);if(a!=null&&a.set)return a.set.call(t.draft_,r),!0;if(!t.modified_){const n=Vv(od(t),s),i=n==null?void 0:n[qi];if(i&&i.base_===r)return t.copy_[s]=r,t.assigned_.set(s,!1),!0;if(_6(r,n)&&(r!==void 0||Vw(t.base_,s,t.type_)))return!0;Kx(t),yy(t)}return t.copy_[s]===r&&(r!==void 0||s in t.copy_)||Number.isNaN(r)&&Number.isNaN(t.copy_[s])||(t.copy_[s]=r,t.assigned_.set(s,!0),I6(t,s,r)),!0},deleteProperty(t,s){return Kx(t),Vv(t.base_,s)!==void 0||s in t.base_?(t.assigned_.set(s,!1),yy(t)):t.assigned_.delete(s),t.copy_&&delete t.copy_[s],!0},getOwnPropertyDescriptor(t,s){const r=od(t),a=Reflect.getOwnPropertyDescriptor(r,s);return a&&{[Gx]:!0,[fy]:t.type_!==1||s!=="length",[f0]:a[f0],[jf]:r[s]}},defineProperty(){Ho(11)},getPrototypeOf(t){return Vh(t.base_)},setPrototypeOf(){Ho(12)}},wf={};for(let t in v0){let s=v0[t];wf[t]=function(){const r=arguments;return r[0]=r[0][0],s.apply(this,r)}}wf.deleteProperty=function(t,s){return wf.set.call(this,t,s,void 0)};wf.set=function(t,s,r){return v0.set.call(this,t[0],s,r,t[0])};function Vv(t,s){const r=t[qi];return(r?od(r):t)[s]}function D6(t,s,r){var n;const a=Zk(s,r);return a?jf in a?a[jf]:(n=a.get)==null?void 0:n.call(t.draft_):void 0}function Zk(t,s){if(!(s in t))return;let r=Vh(t);for(;r;){const a=Object.getOwnPropertyDescriptor(r,s);if(a)return a;r=Vh(r)}}function yy(t){t.modified_||(t.modified_=!0,t.parent_&&yy(t.parent_))}function Kx(t){t.copy_||(t.assigned_=new Map,t.copy_=xy(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var P6=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!1,this.produce=(s,r,a)=>{if(jh(s)&&!jh(r)){const i=r;r=s;const l=this;return function(d=i,...u){return l.produce(d,c=>r.call(this,c,...u))}}jh(r)||Ho(6),a!==void 0&&!jh(a)&&Ho(7);let n;if(Go(s)){const i=zw(this),l=jy(i,s,void 0);let o=!0;try{n=r(l),o=!1}finally{o?vy(i):by(i)}return Kw(i,a),Yw(n,i)}else if(!s||!Mj(s)){if(n=r(s),n===void 0&&(n=s),n===Wk&&(n=void 0),this.autoFreeze_&&Hj(n,!0),a){const i=[],l=[];Cm(gy).generateReplacementPatches_(s,n,{patches_:i,inversePatches_:l}),a(i,l)}return n}else Ho(1,s)},this.produceWithPatches=(s,r)=>{if(jh(s))return(l,...o)=>this.produceWithPatches(l,d=>s(d,...o));let a,n;return[this.produce(s,r,(l,o)=>{a=l,n=o}),a,n]},$v(t==null?void 0:t.autoFreeze)&&this.setAutoFreeze(t.autoFreeze),$v(t==null?void 0:t.useStrictShallowCopy)&&this.setUseStrictShallowCopy(t.useStrictShallowCopy),$v(t==null?void 0:t.useStrictIteration)&&this.setUseStrictIteration(t.useStrictIteration)}createDraft(t){Go(t)||Ho(8),xd(t)&&(t=U6(t));const s=zw(this),r=jy(s,t,void 0);return r[qi].isManual_=!0,by(s),r}finishDraft(t,s){const r=t&&t[qi];(!r||!r.isManual_)&&Ho(9);const{scope_:a}=r;return Kw(a,s),Yw(void 0,a)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}setUseStrictIteration(t){this.useStrictIteration_=t}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(t,s){let r;for(r=s.length-1;r>=0;r--){const n=s[r];if(n.path.length===0&&n.op==="replace"){t=n.value;break}}r>-1&&(s=s.slice(r+1));const a=Cm(gy).applyPatches_;return xd(t)?a(t,s):this.produce(t,n=>a(n,s))}};function jy(t,s,r,a){const[n,i]=og(s)?Cm(x0).proxyMap_(s,r):cg(s)?Cm(x0).proxySet_(s,r):L6(s,r);return((r==null?void 0:r.scope_)??zk()).drafts_.push(n),i.callbacks_=(r==null?void 0:r.callbacks_)??[],i.key_=a,r&&a!==void 0?T6(r,i,a):i.callbacks_.push(function(d){var c;(c=d.mapSetPlugin_)==null||c.fixSetContents(i);const{patchPlugin_:u}=d;i.modified_&&u&&u.generatePatches_(i,[],d)}),n}function U6(t){return xd(t)||Ho(10,t),e5(t)}function e5(t){if(!Go(t)||dg(t))return t;const s=t[qi];let r,a=!0;if(s){if(!s.modified_)return s.base_;s.finalized_=!0,r=xy(t,s.scope_.immer_.useStrictShallowCopy_),a=s.scope_.immer_.shouldUseStrictIteration()}else r=xy(t,!0);return ig(r,(n,i)=>{p0(r,n,e5(i))},a),s&&(s.finalized_=!1),r}var R6=new P6,t5=R6.produce;function s5(t){return({dispatch:r,getState:a})=>n=>i=>typeof i=="function"?i(r,a,t):n(i)}var O6=s5(),M6=s5,Q6=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?h0:h0.apply(null,arguments)},H6=t=>t&&typeof t.match=="function";function ef(t,s){function r(...a){if(s){let n=s(...a);if(!n)throw new Error(md(0));return{type:t,payload:n.payload,..."meta"in n&&{meta:n.meta},..."error"in n&&{error:n.error}}}return{type:t,payload:a[0]}}return r.toString=()=>`${t}`,r.type=t,r.match=a=>N6(a)&&a.type===t,r}var r5=class QA extends Array{constructor(...s){super(...s),Object.setPrototypeOf(this,QA.prototype)}static get[Symbol.species](){return QA}concat(...s){return super.concat.apply(this,s)}prepend(...s){return s.length===1&&Array.isArray(s[0])?new QA(...s[0].concat(this)):new QA(...s.concat(this))}};function Jw(t){return Go(t)?t5(t,()=>{}):t}function Yp(t,s,r){return t.has(s)?t.get(s):t.set(s,r(s)).get(s)}function q6(t){return typeof t=="boolean"}var $6=()=>function(s){const{thunk:r=!0,immutableCheck:a=!0,serializableCheck:n=!0,actionCreatorCheck:i=!0}=s??{};let l=new r5;return r&&(q6(r)?l.push(O6):l.push(M6(r.extraArgument))),l},V6="RTK_autoBatch",Zw=t=>s=>{setTimeout(s,t)},W6=(t={type:"raf"})=>s=>(...r)=>{const a=s(...r);let n=!0,i=!1,l=!1;const o=new Set,d=t.type==="tick"?queueMicrotask:t.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:Zw(10):t.type==="callback"?t.queueNotification:Zw(t.timeout),u=()=>{l=!1,i&&(i=!1,o.forEach(c=>c()))};return Object.assign({},a,{subscribe(c){const h=()=>n&&c(),m=a.subscribe(h);return o.add(c),()=>{m(),o.delete(c)}},dispatch(c){var h;try{return n=!((h=c==null?void 0:c.meta)!=null&&h[V6]),i=!n,i&&(l||(l=!0,d(u))),a.dispatch(c)}finally{n=!0}}})},G6=t=>function(r){const{autoBatch:a=!0}=r??{};let n=new r5(t);return a&&n.push(W6(typeof a=="object"?a:void 0)),n};function K6(t){const s=$6(),{reducer:r=void 0,middleware:a,devTools:n=!0,preloadedState:i=void 0,enhancers:l=void 0}=t||{};let o;if(typeof r=="function")o=r;else if(Oj(r))o=y6(r);else throw new Error(md(1));let d;typeof a=="function"?d=a(s):d=s();let u=h0;n&&(u=Q6({trace:!1,...typeof n=="object"&&n}));const c=j6(...d),h=G6(c);let m=typeof l=="function"?l(h):h();const p=u(...m);return Vk(o,i,p)}function a5(t){const s={},r=[];let a;const n={addCase(i,l){const o=typeof i=="string"?i:i.type;if(!o)throw new Error(md(28));if(o in s)throw new Error(md(29));return s[o]=l,n},addAsyncThunk(i,l){return l.pending&&(s[i.pending.type]=l.pending),l.rejected&&(s[i.rejected.type]=l.rejected),l.fulfilled&&(s[i.fulfilled.type]=l.fulfilled),l.settled&&r.push({matcher:i.settled,reducer:l.settled}),n},addMatcher(i,l){return r.push({matcher:i,reducer:l}),n},addDefaultCase(i){return a=i,n}};return t(n),[s,r,a]}function z6(t){return typeof t=="function"}function Y6(t,s){let[r,a,n]=a5(s),i;if(z6(t))i=()=>Jw(t());else{const o=Jw(t);i=()=>o}function l(o=i(),d){let u=[r[d.type],...a.filter(({matcher:c})=>c(d)).map(({reducer:c})=>c)];return u.filter(c=>!!c).length===0&&(u=[n]),u.reduce((c,h)=>{if(h)if(xd(c)){const p=h(c,d);return p===void 0?c:p}else{if(Go(c))return t5(c,m=>h(m,d));{const m=h(c,d);if(m===void 0){if(c===null)return c;throw Error("A case reducer on a non-draftable value must not return undefined")}return m}}return c},o)}return l.getInitialState=i,l}var X6=(t,s)=>H6(t)?t.match(s):t(s);function J6(...t){return s=>t.some(r=>X6(r,s))}var Z6="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",eD=(t=21)=>{let s="",r=t;for(;r--;)s+=Z6[Math.random()*64|0];return s},tD=["name","message","stack","code"],Wv=class{constructor(t,s){wv(this,"_type");this.payload=t,this.meta=s}},e_=class{constructor(t,s){wv(this,"_type");this.payload=t,this.meta=s}},sD=t=>{if(typeof t=="object"&&t!==null){const s={};for(const r of tD)typeof t[r]=="string"&&(s[r]=t[r]);return s}return{message:String(t)}},t_="External signal was aborted",qj=(()=>{function t(s,r,a){const n=ef(s+"/fulfilled",(d,u,c,h)=>({payload:d,meta:{...h||{},arg:c,requestId:u,requestStatus:"fulfilled"}})),i=ef(s+"/pending",(d,u,c)=>({payload:void 0,meta:{...c||{},arg:u,requestId:d,requestStatus:"pending"}})),l=ef(s+"/rejected",(d,u,c,h,m)=>({payload:h,error:(a&&a.serializeError||sD)(d||"Rejected"),meta:{...m||{},arg:c,requestId:u,rejectedWithValue:!!h,requestStatus:"rejected",aborted:(d==null?void 0:d.name)==="AbortError",condition:(d==null?void 0:d.name)==="ConditionError"}}));function o(d,{signal:u}={}){return(c,h,m)=>{const p=a!=null&&a.idGenerator?a.idGenerator(d):eD(),g=new AbortController;let x,b;function y(N){b=N,g.abort()}u&&(u.aborted?y(t_):u.addEventListener("abort",()=>y(t_),{once:!0}));const j=(async function(){var F,I;let N;try{let w=(F=a==null?void 0:a.condition)==null?void 0:F.call(a,d,{getState:h,extra:m});if(aD(w)&&(w=await w),w===!1||g.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};const E=new Promise((W,R)=>{x=()=>{R({name:"AbortError",message:b||"Aborted"})},g.signal.addEventListener("abort",x,{once:!0})});c(i(p,d,(I=a==null?void 0:a.getPendingMeta)==null?void 0:I.call(a,{requestId:p,arg:d},{getState:h,extra:m}))),N=await Promise.race([E,Promise.resolve(r(d,{dispatch:c,getState:h,extra:m,requestId:p,signal:g.signal,abort:y,rejectWithValue:(W,R)=>new Wv(W,R),fulfillWithValue:(W,R)=>new e_(W,R)})).then(W=>{if(W instanceof Wv)throw W;return W instanceof e_?n(W.payload,p,d,W.meta):n(W,p,d)})])}catch(w){N=w instanceof Wv?l(null,p,d,w.payload,w.meta):l(w,p,d)}finally{x&&g.signal.removeEventListener("abort",x)}return a&&!a.dispatchConditionRejection&&l.match(N)&&N.meta.condition||c(N),N})();return Object.assign(j,{abort:y,requestId:p,arg:d,unwrap(){return j.then(rD)}})}}return Object.assign(o,{pending:i,rejected:l,fulfilled:n,settled:J6(l,n),typePrefix:s})}return t.withTypes=()=>t,t})();function rD(t){if(t.meta&&t.meta.rejectedWithValue)throw t.payload;if(t.error)throw t.error;return t.payload}function aD(t){return t!==null&&typeof t=="object"&&typeof t.then=="function"}var nD=Symbol.for("rtk-slice-createasyncthunk");function iD(t,s){return`${t}/${s}`}function lD({creators:t}={}){var r;const s=(r=t==null?void 0:t.asyncThunk)==null?void 0:r[nD];return function(n){const{name:i,reducerPath:l=i}=n;if(!i)throw new Error(md(11));const o=(typeof n.reducers=="function"?n.reducers(dD()):n.reducers)||{},d=Object.keys(o),u={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},c={addCase(_,F){const I=typeof _=="string"?_:_.type;if(!I)throw new Error(md(12));if(I in u.sliceCaseReducersByType)throw new Error(md(13));return u.sliceCaseReducersByType[I]=F,c},addMatcher(_,F){return u.sliceMatchers.push({matcher:_,reducer:F}),c},exposeAction(_,F){return u.actionCreators[_]=F,c},exposeCaseReducer(_,F){return u.sliceCaseReducersByName[_]=F,c}};d.forEach(_=>{const F=o[_],I={reducerName:_,type:iD(i,_),createNotation:typeof n.reducers=="function"};mD(F)?AD(I,F,c,s):uD(I,F,c)});function h(){const[_={},F=[],I=void 0]=typeof n.extraReducers=="function"?a5(n.extraReducers):[n.extraReducers],w={..._,...u.sliceCaseReducersByType};return Y6(n.initialState,E=>{for(let W in w)E.addCase(W,w[W]);for(let W of u.sliceMatchers)E.addMatcher(W.matcher,W.reducer);for(let W of F)E.addMatcher(W.matcher,W.reducer);I&&E.addDefaultCase(I)})}const m=_=>_,p=new Map,g=new WeakMap;let x;function b(_,F){return x||(x=h()),x(_,F)}function y(){return x||(x=h()),x.getInitialState()}function j(_,F=!1){function I(E){let W=E[_];return typeof W>"u"&&F&&(W=Yp(g,I,y)),W}function w(E=m){const W=Yp(p,F,()=>new WeakMap);return Yp(W,E,()=>{const R={};for(const[U,T]of Object.entries(n.selectors??{}))R[U]=oD(T,E,()=>Yp(g,E,y),F);return R})}return{reducerPath:_,getSelectors:w,get selectors(){return w(I)},selectSlice:I}}const N={name:i,reducer:b,actions:u.actionCreators,caseReducers:u.sliceCaseReducersByName,getInitialState:y,...j(l),injectInto(_,{reducerPath:F,...I}={}){const w=F??l;return _.inject({reducerPath:w,reducer:b},I),{...N,...j(w,!0)}}};return N}}function oD(t,s,r,a){function n(i,...l){let o=s(i);return typeof o>"u"&&a&&(o=r()),t(o,...l)}return n.unwrapped=t,n}var cD=lD();function dD(){function t(s,r){return{_reducerDefinitionType:"asyncThunk",payloadCreator:s,...r}}return t.withTypes=()=>t,{reducer(s){return Object.assign({[s.name](...r){return s(...r)}}[s.name],{_reducerDefinitionType:"reducer"})},preparedReducer(s,r){return{_reducerDefinitionType:"reducerWithPrepare",prepare:s,reducer:r}},asyncThunk:t}}function uD({type:t,reducerName:s,createNotation:r},a,n){let i,l;if("reducer"in a){if(r&&!hD(a))throw new Error(md(17));i=a.reducer,l=a.prepare}else i=a;n.addCase(t,i).exposeCaseReducer(s,i).exposeAction(s,l?ef(t,l):ef(t))}function mD(t){return t._reducerDefinitionType==="asyncThunk"}function hD(t){return t._reducerDefinitionType==="reducerWithPrepare"}function AD({type:t,reducerName:s},r,a,n){if(!n)throw new Error(md(18));const{payloadCreator:i,fulfilled:l,pending:o,rejected:d,settled:u,options:c}=r,h=n(t,i,c);a.exposeAction(s,h),l&&a.addCase(h.fulfilled,l),o&&a.addCase(h.pending,o),d&&a.addCase(h.rejected,d),u&&a.addMatcher(h.settled,u),a.exposeCaseReducer(s,{fulfilled:l||Xp,pending:o||Xp,rejected:d||Xp,settled:u||Xp})}function Xp(){}function md(t){return`Minified Redux Toolkit error #${t}; visit https://redux-toolkit.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}const tf=qj("inventoryRef/fetchUoms",async()=>{var s;const t=await Z.get("/inventory/uoms");return Array.isArray((s=t.data)==null?void 0:s.items)?t.data.items:[]}),sf=qj("inventoryRef/fetchCategories",async()=>{var s;const t=await Z.get("/inventory/item-categories");return Array.isArray((s=t.data)==null?void 0:s.items)?t.data.items:[]}),Am=qj("inventoryRef/fetchItemTypes",async()=>{var s;const t=await Z.get("/inventory/item-types");return Array.isArray((s=t.data)==null?void 0:s.items)?t.data.items:[]}),fD={uoms:[],categories:[],itemTypes:[],status:{uoms:"idle",categories:"idle",itemTypes:"idle"},error:{uoms:null,categories:null,itemTypes:null},lastFetched:{uoms:null,categories:null,itemTypes:null}},pD=cD({name:"inventoryRef",initialState:fD,reducers:{},extraReducers:t=>{t.addCase(tf.pending,s=>{s.status.uoms="loading",s.error.uoms=null}).addCase(tf.fulfilled,(s,r)=>{s.status.uoms="succeeded",s.uoms=r.payload,s.lastFetched.uoms=Date.now()}).addCase(tf.rejected,(s,r)=>{var a;s.status.uoms="failed",s.error.uoms=((a=r.error)==null?void 0:a.message)||"Failed to load UOMs"}).addCase(sf.pending,s=>{s.status.categories="loading",s.error.categories=null}).addCase(sf.fulfilled,(s,r)=>{s.status.categories="succeeded",s.categories=r.payload,s.lastFetched.categories=Date.now()}).addCase(sf.rejected,(s,r)=>{var a;s.status.categories="failed",s.error.categories=((a=r.error)==null?void 0:a.message)||"Failed to load categories"}).addCase(Am.pending,s=>{s.status.itemTypes="loading",s.error.itemTypes=null}).addCase(Am.fulfilled,(s,r)=>{s.status.itemTypes="succeeded",s.itemTypes=r.payload,s.lastFetched.itemTypes=Date.now()}).addCase(Am.rejected,(s,r)=>{var a;s.status.itemTypes="failed",s.error.itemTypes=((a=r.error)==null?void 0:a.message)||"Failed to load item types"})}}),xD=pD.reducer,gD=K6({reducer:{inventoryRef:xD}});function vD(){const t=ps(),{user:s,scope:r,setScope:a}=Kr(),[n,i]=f.useState([]),[l,o]=f.useState(""),[d,u]=f.useState(!1),[c,h]=f.useState(""),m=f.useMemo(()=>Array.isArray(s==null?void 0:s.branchIds)?s.branchIds.map(Number):[],[s==null?void 0:s.branchIds]);f.useEffect(()=>{let g=!0;async function x(){var b,y,j;u(!0),h("");try{const N=await Z.get("/admin/branches"),F=(Array.isArray((b=N.data)==null?void 0:b.items)?N.data.items:[]).filter(I=>m.includes(Number(I.id)));if(g&&(i(F),F.length===1)){const I=F[0];a(w=>({...w,companyId:Number(I.company_id),branchId:Number(I.id)})),t("/",{replace:!0});return}}catch(N){h(((j=(y=N==null?void 0:N.response)==null?void 0:y.data)==null?void 0:j.message)||"Error loading branches")}finally{g&&u(!1)}}return x(),()=>{g=!1}},[]);async function p(){const g=Number(l);if(!g)return;const x=n.find(b=>Number(b.id)===g);x&&(a(b=>({...b,companyId:Number(x.company_id),branchId:Number(x.id),branchConfirmedId:n.length===1?Number(x.id):b==null?void 0:b.branchConfirmedId})),t("/",{replace:!0}))}return n.length===1?null:e.jsx("div",{className:"min-h-screen grid place-items-center bg-slate-50 dark:bg-slate-900 p-6",children:e.jsxs("div",{className:"w-full max-w-md card p-6 shadow-erp-lg",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 text-center",children:"Select Working Branch"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 text-center mt-1",children:"Choose one of your assigned branches to continue."}),c?e.jsx("div",{className:"mt-4 rounded-lg border border-status-error/30 bg-red-50 dark:bg-red-900/20 px-4 py-3 text-status-error text-sm",children:c}):null,e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"label",children:"Branch"}),e.jsxs("select",{className:"input w-full",value:l,onChange:g=>o(g.target.value),disabled:d||n.length===0,children:[e.jsx("option",{value:"",children:"Select a branch"}),n.map(g=>e.jsxs("option",{value:g.id,children:[g.name," (",g.company_name,")"]},g.id))]})]}),e.jsx("button",{className:"btn-primary w-full mt-6",onClick:p,disabled:d||!l,children:d?"Loading":"Continue"})]})})}var su={},oh={},ru={},s_;function n5(){if(s_)return ru;s_=1;var t=ru&&ru.__awaiter||function(n,i,l,o){function d(u){return u instanceof l?u:new l(function(c){c(u)})}return new(l||(l=Promise))(function(u,c){function h(g){try{p(o.next(g))}catch(x){c(x)}}function m(g){try{p(o.throw(g))}catch(x){c(x)}}function p(g){g.done?u(g.value):d(g.value).then(h,m)}p((o=o.apply(n,i||[])).next())})};Object.defineProperty(ru,"__esModule",{value:!0}),ru.PushNotification=void 0;const s=3e3;class r{constructor(i){this.title=i.title,this.subtitle=i.subtitle,this.message=i.message,this.theme=i.theme,this.id=Math.random(),this.styling=i.styling,this.closeButton=i.closeButton,this.onClick=i.onClick}}ru.PushNotification=r;let a=class{constructor(){this.Storage=[],this.Listener=()=>this.Storage,this.popAndPush=i=>{let l=0;for(;l<this.Storage.length;)this.Storage[l].id===i?this.Storage.splice(l,1):++l;this.Listener(this.Storage)},this.setTimer=(i,l)=>{setTimeout(()=>this.popAndPush(i),l)},this.addListener=i=>{this.Listener=i},this.addNativeNotification=i=>t(this,void 0,void 0,function*(){const{title:l,subtitle:o,message:d,duration:u,icon:c,vibrate:h,silent:m,onClick:p}=i;if((Notification.permission==="default"||Notification.permission==="denied")&&(yield Notification.requestPermission()),Notification.permission==="granted"){const g=new Notification(l,{body:d,data:o,icon:c,vibrate:h,silent:m});g.onclick=p||null,setTimeout(g.close.bind(g),u||s)}}),this.addWebNotification=i=>{const{title:l,subtitle:o,message:d,theme:u,duration:c,backgroundBottom:h,backgroundTop:m,colorBottom:p,colorTop:g,closeButton:x,onClick:b}=i,y={backgroundTop:m,backgroundBottom:h,colorTop:g,colorBottom:p},j=new r({title:l,subtitle:o,message:d,theme:u,styling:y,closeButton:x,onClick:b});this.Storage.push(j),this.setTimer(j.id,c||s),this.Listener(this.Storage)},this.addNotification=i=>t(this,void 0,void 0,function*(){const{native:l}=i;return l?this.addNativeNotification(i):this.addWebNotification(i)})}};return ru.default=new a,ru}var ch={},r_;function bD(){if(r_)return ch;r_=1;var t=ch&&ch.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(ch,"__esModule",{value:!0});const s=t(Yh()),r=a=>{const{title:n,subtitle:i,message:l,theme:o,id:d,closeNotification:u,styling:c,closeButton:h,onClick:m}=a;let p={},g={};return c&&(p.backgroundColor=c.backgroundTop,p.color=c.colorTop,g.backgroundColor=c.backgroundBottom,g.color=c.colorBottom),s.default.createElement("div",{className:`rpn-notification-card ${o}`,onClick:m},s.default.createElement("div",{className:`rpn-notification-card-top ${o}`,style:Object.keys(p).length?p:void 0},s.default.createElement("span",null,n),s.default.createElement("span",{className:`rpn-notification-card-close ${o}`,onClick:()=>u(d)},h||"close")),s.default.createElement("div",{className:`rpn-notification-card-bottom ${o}`,style:Object.keys(g).length?g:void 0},s.default.createElement("span",{className:"subtitle"},i),s.default.createElement("span",{className:"message"},l)))};return ch.default=r,ch}var a_;function yD(){if(a_)return oh;a_=1;var t=oh&&oh.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(oh,"__esModule",{value:!0});const s=t(Yh()),r=t(n5()),a=t(bD());let n=class extends s.default.Component{constructor(){super(...arguments),this.state={value:[]}}componentDidMount(){r.default.addListener(l=>this.setState({value:l}))}render(){const{position:l}=this.props,o=`rpn-notification-holder ${l||"top-middle"} supertest`;return s.default.createElement("div",{className:o},this.state.value.map((d,u)=>s.default.createElement(a.default,{key:u,closeNotification:r.default.popAndPush,onClick:d.onClick,id:d.id,theme:d.theme,title:d.title,subtitle:d.subtitle,closeButton:d.closeButton,message:d.message,styling:d.styling})))}};return oh.default=n,oh}var n_;function jD(){if(n_)return su;n_=1;var t=su&&su.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(su,"__esModule",{value:!0}),su.Notifications=void 0;const s=t(yD());su.Notifications=s.default;const a=t(n5()).default.addNotification;return su.default=a,su}var i5=jD();const Gv=jj(i5);function ND(){const{theme:t,toggleTheme:s}=Mk(),r=t==="dark";return e.jsx("button",{type:"button",className:"relative inline-flex h-6 w-11 items-center rounded-full border transition-colors focus:outline-none focus:ring-2 focus:ring-brand/40 focus:ring-offset-2 focus:ring-offset-transparent "+(r?"bg-brand/25 border-white/10 dark:border-white/10":"bg-slate-200 border-slate-300"),role:"switch","aria-checked":r,"aria-label":"Toggle dark mode",onClick:s,children:e.jsx("span",{className:"inline-block h-5 w-5 transform rounded-full shadow transition-transform "+(r?"translate-x-5 bg-brand":"translate-x-1 bg-white")})})}function wD(){const{user:t}=Kr();return e.jsxs("div",{className:"hidden rounded-2xl border border-slate-200/70 dark:border-white/10 bg-white/70 dark:bg-slate-900/40 backdrop-blur-xl shadow-sm p-5",children:[e.jsx("div",{className:"font-extrabold text-lg mb-1",children:"Dashboard"}),e.jsxs("div",{className:"text-slate-500 dark:text-slate-400 mb-3",children:["Welcome, ",t==null?void 0:t.email,". This is the ERP starter shell."]}),e.jsx("div",{className:"text-slate-500 dark:text-slate-400 text-sm leading-relaxed",children:"Start by enabling permissions in MySQL and then calling module endpoints from the UI."})]})}function i_({onPostCreated:t}){const{user:s}=Kr(),[r,a]=f.useState(""),[n,i]=f.useState(null),[l,o]=f.useState(null),[d,u]=f.useState("company"),[c,h]=f.useState(!1),[m,p]=f.useState(null),[g,x]=f.useState(null),b=f.useRef(null);f.useEffect(()=>{if(!(s!=null&&s.id)&&!(s!=null&&s.sub))return;(async()=>{var _,F;try{const I=Number((s==null?void 0:s.sub)||(s==null?void 0:s.id))||0,E={Authorization:`Bearer ${localStorage.getItem("token")}`},W=await fetch("/api/admin/me",{headers:E});if(W.ok){const R=await W.json(),U=(R==null?void 0:R.data)||R||null,T=((_=U==null?void 0:U.user)==null?void 0:_.profile_picture_url)||(U==null?void 0:U.profile_picture_url)||null;if(T){x(T);return}}if(I>0){const R=await fetch(`/api/admin/users/${I}`,{headers:E});if(R.ok){const U=await R.json(),T=((F=U==null?void 0:U.data)==null?void 0:F.item)||(U==null?void 0:U.item)||(U==null?void 0:U.data)||U||null,Y=(T==null?void 0:T.profile_picture_url)||null;x(Y||"/default-avatar.png");return}}x("/default-avatar.png")}catch{x("/default-avatar.png")}})()},[s==null?void 0:s.id,s==null?void 0:s.sub]);const y=N=>{const _=N.target.files[0];if(!_)return;const F=["image/jpeg","image/png","image/webp"],I=5*1024*1024;if(!F.includes(_.type)){p("Only JPG, PNG, and WebP images are allowed");return}if(_.size>I){p("Image size must be less than 5MB");return}try{const E=URL.createObjectURL(_);o(E)}catch{}const w=new FormData;w.append("file",_),h(!0),fetch("/api/upload",{method:"POST",body:w,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(async E=>{var U;let W=null;try{W=await E.json()}catch{}if(!E.ok){const T=W&&(W.message||W.error)||"Upload failed";p(T);return}const R=(W==null?void 0:W.url)||((U=W==null?void 0:W.data)==null?void 0:U.url)||(W==null?void 0:W.path)||null;if(!R){p("Upload failed");return}i(R),typeof R=="string"&&/^(data:|https?:)/i.test(R)&&o(R),p(null)}).catch(E=>{p("Upload error: "+E.message)}).finally(()=>h(!1))};f.useEffect(()=>()=>{try{l&&l.startsWith("blob:")&&URL.revokeObjectURL(l)}catch{}},[l]);const j=async N=>{if(N.preventDefault(),!r.trim()){p("Please enter some content");return}h(!0),p(null);try{const _=Number((s==null?void 0:s.sub)||(s==null?void 0:s.id))||"",F=await fetch("/api/social-feed",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`,"x-user-id":String(_)},body:JSON.stringify({content:r,image_url:n,visibility_type:d})});if(!F.ok){let w="Failed to create post";try{const E=await F.text();try{w=JSON.parse(E).message||w}catch{w=E||w}}catch{}throw new Error(w)}const I=await F.json();t(I.data);try{ct.success("Post created successfully")}catch{}a(""),i(null);try{l&&l.startsWith("blob:")&&URL.revokeObjectURL(l)}catch{}o(null),u("company"),p(null)}catch(_){console.error("Error creating post:",_),p(_.message)}finally{h(!1)}};return e.jsx("div",{className:"post-creator-card",children:e.jsxs("div",{className:"post-creator-header",children:[e.jsx("img",{src:g||"/default-avatar.png",alt:(s==null?void 0:s.name)||(s==null?void 0:s.username)||"User",className:"avatar"}),e.jsxs("form",{onSubmit:j,className:"post-form",children:[e.jsx("textarea",{className:"post-input",placeholder:"Start chat",value:r,onChange:N=>a(N.target.value),rows:"3"}),n&&e.jsxs("div",{className:"image-preview",children:[e.jsx("img",{src:l||n,alt:"Preview"}),e.jsx("button",{type:"button",onClick:()=>{i(null);try{l&&l.startsWith("blob:")&&URL.revokeObjectURL(l)}catch{}o(null),b.current&&(b.current.value="")},className:"btn-remove-image",children:""})]}),e.jsxs("div",{className:"post-actions",children:[e.jsxs("div",{className:"left-actions",children:[e.jsx("button",{type:"button",className:"btn-icon",onClick:()=>{var N;return(N=b.current)==null?void 0:N.click()},disabled:c,children:" Photo"}),e.jsx("input",{ref:b,type:"file",accept:"image/*",onChange:y,style:{display:"none"}}),e.jsxs("select",{value:d,onChange:N=>u(N.target.value),className:"visibility-select",children:[e.jsx("option",{value:"company",children:" Company"}),e.jsx("option",{value:"warehouse",children:" My Warehouse"})]})]}),e.jsx("button",{type:"submit",className:"btn-post",disabled:c||!r.trim(),children:c?"Posting...":"Post"})]}),m&&e.jsx("p",{className:"error-text",children:m})]})]})})}const l5=6048e5,_D=864e5,Jp=43200,l_=1440,o_=Symbol.for("constructDateFrom");function gd(t,s){return typeof t=="function"?t(s):t&&typeof t=="object"&&o_ in t?t[o_](s):t instanceof Date?new t.constructor(s):new Date(s)}function In(t,s){return gd(s||t,t)}let SD={};function ep(){return SD}function _f(t,s){var o,d,u,c;const r=ep(),a=(s==null?void 0:s.weekStartsOn)??((d=(o=s==null?void 0:s.locale)==null?void 0:o.options)==null?void 0:d.weekStartsOn)??r.weekStartsOn??((c=(u=r.locale)==null?void 0:u.options)==null?void 0:c.weekStartsOn)??0,n=In(t,s==null?void 0:s.in),i=n.getDay(),l=(i<a?7:0)+i-a;return n.setDate(n.getDate()-l),n.setHours(0,0,0,0),n}function b0(t,s){return _f(t,{...s,weekStartsOn:1})}function o5(t,s){const r=In(t,s==null?void 0:s.in),a=r.getFullYear(),n=gd(r,0);n.setFullYear(a+1,0,4),n.setHours(0,0,0,0);const i=b0(n),l=gd(r,0);l.setFullYear(a,0,4),l.setHours(0,0,0,0);const o=b0(l);return r.getTime()>=i.getTime()?a+1:r.getTime()>=o.getTime()?a:a-1}function y0(t){const s=In(t),r=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return r.setUTCFullYear(s.getFullYear()),+t-+r}function mg(t,...s){const r=gd.bind(null,t||s.find(a=>typeof a=="object"));return s.map(r)}function c_(t,s){const r=In(t,s==null?void 0:s.in);return r.setHours(0,0,0,0),r}function CD(t,s,r){const[a,n]=mg(r==null?void 0:r.in,t,s),i=c_(a),l=c_(n),o=+i-y0(i),d=+l-y0(l);return Math.round((o-d)/_D)}function kD(t,s){const r=o5(t,s),a=gd(t,0);return a.setFullYear(r,0,4),a.setHours(0,0,0,0),b0(a)}function zx(t,s){const r=+In(t)-+In(s);return r<0?-1:r>0?1:r}function ED(t){return gd(t,Date.now())}function BD(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function FD(t){return!(!BD(t)&&typeof t!="number"||isNaN(+In(t)))}function TD(t,s,r){const[a,n]=mg(r==null?void 0:r.in,t,s),i=a.getFullYear()-n.getFullYear(),l=a.getMonth()-n.getMonth();return i*12+l}function ID(t){return s=>{const a=(t?Math[t]:Math.trunc)(s);return a===0?0:a}}function LD(t,s){return+In(t)-+In(s)}function DD(t,s){const r=In(t,s==null?void 0:s.in);return r.setHours(23,59,59,999),r}function PD(t,s){const r=In(t,s==null?void 0:s.in),a=r.getMonth();return r.setFullYear(r.getFullYear(),a+1,0),r.setHours(23,59,59,999),r}function UD(t,s){const r=In(t,s==null?void 0:s.in);return+DD(r,s)==+PD(r,s)}function RD(t,s,r){const[a,n,i]=mg(r==null?void 0:r.in,t,t,s),l=zx(n,i),o=Math.abs(TD(n,i));if(o<1)return 0;n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-l*o);let d=zx(n,i)===-l;UD(a)&&o===1&&zx(a,i)===1&&(d=!1);const u=l*(o-+d);return u===0?0:u}function OD(t,s,r){const a=LD(t,s)/1e3;return ID(r==null?void 0:r.roundingMethod)(a)}function MD(t,s){const r=In(t,s==null?void 0:s.in);return r.setFullYear(r.getFullYear(),0,1),r.setHours(0,0,0,0),r}const QD={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},HD=(t,s,r)=>{let a;const n=QD[t];return typeof n=="string"?a=n:s===1?a=n.one:a=n.other.replace("{{count}}",s.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+a:a+" ago":a};function Kv(t){return(s={})=>{const r=s.width?String(s.width):t.defaultWidth;return t.formats[r]||t.formats[t.defaultWidth]}}const qD={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},$D={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},VD={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},WD={date:Kv({formats:qD,defaultWidth:"full"}),time:Kv({formats:$D,defaultWidth:"full"}),dateTime:Kv({formats:VD,defaultWidth:"full"})},GD={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},KD=(t,s,r,a)=>GD[t];function kA(t){return(s,r)=>{const a=r!=null&&r.context?String(r.context):"standalone";let n;if(a==="formatting"&&t.formattingValues){const l=t.defaultFormattingWidth||t.defaultWidth,o=r!=null&&r.width?String(r.width):l;n=t.formattingValues[o]||t.formattingValues[l]}else{const l=t.defaultWidth,o=r!=null&&r.width?String(r.width):t.defaultWidth;n=t.values[o]||t.values[l]}const i=t.argumentCallback?t.argumentCallback(s):s;return n[i]}}const zD={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},YD={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},XD={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},JD={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},ZD={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},eP={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},tP=(t,s)=>{const r=Number(t),a=r%100;if(a>20||a<10)switch(a%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},sP={ordinalNumber:tP,era:kA({values:zD,defaultWidth:"wide"}),quarter:kA({values:YD,defaultWidth:"wide",argumentCallback:t=>t-1}),month:kA({values:XD,defaultWidth:"wide"}),day:kA({values:JD,defaultWidth:"wide"}),dayPeriod:kA({values:ZD,defaultWidth:"wide",formattingValues:eP,defaultFormattingWidth:"wide"})};function EA(t){return(s,r={})=>{const a=r.width,n=a&&t.matchPatterns[a]||t.matchPatterns[t.defaultMatchWidth],i=s.match(n);if(!i)return null;const l=i[0],o=a&&t.parsePatterns[a]||t.parsePatterns[t.defaultParseWidth],d=Array.isArray(o)?aP(o,h=>h.test(l)):rP(o,h=>h.test(l));let u;u=t.valueCallback?t.valueCallback(d):d,u=r.valueCallback?r.valueCallback(u):u;const c=s.slice(l.length);return{value:u,rest:c}}}function rP(t,s){for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&s(t[r]))return r}function aP(t,s){for(let r=0;r<t.length;r++)if(s(t[r]))return r}function nP(t){return(s,r={})=>{const a=s.match(t.matchPattern);if(!a)return null;const n=a[0],i=s.match(t.parsePattern);if(!i)return null;let l=t.valueCallback?t.valueCallback(i[0]):i[0];l=r.valueCallback?r.valueCallback(l):l;const o=s.slice(n.length);return{value:l,rest:o}}}const iP=/^(\d+)(th|st|nd|rd)?/i,lP=/\d+/i,oP={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},cP={any:[/^b/i,/^(a|c)/i]},dP={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},uP={any:[/1/i,/2/i,/3/i,/4/i]},mP={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},hP={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},AP={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},fP={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},pP={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},xP={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},gP={ordinalNumber:nP({matchPattern:iP,parsePattern:lP,valueCallback:t=>parseInt(t,10)}),era:EA({matchPatterns:oP,defaultMatchWidth:"wide",parsePatterns:cP,defaultParseWidth:"any"}),quarter:EA({matchPatterns:dP,defaultMatchWidth:"wide",parsePatterns:uP,defaultParseWidth:"any",valueCallback:t=>t+1}),month:EA({matchPatterns:mP,defaultMatchWidth:"wide",parsePatterns:hP,defaultParseWidth:"any"}),day:EA({matchPatterns:AP,defaultMatchWidth:"wide",parsePatterns:fP,defaultParseWidth:"any"}),dayPeriod:EA({matchPatterns:pP,defaultMatchWidth:"any",parsePatterns:xP,defaultParseWidth:"any"})},c5={code:"en-US",formatDistance:HD,formatLong:WD,formatRelative:KD,localize:sP,match:gP,options:{weekStartsOn:0,firstWeekContainsDate:1}};function vP(t,s){const r=In(t,s==null?void 0:s.in);return CD(r,MD(r))+1}function bP(t,s){const r=In(t,s==null?void 0:s.in),a=+b0(r)-+kD(r);return Math.round(a/l5)+1}function d5(t,s){var c,h,m,p;const r=In(t,s==null?void 0:s.in),a=r.getFullYear(),n=ep(),i=(s==null?void 0:s.firstWeekContainsDate)??((h=(c=s==null?void 0:s.locale)==null?void 0:c.options)==null?void 0:h.firstWeekContainsDate)??n.firstWeekContainsDate??((p=(m=n.locale)==null?void 0:m.options)==null?void 0:p.firstWeekContainsDate)??1,l=gd((s==null?void 0:s.in)||t,0);l.setFullYear(a+1,0,i),l.setHours(0,0,0,0);const o=_f(l,s),d=gd((s==null?void 0:s.in)||t,0);d.setFullYear(a,0,i),d.setHours(0,0,0,0);const u=_f(d,s);return+r>=+o?a+1:+r>=+u?a:a-1}function yP(t,s){var o,d,u,c;const r=ep(),a=(s==null?void 0:s.firstWeekContainsDate)??((d=(o=s==null?void 0:s.locale)==null?void 0:o.options)==null?void 0:d.firstWeekContainsDate)??r.firstWeekContainsDate??((c=(u=r.locale)==null?void 0:u.options)==null?void 0:c.firstWeekContainsDate)??1,n=d5(t,s),i=gd((s==null?void 0:s.in)||t,0);return i.setFullYear(n,0,a),i.setHours(0,0,0,0),_f(i,s)}function jP(t,s){const r=In(t,s==null?void 0:s.in),a=+_f(r,s)-+yP(r,s);return Math.round(a/l5)+1}function $r(t,s){const r=t<0?"-":"",a=Math.abs(t).toString().padStart(s,"0");return r+a}const au={y(t,s){const r=t.getFullYear(),a=r>0?r:1-r;return $r(s==="yy"?a%100:a,s.length)},M(t,s){const r=t.getMonth();return s==="M"?String(r+1):$r(r+1,2)},d(t,s){return $r(t.getDate(),s.length)},a(t,s){const r=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(t,s){return $r(t.getHours()%12||12,s.length)},H(t,s){return $r(t.getHours(),s.length)},m(t,s){return $r(t.getMinutes(),s.length)},s(t,s){return $r(t.getSeconds(),s.length)},S(t,s){const r=s.length,a=t.getMilliseconds(),n=Math.trunc(a*Math.pow(10,r-3));return $r(n,s.length)}},dh={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},d_={G:function(t,s,r){const a=t.getFullYear()>0?1:0;switch(s){case"G":case"GG":case"GGG":return r.era(a,{width:"abbreviated"});case"GGGGG":return r.era(a,{width:"narrow"});case"GGGG":default:return r.era(a,{width:"wide"})}},y:function(t,s,r){if(s==="yo"){const a=t.getFullYear(),n=a>0?a:1-a;return r.ordinalNumber(n,{unit:"year"})}return au.y(t,s)},Y:function(t,s,r,a){const n=d5(t,a),i=n>0?n:1-n;if(s==="YY"){const l=i%100;return $r(l,2)}return s==="Yo"?r.ordinalNumber(i,{unit:"year"}):$r(i,s.length)},R:function(t,s){const r=o5(t);return $r(r,s.length)},u:function(t,s){const r=t.getFullYear();return $r(r,s.length)},Q:function(t,s,r){const a=Math.ceil((t.getMonth()+1)/3);switch(s){case"Q":return String(a);case"QQ":return $r(a,2);case"Qo":return r.ordinalNumber(a,{unit:"quarter"});case"QQQ":return r.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(a,{width:"wide",context:"formatting"})}},q:function(t,s,r){const a=Math.ceil((t.getMonth()+1)/3);switch(s){case"q":return String(a);case"qq":return $r(a,2);case"qo":return r.ordinalNumber(a,{unit:"quarter"});case"qqq":return r.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(a,{width:"wide",context:"standalone"})}},M:function(t,s,r){const a=t.getMonth();switch(s){case"M":case"MM":return au.M(t,s);case"Mo":return r.ordinalNumber(a+1,{unit:"month"});case"MMM":return r.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(a,{width:"wide",context:"formatting"})}},L:function(t,s,r){const a=t.getMonth();switch(s){case"L":return String(a+1);case"LL":return $r(a+1,2);case"Lo":return r.ordinalNumber(a+1,{unit:"month"});case"LLL":return r.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(a,{width:"wide",context:"standalone"})}},w:function(t,s,r,a){const n=jP(t,a);return s==="wo"?r.ordinalNumber(n,{unit:"week"}):$r(n,s.length)},I:function(t,s,r){const a=bP(t);return s==="Io"?r.ordinalNumber(a,{unit:"week"}):$r(a,s.length)},d:function(t,s,r){return s==="do"?r.ordinalNumber(t.getDate(),{unit:"date"}):au.d(t,s)},D:function(t,s,r){const a=vP(t);return s==="Do"?r.ordinalNumber(a,{unit:"dayOfYear"}):$r(a,s.length)},E:function(t,s,r){const a=t.getDay();switch(s){case"E":case"EE":case"EEE":return r.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(a,{width:"short",context:"formatting"});case"EEEE":default:return r.day(a,{width:"wide",context:"formatting"})}},e:function(t,s,r,a){const n=t.getDay(),i=(n-a.weekStartsOn+8)%7||7;switch(s){case"e":return String(i);case"ee":return $r(i,2);case"eo":return r.ordinalNumber(i,{unit:"day"});case"eee":return r.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(n,{width:"short",context:"formatting"});case"eeee":default:return r.day(n,{width:"wide",context:"formatting"})}},c:function(t,s,r,a){const n=t.getDay(),i=(n-a.weekStartsOn+8)%7||7;switch(s){case"c":return String(i);case"cc":return $r(i,s.length);case"co":return r.ordinalNumber(i,{unit:"day"});case"ccc":return r.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(n,{width:"narrow",context:"standalone"});case"cccccc":return r.day(n,{width:"short",context:"standalone"});case"cccc":default:return r.day(n,{width:"wide",context:"standalone"})}},i:function(t,s,r){const a=t.getDay(),n=a===0?7:a;switch(s){case"i":return String(n);case"ii":return $r(n,s.length);case"io":return r.ordinalNumber(n,{unit:"day"});case"iii":return r.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(a,{width:"short",context:"formatting"});case"iiii":default:return r.day(a,{width:"wide",context:"formatting"})}},a:function(t,s,r){const n=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(t,s,r){const a=t.getHours();let n;switch(a===12?n=dh.noon:a===0?n=dh.midnight:n=a/12>=1?"pm":"am",s){case"b":case"bb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(t,s,r){const a=t.getHours();let n;switch(a>=17?n=dh.evening:a>=12?n=dh.afternoon:a>=4?n=dh.morning:n=dh.night,s){case"B":case"BB":case"BBB":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(t,s,r){if(s==="ho"){let a=t.getHours()%12;return a===0&&(a=12),r.ordinalNumber(a,{unit:"hour"})}return au.h(t,s)},H:function(t,s,r){return s==="Ho"?r.ordinalNumber(t.getHours(),{unit:"hour"}):au.H(t,s)},K:function(t,s,r){const a=t.getHours()%12;return s==="Ko"?r.ordinalNumber(a,{unit:"hour"}):$r(a,s.length)},k:function(t,s,r){let a=t.getHours();return a===0&&(a=24),s==="ko"?r.ordinalNumber(a,{unit:"hour"}):$r(a,s.length)},m:function(t,s,r){return s==="mo"?r.ordinalNumber(t.getMinutes(),{unit:"minute"}):au.m(t,s)},s:function(t,s,r){return s==="so"?r.ordinalNumber(t.getSeconds(),{unit:"second"}):au.s(t,s)},S:function(t,s){return au.S(t,s)},X:function(t,s,r){const a=t.getTimezoneOffset();if(a===0)return"Z";switch(s){case"X":return m_(a);case"XXXX":case"XX":return om(a);case"XXXXX":case"XXX":default:return om(a,":")}},x:function(t,s,r){const a=t.getTimezoneOffset();switch(s){case"x":return m_(a);case"xxxx":case"xx":return om(a);case"xxxxx":case"xxx":default:return om(a,":")}},O:function(t,s,r){const a=t.getTimezoneOffset();switch(s){case"O":case"OO":case"OOO":return"GMT"+u_(a,":");case"OOOO":default:return"GMT"+om(a,":")}},z:function(t,s,r){const a=t.getTimezoneOffset();switch(s){case"z":case"zz":case"zzz":return"GMT"+u_(a,":");case"zzzz":default:return"GMT"+om(a,":")}},t:function(t,s,r){const a=Math.trunc(+t/1e3);return $r(a,s.length)},T:function(t,s,r){return $r(+t,s.length)}};function u_(t,s=""){const r=t>0?"-":"+",a=Math.abs(t),n=Math.trunc(a/60),i=a%60;return i===0?r+String(n):r+String(n)+s+$r(i,2)}function m_(t,s){return t%60===0?(t>0?"-":"+")+$r(Math.abs(t)/60,2):om(t,s)}function om(t,s=""){const r=t>0?"-":"+",a=Math.abs(t),n=$r(Math.trunc(a/60),2),i=$r(a%60,2);return r+n+s+i}const h_=(t,s)=>{switch(t){case"P":return s.date({width:"short"});case"PP":return s.date({width:"medium"});case"PPP":return s.date({width:"long"});case"PPPP":default:return s.date({width:"full"})}},u5=(t,s)=>{switch(t){case"p":return s.time({width:"short"});case"pp":return s.time({width:"medium"});case"ppp":return s.time({width:"long"});case"pppp":default:return s.time({width:"full"})}},NP=(t,s)=>{const r=t.match(/(P+)(p+)?/)||[],a=r[1],n=r[2];if(!n)return h_(t,s);let i;switch(a){case"P":i=s.dateTime({width:"short"});break;case"PP":i=s.dateTime({width:"medium"});break;case"PPP":i=s.dateTime({width:"long"});break;case"PPPP":default:i=s.dateTime({width:"full"});break}return i.replace("{{date}}",h_(a,s)).replace("{{time}}",u5(n,s))},wP={p:u5,P:NP},_P=/^D+$/,SP=/^Y+$/,CP=["D","DD","YY","YYYY"];function kP(t){return _P.test(t)}function EP(t){return SP.test(t)}function BP(t,s,r){const a=FP(t,s,r);if(console.warn(a),CP.includes(t))throw new RangeError(a)}function FP(t,s,r){const a=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${s}\`) for formatting ${a} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const TP=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,IP=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,LP=/^'([^]*?)'?$/,DP=/''/g,PP=/[a-zA-Z]/;function Eh(t,s,r){var c,h,m,p;const a=ep(),n=a.locale??c5,i=a.firstWeekContainsDate??((h=(c=a.locale)==null?void 0:c.options)==null?void 0:h.firstWeekContainsDate)??1,l=a.weekStartsOn??((p=(m=a.locale)==null?void 0:m.options)==null?void 0:p.weekStartsOn)??0,o=In(t,r==null?void 0:r.in);if(!FD(o))throw new RangeError("Invalid time value");let d=s.match(IP).map(g=>{const x=g[0];if(x==="p"||x==="P"){const b=wP[x];return b(g,n.formatLong)}return g}).join("").match(TP).map(g=>{if(g==="''")return{isToken:!1,value:"'"};const x=g[0];if(x==="'")return{isToken:!1,value:UP(g)};if(d_[x])return{isToken:!0,value:g};if(x.match(PP))throw new RangeError("Format string contains an unescaped latin alphabet character `"+x+"`");return{isToken:!1,value:g}});n.localize.preprocessor&&(d=n.localize.preprocessor(o,d));const u={firstWeekContainsDate:i,weekStartsOn:l,locale:n};return d.map(g=>{if(!g.isToken)return g.value;const x=g.value;(EP(x)||kP(x))&&BP(x,s,String(t));const b=d_[x[0]];return b(o,x,n.localize,u)}).join("")}function UP(t){const s=t.match(LP);return s?s[1].replace(DP,"'"):t}function RP(t,s,r){const a=ep(),n=(r==null?void 0:r.locale)??a.locale??c5,i=2520,l=zx(t,s);if(isNaN(l))throw new RangeError("Invalid time value");const o=Object.assign({},r,{addSuffix:r==null?void 0:r.addSuffix,comparison:l}),[d,u]=mg(r==null?void 0:r.in,...l>0?[s,t]:[t,s]),c=OD(u,d),h=(y0(u)-y0(d))/1e3,m=Math.round((c-h)/60);let p;if(m<2)return r!=null&&r.includeSeconds?c<5?n.formatDistance("lessThanXSeconds",5,o):c<10?n.formatDistance("lessThanXSeconds",10,o):c<20?n.formatDistance("lessThanXSeconds",20,o):c<40?n.formatDistance("halfAMinute",0,o):c<60?n.formatDistance("lessThanXMinutes",1,o):n.formatDistance("xMinutes",1,o):m===0?n.formatDistance("lessThanXMinutes",1,o):n.formatDistance("xMinutes",m,o);if(m<45)return n.formatDistance("xMinutes",m,o);if(m<90)return n.formatDistance("aboutXHours",1,o);if(m<l_){const g=Math.round(m/60);return n.formatDistance("aboutXHours",g,o)}else{if(m<i)return n.formatDistance("xDays",1,o);if(m<Jp){const g=Math.round(m/l_);return n.formatDistance("xDays",g,o)}else if(m<Jp*2)return p=Math.round(m/Jp),n.formatDistance("aboutXMonths",p,o)}if(p=RD(u,d),p<12){const g=Math.round(m/Jp);return n.formatDistance("xMonths",g,o)}else{const g=p%12,x=Math.trunc(p/12);return g<3?n.formatDistance("aboutXYears",x,o):g<9?n.formatDistance("overXYears",x,o):n.formatDistance("almostXYears",x+1,o)}}function A_(t,s){return RP(t,ED(t),s)}const zv=new Map;function OP({post:t,setPosts:s,defaultShowComments:r=!1,forceOpenComments:a=!1}){const[n,i]=f.useState(""),[l,o]=f.useState(!1),[d,u]=f.useState(null),[c,h]=f.useState({}),[m,p]=f.useState(!!r),g=localStorage.getItem("token"),{user:x}=Kr(),b=ps(),y=R=>{if(!R)return null;if(/^(data:|https?:)/i.test(R))return R;if(R.startsWith("/uploads")){const U=String(Z.defaults.baseURL||"");let T="";if(/^https?:\/\//i.test(U))try{const Y=new URL(U);T=`${Y.protocol}//${Y.host}`}catch{}else typeof window<"u"&&window.location&&(T=window.location.origin);return T?T+R:R}return R},[j,N]=f.useState(y(t.image_url)),[_,F]=f.useState(null);f.useEffect(()=>{N(y(t.image_url))},[t.image_url]),f.useEffect(()=>()=>{try{_&&_.startsWith("blob:")&&URL.revokeObjectURL(_)}catch{}},[_]);const I=async()=>{const R=String(t.image_url||"");try{const U=typeof window<"u"&&window.location?window.location.origin:"",T=String(Z.defaults.baseURL||"");let Y="";if(/^https?:\/\//i.test(T))try{const M=new URL(T);Y=`${M.protocol}//${M.host}`}catch{}const H=[];try{if(/^https?:\/\//i.test(R)){const M=new URL(R);(M.hostname==="localhost"||M.hostname==="127.0.0.1")&&(H.push(`${U}${M.pathname}`),Y&&H.push(`${Y}${M.pathname}`))}}catch{}R.startsWith("/uploads")?(H.push(`${U}${R}`),Y&&H.push(`${Y}${R}`)):R.startsWith("uploads")&&(H.push(`${U}/${R}`),Y&&H.push(`${Y}/${R}`)),H.push(R);for(const M of H)if(!(!M||M===j))try{const q=await fetch(M,{mode:"cors"});if(q&&q.ok){const z=await q.blob(),Q=URL.createObjectURL(z);try{_&&_.startsWith("blob:")&&URL.revokeObjectURL(_)}catch{}F(Q),N(Q);return}}catch{}N("/OMNISUITE_ICON_CLEAR.png")}catch{N("/OMNISUITE_ICON_CLEAR.png")}},w=async()=>{const R=Number((x==null?void 0:x.sub)||(x==null?void 0:x.id))||"";t.user_liked?(await fetch(`/api/social-feed/${t.id}/like`,{method:"DELETE",headers:{Authorization:`Bearer ${g}`,"x-user-id":String(R)}}),s(U=>U.map(T=>T.id===t.id?{...T,like_count:T.like_count-1,user_liked:!1}:T))):(await fetch(`/api/social-feed/${t.id}/like`,{method:"POST",headers:{Authorization:`Bearer ${g}`,"x-user-id":String(R)}}),s(U=>U.map(T=>T.id===t.id?{...T,like_count:T.like_count+1,user_liked:!0}:T)))},E=async R=>{if(R.preventDefault(),!!n.trim()){o(!0);try{const U=Number((x==null?void 0:x.sub)||(x==null?void 0:x.id))||"",T=await fetch(`/api/social-feed/${t.id}/comments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`,"x-user-id":String(U)},body:JSON.stringify({comment_text:n})});if(T.ok){const Y=await T.json();s(H=>H.map(M=>M.id===t.id?{...M,comments:[...M.comments,Y.data],comment_count:M.comment_count+1}:M)),i("")}}catch(U){console.error("Error adding comment:",U)}finally{o(!1)}}},W=async()=>{try{const R=Number((x==null?void 0:x.sub)||(x==null?void 0:x.id))||"",U=Array.isArray(t.comments)?t.comments.length:0,T=Number(t.comment_count||U),Y=Math.max(T-U,0);if(Y<=0){p(!0);return}o(!0);const H=await fetch(`/api/social-feed/${t.id}/comments?offset=${U}&limit=${Y}`,{headers:{Authorization:`Bearer ${g}`,"x-user-id":String(R)}});if(!H.ok)throw new Error("Failed to load comments");const M=await H.json(),q=Array.isArray(M.data)?M.data:[];s(z=>z.map(Q=>{if(Q.id!==t.id)return Q;const L=new Set((Q.comments||[]).map(P=>P.id)),V=[...Q.comments||[],...q.filter(P=>!L.has(P.id))];return{...Q,comments:V,comment_count:Q.comment_count}})),p(!0)}catch(R){console.error("Error loading all comments:",R)}finally{o(!1)}};return f.useEffect(()=>{Number((x==null?void 0:x.sub)||(x==null?void 0:x.id));async function R(Y){var M;const H=Number(Y);if(!Number.isFinite(H)||H<=0)return null;if(zv.has(H))return zv.get(H);try{const q=await fetch(`/api/admin/users/${H}`,{headers:{Authorization:`Bearer ${g}`}});if(!q.ok)return null;const z=await q.json(),Q=((M=z==null?void 0:z.data)==null?void 0:M.item)||(z==null?void 0:z.item)||(z==null?void 0:z.data)||z||null,L=(Q==null?void 0:Q.profile_picture_url)||null;return L&&zv.set(H,L),L}catch{return null}}const U=t.user_id||t.userId||t.author_user_id||t.authorId||null;let T=!0;return(async()=>{const Y=await R(U);T&&Y&&u(Y);const M=(Array.isArray(t.comments)?t.comments:[]).map(Q=>Q.user_id||Q.userId||Q.author_user_id||Q.authorId||null).filter(Q=>Number.isFinite(Number(Q))&&Number(Q)>0),q=Array.from(new Set(M)),z={};for(const Q of q){const L=await R(Q);L&&(z[Number(Q)]=L)}T&&h(z)})(),()=>{T=!1}},[t,g,x==null?void 0:x.sub,x==null?void 0:x.id]),f.useEffect(()=>{a&&p(!0)},[a]),e.jsxs("div",{className:"post-card",onClick:()=>b(`/social-feed/${t.id}`),role:"button",tabIndex:0,children:[e.jsxs("div",{className:"post-header",children:[e.jsxs("div",{className:"author-info",children:[e.jsx("img",{src:d||t.profile_picture_url||"",alt:t.full_name,className:"avatar"}),e.jsxs("div",{className:"author-details",children:[e.jsx("h4",{children:t.full_name}),e.jsx("span",{className:"post-time",children:A_(new Date(t.created_at),{addSuffix:!0})})]})]}),e.jsxs("div",{className:"visibility-badge",children:[t.visibility_type==="company"&&" Company",t.visibility_type==="warehouse"&&" Warehouse"]})]}),e.jsxs("div",{className:"post-content",children:[e.jsx("p",{children:t.content}),t.image_url&&e.jsx("img",{src:j,alt:"Post",className:"post-image",onError:I,crossOrigin:"anonymous"})]}),e.jsxs("div",{className:"post-stats",children:[e.jsxs("span",{children:[" ",t.like_count," Likes"]}),e.jsxs("span",{children:[" ",t.comment_count," Comments"]})]}),e.jsxs("div",{className:"post-actions",children:[e.jsx("button",{className:`btn-action ${t.user_liked?"liked":""}`,onClick:R=>{R.stopPropagation(),w()},children:" Like"}),e.jsx("button",{className:"btn-action",onClick:R=>{R.stopPropagation(),m?p(!1):W()},disabled:l||(t.comment_count??0)>0&&Array.isArray(t.comments)&&t.comments.length>=(t.comment_count??0),children:(()=>{const R=Number(t.comment_count??0),U=Array.isArray(t.comments)?t.comments.length:0;return m&&R>0&&U>=R?"All Comments Shown":m?"Hide Comments":"Show Comments"})()}),e.jsx("button",{className:"btn-action",onClick:R=>{R.stopPropagation(),b(`/social-feed/${t.id}`)},children:" View"})]}),m&&e.jsxs("div",{className:"comments-section-inline",children:[e.jsx("div",{className:"comments-list",children:t.comments&&t.comments.length>0&&t.comments.map(R=>e.jsxs("div",{className:"comment",children:[e.jsx("img",{src:c[Number(R.user_id||R.userId||R.author_user_id||R.authorId||0)]||R.profile_picture_url||"/default-avatar.png",alt:R.full_name,className:"avatar-small"}),e.jsxs("div",{className:"comment-content",children:[e.jsx("h5",{children:R.full_name}),e.jsx("p",{children:R.comment_text}),e.jsx("span",{className:"comment-time",children:A_(new Date(R.created_at),{addSuffix:!0})})]})]},R.id))}),e.jsxs("form",{onSubmit:E,className:"comment-form",children:[e.jsx("input",{type:"text",placeholder:"Write a comment...",value:n,onChange:R=>i(R.target.value),disabled:l}),e.jsx("button",{type:"submit",disabled:l||!n.trim(),children:l?"...":"Post"})]})]})]})}function MP({posts:t,setPosts:s,defaultShowComments:r=!1,forceOpenComments:a=!1}){return e.jsx("div",{className:"post-list",children:t.map(n=>e.jsx(OP,{post:n,setPosts:s,defaultShowComments:r,forceOpenComments:a},n.id))})}const kc=Object.create(null);kc.open="0";kc.close="1";kc.ping="2";kc.pong="3";kc.message="4";kc.upgrade="5";kc.noop="6";const Yx=Object.create(null);Object.keys(kc).forEach(t=>{Yx[kc[t]]=t});const Ny={type:"error",data:"parser error"},m5=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",h5=typeof ArrayBuffer=="function",A5=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,$j=({type:t,data:s},r,a)=>m5&&s instanceof Blob?r?a(s):f_(s,a):h5&&(s instanceof ArrayBuffer||A5(s))?r?a(s):f_(new Blob([s]),a):a(kc[t]+(s||"")),f_=(t,s)=>{const r=new FileReader;return r.onload=function(){const a=r.result.split(",")[1];s("b"+(a||""))},r.readAsDataURL(t)};function p_(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let Yv;function QP(t,s){if(m5&&t.data instanceof Blob)return t.data.arrayBuffer().then(p_).then(s);if(h5&&(t.data instanceof ArrayBuffer||A5(t.data)))return s(p_(t.data));$j(t,!1,r=>{Yv||(Yv=new TextEncoder),s(Yv.encode(r))})}const x_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",HA=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<x_.length;t++)HA[x_.charCodeAt(t)]=t;const HP=t=>{let s=t.length*.75,r=t.length,a,n=0,i,l,o,d;t[t.length-1]==="="&&(s--,t[t.length-2]==="="&&s--);const u=new ArrayBuffer(s),c=new Uint8Array(u);for(a=0;a<r;a+=4)i=HA[t.charCodeAt(a)],l=HA[t.charCodeAt(a+1)],o=HA[t.charCodeAt(a+2)],d=HA[t.charCodeAt(a+3)],c[n++]=i<<2|l>>4,c[n++]=(l&15)<<4|o>>2,c[n++]=(o&3)<<6|d&63;return u},qP=typeof ArrayBuffer=="function",Vj=(t,s)=>{if(typeof t!="string")return{type:"message",data:f5(t,s)};const r=t.charAt(0);return r==="b"?{type:"message",data:$P(t.substring(1),s)}:Yx[r]?t.length>1?{type:Yx[r],data:t.substring(1)}:{type:Yx[r]}:Ny},$P=(t,s)=>{if(qP){const r=HP(t);return f5(r,s)}else return{base64:!0,data:t}},f5=(t,s)=>{switch(s){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},p5="",VP=(t,s)=>{const r=t.length,a=new Array(r);let n=0;t.forEach((i,l)=>{$j(i,!1,o=>{a[l]=o,++n===r&&s(a.join(p5))})})},WP=(t,s)=>{const r=t.split(p5),a=[];for(let n=0;n<r.length;n++){const i=Vj(r[n],s);if(a.push(i),i.type==="error")break}return a};function GP(){return new TransformStream({transform(t,s){QP(t,r=>{const a=r.length;let n;if(a<126)n=new Uint8Array(1),new DataView(n.buffer).setUint8(0,a);else if(a<65536){n=new Uint8Array(3);const i=new DataView(n.buffer);i.setUint8(0,126),i.setUint16(1,a)}else{n=new Uint8Array(9);const i=new DataView(n.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(a))}t.data&&typeof t.data!="string"&&(n[0]|=128),s.enqueue(n),s.enqueue(r)})}})}let Xv;function Zp(t){return t.reduce((s,r)=>s+r.length,0)}function ex(t,s){if(t[0].length===s)return t.shift();const r=new Uint8Array(s);let a=0;for(let n=0;n<s;n++)r[n]=t[0][a++],a===t[0].length&&(t.shift(),a=0);return t.length&&a<t[0].length&&(t[0]=t[0].slice(a)),r}function KP(t,s){Xv||(Xv=new TextDecoder);const r=[];let a=0,n=-1,i=!1;return new TransformStream({transform(l,o){for(r.push(l);;){if(a===0){if(Zp(r)<1)break;const d=ex(r,1);i=(d[0]&128)===128,n=d[0]&127,n<126?a=3:n===126?a=1:a=2}else if(a===1){if(Zp(r)<2)break;const d=ex(r,2);n=new DataView(d.buffer,d.byteOffset,d.length).getUint16(0),a=3}else if(a===2){if(Zp(r)<8)break;const d=ex(r,8),u=new DataView(d.buffer,d.byteOffset,d.length),c=u.getUint32(0);if(c>Math.pow(2,21)-1){o.enqueue(Ny);break}n=c*Math.pow(2,32)+u.getUint32(4),a=3}else{if(Zp(r)<n)break;const d=ex(r,n);o.enqueue(Vj(i?d:Xv.decode(d),s)),a=0}if(n===0||n>t){o.enqueue(Ny);break}}}})}const x5=4;function on(t){if(t)return zP(t)}function zP(t){for(var s in on.prototype)t[s]=on.prototype[s];return t}on.prototype.on=on.prototype.addEventListener=function(t,s){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(s),this};on.prototype.once=function(t,s){function r(){this.off(t,r),s.apply(this,arguments)}return r.fn=s,this.on(t,r),this};on.prototype.off=on.prototype.removeListener=on.prototype.removeAllListeners=on.prototype.removeEventListener=function(t,s){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var r=this._callbacks["$"+t];if(!r)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var a,n=0;n<r.length;n++)if(a=r[n],a===s||a.fn===s){r.splice(n,1);break}return r.length===0&&delete this._callbacks["$"+t],this};on.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var s=new Array(arguments.length-1),r=this._callbacks["$"+t],a=1;a<arguments.length;a++)s[a-1]=arguments[a];if(r){r=r.slice(0);for(var a=0,n=r.length;a<n;++a)r[a].apply(this,s)}return this};on.prototype.emitReserved=on.prototype.emit;on.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};on.prototype.hasListeners=function(t){return!!this.listeners(t).length};const hg=typeof Promise=="function"&&typeof Promise.resolve=="function"?s=>Promise.resolve().then(s):(s,r)=>r(s,0),to=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),YP="arraybuffer";function g5(t,...s){return s.reduce((r,a)=>(t.hasOwnProperty(a)&&(r[a]=t[a]),r),{})}const XP=to.setTimeout,JP=to.clearTimeout;function Ag(t,s){s.useNativeTimers?(t.setTimeoutFn=XP.bind(to),t.clearTimeoutFn=JP.bind(to)):(t.setTimeoutFn=to.setTimeout.bind(to),t.clearTimeoutFn=to.clearTimeout.bind(to))}const ZP=1.33;function eU(t){return typeof t=="string"?tU(t):Math.ceil((t.byteLength||t.size)*ZP)}function tU(t){let s=0,r=0;for(let a=0,n=t.length;a<n;a++)s=t.charCodeAt(a),s<128?r+=1:s<2048?r+=2:s<55296||s>=57344?r+=3:(a++,r+=4);return r}function v5(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function sU(t){let s="";for(let r in t)t.hasOwnProperty(r)&&(s.length&&(s+="&"),s+=encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return s}function rU(t){let s={},r=t.split("&");for(let a=0,n=r.length;a<n;a++){let i=r[a].split("=");s[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return s}class aU extends Error{constructor(s,r,a){super(s),this.description=r,this.context=a,this.type="TransportError"}}class Wj extends on{constructor(s){super(),this.writable=!1,Ag(this,s),this.opts=s,this.query=s.query,this.socket=s.socket,this.supportsBinary=!s.forceBase64}onError(s,r,a){return super.emitReserved("error",new aU(s,r,a)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(s){this.readyState==="open"&&this.write(s)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(s){const r=Vj(s,this.socket.binaryType);this.onPacket(r)}onPacket(s){super.emitReserved("packet",s)}onClose(s){this.readyState="closed",super.emitReserved("close",s)}pause(s){}createUri(s,r={}){return s+"://"+this._hostname()+this._port()+this.opts.path+this._query(r)}_hostname(){const s=this.opts.hostname;return s.indexOf(":")===-1?s:"["+s+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port)!==443||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(s){const r=sU(s);return r.length?"?"+r:""}}class nU extends Wj{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(s){this.readyState="pausing";const r=()=>{this.readyState="paused",s()};if(this._polling||!this.writable){let a=0;this._polling&&(a++,this.once("pollComplete",function(){--a||r()})),this.writable||(a++,this.once("drain",function(){--a||r()}))}else r()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(s){const r=a=>{if(this.readyState==="opening"&&a.type==="open"&&this.onOpen(),a.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(a)};WP(s,this.socket.binaryType).forEach(r),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const s=()=>{this.write([{type:"close"}])};this.readyState==="open"?s():this.once("open",s)}write(s){this.writable=!1,VP(s,r=>{this.doWrite(r,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const s=this.opts.secure?"https":"http",r=this.query||{};return this.opts.timestampRequests!==!1&&(r[this.opts.timestampParam]=v5()),!this.supportsBinary&&!r.sid&&(r.b64=1),this.createUri(s,r)}}let b5=!1;try{b5=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const iU=b5;function lU(){}class oU extends nU{constructor(s){if(super(s),typeof location<"u"){const r=location.protocol==="https:";let a=location.port;a||(a=r?"443":"80"),this.xd=typeof location<"u"&&s.hostname!==location.hostname||a!==s.port}}doWrite(s,r){const a=this.request({method:"POST",data:s});a.on("success",r),a.on("error",(n,i)=>{this.onError("xhr post error",n,i)})}doPoll(){const s=this.request();s.on("data",this.onData.bind(this)),s.on("error",(r,a)=>{this.onError("xhr poll error",r,a)}),this.pollXhr=s}}class wc extends on{constructor(s,r,a){super(),this.createRequest=s,Ag(this,a),this._opts=a,this._method=a.method||"GET",this._uri=r,this._data=a.data!==void 0?a.data:null,this._create()}_create(){var s;const r=g5(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this._opts.xd;const a=this._xhr=this.createRequest(r);try{a.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){a.setDisableHeaderCheck&&a.setDisableHeaderCheck(!0);for(let n in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(n)&&a.setRequestHeader(n,this._opts.extraHeaders[n])}}catch{}if(this._method==="POST")try{a.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{a.setRequestHeader("Accept","*/*")}catch{}(s=this._opts.cookieJar)===null||s===void 0||s.addCookies(a),"withCredentials"in a&&(a.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(a.timeout=this._opts.requestTimeout),a.onreadystatechange=()=>{var n;a.readyState===3&&((n=this._opts.cookieJar)===null||n===void 0||n.parseCookies(a.getResponseHeader("set-cookie"))),a.readyState===4&&(a.status===200||a.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof a.status=="number"?a.status:0)},0))},a.send(this._data)}catch(n){this.setTimeoutFn(()=>{this._onError(n)},0);return}typeof document<"u"&&(this._index=wc.requestsCount++,wc.requests[this._index]=this)}_onError(s){this.emitReserved("error",s,this._xhr),this._cleanup(!0)}_cleanup(s){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=lU,s)try{this._xhr.abort()}catch{}typeof document<"u"&&delete wc.requests[this._index],this._xhr=null}}_onLoad(){const s=this._xhr.responseText;s!==null&&(this.emitReserved("data",s),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}wc.requestsCount=0;wc.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",g_);else if(typeof addEventListener=="function"){const t="onpagehide"in to?"pagehide":"unload";addEventListener(t,g_,!1)}}function g_(){for(let t in wc.requests)wc.requests.hasOwnProperty(t)&&wc.requests[t].abort()}const cU=(function(){const t=y5({xdomain:!1});return t&&t.responseType!==null})();class dU extends oU{constructor(s){super(s);const r=s&&s.forceBase64;this.supportsBinary=cU&&!r}request(s={}){return Object.assign(s,{xd:this.xd},this.opts),new wc(y5,this.uri(),s)}}function y5(t){const s=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!s||iU))return new XMLHttpRequest}catch{}if(!s)try{return new to[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const j5=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class uU extends Wj{get name(){return"websocket"}doOpen(){const s=this.uri(),r=this.opts.protocols,a=j5?{}:g5(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(a.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(s,r,a)}catch(n){return this.emitReserved("error",n)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=s=>this.onClose({description:"websocket connection closed",context:s}),this.ws.onmessage=s=>this.onData(s.data),this.ws.onerror=s=>this.onError("websocket error",s)}write(s){this.writable=!1;for(let r=0;r<s.length;r++){const a=s[r],n=r===s.length-1;$j(a,this.supportsBinary,i=>{try{this.doWrite(a,i)}catch{}n&&hg(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const s=this.opts.secure?"wss":"ws",r=this.query||{};return this.opts.timestampRequests&&(r[this.opts.timestampParam]=v5()),this.supportsBinary||(r.b64=1),this.createUri(s,r)}}const Jv=to.WebSocket||to.MozWebSocket;class mU extends uU{createSocket(s,r,a){return j5?new Jv(s,r,a):r?new Jv(s,r):new Jv(s)}doWrite(s,r){this.ws.send(r)}}class hU extends Wj{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(s){return this.emitReserved("error",s)}this._transport.closed.then(()=>{this.onClose()}).catch(s=>{this.onError("webtransport error",s)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(s=>{const r=KP(Number.MAX_SAFE_INTEGER,this.socket.binaryType),a=s.readable.pipeThrough(r).getReader(),n=GP();n.readable.pipeTo(s.writable),this._writer=n.writable.getWriter();const i=()=>{a.read().then(({done:o,value:d})=>{o||(this.onPacket(d),i())}).catch(o=>{})};i();const l={type:"open"};this.query.sid&&(l.data=`{"sid":"${this.query.sid}"}`),this._writer.write(l).then(()=>this.onOpen())})})}write(s){this.writable=!1;for(let r=0;r<s.length;r++){const a=s[r],n=r===s.length-1;this._writer.write(a).then(()=>{n&&hg(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var s;(s=this._transport)===null||s===void 0||s.close()}}const AU={websocket:mU,webtransport:hU,polling:dU},fU=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,pU=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function wy(t){if(t.length>8e3)throw"URI too long";const s=t,r=t.indexOf("["),a=t.indexOf("]");r!=-1&&a!=-1&&(t=t.substring(0,r)+t.substring(r,a).replace(/:/g,";")+t.substring(a,t.length));let n=fU.exec(t||""),i={},l=14;for(;l--;)i[pU[l]]=n[l]||"";return r!=-1&&a!=-1&&(i.source=s,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=xU(i,i.path),i.queryKey=gU(i,i.query),i}function xU(t,s){const r=/\/{2,9}/g,a=s.replace(r,"/").split("/");return(s.slice(0,1)=="/"||s.length===0)&&a.splice(0,1),s.slice(-1)=="/"&&a.splice(a.length-1,1),a}function gU(t,s){const r={};return s.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(a,n,i){n&&(r[n]=i)}),r}const _y=typeof addEventListener=="function"&&typeof removeEventListener=="function",Xx=[];_y&&addEventListener("offline",()=>{Xx.forEach(t=>t())},!1);class ju extends on{constructor(s,r){if(super(),this.binaryType=YP,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,s&&typeof s=="object"&&(r=s,s=null),s){const a=wy(s);r.hostname=a.host,r.secure=a.protocol==="https"||a.protocol==="wss",r.port=a.port,a.query&&(r.query=a.query)}else r.host&&(r.hostname=wy(r.host).host);Ag(this,r),this.secure=r.secure!=null?r.secure:typeof location<"u"&&location.protocol==="https:",r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.hostname=r.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=r.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},r.transports.forEach(a=>{const n=a.prototype.name;this.transports.push(n),this._transportsByName[n]=a}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},r),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=rU(this.opts.query)),_y&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Xx.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(s){const r=Object.assign({},this.opts.query);r.EIO=x5,r.transport=s,this.id&&(r.sid=this.id);const a=Object.assign({},this.opts,{query:r,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[s]);return new this._transportsByName[s](a)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const s=this.opts.rememberUpgrade&&ju.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const r=this.createTransport(s);r.open(),this.setTransport(r)}setTransport(s){this.transport&&this.transport.removeAllListeners(),this.transport=s,s.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",r=>this._onClose("transport close",r))}onOpen(){this.readyState="open",ju.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(s){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",s),this.emitReserved("heartbeat"),s.type){case"open":this.onHandshake(JSON.parse(s.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const r=new Error("server error");r.code=s.data,this._onError(r);break;case"message":this.emitReserved("data",s.data),this.emitReserved("message",s.data);break}}onHandshake(s){this.emitReserved("handshake",s),this.id=s.sid,this.transport.query.sid=s.sid,this._pingInterval=s.pingInterval,this._pingTimeout=s.pingTimeout,this._maxPayload=s.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const s=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+s,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},s),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const s=this._getWritablePackets();this.transport.send(s),this._prevBufferLen=s.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let r=1;for(let a=0;a<this.writeBuffer.length;a++){const n=this.writeBuffer[a].data;if(n&&(r+=eU(n)),a>0&&r>this._maxPayload)return this.writeBuffer.slice(0,a);r+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const s=Date.now()>this._pingTimeoutTime;return s&&(this._pingTimeoutTime=0,hg(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),s}write(s,r,a){return this._sendPacket("message",s,r,a),this}send(s,r,a){return this._sendPacket("message",s,r,a),this}_sendPacket(s,r,a,n){if(typeof r=="function"&&(n=r,r=void 0),typeof a=="function"&&(n=a,a=null),this.readyState==="closing"||this.readyState==="closed")return;a=a||{},a.compress=a.compress!==!1;const i={type:s,data:r,options:a};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){const s=()=>{this._onClose("forced close"),this.transport.close()},r=()=>{this.off("upgrade",r),this.off("upgradeError",r),s()},a=()=>{this.once("upgrade",r),this.once("upgradeError",r)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?a():s()}):this.upgrading?a():s()),this}_onError(s){if(ju.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",s),this._onClose("transport error",s)}_onClose(s,r){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),_y&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const a=Xx.indexOf(this._offlineEventListener);a!==-1&&Xx.splice(a,1)}this.readyState="closed",this.id=null,this.emitReserved("close",s,r),this.writeBuffer=[],this._prevBufferLen=0}}}ju.protocol=x5;class vU extends ju{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let s=0;s<this._upgrades.length;s++)this._probe(this._upgrades[s])}_probe(s){let r=this.createTransport(s),a=!1;ju.priorWebsocketSuccess=!1;const n=()=>{a||(r.send([{type:"ping",data:"probe"}]),r.once("packet",h=>{if(!a)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",r),!r)return;ju.priorWebsocketSuccess=r.name==="websocket",this.transport.pause(()=>{a||this.readyState!=="closed"&&(c(),this.setTransport(r),r.send([{type:"upgrade"}]),this.emitReserved("upgrade",r),r=null,this.upgrading=!1,this.flush())})}else{const m=new Error("probe error");m.transport=r.name,this.emitReserved("upgradeError",m)}}))};function i(){a||(a=!0,c(),r.close(),r=null)}const l=h=>{const m=new Error("probe error: "+h);m.transport=r.name,i(),this.emitReserved("upgradeError",m)};function o(){l("transport closed")}function d(){l("socket closed")}function u(h){r&&h.name!==r.name&&i()}const c=()=>{r.removeListener("open",n),r.removeListener("error",l),r.removeListener("close",o),this.off("close",d),this.off("upgrading",u)};r.once("open",n),r.once("error",l),r.once("close",o),this.once("close",d),this.once("upgrading",u),this._upgrades.indexOf("webtransport")!==-1&&s!=="webtransport"?this.setTimeoutFn(()=>{a||r.open()},200):r.open()}onHandshake(s){this._upgrades=this._filterUpgrades(s.upgrades),super.onHandshake(s)}_filterUpgrades(s){const r=[];for(let a=0;a<s.length;a++)~this.transports.indexOf(s[a])&&r.push(s[a]);return r}}let bU=class extends vU{constructor(s,r={}){const a=typeof s=="object"?s:r;(!a.transports||a.transports&&typeof a.transports[0]=="string")&&(a.transports=(a.transports||["polling","websocket","webtransport"]).map(n=>AU[n]).filter(n=>!!n)),super(s,a)}};function yU(t,s="",r){let a=t;r=r||typeof location<"u"&&location,t==null&&(t=r.protocol+"//"+r.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=r.protocol+t:t=r.host+t),/^(https?|wss?):\/\//.test(t)||(typeof r<"u"?t=r.protocol+"//"+t:t="https://"+t),a=wy(t)),a.port||(/^(http|ws)$/.test(a.protocol)?a.port="80":/^(http|ws)s$/.test(a.protocol)&&(a.port="443")),a.path=a.path||"/";const i=a.host.indexOf(":")!==-1?"["+a.host+"]":a.host;return a.id=a.protocol+"://"+i+":"+a.port+s,a.href=a.protocol+"://"+i+(r&&r.port===a.port?"":":"+a.port),a}const jU=typeof ArrayBuffer=="function",NU=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,N5=Object.prototype.toString,wU=typeof Blob=="function"||typeof Blob<"u"&&N5.call(Blob)==="[object BlobConstructor]",_U=typeof File=="function"||typeof File<"u"&&N5.call(File)==="[object FileConstructor]";function Gj(t){return jU&&(t instanceof ArrayBuffer||NU(t))||wU&&t instanceof Blob||_U&&t instanceof File}function Jx(t,s){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let r=0,a=t.length;r<a;r++)if(Jx(t[r]))return!0;return!1}if(Gj(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return Jx(t.toJSON(),!0);for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&Jx(t[r]))return!0;return!1}function SU(t){const s=[],r=t.data,a=t;return a.data=Sy(r,s),a.attachments=s.length,{packet:a,buffers:s}}function Sy(t,s){if(!t)return t;if(Gj(t)){const r={_placeholder:!0,num:s.length};return s.push(t),r}else if(Array.isArray(t)){const r=new Array(t.length);for(let a=0;a<t.length;a++)r[a]=Sy(t[a],s);return r}else if(typeof t=="object"&&!(t instanceof Date)){const r={};for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=Sy(t[a],s));return r}return t}function CU(t,s){return t.data=Cy(t.data,s),delete t.attachments,t}function Cy(t,s){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<s.length)return s[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let r=0;r<t.length;r++)t[r]=Cy(t[r],s);else if(typeof t=="object")for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(t[r]=Cy(t[r],s));return t}const w5=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],kU=5;var dr;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(dr||(dr={}));class EU{constructor(s){this.replacer=s}encode(s){return(s.type===dr.EVENT||s.type===dr.ACK)&&Jx(s)?this.encodeAsBinary({type:s.type===dr.EVENT?dr.BINARY_EVENT:dr.BINARY_ACK,nsp:s.nsp,data:s.data,id:s.id}):[this.encodeAsString(s)]}encodeAsString(s){let r=""+s.type;return(s.type===dr.BINARY_EVENT||s.type===dr.BINARY_ACK)&&(r+=s.attachments+"-"),s.nsp&&s.nsp!=="/"&&(r+=s.nsp+","),s.id!=null&&(r+=s.id),s.data!=null&&(r+=JSON.stringify(s.data,this.replacer)),r}encodeAsBinary(s){const r=SU(s),a=this.encodeAsString(r.packet),n=r.buffers;return n.unshift(a),n}}class Kj extends on{constructor(s){super(),this.reviver=s}add(s){let r;if(typeof s=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");r=this.decodeString(s);const a=r.type===dr.BINARY_EVENT;a||r.type===dr.BINARY_ACK?(r.type=a?dr.EVENT:dr.ACK,this.reconstructor=new BU(r),r.attachments===0&&super.emitReserved("decoded",r)):super.emitReserved("decoded",r)}else if(Gj(s)||s.base64)if(this.reconstructor)r=this.reconstructor.takeBinaryData(s),r&&(this.reconstructor=null,super.emitReserved("decoded",r));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+s)}decodeString(s){let r=0;const a={type:Number(s.charAt(0))};if(dr[a.type]===void 0)throw new Error("unknown packet type "+a.type);if(a.type===dr.BINARY_EVENT||a.type===dr.BINARY_ACK){const i=r+1;for(;s.charAt(++r)!=="-"&&r!=s.length;);const l=s.substring(i,r);if(l!=Number(l)||s.charAt(r)!=="-")throw new Error("Illegal attachments");a.attachments=Number(l)}if(s.charAt(r+1)==="/"){const i=r+1;for(;++r&&!(s.charAt(r)===","||r===s.length););a.nsp=s.substring(i,r)}else a.nsp="/";const n=s.charAt(r+1);if(n!==""&&Number(n)==n){const i=r+1;for(;++r;){const l=s.charAt(r);if(l==null||Number(l)!=l){--r;break}if(r===s.length)break}a.id=Number(s.substring(i,r+1))}if(s.charAt(++r)){const i=this.tryParse(s.substr(r));if(Kj.isPayloadValid(a.type,i))a.data=i;else throw new Error("invalid payload")}return a}tryParse(s){try{return JSON.parse(s,this.reviver)}catch{return!1}}static isPayloadValid(s,r){switch(s){case dr.CONNECT:return j0(r);case dr.DISCONNECT:return r===void 0;case dr.CONNECT_ERROR:return typeof r=="string"||j0(r);case dr.EVENT:case dr.BINARY_EVENT:return Array.isArray(r)&&(typeof r[0]=="number"||typeof r[0]=="string"&&w5.indexOf(r[0])===-1);case dr.ACK:case dr.BINARY_ACK:return Array.isArray(r)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class BU{constructor(s){this.packet=s,this.buffers=[],this.reconPack=s}takeBinaryData(s){if(this.buffers.push(s),this.buffers.length===this.reconPack.attachments){const r=CU(this.reconPack,this.buffers);return this.finishedReconstruction(),r}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function FU(t){return typeof t=="string"}const TU=Number.isInteger||function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t};function IU(t){return t===void 0||TU(t)}function j0(t){return Object.prototype.toString.call(t)==="[object Object]"}function LU(t,s){switch(t){case dr.CONNECT:return s===void 0||j0(s);case dr.DISCONNECT:return s===void 0;case dr.EVENT:return Array.isArray(s)&&(typeof s[0]=="number"||typeof s[0]=="string"&&w5.indexOf(s[0])===-1);case dr.ACK:return Array.isArray(s);case dr.CONNECT_ERROR:return typeof s=="string"||j0(s);default:return!1}}function DU(t){return FU(t.nsp)&&IU(t.id)&&LU(t.type,t.data)}const PU=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Kj,Encoder:EU,get PacketType(){return dr},isPacketValid:DU,protocol:kU},Symbol.toStringTag,{value:"Module"}));function Qo(t,s,r){return t.on(s,r),function(){t.off(s,r)}}const UU=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class _5 extends on{constructor(s,r,a){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=s,this.nsp=r,a&&a.auth&&(this.auth=a.auth),this._opts=Object.assign({},a),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const s=this.io;this.subs=[Qo(s,"open",this.onopen.bind(this)),Qo(s,"packet",this.onpacket.bind(this)),Qo(s,"error",this.onerror.bind(this)),Qo(s,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...s){return s.unshift("message"),this.emit.apply(this,s),this}emit(s,...r){var a,n,i;if(UU.hasOwnProperty(s))throw new Error('"'+s.toString()+'" is a reserved event name');if(r.unshift(s),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(r),this;const l={type:dr.EVENT,data:r};if(l.options={},l.options.compress=this.flags.compress!==!1,typeof r[r.length-1]=="function"){const c=this.ids++,h=r.pop();this._registerAckCallback(c,h),l.id=c}const o=(n=(a=this.io.engine)===null||a===void 0?void 0:a.transport)===null||n===void 0?void 0:n.writable,d=this.connected&&!(!((i=this.io.engine)===null||i===void 0)&&i._hasPingExpired());return this.flags.volatile&&!o||(d?(this.notifyOutgoingListeners(l),this.packet(l)):this.sendBuffer.push(l)),this.flags={},this}_registerAckCallback(s,r){var a;const n=(a=this.flags.timeout)!==null&&a!==void 0?a:this._opts.ackTimeout;if(n===void 0){this.acks[s]=r;return}const i=this.io.setTimeoutFn(()=>{delete this.acks[s];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===s&&this.sendBuffer.splice(o,1);r.call(this,new Error("operation has timed out"))},n),l=(...o)=>{this.io.clearTimeoutFn(i),r.apply(this,o)};l.withError=!0,this.acks[s]=l}emitWithAck(s,...r){return new Promise((a,n)=>{const i=(l,o)=>l?n(l):a(o);i.withError=!0,r.push(i),this.emit(s,...r)})}_addToQueue(s){let r;typeof s[s.length-1]=="function"&&(r=s.pop());const a={id:this._queueSeq++,tryCount:0,pending:!1,args:s,flags:Object.assign({fromQueue:!0},this.flags)};s.push((n,...i)=>(this._queue[0],n!==null?a.tryCount>this._opts.retries&&(this._queue.shift(),r&&r(n)):(this._queue.shift(),r&&r(null,...i)),a.pending=!1,this._drainQueue())),this._queue.push(a),this._drainQueue()}_drainQueue(s=!1){if(!this.connected||this._queue.length===0)return;const r=this._queue[0];r.pending&&!s||(r.pending=!0,r.tryCount++,this.flags=r.flags,this.emit.apply(this,r.args))}packet(s){s.nsp=this.nsp,this.io._packet(s)}onopen(){typeof this.auth=="function"?this.auth(s=>{this._sendConnectPacket(s)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(s){this.packet({type:dr.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},s):s})}onerror(s){this.connected||this.emitReserved("connect_error",s)}onclose(s,r){this.connected=!1,delete this.id,this.emitReserved("disconnect",s,r),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(s=>{if(!this.sendBuffer.some(a=>String(a.id)===s)){const a=this.acks[s];delete this.acks[s],a.withError&&a.call(this,new Error("socket has been disconnected"))}})}onpacket(s){if(s.nsp===this.nsp)switch(s.type){case dr.CONNECT:s.data&&s.data.sid?this.onconnect(s.data.sid,s.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case dr.EVENT:case dr.BINARY_EVENT:this.onevent(s);break;case dr.ACK:case dr.BINARY_ACK:this.onack(s);break;case dr.DISCONNECT:this.ondisconnect();break;case dr.CONNECT_ERROR:this.destroy();const a=new Error(s.data.message);a.data=s.data.data,this.emitReserved("connect_error",a);break}}onevent(s){const r=s.data||[];s.id!=null&&r.push(this.ack(s.id)),this.connected?this.emitEvent(r):this.receiveBuffer.push(Object.freeze(r))}emitEvent(s){if(this._anyListeners&&this._anyListeners.length){const r=this._anyListeners.slice();for(const a of r)a.apply(this,s)}super.emit.apply(this,s),this._pid&&s.length&&typeof s[s.length-1]=="string"&&(this._lastOffset=s[s.length-1])}ack(s){const r=this;let a=!1;return function(...n){a||(a=!0,r.packet({type:dr.ACK,id:s,data:n}))}}onack(s){const r=this.acks[s.id];typeof r=="function"&&(delete this.acks[s.id],r.withError&&s.data.unshift(null),r.apply(this,s.data))}onconnect(s,r){this.id=s,this.recovered=r&&this._pid===r,this._pid=r,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(s=>this.emitEvent(s)),this.receiveBuffer=[],this.sendBuffer.forEach(s=>{this.notifyOutgoingListeners(s),this.packet(s)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(s=>s()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:dr.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(s){return this.flags.compress=s,this}get volatile(){return this.flags.volatile=!0,this}timeout(s){return this.flags.timeout=s,this}onAny(s){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(s),this}prependAny(s){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(s),this}offAny(s){if(!this._anyListeners)return this;if(s){const r=this._anyListeners;for(let a=0;a<r.length;a++)if(s===r[a])return r.splice(a,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(s){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(s),this}prependAnyOutgoing(s){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(s),this}offAnyOutgoing(s){if(!this._anyOutgoingListeners)return this;if(s){const r=this._anyOutgoingListeners;for(let a=0;a<r.length;a++)if(s===r[a])return r.splice(a,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(s){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const r=this._anyOutgoingListeners.slice();for(const a of r)a.apply(this,s.data)}}}function rA(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}rA.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var s=Math.random(),r=Math.floor(s*this.jitter*t);t=(Math.floor(s*10)&1)==0?t-r:t+r}return Math.min(t,this.max)|0};rA.prototype.reset=function(){this.attempts=0};rA.prototype.setMin=function(t){this.ms=t};rA.prototype.setMax=function(t){this.max=t};rA.prototype.setJitter=function(t){this.jitter=t};class ky extends on{constructor(s,r){var a;super(),this.nsps={},this.subs=[],s&&typeof s=="object"&&(r=s,s=void 0),r=r||{},r.path=r.path||"/socket.io",this.opts=r,Ag(this,r),this.reconnection(r.reconnection!==!1),this.reconnectionAttempts(r.reconnectionAttempts||1/0),this.reconnectionDelay(r.reconnectionDelay||1e3),this.reconnectionDelayMax(r.reconnectionDelayMax||5e3),this.randomizationFactor((a=r.randomizationFactor)!==null&&a!==void 0?a:.5),this.backoff=new rA({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(r.timeout==null?2e4:r.timeout),this._readyState="closed",this.uri=s;const n=r.parser||PU;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=r.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(s){return arguments.length?(this._reconnection=!!s,s||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(s){return s===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=s,this)}reconnectionDelay(s){var r;return s===void 0?this._reconnectionDelay:(this._reconnectionDelay=s,(r=this.backoff)===null||r===void 0||r.setMin(s),this)}randomizationFactor(s){var r;return s===void 0?this._randomizationFactor:(this._randomizationFactor=s,(r=this.backoff)===null||r===void 0||r.setJitter(s),this)}reconnectionDelayMax(s){var r;return s===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=s,(r=this.backoff)===null||r===void 0||r.setMax(s),this)}timeout(s){return arguments.length?(this._timeout=s,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(s){if(~this._readyState.indexOf("open"))return this;this.engine=new bU(this.uri,this.opts);const r=this.engine,a=this;this._readyState="opening",this.skipReconnect=!1;const n=Qo(r,"open",function(){a.onopen(),s&&s()}),i=o=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",o),s?s(o):this.maybeReconnectOnOpen()},l=Qo(r,"error",i);if(this._timeout!==!1){const o=this._timeout,d=this.setTimeoutFn(()=>{n(),i(new Error("timeout")),r.close()},o);this.opts.autoUnref&&d.unref(),this.subs.push(()=>{this.clearTimeoutFn(d)})}return this.subs.push(n),this.subs.push(l),this}connect(s){return this.open(s)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const s=this.engine;this.subs.push(Qo(s,"ping",this.onping.bind(this)),Qo(s,"data",this.ondata.bind(this)),Qo(s,"error",this.onerror.bind(this)),Qo(s,"close",this.onclose.bind(this)),Qo(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(s){try{this.decoder.add(s)}catch(r){this.onclose("parse error",r)}}ondecoded(s){hg(()=>{this.emitReserved("packet",s)},this.setTimeoutFn)}onerror(s){this.emitReserved("error",s)}socket(s,r){let a=this.nsps[s];return a?this._autoConnect&&!a.active&&a.connect():(a=new _5(this,s,r),this.nsps[s]=a),a}_destroy(s){const r=Object.keys(this.nsps);for(const a of r)if(this.nsps[a].active)return;this._close()}_packet(s){const r=this.encoder.encode(s);for(let a=0;a<r.length;a++)this.engine.write(r[a],s.options)}cleanup(){this.subs.forEach(s=>s()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(s,r){var a;this.cleanup(),(a=this.engine)===null||a===void 0||a.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",s,r),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const s=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const r=this.backoff.duration();this._reconnecting=!0;const a=this.setTimeoutFn(()=>{s.skipReconnect||(this.emitReserved("reconnect_attempt",s.backoff.attempts),!s.skipReconnect&&s.open(n=>{n?(s._reconnecting=!1,s.reconnect(),this.emitReserved("reconnect_error",n)):s.onreconnect()}))},r);this.opts.autoUnref&&a.unref(),this.subs.push(()=>{this.clearTimeoutFn(a)})}}onreconnect(){const s=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",s)}}const BA={};function Zx(t,s){typeof t=="object"&&(s=t,t=void 0),s=s||{};const r=yU(t,s.path||"/socket.io"),a=r.source,n=r.id,i=r.path,l=BA[n]&&i in BA[n].nsps,o=s.forceNew||s["force new connection"]||s.multiplex===!1||l;let d;return o?d=new ky(a,s):(BA[n]||(BA[n]=new ky(a,s)),d=BA[n]),r.query&&!s.query&&(s.query=r.queryKey),d.socket(r.path,s)}Object.assign(Zx,{Manager:ky,Socket:_5,io:Zx,connect:Zx});function fg(){const[t,s]=f.useState(null),{token:r,user:a,scope:n}=Kr();return f.useEffect(()=>{const i=r||localStorage.getItem("token");if(!i){console.warn("No token available for Socket.io connection");return}const l=Zx(window.location.origin,{auth:{token:i},query:{userId:a&&(a.id||a.sub)||localStorage.getItem("userId")||"",warehouseId:n&&n.branchId||localStorage.getItem("warehouseId")||""},reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:5});return l.on("connect",()=>{console.log(" Connected to Socket.io")}),l.on("disconnect",()=>{console.log(" Disconnected from Socket.io")}),l.on("error",o=>{console.error("Socket.io error:",o)}),s(l),()=>{l.close()}},[r,a==null?void 0:a.id,a==null?void 0:a.sub,n==null?void 0:n.branchId]),t}function S5({compact:t=!1,focusId:s=null,hideCreator:r=!1}){var _,F,I,w,E,W,R,U;const{user:a}=Kr(),n=fg(),[i,l]=f.useState([]),[o,d]=f.useState(!1),[u,c]=f.useState(null),[h,m]=f.useState(0),p=ps(),[g,x]=f.useState(!1),b=f.useRef(!1),y=f.useCallback(async(T=0)=>{if(a)try{d(!0);const Y=Number((a==null?void 0:a.sub)||(a==null?void 0:a.id))||"",H=Number.isFinite(s)&&s>0,M=H?`/api/social-feed/${s}`:`/api/social-feed?offset=${T}&limit=20`,q=await fetch(M,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"x-user-id":String(Y)}});if(!q.ok)throw new Error("Failed to fetch posts");const z=await q.json();if(H){const Q=z!=null&&z.data?z.data:null;l(Q?[Q]:[])}else{const Q=Array.isArray(z.data)?z.data:[];l(T===0?Q:L=>[...L,...Q])}m(T)}catch(Y){console.error("Error fetching posts:",Y),c(Y.message)}finally{d(!1)}},[a]);f.useEffect(()=>{y(0)},[a,y]),f.useEffect(()=>{if(n)return n.on("post_liked",T=>{l(Y=>Y.map(H=>H.id===T.postId?{...H,like_count:H.like_count+1}:H))}),()=>{n.off("post_liked")}},[n]);const j=T=>{l(Y=>[T,...Y]);try{t&&Number.isFinite(Number(T==null?void 0:T.id))&&T.id>0&&p(`/social-feed/${T.id}`)}catch{}},N=async()=>{if(Number.isFinite(s)&&s>0){try{const Y=i[0];if(!Y)return;const H=Array.isArray(Y.comments)?Y.comments.length:0,M=Number(Y.comment_count||H),q=Math.max(M-H,0);d(!0);const z=Number((a==null?void 0:a.sub)||(a==null?void 0:a.id))||"",Q=await fetch(`/api/social-feed/${s}/comments?offset=${H}&limit=${q||20}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"x-user-id":String(z)}});if(!Q.ok)throw new Error("Failed to load comments");const L=await Q.json(),V=Array.isArray(L.data)?L.data:[];l(P=>{if(!P.length)return P;const C=P[0],k=new Set((C.comments||[]).map(O=>O.id)),B=[...C.comments||[],...V.filter(O=>!k.has(O.id))];return[{...C,comments:B,comment_count:C.comment_count},...P.slice(1)]}),x(!0)}catch(Y){c(Y.message)}finally{d(!1)}return}y(h+20)};return f.useEffect(()=>{const T=Number.isFinite(s)&&s>0,Y=i[0];if(!T||!Y)return;const H=Array.isArray(Y.comments)?Y.comments.length:0,M=Number(Y.comment_count||H);b.current||M>H&&(b.current=!0,(async()=>{try{await N()}catch{}})())},[s,i]),a?t?e.jsx("div",{className:"company-feed-container",children:e.jsx(i_,{onPostCreated:j})}):e.jsxs("div",{className:"company-feed-container",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Social Feed"}),e.jsx("button",{onClick:()=>p("/"),className:"px-4 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg font-medium transition-colors",children:" Back to Home"})]}),!r&&!(Number.isFinite(s)&&s>0)&&e.jsx(i_,{onPostCreated:j}),o&&i.length===0?e.jsx("div",{className:"loading-spinner",children:"Loading posts..."}):i.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No posts yet. Be the first to share something!"})}):e.jsxs(e.Fragment,{children:[e.jsx(MP,{posts:i,setPosts:l,defaultShowComments:!1,forceOpenComments:g}),e.jsx("button",{className:"btn-load-more",onClick:N,disabled:o||Number.isFinite(s)&&s>0&&(((_=i[0])==null?void 0:_.comment_count)??0)>0&&(((I=(F=i[0])==null?void 0:F.comments)==null?void 0:I.length)??0)>=(((w=i[0])==null?void 0:w.comment_count)??0),children:o?"Loading...":Number.isFinite(s)&&s>0&&(((E=i[0])==null?void 0:E.comment_count)??0)>0&&(((R=(W=i[0])==null?void 0:W.comments)==null?void 0:R.length)??0)>=(((U=i[0])==null?void 0:U.comment_count)??0)?"All comments loaded":"Load More"})]})]}):e.jsx("div",{className:"company-feed-container",children:e.jsx("p",{children:"Please log in to view the company feed."})})}function RU(){const{user:t,token:s}=Kr(),{canAccessPath:r,hasRoleFeature:a,canViewDashboardElement:n}=Ls(),i=ps(),[l,o]=f.useState([]),[d,u]=f.useState([]),[c,h]=f.useState(!1),[m,p]=f.useState([]),[g,x]=f.useState(!1),[b,y]=f.useState(null),[j,N]=f.useState(!1),[_,F]=f.useState(null),[I,w]=f.useState(null),[E,W]=f.useState(""),[R,U]=f.useState(!1),[T,Y]=f.useState(!1),[H,M]=f.useState(null);f.useEffect(()=>{let oe=!1;return Z.get("/workflows/approvals/pending").then(le=>{var X;oe||o(Array.isArray((X=le.data)==null?void 0:X.items)?le.data.items:[])}).catch(()=>{oe||o([])}),Z.get("/workflows/notifications").then(le=>{var X;oe||u(Array.isArray((X=le.data)==null?void 0:X.items)?le.data.items:[])}).catch(()=>{oe||u([])}),Z.get("/pos/analytics/overview").then(le=>{oe||y(le.data||null)}).catch(()=>{oe||y(null)}),()=>{oe=!0}},[s]);const q=oe=>String(oe||"").trim().toUpperCase().replace(/\s+/g,"_"),z=oe=>{const le=q(oe);if(le==="MATERIAL_REQUISITION")return"Material Requisition";if(le==="RETURN_TO_STORES")return"Return to Stores";if(le.startsWith("PURCHASE_ORDER:")){const X=le.split(":")[1];return X==="LOCAL"?"Purchase Order - Local":X==="IMPORT"?"Purchase Order - Import":"Purchase Order"}return le==="GOODS_RECEIPT"||le==="GRN"||le==="GOODS_RECEIPT_NOTE"?"GRN":le==="GOODS_RECEIPT:LOCAL"||le==="GRN:LOCAL"||le==="GOODS_RECEIPT_NOTE:LOCAL"?"GRN Local":le==="GOODS_RECEIPT:IMPORT"||le==="GRN:IMPORT"||le==="GOODS_RECEIPT_NOTE:IMPORT"?"GRN Import":String(oe||"Document")},Q=oe=>{const le=q(oe.document_type);if(le==="PURCHASE_ORDER"){const X=q(oe.po_type);return X?`${le}:${X}`:le}if(le==="GOODS_RECEIPT"||le==="GRN"||le==="GOODS_RECEIPT_NOTE"){const X=String(oe.doc_ref||""),me=X.startsWith("GL-")?"LOCAL":X.startsWith("GI-")?"IMPORT":"";return me?`${le}:${me}`:le}return le},L=f.useMemo(()=>{const oe=new Map;for(const le of l){const X=String(le.workflow_instance_id||`${q(le.document_type)}-${le.document_id}`);oe.has(X)||oe.set(X,le)}return Array.from(oe.values())},[l]),V=f.useMemo(()=>{const oe=Number((t==null?void 0:t.sub)||(t==null?void 0:t.id));return L.filter(le=>{const me=[Number(le.approver_user_id),Number(le.assigned_user_id),Number(le.target_user_id),Number(le.approver_id),Number(le.user_id)].find(we=>Number.isFinite(we)&&we>0)??null;return!Number.isFinite(oe)||oe<=0?!0:me==null||me===oe})},[L,t==null?void 0:t.sub,t==null?void 0:t.id]),P=f.useMemo(()=>{const oe={};for(const le of V){const X=Q(le);oe[X]||(oe[X]=[]),oe[X].push(le)}return oe},[V]),C=f.useMemo(()=>{const oe=Object.keys(P),le=["MATERIAL_REQUISITION","RETURN_TO_STORES","STOCK_ADJUSTMENT"],X=le.filter(we=>oe.includes(we)),me=oe.filter(we=>!le.includes(we)).sort();return[...X,...me]},[P]),k=oe=>{const le=z(Q(oe)),X=oe.doc_ref?String(oe.doc_ref):`#${oe.document_id}`;return`${le} ${X}`},B=async oe=>{var le;N(!0),F(oe),U(!0),w(null),W("");try{const me=((le=(await Z.get(`/workflows/approvals/instance/${oe}`)).data)==null?void 0:le.item)||null;if(w(me),me&&!me.is_last_step&&Array.isArray(me.next_step_approvers)){const we=me.next_step_approvers[0];M(we?we.id:null)}else M(null)}catch{w(null)}finally{U(!1)}},G=()=>{N(!1),F(null),w(null),W(""),U(!1),Y(!1),M(null)},O=async oe=>{var le,X;if(_){if(!E&&(oe==="REJECT"||oe==="RETURN")){alert("Please provide a comment for rejection/return");return}if(oe==="APPROVE"&&I&&!I.is_last_step&&!H){alert("Please select the next approver");return}Y(!0);try{await Z.post(`/workflows/${_}/action`,{action:oe,comments:E,target_user_id:I&&!I.is_last_step?H:null}),o(me=>me.filter(we=>we.workflow_instance_id!==_)),G()}catch(me){alert(((X=(le=me==null?void 0:me.response)==null?void 0:le.data)==null?void 0:X.message)||"Action failed")}finally{Y(!1)}}};function K(oe){return`${Number(oe||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}const te=[{label:"Today Sales",value:K((b==null?void 0:b.todaySales)||0),path:"/sales/reports",color:"from-ticker-green to-ticker-green"},{label:"Total Customers",value:String((b==null?void 0:b.totalCustomers)??0),home_key:"total-customers",path:"/sales/customers",color:"from-ticker-blue to-ticker-blue"},{label:"Average Order",value:K((b==null?void 0:b.averageOrder)||0),path:"/sales/reports",color:"from-ticker-purple to-ticker-purple"},{label:"Monthly Revenue",value:K((b==null?void 0:b.monthlyRevenue)||0),path:"/finance/reports",color:"from-ticker-orange to-ticker-orange"}].filter(oe=>{const le=String(oe.label||"").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");return n("home","card",le)?oe!=null&&oe.home_key&&a(`home:${oe.home_key}`)?!0:r(oe.path,"view"):!1}),se=f.useMemo(()=>{const oe=Number((t==null?void 0:t.sub)||(t==null?void 0:t.id));return d.filter(X=>{const we=String((X==null?void 0:X.message)||"").toLowerCase().includes("approved"),_e=[Number(X.user_id),Number(X.target_user_id),Number(X.recipient_id),Number(X.assigned_user_id),Number(X.request_user_id)].find(Le=>Number.isFinite(Le)&&Le>0)??null,Fe=Number.isFinite(oe)&&oe>0?_e==null||_e===oe:!0;return we&&Fe})},[d,t==null?void 0:t.sub,t==null?void 0:t.id]),ae=f.useMemo(()=>d.filter(oe=>Number(oe.is_read)!==1&&String(oe.link||"").startsWith("/social-feed")),[d]);f.useMemo(()=>d.filter(oe=>Number(oe.is_read)!==1&&!String(oe.link||"").startsWith("/social-feed")),[d]);const ne=oe=>{const X=String(oe||"").match(/social-feed\/(\d+)/);return X?Number(X[1]):null},ue=async()=>{const oe=Array.from(new Set(ae.map(le=>ne(le.link)).filter(le=>Number.isFinite(le)&&le>0)));if(oe.length===0){p([]);return}try{x(!0);const le=Number((t==null?void 0:t.sub)||(t==null?void 0:t.id))||"",X=await fetch("/api/social-feed?offset=0&limit=200",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"x-user-id":String(le)}});if(!X.ok)throw new Error("Failed to load posts");const me=await X.json(),we=Array.isArray(me.data)?me.data:[],Ie=new Map(we.map(Fe=>[Number(Fe.id),Fe])),_e=oe.map(Fe=>Ie.get(Fe)).filter(Fe=>Fe&&typeof Fe.content=="string");p(_e)}catch{p([])}finally{x(!1)}};return e.jsxs("div",{className:"min-h-screen bg-slate-50/50 p-2 md:p-3 font-sans text-slate-900",children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4 fullbleed-sm",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-brand-900 to-brand-800 p-8 shadow-erp text-white",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight",children:["Welcome back, ",(t==null?void 0:t.name)||(t==null?void 0:t.username)||"User","! "]}),e.jsx("p",{className:"mt-2 text-brand-100 text-lg max-w-2xl",children:"Here's an overview of your business performance and pending tasks today."})]}),e.jsx("div",{className:"absolute right-0 top-0 h-full w-1/3 bg-white/5 skew-x-12 transform translate-x-20"}),e.jsxs("button",{type:"button",onClick:()=>i("/notifications"),className:"absolute top-4 right-4 z-20 bg-white/10 hover:bg-white/20 text-white rounded-full px-3 py-2 flex items-center gap-2",children:[e.jsx("span",{children:""}),e.jsxs("span",{className:"relative inline-flex items-center",children:[e.jsx("span",{className:"sr-only",children:"Unread"}),e.jsx("span",{className:"ml-1 text-sm",children:"Notifications"}),e.jsx("span",{className:"absolute -top-2 -right-3 bg-red-600 text-white text-xs font-bold rounded-full px-2 py-0.5",children:d.filter(oe=>Number(oe.is_read)!==1).length})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:te.map((oe,le)=>e.jsxs("div",{onClick:()=>i(oe.path),className:`relative overflow-hidden rounded-xl p-6 shadow-erp-sm hover:shadow-erp-md transition-all duration-200 cursor-pointer group bg-gradient-to-r ${oe.color} text-white`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-white/80 uppercase tracking-wider",children:oe.label}),e.jsx("p",{className:"mt-2 text-3xl font-bold text-white",children:oe.value})]}),e.jsx("div",{className:"p-3 rounded-lg bg-white/20 text-white",children:e.jsx("span",{className:"text-2xl",children:oe.icon})})]}),e.jsx("div",{className:"absolute bottom-0 right-0 p-4 opacity-10 group-hover:scale-110 transition-transform duration-300",children:e.jsx("span",{className:"text-6xl text-white/20",children:oe.icon})})]},le))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-erp p-6 border border-slate-100 relative",children:[e.jsx("button",{type:"button",onClick:()=>i("/social-feed"),className:"absolute top-4 left-4 bg-brand text-white rounded-full px-3 py-2 text-xs hover:bg-brand-700",children:"Post History"}),e.jsxs("button",{type:"button",onClick:async()=>{const oe=!c;h(oe),oe&&await ue()},className:"absolute top-4 right-4 bg-slate-100 hover:bg-slate-200 text-slate-800 rounded-full px-3 py-2 flex items-center gap-2",children:[e.jsx("span",{children:""}),e.jsxs("span",{className:"relative inline-flex items-center",children:[e.jsx("span",{className:"sr-only",children:"Post alerts"}),e.jsx("span",{className:"ml-1 text-sm",children:"Posts"}),e.jsx("span",{className:"absolute -top-2 -right-3 bg-red-600 text-white text-xs font-bold rounded-full px-2 py-0.5",children:ae.length})]})]}),c&&e.jsxs("div",{className:"absolute top-14 right-4 z-30 w-96 max-w-[calc(100%-2rem)] rounded-lg border border-slate-200 bg-white shadow-erp-lg",children:[e.jsxs("div",{className:"p-3 border-b border-slate-200 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-800",children:"Post Notifications"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"text-slate-600 hover:text-slate-900 text-xs",children:"Close"})]}),e.jsx("div",{className:"max-h-80 overflow-auto",children:g?e.jsx("div",{className:"p-4 text-sm text-slate-600",children:"Loading"}):m.length===0?e.jsx("div",{className:"p-4 text-sm text-slate-600",children:"No post alerts found."}):m.map(oe=>e.jsx("button",{type:"button",onClick:async()=>{h(!1);try{const le=d.filter(X=>Number(X.is_read)!==1&&String(X.link||"").startsWith(`/social-feed/${oe.id}`));for(const X of le)try{await Z.put(`/workflows/notifications/${X.id}/read`)}catch{}u(X=>X.map(me=>String(me.link||"").startsWith(`/social-feed/${oe.id}`)?{...me,is_read:1}:me))}catch{}i(`/social-feed/${oe.id}`)},className:"w-full text-left px-4 py-3 mb-2 last:mb-0 rounded-lg bg-gradient-to-r from-brand-800 to-brand-700 text-white shadow-erp-sm hover:shadow-erp-md transition-all",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:oe.profile_picture_url||"/default-avatar.png",alt:String(oe.full_name||"User"),className:"w-8 h-8 rounded-full border border-white/40"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-semibold",children:String(oe.full_name||oe.username||"User")}),e.jsxs("div",{className:"text-xs text-white/90",children:[String(oe.content||"").replace(/\s+/g," ").trim().slice(0,100),String(oe.content||"").length>100?"":""]}),e.jsx("div",{className:"text-[11px] text-white/70 mt-1",children:oe.created_at?new Date(oe.created_at).toLocaleString():""})]}),e.jsx("div",{className:"text-white/80 text-sm",children:"View "})]})},oe.id))})]}),e.jsx(S5,{compact:!0})]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-erp p-6 border border-slate-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-bold text-slate-900 flex items-center gap-2",children:[e.jsx("span",{className:"text-blue-500",children:""})," Pending Approvals"]}),e.jsxs("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 text-xs font-bold rounded-full",children:[V.length," Pending"]})]}),L.length>0?e.jsx("div",{className:"space-y-4",children:C.map(oe=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm font-bold text-slate-700",children:z(oe)}),e.jsx("span",{className:"px-2 py-0.5 bg-slate-100 text-slate-700 text-xs font-bold rounded-full",children:P[oe].length})]}),e.jsx("div",{className:"divide-y divide-slate-100",children:P[oe].map(le=>e.jsxs("div",{className:"py-3 flex items-center justify-between hover:bg-slate-50 rounded-lg px-2 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-sm font-bold text-slate-600",children:le.initiator?le.initiator.charAt(0):"U"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-900",children:k(le)}),e.jsxs("p",{className:"text-xs text-slate-500",children:[le.submitted_at?new Date(le.submitted_at).toLocaleString():"Just now"," "," ",le.workflow_name||"Approval Required"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>B(le.workflow_instance_id),className:"px-3 py-1 text-xs font-medium text-green-700 bg-green-50 hover:bg-green-100 rounded-md transition-colors",children:"Approve"}),e.jsx("button",{onClick:()=>i(`/administration/workflows/approvals/${le.workflow_instance_id}`),className:"px-3 py-1 text-xs font-medium text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-md transition-colors",children:"View"})]})]},le.workflow_instance_id))})]},oe))}):e.jsx("div",{className:"text-center py-8 text-slate-500 text-sm bg-slate-50/50 rounded-lg border border-dashed border-slate-200",children:"No pending approvals found. You're all caught up! "})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-erp p-6 border border-slate-100",children:[e.jsxs("h2",{className:"text-lg font-bold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"text-purple-500",children:""})," System Status"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-600",children:"Server Uptime"}),e.jsx("span",{className:"text-green-600 font-medium",children:"99.9%"})]}),e.jsx("div",{className:"w-full bg-slate-100 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:"99.9%"}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-600",children:"Database Load"}),e.jsx("span",{className:"text-brand-600 font-medium",children:"34%"})]}),e.jsx("div",{className:"w-full bg-slate-100 rounded-full h-2",children:e.jsx("div",{className:"bg-brand-500 h-2 rounded-full",style:{width:"34%"}})})]}),e.jsxs("div",{className:"pt-4 border-t border-slate-100",children:[e.jsx("p",{className:"text-xs text-slate-400 uppercase tracking-wider font-bold mb-2",children:"Recent Login"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-700",children:[e.jsx("span",{children:""}),e.jsx("span",{children:"Windows PC  Chrome"}),e.jsx("span",{className:"text-slate-400 ml-auto",children:"10:42 AM"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-erp p-6 border border-slate-100",children:[e.jsxs("h2",{className:"text-lg font-bold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"text-brand-500",children:""})," Notifications"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-200 p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-slate-800",children:"Approved Documents"}),e.jsxs("div",{className:"text-xs text-slate-500",children:[se.length," Approved"]})]}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>i("/administration/workflows/approved"),children:"View Details"})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-slate-800",children:"Pending Documents"}),e.jsxs("div",{className:"text-xs text-slate-500",children:[V.length," Pending"]})]}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>i("/administration/workflows/approvals"),children:"View Details"})]})]})]})]})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-erp w/full max-w-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-brand text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Approval"}),e.jsx("button",{onClick:G,className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsx("div",{className:"p-4 space-y-3",children:R?e.jsx("div",{className:"text-sm",children:"Loading..."}):I?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Document:"," ",e.jsxs("span",{className:"font-semibold",children:[I.document_type," #",I.document_id]})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Current Step:"," ",e.jsx("span",{className:"font-semibold",children:I.step_name})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Amount:"," ",e.jsx("span",{className:"font-semibold",children:I.amount!=null?Number(I.amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Comments"}),e.jsx("textarea",{className:"input w-full h-24",placeholder:"Enter comments...",value:E,onChange:oe=>W(oe.target.value)})]}),!I.is_last_step&&Array.isArray(I.next_step_approvers)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Forward To"}),e.jsxs("select",{className:"input w-full",value:H||"",onChange:oe=>M(Number(oe.target.value)),children:[e.jsx("option",{value:"",children:"Select user"}),I.next_step_approvers.map(oe=>e.jsx("option",{value:oe.id,children:oe.username},oe.id))]})]})]}):e.jsx("div",{className:"text-sm text-red-600",children:"Failed to load approval"})}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:G,children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700 disabled:opacity-50",onClick:()=>O("APPROVE"),disabled:T,children:I&&I.is_last_step?"Final Approve":"Forward"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:opacity-50",onClick:()=>O("RETURN"),disabled:T,children:"Return"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50",onClick:()=>O("REJECT"),disabled:T,children:"Reject"})]})]})})]})}const lo=({title:t,description:s,stats:r=[],quickActions:a=[],sections:n=[],features:i=[]})=>{const l=ps(),{canAccessPath:o,canAccessFeatureKey:d,canViewDashboardElement:u}=Ls(),c=(x,b)=>{x&&l(x)},h=["from-green-500 to-green-600","from-blue-500 to-blue-600","from-purple-500 to-purple-600","from-orange-500 to-orange-600","from-pink-500 to-pink-600","from-teal-500 to-teal-600","from-red-500 to-red-600","from-amber-500 to-amber-600"],m=Is.useMemo(()=>{const x=[...h];for(let y=x.length-1;y>0;y--){const j=Math.floor(Math.random()*(y+1));[x[y],x[j]]=[x[j],x[y]]}const b=[];for(let y=0;y<r.length;y++)b.push(x[y%x.length]);return b},[r.length]),p=x=>{if(!x||x.hidden)return!1;const b=String(x.path||"");if(!b)return!1;const y=b.split("/").filter(Boolean),j=String(x.module_key||y[0]||""),N=String(x.feature_key||y[1]||"");if(j&&N){if(d(j,N))return!0;if(!x.feature_key&&y.length>2){const _=String(y[2]||"");if(_&&d(j,_))return!0}return o(b)}return o(b)},g=Is.useMemo(()=>{const x=Array.isArray(n)?n:[],b=Array.isArray(i)?i:[];if(!b.length)return x;const y=new Set;for(const N of x){const _=N&&(N.items||N.features)||[];for(const F of _)F&&F.path&&y.add(String(F.path))}const j=[];for(const N of b){const _=String(N.path||"");!_||y.has(_)||j.push({title:N.label||N.name||"Page",name:N.label||N.name,path:_,icon:N.icon||""})}return j.length?[...x,{title:"Other Pages",items:j}]:x},[n,i]);return e.jsxs("div",{className:"p-6 space-y-8 animate-fade-in fullbleed-sm",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-brand-900 dark:text-white tracking-tight mb-2",children:t}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-lg max-w-3xl",children:s})]}),r.filter(x=>{if(!p(x))return!1;const y=String(x.path||"").split("/").filter(Boolean),j=String(x.module_key||y[0]||""),N=String(x.rbac_key||"").toLowerCase().trim()||String(x.label||x.name||x.title||"").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");return!j||!N?!0:u(j,"card",N)}).length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-xl font-semibold text-brand-800 dark:text-brand-200 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:""})," Business Overview"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:r.filter(x=>{if(!p(x))return!1;const y=String(x.path||"").split("/").filter(Boolean),j=String(x.module_key||y[0]||""),N=String(x.rbac_key||"").toLowerCase().trim()||String(x.label||x.name||x.title||"").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");return!j||!N?!0:u(j,"card",N)}).map((x,b)=>e.jsxs("div",{className:`p-6 rounded-xl shadow-erp-sm hover:shadow-erp-md transition-all duration-200 cursor-pointer group bg-gradient-to-r ${x.color||m[b]} text-white`,onClick:()=>c(x.path),children:[e.jsx("div",{className:"flex justify-end mb-2",children:x.change&&e.jsx("span",{className:"text-xs font-bold px-2 py-1 rounded-full bg-white/20 text-white",children:x.change})}),e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:x.value}),e.jsx("div",{className:"text-sm text-white/80 font-medium",children:x.label})]},b))})]}),a.filter(x=>!(x!=null&&x.path)||p(x)).length>0&&e.jsxs("div",{className:"mb-10",children:[e.jsxs("h2",{className:"text-xl font-semibold text-brand-800 dark:text-brand-200 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:""})," Quick Actions"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:a.filter(x=>!(x!=null&&x.path)||p(x)).map((x,b)=>e.jsxs("button",{className:"flex flex-col items-center justify-center p-4 bg-white dark:bg-slate-800 rounded-xl shadow-sm hover:shadow-md hover:bg-brand-50 dark:hover:bg-slate-700 transition-all duration-200 group text-center h-full border border-slate-100 dark:border-slate-700",onClick:()=>c(x.path),children:[e.jsx("span",{className:"text-2xl mb-2 group-hover:-translate-y-1 transition-transform duration-200 block",children:x.icon}),e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 group-hover:text-brand-700 dark:group-hover:text-brand-300",children:x.label})]},b))})]}),e.jsx("div",{className:"space-y-10",children:g.map((x,b)=>{const y=x.title||x.category,j=x.items||x.features||[];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-5 border-b border-slate-200 dark:border-slate-700 pb-2",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-white",children:y}),x.badge&&e.jsx("span",{className:"bg-brand-100 text-brand-700 dark:bg-brand-900/40 dark:text-brand-300 text-xs font-bold px-2.5 py-0.5 rounded-full uppercase tracking-wider",children:x.badge})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5",children:j.filter(N=>p(N)).map((N,_)=>{const F=N.title||N.name;return e.jsx("div",{className:"bg-white dark:bg-slate-800 p-5 rounded-xl shadow-sm hover:shadow-md hover:border-brand-300 dark:hover:border-brand-700 border border-transparent transition-all duration-200 cursor-pointer group relative overflow-hidden",onClick:()=>c(N.path),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-50 dark:bg-slate-700 flex items-center justify-center text-xl group-hover:bg-brand-100 dark:group-hover:bg-slate-600 transition-colors",children:N.icon||""}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-slate-800 dark:text-slate-100 group-hover:text-brand-700 dark:group-hover:text-brand-400 transition-colors mb-1",children:F}),N.description&&e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 line-clamp-2",children:N.description})]})]})},_)})})]},b)})})]})};function OU(){const[t,s]=f.useState([]),[r,a]=f.useState(!0),[n,i]=f.useState(""),[l,o]=f.useState(""),[d,u]=f.useState("all"),[c,h]=f.useState("all"),m={total:t.length,active:t.filter(x=>x.is_active).length,inactive:t.filter(x=>!x.is_active).length};f.useEffect(()=>{p()},[]);const p=async()=>{var x,b,y,j;try{a(!0),i("");const N=await Z.get("/admin/users"),_=Array.isArray((b=(x=N.data)==null?void 0:x.data)==null?void 0:b.items)?N.data.data.items:[];s(_)}catch(N){i(((j=(y=N==null?void 0:N.response)==null?void 0:y.data)==null?void 0:j.message)||"Error fetching users"),console.error("Error fetching users:",N)}finally{a(!1)}},g=t.filter(x=>{const b=String(x.full_name||"").toLowerCase().includes(l.toLowerCase())||String(x.username||"").toLowerCase().includes(l.toLowerCase())||String(x.email||"").toLowerCase().includes(l.toLowerCase()),y=d==="all"||d==="active"&&x.is_active||d==="inactive"&&!x.is_active,j=c==="all"||x.user_type&&x.user_type.toLowerCase()===c.toLowerCase();return b&&y&&j});return e.jsxs("div",{className:"user-container",children:[e.jsxs("div",{className:"user-header",children:[e.jsx("h1",{children:" User Management System"}),e.jsxs("div",{className:"user-header-actions",children:[e.jsx(Re,{to:"/administration",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/administration/users/new",className:"btn btn-primary",style:{textDecoration:"none",color:"white",padding:"10px 20px",borderRadius:"6px",background:"#28a745"},children:" Create New User"}),e.jsx("button",{className:"btn btn-secondary",onClick:p,style:{padding:"10px 20px",border:"none",borderRadius:"6px",cursor:"pointer",background:"#6c757d",color:"white"},children:" Refresh"})]})]}),e.jsx("div",{className:"user-search-section",children:e.jsxs("div",{className:"user-search-box",children:[e.jsxs("div",{className:"user-form-group",children:[e.jsx("label",{children:"Search by Name/Email"}),e.jsx("input",{type:"text",className:"user-form-control",placeholder:"Enter name or email...",value:l,onChange:x=>o(x.target.value)})]}),e.jsxs("div",{className:"user-form-group",children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{className:"user-form-control",value:d,onChange:x=>u(x.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]})}),e.jsxs("div",{className:"user-table-container",children:[e.jsxs("div",{className:"user-stats",children:[e.jsxs("div",{className:"user-stat-card",children:[e.jsx("h3",{children:"Total Users"}),e.jsx("div",{className:"stat-value",children:m.total})]}),e.jsxs("div",{className:"user-stat-card",children:[e.jsx("h3",{children:"Active Users"}),e.jsx("div",{className:"stat-value",children:m.active})]}),e.jsxs("div",{className:"user-stat-card",children:[e.jsx("h3",{children:"Inactive Users"}),e.jsx("div",{className:"stat-value",children:m.inactive})]})]}),r?e.jsx("div",{className:"text-center py-8",children:"Loading users..."}):n?e.jsx("div",{className:"text-center py-8 text-red-500",children:n}):e.jsxs("table",{className:"user-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Username"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Branch"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center py-4",children:"No users found"})}):g.map(x=>{const b=(x.full_name||x.username||"?").substring(0,2).toUpperCase();return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-avatar",children:x.profile_picture_url?e.jsx("img",{src:x.profile_picture_url,alt:x.username,style:{width:"100%",height:"100%",objectFit:"cover"}}):b}),e.jsx("div",{className:"user-details",children:e.jsx("span",{className:"user-name",children:x.full_name||"N/A"})})]})}),e.jsx("td",{children:x.username}),e.jsx("td",{children:x.email}),e.jsx("td",{children:x.user_type||"Internal"}),e.jsx("td",{children:x.company_name||"N/A"}),e.jsx("td",{children:x.branch_name||"N/A"}),e.jsx("td",{children:x.is_active?e.jsx("span",{className:"user-status-badge user-status-active",children:"Active"}):e.jsx("span",{className:"user-status-badge user-status-inactive",children:"Inactive"})}),e.jsx("td",{children:x.created_at?new Date(x.created_at).toLocaleDateString():"N/A"}),e.jsx("td",{children:e.jsx("div",{className:"user-action-buttons",children:e.jsx(Re,{to:`/administration/users/${x.id}`,className:"btn",style:{background:"#007bff",color:"white",padding:"6px 12px",borderRadius:"4px",fontSize:"12px",textDecoration:"none"},children:" Edit"})})})]},x.id)})})]})]})]})}function v_(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState(!1),[o,d]=f.useState(""),[u,c]=f.useState({companyId:"",branchIds:[],username:"",email:"",fullName:"",password:"",isActive:!0,profilePicture:"",isEmployee:!1,userType:"Internal",validFrom:"",validTo:"",roleId:""}),[h,m]=f.useState([]),[p,g]=f.useState([]),[x,b]=f.useState([]),[y,j]=f.useState(!1);f.useEffect(()=>{N(),r&&_()},[s]);async function N(){var U,T,Y;try{const[H,M,q]=await Promise.all([Z.get("/admin/companies"),Z.get("/admin/branches"),Z.get("/admin/roles").catch(()=>({data:{items:[]}}))]);m(H.data&&H.data.data&&H.data.data.items||((U=H.data)==null?void 0:U.items)||[]),g(M.data&&M.data.data&&M.data.data.items||((T=M.data)==null?void 0:T.items)||[]),b(q.data&&q.data.data&&q.data.data.items||((Y=q.data)==null?void 0:Y.items)||[])}catch(H){console.error("Error fetching dependencies:",H)}}async function _(){var U,T,Y,H,M,q;try{n(!0),d("");const z=await Z.get(`/admin/users/${s}`);if((T=(U=z.data)==null?void 0:U.data)!=null&&T.item){const Q=z.data.data.item;c({companyId:Q.company_id||"",branchIds:Q.branch_id?[String(Q.branch_id)]:[],username:Q.username||"",email:Q.email||"",fullName:Q.full_name||"",isActive:!!Q.is_active,password:"",profilePicture:Q.profile_picture_url||"",isEmployee:!!Q.is_employee,userType:Q.user_type||"Internal",validFrom:Q.valid_from?Q.valid_from.split("T")[0]:"",validTo:Q.valid_to?Q.valid_to.split("T")[0]:"",roleId:Q.role_id||""});try{const L=await Z.get(`/admin/users/${s}/branches`),V=Array.isArray((H=(Y=L.data)==null?void 0:Y.data)==null?void 0:H.items)?L.data.data.items:[];c(P=>({...P,branchIds:V.map(C=>String(C.id))}))}catch{}}}catch(z){d(((q=(M=z==null?void 0:z.response)==null?void 0:M.data)==null?void 0:q.message)||"Error fetching user")}finally{n(!1)}}function F(U,T){c(Y=>({...Y,[U]:T}))}async function I(U){const T=U.target.files[0];if(T)try{l(!0);const Y=new FileReader;Y.onload=()=>{const H=Y.result;F("profilePicture",H),l(!1)},Y.onerror=()=>{l(!1),d("Failed to read image")},Y.readAsDataURL(T)}catch(Y){console.error("Upload failed",Y),d("Failed to read profile picture")}finally{}}function w(U){if(!U)return!0;const T=8,Y=/[A-Z]/.test(U),H=/[0-9]/.test(U),M=/[!@#$%^&*(),.?":{}|<>]/.test(U);return U.length<T?"Password must be at least 8 characters long.":Y?H?M?!0:"Password must contain at least one special character.":"Password must contain at least one number.":"Password must contain at least one uppercase letter."}async function E(U){var T,Y,H;if(U.preventDefault(),n(!0),d(""),!r||u.password){const M=w(u.password);if(M!==!0){d(M),n(!1);return}}try{const M={company_id:u.companyId,branch_id:(T=u.branchIds)!=null&&T[0]?Number(u.branchIds[0]):void 0,branch_ids:u.branchIds.map(q=>Number(q)),username:u.username,email:u.email,full_name:u.fullName,is_active:u.isActive,profile_picture:u.profilePicture||null,is_employee:u.isEmployee,user_type:u.userType,valid_from:u.validFrom||null,valid_to:u.validTo||null,role_id:u.roleId||null};if(!M.branch_id){d("Select at least one branch"),n(!1);return}u.password&&(M.password_hash=u.password),r?await Z.put(`/admin/users/${s}`,M):await Z.post("/admin/users",M),t("/administration/users")}catch(M){d(((H=(Y=M==null?void 0:M.response)==null?void 0:Y.data)==null?void 0:H.message)||"Error saving user")}finally{n(!1)}}const W=u.companyId?p.filter(U=>String(U.company_id)===String(u.companyId)):[],R=u.companyId?x.filter(U=>String(U.company_id)===String(u.companyId)):[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/administration/users",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300 mb-2 inline-block",children:" Back to Users"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:r?"Edit User":"New User"}),e.jsx("p",{className:"text-sm mt-1",children:"Create and manage system users"})]}),e.jsx("form",{onSubmit:E,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[o&&e.jsx("div",{className:"alert alert-error mb-4",children:o}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Company *"}),e.jsxs("select",{className:"input",value:u.companyId,onChange:U=>{F("companyId",U.target.value),F("branchIds",[]),F("roleId","")},required:!0,children:[e.jsx("option",{value:"",children:"-- Select Company --"}),h.map(U=>e.jsxs("option",{value:U.id,children:[U.name," (",U.code,")"]},U.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Branches *"}),e.jsxs("div",{className:"space-y-2 border rounded-md p-2 max-h-48 overflow-auto",children:[W.map(U=>{const T=u.branchIds.includes(String(U.id));return e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-brand rounded focus:ring-brand",checked:T,onChange:Y=>{const H=Y.target.checked;c(M=>{const q=new Set(M.branchIds);return H?q.add(String(U.id)):q.delete(String(U.id)),{...M,branchIds:Array.from(q)}})},disabled:!u.companyId}),e.jsxs("span",{className:"text-sm",children:[U.name," (",U.code,")"]})]},U.id)}),W.length===0?e.jsx("div",{className:"text-xs text-slate-500",children:"Select a company to see branches"}):null]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Username *"}),e.jsx("input",{className:"input",value:u.username,onChange:U=>F("username",U.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Email *"}),e.jsx("input",{className:"input",type:"email",value:u.email,onChange:U=>F("email",U.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Full Name *"}),e.jsx("input",{className:"input",value:u.fullName,onChange:U=>F("fullName",U.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Role"}),e.jsxs("select",{className:"input",value:u.roleId,onChange:U=>F("roleId",U.target.value),disabled:!u.companyId,children:[e.jsx("option",{value:"",children:"-- Select Role --"}),R.map(U=>e.jsx("option",{value:U.id,children:U.name},U.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Profile Picture"}),e.jsxs("div",{className:"flex items-center gap-4",children:[u.profilePicture&&e.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden border border-slate-200",children:e.jsx("img",{src:u.profilePicture,alt:"Profile",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"file",className:"file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-brand-50 file:text-brand-700 hover:file:bg-brand-100 text-sm text-slate-500",onChange:I,accept:"image/*",disabled:i}),i&&e.jsx("span",{className:"text-xs text-brand ml-2",children:"Uploading..."})]})]}),e.jsx("input",{type:"hidden",value:u.profilePicture})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"User Type"}),e.jsxs("select",{className:"input",value:u.userType,onChange:U=>F("userType",U.target.value),children:[e.jsx("option",{value:"Internal",children:"Internal"}),e.jsx("option",{value:"External",children:"External"}),e.jsx("option",{value:"Vendor",children:"Vendor"}),e.jsx("option",{value:"Customer",children:"Customer"}),e.jsx("option",{value:"Contractor",children:"Contractor"})]})]}),e.jsxs("div",{className:"flex items-center gap-6 mt-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u.isEmployee,onChange:U=>F("isEmployee",U.target.checked),className:"w-4 h-4 text-brand rounded focus:ring-brand"}),e.jsx("span",{className:"text-sm font-medium",children:"Is Employee"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u.isActive,onChange:U=>F("isActive",U.target.checked),className:"w-4 h-4 text-brand rounded focus:ring-brand"}),e.jsx("span",{className:"text-sm font-medium",children:"Active Status"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:u.validFrom,onChange:U=>F("validFrom",U.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:u.validTo,onChange:U=>F("validTo",U.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 border-t pt-4 mt-2",children:[e.jsx("label",{className:"label",children:r?"New Password (leave blank to keep current)":"Password *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"input pr-10",type:y?"text":"password",value:u.password,onChange:U=>F("password",U.target.value),required:!r,placeholder:r?"Enter new password...":"Enter password..."}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-2 flex items-center text-slate-500",onClick:()=>j(U=>!U),"aria-label":y?"Hide password":"Show password",children:y?e.jsx(Lj,{size:18}):e.jsx(Dj,{size:18})})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Must be at least 8 characters, include 1 uppercase, 1 number, and 1 special character."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(Re,{to:"/administration/users",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",type:"submit",disabled:a,children:a?"Saving...":r?"Update User":"Create User"})]})]})})})]})}const MU=()=>{const[t,s]=f.useState([]),[r,a]=f.useState(!0),n=ps();f.useEffect(()=>{i()},[]);const i=async()=>{try{const o=await Z.get("/workflows");s(o.data.items||[])}catch(o){console.error("Failed to fetch workflows",o)}finally{a(!1)}},l=async o=>{if(window.confirm("Are you sure you want to delete this workflow?"))try{await Z.delete(`/workflows/${o}`),i()}catch(d){console.error("Failed to delete workflow",d)}};return r?e.jsx("div",{className:"p-8 text-center",children:"Loading workflows..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Workflow Definitions"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/administration",className:"btn btn-secondary",children:"Return to Menu"}),e.jsxs("button",{onClick:()=>n("/administration/workflows/new"),className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",children:[e.jsx(Ec,{size:20}),"Create Workflow"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Code"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Module"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Doc Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-4 text-center text-gray-500",children:"No workflows defined yet."})}):t.map(o=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:o.workflow_code}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:o.workflow_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:o.module_key}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:o.document_type}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${o.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:o.is_active?"Active":"Inactive"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>n(`/administration/workflows/${o.id}`),className:"text-blue-600 hover:text-blue-900 mr-4",children:e.jsx(kh,{size:18})}),e.jsx("button",{onClick:()=>l(o.id),className:"text-red-600 hover:text-red-900",children:e.jsx(ol,{size:18})})]})]},o.id))})]})})]})};function QU(t){return String(t||"").split("-").map(s=>s[0]?s[0].toUpperCase()+s.slice(1):"").join(" ")}function Zv(t,s){return`${t}_${s}`.toUpperCase().replace(/[^A-Z0-9]+/g,"_").replace(/^_+|_+$/g,"")}function am(t){return String(t||"").toUpperCase().replace(/[^A-Z0-9]+/g,"_").replace(/^_+|_+$/g,"")}function b_(t){const s=String(t||"");let r=0;return s.includes("/:")&&(r+=2),/\/(new|edit)\b/i.test(s)&&(r+=1),r}function HU(t,s){return b_(t)<b_(s)}function qU(t){const s=String(t||"").trim();if(!s)return s;const r={user:"User",users:"User",invoice:"Invoice",invoices:"Invoice",customer:"Customer",customers:"Customer",branch:"Branch",branches:"Branch",company:"Company",companies:"Company",employee:"Employee",employees:"Employee"},a=s.toLowerCase();if(r[a])return r[a];const n=s.split(/\s+/).filter(Boolean);if(!n.length)return s;const i=n[n.length-1],l=i.toLowerCase();if(new Set(["sales","pos"]).has(l))return s;let d=i;return/ies$/i.test(i)&&i.length>3?d=i.replace(/ies$/i,"y"):/(ses|xes|zes|ches|shes)$/i.test(i)&&i.length>3?d=i.replace(/es$/i,""):/s$/i.test(i)&&i.length>3&&(d=i.slice(0,-1)),d!==i?(n[n.length-1]=d,n.join(" ")):s}const y_=()=>{const{id:t}=Ps(),s=ps(),r=!!t,[a,n]=f.useState(!1),[i,l]=f.useState([]),[o,d]=f.useState([]),[u,c]=f.useState(""),[h,m]=f.useState({workflow_code:"",workflow_name:"",module_key:"",document_type:"",document_route:"",is_active:!0,steps:[]});f.useEffect(()=>{b();const w=setInterval(b,2e4);return r&&y(),()=>clearInterval(w)},[t]);const[p,g]=f.useState({}),x=async(w,E)=>{var R;const W=String(E||"").trim();if(W.length<2){g(U=>({...U,[w]:[]}));return}try{const U=await Z.get("/workflows/users",{params:{q:W,active:1}}),T=Array.isArray((R=U.data)==null?void 0:R.items)?U.data.items:[];g(Y=>({...Y,[w]:T}))}catch{g(T=>({...T,[w]:[]}))}},b=async()=>{var w,E;try{const W=await Z.get("/admin/pages"),R=Array.isArray((E=(w=W.data)==null?void 0:w.data)==null?void 0:E.items)?W.data.data.items:[],U=new Map;for(const Y of R){const H=Y.module||"General",M=String(Y.name||""),q=String(Y.path||""),z=M.toLowerCase(),Q=q.toLowerCase();if(z.includes("report")||Q.includes("/reports")||Q.endsWith("/reports")||/\blist\b/i.test(z))continue;let L=M.replace(/\s*(List|Form|Edit|Delete)\s*$/i,"")||QU(q.split("/").filter(Boolean).pop()||"");L=L.replace(/\bOrders\b/gi,"Order").replace(/\bBills\b/gi,"Bill").replace(/\bRequisitions\b/gi,"Requisition").replace(/\bReturns\b/gi,"Return").replace(/\bTransfers\b/gi,"Transfer"),L=qU(L);const V=q;if(!L||!V)continue;const P=`${H}||${L.toUpperCase()}`,C=U.get(P);if(!C||HU(V,C.route)){const k=Zv(H,L);U.set(P,{module:H,label:L,code:k,route:V})}}const T=Array.from(U.values());T.sort((Y,H)=>Y.module===H.module?Y.label.localeCompare(H.label):Y.module.localeCompare(H.module)),d(T)}catch(W){console.error("Failed to fetch transaction document types",W),d([])}};f.useEffect(()=>{if(!h.module_key||!h.document_type||o.length===0)return;const w=o.find(E=>am(E.module)===am(h.module_key)&&E.label===h.document_type)||o.find(E=>E.code===Zv(am(h.module_key),h.document_type));c(w?w.code:"")},[o,h.module_key,h.document_type]);const y=async()=>{n(!0);try{const E=(await Z.get(`/workflows/${t}`)).data.item,W=Array.isArray(E.steps)?E.steps.map(U=>({...U,approver_user_ids:Array.isArray(U.approvers)&&U.approvers.length?U.approvers.map(T=>T.id):U.approver_user_id?[U.approver_user_id]:[]})):[];m({...E,is_active:!!E.is_active,steps:W});const R=Zv(am(E.module_key),E.document_type);c(R)}catch(w){console.error("Failed to fetch workflow",w),alert("Error loading workflow")}finally{n(!1)}},j=w=>{const{name:E,value:W,type:R,checked:U}=w.target;m(T=>({...T,[E]:R==="checkbox"?U:W}))},N=(w,E,W)=>{const R=[...h.steps];R[w]={...R[w],[E]:W},m(U=>({...U,steps:R}))},_=()=>{m(w=>({...w,steps:[...w.steps,{step_order:w.steps.length+1,step_name:"",approver_user_ids:[],approval_limit:null,is_mandatory:!0}]}))},F=w=>{const W=h.steps.filter((R,U)=>U!==w).map((R,U)=>({...R,step_order:U+1}));m(R=>({...R,steps:W}))},I=async w=>{var E,W;w.preventDefault(),n(!0);try{for(const U of h.steps)if(!(Array.isArray(U.approver_user_ids)?U.approver_user_ids:U.approver_user_id?[U.approver_user_id]:[]).length){alert(`Please select an approver for step ${U.step_order}`),n(!1);return}const R={...h,steps:h.steps.map(U=>{const T=Array.isArray(U.approver_user_ids)?U.approver_user_ids:U.approver_user_id?[U.approver_user_id]:[];return{...U,approver_user_ids:T.map(Y=>Number(Y)),approval_limit:U.approval_limit?parseFloat(U.approval_limit):null}})};if(!r){const U=String(R.workflow_code||"");/^WF-[0-9]{6}$/.test(U)||delete R.workflow_code}r?await Z.put(`/workflows/${t}`,R):await Z.post("/workflows",R),s("/administration/workflows")}catch(R){console.error("Failed to save workflow",R),alert(((W=(E=R.response)==null?void 0:E.data)==null?void 0:W.message)||"Error saving workflow")}finally{n(!1)}};return a&&r&&!h.workflow_code?e.jsx("div",{className:"p-8 text-center",children:"Loading..."}):e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>s("/administration/workflows"),className:"text-gray-500 hover:text-gray-700",children:e.jsx(Xf,{size:24})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:r?"Edit Workflow":"Create Workflow"})]}),e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-700 border-b pb-2",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Workflow Name"}),e.jsx("input",{type:"text",name:"workflow_name",required:!0,value:h.workflow_name,onChange:j,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Workflow Code"}),e.jsx("input",{type:"text",name:"workflow_code",required:!0,value:h.workflow_code,readOnly:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 bg-gray-100 text-gray-500 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Module Key"}),e.jsxs("select",{name:"module_key",required:!0,value:h.module_key,onChange:w=>{const E=w.target.value;c(""),m(W=>({...W,module_key:E,document_type:"",document_route:""}))},className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2",children:[e.jsx("option",{value:"",children:"Select Module"}),o.length===0?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"PURCHASE",children:"Purchase"}),e.jsx("option",{value:"SALES",children:"Sales"}),e.jsx("option",{value:"SERVICE_MANAGEMENT",children:"Service Management"}),e.jsx("option",{value:"HR",children:"HR"}),e.jsx("option",{value:"FINANCE",children:"Finance"}),e.jsx("option",{value:"INVENTORY",children:"Inventory"})]}):Array.from(new Set(o.map(w=>w.module))).map(w=>e.jsx("option",{value:String(w).toUpperCase().replace(/[^A-Z0-9]+/g,"_").replace(/^_+|_+$/g,""),children:w},w))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Document Type"}),e.jsxs("select",{name:"document_type",required:!0,value:u,onChange:w=>{const E=w.target.value;c(E);const W=o.find(R=>R.code===E)||(()=>{const R=String(E).split("|");return R.length===2?{module:R[0],label:R[1],route:`/${R[0].toLowerCase()}/${R[1].toLowerCase().replace(/[^a-z0-9]+/g,"-")}`}:null})();W&&m(R=>({...R,module_key:am(W.module),document_type:W.label||"",document_route:W.route||""}))},className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2",children:[e.jsx("option",{value:"",children:"Select Document Type"}),o.length===0?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"SERVICE MANAGEMENT|Service Request",children:"Service Request"}),e.jsx("option",{value:"SALES|Sales Order",children:"Sales Order"}),e.jsx("option",{value:"PURCHASE|Purchase Order",children:"Purchase Order"}),e.jsx("option",{value:"SALES|Invoice",children:"Invoice"}),e.jsx("option",{value:"INVENTORY|Work Order",children:"Work Order"})]}):o.filter(w=>h.module_key?am(w.module)===am(h.module_key):!0).map(w=>e.jsx("option",{value:w.code,children:w.label},w.code))]}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{type:"button",onClick:b,className:"btn btn-sm btn-secondary",children:"Refresh Types"})})]}),e.jsxs("div",{className:"flex items-center mt-6",children:[e.jsx("input",{type:"checkbox",name:"is_active",checked:h.is_active,onChange:j,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:"Is Active"})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-700",children:"Approval Steps"}),e.jsxs("button",{type:"button",onClick:_,className:"flex items-center gap-1 text-sm bg-gray-100 text-gray-700 px-3 py-1 rounded hover:bg-gray-200",children:[e.jsx(Ec,{size:16})," Add Step"]})]}),e.jsxs("div",{className:"space-y-4",children:[h.steps.map((w,E)=>e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-end p-4 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"w-full md:w-16",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500",children:"Order"}),e.jsx("div",{className:"mt-1 font-semibold text-center",children:w.step_order})]}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500",children:"Step Name"}),e.jsx("input",{type:"text",value:w.step_name,onChange:W=>N(E,"step_name",W.target.value),placeholder:"e.g. Manager Approval",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 text-sm"})]}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500",children:"Approvers (Users)"}),e.jsx("input",{type:"text",placeholder:"Type to search users (min 2 chars)",onChange:W=>x(E,W.target.value||""),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 text-sm"}),e.jsx("select",{className:"hidden"}),e.jsx("div",{className:"mt-1 grid grid-cols-1 md:grid-cols-2 gap-2",children:(p[E]||[]).map(W=>{const R=Number(W.id),U=Array.isArray(w.approver_user_ids)?w.approver_user_ids.map(T=>Number(T)).includes(R):!1;return e.jsxs("label",{className:"flex items-center gap-2 border rounded p-2 text-sm cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",value:R,checked:U,onChange:T=>{const Y=Number(T.target.value),H=Array.isArray(w.approver_user_ids)?w.approver_user_ids.map(q=>Number(q)):[],M=T.target.checked?Array.from(new Set([...H,Y])):H.filter(q=>q!==Y);N(E,"approver_user_ids",M)}}),e.jsx("span",{children:W.username||W.full_name||W.email||`User #${R}`})]},R)})}),Array.isArray(w.approver_user_ids)&&w.approver_user_ids.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:w.approver_user_ids.map(W=>{const R=Number(W),U=(p[E]||[]).find(Y=>Number(Y.id)===R)||(Array.isArray(w.approvers)?w.approvers.find(Y=>Number(Y.id)===R):null),T=U&&(U.username||U.full_name||U.email)||`User #${R}`;return e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-blue-50 text-blue-700 text-xs",children:T},`sel-${R}`)})})]}),e.jsxs("div",{className:"w-full md:w-32",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500",children:"Limit ($)"}),e.jsx("input",{type:"number",value:w.approval_limit||"",onChange:W=>N(E,"approval_limit",W.target.value),placeholder:"No Limit",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 text-sm"})]}),e.jsx("button",{type:"button",onClick:()=>F(E),className:"text-red-500 hover:text-red-700 p-2",children:e.jsx(ol,{size:18})})]},E)),h.steps.length===0&&e.jsx("p",{className:"text-gray-500 text-sm italic text-center py-4",children:'No steps defined. Click "Add Step" to begin.'})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>s("/administration/workflows"),className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:a,className:"flex items-center gap-2 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(sA,{size:18}),a?"Saving...":"Save Workflow"]})]})]})]})};function $U(){const[t,s]=f.useState([]),[r,a]=f.useState(!0);return f.useEffect(()=>{Z.get("/workflows/approvals/pending").then(n=>s(n.data.items)).catch(n=>console.error(n)).finally(()=>a(!1))},[]),r?e.jsx("div",{className:"p-6",children:"Loading approvals..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"My Pending Approvals"}),e.jsx(Re,{to:"/",className:"btn btn-secondary",children:"Return to Home"})]}),t.length===0?e.jsx("div",{className:"text-slate-500",children:"No pending approvals found."}):e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-erp border border-slate-200 dark:border-slate-700 overflow-hidden",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 text-slate-500 font-medium border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"Document"}),e.jsx("th",{className:"p-4",children:"Type"}),e.jsx("th",{className:"p-4",children:"Amount"}),e.jsx("th",{className:"p-4",children:"Step"}),e.jsx("th",{className:"p-4",children:"Submitted By"}),e.jsx("th",{className:"p-4",children:"Date"}),e.jsx("th",{className:"p-4",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:t.map(n=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[e.jsxs("td",{className:"p-4 font-medium text-slate-900 dark:text-slate-100",children:[String(n.document_type||"").replace(/_/g," ").toLowerCase().replace(/\b\w/g,i=>i.toUpperCase())," #",n.document_id]}),e.jsx("td",{className:"p-4 text-slate-600 dark:text-slate-400",children:n.document_type}),e.jsx("td",{className:"p-4 text-slate-600 dark:text-slate-400",children:n.amount!=null?Number(n.amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"-"}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"badge bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",children:n.step_name})}),e.jsx("td",{className:"p-4 text-slate-600 dark:text-slate-400",children:n.initiator||"Unknown"}),e.jsx("td",{className:"p-4 text-slate-600 dark:text-slate-400",children:new Date(n.submitted_at).toLocaleDateString()}),e.jsx("td",{className:"p-4",children:e.jsx(Re,{to:`/administration/workflows/approvals/${n.workflow_instance_id}`,className:"btn btn-sm btn-primary",children:"Review"})})]},n.workflow_instance_id))})]})})]})}function VU(){const[t,s]=f.useState([]),[r,a]=f.useState(!0),n=ps();f.useEffect(()=>{Z.get("/workflows/notifications").then(o=>{var d;return s(Array.isArray((d=o.data)==null?void 0:d.items)?o.data.items:[])}).catch(()=>s([])).finally(()=>a(!1))},[]);const i=f.useMemo(()=>t.filter(o=>String((o==null?void 0:o.message)||"").toLowerCase().includes("approved")),[t]);function l(o){const u=String(o||"").match(/approvals\/(\d+)/);return u?Number(u[1]):null}return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"Approved Documents"}),e.jsx(Re,{to:"/",className:"btn btn-secondary",children:"Return to Home"})]}),r?e.jsx("div",{className:"p-6",children:"Loading approved documents..."}):i.length===0?e.jsx("div",{className:"text-slate-500",children:"No approved documents found."}):e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-erp border border-slate-200 dark:border-slate-700 overflow-hidden",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 text-slate-500 font-medium border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"Message"}),e.jsx("th",{className:"p-4",children:"Approved On"}),e.jsx("th",{className:"p-4",children:"Action"})]})}),e.jsx("tbody",{children:i.map(o=>{const d=l(o.link);return e.jsxs("tr",{className:"border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-slate-100",children:o.message}),e.jsx("div",{className:"text-xs text-slate-500",children:o.reference||""})]}),e.jsx("td",{className:"p-4",children:o.date||"Just now"}),e.jsx("td",{className:"p-4",children:d?e.jsx("button",{className:"text-brand hover:text-brand-600 text-sm font-medium",onClick:()=>n(`/administration/workflows/approvals/${d}`),children:"View"}):e.jsx("span",{className:"text-slate-400 text-sm",children:"No link"})})]},o.id)})})]})})]})}function WU(){const{instanceId:t}=Ps(),s=ps(),[r,a]=f.useState(null),[n,i]=f.useState(!0),[l,o]=f.useState(""),[d,u]=f.useState(!1),[c,h]=f.useState(null),[m,p]=f.useState([]),[g,x]=f.useState(!1),[b,y]=f.useState(null);f.useEffect(()=>{Z.get(`/workflows/approvals/instance/${t}`).then(N=>a(N.data.item)).catch(N=>{console.error(N),ct.error("Failed to load workflow details")}).finally(()=>i(!1))},[t]),f.useEffect(()=>{if(!r)return;if(!r.is_last_step&&Array.isArray(r.next_step_approvers)){const _=r.next_step_approvers[0];y(_?_.id:null)}else y(null);const N=String(r.document_type||"").toUpperCase();N==="MATERIAL_REQUISITION"?(x(!0),Z.get(`/inventory/material-requisitions/${r.document_id}`).then(_=>{var F,I;h(((F=_.data)==null?void 0:F.item)||null),p(Array.isArray((I=_.data)==null?void 0:I.details)?_.data.details:[])}).catch(()=>{h(null),p([])}).finally(()=>x(!1))):N==="STOCK_ADJUSTMENT"?(x(!0),Z.get(`/inventory/stock-adjustments/${r.document_id}`).then(_=>{var F,I;h(((F=_.data)==null?void 0:F.item)||null),p(Array.isArray((I=_.data)==null?void 0:I.details)?_.data.details:[])}).catch(()=>{h(null),p([])}).finally(()=>x(!1))):N==="PURCHASE_ORDER"||N==="PURCHASE ORDER"?(x(!0),Z.get(`/purchase/orders/${r.document_id}`).then(_=>{var F,I,w;h(((F=_.data)==null?void 0:F.item)||null),p(Array.isArray((w=(I=_.data)==null?void 0:I.item)==null?void 0:w.details)?_.data.item.details:[])}).catch(()=>{h(null),p([])}).finally(()=>x(!1))):N==="GOODS_RECEIPT"||N==="GRN"||N==="GOODS RECEIPT NOTE"?(x(!0),Z.get(`/inventory/grn/${r.document_id}`).then(_=>{var F,I,w;h(((F=_.data)==null?void 0:F.item)||null),p(Array.isArray((w=(I=_.data)==null?void 0:I.item)==null?void 0:w.details)?_.data.item.details:[])}).catch(()=>{h(null),p([])}).finally(()=>x(!1))):N==="PAYMENT_VOUCHER"||N==="PAYMENT VOUCHER"||N==="PV"?(x(!0),Z.get(`/finance/vouchers/${r.document_id}`).then(_=>{var F,I;h(((F=_.data)==null?void 0:F.voucher)||null),p(Array.isArray((I=_.data)==null?void 0:I.lines)?_.data.lines:[])}).catch(()=>{h(null),p([])}).finally(()=>x(!1))):N==="RECEIPT_VOUCHER"||N==="RECEIPT VOUCHER"||N==="RV"?(x(!0),Z.get(`/finance/vouchers/${r.document_id}`).then(_=>{var F,I;h(((F=_.data)==null?void 0:F.voucher)||null),p(Array.isArray((I=_.data)==null?void 0:I.lines)?_.data.lines:[])}).catch(()=>{h(null),p([])}).finally(()=>x(!1))):N==="SALES_ORDER"||N==="SALES ORDER"?(x(!0),Z.get(`/sales/orders/${r.document_id}`).then(_=>{var F,I;h(((F=_.data)==null?void 0:F.item)||null),p(Array.isArray((I=_.data)==null?void 0:I.details)?_.data.details:[])}).catch(()=>{h(null),p([])}).finally(()=>x(!1))):(h(null),p([]),x(!1))},[r]);const j=async N=>{var _,F;if(!l&&(N==="REJECT"||N==="RETURN")){ct.warning("Please provide a comment for rejection/return");return}if(N==="APPROVE"&&!r.is_last_step&&!b){ct.warning("Please select the next approver");return}u(!0);try{await Z.post(`/workflows/${t}/action`,{action:N,comments:l,target_user_id:r.is_last_step?null:b}),ct.success(`Document ${N.toLowerCase()}ed successfully`),s("/administration/workflows/approvals")}catch(I){console.error(I),ct.error(((F=(_=I.response)==null?void 0:_.data)==null?void 0:F.message)||"Action failed")}finally{u(!1)}};return n?e.jsx("div",{className:"p-6",children:"Loading details..."}):r?e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:["Review:"," ",String(r.document_type||"").replace(/_/g," ").toLowerCase().replace(/\b\w/g,N=>N.toUpperCase())," ","#",r.document_id]}),e.jsx("button",{onClick:()=>s(-1),className:"btn btn-outline",children:"Back"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-erp border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 border-b border-slate-100 dark:border-slate-700 pb-2",children:"Document Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-slate-500 block",children:"Document Type"}),e.jsx("div",{className:"font-medium",children:r.document_type})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-slate-500 block",children:"ID"}),e.jsxs("div",{className:"font-medium",children:["#",r.document_id]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-slate-500 block",children:"Amount"}),e.jsx("div",{className:"font-medium",children:r.amount!=null?Number(r.amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-slate-500 block",children:"Submitted At"}),e.jsx("div",{className:"font-medium",children:new Date(r.created_at).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-slate-500 block",children:"Current Status"}),e.jsx("span",{className:`badge ${r.status==="PENDING"?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`,children:r.status})]})]}),String(r.document_type||"").toUpperCase()==="MATERIAL_REQUISITION"?e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Requisition No"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.requisition_no)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Requisition Date"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.requisition_date)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Warehouse"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.warehouse_name)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Department"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.department_name)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Requested By"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.requested_by)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Status"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.status)||"-"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold mb-2",children:["Items (",m.length,")"]}),g?e.jsx("div",{className:"text-sm text-slate-500",children:"Loading..."}):m.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item Code"}),e.jsx("th",{children:"Item Name"}),e.jsx("th",{children:"Qty Requested"}),e.jsx("th",{children:"UOM"})]})}),e.jsx("tbody",{children:m.map(N=>e.jsxs("tr",{children:[e.jsx("td",{children:N.item_code||N.item_id}),e.jsx("td",{children:N.item_name||"-"}),e.jsx("td",{children:Number(N.qty_requested||0)}),e.jsx("td",{children:N.uom||"-"})]},N.id))})]})}):e.jsx("div",{className:"text-sm text-slate-500",children:"No items found"})]}),(c==null?void 0:c.remarks)&&e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-900/50 rounded text-sm",children:[e.jsx("div",{className:"text-slate-500",children:"Remarks"}),e.jsx("div",{className:"text-slate-700 dark:text-slate-300",children:c.remarks})]})]}):String(r.document_type||"").toUpperCase()==="STOCK_ADJUSTMENT"||String(r.document_type||"").toUpperCase()==="STOCK ADJUSTMENT"?e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Adjustment No"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.adjustment_no)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Date"}),e.jsx("div",{className:"font-medium",children:c!=null&&c.adjustment_date?new Date(c.adjustment_date).toLocaleDateString():"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Type"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.adjustment_type)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Status"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.status)||"-"})]}),(c==null?void 0:c.warehouse_name)&&e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Warehouse"}),e.jsx("div",{className:"font-medium",children:c.warehouse_name})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold mb-2",children:["Items (",m.length,")"]}),g?e.jsx("div",{className:"text-sm text-slate-500",children:"Loading..."}):m.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item Code"}),e.jsx("th",{children:"Item Name"}),e.jsx("th",{children:"Current Stock"}),e.jsx("th",{children:"Adjusted Stock"}),e.jsx("th",{children:"Difference"})]})}),e.jsx("tbody",{children:m.map(N=>e.jsxs("tr",{children:[e.jsx("td",{children:N.item_code||N.item_id}),e.jsx("td",{children:N.item_name||"-"}),e.jsx("td",{children:Number(N.current_stock||0)}),e.jsx("td",{children:Number(N.adjusted_stock||0)}),e.jsxs("td",{className:Number(N.qty)<0?"text-red-500":"text-green-500",children:[Number(N.qty)>0?"+":"",Number(N.qty)]})]},N.id))})]})}):e.jsx("div",{className:"text-sm text-slate-500",children:"No items found"})]}),(c==null?void 0:c.reason)&&e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-900/50 rounded text-sm",children:[e.jsx("div",{className:"text-slate-500",children:"Reason"}),e.jsx("div",{className:"text-slate-700 dark:text-slate-300",children:c.reason})]})]}):String(r.document_type||"").toUpperCase()==="PURCHASE_ORDER"||String(r.document_type||"").toUpperCase()==="PURCHASE ORDER"?e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"PO No"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.po_no)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"PO Date"}),e.jsx("div",{className:"font-medium",children:c!=null&&c.po_date?new Date(c.po_date).toLocaleDateString():"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Order Type"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.po_type)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Supplier"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.supplier_name)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Status"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.status)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Total Amount"}),e.jsx("div",{className:"font-medium",children:Number((c==null?void 0:c.total_amount)||0).toLocaleString("en-US",{minimumFractionDigits:2})})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold mb-2",children:["Items (",m.length,")"]}),g?e.jsx("div",{className:"text-sm text-slate-500",children:"Loading..."}):m.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item Code"}),e.jsx("th",{children:"Item Name"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit Price"}),e.jsx("th",{children:"Line Total"})]})}),e.jsx("tbody",{children:m.map(N=>e.jsxs("tr",{children:[e.jsx("td",{children:N.item_code||N.item_id}),e.jsx("td",{children:N.item_name||"-"}),e.jsx("td",{children:Number(N.qty||0)}),e.jsx("td",{children:Number(N.unit_price||0).toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsx("td",{children:Number(N.line_total||0).toLocaleString("en-US",{minimumFractionDigits:2})})]},N.id))})]})}):e.jsx("div",{className:"text-sm text-slate-500",children:"No items found"})]})]}):String(r.document_type||"").toUpperCase()==="GOODS_RECEIPT"||String(r.document_type||"").toUpperCase()==="GRN"||String(r.document_type||"").toUpperCase()==="GOODS RECEIPT NOTE"?e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"GRN No"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.grn_no)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"GRN Date"}),e.jsx("div",{className:"font-medium",children:c!=null&&c.grn_date?String(c.grn_date).slice(0,10):"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Supplier"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.supplier_name)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Warehouse"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.warehouse_name)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Status"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.status)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Invoice No"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.invoice_no)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Invoice Date"}),e.jsx("div",{className:"font-medium",children:c!=null&&c.invoice_date?String(c.invoice_date).slice(0,10):"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Invoice Amount"}),e.jsx("div",{className:"font-medium",children:Number((c==null?void 0:c.invoice_amount)||0).toLocaleString("en-US",{minimumFractionDigits:2})})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold mb-2",children:["Items (",m.length,")"]}),g?e.jsx("div",{className:"text-sm text-slate-500",children:"Loading..."}):m.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item Code"}),e.jsx("th",{children:"Item Name"}),e.jsx("th",{children:"Qty Received"}),e.jsx("th",{children:"Qty Accepted"}),e.jsx("th",{children:"UOM"}),e.jsx("th",{children:"Unit Price"}),e.jsx("th",{children:"Line Amount"})]})}),e.jsx("tbody",{children:m.map(N=>e.jsxs("tr",{children:[e.jsx("td",{children:N.item_code||N.item_id}),e.jsx("td",{children:N.item_name||"-"}),e.jsx("td",{children:Number(N.qty_received||0)}),e.jsx("td",{children:Number(N.qty_accepted||0)}),e.jsx("td",{children:N.uom||"-"}),e.jsx("td",{children:Number(N.unit_price||0).toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsx("td",{children:Number(N.line_amount||0).toLocaleString("en-US",{minimumFractionDigits:2})})]},N.id))})]})}):e.jsx("div",{className:"text-sm text-slate-500",children:"No items found"})]})]}):String(r.document_type||"").toUpperCase()==="PAYMENT_VOUCHER"||String(r.document_type||"").toUpperCase()==="PAYMENT VOUCHER"||String(r.document_type||"").toUpperCase()==="PV"?e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Voucher No"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.voucher_no)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Voucher Date"}),e.jsx("div",{className:"font-medium",children:c!=null&&c.voucher_date?String(c.voucher_date).slice(0,10):"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Voucher Type"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.voucher_type_name)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Status"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.status)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Total Debit"}),e.jsx("div",{className:"font-medium",children:Number((c==null?void 0:c.total_debit)||0).toLocaleString("en-US",{minimumFractionDigits:2})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Total Credit"}),e.jsx("div",{className:"font-medium",children:Number((c==null?void 0:c.total_credit)||0).toLocaleString("en-US",{minimumFractionDigits:2})})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold mb-2",children:["Lines (",m.length,")"]}),g?e.jsx("div",{className:"text-sm text-slate-500",children:"Loading..."}):m.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Account"}),e.jsx("th",{children:"Description"}),e.jsx("th",{className:"text-right",children:"Debit"}),e.jsx("th",{className:"text-right",children:"Credit"})]})}),e.jsx("tbody",{children:m.map(N=>e.jsxs("tr",{children:[e.jsxs("td",{children:[N.account_code," - ",N.account_name]}),e.jsx("td",{children:N.description||"-"}),e.jsx("td",{className:"text-right",children:Number(N.debit||0).toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsx("td",{className:"text-right",children:Number(N.credit||0).toLocaleString("en-US",{minimumFractionDigits:2})})]},N.id))})]})}):e.jsx("div",{className:"text-sm text-slate-500",children:"No lines found"})]})]}):String(r.document_type||"").toUpperCase()==="RECEIPT_VOUCHER"||String(r.document_type||"").toUpperCase()==="RECEIPT VOUCHER"||String(r.document_type||"").toUpperCase()==="RV"?e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Voucher No"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.voucher_no)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Voucher Date"}),e.jsx("div",{className:"font-medium",children:c!=null&&c.voucher_date?String(c.voucher_date).slice(0,10):"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Voucher Type"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.voucher_type_name)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Status"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.status)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Total Debit"}),e.jsx("div",{className:"font-medium",children:Number((c==null?void 0:c.total_debit)||0).toLocaleString("en-US",{minimumFractionDigits:2})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Total Credit"}),e.jsx("div",{className:"font-medium",children:Number((c==null?void 0:c.total_credit)||0).toLocaleString("en-US",{minimumFractionDigits:2})})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold mb-2",children:["Lines (",m.length,")"]}),g?e.jsx("div",{className:"text-sm text-slate-500",children:"Loading..."}):m.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Account"}),e.jsx("th",{children:"Description"}),e.jsx("th",{className:"text-right",children:"Debit"}),e.jsx("th",{className:"text-right",children:"Credit"})]})}),e.jsx("tbody",{children:m.map(N=>e.jsxs("tr",{children:[e.jsxs("td",{children:[N.account_code," - ",N.account_name]}),e.jsx("td",{children:N.description||"-"}),e.jsx("td",{className:"text-right",children:Number(N.debit||0).toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsx("td",{className:"text-right",children:Number(N.credit||0).toLocaleString("en-US",{minimumFractionDigits:2})})]},N.id))})]})}):e.jsx("div",{className:"text-sm text-slate-500",children:"No lines found"})]})]}):String(r.document_type||"").toUpperCase()==="SALES_ORDER"||String(r.document_type||"").toUpperCase()==="SALES ORDER"?e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Order No"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.order_no)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Order Date"}),e.jsx("div",{className:"font-medium",children:c!=null&&c.order_date?new Date(c.order_date).toLocaleDateString():"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Customer ID"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.customer_id)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Price Type"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.price_type)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Payment Type"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.payment_type)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Status"}),e.jsx("div",{className:"font-medium",children:(c==null?void 0:c.status)||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Total Amount"}),e.jsx("div",{className:"font-medium",children:Number((c==null?void 0:c.total_amount)||0).toLocaleString("en-US",{minimumFractionDigits:2})})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold mb-2",children:["Items (",m.length,")"]}),g?e.jsx("div",{className:"text-sm text-slate-500",children:"Loading..."}):m.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item ID"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit Price"}),e.jsx("th",{children:"Tax Amount"}),e.jsx("th",{children:"Line Total"})]})}),e.jsx("tbody",{children:m.map(N=>e.jsxs("tr",{children:[e.jsx("td",{children:N.item_id}),e.jsx("td",{children:Number(N.quantity||0)}),e.jsx("td",{children:Number(N.unit_price||0).toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsx("td",{children:Number(N.tax_amount||0).toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsx("td",{children:Number(N.total_amount||0).toLocaleString("en-US",{minimumFractionDigits:2})})]},N.id))})]})}):e.jsx("div",{className:"text-sm text-slate-500",children:"No items found"})]}),(c==null?void 0:c.remarks)&&e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-900/50 rounded text-sm",children:[e.jsx("div",{className:"text-slate-500",children:"Remarks"}),e.jsx("div",{className:"text-slate-700 dark:text-slate-300",children:c.remarks})]})]}):e.jsxs("div",{className:"mt-6 p-4 bg-slate-50 dark:bg-slate-900/50 rounded border border-slate-100 dark:border-slate-800 text-center text-slate-500",children:[e.jsx("p",{children:"Document Preview Not Available"}),e.jsx("p",{className:"text-xs mt-1",children:`(${r.document_type} preview not implemented)`})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-erp border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 border-b border-slate-100 dark:border-slate-700 pb-2",children:"Approval History"}),e.jsx("div",{className:"space-y-4",children:r.logs&&r.logs.length>0?r.logs.map((N,_)=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"mt-1 w-2 h-2 rounded-full bg-slate-300 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium",children:[N.actor_name||"Unknown"," ",e.jsx("span",{className:"text-slate-500",children:"performed"})," ",N.action]}),e.jsx("div",{className:"text-xs text-slate-500",children:new Date(N.created_at).toLocaleString()}),N.comments&&e.jsxs("div",{className:"mt-1 text-sm bg-slate-50 dark:bg-slate-900/50 p-2 rounded text-slate-600 dark:text-slate-400",children:['"',N.comments,'"']})]})]},_)):e.jsx("div",{className:"text-slate-500 italic",children:"No history yet."})})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-erp border border-slate-200 dark:border-slate-700 p-6 sticky top-24",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Actions"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Current Step"}),e.jsx("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded border border-blue-100 dark:border-blue-800",children:r.step_name})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Comments"}),e.jsx("textarea",{className:"input w-full h-24",placeholder:"Enter comments...",value:l,onChange:N=>o(N.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[!r.is_last_step&&Array.isArray(r.next_step_approvers)&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Forward To"}),e.jsxs("select",{className:"input w-full",value:b||"",onChange:N=>y(Number(N.target.value)),children:[e.jsx("option",{value:"",children:"Select user"}),r.next_step_approvers.map(N=>e.jsx("option",{value:N.id,children:N.username},N.id))]})]}),e.jsx("button",{onClick:()=>j("APPROVE"),disabled:d||r.is_last_step&&r.approval_limit!==null&&r.amount>r.approval_limit,className:"btn btn-primary w-full justify-center disabled:opacity-50 disabled:cursor-not-allowed",children:r.is_last_step?"Final Approve":"Forward to Next Stage"}),r.is_last_step&&r.approval_limit!==null&&r.amount>r.approval_limit&&e.jsxs("p",{className:"text-red-500 text-xs text-center",children:["Amount exceeds your approval limit of"," ",Number(r.approval_limit||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("button",{onClick:()=>j("RETURN"),disabled:d,className:"btn btn-warning w-full justify-center",children:"Return for Revision"}),e.jsx("button",{onClick:()=>j("REJECT"),disabled:d,className:"btn btn-danger w-full justify-center",children:"Reject"}),(function(){const N=String(r.document_type||"").toUpperCase();return(N==="PV"||N==="PAYMENT_VOUCHER"||N==="PAYMENT VOUCHER"||N==="RV"||N==="RECEIPT_VOUCHER"||N==="RECEIPT VOUCHER")&&(c==null?void 0:c.status)==="APPROVED"})()&&e.jsx("button",{onClick:async()=>{var _,F,I,w;const N=window.prompt("Reason for reversal (optional):")||"";try{await Z.post(`/finance/vouchers/${r.document_id}/reverse`,{reason:N}),ct.success("Voucher reversed");const E=await Z.get(`/finance/vouchers/${r.document_id}`);h(((_=E.data)==null?void 0:_.voucher)||null),p(Array.isArray((F=E.data)==null?void 0:F.lines)?E.data.lines:[])}catch(E){ct.error(((w=(I=E==null?void 0:E.response)==null?void 0:I.data)==null?void 0:w.message)||"Failed to reverse voucher")}},disabled:d,className:"btn btn-outline w-full justify-center",children:"Reverse Voucher"})]})]})})]})]}):e.jsx("div",{className:"p-6",children:"Workflow not found"})}function GU(){const[t,s]=f.useState([]),[r,a]=f.useState(!0),[n,i]=f.useState(null);f.useEffect(()=>{l()},[]);const l=async()=>{try{a(!0);const o=await Z.get("/admin/companies");s(o.data.items||[])}catch(o){i(o.message||"Failed to fetch companies")}finally{a(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Company Setup"}),e.jsx("p",{className:"text-sm mt-1",children:"Manage companies"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/administration",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/administration/companies/new",className:"btn-success",children:"+ New Company"})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:r?e.jsx("div",{className:"text-center py-4",children:"Loading..."}):n?e.jsx("div",{className:"text-red-500 py-4",children:n}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colspan:"4",className:"text-center py-4 text-gray-500",children:"No companies found"})}):t.map(o=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:o.code}),e.jsx("td",{children:o.name}),e.jsx("td",{children:o.is_active?e.jsx("span",{className:"badge badge-success",children:"Active"}):e.jsx("span",{className:"badge badge-error",children:"Inactive"})}),e.jsx("td",{children:e.jsx(Re,{to:`/administration/companies/${o.id}`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"Edit"})})]},o.id))})]})})})})]})}function j_(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState(""),[o,d]=f.useState({code:"",name:"",isActive:!0,address:"",city:"",state:"",postal_code:"",country:"",telephone:"",email:"",website:"",tax_id:"",registration_no:"",fiscal_year_start_month:1,timezone:"",currency_id:""}),[u,c]=f.useState([]),[h,m]=f.useState(null),[p,g]=f.useState(""),[x,b]=f.useState(!1),[y,j]=f.useState("");f.useEffect(()=>{_(),r&&N()},[s]),f.useEffect(()=>()=>{p&&URL.revokeObjectURL(p)},[p]);async function N(){var R,U,T,Y;try{n(!0),l("");const H=await Z.get(`/admin/companies/${s}`);if((R=H.data)!=null&&R.item){const M=H.data.item;d({code:M.code||"",name:M.name||"",isActive:M.is_active===1||M.is_active===!0,address:M.address||"",city:M.city||"",state:M.state||"",postal_code:M.postal_code||"",country:M.country||"",telephone:M.telephone||"",email:M.email||"",website:M.website||"",tax_id:M.tax_id||"",registration_no:M.registration_no||"",fiscal_year_start_month:M.fiscal_year_start_month||1,timezone:M.timezone||"",currency_id:M.currency_id||""});try{const q=new Date().getTime(),z=await Z.get(`/admin/companies/${s}/logo?t=${q}`,{responseType:"blob"});if(z.data&&z.data.size>0){const Q=URL.createObjectURL(z.data);g(Q),console.log("Logo loaded on fetch")}}catch(q){console.log("No logo found for company:",(U=q==null?void 0:q.response)==null?void 0:U.status)}}}catch(H){l(((Y=(T=H==null?void 0:H.response)==null?void 0:T.data)==null?void 0:Y.message)||"Error fetching company")}finally{n(!1)}}async function _(){var R;try{const U=await Z.get("/finance/currencies"),T=Array.isArray((R=U.data)==null?void 0:R.items)?U.data.items:[];c(T)}catch{}}async function F(R){var U,T,Y,H,M;try{const q=new Date().getTime();console.log("Fetching logo for company:",R,"timestamp:",q);const z=await Z.get(`/admin/companies/${R}/logo?t=${q}`,{responseType:"blob"});if(console.log("Logo response:",z.status,"size:",(U=z.data)==null?void 0:U.size),z.data&&z.data.size>0){const Q=URL.createObjectURL(z.data);g(Q),console.log("Logo loaded successfully from server:",Q)}else console.warn("Logo response is empty",z.data),j("Logo uploaded but could not be retrieved")}catch(q){console.error("Failed to load logo from server:",{status:(T=q==null?void 0:q.response)==null?void 0:T.status,statusText:(Y=q==null?void 0:q.response)==null?void 0:Y.statusText,message:q==null?void 0:q.message,data:(H=q==null?void 0:q.response)==null?void 0:H.data}),((M=q==null?void 0:q.response)==null?void 0:M.status)!==404&&j("Failed to load uploaded logo")}}function I(R){var Y;const U=(Y=R.target.files)==null?void 0:Y[0];if(j(""),!U)return;if(!String(U.type).startsWith("image/")){j("Only image files are allowed");return}if(U.size>2*1024*1024){j("Image size must be less than 2MB");return}m(U);const T=URL.createObjectURL(U);g(T)}async function w(){var R,U;if(!r){j("Save company first before uploading logo");return}if(!h){j("Choose an image file to upload");return}b(!0),j("");try{console.log("Uploading logo file:",h.name,h.size);const T=new FormData;T.append("logo",h);const Y=await Z.post(`/admin/companies/${s}/logo`,T,{headers:{"Content-Type":"multipart/form-data"}});console.log("Upload response:",Y.data),m(null),await F(s)}catch(T){console.error("Upload error:",T),j(((U=(R=T==null?void 0:T.response)==null?void 0:R.data)==null?void 0:U.message)||"Failed to upload logo")}finally{b(!1)}}function E(R,U){d(T=>({...T,[R]:U}))}async function W(R){var U,T,Y;R.preventDefault(),n(!0),l("");try{const H={name:o.name,code:o.code,is_active:o.isActive?1:0,address:o.address||void 0,city:o.city||void 0,state:o.state||void 0,postal_code:o.postal_code||void 0,country:o.country||void 0,telephone:o.telephone||void 0,email:o.email||void 0,website:o.website||void 0,tax_id:o.tax_id||void 0,registration_no:o.registration_no||void 0,fiscal_year_start_month:o.fiscal_year_start_month!==void 0&&o.fiscal_year_start_month!==null?Number(o.fiscal_year_start_month):void 0,timezone:o.timezone||void 0,currency_id:o.currency_id!==""&&o.currency_id!==null?Number(o.currency_id):void 0};let M=s;if(r?await Z.put(`/admin/companies/${s}`,H):(M=(U=(await Z.post("/admin/companies",H)).data)==null?void 0:U.id,M&&await Z.put(`/admin/companies/${M}`,H)),h&&M)try{console.log("Submitting logo with company:",M);const q=new FormData;q.append("logo",h);const z=await Z.post(`/admin/companies/${M}/logo`,q,{headers:{"Content-Type":"multipart/form-data"}});console.log("Logo upload response:",z.data),m(null),await F(M)}catch(q){console.error("Logo upload during submit failed:",q)}t("/administration/companies")}catch(H){l(((Y=(T=H==null?void 0:H.response)==null?void 0:T.data)==null?void 0:Y.message)||"Error saving company")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/administration/companies",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300 mb-2 inline-block",children:" Back to Companies"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:r?"Edit Company":"New Company"}),e.jsx("p",{className:"text-sm mt-1",children:"Company profile"})]}),e.jsx("form",{onSubmit:W,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Code *"}),e.jsx("input",{className:"input",value:o.code,onChange:R=>E("code",R.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Name *"}),e.jsx("input",{className:"input",value:o.name,onChange:R=>E("name",R.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:o.isActive?"1":"0",onChange:R=>E("isActive",R.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Address"}),e.jsx("input",{className:"input",value:o.address,onChange:R=>E("address",R.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"City"}),e.jsx("input",{className:"input",value:o.city,onChange:R=>E("city",R.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"State"}),e.jsx("input",{className:"input",value:o.state,onChange:R=>E("state",R.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Postal Code"}),e.jsx("input",{className:"input",value:o.postal_code,onChange:R=>E("postal_code",R.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Country"}),e.jsx("input",{className:"input",value:o.country,onChange:R=>E("country",R.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Telephone"}),e.jsx("input",{className:"input",value:o.telephone,onChange:R=>E("telephone",R.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Email"}),e.jsx("input",{className:"input",type:"email",value:o.email,onChange:R=>E("email",R.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Website"}),e.jsx("input",{className:"input",value:o.website,onChange:R=>E("website",R.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Tax ID"}),e.jsx("input",{className:"input",value:o.tax_id,onChange:R=>E("tax_id",R.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Registration No."}),e.jsx("input",{className:"input",value:o.registration_no,onChange:R=>E("registration_no",R.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Fiscal Year Start Month"}),e.jsx("input",{className:"input",type:"number",min:"1",max:"12",value:o.fiscal_year_start_month,onChange:R=>E("fiscal_year_start_month",R.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Timezone"}),e.jsx("input",{className:"input",value:o.timezone,onChange:R=>E("timezone",R.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsxs("select",{className:"input",value:o.currency_id,onChange:R=>E("currency_id",R.target.value),children:[e.jsx("option",{value:"",children:"Select Currency"}),u.map(R=>e.jsx("option",{value:R.id,children:(R.code||R.currency_code)+" - "+(R.name||R.currency_name)},R.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Company Logo"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 border border-gray-200 rounded-lg flex items-center justify-center bg-white dark:bg-slate-800",children:p?e.jsx("img",{src:p,alt:"Logo Preview",className:"w-full h-full object-contain"}):e.jsx("span",{className:"text-sm text-slate-500",children:"No logo"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:I,className:"input"}),e.jsx("div",{className:"mt-2",children:h&&e.jsx("button",{type:"button",onClick:w,className:"btn-success",disabled:x,children:x?"Uploading...":"Upload Logo"})}),y&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:y})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/administration/companies",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",type:"submit",disabled:a,children:a?"Saving...":r?"Update":"Create"})]})]})})})]})}function KU({branches:t,companies:s,onUpdate:r}){const[a,n]=f.useState([]),[i,l]=f.useState(!0),[o,d]=f.useState(""),[u,c]=f.useState(!1),[h,m]=f.useState(null),[p,g]=f.useState({companyId:"",branchIds:[]}),[x,b]=f.useState(!1);f.useEffect(()=>{y()},[]);const y=async()=>{try{l(!0);const I=await Z.get("/admin/users");n(I.data.items||[])}catch(I){console.error("Failed to fetch users",I)}finally{l(!1)}},j=async I=>{var E;m(I);const w={companyId:I.company_id||"",branchIds:I.branch_id?[String(I.branch_id)]:[]};try{const W=await Z.get(`/admin/users/${I.id}/branches`),R=Array.isArray((E=W.data)==null?void 0:E.items)?W.data.items.map(U=>String(U.id)):[];g({...w,branchIds:R})}catch{g(w)}c(!0)},N=async I=>{if(I.preventDefault(),!!h){b(!0);try{await Z.put(`/admin/users/${h.id}/branches`,{company_id:p.companyId,branch_ids:p.branchIds.map(w=>Number(w))}),await y(),r&&r(),c(!1),m(null)}catch(w){alert("Failed to update user branch: "+w.message)}finally{b(!1)}}},_=p.companyId?t.filter(I=>String(I.company_id)===String(p.companyId)):[],F=a.filter(I=>{const w=o.toLowerCase();return I.username.toLowerCase().includes(w)||I.email.toLowerCase().includes(w)||I.full_name&&I.full_name.toLowerCase().includes(w)});return e.jsxs("div",{children:[e.jsxs("div",{className:"search-bar",children:[e.jsx("input",{type:"text",className:"search-input",placeholder:" Search users...",value:o,onChange:I=>d(I.target.value)}),e.jsx("button",{className:"btn btn-secondary",onClick:y,children:" Refresh Users"})]}),e.jsx("div",{className:"table-container",children:i?e.jsx("div",{className:"p-8 text-center",children:"Loading users..."}):e.jsxs("table",{className:"branch-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Current Company"}),e.jsx("th",{children:"Current Branch"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:F.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center py-4",children:"No users found"})}):F.map(I=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{className:"font-medium",children:I.username}),e.jsx("div",{className:"text-sm text-gray-500",children:I.email})]}),e.jsx("td",{children:I.company_name||"Unassigned"}),e.jsx("td",{children:I.branch_name||"Unassigned"}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>j(I),children:"Assign Branch"})})]},I.id))})]})}),u&&e.jsx("div",{className:"branch-modal-overlay",children:e.jsxs("div",{className:"branch-modal",style:{maxWidth:"500px"},children:[e.jsxs("div",{className:"branch-modal-header",children:[e.jsxs("h2",{children:["Assign Branch to ",h==null?void 0:h.username]}),e.jsx("button",{className:"branch-close-btn",onClick:()=>c(!1),children:""})]}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"branch-modal-body",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Company"}),e.jsxs("select",{className:"search-input w-full",value:p.companyId,onChange:I=>g({...p,companyId:I.target.value,branchId:""}),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Company --"}),s.map(I=>e.jsx("option",{value:I.id,children:I.name},I.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Branches"}),e.jsxs("div",{className:"space-y-2 max-h-64 overflow-auto border rounded-md p-2",children:[_.map(I=>{const w=p.branchIds.includes(String(I.id));return e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:w,onChange:E=>{const W=E.target.checked;g(R=>{const U=new Set(R.branchIds);return W?U.add(String(I.id)):U.delete(String(I.id)),{...R,branchIds:Array.from(U)}})},disabled:!p.companyId}),e.jsx("span",{className:"text-sm",children:I.name})]},I.id)}),p.companyId?null:e.jsx("div",{className:"text-xs text-gray-500",children:"Select a company to view branches"})]})]})]}),e.jsxs("div",{className:"branch-modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>c(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-success",disabled:x,children:x?"Saving...":"Save Assignment"})]})]})]})})]})}function zU(){const[t,s]=f.useState("branches"),[r,a]=f.useState([]),[n,i]=f.useState([]),[l,o]=f.useState(!0),[d,u]=f.useState(null),[c,h]=f.useState(!1),[m,p]=f.useState(null),[g,x]=f.useState(!1),[b,y]=f.useState(""),[j,N]=f.useState({companyId:"",name:"",code:"",isActive:!0,address:"",city:"",state:"",postal_code:"",country:"",location:"",telephone:"",email:"",remarks:""}),_={totalBranches:r.length,activeBranches:r.filter(R=>R.is_active).length,assignments:0};f.useEffect(()=>{F()},[]);const F=async()=>{try{o(!0);const[R,U]=await Promise.all([Z.get("/admin/branches"),Z.get("/admin/companies")]);a(R.data.items||[]),i(U.data.items||[])}catch(R){u(R.message||"Failed to fetch data")}finally{o(!1)}},I=async()=>{try{const R=await Z.get("/admin/branches");a(R.data.items||[])}catch(R){console.error("Failed to refresh branches",R)}},w=(R=null)=>{p(R),N(R?{companyId:R.company_id,name:R.name,code:R.code,isActive:R.is_active,address:R.address||"",city:R.city||"",state:R.state||"",postal_code:R.postal_code||"",country:R.country||"",location:R.location||"",telephone:R.telephone||"",email:R.email||"",remarks:R.remarks||""}:{companyId:"",name:"",code:"",isActive:!0,address:"",city:"",state:"",postal_code:"",country:"",location:"",telephone:"",email:"",remarks:""}),y(""),h(!0)},E=()=>{h(!1),p(null),y("")},W=async R=>{var U,T;R.preventDefault(),x(!0),y("");try{m?await Z.put(`/admin/branches/${m.id}`,{company_id:j.companyId,name:j.name,code:j.code,is_active:j.isActive,address:j.address||null,city:j.city||null,state:j.state||null,postal_code:j.postal_code||null,country:j.country||null,location:j.location||null,telephone:j.telephone||null,email:j.email||null,remarks:j.remarks||null}):await Z.post("/admin/branches",{company_id:j.companyId,name:j.name,code:j.code,is_active:j.isActive,address:j.address||null,city:j.city||null,state:j.state||null,postal_code:j.postal_code||null,country:j.country||null,location:j.location||null,telephone:j.telephone||null,email:j.email||null,remarks:j.remarks||null}),await I(),E()}catch(Y){y(((T=(U=Y==null?void 0:Y.response)==null?void 0:U.data)==null?void 0:T.message)||Y.message||"Failed to save branch")}finally{x(!1)}};return e.jsxs("div",{className:"branch-setup-container",children:[e.jsxs("div",{className:"branch-header",children:[e.jsx("div",{children:e.jsx("h1",{children:" Branch Management System"})}),e.jsxs("div",{className:"header-actions",children:[e.jsx(Re,{to:"/administration",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>window.location.reload(),children:" Refresh"})]})]}),e.jsxs("div",{className:"branch-content",children:[e.jsxs("div",{className:"branch-stats",children:[e.jsxs("div",{className:"branch-stat-card",children:[e.jsx("h3",{children:"Total Branches"}),e.jsx("div",{className:"value",children:_.totalBranches})]}),e.jsxs("div",{className:"branch-stat-card",children:[e.jsx("h3",{children:"Active Branches"}),e.jsx("div",{className:"value",children:_.activeBranches})]}),e.jsxs("div",{className:"branch-stat-card",children:[e.jsx("h3",{children:"Assignments"}),e.jsx("div",{className:"value",children:_.assignments})]})]}),e.jsxs("div",{className:"branch-tabs",children:[e.jsx("button",{className:`branch-tab ${t==="users"?"active":""}`,onClick:()=>s("users"),children:" User Branch Assignment"}),e.jsx("button",{className:`branch-tab ${t==="branches"?"active":""}`,onClick:()=>s("branches"),children:" Branch Management"}),e.jsx("button",{className:`branch-tab ${t==="history"?"active":""}`,onClick:()=>s("history"),children:" Assignment History"})]}),e.jsxs("div",{className:`tab-content ${t==="branches"?"active":""}`,children:[e.jsxs("div",{className:"search-bar",children:[e.jsx("input",{type:"text",className:"search-input",placeholder:" Search branches..."}),e.jsx("button",{className:"btn btn-success",onClick:()=>w(null),children:" Add New Branch"})]}),e.jsx("div",{className:"table-container",children:l?e.jsx("div",{className:"p-8 text-center",children:"Loading..."}):d?e.jsx("div",{className:"p-8 text-center text-red-500",children:d}):e.jsxs("table",{className:"branch-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-4 text-gray-500",children:"No branches found"})}):r.map(R=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:R.code}),e.jsx("td",{children:R.name}),e.jsx("td",{children:R.company_name||"N/A"}),e.jsx("td",{children:R.is_active?e.jsx("span",{className:"branch-badge branch-badge-success",children:"Active"}):e.jsx("span",{className:"branch-badge branch-badge-danger",children:"Inactive"})}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-secondary",onClick:()=>w(R),children:"Edit"})})]},R.id))})]})})]}),e.jsx("div",{className:`tab-content ${t==="users"?"active":""}`,children:e.jsx(KU,{branches:r,companies:n,onUpdate:F})}),e.jsx("div",{className:`tab-content ${t==="history"?"active":""}`,children:e.jsx("div",{className:"p-8 text-center text-gray-500",children:e.jsx("p",{children:"History log coming soon."})})})]}),c&&e.jsx("div",{className:"branch-modal-overlay",children:e.jsxs("div",{className:"branch-modal",children:[e.jsxs("div",{className:"branch-modal-header",children:[e.jsx("h2",{children:m?"Edit Branch":"New Branch"}),e.jsx("button",{className:"branch-close-btn",onClick:E,children:""})]}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{className:"branch-modal-body",children:[b&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:b}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Company *"}),e.jsxs("select",{className:"search-input w-full",value:j.companyId,onChange:R=>N({...j,companyId:R.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Company --"}),n.map(R=>e.jsxs("option",{value:R.id,children:[R.name," (",R.code,")"]},R.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Code *"}),e.jsx("input",{type:"text",className:"search-input w-full",value:j.code,onChange:R=>N({...j,code:R.target.value}),required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Name *"}),e.jsx("input",{type:"text",className:"search-input w-full",value:j.name,onChange:R=>N({...j,name:R.target.value}),required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Status"}),e.jsxs("select",{className:"search-input w-full",value:j.isActive?"1":"0",onChange:R=>N({...j,isActive:R.target.value==="1"}),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Address"}),e.jsx("input",{type:"text",className:"search-input w-full",value:j.address,onChange:R=>N({...j,address:R.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Location"}),e.jsx("input",{type:"text",className:"search-input w-full",value:j.location,onChange:R=>N({...j,location:R.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"City"}),e.jsx("input",{type:"text",className:"search-input w-full",value:j.city,onChange:R=>N({...j,city:R.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"State"}),e.jsx("input",{type:"text",className:"search-input w-full",value:j.state,onChange:R=>N({...j,state:R.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Postal Code"}),e.jsx("input",{type:"text",className:"search-input w-full",value:j.postal_code,onChange:R=>N({...j,postal_code:R.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Country"}),e.jsx("input",{type:"text",className:"search-input w-full",value:j.country,onChange:R=>N({...j,country:R.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Telephone"}),e.jsx("input",{type:"text",className:"search-input w-full",value:j.telephone,onChange:R=>N({...j,telephone:R.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Email"}),e.jsx("input",{type:"email",className:"search-input w-full",value:j.email,onChange:R=>N({...j,email:R.target.value})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Remarks"}),e.jsx("textarea",{className:"search-input w-full",rows:"3",value:j.remarks,onChange:R=>N({...j,remarks:R.target.value})})]})]})]}),e.jsxs("div",{className:"branch-modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:E,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-success",disabled:g,children:g?"Saving...":"Save Branch"})]})]})]})})]})}function N_(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState(""),[o,d]=f.useState({company_id:1,code:"",name:"",isActive:!0,address:"",city:"",state:"",postal_code:"",country:"",location:"",telephone:"",email:"",remarks:""});f.useEffect(()=>{r&&u()},[s]);async function u(){var m,p,g;try{n(!0),l("");const x=await Z.get(`/admin/branches/${s}`);if((m=x.data)!=null&&m.item){const b=x.data.item;d({company_id:b.company_id,code:b.code,name:b.name,isActive:b.is_active,address:b.address||"",city:b.city||"",state:b.state||"",postal_code:b.postal_code||"",country:b.country||"",location:b.location||"",telephone:b.telephone||"",email:b.email||"",remarks:b.remarks||""})}}catch(x){l(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Error fetching branch")}finally{n(!1)}}function c(m,p){d(g=>({...g,[m]:p}))}async function h(m){var p,g;m.preventDefault(),n(!0),l("");try{const x={company_id:o.company_id,name:o.name,code:o.code,is_active:o.isActive,address:o.address||null,city:o.city||null,state:o.state||null,postal_code:o.postal_code||null,country:o.country||null,location:o.location||null,telephone:o.telephone||null,email:o.email||null,remarks:o.remarks||null};r?await Z.put(`/admin/branches/${s}`,x):await Z.post("/admin/branches",x),t("/administration/branches")}catch(x){l(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Error saving branch")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-6 [&::-webkit-scrollbar]:hidden",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/administration/branches",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300 mb-2 inline-block",children:" Back to Branches"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:r?"Edit Branch":"New Branch"}),e.jsx("p",{className:"text-sm mt-1",children:"Branch profile"})]}),e.jsx("form",{onSubmit:h,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Company ID"}),e.jsx("input",{className:"input",type:"number",value:o.company_id,onChange:m=>c("company_id",parseInt(m.target.value)||1),disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Code *"}),e.jsx("input",{className:"input",value:o.code,onChange:m=>c("code",m.target.value),required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Name *"}),e.jsx("input",{className:"input",value:o.name,onChange:m=>c("name",m.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:o.isActive?"1":"0",onChange:m=>c("isActive",m.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Address"}),e.jsx("input",{className:"input",value:o.address,onChange:m=>c("address",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Location"}),e.jsx("input",{className:"input",value:o.location,onChange:m=>c("location",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"City"}),e.jsx("input",{className:"input",value:o.city,onChange:m=>c("city",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"State"}),e.jsx("input",{className:"input",value:o.state,onChange:m=>c("state",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Postal Code"}),e.jsx("input",{className:"input",value:o.postal_code,onChange:m=>c("postal_code",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Country"}),e.jsx("input",{className:"input",value:o.country,onChange:m=>c("country",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Telephone"}),e.jsx("input",{className:"input",value:o.telephone,onChange:m=>c("telephone",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Email"}),e.jsx("input",{className:"input",type:"email",value:o.email,onChange:m=>c("email",m.target.value)})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Remarks"}),e.jsx("textarea",{className:"input",rows:"3",value:o.remarks,onChange:m=>c("remarks",m.target.value)})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/administration/branches",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",type:"submit",disabled:a,children:a?"Saving...":r?"Update":"Create"})]})]})})})]})}function YU(){const t=[{title:"User Login Activity",description:"Track user logins by date, user, and IP",path:"/administration/reports/user-login-activity",action:"Open Report"},{title:"System Log Book",description:"Application events and audit activity",path:"/administration/reports/system-log-book",action:"Open Report"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/administration",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300 mb-2 inline-block",children:" Back to Administration"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Administration Reports"}),e.jsx("p",{className:"text-sm mt-1",children:"System monitoring and audit reporting"})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map(s=>e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100",children:s.title}),e.jsx("div",{className:"text-sm mt-1",children:s.description})]}),e.jsx("div",{className:"mt-4",children:e.jsx(Re,{to:s.path,className:"btn-success",children:s.action})})]},s.path))})})})]})}function XU(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1),[d,u]=f.useState(!1),[c,h]=f.useState({startedAt:"",uptimeSeconds:0,uptimeHuman:"",database:{threadsConnected:0,threadsRunning:0,maxConnections:0,loadPercent:0},recentLogins:[]});async function m(){var p,g,x;try{o(!0);const b=await Z.get("/admin/reports/system-log-book",{params:{from:t||null,to:r||null}});i(((p=b.data)==null?void 0:p.items)||[])}catch(b){ct.error(((x=(g=b==null?void 0:b.response)==null?void 0:g.data)==null?void 0:x.message)||"Failed to load report")}finally{o(!1)}}return f.useEffect(()=>{m()},[]),f.useEffect(()=>{let p=!1,g=null;async function x(){var b,y,j,N;try{u(!0);const _=await Z.get("/admin/system-status");if(p)return;const F=_.data||{};h({startedAt:String(F.startedAt||""),uptimeSeconds:Number(F.uptimeSeconds||0),uptimeHuman:String(F.uptimeHuman||""),database:{threadsConnected:Number(((b=F==null?void 0:F.database)==null?void 0:b.threadsConnected)||0),threadsRunning:Number(((y=F==null?void 0:F.database)==null?void 0:y.threadsRunning)||0),maxConnections:Number(((j=F==null?void 0:F.database)==null?void 0:j.maxConnections)||0),loadPercent:Number(((N=F==null?void 0:F.database)==null?void 0:N.loadPercent)||0)},recentLogins:Array.isArray(F.recentLogins)?F.recentLogins:[]})}catch{}finally{u(!1)}}return x(),g=setInterval(x,15e3),()=>{p=!0,g&&clearInterval(g)}},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"System Log Book"}),e.jsx("p",{className:"text-sm mt-1",children:"Application events and user activity across modules"})]}),e.jsx(Re,{to:"/administration",className:"btn btn-secondary",children:"Return to Menu"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:"System Status"}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Started ",c.startedAt?new Date(c.startedAt).toLocaleString():"-"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm",children:"Server Uptime"}),e.jsx("div",{className:"text-xl font-bold text-brand-700",children:d?"":c.uptimeHuman||"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-white dark:bg-slate-800",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Database Load"}),e.jsx("div",{className:"text-2xl font-bold text-brand-700",children:d?"":`${Number(c.database.loadPercent||0)}%`}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Connected: ",c.database.threadsConnected," / Max: ",c.database.maxConnections]})]}),e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-white dark:bg-slate-800",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Threads Running"}),e.jsx("div",{className:"text-2xl font-bold text-brand-700",children:d?"":Number(c.database.threadsRunning||0)})]}),e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-white dark:bg-slate-800",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Recent Login"}),e.jsxs("div",{className:"text-sm mt-1 space-y-1",children:[d&&e.jsx("div",{children:"Loading"}),!d&&(c.recentLogins.slice(0,5).map(p=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:p.username||"-"}),e.jsx("span",{className:"text-xs text-slate-500",children:p.login_time?new Date(p.login_time).toLocaleString():"-"})]},p.id))||e.jsx("div",{className:"text-xs text-slate-500",children:"No recent logins"}))]})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:p=>s(p.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:p=>a(p.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:m,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date/Time"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"Module"}),e.jsx("th",{children:"Action"}),e.jsx("th",{children:"Reference"}),e.jsx("th",{children:"Message"})]})}),e.jsx("tbody",{children:n.map(p=>e.jsxs("tr",{children:[e.jsx("td",{children:p.event_time?new Date(p.event_time).toLocaleString():"-"}),e.jsx("td",{children:p.user_name||"-"}),e.jsx("td",{children:p.module_name||"-"}),e.jsx("td",{children:p.action||"-"}),e.jsx("td",{className:"font-medium",children:p.ref_no||"-"}),e.jsx("td",{children:p.message||"-"})]},p.id))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function JU(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState(""),[l,o]=f.useState([]),[d,u]=f.useState(!1);async function c(){var h,m,p;try{u(!0);const g=await Z.get("/admin/reports/user-login-activity",{params:{from:t||null,to:r||null,q:n||null}});o(((h=g.data)==null?void 0:h.items)||[])}catch(g){ct.error(((p=(m=g==null?void 0:g.response)==null?void 0:m.data)==null?void 0:p.message)||"Failed to load report")}finally{u(!1)}}return f.useEffect(()=>{c()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"User Login Activity"}),e.jsx("p",{className:"text-sm mt-1",children:"User login events across companies and branches"})]}),e.jsx(Re,{to:"/administration",className:"btn btn-secondary",children:"Return to Menu"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:h=>s(h.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:h=>a(h.target.value)})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Search"}),e.jsx("input",{className:"input",type:"text",placeholder:"Username, name, email, or IP",value:n,onChange:h=>i(h.target.value)})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:c,disabled:d,children:d?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a(""),i("")},disabled:d,children:"Clear"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date/Time"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"Full Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Roles"}),e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Branch"}),e.jsx("th",{children:"IP Address"}),e.jsx("th",{children:"User Agent"})]})}),e.jsx("tbody",{children:l.map(h=>e.jsxs("tr",{children:[e.jsx("td",{children:h.login_time?new Date(h.login_time).toLocaleString():"-"}),e.jsx("td",{children:h.username||"-"}),e.jsx("td",{children:h.full_name||"-"}),e.jsx("td",{children:h.email||"-"}),e.jsx("td",{children:h.roles||"-"}),e.jsx("td",{children:h.company_name||"-"}),e.jsx("td",{children:h.branch_name||"-"}),e.jsx("td",{children:h.ip_address||"-"}),e.jsx("td",{className:"max-w-xs truncate",title:h.user_agent||"",children:h.user_agent||"-"})]},h.id))})]})}),l.length===0&&!d?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function ZU(){const[t,s]=f.useState(()=>{try{const x=localStorage.getItem("push_enabled");return x===null?!0:String(x)==="1"}catch{return!0}}),[r,a]=f.useState(()=>{try{if(typeof window<"u"&&"Notification"in window)return String(window.Notification.permission||"default")}catch{}return"default"}),[n,i]=f.useState({name:"",address:"",city:"",state:"",postalCode:"",country:"",phone:"",email:"",website:"",taxId:"",registrationNo:"",logoUrl:"",logoVersion:0}),[l,o]=f.useState(""),[d,u]=f.useState(""),c=f.useRef(null);function h(x){try{const b=c.current;b&&b!==x&&URL.revokeObjectURL(b)}catch{}c.current=x||null,u(String(x||""))}f.useEffect(()=>{try{typeof window<"u"&&"Notification"in window&&a(String(window.Notification.permission||"default"))}catch{}},[]),f.useEffect(()=>{try{localStorage.setItem("push_enabled",t?"1":"0")}catch{}},[t]);async function m(){try{if(typeof window>"u"||!("Notification"in window))return;const x=await window.Notification.requestPermission();a(String(x||"default")),ct[x==="granted"?"success":"info"](x==="granted"?"Notifications enabled":"Notifications permission denied or dismissed")}catch{}}async function p(){var x;try{let b=function(w){const E="=".repeat((4-w.length%4)%4),W=(w+E).replace(/-/g,"+").replace(/_/g,"/"),R=window.atob(W),U=new Uint8Array(R.length);for(let T=0;T<R.length;++T)U[T]=R.charCodeAt(T);return U};if(typeof window>"u"||!("serviceWorker"in navigator)||!("PushManager"in window)||!("Notification"in window))return;if(window.Notification.permission!=="granted"){ct.info("Grant notification permission first");return}const y=await navigator.serviceWorker.ready,j=await Z.get("/push/public-key"),N=String(((x=j.data)==null?void 0:x.publicKey)||"");if(!N){ct.error("Missing VAPID public key");return}const _=b(N),F=await y.pushManager.getSubscription();if(F&&F.endpoint){await Z.post("/push/subscribe",{subscription:F.toJSON()}),ct.success("Push subscription saved");return}const I=await y.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:_});await Z.post("/push/subscribe",{subscription:I.toJSON()}),ct.success("Subscribed to push notifications")}catch{ct.error("Failed to subscribe")}}async function g(){try{if(typeof window>"u"||!("serviceWorker"in navigator))return;const b=await(await navigator.serviceWorker.ready).pushManager.getSubscription();if(b&&b.endpoint){try{await Z.delete("/push/unsubscribe",{data:{subscription:b.toJSON()}})}catch{}try{await b.unsubscribe()}catch{}ct.success("Unsubscribed")}else ct.info("No active subscription")}catch{ct.error("Failed to unsubscribe")}}return f.useEffect(()=>{let x=!0;async function b(){var y,j,N;try{const F=(j=(y=(await Z.get("/admin/me")).data)==null?void 0:y.scope)==null?void 0:j.companyId;if(!F)return;const w=((N=(await Z.get(`/admin/companies/${F}`)).data)==null?void 0:N.item)||{};let E=w.has_logo===1||w.has_logo===!0?`/api/admin/companies/${F}/logo`:"";if(!x)return;i({name:w.name||"",address:w.address||"",city:w.city||"",state:w.state||"",postalCode:w.postal_code||"",country:w.country||"",phone:w.telephone||"",email:w.email||"",website:w.website||"",taxId:w.tax_id||"",registrationNo:w.registration_no||"",logoUrl:E,logoVersion:Date.now()})}catch{}}return b(),()=>{x=!1}},[]),f.useEffect(()=>{function x(b){const y=(b==null?void 0:b.detail)||{};i(j=>({...j,...y,logoVersion:y.logoVersion||Date.now()}));try{y.logoDataUrl&&o(String(y.logoDataUrl)),y.logoObjectUrl&&h(String(y.logoObjectUrl))}catch{}}return window.addEventListener("company_info_updated",x),()=>window.removeEventListener("company_info_updated",x)},[]),f.useEffect(()=>{let x=!0;async function b(){try{const y=String(n.logoUrl||"").trim();if(!y){o(""),h("");return}const j=n.logoVersion||Date.now(),N=`${y}${y.includes("?")?"&":"?"}v=${encodeURIComponent(String(j))}`,_=await fetch(N,{credentials:"include"});if(!_.ok){o(""),h("");return}const F=await _.blob();if(!x)return;const I=URL.createObjectURL(F);h(I),o("")}catch{o(""),h("")}}return b(),()=>{x=!1}},[n.logoUrl,n.logoVersion]),f.useEffect(()=>()=>{try{const x=c.current;x&&URL.revokeObjectURL(x)}catch{}},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:"Push Notifications"}),e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:["Permission: ",r]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("span",{className:"text-sm",children:"Enabled"}),e.jsx("input",{type:"checkbox",className:"toggle",checked:t,onChange:x=>s(x.target.checked)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:m,children:"Request Permission"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:p,disabled:!t,children:"Subscribe Now"}),e.jsx("button",{type:"button",className:"btn-outline",onClick:g,children:"Unsubscribe"})]}),e.jsx("div",{className:"text-xs text-slate-500",children:"When enabled, the app registers for push after login and delivers background alerts."})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Administration Settings"}),e.jsx("p",{className:"text-sm mt-1",children:"Notifications and document setup"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(Re,{to:"/administration",className:"btn btn-secondary",children:"Return to Menu"})})]})})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-3",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Document Templates"}),e.jsx("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Manage print and PDF templates for Sales Order, Invoice, and more."}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsx(Re,{to:"/administration/settings/templates?type=sales-order",className:"btn-outline",children:"Sales Order"}),e.jsx(Re,{to:"/administration/settings/templates?type=invoice",className:"btn-outline",children:"Invoice"}),e.jsx(Re,{to:"/administration/settings/templates?type=delivery-note",className:"btn-outline",children:"Delivery Note"}),e.jsx(Re,{to:"/administration/settings/templates?type=payment-voucher",className:"btn-outline",children:"Payment Voucher"}),e.jsx(Re,{to:"/administration/settings/templates?type=salary-slip",className:"btn-outline",children:"Salary Slip"}),e.jsx(Re,{to:"/administration/settings/templates?type=receipt-voucher",className:"btn-outline",children:"Receipt Voucher"}),e.jsx(Re,{to:"/administration/settings/templates?type=quotation",className:"btn-outline",children:"Quotation"})]})]})})]})}function C5({open:t,onClose:s,html:r,downloading:a=!1,onDownload:n}){const i=f.useRef(null);return f.useEffect(()=>{if(t)try{const l=i.current;l&&l.contentWindow&&l.contentWindow.focus()}catch{}},[t,r]),t?e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow max-w-5xl w-full",children:[e.jsxs("div",{className:"px-5 py-4 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Print Preview"}),e.jsx("button",{className:"btn-outline",onClick:s,children:""})]}),e.jsx("div",{className:"p-0",children:e.jsx("iframe",{ref:i,title:"preview",srcDoc:String(r||""),className:"w-full h-[70vh]"})}),e.jsxs("div",{className:"px-5 py-4 border-t flex justify-end gap-2",children:[e.jsx("button",{className:"btn-outline",onClick:()=>{try{const l=i.current;l&&l.contentWindow&&l.contentWindow.print()}catch{}},children:"Print"}),e.jsx("button",{className:"btn-success",disabled:a,onClick:n,children:a?"Downloading...":"Download PDF"})]})]})}):null}const eb=[{value:"sales-order",label:"Sales Order"},{value:"invoice",label:"Invoice"},{value:"quotation",label:"Quotation"},{value:"delivery-note",label:"Delivery Note"},{value:"salary-slip",label:"Salary Slip"},{value:"payment-voucher",label:"Payment Voucher"},{value:"receipt-voucher",label:"Receipt Voucher"}];function eR(){const[t]=Vf(),s=f.useMemo(()=>{const H=String(t.get("type")||"").trim(),M=eb.find(q=>q.value===H);return M?M.value:eb[0].value},[t]),[r,a]=f.useState(s),[n,i]=f.useState([]),[l,o]=f.useState(!1),[d,u]=f.useState(""),[c,h]=f.useState(null),[m,p]=f.useState({name:"",html_content:"",is_default:!1,header_logo_url:"",header_name:"",header_address:"",header_address2:"",header_phone:"",header_email:"",header_website:""}),[g,x]=f.useState(!1),[b,y]=f.useState(""),[j,N]=f.useState(""),[_,F]=f.useState(!1);f.useEffect(()=>{I()},[r]);async function I(){var H,M,q;try{o(!0),u("");const z=await Z.get(`/templates/${r}`),Q=Array.isArray((H=z.data)==null?void 0:H.items)?z.data.items:[];i(Q)}catch(z){u(((q=(M=z==null?void 0:z.response)==null?void 0:M.data)==null?void 0:q.message)||"Failed to load templates")}finally{o(!1)}}function w(){h(null),p({name:"",html_content:"",is_default:!1,header_logo_url:"",header_name:"",header_address:"",header_address2:"",header_phone:"",header_email:"",header_website:""})}function E(H){h(H),p({name:String(H.name||""),html_content:"",is_default:Number(H.is_default)===1,header_logo_url:"",header_name:"",header_address:"",header_address2:"",header_phone:"",header_email:"",header_website:""}),Z.get(`/templates/item/${H.id}`).then(M=>{var z;const q=((z=M.data)==null?void 0:z.item)||{};p(Q=>({...Q,html_content:String(q.html_content||""),header_logo_url:String(q.header_logo_url||""),header_name:String(q.header_name||""),header_address:String(q.header_address||""),header_address2:String(q.header_address2||""),header_phone:String(q.header_phone||""),header_email:String(q.header_email||""),header_website:String(q.header_website||"")}))}).catch(()=>{})}async function W(){var H,M;try{const q=String(m.name||"").trim(),z=String(m.html_content||"").trim();if(!q||!z){ct.info("Enter name and HTML content");return}if(c)await Z.put(`/templates/${c.id}`,{name:q,html_content:z,is_default:m.is_default?1:0,header_logo_url:m.header_logo_url||"",header_name:m.header_name||"",header_address:m.header_address||"",header_address2:m.header_address2||"",header_phone:m.header_phone||"",header_email:m.header_email||"",header_website:m.header_website||""}),ct.success("Template updated");else{const Q=await Z.post("/templates",{name:q,document_type:r,html_content:z,is_default:m.is_default?1:0,header_logo_url:m.header_logo_url||"",header_name:m.header_name||"",header_address:m.header_address||"",header_address2:m.header_address2||"",header_phone:m.header_phone||"",header_email:m.header_email||"",header_website:m.header_website||""});ct.success("Template created")}await I(),w()}catch(q){ct.error(((M=(H=q==null?void 0:q.response)==null?void 0:H.data)==null?void 0:M.message)||"Failed to save")}}async function R(H){var M,q;try{await Z.put(`/templates/${H.id}`,{name:H.name,html_content:H.html_content||"",is_default:1}),ct.success("Default set"),await I()}catch(z){ct.error(((q=(M=z==null?void 0:z.response)==null?void 0:M.data)==null?void 0:q.message)||"Failed to set default")}}async function U(H){var M,q;try{await Z.delete(`/templates/${H.id}`),ct.success("Template deleted"),await I()}catch(z){ct.error(((q=(M=z==null?void 0:z.response)==null?void 0:M.data)==null?void 0:q.message)||"Failed to delete")}}async function T(H){var M,q;try{const z=Number(j),Q=!Number.isFinite(z)||z<=0?await Z.post(`/documents/${r}/preview`,{format:"html"}):await Z.post(`/documents/${r}/${z}/render`,{format:"html"});y(String(Q.data||"")),x(!0)}catch(z){ct.error(((q=(M=z==null?void 0:z.response)==null?void 0:M.data)==null?void 0:q.message)||"Failed to render")}}async function Y(){var H,M;try{F(!0);const q=Number(j),z=!Number.isFinite(q)||q<=0?`/documents/${r}/preview?format=pdf`:`/documents/${r}/${q}/render?format=pdf`,L=(await Z.post(z,{},{responseType:"blob"})).data,V=URL.createObjectURL(L),P=document.createElement("a");P.href=V,P.download=`${r}-${Number.isFinite(q)&&q>0?q:"preview"}.pdf`,P.click(),URL.revokeObjectURL(V)}catch(q){ct.error(((M=(H=q==null?void 0:q.response)==null?void 0:H.data)==null?void 0:M.message)||"Failed to download")}finally{F(!1)}}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/administration/settings",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300 mb-2 inline-block",children:" Back to Settings"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Document Templates"}),e.jsx("p",{className:"text-sm mt-1",children:"Create, edit, preview, and set default templates"})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"label",children:"Document Type"}),e.jsx("select",{className:"input w-64",value:r,onChange:H=>a(H.target.value),children:eb.map(H=>e.jsx("option",{value:H.value,children:H.label},H.value))}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsx("input",{type:"number",className:"input w-40",placeholder:"Sample ID",value:j,onChange:H=>N(H.target.value)}),e.jsx("button",{className:"btn-outline",disabled:l,onClick:()=>I(),children:"Refresh"}),e.jsx("button",{className:"btn-success",onClick:w,children:"+ New Template"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[d?e.jsx("div",{className:"text-sm text-red-600 mb-3",children:d}):null,e.jsx("div",{className:"overflow-auto border rounded",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"text-black",children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-black",children:"Name"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-black",children:"Default"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-semibold text-black",children:"Actions"})]})}),e.jsxs("tbody",{children:[n.map(H=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-3 py-2 text-sm",children:H.name}),e.jsx("td",{className:"px-3 py-2 text-sm",children:Number(H.is_default)===1?"Yes":"No"}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"btn-outline",onClick:()=>E(H),children:"Edit"}),e.jsx("button",{className:"btn-outline",onClick:()=>T(),children:"Preview"}),Number(H.is_default)!==1?e.jsx("button",{className:"btn-primary",onClick:()=>R(H),children:"Set Default"}):null,Number(H.is_default)!==1?e.jsx("button",{className:"btn-danger",onClick:()=>U(H),children:"Delete"}):null]})})]},H.id)),n.length?null:e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-3 text-sm text-slate-500",colSpan:3,children:"No templates for this type"})})]})]})})]}),e.jsx("div",{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Name"}),e.jsx("input",{className:"input",value:m.name,onChange:H=>p(M=>({...M,name:H.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Header Company Name"}),e.jsx("input",{className:"input",value:m.header_name,onChange:H=>p(M=>({...M,header_name:H.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Header Phone"}),e.jsx("input",{className:"input",value:m.header_phone,onChange:H=>p(M=>({...M,header_phone:H.target.value}))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Header Address"}),e.jsx("input",{className:"input",value:m.header_address,onChange:H=>p(M=>({...M,header_address:H.target.value}))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Header Address 2"}),e.jsx("input",{className:"input",value:m.header_address2,onChange:H=>p(M=>({...M,header_address2:H.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Header Email"}),e.jsx("input",{className:"input",value:m.header_email,onChange:H=>p(M=>({...M,header_email:H.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Header Website"}),e.jsx("input",{className:"input",value:m.header_website,onChange:H=>p(M=>({...M,header_website:H.target.value}))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Header Logo URL"}),e.jsx("input",{className:"input",placeholder:"/api/admin/companies/{id}/logo",value:m.header_logo_url,onChange:H=>p(M=>({...M,header_logo_url:H.target.value}))}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Omit to use the company logo automatically"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"HTML Content"}),e.jsx("textarea",{className:"input min-h-[280px]",value:m.html_content,onChange:H=>p(M=>({...M,html_content:H.target.value}))}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Use placeholders like ","{{company.name}}"," and loops like"," ","{{#each sales_order.items}}"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"default",type:"checkbox",className:"w-4 h-4",checked:m.is_default,onChange:H=>p(M=>({...M,is_default:H.target.checked}))}),e.jsx("label",{htmlFor:"default",className:"label",children:"Set as default"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-primary",onClick:W,children:"Save"}),e.jsx("button",{className:"btn-outline",onClick:w,children:"Reset"}),e.jsx("button",{className:"btn-secondary",onClick:()=>{const H=tR(r);p(M=>({...M,html_content:H}))},children:"Use Sample Layout"})]})]})})]})]})}),e.jsx(C5,{open:g,onClose:()=>x(!1),html:b,downloading:_,onDownload:Y})]})}function tR(t){const s=`
<style>
  :root {
    --brand: #0E3646;
    --brand-50: #f0f7fa;
    --brand-700: #215876;
    --text: #1f2937;
    --muted: #6b7280;
    --border: #e5e7eb;
  }
  body { font-family: Arial, sans-serif; color: var(--text); }
  .doc {
    width: 19cm; margin: 0 auto; padding: 12px;
    border: 1px solid var(--border); border-radius: 6px;
  }
  .header {
    display: grid; grid-template-columns: 100px 1fr; gap: 12px;
    align-items: center; margin-bottom: 8px;
  }
  .logo { height: 80px; object-fit: contain; }
  .company {
    font-size: 12px; line-height: 1.3; text-align: right;
  }
  .company .name { font-weight: 700; font-size: 16px; color: var(--brand); }
  .meta { color: var(--muted); }
  .titlebar { display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 8px; margin: 6px 0 10px 0; }
  .line { border-top: 2px solid var(--text); height: 0; }
  .title { font-weight: 700; color: var(--brand); text-align: center; }
  .info {
    display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 8px 0 12px 0;
  }
  .info .card {
    border: 1px solid var(--border); border-radius: 6px; padding: 8px;
  }
  .kv { font-size: 12px; line-height: 1.5; }
  .kv .row { display: grid; grid-template-columns: 130px 1fr; gap: 6px; }
  .kv .label { font-weight: 600; color: #000; }
  table { width: 100%; border-collapse: collapse; font-size: 12px; }
  thead th {
    background: var(--brand-50); color: var(--brand);
    border: 1px solid var(--border); padding: 6px; text-align: left;
  }
  tbody td { border: 1px solid var(--border); padding: 6px; }
  td.num { text-align: right; }
  .totals {
    display: grid; grid-template-columns: 1fr 220px; gap: 12px; margin-top: 10px;
  }
  .totals .box { border: 1px solid var(--border); border-radius: 6px; padding: 8px; }
  .footer {
    margin-top: 18px; font-size: 11px; border-top: 1px solid var(--border); padding-top: 8px;
    display: grid; grid-template-columns: 1fr 1fr; gap: 16px;
  }
  .sign { height: 40px; border-bottom: 1px solid var(--border); }
</style>`;return t==="sales-order"?`
${s}
<div class="doc">
  <div class="header">
    <img class="logo" src="{{company.logo}}" alt="Logo"/>
    <div class="company">
      <div class="name">{{company.name}}</div>
      <div>{{company.address}}</div>
      <div>{{company.address2}}</div>
      <div class="meta">{{company.phone}}  {{company.email}}  {{company.website}}</div>
    </div>
  </div>
  <div class="titlebar">
    <div class="line"></div>
    <div class="title">* Sales Order *</div>
    <div class="line"></div>
  </div>
  <div class="info">
    <div class="card">
      <div class="kv">
        <div class="row"><div class="label">Customer Name:</div><div class="value">{{customer.name}}</div></div>
        <div class="row"><div class="label">Address:</div><div class="value">{{customer.address}}</div></div>
        <div class="row"><div class="label">City:</div><div class="value">{{customer.city}}</div></div>
        <div class="row"><div class="label">State:</div><div class="value">{{customer.state}}</div></div>
        <div class="row"><div class="label">Country:</div><div class="value">{{customer.country}}</div></div>
      </div>
    </div>
    <div class="card">
      <div class="kv">
        <div class="row"><div class="label">Order No.:</div><div class="value">{{sales_order.number}}</div></div>
        <div class="row"><div class="label">Order Date:</div><div class="value">{{sales_order.date}}</div></div>
      </div>
    </div>
  </div>
  <table>
    <thead>
      <tr><th>#</th><th>Code</th><th>Description</th><th>Qty</th><th>UOM</th><th>Price</th><th>Disc%</th><th>Tax</th><th>Amount</th></tr>
    </thead>
    <tbody>
      {{#each sales_order.items}}
      <tr>
        <td>{{@index}}</td><td>{{code}}</td><td>{{name}}</td><td class="num">{{quantity}}</td><td>{{uom}}</td><td class="num">{{price}}</td><td class="num">{{discount}}</td><td class="num">{{tax}}</td><td class="num">{{amount}}</td>
      </tr>
      {{/each}}
    </tbody>
  </table>
  <div class="totals">
    <div></div>
    <div class="box">
      <div>Sub Total: {{sales_order.sub_total}}</div>
      <div>Tax: {{sales_order.tax_amount}}</div>
      <div><strong>Total: {{sales_order.total}}</strong></div>
    </div>
  </div>
  <div class="footer">
    <div>
      <div>Prepared By</div>
      <div class="sign"></div>
      <div class="meta">{{prepared_by}}</div>
    </div>
    <div>
      <div>Remarks</div>
      <div class="meta">{{sales_order.remarks}}</div>
    </div>
  </div>
</div>
`:t==="invoice"?`
${s}
<div class="doc">
  <div class="header">
    <img class="logo" src="{{company.logo}}" alt="Logo"/>
    <div class="company">
      <div class="name">{{company.name}}</div>
      <div>{{company.address}}</div>
      <div>{{company.address2}}</div>
      <div class="meta">{{company.phone}}  {{company.email}}  {{company.website}}</div>
    </div>
  </div>
  <div class="titlebar">
    <div class="line"></div>
    <div class="title">* Sales Invoice *</div>
    <div class="line"></div>
  </div>
  <div class="info">
    <div class="card">
      <div class="kv">
        <div class="row"><div class="label">Customer Name:</div><div class="value">{{customer.name}}</div></div>
        <div class="row"><div class="label">Address:</div><div class="value">{{customer.address}}</div></div>
        <div class="row"><div class="label">City:</div><div class="value">{{customer.city}}</div></div>
        <div class="row"><div class="label">State:</div><div class="value">{{customer.state}}</div></div>
        <div class="row"><div class="label">Country:</div><div class="value">{{customer.country}}</div></div>
      </div>
    </div>
    <div class="card">
      <div class="kv">
        <div class="row"><div class="label">Invoice No.:</div><div class="value">{{invoice.number}}</div></div>
        <div class="row"><div class="label">Invoice Date:</div><div class="value">{{invoice.date}}</div></div>
        <div class="row"><div class="label">Payment Term:</div><div class="value">{{invoice.payment_term}}</div></div>
      </div>
    </div>
  </div>
  <table>
    <thead>
      <tr><th>#</th><th>Code</th><th>Description</th><th>Qty</th><th>UOM</th><th>Price</th><th>Disc%</th><th>Amount</th></tr>
    </thead>
    <tbody>
      {{#each invoice.items}}
      <tr>
        <td>{{@index}}</td><td>{{code}}</td><td>{{name}}</td><td class="num">{{quantity}}</td><td>{{uom}}</td><td class="num">{{price}}</td><td class="num">{{discount}}</td><td class="num">{{amount}}</td>
      </tr>
      {{/each}}
    </tbody>
  </table>
  <div class="totals">
    <div></div>
    <div class="box">
      <div>Net Total: {{invoice.net_total}}</div>
      <div><strong>Total: {{invoice.total}}</strong></div>
    </div>
  </div>
  <div class="footer">
    <div>
      <div>Prepared By</div>
      <div class="sign"></div>
      <div class="meta">{{prepared_by}}</div>
    </div>
    <div>
      <div>Remarks</div>
      <div class="meta">{{invoice.remarks}}</div>
    </div>
  </div>
</div>
`:t==="delivery-note"?`
${s}
<div class="doc">
  <div class="header">
    <img class="logo" src="{{company.logo}}" alt="Logo"/>
    <div class="company">
      <div class="name">{{company.name}}</div>
      <div>{{company.address}}</div>
      <div>{{company.address2}}</div>
      <div class="meta">{{company.phone}}  {{company.email}}  {{company.website}}</div>
    </div>
  </div>
  <div class="title">Delivery Note</div>
  <div class="info">
    <div class="card">
      <div><strong>Customer</strong></div>
      <div>{{customer.name}}</div>
      <div class="meta">{{customer.address}}</div>
    </div>
    <div class="card">
      <div><strong>Delivery Info</strong></div>
      <div>Number: {{delivery_note.number}}</div>
      <div>Date: {{delivery_note.date}}</div>
    </div>
  </div>
  <table>
    <thead>
      <tr><th>#</th><th>Code</th><th>Description</th><th>Qty</th><th>UOM</th></tr>
    </thead>
    <tbody>
      {{#each delivery_note.items}}
      <tr>
        <td>{{@index}}</td><td>{{code}}</td><td>{{name}}</td><td class="num">{{quantity}}</td><td>{{uom}}</td>
      </tr>
      {{/each}}
    </tbody>
  </table>
  <div class="footer">
    <div>
      <div>Received By</div>
      <div class="sign"></div>
    </div>
    <div>
      <div>Signature</div>
      <div class="sign"></div>
    </div>
  </div>
</div>
`:t==="payment-voucher"?`
${s}
<div class="doc">
  <div class="header">
    <img class="logo" src="{{company.logo}}" alt="Logo"/>
    <div class="company">
      <div class="name">{{company.name}}</div>
      <div>{{company.address}}</div>
      <div>{{company.address2}}</div>
      <div class="meta">{{company.phone}}  {{company.email}}  {{company.website}}</div>
    </div>
  </div>
  <div class="titlebar">
    <div class="line"></div>
    <div class="title">* Cash Payment Voucher *</div>
    <div class="line"></div>
  </div>
  <div class="info">
    <div class="card">
      <div><strong>Voucher Info</strong></div>
      <div>Number: {{payment_voucher.number}}</div>
      <div>Date: {{payment_voucher.date}}</div>
      <div class="meta">Type: {{payment_voucher.type_code}}  {{payment_voucher.type_name}}</div>
    </div>
    <div class="card">
      <div><strong>Narration</strong></div>
      <div class="meta">{{payment_voucher.narration}}</div>
    </div>
  </div>
  <table>
    <thead>
      <tr><th>#</th><th>Account Code</th><th>Account Name</th><th>Description</th><th>Debit</th><th>Credit</th><th>Ref</th></tr>
    </thead>
    <tbody>
      {{#each payment_voucher.items}}
      <tr>
        <td>{{@index}}</td><td>{{account_code}}</td><td>{{account_name}}</td><td>{{description}}</td><td class="num">{{debit}}</td><td class="num">{{credit}}</td><td>{{reference_no}}</td>
      </tr>
      {{/each}}
    </tbody>
  </table>
  <div class="totals">
    <div></div>
    <div class="box">
      <div>Total Debit: {{payment_voucher.total_debit}}</div>
      <div><strong>Total Credit: {{payment_voucher.total_credit}}</strong></div>
    </div>
  </div>
  <div class="footer">
    <div>
      <div>Prepared By</div>
      <div class="sign"></div>
    </div>
    <div>
      <div>Receiver Signature</div>
      <div class="sign"></div>
    </div>
  </div>
</div>
`:t==="quotation"?`
${s}
<div class="doc">
  <div class="header">
    <img class="logo" src="{{company.logo}}" alt="Logo"/>
    <div class="company">
      <div class="name">{{company.name}}</div>
      <div>{{company.address}}</div>
      <div>{{company.address2}}</div>
      <div class="meta">{{company.phone}}  {{company.email}}  {{company.website}}</div>
    </div>
  </div>
  <div class="titlebar">
    <div class="line"></div>
    <div class="title">* Quotation *</div>
    <div class="line"></div>
  </div>
  <div class="info">
    <div class="card">
      <div class="kv">
        <div class="row"><div class="label">Customer Name:</div><div class="value">{{customer.name}}</div></div>
        <div class="row"><div class="label">Address:</div><div class="value">{{customer.address}}</div></div>
        <div class="row"><div class="label">City:</div><div class="value">{{customer.city}}</div></div>
        <div class="row"><div class="label">State:</div><div class="value">{{customer.state}}</div></div>
        <div class="row"><div class="label">Country:</div><div class="value">{{customer.country}}</div></div>
      </div>
    </div>
    <div class="card">
      <div class="kv">
        <div class="row"><div class="label">Quotation No.:</div><div class="value">{{quotation.number}}</div></div>
        <div class="row"><div class="label">Quotation Date:</div><div class="value">{{quotation.date}}</div></div>
      </div>
    </div>
  </div>
  <table>
    <thead>
      <tr><th>#</th><th>Code</th><th>Description</th><th>Qty</th><th>UOM</th><th>Price</th><th>Disc%</th><th>Tax</th><th>Amount</th></tr>
    </thead>
    <tbody>
      {{#each quotation.items}}
      <tr>
        <td>{{@index}}</td><td>{{code}}</td><td>{{name}}</td><td class="num">{{quantity}}</td><td>{{uom}}</td><td class="num">{{price}}</td><td class="num">{{discount}}</td><td class="num">{{tax}}</td><td class="num">{{amount}}</td>
      </tr>
      {{/each}}
    </tbody>
  </table>
  <div class="totals">
    <div></div>
    <div class="box">
      <div>Sub Total: {{quotation.sub_total}}</div>
      <div>Tax: {{quotation.tax_amount}}</div>
      <div><strong>Total: {{quotation.total}}</strong></div>
    </div>
  </div>
  <div class="footer">
    <div>
      <div>Prepared By</div>
      <div class="sign"></div>
      <div class="meta">{{prepared_by}}</div>
    </div>
    <div>
      <div>Remarks</div>
      <div class="meta">{{quotation.remarks}}</div>
    </div>
  </div>
</div>
`:t==="receipt-voucher"?`
${s}
<div class="doc">
  <div class="header">
    <img class="logo" src="{{company.logo}}" alt="Logo"/>
    <div class="company">
      <div class="name">{{company.name}}</div>
      <div>{{company.address}}</div>
      <div>{{company.address2}}</div>
      <div class="meta">{{company.phone}}  {{company.email}}  {{company.website}}</div>
    </div>
  </div>
  <div class="titlebar">
    <div class="line"></div>
    <div class="title">* Receipt Voucher *</div>
    <div class="line"></div>
  </div>
  <div class="info">
    <div class="card">
      <div><strong>Voucher Info</strong></div>
      <div>Number: {{receipt_voucher.number}}</div>
      <div>Date: {{receipt_voucher.date}}</div>
      <div class="meta">Type: {{receipt_voucher.type_code}}  {{receipt_voucher.type_name}}</div>
    </div>
    <div class="card">
      <div><strong>Narration</strong></div>
      <div class="meta">{{receipt_voucher.narration}}</div>
    </div>
  </div>
  <table>
    <thead>
      <tr><th>#</th><th>Account Code</th><th>Account Name</th><th>Description</th><th>Debit</th><th>Credit</th><th>Ref</th></tr>
    </thead>
    <tbody>
      {{#each receipt_voucher.items}}
      <tr>
        <td>{{@index}}</td><td>{{account_code}}</td><td>{{account_name}}</td><td>{{description}}</td><td class="num">{{debit}}</td><td class="num">{{credit}}</td><td>{{reference_no}}</td>
      </tr>
      {{/each}}
    </tbody>
  </table>
  <div class="totals">
    <div></div>
    <div class="box">
      <div>Total Debit: {{receipt_voucher.total_debit}}</div>
      <div><strong>Total Credit: {{receipt_voucher.total_credit}}</strong></div>
    </div>
  </div>
  <div class="footer">
    <div>
      <div>Prepared By</div>
      <div class="sign"></div>
    </div>
    <div>
      <div>Receiver Signature</div>
      <div class="sign"></div>
    </div>
  </div>
</div>
`:"<div>Define your template here</div>"}function sR(){const t=ps(),{refreshPermissions:s}=Ls(),[r,a]=f.useState([]),[n,i]=f.useState(!0),[l,o]=f.useState(""),[d,u]=f.useState(""),[c,h]=f.useState(!1),[m,p]=f.useState({name:"",code:"",is_active:!0}),[g,x]=f.useState(null),[b,y]=f.useState({name:"",code:"",is_active:!0}),[j,N]=f.useState(new Set),[_,F]=f.useState(new Set),[I,w]=f.useState(new Set);function E(q,z){z&&!j.has(q)&&Y(q,!0);const Q=Uv(q),L=Rv(q);F(V=>{const P=new Set(V);for(const C of Q)z?P.add(C.feature_key):P.delete(C.feature_key);return P}),w(V=>{const P=new Set(V);for(const C of L)z?P.add(C.feature_key):P.delete(C.feature_key);return P})}async function W(){var q,z,Q;i(!0),o("");try{const L=await Z.get("/access/roles");a(((q=L==null?void 0:L.data)==null?void 0:q.items)||[])}catch(L){o(((Q=(z=L==null?void 0:L.response)==null?void 0:z.data)==null?void 0:Q.message)||"Failed to load")}finally{i(!1)}}f.useEffect(()=>{W()},[]);async function R(){var q,z;try{const Q={name:String(m.name||"").trim(),code:String(m.code||"").trim(),is_active:!!m.is_active};if(!Q.name||!Q.code){o("Name and code are required");return}await Z.post("/access/roles",Q),h(!1),p({name:"",code:"",is_active:!0}),u("Role created successfully"),await W(),setTimeout(()=>u(""),2e3)}catch(Q){o(((z=(q=Q==null?void 0:Q.response)==null?void 0:q.data)==null?void 0:z.message)||"Failed to create role")}}async function U(q){var z,Q,L,V;try{const[P,C]=await Promise.all([Z.get(`/access/roles/${q.id}/modules`),Z.get(`/access/roles/${q.id}/features`).catch(()=>({data:{features:[]}}))]),k=new Set(((z=P==null?void 0:P.data)==null?void 0:z.modules)||[]),B=new Set((((Q=C==null?void 0:C.data)==null?void 0:Q.features)||[]).map(String)),G=new Set,O=new Set;B.forEach(K=>{const[J,te]=K.split(":"),se=Bn[J];se&&(se.dashboards.some(ne=>ne.key===te)?G.add(K):O.add(K))}),x(q),y({name:q.name||"",code:q.code||"",is_active:!!q.is_active}),N(k),F(O),w(G)}catch(P){o(((V=(L=P==null?void 0:P.response)==null?void 0:L.data)==null?void 0:V.message)||"Failed to load role settings")}}async function T(){var q,z;try{if(o(""),g){const L={name:String(b.name||"").trim(),code:String(b.code||"").trim(),is_active:!!b.is_active};if(!L.name||!L.code){o("Name and code are required");return}await Z.put(`/access/roles/${g.id}`,L),x(V=>V&&{...V,...L})}await Z.put(`/access/roles/${g.id}/modules`,{modules:Array.from(j)});const Q=[...Array.from(_),...Array.from(I)];await Z.put(`/access/roles/${g.id}/features`,{features:Q}),u("Role permissions updated successfully");try{window.dispatchEvent(new Event("rbac:changed"))}catch{}try{await s()}catch{}await W();try{const L=g?{...g,name:String(b.name||"").trim(),code:String(b.code||"").trim(),is_active:!!b.is_active}:null;L&&await U(L)}catch{}setTimeout(()=>u(""),2e3)}catch(Q){o(((z=(q=Q==null?void 0:Q.response)==null?void 0:q.data)==null?void 0:z.message)||"Failed to save role settings")}}function Y(q,z){N(Q=>{const L=new Set(Q);if(z)L.add(q);else{L.delete(q);const V=Uv(q),P=Rv(q);F(C=>{const k=new Set(C);return V.forEach(B=>k.delete(B.feature_key)),k}),w(C=>{const k=new Set(C);return P.forEach(B=>k.delete(B.feature_key)),k})}return L})}function H(q,z){const[Q]=q.split(":");j.has(Q)||Y(Q,!0),F(L=>{const V=new Set(L);return z?V.add(q):V.delete(q),V})}function M(q,z){const[Q]=q.split(":");j.has(Q)||Y(Q,!0),w(L=>{const V=new Set(L);return z?V.add(q):V.delete(q),V})}return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Role Management"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Create roles and assign module, feature, and dashboard permissions"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-secondary",type:"button",onClick:()=>t("/administration"),children:"Back to Menu"}),e.jsx("button",{className:"btn btn-primary",type:"button",onClick:()=>h(!0),children:"Create Role"})]})]}),l&&e.jsx("div",{className:"alert alert-error",children:l}),d&&e.jsxs("div",{className:"alert alert-success flex justify-between items-center",children:[e.jsx("span",{children:d}),e.jsx("button",{className:"btn-outline",type:"button",onClick:()=>u(""),children:""})]}),n?e.jsx("div",{children:"Loading..."}):e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"text-right",children:"Actions"})]})}),e.jsx("tbody",{children:r.map(q=>e.jsxs("tr",{children:[e.jsx("td",{children:q.name}),e.jsx("td",{children:q.code}),e.jsx("td",{children:q.is_active?"Active":"Inactive"}),e.jsx("td",{className:"text-right",children:e.jsx("div",{className:"flex gap-2 justify-end",children:e.jsx("button",{className:"btn btn-secondary",type:"button",onClick:()=>U(q),children:"Configure Permissions"})})})]},q.id))})]})})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow max-w-lg w-full",children:[e.jsxs("div",{className:"px-5 py-4 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Create Role"}),e.jsx("button",{className:"btn-outline",type:"button",onClick:()=>h(!1),children:""})]}),e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Name"}),e.jsx("input",{className:"input",value:m.name,onChange:q=>p({...m,name:q.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Code"}),e.jsx("input",{className:"input",value:m.code,onChange:q=>p({...m,code:q.target.value})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"checkbox",checked:m.is_active,onChange:q=>p({...m,is_active:q.target.checked})}),e.jsx("span",{className:"text-sm font-medium",children:"Active"})]})]}),e.jsxs("div",{className:"px-5 py-4 border-t flex justify-end gap-2",children:[e.jsx("button",{className:"btn-outline",type:"button",onClick:()=>h(!1),children:"Cancel"}),e.jsx("button",{className:"btn-success",type:"button",onClick:R,children:"Save"})]})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow max-w-6xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"px-5 py-4 border-b flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Configure Permissions"}),e.jsx("span",{className:"text-sm text-slate-500",children:b.name})]}),e.jsx("button",{className:"btn-outline",type:"button",onClick:()=>x(null),children:""})]}),e.jsxs("div",{className:"p-5 space-y-6 overflow-y-auto flex-1",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Role Name"}),e.jsx("input",{className:"input",value:b.name,onChange:q=>y(z=>({...z,name:q.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Role Code"}),e.jsx("input",{className:"input",value:b.code,onChange:q=>y(z=>({...z,code:q.target.value}))})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"checkbox",checked:b.is_active,onChange:q=>y(z=>({...z,is_active:q.target.checked}))}),e.jsx("span",{className:"text-sm font-medium",children:"Active"})]})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:""}),"Modules"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:Iw().map(q=>{const z=Bn[q];return e.jsxs("label",{className:"flex items-center gap-3 p-3 border rounded-lg hover:bg-slate-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"checkbox",checked:j.has(q),onChange:Q=>Y(q,Q.target.checked)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:z==null?void 0:z.icon}),e.jsx("span",{className:"font-medium",children:z==null?void 0:z.name})]})]},q)})})]}),e.jsx("div",{className:"space-y-6",children:Iw().map(q=>{const z=Bn[q],Q=j.has(q),L=Uv(q),V=Rv(q),P=[...L.map(B=>B.feature_key),...V.map(B=>B.feature_key)],C=P.filter(B=>_.has(B)||I.has(B)).length,k=P.length>0&&C===P.length;return!Q&&L.length===0&&V.length===0?null:e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs("div",{className:"px-4 py-3 bg-slate-50 border-b flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",className:"checkbox",checked:Q,onChange:B=>Y(q,B.target.checked)}),e.jsxs("span",{className:"font-semibold text-lg",children:[z==null?void 0:z.icon," ",z==null?void 0:z.name]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-600",children:[e.jsxs("span",{children:[L.length," features"]}),e.jsxs("span",{children:[V.length," dashboards"]}),Q&&P.length>0&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:k,onChange:B=>E(q,B.target.checked)}),"Select All"]})]})]}),Q&&e.jsxs("div",{className:"p-4 space-y-4",children:[L.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx("span",{children:""}),"Features"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:L.map(B=>e.jsxs("label",{className:"flex items-center gap-2 p-2 border rounded hover:bg-slate-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:_.has(B.feature_key),onChange:G=>H(B.feature_key,G.target.checked)}),e.jsx("span",{className:"text-sm",children:B.label})]},B.feature_key))})]}),V.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx("span",{children:""}),"Dashboards"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:V.map(B=>e.jsxs("label",{className:"flex items-center gap-2 p-2 border rounded hover:bg-slate-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:I.has(B.feature_key),onChange:G=>M(B.feature_key,G.target.checked)}),e.jsx("span",{className:"text-sm",children:B.label})]},B.feature_key))})]})]})]},q)})})]}),e.jsxs("div",{className:"px-5 py-4 border-t flex justify-end gap-2",children:[e.jsx("button",{className:"btn-outline",type:"button",onClick:()=>x(null),children:"Cancel"}),e.jsx("button",{className:"btn-success",type:"button",onClick:T,children:"Save Permissions"})]})]})})]})}function rR(){const[t,s]=f.useState([]),[r,a]=f.useState(null),[n,i]=f.useState(null),[l,o]=f.useState([]),[d,u]=f.useState({}),[c,h]=f.useState({}),[m,p]=f.useState(!1),[g,x]=f.useState("");f.useEffect(()=>{async function _(){var F,I,w;try{const E=await Z.get("/admin/users"),W=((I=(F=E==null?void 0:E.data)==null?void 0:F.data)==null?void 0:I.items)||((w=E==null?void 0:E.data)==null?void 0:w.items)||[];s(W)}catch{}}_()},[]);async function b(_){var F,I,w,E,W,R,U,T,Y;a(_),p(!0),x("");try{const H=await Z.get(`/admin/users/${_}`),M=((I=(F=H==null?void 0:H.data)==null?void 0:F.data)==null?void 0:I.item)||((w=H==null?void 0:H.data)==null?void 0:w.item)||null;i(M&&M.role?M.role:null);const q=Number((M==null?void 0:M.role_id)||((E=M==null?void 0:M.role)==null?void 0:E.id)||0);if(!q)o([]),u({});else{const V=await Z.get(`/access/roles/${q}/modules`),P=await Z.get(`/access/roles/${q}/permissions`),C=((W=V==null?void 0:V.data)==null?void 0:W.modules)||[];o(C);const k=((R=P==null?void 0:P.data)==null?void 0:R.permissions)||[],B={};for(const G of k)B[G.module_key]={can_view:!!G.can_view,can_create:!!G.can_create,can_edit:!!G.can_edit,can_delete:!!G.can_delete};u(B)}const z=await Z.get(`/access/users/${_}/overrides`),Q=((U=z==null?void 0:z.data)==null?void 0:U.overrides)||[],L={};for(const V of Q)L[V.module_key]={can_view:V.can_view,can_create:V.can_create,can_edit:V.can_edit,can_delete:V.can_delete};h(L)}catch(H){x(((Y=(T=H==null?void 0:H.response)==null?void 0:T.data)==null?void 0:Y.message)||"Failed to load")}finally{p(!1)}}function y(_){return _==null?"":_?"Yes":"No"}function j(_,F){h(I=>{const w={...I},E=w[_]||{can_view:null,can_create:null,can_edit:null,can_delete:null},W=E[F];return E[F]=W==null?!0:W?!1:null,w[_]=E,w})}async function N(){var _,F;try{const I=l.map(w=>{var E,W,R,U;return{module_key:w,can_view:((E=c[w])==null?void 0:E.can_view)??null,can_create:((W=c[w])==null?void 0:W.can_create)??null,can_edit:((R=c[w])==null?void 0:R.can_edit)??null,can_delete:((U=c[w])==null?void 0:U.can_delete)??null}});await Z.put(`/access/users/${r}/overrides`,{overrides:I}),alert("Saved")}catch(I){x(((F=(_=I==null?void 0:I.response)==null?void 0:_.data)==null?void 0:F.message)||"Failed to save")}}return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"User Overrides"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Set exceptional overrides per user"})]}),e.jsx("a",{href:"/administration",className:"btn btn-secondary",children:"Back to Menu"})]}),g&&e.jsx("div",{className:"alert alert-error",children:g}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Select User"}),e.jsxs("select",{className:"input",value:r||"",onChange:_=>b(Number(_.target.value)),children:[e.jsx("option",{value:"",children:"Choose user"}),t.map(_=>e.jsxs("option",{value:_.id,children:[_.username," (",_.email,")"]},_.id))]})]}),m?e.jsx("div",{children:"Loading..."}):r?e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Module"}),e.jsx("th",{className:"text-center w-28",children:"Role Default"}),e.jsx("th",{className:"text-center w-28",children:"Override View"}),e.jsx("th",{className:"text-center w-28",children:"Override Create"}),e.jsx("th",{className:"text-center w-28",children:"Override Edit"}),e.jsx("th",{className:"text-center w-28",children:"Override Delete"})]})}),e.jsx("tbody",{children:l.map(_=>{const F=d[_]||{},I=c[_]||{};return e.jsxs("tr",{children:[e.jsx("td",{className:"p-3 font-medium",children:_}),e.jsxs("td",{className:"p-3 text-center",children:["V ",y(F.can_view)," / C"," ",y(F.can_create)," / E"," ",y(F.can_edit)," / D"," ",y(F.can_delete)]}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("button",{className:"btn btn-xs",onClick:()=>j(_,"can_view"),children:y(I.can_view)})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("button",{className:"btn btn-xs",onClick:()=>j(_,"can_create"),children:y(I.can_create)})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("button",{className:"btn btn-xs",onClick:()=>j(_,"can_edit"),children:y(I.can_edit)})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("button",{className:"btn btn-xs",onClick:()=>j(_,"can_delete"),children:y(I.can_delete)})})]},_)})})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{className:"btn btn-success",onClick:N,children:"Save"})})]}):null]})})]})}function w_(){const t=ps(),s=Ur(),r=Ps(),{refreshPermissions:a,setGlobalOverrides:n,setActionSessionOverride:i,clearSessionOverrides:l}=Ls(),[o,d]=f.useState([]),[u,c]=f.useState(null),[h,m]=f.useState(null),[p,g]=f.useState([]),[x,b]=f.useState({}),[y,j]=f.useState({}),[N,_]=f.useState(new Map),[F,I]=f.useState(!1),[w,E]=f.useState(!1),[W,R]=f.useState(""),[U,T]=f.useState(""),[Y,H]=f.useState(new Set),[M,q]=f.useState([]),[z,Q]=f.useState([]),[L,V]=f.useState([]);f.useEffect(()=>{async function me(){var we,Ie,_e,Fe;R("");try{const Le=await Z.get("/admin/users"),rt=((Ie=(we=Le==null?void 0:Le.data)==null?void 0:we.data)==null?void 0:Ie.items)||[];d(rt)}catch(Le){R(((Fe=(_e=Le==null?void 0:Le.response)==null?void 0:_e.data)==null?void 0:Fe.message)||"Failed to load users")}}me()},[]),f.useEffect(()=>{var _e;const me=(_e=s==null?void 0:s.state)==null?void 0:_e.success;if(!!(r!=null&&r.id)||typeof me!="string"||!me.trim())return;T(me);const Ie=setTimeout(()=>T(""),2e3);try{t("/administration/access/user-permissions",{replace:!0,state:null})}catch{}return()=>clearTimeout(Ie)},[s==null?void 0:s.state,t,r==null?void 0:r.id]),f.useEffect(()=>{const me=r==null?void 0:r.id,we=Number(me||0);we&&P(we)},[r==null?void 0:r.id]);async function P(me){var we,Ie,_e,Fe,Le,rt,He,st,De,Te,Ce,Pe,fe;c(me),I(!0),R("");try{const he=await Z.get(`/admin/users/${me}`),Ue=((Ie=(we=he==null?void 0:he.data)==null?void 0:we.data)==null?void 0:Ie.item)||null,Ye=Number((Ue==null?void 0:Ue.role_id)||((_e=Ue==null?void 0:Ue.role)==null?void 0:_e.id)||0);if(m(Ye||null),Ye){const[Ke,Je,xe,ye]=await Promise.all([Z.get("/access/features"),Z.get(`/access/roles/${Ye}/features`).catch(()=>({data:{features:[]}})),Z.get(`/admin/users/${me}/feature-permissions-context`).catch(()=>({data:{items:[]}})),Z.get(`/admin/users/${me}/feature-permissions`).catch(()=>({data:{items:[]}}))]),Ae=((Fe=Ke==null?void 0:Ke.data)==null?void 0:Fe.features)||[],be=((Le=Je==null?void 0:Je.data)==null?void 0:Le.features)||[],Ee=Array.isArray((rt=xe==null?void 0:xe.data)==null?void 0:rt.items)?xe.data.items:Array.isArray((st=(He=xe==null?void 0:xe.data)==null?void 0:He.data)==null?void 0:st.items)?xe.data.data.items:[],dt=Array.isArray((De=ye==null?void 0:ye.data)==null?void 0:De.items)?ye.data.items:Array.isArray((Ce=(Te=ye==null?void 0:ye.data)==null?void 0:Te.data)==null?void 0:Ce.items)?ye.data.data.items:[],mt=new Set(be.map(String)),it=Ae.filter(at=>mt.has(String(at.feature_key))),ht=[],ft=[];it.forEach(at=>{const[je,Se]=at.feature_key.split(":"),nt=Bn[je];nt&&(nt.dashboards.some(gt=>gt.key===Se)?ft.push(at):ht.push(at))});const Rt=new Map;for(const at of Ee){const je=String(at.feature_key||"").trim();je&&Rt.set(je,{module_key:at.module_key,feature_key:je,default_can_view:!!at.default_can_view,default_can_create:!!at.default_can_create,default_can_edit:!!at.default_can_edit,default_can_delete:!!at.default_can_delete,pages:Array.isArray(at.pages)?at.pages:[],label:at.label||je,type:at.type||"feature"})}_(Rt);const Ge={};for(const at of dt){const je=String((at==null?void 0:at.feature_key)||"").trim();je&&(Ge[je]={can_view:!!(at!=null&&at.can_view),can_create:!!(at!=null&&at.can_create),can_edit:!!(at!=null&&at.can_edit),can_delete:!!(at!=null&&at.can_delete)})}j(Ge),g(Array.from(new Set(it.map(at=>at.module_key)))),q(Array.from(new Set(it.map(at=>at.module_key)))),Q(ht),V(ft),H(new Set)}else g([]),b({}),j({}),_(new Map),Q([]),V([]),q([]),H(new Set)}catch(he){R(((fe=(Pe=he==null?void 0:he.response)==null?void 0:Pe.data)==null?void 0:fe.message)||"Failed to load user context")}finally{I(!1)}}function C(){c(null),m(null),g([]),b({}),j({}),_(new Map),Q([]),V([]),q([]),H(new Set)}function k(me,we,Ie){j(_e=>{const Fe={..._e};return Fe[me]||(Fe[me]={can_view:null,can_create:null,can_edit:null,can_delete:null}),Fe[me]={...Fe[me],[we]:Ie},we!=="can_view"&&Ie===!0&&(Fe[me].can_view=!0),we==="can_view"&&Ie===!1&&(Fe[me].can_create=!1,Fe[me].can_edit=!1,Fe[me].can_delete=!1),Fe});try{i(me,we,Ie),we==="can_view"&&Ie===!1&&(i(me,"can_create",!1),i(me,"can_edit",!1),i(me,"can_delete",!1)),we!=="can_view"&&Ie===!0&&i(me,"can_view",!0)}catch{}}async function B(){var me,we,Ie,_e,Fe;try{if(!u)throw new Error("Select a user first");E(!0),R("");const Le=new Set(L.map(st=>String(st.feature_key))),rt=[];for(const[st,De]of Object.entries(y||{})){const Te=String(st||"").trim();if(!Te)continue;const Ce=De||{};if(!(typeof Ce.can_view=="boolean"||typeof Ce.can_create=="boolean"||typeof Ce.can_edit=="boolean"||typeof Ce.can_delete=="boolean"))continue;const fe=N.get(Te)||{},he=Array.isArray(fe==null?void 0:fe.pages)?fe.pages:[];if(!he.length)continue;const Ue=Le.has(Te)||String((fe==null?void 0:fe.type)||"").toLowerCase()==="dashboard",Ye=ae(Te,"can_view"),Ke=Ue?!1:ae(Te,"can_create"),Je=Ue?!1:ae(Te,"can_edit"),xe=Ue?!1:ae(Te,"can_delete");for(const ye of he)rt.push({page_id:Number(ye.page_id||ye.id||0),can_view:Ye,can_create:Ke,can_edit:Je,can_delete:xe})}await Z.post(`/admin/users/${u}/feature-permissions`,{permissions:rt});try{const st=await Z.get(`/admin/users/${u}/feature-permissions`),De=Array.isArray((we=(me=st==null?void 0:st.data)==null?void 0:me.data)==null?void 0:we.items)?st.data.data.items:Array.isArray((Ie=st==null?void 0:st.data)==null?void 0:Ie.items)?st.data.items:[],Te={};for(const Ce of De){const Pe=String((Ce==null?void 0:Ce.feature_key)||"").trim();Pe&&(Te[Pe]={can_view:!!(Ce!=null&&Ce.can_view),can_create:!!(Ce!=null&&Ce.can_create),can_edit:!!(Ce!=null&&Ce.can_edit),can_delete:!!(Ce!=null&&Ce.can_delete)})}j(Te)}catch{}try{window.dispatchEvent(new Event("rbac:changed"))}catch{}try{await a()}catch{}const He="Permissions saved successfully";try{l()}catch{}C(),t("/administration/access/user-permissions",{state:{success:He}})}catch(Le){R(((Fe=(_e=Le==null?void 0:Le.response)==null?void 0:_e.data)==null?void 0:Fe.message)||"Failed to save permissions")}finally{E(!1)}}function G(me,we){H(Ie=>{const _e=new Set(Ie);return we?_e.add(me):_e.delete(me),_e})}const O=z.filter(me=>Y.size===0?!0:Y.has(me.module_key)),K=L.filter(me=>Y.size===0?!0:Y.has(me.module_key)),J=O.map(me=>String(me.feature_key)),te=K.map(me=>String(me.feature_key)),se=J.concat(te);function ae(me,we){const Ie=y[String(me)]||{};return typeof Ie[we]=="boolean"?Ie[we]:!1}const ne=se.length>0&&se.every(me=>ae(me,"can_view")),ue=J.length>0&&J.every(me=>ae(me,"can_create")),oe=J.length>0&&J.every(me=>ae(me,"can_edit")),le=J.length>0&&J.every(me=>ae(me,"can_delete"));function X(me,we,Ie){j(_e=>{const Fe={..._e};for(const Le of me){const rt=String(Le||"").trim();if(!rt)continue;const He=Fe[rt]||{};Fe[rt]={can_view:He.can_view??null,can_create:He.can_create??null,can_edit:He.can_edit??null,can_delete:He.can_delete??null,[we]:Ie},we!=="can_view"&&Ie===!0&&(Fe[rt].can_view=!0),we==="can_view"&&Ie===!1&&(Fe[rt].can_create=!1,Fe[rt].can_edit=!1,Fe[rt].can_delete=!1)}return Fe});try{for(const _e of me){const Fe=String(_e||"").trim();Fe&&(i(Fe,we,Ie),we!=="can_view"&&Ie===!0&&i(Fe,"can_view",!0),we==="can_view"&&Ie===!1&&(i(Fe,"can_create",!1),i(Fe,"can_edit",!1),i(Fe,"can_delete",!1)))}}catch{}}return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"User Permissions"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Set module actions for selected users role; features follow module access"})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 px-3 py-2 border rounded",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:ne,disabled:w,onChange:me=>{X(se,"can_view",me.target.checked);try{n(we=>({...we,view:me.target.checked}))}catch{}}}),e.jsx("span",{children:"All View"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:ue,disabled:w,onChange:me=>{X(J,"can_create",me.target.checked);try{n(we=>({...we,create:me.target.checked}))}catch{}}}),e.jsx("span",{children:"All Create"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:oe,disabled:w,onChange:me=>{X(J,"can_edit",me.target.checked);try{n(we=>({...we,edit:me.target.checked}))}catch{}}}),e.jsx("span",{children:"All Edit"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:le,disabled:w,onChange:me=>{X(J,"can_delete",me.target.checked);try{n(we=>({...we,delete:me.target.checked}))}catch{}}}),e.jsx("span",{children:"All Delete"})]})]}),e.jsx("button",{className:"btn btn-secondary",disabled:w,onClick:()=>{j(me=>{const we={...me};for(const Ie of O)we[Ie.feature_key]={can_view:!0,can_create:!0,can_edit:!0,can_delete:!0};for(const Ie of K)we[Ie.feature_key]={can_view:!0,can_create:!1,can_edit:!1,can_delete:!1};return we})},children:"Grant All Visible"}),e.jsx("button",{className:"btn btn-success",onClick:B,disabled:w,children:w?"Saving...":"Save Permissions"}),e.jsx("button",{className:"btn btn-secondary",disabled:w,onClick:()=>{C(),t("/administration/access/user-permissions")},children:"Back to List"})]}):e.jsx("button",{className:"btn btn-secondary",onClick:()=>t("/administration"),children:"Back to Menu"})})]}),W&&e.jsx("div",{className:"alert alert-error",children:W}),U&&e.jsxs("div",{className:"alert alert-success flex justify-between items-center",children:[e.jsx("span",{children:U}),e.jsx("button",{className:"btn-outline",onClick:()=>T(""),children:""})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body space-y-6",children:u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Select User"}),e.jsxs("select",{className:"input",value:u||"",disabled:w,onChange:me=>{const we=Number(me.target.value||0);if(!we){C(),t("/administration/access/user-permissions");return}t(`/administration/access/user-permissions/${we}`)},children:[e.jsx("option",{value:"",children:"Choose user"}),o.map(me=>e.jsxs("option",{value:me.id,children:[me.username," (",me.email,")"]},me.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Assigned Role"}),e.jsx("div",{className:"p-3 border rounded bg-slate-50 dark:bg-slate-800",children:h?`Role #${h}`:"No role assigned"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Role Modules"}),e.jsx("div",{className:"p-3 border rounded bg-slate-50 dark:bg-slate-800",children:p.length>0?p.join(", "):"None"})]})]}),M.length>0&&e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:""}),"Filter by Module"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:M.map(me=>{const we=Bn[me];return e.jsxs("label",{className:"flex items-center gap-2 p-3 border rounded-lg hover:bg-slate-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"checkbox",checked:Y.has(me),disabled:w,onChange:Ie=>G(me,Ie.target.checked)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:we==null?void 0:we.icon}),e.jsx("span",{className:"font-medium",children:we==null?void 0:we.name})]})]},me)})})]}),O.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:""}),"Features (",O.length,")"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Feature"}),e.jsx("th",{children:"Module"}),e.jsx("th",{children:"Type"}),e.jsx("th",{className:"text-center w-24",children:"View"}),e.jsx("th",{className:"text-center w-24",children:"Create"}),e.jsx("th",{className:"text-center w-24",children:"Edit"}),e.jsx("th",{className:"text-center w-24",children:"Delete"})]})}),e.jsx("tbody",{children:O.map(me=>(Bn[me.module_key],N.get(String(me.feature_key)),y[me.feature_key],e.jsxs("tr",{children:[e.jsx("td",{className:"p-3 font-medium",children:me.label}),e.jsx("td",{className:"p-3",children:me.module_key}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${me.type==="dashboard"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:me.type})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:ae(me.feature_key,"can_view"),disabled:w,onChange:we=>k(me.feature_key,"can_view",we.target.checked)})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:ae(me.feature_key,"can_create"),disabled:w,onChange:we=>k(me.feature_key,"can_create",we.target.checked)})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:ae(me.feature_key,"can_edit"),disabled:w,onChange:we=>k(me.feature_key,"can_edit",we.target.checked)})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:ae(me.feature_key,"can_delete"),disabled:w,onChange:we=>k(me.feature_key,"can_delete",we.target.checked)})})]},me.feature_key)))})]})})]}),K.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:""}),"Dashboards (",K.length,")"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Dashboard"}),e.jsx("th",{children:"Module"}),e.jsx("th",{className:"text-center w-24",children:"View"})]})}),e.jsx("tbody",{children:K.map(me=>(N.get(String(me.feature_key)),y[me.feature_key],e.jsxs("tr",{children:[e.jsx("td",{className:"p-3 font-medium",children:me.label}),e.jsx("td",{className:"p-3",children:me.module_key}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:ae(me.feature_key,"can_view"),disabled:w,onChange:we=>k(me.feature_key,"can_view",we.target.checked)})})]},me.feature_key)))})]})})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Users"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Select a user to manage permissions"})]}),F?e.jsx("div",{className:"text-center py-8",children:"Loading users..."}):o.length===0?e.jsx("div",{className:"alert alert-warning",children:"No users found. Create a user in Administration  User Management."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Username"}),e.jsx("th",{children:"Email"}),e.jsx("th",{className:"w-32",children:"Action"})]})}),e.jsx("tbody",{children:o.map(me=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:me.username}),e.jsx("td",{children:me.email}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>t(`/administration/access/user-permissions/${me.id}`),children:"Manage"})})]},me.id))})]})})]})})})]})}function aR(){const[t,s]=Is.useState([{rbac_key:"total-users",value:"120",label:"Total Users",change:" 5 this month",changeType:"positive",path:"/administration/users"},{rbac_key:"active-sessions",value:"15",label:"Active Sessions",change:"Current",changeType:"neutral",path:"/administration/reports"},{rbac_key:"pending-workflows",value:"5",label:"Pending Workflows",change:"Requires approval",changeType:"neutral",path:"/administration/workflows"}]),r=[{label:"Settings",path:"/administration/settings",icon:""}];Is.useEffect(()=>{let n=!0;async function i(){var l,o,d,u,c,h,m,p,g;try{const x=await Z.get("/bi/dashboards"),b=Number(((d=(o=(l=x==null?void 0:x.data)==null?void 0:l.summary)==null?void 0:o.administration)==null?void 0:d.users)||0),y=Number(((h=(c=(u=x==null?void 0:x.data)==null?void 0:u.summary)==null?void 0:c.administration)==null?void 0:h.active_sessions)||0),j=Number(((g=(p=(m=x==null?void 0:x.data)==null?void 0:m.summary)==null?void 0:p.administration)==null?void 0:g.pending_workflows)||0);n&&s(N=>{const _=[...N];return _[0]={..._[0],value:String(b)},_[1]={..._[1],value:String(y)},_[2]={..._[2],value:String(j)},_})}catch{}}return i(),()=>{n=!1}},[]);const a=[{title:"System Configuration",badge:"Core",items:[{title:"Company Setup",description:"Manage company information and settings",path:"/administration/companies",icon:"",hidden:!1,actions:[{label:"Manage",path:"/administration/companies",type:"primary"}]},{title:"Branch Setup",description:"Configure and manage company branches",path:"/administration/branches",icon:"",actions:[{label:"View List",path:"/administration/branches",type:"outline"},{label:"Add Branch",path:"/administration/branches/new",type:"primary"}]},{title:"Settings",description:"Push notifications and document templates",path:"/administration/settings",icon:"",actions:[{label:"Open",path:"/administration/settings",type:"primary"}]}]},{title:"User Management",badge:"Access Control",items:[{title:"Role Setup",description:"Create roles and assign modules, features, and dashboards",module_key:"administration",feature_key:"roles",path:"/administration/access/roles",icon:"",actions:[{label:"Open",module_key:"administration",feature_key:"roles",path:"/administration/access/roles",type:"primary"}]},{title:"User Permissions",description:"Set granular CRUD permissions for individual users",module_key:"administration",feature_key:"user-permissions",path:"/administration/access/user-permissions",icon:"",actions:[{label:"Open",module_key:"administration",feature_key:"user-permissions",path:"/administration/access/user-permissions",type:"primary"}]},{title:"Dashboard Permissions",description:"Grant and override access for dashboards",module_key:"administration",feature_key:"user-permissions",path:"/administration/access/dashboard-permissions",icon:"",actions:[{label:"Open",module_key:"administration",feature_key:"user-permissions",path:"/administration/access/dashboard-permissions",type:"primary"}]},{title:"Exceptional Permissions",description:"Set exceptional permissions and overrides per user",module_key:"administration",feature_key:"user-overrides",path:"/administration/access/user-overrides",icon:"",actions:[{label:"Open",module_key:"administration",feature_key:"user-overrides",path:"/administration/access/user-overrides",type:"primary"}]},{title:"User Management",description:"Create and manage user accounts with detailed permissions",path:"/administration/users",icon:"",actions:[{label:"View Users",path:"/administration/users",type:"outline"},{label:"Add User",path:"/administration/users/new",type:"primary"}]}]},{title:"Process & Reporting",items:[{title:"Workflow Configuration",description:"Define and configure approval workflows for documents",path:"/administration/workflows",icon:"",actions:[{label:"Configure",path:"/administration/workflows",type:"primary"}]},{title:"Workflow Approvals",description:"Approve pending documents",path:"/administration/workflows/approvals",icon:""},{title:"Document Review",description:"Review documents awaiting action",path:"/administration/workflows/approvals",icon:""},{title:"Reports",description:"View user activity, audit logs, and system reports",path:"/administration/reports",icon:"",actions:[{label:"View Logs",path:"/administration/reports",type:"primary"},{label:"System Log Book",path:"/administration/reports/system-log-book",type:"outline"},{label:"User Login Activity",path:"/administration/reports/user-login-activity",type:"outline"}]},{title:"System Log Book Report",description:"Audit logs and system activity",path:"/administration/reports/system-log-book",icon:""},{title:"User Login Activity Report",description:"Recent user sign-ins and sessions",path:"/administration/reports/user-login-activity",icon:""}]}];return e.jsx(lo,{title:"Administration",description:"System configuration and user management",stats:t,quickActions:r,sections:a,features:iR})}function nR(){return e.jsxs(hl,{children:[e.jsx(tt,{path:"/",element:e.jsx(aR,{})}),e.jsx(tt,{path:"/users",element:e.jsx(OU,{})}),e.jsx(tt,{path:"/users/new",element:e.jsx(v_,{})}),e.jsx(tt,{path:"/users/:id",element:e.jsx(v_,{})}),e.jsx(tt,{path:"/workflows",element:e.jsx(MU,{})}),e.jsx(tt,{path:"/workflows/new",element:e.jsx(y_,{})}),e.jsx(tt,{path:"/workflows/:id",element:e.jsx(y_,{})}),e.jsx(tt,{path:"/workflows/approvals",element:e.jsx($U,{})}),e.jsx(tt,{path:"/workflows/approved",element:e.jsx(VU,{})}),e.jsx(tt,{path:"/workflows/approvals/:instanceId",element:e.jsx(WU,{})}),e.jsx(tt,{path:"/companies",element:e.jsx(GU,{})}),e.jsx(tt,{path:"/companies/new",element:e.jsx(j_,{})}),e.jsx(tt,{path:"/companies/:id",element:e.jsx(j_,{})}),e.jsx(tt,{path:"/branches",element:e.jsx(zU,{})}),e.jsx(tt,{path:"/branches/new",element:e.jsx(N_,{})}),e.jsx(tt,{path:"/branches/:id",element:e.jsx(N_,{})}),e.jsx(tt,{path:"/reports",element:e.jsx(YU,{})}),e.jsx(tt,{path:"/reports/system-log-book",element:e.jsx(XU,{})}),e.jsx(tt,{path:"/reports/user-login-activity",element:e.jsx(JU,{})}),e.jsx(tt,{path:"/settings",element:e.jsx(ZU,{})}),e.jsx(tt,{path:"/settings/templates",element:e.jsx(eR,{})}),e.jsx(tt,{path:"/access/roles",element:e.jsx(sR,{})}),e.jsx(tt,{path:"/access/user-permissions",element:e.jsx(w_,{})}),e.jsx(tt,{path:"/access/user-permissions/:id",element:e.jsx(w_,{})}),e.jsx(tt,{path:"/access/user-overrides",element:e.jsx(rR,{})})]})}const iR=[{module_key:"administration",label:"Role Setup",path:"/administration/access/roles",type:"feature"},{module_key:"administration",label:"User Permissions",path:"/administration/access/user-permissions",type:"feature"},{module_key:"administration",label:"Exceptional Permissions",path:"/administration/access/user-overrides",type:"feature"},{module_key:"administration",label:"User Management",path:"/administration/users",type:"feature"},{module_key:"administration",label:"Settings",path:"/administration/settings",type:"feature"},{module_key:"administration",label:"Company Setup",path:"/administration/companies",type:"feature"},{module_key:"administration",label:"Branch Setup",path:"/administration/branches",type:"feature"},{module_key:"administration",label:"Workflow Configuration",path:"/administration/workflows",type:"feature"},{module_key:"administration",label:"Workflow Approvals",path:"/administration/workflows/approvals",type:"feature"},{module_key:"administration",label:"Document Review",path:"/administration/workflows/approvals",type:"feature"},{module_key:"administration",label:"System Log Book Report",path:"/administration/reports/system-log-book",type:"dashboard"},{module_key:"administration",label:"User Login Activity Report",path:"/administration/reports/user-login-activity",type:"dashboard"},{module_key:"administration",label:"Reports",path:"/administration/reports",type:"dashboard"}],lR="modulepreload",oR=function(t){return"/"+t},__={},Ey=function(s,r,a){let n=Promise.resolve();if(r&&r.length>0){let l=function(u){return Promise.all(u.map(c=>Promise.resolve(c).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),d=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=l(r.map(u=>{if(u=oR(u),u in __)return;__[u]=!0;const c=u.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const m=document.createElement("link");if(m.rel=c?"stylesheet":lR,c||(m.as="script"),m.crossOrigin="",m.href=u,d&&m.setAttribute("nonce",d),document.head.appendChild(m),c)return new Promise((p,g)=>{m.addEventListener("load",p),m.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(l){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=l,window.dispatchEvent(o),!o.defaultPrevented)throw l}return n.then(l=>{for(const o of l||[])o.status==="rejected"&&i(o.reason);return s().catch(i)})};function Wr(t){"@babel/helpers - typeof";return Wr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},Wr(t)}var yi=Uint8Array,Bl=Uint16Array,zj=Int32Array,pg=new yi([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),xg=new yi([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),By=new yi([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),k5=function(t,s){for(var r=new Bl(31),a=0;a<31;++a)r[a]=s+=1<<t[a-1];for(var n=new zj(r[30]),a=1;a<30;++a)for(var i=r[a];i<r[a+1];++i)n[i]=i-r[a]<<5|a;return{b:r,r:n}},E5=k5(pg,2),B5=E5.b,Fy=E5.r;B5[28]=258,Fy[258]=28;var F5=k5(xg,0),cR=F5.b,S_=F5.r,Ty=new Bl(32768);for(var ua=0;ua<32768;++ua){var nu=(ua&43690)>>1|(ua&21845)<<1;nu=(nu&52428)>>2|(nu&13107)<<2,nu=(nu&61680)>>4|(nu&3855)<<4,Ty[ua]=((nu&65280)>>8|(nu&255)<<8)>>1}var _c=(function(t,s,r){for(var a=t.length,n=0,i=new Bl(s);n<a;++n)t[n]&&++i[t[n]-1];var l=new Bl(s);for(n=1;n<s;++n)l[n]=l[n-1]+i[n-1]<<1;var o;if(r){o=new Bl(1<<s);var d=15-s;for(n=0;n<a;++n)if(t[n])for(var u=n<<4|t[n],c=s-t[n],h=l[t[n]-1]++<<c,m=h|(1<<c)-1;h<=m;++h)o[Ty[h]>>d]=u}else for(o=new Bl(a),n=0;n<a;++n)t[n]&&(o[n]=Ty[l[t[n]-1]++]>>15-t[n]);return o}),Su=new yi(288);for(var ua=0;ua<144;++ua)Su[ua]=8;for(var ua=144;ua<256;++ua)Su[ua]=9;for(var ua=256;ua<280;++ua)Su[ua]=7;for(var ua=280;ua<288;++ua)Su[ua]=8;var Sf=new yi(32);for(var ua=0;ua<32;++ua)Sf[ua]=5;var dR=_c(Su,9,0),uR=_c(Su,9,1),mR=_c(Sf,5,0),hR=_c(Sf,5,1),tb=function(t){for(var s=t[0],r=1;r<t.length;++r)t[r]>s&&(s=t[r]);return s},Po=function(t,s,r){var a=s/8|0;return(t[a]|t[a+1]<<8)>>(s&7)&r},sb=function(t,s){var r=s/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(s&7)},Yj=function(t){return(t+7)/8|0},T5=function(t,s,r){return(r==null||r>t.length)&&(r=t.length),new yi(t.subarray(s,r))},AR=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Mo=function(t,s,r){var a=new Error(s||AR[t]);if(a.code=t,Error.captureStackTrace&&Error.captureStackTrace(a,Mo),!r)throw a;return a},fR=function(t,s,r,a){var n=t.length,i=0;if(!n||s.f&&!s.l)return r||new yi(0);var l=!r,o=l||s.i!=2,d=s.i;l&&(r=new yi(n*3));var u=function(ae){var ne=r.length;if(ae>ne){var ue=new yi(Math.max(ne*2,ae));ue.set(r),r=ue}},c=s.f||0,h=s.p||0,m=s.b||0,p=s.l,g=s.d,x=s.m,b=s.n,y=n*8;do{if(!p){c=Po(t,h,1);var j=Po(t,h+1,3);if(h+=3,j)if(j==1)p=uR,g=hR,x=9,b=5;else if(j==2){var I=Po(t,h,31)+257,w=Po(t,h+10,15)+4,E=I+Po(t,h+5,31)+1;h+=14;for(var W=new yi(E),R=new yi(19),U=0;U<w;++U)R[By[U]]=Po(t,h+U*3,7);h+=w*3;for(var T=tb(R),Y=(1<<T)-1,H=_c(R,T,1),U=0;U<E;){var M=H[Po(t,h,Y)];h+=M&15;var N=M>>4;if(N<16)W[U++]=N;else{var q=0,z=0;for(N==16?(z=3+Po(t,h,3),h+=2,q=W[U-1]):N==17?(z=3+Po(t,h,7),h+=3):N==18&&(z=11+Po(t,h,127),h+=7);z--;)W[U++]=q}}var Q=W.subarray(0,I),L=W.subarray(I);x=tb(Q),b=tb(L),p=_c(Q,x,1),g=_c(L,b,1)}else Mo(1);else{var N=Yj(h)+4,_=t[N-4]|t[N-3]<<8,F=N+_;if(F>n){d&&Mo(0);break}o&&u(m+_),r.set(t.subarray(N,F),m),s.b=m+=_,s.p=h=F*8,s.f=c;continue}if(h>y){d&&Mo(0);break}}o&&u(m+131072);for(var V=(1<<x)-1,P=(1<<b)-1,C=h;;C=h){var q=p[sb(t,h)&V],k=q>>4;if(h+=q&15,h>y){d&&Mo(0);break}if(q||Mo(2),k<256)r[m++]=k;else if(k==256){C=h,p=null;break}else{var B=k-254;if(k>264){var U=k-257,G=pg[U];B=Po(t,h,(1<<G)-1)+B5[U],h+=G}var O=g[sb(t,h)&P],K=O>>4;O||Mo(3),h+=O&15;var L=cR[K];if(K>3){var G=xg[K];L+=sb(t,h)&(1<<G)-1,h+=G}if(h>y){d&&Mo(0);break}o&&u(m+131072);var J=m+B;if(m<L){var te=i-L,se=Math.min(L,J);for(te+m<0&&Mo(3);m<se;++m)r[m]=a[te+m]}for(;m<J;++m)r[m]=r[m-L]}}s.l=p,s.p=C,s.b=m,s.f=c,p&&(c=1,s.m=x,s.d=g,s.n=b)}while(!c);return m!=r.length&&l?T5(r,0,m):r.subarray(0,m)},ad=function(t,s,r){r<<=s&7;var a=s/8|0;t[a]|=r,t[a+1]|=r>>8},FA=function(t,s,r){r<<=s&7;var a=s/8|0;t[a]|=r,t[a+1]|=r>>8,t[a+2]|=r>>16},rb=function(t,s){for(var r=[],a=0;a<t.length;++a)t[a]&&r.push({s:a,f:t[a]});var n=r.length,i=r.slice();if(!n)return{t:L5,l:0};if(n==1){var l=new yi(r[0].s+1);return l[r[0].s]=1,{t:l,l:1}}r.sort(function(F,I){return F.f-I.f}),r.push({s:-1,f:25001});var o=r[0],d=r[1],u=0,c=1,h=2;for(r[0]={s:-1,f:o.f+d.f,l:o,r:d};c!=n-1;)o=r[r[u].f<r[h].f?u++:h++],d=r[u!=c&&r[u].f<r[h].f?u++:h++],r[c++]={s:-1,f:o.f+d.f,l:o,r:d};for(var m=i[0].s,a=1;a<n;++a)i[a].s>m&&(m=i[a].s);var p=new Bl(m+1),g=Iy(r[c-1],p,0);if(g>s){var a=0,x=0,b=g-s,y=1<<b;for(i.sort(function(I,w){return p[w.s]-p[I.s]||I.f-w.f});a<n;++a){var j=i[a].s;if(p[j]>s)x+=y-(1<<g-p[j]),p[j]=s;else break}for(x>>=b;x>0;){var N=i[a].s;p[N]<s?x-=1<<s-p[N]++-1:++a}for(;a>=0&&x;--a){var _=i[a].s;p[_]==s&&(--p[_],++x)}g=s}return{t:new yi(p),l:g}},Iy=function(t,s,r){return t.s==-1?Math.max(Iy(t.l,s,r+1),Iy(t.r,s,r+1)):s[t.s]=r},C_=function(t){for(var s=t.length;s&&!t[--s];);for(var r=new Bl(++s),a=0,n=t[0],i=1,l=function(d){r[a++]=d},o=1;o<=s;++o)if(t[o]==n&&o!=s)++i;else{if(!n&&i>2){for(;i>138;i-=138)l(32754);i>2&&(l(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(l(n),--i;i>6;i-=6)l(8304);i>2&&(l(i-3<<5|8208),i=0)}for(;i--;)l(n);i=1,n=t[o]}return{c:r.subarray(0,a),n:s}},TA=function(t,s){for(var r=0,a=0;a<s.length;++a)r+=t[a]*s[a];return r},I5=function(t,s,r){var a=r.length,n=Yj(s+2);t[n]=a&255,t[n+1]=a>>8,t[n+2]=t[n]^255,t[n+3]=t[n+1]^255;for(var i=0;i<a;++i)t[n+i+4]=r[i];return(n+4+a)*8},k_=function(t,s,r,a,n,i,l,o,d,u,c){ad(s,c++,r),++n[256];for(var h=rb(n,15),m=h.t,p=h.l,g=rb(i,15),x=g.t,b=g.l,y=C_(m),j=y.c,N=y.n,_=C_(x),F=_.c,I=_.n,w=new Bl(19),E=0;E<j.length;++E)++w[j[E]&31];for(var E=0;E<F.length;++E)++w[F[E]&31];for(var W=rb(w,7),R=W.t,U=W.l,T=19;T>4&&!R[By[T-1]];--T);var Y=u+5<<3,H=TA(n,Su)+TA(i,Sf)+l,M=TA(n,m)+TA(i,x)+l+14+3*T+TA(w,R)+2*w[16]+3*w[17]+7*w[18];if(d>=0&&Y<=H&&Y<=M)return I5(s,c,t.subarray(d,d+u));var q,z,Q,L;if(ad(s,c,1+(M<H)),c+=2,M<H){q=_c(m,p,0),z=m,Q=_c(x,b,0),L=x;var V=_c(R,U,0);ad(s,c,N-257),ad(s,c+5,I-1),ad(s,c+10,T-4),c+=14;for(var E=0;E<T;++E)ad(s,c+3*E,R[By[E]]);c+=3*T;for(var P=[j,F],C=0;C<2;++C)for(var k=P[C],E=0;E<k.length;++E){var B=k[E]&31;ad(s,c,V[B]),c+=R[B],B>15&&(ad(s,c,k[E]>>5&127),c+=k[E]>>12)}}else q=dR,z=Su,Q=mR,L=Sf;for(var E=0;E<o;++E){var G=a[E];if(G>255){var B=G>>18&31;FA(s,c,q[B+257]),c+=z[B+257],B>7&&(ad(s,c,G>>23&31),c+=pg[B]);var O=G&31;FA(s,c,Q[O]),c+=L[O],O>3&&(FA(s,c,G>>5&8191),c+=xg[O])}else FA(s,c,q[G]),c+=z[G]}return FA(s,c,q[256]),c+z[256]},pR=new zj([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),L5=new yi(0),xR=function(t,s,r,a,n,i){var l=i.z||t.length,o=new yi(a+l+5*(1+Math.ceil(l/7e3))+n),d=o.subarray(a,o.length-n),u=i.l,c=(i.r||0)&7;if(s){c&&(d[0]=i.r>>3);for(var h=pR[s-1],m=h>>13,p=h&8191,g=(1<<r)-1,x=i.p||new Bl(32768),b=i.h||new Bl(g+1),y=Math.ceil(r/3),j=2*y,N=function(oe){return(t[oe]^t[oe+1]<<y^t[oe+2]<<j)&g},_=new zj(25e3),F=new Bl(288),I=new Bl(32),w=0,E=0,W=i.i||0,R=0,U=i.w||0,T=0;W+2<l;++W){var Y=N(W),H=W&32767,M=b[Y];if(x[H]=M,b[Y]=H,U<=W){var q=l-W;if((w>7e3||R>24576)&&(q>423||!u)){c=k_(t,d,0,_,F,I,E,R,T,W-T,c),R=w=E=0,T=W;for(var z=0;z<286;++z)F[z]=0;for(var z=0;z<30;++z)I[z]=0}var Q=2,L=0,V=p,P=H-M&32767;if(q>2&&Y==N(W-P))for(var C=Math.min(m,q)-1,k=Math.min(32767,W),B=Math.min(258,q);P<=k&&--V&&H!=M;){if(t[W+Q]==t[W+Q-P]){for(var G=0;G<B&&t[W+G]==t[W+G-P];++G);if(G>Q){if(Q=G,L=P,G>C)break;for(var O=Math.min(P,G-2),K=0,z=0;z<O;++z){var J=W-P+z&32767,te=x[J],se=J-te&32767;se>K&&(K=se,M=J)}}}H=M,M=x[H],P+=H-M&32767}if(L){_[R++]=268435456|Fy[Q]<<18|S_[L];var ae=Fy[Q]&31,ne=S_[L]&31;E+=pg[ae]+xg[ne],++F[257+ae],++I[ne],U=W+Q,++w}else _[R++]=t[W],++F[t[W]]}}for(W=Math.max(W,U);W<l;++W)_[R++]=t[W],++F[t[W]];c=k_(t,d,u,_,F,I,E,R,T,W-T,c),u||(i.r=c&7|d[c/8|0]<<3,c-=7,i.h=b,i.p=x,i.i=W,i.w=U)}else{for(var W=i.w||0;W<l+u;W+=65535){var ue=W+65535;ue>=l&&(d[c/8|0]=u,ue=l),c=I5(d,c+1,t.subarray(W,ue))}i.i=l}return T5(o,0,a+Yj(c)+n)},D5=function(){var t=1,s=0;return{p:function(r){for(var a=t,n=s,i=r.length|0,l=0;l!=i;){for(var o=Math.min(l+2655,i);l<o;++l)n+=a+=r[l];a=(a&65535)+15*(a>>16),n=(n&65535)+15*(n>>16)}t=a,s=n},d:function(){return t%=65521,s%=65521,(t&255)<<24|(t&65280)<<8|(s&255)<<8|s>>8}}},gR=function(t,s,r,a,n){if(!n&&(n={l:1},s.dictionary)){var i=s.dictionary.subarray(-32768),l=new yi(i.length+t.length);l.set(i),l.set(t,i.length),t=l,n.w=i.length}return xR(t,s.level==null?6:s.level,s.mem==null?n.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+s.mem,r,a,n)},P5=function(t,s,r){for(;r;++s)t[s]=r,r>>>=8},vR=function(t,s){var r=s.level,a=r==0?0:r<6?1:r==9?3:2;if(t[0]=120,t[1]=a<<6|(s.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,s.dictionary){var n=D5();n.p(s.dictionary),P5(t,2,n.d())}},bR=function(t,s){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&Mo(6,"invalid zlib data"),(t[1]>>5&1)==1&&Mo(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function Ly(t,s){s||(s={});var r=D5();r.p(t);var a=gR(t,s,s.dictionary?6:2,4);return vR(a,s),P5(a,a.length-4,r.d()),a}function yR(t,s){return fR(t.subarray(bR(t),-4),{i:2},s,s)}var jR=typeof TextDecoder<"u"&&new TextDecoder,NR=0;try{jR.decode(L5,{stream:!0}),NR=1}catch{}var Gs=(function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this})();function ab(){Gs.console&&typeof Gs.console.log=="function"&&Gs.console.log.apply(Gs.console,arguments)}var ea={log:ab,warn:function(t){Gs.console&&(typeof Gs.console.warn=="function"?Gs.console.warn.apply(Gs.console,arguments):ab.call(null,arguments))},error:function(t){Gs.console&&(typeof Gs.console.error=="function"?Gs.console.error.apply(Gs.console,arguments):ab(t))}};function nb(t,s,r){var a=new XMLHttpRequest;a.open("GET",t),a.responseType="blob",a.onload=function(){cm(a.response,s,r)},a.onerror=function(){ea.error("could not download file")},a.send()}function E_(t){var s=new XMLHttpRequest;s.open("HEAD",t,!1);try{s.send()}catch{}return s.status>=200&&s.status<=299}function tx(t){try{t.dispatchEvent(new MouseEvent("click"))}catch{var s=document.createEvent("MouseEvents");s.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(s)}}var rf,Dy,cm=Gs.saveAs||((typeof window>"u"?"undefined":Wr(window))!=="object"||window!==Gs?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(t,s,r){var a=Gs.URL||Gs.webkitURL,n=document.createElement("a");s=s||t.name||"download",n.download=s,n.rel="noopener",typeof t=="string"?(n.href=t,n.origin!==location.origin?E_(n.href)?nb(t,s,r):tx(n,n.target="_blank"):tx(n)):(n.href=a.createObjectURL(t),setTimeout((function(){a.revokeObjectURL(n.href)}),4e4),setTimeout((function(){tx(n)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,s,r){if(s=s||t.name||"download",typeof t=="string")if(E_(t))nb(t,s,r);else{var a=document.createElement("a");a.href=t,a.target="_blank",setTimeout((function(){tx(a)}))}else navigator.msSaveOrOpenBlob((function(n,i){return i===void 0?i={autoBom:!1}:Wr(i)!=="object"&&(ea.warn("Deprecated: Expected third argument to be a object"),i={autoBom:!i}),i.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\uFEFF",n],{type:n.type}):n})(t,r),s)}:function(t,s,r,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),typeof t=="string")return nb(t,s,r);var n=t.type==="application/octet-stream",i=/constructor/i.test(Gs.HTMLElement)||Gs.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||n&&i)&&(typeof FileReader>"u"?"undefined":Wr(FileReader))==="object"){var o=new FileReader;o.onloadend=function(){var c=o.result;c=l?c:c.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=c:location=c,a=null},o.readAsDataURL(t)}else{var d=Gs.URL||Gs.webkitURL,u=d.createObjectURL(t);a?a.location=u:location.href=u,a=null,setTimeout((function(){d.revokeObjectURL(u)}),4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function U5(t){var s;t=t||"",this.ok=!1,t.charAt(0)=="#"&&(t=t.substr(1,6)),t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[t=(t=t.replace(/ /g,"")).toLowerCase()]||t;for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(o){return[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}],a=0;a<r.length;a++){var n=r[a].re,i=r[a].process,l=n.exec(t);l&&(s=i(l),this.r=s[0],this.g=s[1],this.b=s[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var o=this.r.toString(16),d=this.g.toString(16),u=this.b.toString(16);return o.length==1&&(o="0"+o),d.length==1&&(d="0"+d),u.length==1&&(u="0"+u),"#"+o+d+u}}/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function ib(t,s){var r=t[0],a=t[1],n=t[2],i=t[3];r=ci(r,a,n,i,s[0],7,-680876936),i=ci(i,r,a,n,s[1],12,-389564586),n=ci(n,i,r,a,s[2],17,606105819),a=ci(a,n,i,r,s[3],22,-1044525330),r=ci(r,a,n,i,s[4],7,-176418897),i=ci(i,r,a,n,s[5],12,1200080426),n=ci(n,i,r,a,s[6],17,-1473231341),a=ci(a,n,i,r,s[7],22,-45705983),r=ci(r,a,n,i,s[8],7,1770035416),i=ci(i,r,a,n,s[9],12,-1958414417),n=ci(n,i,r,a,s[10],17,-42063),a=ci(a,n,i,r,s[11],22,-1990404162),r=ci(r,a,n,i,s[12],7,1804603682),i=ci(i,r,a,n,s[13],12,-40341101),n=ci(n,i,r,a,s[14],17,-1502002290),r=di(r,a=ci(a,n,i,r,s[15],22,1236535329),n,i,s[1],5,-165796510),i=di(i,r,a,n,s[6],9,-1069501632),n=di(n,i,r,a,s[11],14,643717713),a=di(a,n,i,r,s[0],20,-373897302),r=di(r,a,n,i,s[5],5,-701558691),i=di(i,r,a,n,s[10],9,38016083),n=di(n,i,r,a,s[15],14,-660478335),a=di(a,n,i,r,s[4],20,-405537848),r=di(r,a,n,i,s[9],5,568446438),i=di(i,r,a,n,s[14],9,-1019803690),n=di(n,i,r,a,s[3],14,-187363961),a=di(a,n,i,r,s[8],20,1163531501),r=di(r,a,n,i,s[13],5,-1444681467),i=di(i,r,a,n,s[2],9,-51403784),n=di(n,i,r,a,s[7],14,1735328473),r=ui(r,a=di(a,n,i,r,s[12],20,-1926607734),n,i,s[5],4,-378558),i=ui(i,r,a,n,s[8],11,-2022574463),n=ui(n,i,r,a,s[11],16,1839030562),a=ui(a,n,i,r,s[14],23,-35309556),r=ui(r,a,n,i,s[1],4,-1530992060),i=ui(i,r,a,n,s[4],11,1272893353),n=ui(n,i,r,a,s[7],16,-155497632),a=ui(a,n,i,r,s[10],23,-1094730640),r=ui(r,a,n,i,s[13],4,681279174),i=ui(i,r,a,n,s[0],11,-358537222),n=ui(n,i,r,a,s[3],16,-722521979),a=ui(a,n,i,r,s[6],23,76029189),r=ui(r,a,n,i,s[9],4,-640364487),i=ui(i,r,a,n,s[12],11,-421815835),n=ui(n,i,r,a,s[15],16,530742520),r=mi(r,a=ui(a,n,i,r,s[2],23,-995338651),n,i,s[0],6,-198630844),i=mi(i,r,a,n,s[7],10,1126891415),n=mi(n,i,r,a,s[14],15,-1416354905),a=mi(a,n,i,r,s[5],21,-57434055),r=mi(r,a,n,i,s[12],6,1700485571),i=mi(i,r,a,n,s[3],10,-1894986606),n=mi(n,i,r,a,s[10],15,-1051523),a=mi(a,n,i,r,s[1],21,-2054922799),r=mi(r,a,n,i,s[8],6,1873313359),i=mi(i,r,a,n,s[15],10,-30611744),n=mi(n,i,r,a,s[6],15,-1560198380),a=mi(a,n,i,r,s[13],21,1309151649),r=mi(r,a,n,i,s[4],6,-145523070),i=mi(i,r,a,n,s[11],10,-1120210379),n=mi(n,i,r,a,s[2],15,718787259),a=mi(a,n,i,r,s[9],21,-343485551),t[0]=fu(r,t[0]),t[1]=fu(a,t[1]),t[2]=fu(n,t[2]),t[3]=fu(i,t[3])}function gg(t,s,r,a,n,i){return s=fu(fu(s,t),fu(a,i)),fu(s<<n|s>>>32-n,r)}function ci(t,s,r,a,n,i,l){return gg(s&r|~s&a,t,s,n,i,l)}function di(t,s,r,a,n,i,l){return gg(s&a|r&~a,t,s,n,i,l)}function ui(t,s,r,a,n,i,l){return gg(s^r^a,t,s,n,i,l)}function mi(t,s,r,a,n,i,l){return gg(r^(s|~a),t,s,n,i,l)}function R5(t){var s,r=t.length,a=[1732584193,-271733879,-1732584194,271733878];for(s=64;s<=t.length;s+=64)ib(a,wR(t.substring(s-64,s)));t=t.substring(s-64);var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(s=0;s<t.length;s++)n[s>>2]|=t.charCodeAt(s)<<(s%4<<3);if(n[s>>2]|=128<<(s%4<<3),s>55)for(ib(a,n),s=0;s<16;s++)n[s]=0;return n[14]=8*r,ib(a,n),a}function wR(t){var s,r=[];for(s=0;s<64;s+=4)r[s>>2]=t.charCodeAt(s)+(t.charCodeAt(s+1)<<8)+(t.charCodeAt(s+2)<<16)+(t.charCodeAt(s+3)<<24);return r}rf=Gs.atob.bind(Gs),Dy=Gs.btoa.bind(Gs);var B_="0123456789abcdef".split("");function _R(t){for(var s="",r=0;r<4;r++)s+=B_[t>>8*r+4&15]+B_[t>>8*r&15];return s}function SR(t){return String.fromCharCode((255&t)>>0,(65280&t)>>8,(16711680&t)>>16,(4278190080&t)>>24)}function Py(t){return R5(t).map(SR).join("")}var CR=(function(t){for(var s=0;s<t.length;s++)t[s]=_R(t[s]);return t.join("")})(R5("hello"))!="5d41402abc4b2a76b9719d911017c592";function fu(t,s){if(CR){var r=(65535&t)+(65535&s);return(t>>16)+(s>>16)+(r>>16)<<16|65535&r}return t+s&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function Uy(t,s){var r,a,n,i;if(t!==r){for(var l=(n=t,i=1+(256/t.length>>0),new Array(i+1).join(n)),o=[],d=0;d<256;d++)o[d]=d;var u=0;for(d=0;d<256;d++){var c=o[d];u=(u+c+l.charCodeAt(d))%256,o[d]=o[u],o[u]=c}r=t,a=o}else o=a;var h=s.length,m=0,p=0,g="";for(d=0;d<h;d++)p=(p+(c=o[m=(m+1)%256]))%256,o[m]=o[p],o[p]=c,l=o[(o[m]+o[p])%256],g+=String.fromCharCode(s.charCodeAt(d)^l);return g}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var F_={print:4,modify:8,copy:16,"annot-forms":32};function Nh(t,s,r,a){this.v=1,this.r=2;var n=192;t.forEach((function(o){if(F_.perm!==void 0)throw new Error("Invalid permission: "+o);n+=F_[o]})),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var i=(s+this.padding).substr(0,32),l=(r+this.padding).substr(0,32);this.O=this.processOwnerPassword(i,l),this.P=-(1+(255^n)),this.encryptionKey=Py(i+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(a)).substr(0,5),this.U=Uy(this.encryptionKey,this.padding)}function wh(t){if(/[^\u0000-\u00ff]/.test(t))throw new Error("Invalid PDF Name Object: "+t+", Only accept ASCII characters.");for(var s="",r=t.length,a=0;a<r;a++){var n=t.charCodeAt(a);n<33||n===35||n===37||n===40||n===41||n===47||n===60||n===62||n===91||n===93||n===123||n===125||n>126?s+="#"+("0"+n.toString(16)).slice(-2):s+=t[a]}return s}function T_(t){if(Wr(t)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var s={};this.subscribe=function(r,a,n){if(n=n||!1,typeof r!="string"||typeof a!="function"||typeof n!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");s.hasOwnProperty(r)||(s[r]={});var i=Math.random().toString(35);return s[r][i]=[a,!!n],i},this.unsubscribe=function(r){for(var a in s)if(s[a][r])return delete s[a][r],Object.keys(s[a]).length===0&&delete s[a],!0;return!1},this.publish=function(r){if(s.hasOwnProperty(r)){var a=Array.prototype.slice.call(arguments,1),n=[];for(var i in s[r]){var l=s[r][i];try{l[0].apply(t,a)}catch(o){Gs.console&&ea.error("jsPDF PubSub Error",o.message,o)}l[1]&&n.push(i)}n.length&&n.forEach(this.unsubscribe)}},this.getTopics=function(){return s}}function N0(t){if(!(this instanceof N0))return new N0(t);var s="opacity,stroke-opacity".split(",");for(var r in t)t.hasOwnProperty(r)&&s.indexOf(r)>=0&&(this[r]=t[r]);this.id="",this.objectNumber=-1}function O5(t,s){this.gState=t,this.matrix=s,this.id="",this.objectNumber=-1}function dm(t,s,r,a,n){if(!(this instanceof dm))return new dm(t,s,r,a,n);this.type=t==="axial"?2:3,this.coords=s,this.colors=r,O5.call(this,a,n)}function Bh(t,s,r,a,n){if(!(this instanceof Bh))return new Bh(t,s,r,a,n);this.boundingBox=t,this.xStep=s,this.yStep=r,this.stream="",this.cloneIndex=0,O5.call(this,a,n)}function hs(t){var s,r=typeof arguments[0]=="string"?arguments[0]:"p",a=arguments[1],n=arguments[2],i=arguments[3],l=[],o=1,d=16,u="S",c=null;Wr(t=t||{})==="object"&&(r=t.orientation,a=t.unit||a,n=t.format||n,i=t.compress||t.compressPdf||i,(c=t.encryption||null)!==null&&(c.userPassword=c.userPassword||"",c.ownerPassword=c.ownerPassword||"",c.userPermissions=c.userPermissions||[]),o=typeof t.userUnit=="number"?Math.abs(t.userUnit):1,t.precision!==void 0&&(s=t.precision),t.floatPrecision!==void 0&&(d=t.floatPrecision),u=t.defaultPathOperation||"S"),l=t.filters||(i===!0?["FlateEncode"]:l),a=a||"mm",r=(""+(r||"P")).toLowerCase();var h=t.putOnlyUsedFonts||!1,m={},p={internal:{},__private__:{}};p.__private__.PubSub=T_;var g="1.3",x=p.__private__.getPdfVersion=function(){return g};p.__private__.setPdfVersion=function(ie){g=ie};var b={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};p.__private__.getPageFormats=function(){return b};var y=p.__private__.getPageFormat=function(ie){return b[ie]};n=n||"a4";var j={COMPAT:"compat",ADVANCED:"advanced"},N=j.COMPAT;function _(){this.saveGraphicsState(),X(new Se(he,0,0,-he,0,rc()*he).toString()+" cm"),this.setFontSize(this.getFontSize()/he),u="n",N=j.ADVANCED}function F(){this.restoreGraphicsState(),u="S",N=j.COMPAT}var I=p.__private__.combineFontStyleAndFontWeight=function(ie,Qe){if(ie=="bold"&&Qe=="normal"||ie=="bold"&&Qe==400||ie=="normal"&&Qe=="italic"||ie=="bold"&&Qe=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return Qe&&(ie=Qe==400||Qe==="normal"?ie==="italic"?"italic":"normal":Qe!=700&&Qe!=="bold"||ie!=="normal"?(Qe==700?"bold":Qe)+""+ie:"bold"),ie};p.advancedAPI=function(ie){var Qe=N===j.COMPAT;return Qe&&_.call(this),typeof ie!="function"||(ie(this),Qe&&F.call(this)),this},p.compatAPI=function(ie){var Qe=N===j.ADVANCED;return Qe&&F.call(this),typeof ie!="function"||(ie(this),Qe&&_.call(this)),this},p.isAdvancedAPI=function(){return N===j.ADVANCED};var w,E=function(ie){if(N!==j.ADVANCED)throw new Error(ie+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},W=p.roundToPrecision=p.__private__.roundToPrecision=function(ie,Qe){var At=s||Qe;if(isNaN(ie)||isNaN(At))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return ie.toFixed(At).replace(/0+$/,"")};w=p.hpf=p.__private__.hpf=typeof d=="number"?function(ie){if(isNaN(ie))throw new Error("Invalid argument passed to jsPDF.hpf");return W(ie,d)}:d==="smart"?function(ie){if(isNaN(ie))throw new Error("Invalid argument passed to jsPDF.hpf");return W(ie,ie>-1&&ie<1?16:5)}:function(ie){if(isNaN(ie))throw new Error("Invalid argument passed to jsPDF.hpf");return W(ie,16)};var R=p.f2=p.__private__.f2=function(ie){if(isNaN(ie))throw new Error("Invalid argument passed to jsPDF.f2");return W(ie,2)},U=p.__private__.f3=function(ie){if(isNaN(ie))throw new Error("Invalid argument passed to jsPDF.f3");return W(ie,3)},T=p.scale=p.__private__.scale=function(ie){if(isNaN(ie))throw new Error("Invalid argument passed to jsPDF.scale");return N===j.COMPAT?ie*he:N===j.ADVANCED?ie:void 0},Y=function(ie){return N===j.COMPAT?rc()-ie:N===j.ADVANCED?ie:void 0},H=function(ie){return T(Y(ie))};p.__private__.setPrecision=p.setPrecision=function(ie){typeof parseInt(ie,10)=="number"&&(s=parseInt(ie,10))};var M,q="00000000000000000000000000000000",z=p.__private__.getFileId=function(){return q},Q=p.__private__.setFileId=function(ie){return q=ie!==void 0&&/^[a-fA-F0-9]{32}$/.test(ie)?ie.toUpperCase():q.split("").map((function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))})).join(""),c!==null&&(Ir=new Nh(c.userPermissions,c.userPassword,c.ownerPassword,q)),q};p.setFileId=function(ie){return Q(ie),this},p.getFileId=function(){return z()};var L=p.__private__.convertDateToPDFDate=function(ie){var Qe=ie.getTimezoneOffset(),At=Qe<0?"+":"-",Nt=Math.floor(Math.abs(Qe/60)),Dt=Math.abs(Qe%60),zt=[At,B(Nt),"'",B(Dt),"'"].join("");return["D:",ie.getFullYear(),B(ie.getMonth()+1),B(ie.getDate()),B(ie.getHours()),B(ie.getMinutes()),B(ie.getSeconds()),zt].join("")},V=p.__private__.convertPDFDateToDate=function(ie){var Qe=parseInt(ie.substr(2,4),10),At=parseInt(ie.substr(6,2),10)-1,Nt=parseInt(ie.substr(8,2),10),Dt=parseInt(ie.substr(10,2),10),zt=parseInt(ie.substr(12,2),10),cs=parseInt(ie.substr(14,2),10);return new Date(Qe,At,Nt,Dt,zt,cs,0)},P=p.__private__.setCreationDate=function(ie){var Qe;if(ie===void 0&&(ie=new Date),ie instanceof Date)Qe=L(ie);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(ie))throw new Error("Invalid argument passed to jsPDF.setCreationDate");Qe=ie}return M=Qe},C=p.__private__.getCreationDate=function(ie){var Qe=M;return ie==="jsDate"&&(Qe=V(M)),Qe};p.setCreationDate=function(ie){return P(ie),this},p.getCreationDate=function(ie){return C(ie)};var k,B=p.__private__.padd2=function(ie){return("0"+parseInt(ie)).slice(-2)},G=p.__private__.padd2Hex=function(ie){return("00"+(ie=ie.toString())).substr(ie.length)},O=0,K=[],J=[],te=0,se=[],ae=[],ne=!1,ue=J,oe=function(){O=0,te=0,J=[],K=[],se=[],qe=Mt(),ge=Mt()};p.__private__.setCustomOutputDestination=function(ie){ne=!0,ue=ie};var le=function(ie){ne||(ue=ie)};p.__private__.resetCustomOutputDestination=function(){ne=!1,ue=J};var X=p.__private__.out=function(ie){return ie=ie.toString(),te+=ie.length+1,ue.push(ie),ue},me=p.__private__.write=function(ie){return X(arguments.length===1?ie.toString():Array.prototype.join.call(arguments," "))},we=p.__private__.getArrayBuffer=function(ie){for(var Qe=ie.length,At=new ArrayBuffer(Qe),Nt=new Uint8Array(At);Qe--;)Nt[Qe]=ie.charCodeAt(Qe);return At},Ie=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];p.__private__.getStandardFonts=function(){return Ie};var _e=t.fontSize||16;p.__private__.setFontSize=p.setFontSize=function(ie){return _e=N===j.ADVANCED?ie/he:ie,this};var Fe,Le=p.__private__.getFontSize=p.getFontSize=function(){return N===j.COMPAT?_e:_e*he},rt=t.R2L||!1;p.__private__.setR2L=p.setR2L=function(ie){return rt=ie,this},p.__private__.getR2L=p.getR2L=function(){return rt};var He,st=p.__private__.setZoomMode=function(ie){var Qe=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(ie))Fe=ie;else if(isNaN(ie)){if(Qe.indexOf(ie)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+ie+'" is not recognized.');Fe=ie}else Fe=parseInt(ie,10)};p.__private__.getZoomMode=function(){return Fe};var De,Te=p.__private__.setPageMode=function(ie){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(ie)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+ie+'" is not recognized.');He=ie};p.__private__.getPageMode=function(){return He};var Ce=p.__private__.setLayoutMode=function(ie){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(ie)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+ie+'" is not recognized.');De=ie};p.__private__.getLayoutMode=function(){return De},p.__private__.setDisplayMode=p.setDisplayMode=function(ie,Qe,At){return st(ie),Ce(Qe),Te(At),this};var Pe={title:"",subject:"",author:"",keywords:"",creator:""};p.__private__.getDocumentProperty=function(ie){if(Object.keys(Pe).indexOf(ie)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return Pe[ie]},p.__private__.getDocumentProperties=function(){return Pe},p.__private__.setDocumentProperties=p.setProperties=p.setDocumentProperties=function(ie){for(var Qe in Pe)Pe.hasOwnProperty(Qe)&&ie[Qe]&&(Pe[Qe]=ie[Qe]);return this},p.__private__.setDocumentProperty=function(ie,Qe){if(Object.keys(Pe).indexOf(ie)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return Pe[ie]=Qe};var fe,he,Ue,Ye,Ke,Je={},xe={},ye=[],Ae={},be={},Ee={},dt={},mt=null,it=0,ht=[],ft=new T_(p),Rt=t.hotfixes||[],Ge={},at={},je=[],Se=function ie(Qe,At,Nt,Dt,zt,cs){if(!(this instanceof ie))return new ie(Qe,At,Nt,Dt,zt,cs);isNaN(Qe)&&(Qe=1),isNaN(At)&&(At=0),isNaN(Nt)&&(Nt=0),isNaN(Dt)&&(Dt=1),isNaN(zt)&&(zt=0),isNaN(cs)&&(cs=0),this._matrix=[Qe,At,Nt,Dt,zt,cs]};Object.defineProperty(Se.prototype,"sx",{get:function(){return this._matrix[0]},set:function(ie){this._matrix[0]=ie}}),Object.defineProperty(Se.prototype,"shy",{get:function(){return this._matrix[1]},set:function(ie){this._matrix[1]=ie}}),Object.defineProperty(Se.prototype,"shx",{get:function(){return this._matrix[2]},set:function(ie){this._matrix[2]=ie}}),Object.defineProperty(Se.prototype,"sy",{get:function(){return this._matrix[3]},set:function(ie){this._matrix[3]=ie}}),Object.defineProperty(Se.prototype,"tx",{get:function(){return this._matrix[4]},set:function(ie){this._matrix[4]=ie}}),Object.defineProperty(Se.prototype,"ty",{get:function(){return this._matrix[5]},set:function(ie){this._matrix[5]=ie}}),Object.defineProperty(Se.prototype,"a",{get:function(){return this._matrix[0]},set:function(ie){this._matrix[0]=ie}}),Object.defineProperty(Se.prototype,"b",{get:function(){return this._matrix[1]},set:function(ie){this._matrix[1]=ie}}),Object.defineProperty(Se.prototype,"c",{get:function(){return this._matrix[2]},set:function(ie){this._matrix[2]=ie}}),Object.defineProperty(Se.prototype,"d",{get:function(){return this._matrix[3]},set:function(ie){this._matrix[3]=ie}}),Object.defineProperty(Se.prototype,"e",{get:function(){return this._matrix[4]},set:function(ie){this._matrix[4]=ie}}),Object.defineProperty(Se.prototype,"f",{get:function(){return this._matrix[5]},set:function(ie){this._matrix[5]=ie}}),Object.defineProperty(Se.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Se.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Se.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Se.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Se.prototype.join=function(ie){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(w).join(ie)},Se.prototype.multiply=function(ie){var Qe=ie.sx*this.sx+ie.shy*this.shx,At=ie.sx*this.shy+ie.shy*this.sy,Nt=ie.shx*this.sx+ie.sy*this.shx,Dt=ie.shx*this.shy+ie.sy*this.sy,zt=ie.tx*this.sx+ie.ty*this.shx+this.tx,cs=ie.tx*this.shy+ie.ty*this.sy+this.ty;return new Se(Qe,At,Nt,Dt,zt,cs)},Se.prototype.decompose=function(){var ie=this.sx,Qe=this.shy,At=this.shx,Nt=this.sy,Dt=this.tx,zt=this.ty,cs=Math.sqrt(ie*ie+Qe*Qe),ws=(ie/=cs)*At+(Qe/=cs)*Nt;At-=ie*ws,Nt-=Qe*ws;var Rs=Math.sqrt(At*At+Nt*Nt);return ws/=Rs,ie*(Nt/=Rs)<Qe*(At/=Rs)&&(ie=-ie,Qe=-Qe,ws=-ws,cs=-cs),{scale:new Se(cs,0,0,Rs,0,0),translate:new Se(1,0,0,1,Dt,zt),rotate:new Se(ie,Qe,-Qe,ie,0,0),skew:new Se(1,0,ws,1,0,0)}},Se.prototype.toString=function(ie){return this.join(" ")},Se.prototype.inversed=function(){var ie=this.sx,Qe=this.shy,At=this.shx,Nt=this.sy,Dt=this.tx,zt=this.ty,cs=1/(ie*Nt-Qe*At),ws=Nt*cs,Rs=-Qe*cs,sr=-At*cs,er=ie*cs;return new Se(ws,Rs,sr,er,-ws*Dt-sr*zt,-Rs*Dt-er*zt)},Se.prototype.applyToPoint=function(ie){var Qe=ie.x*this.sx+ie.y*this.shx+this.tx,At=ie.x*this.shy+ie.y*this.sy+this.ty;return new tr(Qe,At)},Se.prototype.applyToRectangle=function(ie){var Qe=this.applyToPoint(ie),At=this.applyToPoint(new tr(ie.x+ie.w,ie.y+ie.h));return new ba(Qe.x,Qe.y,At.x-Qe.x,At.y-Qe.y)},Se.prototype.clone=function(){var ie=this.sx,Qe=this.shy,At=this.shx,Nt=this.sy,Dt=this.tx,zt=this.ty;return new Se(ie,Qe,At,Nt,Dt,zt)},p.Matrix=Se;var nt=p.matrixMult=function(ie,Qe){return Qe.multiply(ie)},Ze=new Se(1,0,0,1,0,0);p.unitMatrix=p.identityMatrix=Ze;var gt=function(ie,Qe){if(!be[ie]){var At=(Qe instanceof dm?"Sh":"P")+(Object.keys(Ae).length+1).toString(10);Qe.id=At,be[ie]=At,Ae[At]=Qe,ft.publish("addPattern",Qe)}};p.ShadingPattern=dm,p.TilingPattern=Bh,p.addShadingPattern=function(ie,Qe){return E("addShadingPattern()"),gt(ie,Qe),this},p.beginTilingPattern=function(ie){E("beginTilingPattern()"),Pl(ie.boundingBox[0],ie.boundingBox[1],ie.boundingBox[2]-ie.boundingBox[0],ie.boundingBox[3]-ie.boundingBox[1],ie.matrix)},p.endTilingPattern=function(ie,Qe){E("endTilingPattern()"),Qe.stream=ae[k].join(`
`),gt(ie,Qe),ft.publish("endTilingPattern",Qe),je.pop().restore()};var jt=p.__private__.newObject=function(){var ie=Mt();return Ne(ie,!0),ie},Mt=p.__private__.newObjectDeferred=function(){return O++,K[O]=function(){return te},O},Ne=function(ie,Qe){return Qe=typeof Qe=="boolean"&&Qe,K[ie]=te,Qe&&X(ie+" 0 obj"),ie},ke=p.__private__.newAdditionalObject=function(){var ie={objId:Mt(),content:""};return se.push(ie),ie},qe=Mt(),ge=Mt(),Me=p.__private__.decodeColorString=function(ie){var Qe=ie.split(" ");if(Qe.length!==2||Qe[1]!=="g"&&Qe[1]!=="G")Qe.length===5&&(Qe[4]==="k"||Qe[4]==="K")&&(Qe=[(1-Qe[0])*(1-Qe[3]),(1-Qe[1])*(1-Qe[3]),(1-Qe[2])*(1-Qe[3]),"r"]);else{var At=parseFloat(Qe[0]);Qe=[At,At,At,"r"]}for(var Nt="#",Dt=0;Dt<3;Dt++)Nt+=("0"+Math.floor(255*parseFloat(Qe[Dt])).toString(16)).slice(-2);return Nt},Ve=p.__private__.encodeColorString=function(ie){var Qe;typeof ie=="string"&&(ie={ch1:ie});var At=ie.ch1,Nt=ie.ch2,Dt=ie.ch3,zt=ie.ch4,cs=ie.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof At=="string"&&At.charAt(0)!=="#"){var ws=new U5(At);if(ws.ok)At=ws.toHex();else if(!/^\d*\.?\d*$/.test(At))throw new Error('Invalid color "'+At+'" passed to jsPDF.encodeColorString.')}if(typeof At=="string"&&/^#[0-9A-Fa-f]{3}$/.test(At)&&(At="#"+At[1]+At[1]+At[2]+At[2]+At[3]+At[3]),typeof At=="string"&&/^#[0-9A-Fa-f]{6}$/.test(At)){var Rs=parseInt(At.substr(1),16);At=Rs>>16&255,Nt=Rs>>8&255,Dt=255&Rs}if(Nt===void 0||zt===void 0&&At===Nt&&Nt===Dt)if(typeof At=="string")Qe=At+" "+cs[0];else switch(ie.precision){case 2:Qe=R(At/255)+" "+cs[0];break;case 3:default:Qe=U(At/255)+" "+cs[0]}else if(zt===void 0||Wr(zt)==="object"){if(zt&&!isNaN(zt.a)&&zt.a===0)return Qe=["1.","1.","1.",cs[1]].join(" ");if(typeof At=="string")Qe=[At,Nt,Dt,cs[1]].join(" ");else switch(ie.precision){case 2:Qe=[R(At/255),R(Nt/255),R(Dt/255),cs[1]].join(" ");break;default:case 3:Qe=[U(At/255),U(Nt/255),U(Dt/255),cs[1]].join(" ")}}else if(typeof At=="string")Qe=[At,Nt,Dt,zt,cs[2]].join(" ");else switch(ie.precision){case 2:Qe=[R(At),R(Nt),R(Dt),R(zt),cs[2]].join(" ");break;case 3:default:Qe=[U(At),U(Nt),U(Dt),U(zt),cs[2]].join(" ")}return Qe},vt=p.__private__.getFilters=function(){return l},St=p.__private__.putStream=function(ie){var Qe=(ie=ie||{}).data||"",At=ie.filters||vt(),Nt=ie.alreadyAppliedFilters||[],Dt=ie.addLength1||!1,zt=Qe.length,cs=ie.objectId,ws=function(vn){return vn};if(c!==null&&cs===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");c!==null&&(ws=Ir.encryptor(cs,0));var Rs={};At===!0&&(At=["FlateEncode"]);var sr=ie.additionalKeyValues||[],er=(Rs=hs.API.processDataByFilters!==void 0?hs.API.processDataByFilters(Qe,At):{data:Qe,reverseChain:[]}).reverseChain+(Array.isArray(Nt)?Nt.join(" "):Nt.toString());if(Rs.data.length!==0&&(sr.push({key:"Length",value:Rs.data.length}),Dt===!0&&sr.push({key:"Length1",value:zt})),er.length!=0)if(er.split("/").length-1==1)sr.push({key:"Filter",value:er});else{sr.push({key:"Filter",value:"["+er+"]"});for(var xr=0;xr<sr.length;xr+=1)if(sr[xr].key==="DecodeParms"){for(var ia=[],fa=0;fa<Rs.reverseChain.split("/").length-1;fa+=1)ia.push("null");ia.push(sr[xr].value),sr[xr].value="["+ia.join(" ")+"]"}}X("<<");for(var Ca=0;Ca<sr.length;Ca++)X("/"+sr[Ca].key+" "+sr[Ca].value);X(">>"),Rs.data.length!==0&&(X("stream"),X(ws(Rs.data)),X("endstream"))},xt=p.__private__.putPage=function(ie){var Qe=ie.number,At=ie.data,Nt=ie.objId,Dt=ie.contentsObjId;Ne(Nt,!0),X("<</Type /Page"),X("/Parent "+ie.rootDictionaryObjId+" 0 R"),X("/Resources "+ie.resourceDictionaryObjId+" 0 R"),X("/MediaBox ["+parseFloat(w(ie.mediaBox.bottomLeftX))+" "+parseFloat(w(ie.mediaBox.bottomLeftY))+" "+w(ie.mediaBox.topRightX)+" "+w(ie.mediaBox.topRightY)+"]"),ie.cropBox!==null&&X("/CropBox ["+w(ie.cropBox.bottomLeftX)+" "+w(ie.cropBox.bottomLeftY)+" "+w(ie.cropBox.topRightX)+" "+w(ie.cropBox.topRightY)+"]"),ie.bleedBox!==null&&X("/BleedBox ["+w(ie.bleedBox.bottomLeftX)+" "+w(ie.bleedBox.bottomLeftY)+" "+w(ie.bleedBox.topRightX)+" "+w(ie.bleedBox.topRightY)+"]"),ie.trimBox!==null&&X("/TrimBox ["+w(ie.trimBox.bottomLeftX)+" "+w(ie.trimBox.bottomLeftY)+" "+w(ie.trimBox.topRightX)+" "+w(ie.trimBox.topRightY)+"]"),ie.artBox!==null&&X("/ArtBox ["+w(ie.artBox.bottomLeftX)+" "+w(ie.artBox.bottomLeftY)+" "+w(ie.artBox.topRightX)+" "+w(ie.artBox.topRightY)+"]"),typeof ie.userUnit=="number"&&ie.userUnit!==1&&X("/UserUnit "+ie.userUnit),ft.publish("putPage",{objId:Nt,pageContext:ht[Qe],pageNumber:Qe,page:At}),X("/Contents "+Dt+" 0 R"),X(">>"),X("endobj");var zt=At.join(`
`);return N===j.ADVANCED&&(zt+=`
Q`),Ne(Dt,!0),St({data:zt,filters:vt(),objectId:Dt}),X("endobj"),Nt},Ct=p.__private__.putPages=function(){var ie,Qe,At=[];for(ie=1;ie<=it;ie++)ht[ie].objId=Mt(),ht[ie].contentsObjId=Mt();for(ie=1;ie<=it;ie++)At.push(xt({number:ie,data:ae[ie],objId:ht[ie].objId,contentsObjId:ht[ie].contentsObjId,mediaBox:ht[ie].mediaBox,cropBox:ht[ie].cropBox,bleedBox:ht[ie].bleedBox,trimBox:ht[ie].trimBox,artBox:ht[ie].artBox,userUnit:ht[ie].userUnit,rootDictionaryObjId:qe,resourceDictionaryObjId:ge}));Ne(qe,!0),X("<</Type /Pages");var Nt="/Kids [";for(Qe=0;Qe<it;Qe++)Nt+=At[Qe]+" 0 R ";X(Nt+"]"),X("/Count "+it),X(">>"),X("endobj"),ft.publish("postPutPages")},Tt=function(ie){ft.publish("putFont",{font:ie,out:X,newObject:jt,putStream:St}),ie.isAlreadyPutted!==!0&&(ie.objectNumber=jt(),X("<<"),X("/Type /Font"),X("/BaseFont /"+wh(ie.postScriptName)),X("/Subtype /Type1"),typeof ie.encoding=="string"&&X("/Encoding /"+ie.encoding),X("/FirstChar 32"),X("/LastChar 255"),X(">>"),X("endobj"))},bt=function(){for(var ie in Je)Je.hasOwnProperty(ie)&&(h===!1||h===!0&&m.hasOwnProperty(ie))&&Tt(Je[ie])},Jt=function(ie){ie.objectNumber=jt();var Qe=[];Qe.push({key:"Type",value:"/XObject"}),Qe.push({key:"Subtype",value:"/Form"}),Qe.push({key:"BBox",value:"["+[w(ie.x),w(ie.y),w(ie.x+ie.width),w(ie.y+ie.height)].join(" ")+"]"}),Qe.push({key:"Matrix",value:"["+ie.matrix.toString()+"]"});var At=ie.pages[1].join(`
`);St({data:At,additionalKeyValues:Qe,objectId:ie.objectNumber}),X("endobj")},Gt=function(){for(var ie in Ge)Ge.hasOwnProperty(ie)&&Jt(Ge[ie])},Ht=function(ie,Qe){var At,Nt=[],Dt=1/(Qe-1);for(At=0;At<1;At+=Dt)Nt.push(At);if(Nt.push(1),ie[0].offset!=0){var zt={offset:0,color:ie[0].color};ie.unshift(zt)}if(ie[ie.length-1].offset!=1){var cs={offset:1,color:ie[ie.length-1].color};ie.push(cs)}for(var ws="",Rs=0,sr=0;sr<Nt.length;sr++){for(At=Nt[sr];At>ie[Rs+1].offset;)Rs++;var er=ie[Rs].offset,xr=(At-er)/(ie[Rs+1].offset-er),ia=ie[Rs].color,fa=ie[Rs+1].color;ws+=G(Math.round((1-xr)*ia[0]+xr*fa[0]).toString(16))+G(Math.round((1-xr)*ia[1]+xr*fa[1]).toString(16))+G(Math.round((1-xr)*ia[2]+xr*fa[2]).toString(16))}return ws.trim()},es=function(ie,Qe){Qe||(Qe=21);var At=jt(),Nt=Ht(ie.colors,Qe),Dt=[];Dt.push({key:"FunctionType",value:"0"}),Dt.push({key:"Domain",value:"[0.0 1.0]"}),Dt.push({key:"Size",value:"["+Qe+"]"}),Dt.push({key:"BitsPerSample",value:"8"}),Dt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Dt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),St({data:Nt,additionalKeyValues:Dt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:At}),X("endobj"),ie.objectNumber=jt(),X("<< /ShadingType "+ie.type),X("/ColorSpace /DeviceRGB");var zt="/Coords ["+w(parseFloat(ie.coords[0]))+" "+w(parseFloat(ie.coords[1]))+" ";ie.type===2?zt+=w(parseFloat(ie.coords[2]))+" "+w(parseFloat(ie.coords[3])):zt+=w(parseFloat(ie.coords[2]))+" "+w(parseFloat(ie.coords[3]))+" "+w(parseFloat(ie.coords[4]))+" "+w(parseFloat(ie.coords[5])),X(zt+="]"),ie.matrix&&X("/Matrix ["+ie.matrix.toString()+"]"),X("/Function "+At+" 0 R"),X("/Extend [true true]"),X(">>"),X("endobj")},js=function(ie,Qe){var At=Mt(),Nt=jt();Qe.push({resourcesOid:At,objectOid:Nt}),ie.objectNumber=Nt;var Dt=[];Dt.push({key:"Type",value:"/Pattern"}),Dt.push({key:"PatternType",value:"1"}),Dt.push({key:"PaintType",value:"1"}),Dt.push({key:"TilingType",value:"1"}),Dt.push({key:"BBox",value:"["+ie.boundingBox.map(w).join(" ")+"]"}),Dt.push({key:"XStep",value:w(ie.xStep)}),Dt.push({key:"YStep",value:w(ie.yStep)}),Dt.push({key:"Resources",value:At+" 0 R"}),ie.matrix&&Dt.push({key:"Matrix",value:"["+ie.matrix.toString()+"]"}),St({data:ie.stream,additionalKeyValues:Dt,objectId:ie.objectNumber}),X("endobj")},Zs=function(ie){var Qe;for(Qe in Ae)Ae.hasOwnProperty(Qe)&&(Ae[Qe]instanceof dm?es(Ae[Qe]):Ae[Qe]instanceof Bh&&js(Ae[Qe],ie))},Xs=function(ie){for(var Qe in ie.objectNumber=jt(),X("<<"),ie)switch(Qe){case"opacity":X("/ca "+R(ie[Qe]));break;case"stroke-opacity":X("/CA "+R(ie[Qe]))}X(">>"),X("endobj")},Hs=function(){var ie;for(ie in Ee)Ee.hasOwnProperty(ie)&&Xs(Ee[ie])},Bs=function(){for(var ie in X("/XObject <<"),Ge)Ge.hasOwnProperty(ie)&&Ge[ie].objectNumber>=0&&X("/"+ie+" "+Ge[ie].objectNumber+" 0 R");ft.publish("putXobjectDict"),X(">>")},Ln=function(){Ir.oid=jt(),X("<<"),X("/Filter /Standard"),X("/V "+Ir.v),X("/R "+Ir.r),X("/U <"+Ir.toHexString(Ir.U)+">"),X("/O <"+Ir.toHexString(Ir.O)+">"),X("/P "+Ir.P),X(">>"),X("endobj")},br=function(){for(var ie in X("/Font <<"),Je)Je.hasOwnProperty(ie)&&(h===!1||h===!0&&m.hasOwnProperty(ie))&&X("/"+ie+" "+Je[ie].objectNumber+" 0 R");X(">>")},mr=function(){if(Object.keys(Ae).length>0){for(var ie in X("/Shading <<"),Ae)Ae.hasOwnProperty(ie)&&Ae[ie]instanceof dm&&Ae[ie].objectNumber>=0&&X("/"+ie+" "+Ae[ie].objectNumber+" 0 R");ft.publish("putShadingPatternDict"),X(">>")}},Ja=function(ie){if(Object.keys(Ae).length>0){for(var Qe in X("/Pattern <<"),Ae)Ae.hasOwnProperty(Qe)&&Ae[Qe]instanceof p.TilingPattern&&Ae[Qe].objectNumber>=0&&Ae[Qe].objectNumber<ie&&X("/"+Qe+" "+Ae[Qe].objectNumber+" 0 R");ft.publish("putTilingPatternDict"),X(">>")}},Tr=function(){if(Object.keys(Ee).length>0){var ie;for(ie in X("/ExtGState <<"),Ee)Ee.hasOwnProperty(ie)&&Ee[ie].objectNumber>=0&&X("/"+ie+" "+Ee[ie].objectNumber+" 0 R");ft.publish("putGStateDict"),X(">>")}},ta=function(ie){Ne(ie.resourcesOid,!0),X("<<"),X("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),br(),mr(),Ja(ie.objectOid),Tr(),Bs(),X(">>"),X("endobj")},fl=function(){var ie=[];bt(),Hs(),Gt(),Zs(ie),ft.publish("putResources"),ie.forEach(ta),ta({resourcesOid:ge,objectOid:Number.MAX_SAFE_INTEGER}),ft.publish("postPutResources")},Za=function(){ft.publish("putAdditionalObjects");for(var ie=0;ie<se.length;ie++){var Qe=se[ie];Ne(Qe.objId,!0),X(Qe.content),X("endobj")}ft.publish("postPutAdditionalObjects")},Sa=function(ie){xe[ie.fontName]=xe[ie.fontName]||{},xe[ie.fontName][ie.fontStyle]=ie.id},Ci=function(ie,Qe,At,Nt,Dt){var zt={id:"F"+(Object.keys(Je).length+1).toString(10),postScriptName:ie,fontName:Qe,fontStyle:At,encoding:Nt,isStandardFont:Dt||!1,metadata:{}};return ft.publish("addFont",{font:zt,instance:this}),Je[zt.id]=zt,Sa(zt),zt.id},Vi=function(ie){for(var Qe=0,At=Ie.length;Qe<At;Qe++){var Nt=Ci.call(this,ie[Qe][0],ie[Qe][1],ie[Qe][2],Ie[Qe][3],!0);h===!1&&(m[Nt]=!0);var Dt=ie[Qe][0].split("-");Sa({id:Nt,fontName:Dt[0],fontStyle:Dt[1]||""})}ft.publish("addFonts",{fonts:Je,dictionary:xe})},va=function(ie){return ie.foo=function(){try{return ie.apply(this,arguments)}catch(Nt){var Qe=Nt.stack||"";~Qe.indexOf(" at ")&&(Qe=Qe.split(" at ")[1]);var At="Error in function "+Qe.split(`
`)[0].split("<")[0]+": "+Nt.message;if(!Gs.console)throw new Error(At);Gs.console.error(At,Nt),Gs.alert&&alert(At)}},ie.foo.bar=ie,ie.foo},en=function(ie,Qe){var At,Nt,Dt,zt,cs,ws,Rs,sr,er;if(Dt=(Qe=Qe||{}).sourceEncoding||"Unicode",cs=Qe.outputEncoding,(Qe.autoencode||cs)&&Je[fe].metadata&&Je[fe].metadata[Dt]&&Je[fe].metadata[Dt].encoding&&(zt=Je[fe].metadata[Dt].encoding,!cs&&Je[fe].encoding&&(cs=Je[fe].encoding),!cs&&zt.codePages&&(cs=zt.codePages[0]),typeof cs=="string"&&(cs=zt[cs]),cs)){for(Rs=!1,ws=[],At=0,Nt=ie.length;At<Nt;At++)(sr=cs[ie.charCodeAt(At)])?ws.push(String.fromCharCode(sr)):ws.push(ie[At]),ws[At].charCodeAt(0)>>8&&(Rs=!0);ie=ws.join("")}for(At=ie.length;Rs===void 0&&At!==0;)ie.charCodeAt(At-1)>>8&&(Rs=!0),At--;if(!Rs)return ie;for(ws=Qe.noBOM?[]:[254,255],At=0,Nt=ie.length;At<Nt;At++){if((er=(sr=ie.charCodeAt(At))>>8)>>8)throw new Error("Character at position "+At+" of string '"+ie+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");ws.push(er),ws.push(sr-(er<<8))}return String.fromCharCode.apply(void 0,ws)},Pa=p.__private__.pdfEscape=p.pdfEscape=function(ie,Qe){return en(ie,Qe).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},co=p.__private__.beginPage=function(ie){ae[++it]=[],ht[it]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(ie[0]),topRightY:Number(ie[1])}},xn(it),le(ae[k])},Jo=function(ie,Qe){var At,Nt,Dt;switch(r=Qe||r,typeof ie=="string"&&(At=y(ie.toLowerCase()),Array.isArray(At)&&(Nt=At[0],Dt=At[1])),Array.isArray(ie)&&(Nt=ie[0]*he,Dt=ie[1]*he),isNaN(Nt)&&(Nt=n[0],Dt=n[1]),(Nt>14400||Dt>14400)&&(ea.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Nt=Math.min(14400,Nt),Dt=Math.min(14400,Dt)),n=[Nt,Dt],r.substr(0,1)){case"l":Dt>Nt&&(n=[Dt,Nt]);break;case"p":Nt>Dt&&(n=[Dt,Nt])}co(n),yt(lt),X(rs),aa!==0&&X(aa+" J"),pr!==0&&X(pr+" j"),ft.publish("addPage",{pageNumber:it})},Il=function(ie){ie>0&&ie<=it&&(ae.splice(ie,1),ht.splice(ie,1),it--,k>it&&(k=it),this.setPage(k))},xn=function(ie){ie>0&&ie<=it&&(k=ie)},Pc=p.__private__.getNumberOfPages=p.getNumberOfPages=function(){return ae.length-1},uo=function(ie,Qe,At){var Nt,Dt=void 0;return At=At||{},ie=ie!==void 0?ie:Je[fe].fontName,Qe=Qe!==void 0?Qe:Je[fe].fontStyle,Nt=ie.toLowerCase(),xe[Nt]!==void 0&&xe[Nt][Qe]!==void 0?Dt=xe[Nt][Qe]:xe[ie]!==void 0&&xe[ie][Qe]!==void 0?Dt=xe[ie][Qe]:At.disableWarning===!1&&ea.warn("Unable to look up font label for font '"+ie+"', '"+Qe+"'. Refer to getFontList() for available fonts."),Dt||At.noFallback||(Dt=xe.times[Qe])==null&&(Dt=xe.times.normal),Dt},hr=p.__private__.putInfo=function(){var ie=jt(),Qe=function(Nt){return Nt};for(var At in c!==null&&(Qe=Ir.encryptor(ie,0)),X("<<"),X("/Producer ("+Pa(Qe("jsPDF "+hs.version))+")"),Pe)Pe.hasOwnProperty(At)&&Pe[At]&&X("/"+At.substr(0,1).toUpperCase()+At.substr(1)+" ("+Pa(Qe(Pe[At]))+")");X("/CreationDate ("+Pa(Qe(M))+")"),X(">>"),X("endobj")},Ll=p.__private__.putCatalog=function(ie){var Qe=(ie=ie||{}).rootDictionaryObjId||qe;switch(jt(),X("<<"),X("/Type /Catalog"),X("/Pages "+Qe+" 0 R"),Fe||(Fe="fullwidth"),Fe){case"fullwidth":X("/OpenAction [3 0 R /FitH null]");break;case"fullheight":X("/OpenAction [3 0 R /FitV null]");break;case"fullpage":X("/OpenAction [3 0 R /Fit]");break;case"original":X("/OpenAction [3 0 R /XYZ null null 1]");break;default:var At=""+Fe;At.substr(At.length-1)==="%"&&(Fe=parseInt(Fe)/100),typeof Fe=="number"&&X("/OpenAction [3 0 R /XYZ null null "+R(Fe)+"]")}switch(De||(De="continuous"),De){case"continuous":X("/PageLayout /OneColumn");break;case"single":X("/PageLayout /SinglePage");break;case"two":case"twoleft":X("/PageLayout /TwoColumnLeft");break;case"tworight":X("/PageLayout /TwoColumnRight")}He&&X("/PageMode /"+He),ft.publish("putCatalog"),X(">>"),X("endobj")},Zo=p.__private__.putTrailer=function(){X("trailer"),X("<<"),X("/Size "+(O+1)),X("/Root "+O+" 0 R"),X("/Info "+(O-1)+" 0 R"),c!==null&&X("/Encrypt "+Ir.oid+" 0 R"),X("/ID [ <"+q+"> <"+q+"> ]"),X(">>")},ec=p.__private__.putHeader=function(){X("%PDF-"+g),X("%")},Uc=p.__private__.putXRef=function(){var ie="0000000000";X("xref"),X("0 "+(O+1)),X("0000000000 65535 f ");for(var Qe=1;Qe<=O;Qe++)typeof K[Qe]=="function"?X((ie+K[Qe]()).slice(-10)+" 00000 n "):K[Qe]!==void 0?X((ie+K[Qe]).slice(-10)+" 00000 n "):X("0000000000 00000 n ")},ki=p.__private__.buildDocument=function(){oe(),le(J),ft.publish("buildDocument"),ec(),Ct(),Za(),fl(),c!==null&&Ln(),hr(),Ll();var ie=te;return Uc(),Zo(),X("startxref"),X(""+ie),X("%%EOF"),le(ae[k]),J.join(`
`)},mo=p.__private__.getBlob=function(ie){return new Blob([we(ie)],{type:"application/pdf"})},Dl=p.output=p.__private__.output=va((function(ie,Qe){switch(typeof(Qe=Qe||{})=="string"?Qe={filename:Qe}:Qe.filename=Qe.filename||"generated.pdf",ie){case void 0:return ki();case"save":p.save(Qe.filename);break;case"arraybuffer":return we(ki());case"blob":return mo(ki());case"bloburi":case"bloburl":if(Gs.URL!==void 0&&typeof Gs.URL.createObjectURL=="function")return Gs.URL&&Gs.URL.createObjectURL(mo(ki()))||void 0;ea.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var At="",Nt=ki();try{At=Dy(Nt)}catch{At=Dy(unescape(encodeURIComponent(Nt)))}return"data:application/pdf;filename="+Qe.filename+";base64,"+At;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Gs)==="[object Window]"){var Dt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",zt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';Qe.pdfObjectUrl&&(Dt=Qe.pdfObjectUrl,zt="");var cs='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Dt+'"'+zt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(Qe)+");<\/script></body></html>",ws=Gs.open();return ws!==null&&ws.document.write(cs),ws}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Gs)==="[object Window]"){var Rs='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(Qe.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+Qe.filename+'" width="500px" height="400px" /></body></html>',sr=Gs.open();if(sr!==null){sr.document.write(Rs);var er=this;sr.document.documentElement.querySelector("#pdfViewer").onload=function(){sr.document.title=Qe.filename,sr.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(er.output("bloburl"))}}return sr}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Gs)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var xr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",Qe)+'"></iframe></body></html>',ia=Gs.open();if(ia!==null&&(ia.document.write(xr),ia.document.title=Qe.filename),ia||typeof safari>"u")return ia;break;case"datauri":case"dataurl":return Gs.document.location.href=this.output("datauristring",Qe);default:return null}})),Wi=function(ie){return Array.isArray(Rt)===!0&&Rt.indexOf(ie)>-1};switch(a){case"pt":he=1;break;case"mm":he=72/25.4;break;case"cm":he=72/2.54;break;case"in":he=72;break;case"px":he=Wi("px_scaling")==1?.75:96/72;break;case"pc":case"em":he=12;break;case"ex":he=6;break;default:if(typeof a!="number")throw new Error("Invalid unit: "+a);he=a}var Ir=null;P(),Q();var Yn=function(ie){return c!==null?Ir.encryptor(ie,0):function(Qe){return Qe}},Xn=p.__private__.getPageInfo=p.getPageInfo=function(ie){if(isNaN(ie)||ie%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:ht[ie].objId,pageNumber:ie,pageContext:ht[ie]}},Os=p.__private__.getPageInfoByObjId=function(ie){if(isNaN(ie)||ie%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var Qe in ht)if(ht[Qe].objId===ie)break;return Xn(Qe)},ho=p.__private__.getCurrentPageInfo=p.getCurrentPageInfo=function(){return{objId:ht[k].objId,pageNumber:k,pageContext:ht[k]}};p.addPage=function(){return Jo.apply(this,arguments),this},p.setPage=function(){return xn.apply(this,arguments),le.call(this,ae[k]),this},p.insertPage=function(ie){return this.addPage(),this.movePage(k,ie),this},p.movePage=function(ie,Qe){var At,Nt;if(ie>Qe){At=ae[ie],Nt=ht[ie];for(var Dt=ie;Dt>Qe;Dt--)ae[Dt]=ae[Dt-1],ht[Dt]=ht[Dt-1];ae[Qe]=At,ht[Qe]=Nt,this.setPage(Qe)}else if(ie<Qe){At=ae[ie],Nt=ht[ie];for(var zt=ie;zt<Qe;zt++)ae[zt]=ae[zt+1],ht[zt]=ht[zt+1];ae[Qe]=At,ht[Qe]=Nt,this.setPage(Qe)}return this},p.deletePage=function(){return Il.apply(this,arguments),this},p.__private__.text=p.text=function(ie,Qe,At,Nt,Dt){var zt,cs,ws,Rs,sr,er,xr,ia,fa,Ca=(Nt=Nt||{}).scope||this;if(typeof ie=="number"&&typeof Qe=="number"&&(typeof At=="string"||Array.isArray(At))){var vn=At;At=Qe,Qe=ie,ie=vn}if(arguments[3]instanceof Se?(E("The transform parameter of text() with a Matrix value"),fa=Dt):(ws=arguments[4],Rs=arguments[5],Wr(xr=arguments[3])==="object"&&xr!==null||(typeof ws=="string"&&(Rs=ws,ws=null),typeof xr=="string"&&(Rs=xr,xr=null),typeof xr=="number"&&(ws=xr,xr=null),Nt={flags:xr,angle:ws,align:Rs})),isNaN(Qe)||isNaN(At)||ie==null)throw new Error("Invalid arguments passed to jsPDF.text");if(ie.length===0)return Ca;var tn="",pl=!1,Ei=typeof Nt.lineHeightFactor=="number"?Nt.lineHeightFactor:Be,zi=Ca.internal.scaleFactor;function ac(Qr){return Qr=Qr.split("	").join(Array(Nt.TabLen||9).join(" ")),Pa(Qr,xr)}function Ru(Qr){for(var Lr,xa=Qr.concat(),ka=[],Ol=xa.length;Ol--;)typeof(Lr=xa.shift())=="string"?ka.push(Lr):Array.isArray(Qr)&&(Lr.length===1||Lr[1]===void 0&&Lr[2]===void 0)?ka.push(Lr[0]):ka.push([Lr[0],Lr[1],Lr[2]]);return ka}function Sd(Qr,Lr){var xa;if(typeof Qr=="string")xa=Lr(Qr)[0];else if(Array.isArray(Qr)){for(var ka,Ol,Pd=Qr.concat(),Wc=[],Qu=Pd.length;Qu--;)typeof(ka=Pd.shift())=="string"?Wc.push(Lr(ka)[0]):Array.isArray(ka)&&typeof ka[0]=="string"&&(Ol=Lr(ka[0],ka[1],ka[2]),Wc.push([Ol[0],Ol[1],Ol[2]]));xa=Wc}return xa}var Oc=!1,Cd=!0;if(typeof ie=="string")Oc=!0;else if(Array.isArray(ie)){var kd=ie.concat();cs=[];for(var Mc,pa=kd.length;pa--;)(typeof(Mc=kd.shift())!="string"||Array.isArray(Mc)&&typeof Mc[0]!="string")&&(Cd=!1);Oc=Cd}if(Oc===!1)throw new Error('Type of text must be string or Array. "'+ie+'" is not recognized.');typeof ie=="string"&&(ie=ie.match(/[\r?\n]/)?ie.split(/\r\n|\r|\n/g):[ie]);var Ed=_e/Ca.internal.scaleFactor,Bd=Ed*(Ei-1);switch(Nt.baseline){case"bottom":At-=Bd;break;case"top":At+=Ed-Bd;break;case"hanging":At+=Ed-2*Bd;break;case"middle":At+=Ed/2-Bd}if((er=Nt.maxWidth||0)>0&&(typeof ie=="string"?ie=Ca.splitTextToSize(ie,er):Object.prototype.toString.call(ie)==="[object Array]"&&(ie=ie.reduce((function(Qr,Lr){return Qr.concat(Ca.splitTextToSize(Lr,er))}),[]))),zt={text:ie,x:Qe,y:At,options:Nt,mutex:{pdfEscape:Pa,activeFontKey:fe,fonts:Je,activeFontSize:_e}},ft.publish("preProcessText",zt),ie=zt.text,ws=(Nt=zt.options).angle,!(fa instanceof Se)&&ws&&typeof ws=="number"){ws*=Math.PI/180,Nt.rotationDirection===0&&(ws=-ws),N===j.ADVANCED&&(ws=-ws);var Fd=Math.cos(ws),Td=Math.sin(ws);fa=new Se(Fd,Td,-Td,Fd,0,0)}else ws&&ws instanceof Se&&(fa=ws);N!==j.ADVANCED||fa||(fa=Ze),(sr=Nt.charSpace||or)!==void 0&&(tn+=w(T(sr))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(ia=Nt.horizontalScale)!==void 0&&(tn+=w(100*ia)+` Tz
`),Nt.lang;var Pn=-1,Qc=Nt.renderingMode!==void 0?Nt.renderingMode:Nt.stroke,xo=Ca.internal.getCurrentPageInfo().pageContext;switch(Qc){case 0:case!1:case"fill":Pn=0;break;case 1:case!0:case"stroke":Pn=1;break;case 2:case"fillThenStroke":Pn=2;break;case 3:case"invisible":Pn=3;break;case 4:case"fillAndAddForClipping":Pn=4;break;case 5:case"strokeAndAddPathForClipping":Pn=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Pn=6;break;case 7:case"addToPathForClipping":Pn=7}var Qm=xo.usedRenderingMode!==void 0?xo.usedRenderingMode:-1;Pn!==-1?tn+=Pn+` Tr
`:Qm!==-1&&(tn+=`0 Tr
`),Pn!==-1&&(xo.usedRenderingMode=Pn),Rs=Nt.align||"left";var Un,Id=_e*Ei,Ou=Ca.internal.pageSize.getWidth(),Ld=Je[fe];sr=Nt.charSpace||or,er=Nt.maxWidth||0,xr=Object.assign({autoencode:!0,noBOM:!0},Nt.flags);var Ul=[],nc=function(Qr){return Ca.getStringUnitWidth(Qr,{font:Ld,charSpace:sr,fontSize:_e,doKerning:!1})*_e/zi};if(Object.prototype.toString.call(ie)==="[object Array]"){var Rn;cs=Ru(ie),Rs!=="left"&&(Un=cs.map(nc));var bn,ic=0;if(Rs==="right"){Qe-=Un[0],ie=[],pa=cs.length;for(var go=0;go<pa;go++)go===0?(bn=ss(Qe),Rn=$t(At)):(bn=T(ic-Un[go]),Rn=-Id),ie.push([cs[go],bn,Rn]),ic=Un[go]}else if(Rs==="center"){Qe-=Un[0]/2,ie=[],pa=cs.length;for(var vo=0;vo<pa;vo++)vo===0?(bn=ss(Qe),Rn=$t(At)):(bn=T((ic-Un[vo])/2),Rn=-Id),ie.push([cs[vo],bn,Rn]),ic=Un[vo]}else if(Rs==="left"){ie=[],pa=cs.length;for(var Dd=0;Dd<pa;Dd++)ie.push(cs[Dd])}else if(Rs==="justify"&&Ld.encoding==="Identity-H"){ie=[],pa=cs.length,er=er!==0?er:Ou;for(var bo=0,wr=0;wr<pa;wr++)if(Rn=wr===0?$t(At):-Id,bn=wr===0?ss(Qe):bo,wr<pa-1){var yo=T((er-Un[wr])/(cs[wr].split(" ").length-1)),yn=cs[wr].split(" ");ie.push([yn[0]+" ",bn,Rn]),bo=0;for(var Bi=1;Bi<yn.length;Bi++){var Hc=(nc(yn[Bi-1]+" "+yn[Bi])-nc(yn[Bi]))*zi+yo;Bi==yn.length-1?ie.push([yn[Bi],Hc,0]):ie.push([yn[Bi]+" ",Hc,0]),bo-=Hc}}else ie.push([cs[wr],bn,Rn]);ie.push(["",bo,0])}else{if(Rs!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(ie=[],pa=cs.length,er=er!==0?er:Ou,wr=0;wr<pa;wr++)Rn=wr===0?$t(At):-Id,bn=wr===0?ss(Qe):0,wr<pa-1?Ul.push(w(T((er-Un[wr])/(cs[wr].split(" ").length-1)))):Ul.push(0),ie.push([cs[wr],bn,Rn])}}var Mu=typeof Nt.R2L=="boolean"?Nt.R2L:rt;Mu===!0&&(ie=Sd(ie,(function(Qr,Lr,xa){return[Qr.split("").reverse().join(""),Lr,xa]}))),zt={text:ie,x:Qe,y:At,options:Nt,mutex:{pdfEscape:Pa,activeFontKey:fe,fonts:Je,activeFontSize:_e}},ft.publish("postProcessText",zt),ie=zt.text,pl=zt.mutex.isHex||!1;var qc=Je[fe].encoding;qc!=="WinAnsiEncoding"&&qc!=="StandardEncoding"||(ie=Sd(ie,(function(Qr,Lr,xa){return[ac(Qr),Lr,xa]}))),cs=Ru(ie),ie=[];for(var $c,Vc,Fi,jo=0,Rl=1,No=Array.isArray(cs[0])?Rl:jo,wo="",lc=function(Qr,Lr,xa){var ka="";return xa instanceof Se?(xa=typeof Nt.angle=="number"?nt(xa,new Se(1,0,0,1,Qr,Lr)):nt(new Se(1,0,0,1,Qr,Lr),xa),N===j.ADVANCED&&(xa=nt(new Se(1,0,0,-1,0,0),xa)),ka=xa.join(" ")+` Tm
`):ka=w(Qr)+" "+w(Lr)+` Td
`,ka},dn=0;dn<cs.length;dn++){switch(wo="",No){case Rl:Fi=(pl?"<":"(")+cs[dn][0]+(pl?">":")"),$c=parseFloat(cs[dn][1]),Vc=parseFloat(cs[dn][2]);break;case jo:Fi=(pl?"<":"(")+cs[dn]+(pl?">":")"),$c=ss(Qe),Vc=$t(At)}Ul!==void 0&&Ul[dn]!==void 0&&(wo=Ul[dn]+` Tw
`),dn===0?ie.push(wo+lc($c,Vc,fa)+Fi):No===jo?ie.push(wo+Fi):No===Rl&&ie.push(wo+lc($c,Vc,fa)+Fi)}ie=No===jo?ie.join(` Tj
T* `):ie.join(` Tj
`),ie+=` Tj
`;var ti=`BT
/`;return ti+=fe+" "+_e+` Tf
`,ti+=w(_e*Ei)+` TL
`,ti+=os+`
`,ti+=tn,ti+=ie,X(ti+="ET"),m[fe]=!0,Ca};var Gi=p.__private__.clip=p.clip=function(ie){return X(ie==="evenodd"?"W*":"W"),this};p.clipEvenOdd=function(){return Gi("evenodd")},p.__private__.discardPath=p.discardPath=function(){return X("n"),this};var Ki=p.__private__.isValidStyle=function(ie){var Qe=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(ie)!==-1&&(Qe=!0),Qe};p.__private__.setDefaultPathOperation=p.setDefaultPathOperation=function(ie){return Ki(ie)&&(u=ie),this};var Ua=p.__private__.getStyle=p.getStyle=function(ie){var Qe=u;switch(ie){case"D":case"S":Qe="S";break;case"F":Qe="f";break;case"FD":case"DF":Qe="B";break;case"f":case"f*":case"B":case"B*":Qe=ie}return Qe},Jn=p.close=function(){return X("h"),this};p.stroke=function(){return X("S"),this},p.fill=function(ie){return Ao("f",ie),this},p.fillEvenOdd=function(ie){return Ao("f*",ie),this},p.fillStroke=function(ie){return Ao("B",ie),this},p.fillStrokeEvenOdd=function(ie){return Ao("B*",ie),this};var Ao=function(ie,Qe){Wr(Qe)==="object"?sc(Qe,ie):X(ie)},fo=function(ie){ie===null||N===j.ADVANCED&&ie===void 0||(ie=Ua(ie),X(ie))};function tc(ie,Qe,At,Nt,Dt){var zt=new Bh(Qe||this.boundingBox,At||this.xStep,Nt||this.yStep,this.gState,Dt||this.matrix);zt.stream=this.stream;var cs=ie+"$$"+this.cloneIndex+++"$$";return gt(cs,zt),zt}var sc=function(ie,Qe){var At=be[ie.key],Nt=Ae[At];if(Nt instanceof dm)X("q"),X(Pu(Qe)),Nt.gState&&p.setGState(Nt.gState),X(ie.matrix.toString()+" cm"),X("/"+At+" sh"),X("Q");else if(Nt instanceof Bh){var Dt=new Se(1,0,0,-1,0,rc());ie.matrix&&(Dt=Dt.multiply(ie.matrix||Ze),At=tc.call(Nt,ie.key,ie.boundingBox,ie.xStep,ie.yStep,Dt).id),X("q"),X("/Pattern cs"),X("/"+At+" scn"),Nt.gState&&p.setGState(Nt.gState),X(Qe),X("Q")}},Pu=function(ie){switch(ie){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},Ra=p.moveTo=function(ie,Qe){return X(w(T(ie))+" "+w(H(Qe))+" m"),this},Dn=p.lineTo=function(ie,Qe){return X(w(T(ie))+" "+w(H(Qe))+" l"),this},gn=p.curveTo=function(ie,Qe,At,Nt,Dt,zt){return X([w(T(ie)),w(H(Qe)),w(T(At)),w(H(Nt)),w(T(Dt)),w(H(zt)),"c"].join(" ")),this};p.__private__.line=p.line=function(ie,Qe,At,Nt,Dt){if(isNaN(ie)||isNaN(Qe)||isNaN(At)||isNaN(Nt)||!Ki(Dt))throw new Error("Invalid arguments passed to jsPDF.line");return N===j.COMPAT?this.lines([[At-ie,Nt-Qe]],ie,Qe,[1,1],Dt||"S"):this.lines([[At-ie,Nt-Qe]],ie,Qe,[1,1]).stroke()},p.__private__.lines=p.lines=function(ie,Qe,At,Nt,Dt,zt){var cs,ws,Rs,sr,er,xr,ia,fa,Ca,vn,tn,pl;if(typeof ie=="number"&&(pl=At,At=Qe,Qe=ie,ie=pl),Nt=Nt||[1,1],zt=zt||!1,isNaN(Qe)||isNaN(At)||!Array.isArray(ie)||!Array.isArray(Nt)||!Ki(Dt)||typeof zt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Ra(Qe,At),cs=Nt[0],ws=Nt[1],sr=ie.length,vn=Qe,tn=At,Rs=0;Rs<sr;Rs++)(er=ie[Rs]).length===2?(vn=er[0]*cs+vn,tn=er[1]*ws+tn,Dn(vn,tn)):(xr=er[0]*cs+vn,ia=er[1]*ws+tn,fa=er[2]*cs+vn,Ca=er[3]*ws+tn,vn=er[4]*cs+vn,tn=er[5]*ws+tn,gn(xr,ia,fa,Ca,vn,tn));return zt&&Jn(),fo(Dt),this},p.path=function(ie){for(var Qe=0;Qe<ie.length;Qe++){var At=ie[Qe],Nt=At.c;switch(At.op){case"m":Ra(Nt[0],Nt[1]);break;case"l":Dn(Nt[0],Nt[1]);break;case"c":gn.apply(this,Nt);break;case"h":Jn()}}return this},p.__private__.rect=p.rect=function(ie,Qe,At,Nt,Dt){if(isNaN(ie)||isNaN(Qe)||isNaN(At)||isNaN(Nt)||!Ki(Dt))throw new Error("Invalid arguments passed to jsPDF.rect");return N===j.COMPAT&&(Nt=-Nt),X([w(T(ie)),w(H(Qe)),w(T(At)),w(T(Nt)),"re"].join(" ")),fo(Dt),this},p.__private__.triangle=p.triangle=function(ie,Qe,At,Nt,Dt,zt,cs){if(isNaN(ie)||isNaN(Qe)||isNaN(At)||isNaN(Nt)||isNaN(Dt)||isNaN(zt)||!Ki(cs))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[At-ie,Nt-Qe],[Dt-At,zt-Nt],[ie-Dt,Qe-zt]],ie,Qe,[1,1],cs,!0),this},p.__private__.roundedRect=p.roundedRect=function(ie,Qe,At,Nt,Dt,zt,cs){if(isNaN(ie)||isNaN(Qe)||isNaN(At)||isNaN(Nt)||isNaN(Dt)||isNaN(zt)||!Ki(cs))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var ws=4/3*(Math.SQRT2-1);return Dt=Math.min(Dt,.5*At),zt=Math.min(zt,.5*Nt),this.lines([[At-2*Dt,0],[Dt*ws,0,Dt,zt-zt*ws,Dt,zt],[0,Nt-2*zt],[0,zt*ws,-Dt*ws,zt,-Dt,zt],[2*Dt-At,0],[-Dt*ws,0,-Dt,-zt*ws,-Dt,-zt],[0,2*zt-Nt],[0,-zt*ws,Dt*ws,-zt,Dt,-zt]],ie+Dt,Qe,[1,1],cs,!0),this},p.__private__.ellipse=p.ellipse=function(ie,Qe,At,Nt,Dt){if(isNaN(ie)||isNaN(Qe)||isNaN(At)||isNaN(Nt)||!Ki(Dt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var zt=4/3*(Math.SQRT2-1)*At,cs=4/3*(Math.SQRT2-1)*Nt;return Ra(ie+At,Qe),gn(ie+At,Qe-cs,ie+zt,Qe-Nt,ie,Qe-Nt),gn(ie-zt,Qe-Nt,ie-At,Qe-cs,ie-At,Qe),gn(ie-At,Qe+cs,ie-zt,Qe+Nt,ie,Qe+Nt),gn(ie+zt,Qe+Nt,ie+At,Qe+cs,ie+At,Qe),fo(Dt),this},p.__private__.circle=p.circle=function(ie,Qe,At,Nt){if(isNaN(ie)||isNaN(Qe)||isNaN(At)||!Ki(Nt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(ie,Qe,At,At,Nt)},p.setFont=function(ie,Qe,At){return At&&(Qe=I(Qe,At)),fe=uo(ie,Qe,{disableWarning:!1}),this};var po=p.__private__.getFont=p.getFont=function(){return Je[uo.apply(p,arguments)]};p.__private__.getFontList=p.getFontList=function(){var ie,Qe,At={};for(ie in xe)if(xe.hasOwnProperty(ie))for(Qe in At[ie]=[],xe[ie])xe[ie].hasOwnProperty(Qe)&&At[ie].push(Qe);return At},p.addFont=function(ie,Qe,At,Nt,Dt){var zt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&zt.indexOf(arguments[3])!==-1?Dt=arguments[3]:arguments[3]&&zt.indexOf(arguments[3])==-1&&(At=I(At,Nt)),Dt=Dt||"Identity-H",Ci.call(this,ie,Qe,At,Dt)};var Be,lt=t.lineWidth||.200025,ut=p.__private__.getLineWidth=p.getLineWidth=function(){return lt},yt=p.__private__.setLineWidth=p.setLineWidth=function(ie){return lt=ie,X(w(T(ie))+" w"),this};p.__private__.setLineDash=hs.API.setLineDash=hs.API.setLineDashPattern=function(ie,Qe){if(ie=ie||[],Qe=Qe||0,isNaN(Qe)||!Array.isArray(ie))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return ie=ie.map((function(At){return w(T(At))})).join(" "),Qe=w(T(Qe)),X("["+ie+"] "+Qe+" d"),this};var It=p.__private__.getLineHeight=p.getLineHeight=function(){return _e*Be};p.__private__.getLineHeight=p.getLineHeight=function(){return _e*Be};var Lt=p.__private__.setLineHeightFactor=p.setLineHeightFactor=function(ie){return typeof(ie=ie||1.15)=="number"&&(Be=ie),this},qt=p.__private__.getLineHeightFactor=p.getLineHeightFactor=function(){return Be};Lt(t.lineHeight);var ss=p.__private__.getHorizontalCoordinate=function(ie){return T(ie)},$t=p.__private__.getVerticalCoordinate=function(ie){return N===j.ADVANCED?ie:ht[k].mediaBox.topRightY-ht[k].mediaBox.bottomLeftY-T(ie)},ms=p.__private__.getHorizontalCoordinateString=p.getHorizontalCoordinateString=function(ie){return w(ss(ie))},Ns=p.__private__.getVerticalCoordinateString=p.getVerticalCoordinateString=function(ie){return w($t(ie))},rs=t.strokeColor||"0 G";p.__private__.getStrokeColor=p.getDrawColor=function(){return Me(rs)},p.__private__.setStrokeColor=p.setDrawColor=function(ie,Qe,At,Nt){return rs=Ve({ch1:ie,ch2:Qe,ch3:At,ch4:Nt,pdfColorType:"draw",precision:2}),X(rs),this};var ns=t.fillColor||"0 g";p.__private__.getFillColor=p.getFillColor=function(){return Me(ns)},p.__private__.setFillColor=p.setFillColor=function(ie,Qe,At,Nt){return ns=Ve({ch1:ie,ch2:Qe,ch3:At,ch4:Nt,pdfColorType:"fill",precision:2}),X(ns),this};var os=t.textColor||"0 g",fs=p.__private__.getTextColor=p.getTextColor=function(){return Me(os)};p.__private__.setTextColor=p.setTextColor=function(ie,Qe,At,Nt){return os=Ve({ch1:ie,ch2:Qe,ch3:At,ch4:Nt,pdfColorType:"text",precision:3}),this};var or=t.charSpace,cn=p.__private__.getCharSpace=p.getCharSpace=function(){return parseFloat(or||0)};p.__private__.setCharSpace=p.setCharSpace=function(ie){if(isNaN(ie))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return or=ie,this};var aa=0;p.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},p.__private__.setLineCap=p.setLineCap=function(ie){var Qe=p.CapJoinStyles[ie];if(Qe===void 0)throw new Error("Line cap style of '"+ie+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return aa=Qe,X(Qe+" J"),this};var pr=0;p.__private__.setLineJoin=p.setLineJoin=function(ie){var Qe=p.CapJoinStyles[ie];if(Qe===void 0)throw new Error("Line join style of '"+ie+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return pr=Qe,X(Qe+" j"),this},p.__private__.setLineMiterLimit=p.__private__.setMiterLimit=p.setLineMiterLimit=p.setMiterLimit=function(ie){if(ie=ie||0,isNaN(ie))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return X(w(T(ie))+" M"),this},p.GState=N0,p.setGState=function(ie){(ie=typeof ie=="string"?Ee[dt[ie]]:na(null,ie)).equals(mt)||(X("/"+ie.id+" gs"),mt=ie)};var na=function(ie,Qe){if(!ie||!dt[ie]){var At=!1;for(var Nt in Ee)if(Ee.hasOwnProperty(Nt)&&Ee[Nt].equals(Qe)){At=!0;break}if(At)Qe=Ee[Nt];else{var Dt="GS"+(Object.keys(Ee).length+1).toString(10);Ee[Dt]=Qe,Qe.id=Dt}return ie&&(dt[ie]=Qe.id),ft.publish("addGState",Qe),Qe}};p.addGState=function(ie,Qe){return na(ie,Qe),this},p.saveGraphicsState=function(){return X("q"),ye.push({key:fe,size:_e,color:os}),this},p.restoreGraphicsState=function(){X("Q");var ie=ye.pop();return fe=ie.key,_e=ie.size,os=ie.color,mt=null,this},p.setCurrentTransformationMatrix=function(ie){return X(ie.toString()+" cm"),this},p.comment=function(ie){return X("#"+ie),this};var tr=function(ie,Qe){var At=ie||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return At},set:function(zt){isNaN(zt)||(At=parseFloat(zt))}});var Nt=Qe||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Nt},set:function(zt){isNaN(zt)||(Nt=parseFloat(zt))}});var Dt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Dt},set:function(zt){Dt=zt.toString()}}),this},ba=function(ie,Qe,At,Nt){tr.call(this,ie,Qe),this.type="rect";var Dt=At||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Dt},set:function(cs){isNaN(cs)||(Dt=parseFloat(cs))}});var zt=Nt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return zt},set:function(cs){isNaN(cs)||(zt=parseFloat(cs))}}),this},Zn=function(){this.page=it,this.currentPage=k,this.pages=ae.slice(0),this.pagesContext=ht.slice(0),this.x=Ue,this.y=Ye,this.matrix=Ke,this.width=ei(k),this.height=rc(k),this.outputDestination=ue,this.id="",this.objectNumber=-1};Zn.prototype.restore=function(){it=this.page,k=this.currentPage,ht=this.pagesContext,ae=this.pages,Ue=this.x,Ye=this.y,Ke=this.matrix,Rc(k,this.width),Uu(k,this.height),ue=this.outputDestination};var Pl=function(ie,Qe,At,Nt,Dt){je.push(new Zn),it=k=0,ae=[],Ue=ie,Ye=Qe,Ke=Dt,co([At,Nt])},rr=function(ie){if(at[ie])je.pop().restore();else{var Qe=new Zn,At="Xo"+(Object.keys(Ge).length+1).toString(10);Qe.id=At,at[ie]=At,Ge[At]=Qe,ft.publish("addFormObject",Qe),je.pop().restore()}};for(var zr in p.beginFormObject=function(ie,Qe,At,Nt,Dt){return Pl(ie,Qe,At,Nt,Dt),this},p.endFormObject=function(ie){return rr(ie),this},p.doFormObject=function(ie,Qe){var At=Ge[at[ie]];return X("q"),X(Qe.toString()+" cm"),X("/"+At.id+" Do"),X("Q"),this},p.getFormObject=function(ie){var Qe=Ge[at[ie]];return{x:Qe.x,y:Qe.y,width:Qe.width,height:Qe.height,matrix:Qe.matrix}},p.save=function(ie,Qe){return ie=ie||"generated.pdf",(Qe=Qe||{}).returnPromise=Qe.returnPromise||!1,Qe.returnPromise===!1?(cm(mo(ki()),ie),typeof cm.unload=="function"&&Gs.setTimeout&&setTimeout(cm.unload,911),this):new Promise((function(At,Nt){try{var Dt=cm(mo(ki()),ie);typeof cm.unload=="function"&&Gs.setTimeout&&setTimeout(cm.unload,911),At(Dt)}catch(zt){Nt(zt.message)}}))},hs.API)hs.API.hasOwnProperty(zr)&&(zr==="events"&&hs.API.events.length?(function(ie,Qe){var At,Nt,Dt;for(Dt=Qe.length-1;Dt!==-1;Dt--)At=Qe[Dt][0],Nt=Qe[Dt][1],ie.subscribe.apply(ie,[At].concat(typeof Nt=="function"?[Nt]:Nt))})(ft,hs.API.events):p[zr]=hs.API[zr]);var ei=p.getPageWidth=function(ie){return(ht[ie=ie||k].mediaBox.topRightX-ht[ie].mediaBox.bottomLeftX)/he},Rc=p.setPageWidth=function(ie,Qe){ht[ie].mediaBox.topRightX=Qe*he+ht[ie].mediaBox.bottomLeftX},rc=p.getPageHeight=function(ie){return(ht[ie=ie||k].mediaBox.topRightY-ht[ie].mediaBox.bottomLeftY)/he},Uu=p.setPageHeight=function(ie,Qe){ht[ie].mediaBox.topRightY=Qe*he+ht[ie].mediaBox.bottomLeftY};return p.internal={pdfEscape:Pa,getStyle:Ua,getFont:po,getFontSize:Le,getCharSpace:cn,getTextColor:fs,getLineHeight:It,getLineHeightFactor:qt,getLineWidth:ut,write:me,getHorizontalCoordinate:ss,getVerticalCoordinate:$t,getCoordinateString:ms,getVerticalCoordinateString:Ns,collections:{},newObject:jt,newAdditionalObject:ke,newObjectDeferred:Mt,newObjectDeferredBegin:Ne,getFilters:vt,putStream:St,events:ft,scaleFactor:he,pageSize:{getWidth:function(){return ei(k)},setWidth:function(ie){Rc(k,ie)},getHeight:function(){return rc(k)},setHeight:function(ie){Uu(k,ie)}},encryptionOptions:c,encryption:Ir,getEncryptor:Yn,output:Dl,getNumberOfPages:Pc,pages:ae,out:X,f2:R,f3:U,getPageInfo:Xn,getPageInfoByObjId:Os,getCurrentPageInfo:ho,getPDFVersion:x,Point:tr,Rectangle:ba,Matrix:Se,hasHotfix:Wi},Object.defineProperty(p.internal.pageSize,"width",{get:function(){return ei(k)},set:function(ie){Rc(k,ie)},enumerable:!0,configurable:!0}),Object.defineProperty(p.internal.pageSize,"height",{get:function(){return rc(k)},set:function(ie){Uu(k,ie)},enumerable:!0,configurable:!0}),Vi.call(p,Ie),fe="F1",Jo(n,r),ft.publish("initialized"),p}Nh.prototype.lsbFirstWord=function(t){return String.fromCharCode(t>>0&255,t>>8&255,t>>16&255,t>>24&255)},Nh.prototype.toHexString=function(t){return t.split("").map((function(s){return("0"+(255&s.charCodeAt(0)).toString(16)).slice(-2)})).join("")},Nh.prototype.hexToBytes=function(t){for(var s=[],r=0;r<t.length;r+=2)s.push(String.fromCharCode(parseInt(t.substr(r,2),16)));return s.join("")},Nh.prototype.processOwnerPassword=function(t,s){return Uy(Py(s).substr(0,5),t)},Nh.prototype.encryptor=function(t,s){var r=Py(this.encryptionKey+String.fromCharCode(255&t,t>>8&255,t>>16&255,255&s,s>>8&255)).substr(0,10);return function(a){return Uy(r,a)}},N0.prototype.equals=function(t){var s,r="id,objectNumber,equals";if(!t||Wr(t)!==Wr(this))return!1;var a=0;for(s in this)if(!(r.indexOf(s)>=0)){if(this.hasOwnProperty(s)&&!t.hasOwnProperty(s)||this[s]!==t[s])return!1;a++}for(s in t)t.hasOwnProperty(s)&&r.indexOf(s)<0&&a--;return a===0},hs.API={events:[]},hs.version="2.5.2";var Ta=hs.API,Xj=1,Lm=function(t){return t.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},uh=function(t){return t.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},ar=function(t){return t.toFixed(2)},iu=function(t){return t.toFixed(5)};Ta.__acroform__={};var Al=function(t,s){t.prototype=Object.create(s.prototype),t.prototype.constructor=t},I_=function(t){return t*Xj},vc=function(t){var s=new Q5,r=Ts.internal.getHeight(t)||0,a=Ts.internal.getWidth(t)||0;return s.BBox=[0,0,Number(ar(a)),Number(ar(r))],s},kR=Ta.__acroform__.setBit=function(t,s){if(t=t||0,s=s||0,isNaN(t)||isNaN(s))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return t|=1<<s},ER=Ta.__acroform__.clearBit=function(t,s){if(t=t||0,s=s||0,isNaN(t)||isNaN(s))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return t&=~(1<<s)},BR=Ta.__acroform__.getBit=function(t,s){if(isNaN(t)||isNaN(s))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return(t&1<<s)==0?0:1},Wa=Ta.__acroform__.getBitForPdf=function(t,s){if(isNaN(t)||isNaN(s))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return BR(t,s-1)},Ga=Ta.__acroform__.setBitForPdf=function(t,s){if(isNaN(t)||isNaN(s))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return kR(t,s-1)},Ka=Ta.__acroform__.clearBitForPdf=function(t,s){if(isNaN(t)||isNaN(s))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return ER(t,s-1)},FR=Ta.__acroform__.calculateCoordinates=function(t,s){var r=s.internal.getHorizontalCoordinate,a=s.internal.getVerticalCoordinate,n=t[0],i=t[1],l=t[2],o=t[3],d={};return d.lowerLeft_X=r(n)||0,d.lowerLeft_Y=a(i+o)||0,d.upperRight_X=r(n+l)||0,d.upperRight_Y=a(i)||0,[Number(ar(d.lowerLeft_X)),Number(ar(d.lowerLeft_Y)),Number(ar(d.upperRight_X)),Number(ar(d.upperRight_Y))]},TR=function(t){if(t.appearanceStreamContent)return t.appearanceStreamContent;if(t.V||t.DV){var s=[],r=t._V||t.DV,a=Ry(t,r),n=t.scope.internal.getFont(t.fontName,t.fontStyle).id;s.push("/Tx BMC"),s.push("q"),s.push("BT"),s.push(t.scope.__private__.encodeColorString(t.color)),s.push("/"+n+" "+ar(a.fontSize)+" Tf"),s.push("1 0 0 1 0 0 Tm"),s.push(a.text),s.push("ET"),s.push("Q"),s.push("EMC");var i=vc(t);return i.scope=t.scope,i.stream=s.join(`
`),i}},Ry=function(t,s){var r=t.fontSize===0?t.maxFontSize:t.fontSize,a={text:"",fontSize:""},n=(s=(s=s.substr(0,1)=="("?s.substr(1):s).substr(s.length-1)==")"?s.substr(0,s.length-1):s).split(" ");n=t.multiline?n.map((function(U){return U.split(`
`)})):n.map((function(U){return[U]}));var i=r,l=Ts.internal.getHeight(t)||0;l=l<0?-l:l;var o=Ts.internal.getWidth(t)||0;o=o<0?-o:o;var d=function(U,T,Y){if(U+1<n.length){var H=T+" "+n[U+1][0];return sx(H,t,Y).width<=o-4}return!1};i++;e:for(;i>0;){s="",i--;var u,c,h=sx("3",t,i).height,m=t.multiline?l-i:(l-h)/2,p=m+=2,g=0,x=0,b=0;if(i<=0){s=`(...) Tj
`,s+="% Width of Text: "+sx(s,t,i=12).width+", FieldWidth:"+o+`
`;break}for(var y="",j=0,N=0;N<n.length;N++)if(n.hasOwnProperty(N)){var _=!1;if(n[N].length!==1&&b!==n[N].length-1){if((h+2)*(j+2)+2>l)continue e;y+=n[N][b],_=!0,x=N,N--}else{y=(y+=n[N][b]+" ").substr(y.length-1)==" "?y.substr(0,y.length-1):y;var F=parseInt(N),I=d(F,y,i),w=N>=n.length-1;if(I&&!w){y+=" ",b=0;continue}if(I||w){if(w)x=F;else if(t.multiline&&(h+2)*(j+2)+2>l)continue e}else{if(!t.multiline||(h+2)*(j+2)+2>l)continue e;x=F}}for(var E="",W=g;W<=x;W++){var R=n[W];if(t.multiline){if(W===x){E+=R[b]+" ",b=(b+1)%R.length;continue}if(W===g){E+=R[R.length-1]+" ";continue}}E+=R[0]+" "}switch(E=E.substr(E.length-1)==" "?E.substr(0,E.length-1):E,c=sx(E,t,i).width,t.textAlign){case"right":u=o-c-2;break;case"center":u=(o-c)/2;break;case"left":default:u=2}s+=ar(u)+" "+ar(p)+` Td
`,s+="("+Lm(E)+`) Tj
`,s+=-ar(u)+` 0 Td
`,p=-(i+2),c=0,g=_?x:x+1,j++,y=""}break}return a.text=s,a.fontSize=i,a},sx=function(t,s,r){var a=s.scope.internal.getFont(s.fontName,s.fontStyle),n=s.scope.getStringUnitWidth(t,{font:a,fontSize:parseFloat(r),charSpace:0})*parseFloat(r);return{height:s.scope.getStringUnitWidth("3",{font:a,fontSize:parseFloat(r),charSpace:0})*parseFloat(r)*1.5,width:n}},IR={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},LR=function(t,s){var r={type:"reference",object:t};s.internal.getPageInfo(t.page).pageContext.annotations.find((function(a){return a.type===r.type&&a.object===r.object}))===void 0&&s.internal.getPageInfo(t.page).pageContext.annotations.push(r)},DR=function(t,s){for(var r in t)if(t.hasOwnProperty(r)){var a=r,n=t[r];s.internal.newObjectDeferredBegin(n.objId,!0),Wr(n)==="object"&&typeof n.putStream=="function"&&n.putStream(),delete t[a]}},PR=function(t,s){if(s.scope=t,t.internal!==void 0&&(t.internal.acroformPlugin===void 0||t.internal.acroformPlugin.isInitialized===!1)){if(zo.FieldNum=0,t.internal.acroformPlugin=JSON.parse(JSON.stringify(IR)),t.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Xj=t.internal.scaleFactor,t.internal.acroformPlugin.acroFormDictionaryRoot=new H5,t.internal.acroformPlugin.acroFormDictionaryRoot.scope=t,t.internal.acroformPlugin.acroFormDictionaryRoot._eventID=t.internal.events.subscribe("postPutResources",(function(){(function(r){r.internal.events.unsubscribe(r.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete r.internal.acroformPlugin.acroFormDictionaryRoot._eventID,r.internal.acroformPlugin.printedOut=!0})(t)})),t.internal.events.subscribe("buildDocument",(function(){(function(r){r.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var a=r.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var n in a)if(a.hasOwnProperty(n)){var i=a[n];i.objId=void 0,i.hasAnnotation&&LR(i,r)}})(t)})),t.internal.events.subscribe("putCatalog",(function(){(function(r){if(r.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");r.internal.write("/AcroForm "+r.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(t)})),t.internal.events.subscribe("postPutPages",(function(r){(function(a,n){var i=!a;for(var l in a||(n.internal.newObjectDeferredBegin(n.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),n.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),a=a||n.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(a.hasOwnProperty(l)){var o=a[l],d=[],u=o.Rect;if(o.Rect&&(o.Rect=FR(o.Rect,n)),n.internal.newObjectDeferredBegin(o.objId,!0),o.DA=Ts.createDefaultAppearanceStream(o),Wr(o)==="object"&&typeof o.getKeyValueListForStream=="function"&&(d=o.getKeyValueListForStream()),o.Rect=u,o.hasAppearanceStream&&!o.appearanceStreamContent){var c=TR(o);d.push({key:"AP",value:"<</N "+c+">>"}),n.internal.acroformPlugin.xForms.push(c)}if(o.appearanceStreamContent){var h="";for(var m in o.appearanceStreamContent)if(o.appearanceStreamContent.hasOwnProperty(m)){var p=o.appearanceStreamContent[m];if(h+="/"+m+" ",h+="<<",Object.keys(p).length>=1||Array.isArray(p)){for(var l in p)if(p.hasOwnProperty(l)){var g=p[l];typeof g=="function"&&(g=g.call(n,o)),h+="/"+l+" "+g+" ",n.internal.acroformPlugin.xForms.indexOf(g)>=0||n.internal.acroformPlugin.xForms.push(g)}}else typeof(g=p)=="function"&&(g=g.call(n,o)),h+="/"+l+" "+g,n.internal.acroformPlugin.xForms.indexOf(g)>=0||n.internal.acroformPlugin.xForms.push(g);h+=">>"}d.push({key:"AP",value:`<<
`+h+">>"})}n.internal.putStream({additionalKeyValues:d,objectId:o.objId}),n.internal.out("endobj")}i&&DR(n.internal.acroformPlugin.xForms,n)})(r,t)})),t.internal.acroformPlugin.isInitialized=!0}},M5=Ta.__acroform__.arrayToPdfArray=function(t,s,r){var a=function(l){return l};if(Array.isArray(t)){for(var n="[",i=0;i<t.length;i++)switch(i!==0&&(n+=" "),Wr(t[i])){case"boolean":case"number":case"object":n+=t[i].toString();break;case"string":t[i].substr(0,1)!=="/"?(s!==void 0&&r&&(a=r.internal.getEncryptor(s)),n+="("+Lm(a(t[i].toString()))+")"):n+=t[i].toString()}return n+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},lb=function(t,s,r){var a=function(n){return n};return s!==void 0&&r&&(a=r.internal.getEncryptor(s)),(t=t||"").toString(),t="("+Lm(a(t))+")"},jc=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(t){this._objId=t}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};jc.prototype.toString=function(){return this.objId+" 0 R"},jc.prototype.putStream=function(){var t=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:t,objectId:this.objId}),this.scope.internal.out("endobj")},jc.prototype.getKeyValueListForStream=function(){var t=[],s=Object.getOwnPropertyNames(this).filter((function(i){return i!="content"&&i!="appearanceStreamContent"&&i!="scope"&&i!="objId"&&i.substring(0,1)!="_"}));for(var r in s)if(Object.getOwnPropertyDescriptor(this,s[r]).configurable===!1){var a=s[r],n=this[a];n&&(Array.isArray(n)?t.push({key:a,value:M5(n,this.objId,this.scope)}):n instanceof jc?(n.scope=this.scope,t.push({key:a,value:n.objId+" 0 R"})):typeof n!="function"&&t.push({key:a,value:n}))}return t};var Q5=function(){jc.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var t,s=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return s},set:function(r){s=r}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(r){t=r.trim()},get:function(){return t||null}})};Al(Q5,jc);var H5=function(){jc.call(this);var t,s=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return s.length>0?s:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return s}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(t){var r=function(a){return a};return this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),"("+Lm(r(t))+")"}},set:function(r){t=r}})};Al(H5,jc);var zo=function t(){jc.call(this);var s=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return s},set:function(y){if(isNaN(y))throw new Error('Invalid value "'+y+'" for attribute F supplied.');s=y}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Wa(s,3)},set:function(y){y?this.F=Ga(s,3):this.F=Ka(s,3)}});var r=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return r},set:function(y){if(isNaN(y))throw new Error('Invalid value "'+y+'" for attribute Ff supplied.');r=y}});var a=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(a.length!==0)return a},set:function(y){a=y!==void 0?y:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!a||isNaN(a[0])?0:a[0]},set:function(y){a[0]=y}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!a||isNaN(a[1])?0:a[1]},set:function(y){a[1]=y}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!a||isNaN(a[2])?0:a[2]},set:function(y){a[2]=y}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!a||isNaN(a[3])?0:a[3]},set:function(y){a[3]=y}});var n="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return n},set:function(y){switch(y){case"/Btn":case"/Tx":case"/Ch":case"/Sig":n=y;break;default:throw new Error('Invalid value "'+y+'" for attribute FT supplied.')}}});var i=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!i||i.length<1){if(this instanceof w0)return;i="FieldObject"+t.FieldNum++}var y=function(j){return j};return this.scope&&(y=this.scope.internal.getEncryptor(this.objId)),"("+Lm(y(i))+")"},set:function(y){i=y.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return i},set:function(y){i=y}});var l="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return l},set:function(y){l=y}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(y){o=y}});var d=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return d},set:function(y){d=y}});var u=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return u===void 0?50/Xj:u},set:function(y){u=y}});var c="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return c},set:function(y){c=y}});var h="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!h||this instanceof w0||this instanceof vm))return lb(h,this.objId,this.scope)},set:function(y){y=y.toString(),h=y}});var m=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(m)return this instanceof En?m:lb(m,this.objId,this.scope)},set:function(y){y=y.toString(),m=this instanceof En?y:y.substr(0,1)==="("?uh(y.substr(1,y.length-2)):uh(y)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof En?uh(m.substr(1,m.length-1)):m},set:function(y){y=y.toString(),m=this instanceof En?"/"+y:y}});var p=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(p)return p},set:function(y){this.V=y}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(p)return this instanceof En?p:lb(p,this.objId,this.scope)},set:function(y){y=y.toString(),p=this instanceof En?y:y.substr(0,1)==="("?uh(y.substr(1,y.length-2)):uh(y)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof En?uh(p.substr(1,p.length-1)):p},set:function(y){y=y.toString(),p=this instanceof En?"/"+y:y}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var g,x=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return x},set:function(y){y=!!y,x=y}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(g)return g},set:function(y){g=y}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,1)},set:function(y){y?this.Ff=Ga(this.Ff,1):this.Ff=Ka(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,2)},set:function(y){y?this.Ff=Ga(this.Ff,2):this.Ff=Ka(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,3)},set:function(y){y?this.Ff=Ga(this.Ff,3):this.Ff=Ka(this.Ff,3)}});var b=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(b!==null)return b},set:function(y){if([0,1,2].indexOf(y)===-1)throw new Error('Invalid value "'+y+'" for attribute Q supplied.');b=y}}),Object.defineProperty(this,"textAlign",{get:function(){var y;switch(b){case 0:default:y="left";break;case 1:y="center";break;case 2:y="right"}return y},configurable:!0,enumerable:!0,set:function(y){switch(y){case"right":case 2:b=2;break;case"center":case 1:b=1;break;case"left":case 0:default:b=0}}})};Al(zo,jc);var Ih=function(){zo.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var t=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return t},set:function(r){t=r}});var s=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return M5(s,this.objId,this.scope)},set:function(r){var a,n;n=[],typeof(a=r)=="string"&&(n=(function(i,l,o){o||(o=1);for(var d,u=[];d=l.exec(i);)u.push(d[o]);return u})(a,/\((.*?)\)/g)),s=n}}),this.getOptions=function(){return s},this.setOptions=function(r){s=r,this.sort&&s.sort()},this.addOption=function(r){r=(r=r||"").toString(),s.push(r),this.sort&&s.sort()},this.removeOption=function(r,a){for(a=a||!1,r=(r=r||"").toString();s.indexOf(r)!==-1&&(s.splice(s.indexOf(r),1),a!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,18)},set:function(r){r?this.Ff=Ga(this.Ff,18):this.Ff=Ka(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,19)},set:function(r){this.combo===!0&&(r?this.Ff=Ga(this.Ff,19):this.Ff=Ka(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,20)},set:function(r){r?(this.Ff=Ga(this.Ff,20),s.sort()):this.Ff=Ka(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,22)},set:function(r){r?this.Ff=Ga(this.Ff,22):this.Ff=Ka(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,23)},set:function(r){r?this.Ff=Ga(this.Ff,23):this.Ff=Ka(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,27)},set:function(r){r?this.Ff=Ga(this.Ff,27):this.Ff=Ka(this.Ff,27)}}),this.hasAppearanceStream=!1};Al(Ih,zo);var Lh=function(){Ih.call(this),this.fontName="helvetica",this.combo=!1};Al(Lh,Ih);var Dh=function(){Lh.call(this),this.combo=!0};Al(Dh,Lh);var e0=function(){Dh.call(this),this.edit=!0};Al(e0,Dh);var En=function(){zo.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,15)},set:function(r){r?this.Ff=Ga(this.Ff,15):this.Ff=Ka(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,16)},set:function(r){r?this.Ff=Ga(this.Ff,16):this.Ff=Ka(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,17)},set:function(r){r?this.Ff=Ga(this.Ff,17):this.Ff=Ka(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,26)},set:function(r){r?this.Ff=Ga(this.Ff,26):this.Ff=Ka(this.Ff,26)}});var t,s={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(i){return i};if(this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),Object.keys(s).length!==0){var a,n=[];for(a in n.push("<<"),s)n.push("/"+a+" ("+Lm(r(s[a]))+")");return n.push(">>"),n.join(`
`)}},set:function(r){Wr(r)==="object"&&(s=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return s.CA||""},set:function(r){typeof r=="string"&&(s.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(r){t="/"+r}})};Al(En,zo);var t0=function(){En.call(this),this.pushButton=!0};Al(t0,En);var Ph=function(){En.call(this),this.radio=!0,this.pushButton=!1;var t=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return t},set:function(s){t=s!==void 0?s:[]}})};Al(Ph,En);var w0=function(){var t,s;zo.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return t},set:function(n){t=n}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return s},set:function(n){s=n}});var r,a={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var n=function(o){return o};this.scope&&(n=this.scope.internal.getEncryptor(this.objId));var i,l=[];for(i in l.push("<<"),a)l.push("/"+i+" ("+Lm(n(a[i]))+")");return l.push(">>"),l.join(`
`)},set:function(n){Wr(n)==="object"&&(a=n)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return a.CA||""},set:function(n){typeof n=="string"&&(a.CA=n)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(n){r=n}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(n){r="/"+n}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Ts.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Al(w0,zo),Ph.prototype.setAppearance=function(t){if(!("createAppearanceStream"in t)||!("getCA"in t))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var s in this.Kids)if(this.Kids.hasOwnProperty(s)){var r=this.Kids[s];r.appearanceStreamContent=t.createAppearanceStream(r.optionName),r.caption=t.getCA()}},Ph.prototype.createOption=function(t){var s=new w0;return s.Parent=this,s.optionName=t,this.Kids.push(s),UR.call(this.scope,s),s};var s0=function(){En.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Ts.CheckBox.createAppearanceStream()};Al(s0,En);var vm=function(){zo.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,13)},set:function(s){s?this.Ff=Ga(this.Ff,13):this.Ff=Ka(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,21)},set:function(s){s?this.Ff=Ga(this.Ff,21):this.Ff=Ka(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,23)},set:function(s){s?this.Ff=Ga(this.Ff,23):this.Ff=Ka(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,24)},set:function(s){s?this.Ff=Ga(this.Ff,24):this.Ff=Ka(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,25)},set:function(s){s?this.Ff=Ga(this.Ff,25):this.Ff=Ka(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,26)},set:function(s){s?this.Ff=Ga(this.Ff,26):this.Ff=Ka(this.Ff,26)}});var t=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return t},set:function(s){t=s}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return t},set:function(s){Number.isInteger(s)&&(t=s)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Al(vm,zo);var r0=function(){vm.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Wa(this.Ff,14)},set:function(t){t?this.Ff=Ga(this.Ff,14):this.Ff=Ka(this.Ff,14)}}),this.password=!0};Al(r0,vm);var Ts={CheckBox:{createAppearanceStream:function(){return{N:{On:Ts.CheckBox.YesNormal},D:{On:Ts.CheckBox.YesPushDown,Off:Ts.CheckBox.OffPushDown}}},YesPushDown:function(t){var s=vc(t);s.scope=t.scope;var r=[],a=t.scope.internal.getFont(t.fontName,t.fontStyle).id,n=t.scope.__private__.encodeColorString(t.color),i=Ry(t,t.caption);return r.push("0.749023 g"),r.push("0 0 "+ar(Ts.internal.getWidth(t))+" "+ar(Ts.internal.getHeight(t))+" re"),r.push("f"),r.push("BMC"),r.push("q"),r.push("0 0 1 rg"),r.push("/"+a+" "+ar(i.fontSize)+" Tf "+n),r.push("BT"),r.push(i.text),r.push("ET"),r.push("Q"),r.push("EMC"),s.stream=r.join(`
`),s},YesNormal:function(t){var s=vc(t);s.scope=t.scope;var r=t.scope.internal.getFont(t.fontName,t.fontStyle).id,a=t.scope.__private__.encodeColorString(t.color),n=[],i=Ts.internal.getHeight(t),l=Ts.internal.getWidth(t),o=Ry(t,t.caption);return n.push("1 g"),n.push("0 0 "+ar(l)+" "+ar(i)+" re"),n.push("f"),n.push("q"),n.push("0 0 1 rg"),n.push("0 0 "+ar(l-1)+" "+ar(i-1)+" re"),n.push("W"),n.push("n"),n.push("0 g"),n.push("BT"),n.push("/"+r+" "+ar(o.fontSize)+" Tf "+a),n.push(o.text),n.push("ET"),n.push("Q"),s.stream=n.join(`
`),s},OffPushDown:function(t){var s=vc(t);s.scope=t.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+ar(Ts.internal.getWidth(t))+" "+ar(Ts.internal.getHeight(t))+" re"),r.push("f"),s.stream=r.join(`
`),s}},RadioButton:{Circle:{createAppearanceStream:function(t){var s={D:{Off:Ts.RadioButton.Circle.OffPushDown},N:{}};return s.N[t]=Ts.RadioButton.Circle.YesNormal,s.D[t]=Ts.RadioButton.Circle.YesPushDown,s},getCA:function(){return"l"},YesNormal:function(t){var s=vc(t);s.scope=t.scope;var r=[],a=Ts.internal.getWidth(t)<=Ts.internal.getHeight(t)?Ts.internal.getWidth(t)/4:Ts.internal.getHeight(t)/4;a=Number((.9*a).toFixed(5));var n=Ts.internal.Bezier_C,i=Number((a*n).toFixed(5));return r.push("q"),r.push("1 0 0 1 "+iu(Ts.internal.getWidth(t)/2)+" "+iu(Ts.internal.getHeight(t)/2)+" cm"),r.push(a+" 0 m"),r.push(a+" "+i+" "+i+" "+a+" 0 "+a+" c"),r.push("-"+i+" "+a+" -"+a+" "+i+" -"+a+" 0 c"),r.push("-"+a+" -"+i+" -"+i+" -"+a+" 0 -"+a+" c"),r.push(i+" -"+a+" "+a+" -"+i+" "+a+" 0 c"),r.push("f"),r.push("Q"),s.stream=r.join(`
`),s},YesPushDown:function(t){var s=vc(t);s.scope=t.scope;var r=[],a=Ts.internal.getWidth(t)<=Ts.internal.getHeight(t)?Ts.internal.getWidth(t)/4:Ts.internal.getHeight(t)/4;a=Number((.9*a).toFixed(5));var n=Number((2*a).toFixed(5)),i=Number((n*Ts.internal.Bezier_C).toFixed(5)),l=Number((a*Ts.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+iu(Ts.internal.getWidth(t)/2)+" "+iu(Ts.internal.getHeight(t)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+i+" "+i+" "+n+" 0 "+n+" c"),r.push("-"+i+" "+n+" -"+n+" "+i+" -"+n+" 0 c"),r.push("-"+n+" -"+i+" -"+i+" -"+n+" 0 -"+n+" c"),r.push(i+" -"+n+" "+n+" -"+i+" "+n+" 0 c"),r.push("f"),r.push("Q"),r.push("0 g"),r.push("q"),r.push("1 0 0 1 "+iu(Ts.internal.getWidth(t)/2)+" "+iu(Ts.internal.getHeight(t)/2)+" cm"),r.push(a+" 0 m"),r.push(a+" "+l+" "+l+" "+a+" 0 "+a+" c"),r.push("-"+l+" "+a+" -"+a+" "+l+" -"+a+" 0 c"),r.push("-"+a+" -"+l+" -"+l+" -"+a+" 0 -"+a+" c"),r.push(l+" -"+a+" "+a+" -"+l+" "+a+" 0 c"),r.push("f"),r.push("Q"),s.stream=r.join(`
`),s},OffPushDown:function(t){var s=vc(t);s.scope=t.scope;var r=[],a=Ts.internal.getWidth(t)<=Ts.internal.getHeight(t)?Ts.internal.getWidth(t)/4:Ts.internal.getHeight(t)/4;a=Number((.9*a).toFixed(5));var n=Number((2*a).toFixed(5)),i=Number((n*Ts.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+iu(Ts.internal.getWidth(t)/2)+" "+iu(Ts.internal.getHeight(t)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+i+" "+i+" "+n+" 0 "+n+" c"),r.push("-"+i+" "+n+" -"+n+" "+i+" -"+n+" 0 c"),r.push("-"+n+" -"+i+" -"+i+" -"+n+" 0 -"+n+" c"),r.push(i+" -"+n+" "+n+" -"+i+" "+n+" 0 c"),r.push("f"),r.push("Q"),s.stream=r.join(`
`),s}},Cross:{createAppearanceStream:function(t){var s={D:{Off:Ts.RadioButton.Cross.OffPushDown},N:{}};return s.N[t]=Ts.RadioButton.Cross.YesNormal,s.D[t]=Ts.RadioButton.Cross.YesPushDown,s},getCA:function(){return"8"},YesNormal:function(t){var s=vc(t);s.scope=t.scope;var r=[],a=Ts.internal.calculateCross(t);return r.push("q"),r.push("1 1 "+ar(Ts.internal.getWidth(t)-2)+" "+ar(Ts.internal.getHeight(t)-2)+" re"),r.push("W"),r.push("n"),r.push(ar(a.x1.x)+" "+ar(a.x1.y)+" m"),r.push(ar(a.x2.x)+" "+ar(a.x2.y)+" l"),r.push(ar(a.x4.x)+" "+ar(a.x4.y)+" m"),r.push(ar(a.x3.x)+" "+ar(a.x3.y)+" l"),r.push("s"),r.push("Q"),s.stream=r.join(`
`),s},YesPushDown:function(t){var s=vc(t);s.scope=t.scope;var r=Ts.internal.calculateCross(t),a=[];return a.push("0.749023 g"),a.push("0 0 "+ar(Ts.internal.getWidth(t))+" "+ar(Ts.internal.getHeight(t))+" re"),a.push("f"),a.push("q"),a.push("1 1 "+ar(Ts.internal.getWidth(t)-2)+" "+ar(Ts.internal.getHeight(t)-2)+" re"),a.push("W"),a.push("n"),a.push(ar(r.x1.x)+" "+ar(r.x1.y)+" m"),a.push(ar(r.x2.x)+" "+ar(r.x2.y)+" l"),a.push(ar(r.x4.x)+" "+ar(r.x4.y)+" m"),a.push(ar(r.x3.x)+" "+ar(r.x3.y)+" l"),a.push("s"),a.push("Q"),s.stream=a.join(`
`),s},OffPushDown:function(t){var s=vc(t);s.scope=t.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+ar(Ts.internal.getWidth(t))+" "+ar(Ts.internal.getHeight(t))+" re"),r.push("f"),s.stream=r.join(`
`),s}}},createDefaultAppearanceStream:function(t){var s=t.scope.internal.getFont(t.fontName,t.fontStyle).id,r=t.scope.__private__.encodeColorString(t.color);return"/"+s+" "+t.fontSize+" Tf "+r}};Ts.internal={Bezier_C:.551915024494,calculateCross:function(t){var s=Ts.internal.getWidth(t),r=Ts.internal.getHeight(t),a=Math.min(s,r);return{x1:{x:(s-a)/2,y:(r-a)/2+a},x2:{x:(s-a)/2+a,y:(r-a)/2},x3:{x:(s-a)/2,y:(r-a)/2},x4:{x:(s-a)/2+a,y:(r-a)/2+a}}}},Ts.internal.getWidth=function(t){var s=0;return Wr(t)==="object"&&(s=I_(t.Rect[2])),s},Ts.internal.getHeight=function(t){var s=0;return Wr(t)==="object"&&(s=I_(t.Rect[3])),s};var UR=Ta.addField=function(t){if(PR(this,t),!(t instanceof zo))throw new Error("Invalid argument passed to jsPDF.addField.");var s;return(s=t).scope.internal.acroformPlugin.printedOut&&(s.scope.internal.acroformPlugin.printedOut=!1,s.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),s.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(s),t.page=t.scope.internal.getCurrentPageInfo().pageNumber,this};Ta.AcroFormChoiceField=Ih,Ta.AcroFormListBox=Lh,Ta.AcroFormComboBox=Dh,Ta.AcroFormEditBox=e0,Ta.AcroFormButton=En,Ta.AcroFormPushButton=t0,Ta.AcroFormRadioButton=Ph,Ta.AcroFormCheckBox=s0,Ta.AcroFormTextField=vm,Ta.AcroFormPasswordField=r0,Ta.AcroFormAppearance=Ts,Ta.AcroForm={ChoiceField:Ih,ListBox:Lh,ComboBox:Dh,EditBox:e0,Button:En,PushButton:t0,RadioButton:Ph,CheckBox:s0,TextField:vm,PasswordField:r0,Appearance:Ts},hs.AcroForm={ChoiceField:Ih,ListBox:Lh,ComboBox:Dh,EditBox:e0,Button:En,PushButton:t0,RadioButton:Ph,CheckBox:s0,TextField:vm,PasswordField:r0,Appearance:Ts};hs.AcroForm;function q5(t){return t.reduce((function(s,r,a){return s[r]=a,s}),{})}(function(t){t.__addimage__={};var s="UNKNOWN",r={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},a=t.__addimage__.getImageFileTypeByImageData=function(U,T){var Y,H,M,q,z,Q=s;if((T=T||s)==="RGBA"||U.data!==void 0&&U.data instanceof Uint8ClampedArray&&"height"in U&&"width"in U)return"RGBA";if(I(U))for(z in r)for(M=r[z],Y=0;Y<M.length;Y+=1){for(q=!0,H=0;H<M[Y].length;H+=1)if(M[Y][H]!==void 0&&M[Y][H]!==U[H]){q=!1;break}if(q===!0){Q=z;break}}else for(z in r)for(M=r[z],Y=0;Y<M.length;Y+=1){for(q=!0,H=0;H<M[Y].length;H+=1)if(M[Y][H]!==void 0&&M[Y][H]!==U.charCodeAt(H)){q=!1;break}if(q===!0){Q=z;break}}return Q===s&&T!==s&&(Q=T),Q},n=function U(T){for(var Y=this.internal.write,H=this.internal.putStream,M=(0,this.internal.getFilters)();M.indexOf("FlateEncode")!==-1;)M.splice(M.indexOf("FlateEncode"),1);T.objectId=this.internal.newObject();var q=[];if(q.push({key:"Type",value:"/XObject"}),q.push({key:"Subtype",value:"/Image"}),q.push({key:"Width",value:T.width}),q.push({key:"Height",value:T.height}),T.colorSpace===b.INDEXED?q.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(T.palette.length/3-1)+" "+("sMask"in T&&T.sMask!==void 0?T.objectId+2:T.objectId+1)+" 0 R]"}):(q.push({key:"ColorSpace",value:"/"+T.colorSpace}),T.colorSpace===b.DEVICE_CMYK&&q.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),q.push({key:"BitsPerComponent",value:T.bitsPerComponent}),"decodeParameters"in T&&T.decodeParameters!==void 0&&q.push({key:"DecodeParms",value:"<<"+T.decodeParameters+">>"}),"transparency"in T&&Array.isArray(T.transparency)){for(var z="",Q=0,L=T.transparency.length;Q<L;Q++)z+=T.transparency[Q]+" "+T.transparency[Q]+" ";q.push({key:"Mask",value:"["+z+"]"})}T.sMask!==void 0&&q.push({key:"SMask",value:T.objectId+1+" 0 R"});var V=T.filter!==void 0?["/"+T.filter]:void 0;if(H({data:T.data,additionalKeyValues:q,alreadyAppliedFilters:V,objectId:T.objectId}),Y("endobj"),"sMask"in T&&T.sMask!==void 0){var P="/Predictor "+T.predictor+" /Colors 1 /BitsPerComponent "+T.bitsPerComponent+" /Columns "+T.width,C={width:T.width,height:T.height,colorSpace:"DeviceGray",bitsPerComponent:T.bitsPerComponent,decodeParameters:P,data:T.sMask};"filter"in T&&(C.filter=T.filter),U.call(this,C)}if(T.colorSpace===b.INDEXED){var k=this.internal.newObject();H({data:E(new Uint8Array(T.palette)),objectId:k}),Y("endobj")}},i=function(){var U=this.internal.collections.addImage_images;for(var T in U)n.call(this,U[T])},l=function(){var U,T=this.internal.collections.addImage_images,Y=this.internal.write;for(var H in T)Y("/I"+(U=T[H]).index,U.objectId,"0","R")},o=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",i),this.internal.events.subscribe("putXobjectDict",l))},d=function(){var U=this.internal.collections.addImage_images;return o.call(this),U},u=function(){return Object.keys(this.internal.collections.addImage_images).length},c=function(U){return typeof t["process"+U.toUpperCase()]=="function"},h=function(U){return Wr(U)==="object"&&U.nodeType===1},m=function(U,T){if(U.nodeName==="IMG"&&U.hasAttribute("src")){var Y=""+U.getAttribute("src");if(Y.indexOf("data:image/")===0)return rf(unescape(Y).split("base64,").pop());var H=t.loadFile(Y,!0);if(H!==void 0)return H}if(U.nodeName==="CANVAS"){if(U.width===0||U.height===0)throw new Error("Given canvas must have data. Canvas width: "+U.width+", height: "+U.height);var M;switch(T){case"PNG":M="image/png";break;case"WEBP":M="image/webp";break;case"JPEG":case"JPG":default:M="image/jpeg"}return rf(U.toDataURL(M,1).split("base64,").pop())}},p=function(U){var T=this.internal.collections.addImage_images;if(T){for(var Y in T)if(U===T[Y].alias)return T[Y]}},g=function(U,T,Y){return U||T||(U=-96,T=-96),U<0&&(U=-1*Y.width*72/U/this.internal.scaleFactor),T<0&&(T=-1*Y.height*72/T/this.internal.scaleFactor),U===0&&(U=T*Y.width/Y.height),T===0&&(T=U*Y.height/Y.width),[U,T]},x=function(U,T,Y,H,M,q){var z=g.call(this,Y,H,M),Q=this.internal.getCoordinateString,L=this.internal.getVerticalCoordinateString,V=d.call(this);if(Y=z[0],H=z[1],V[M.index]=M,q){q*=Math.PI/180;var P=Math.cos(q),C=Math.sin(q),k=function(G){return G.toFixed(4)},B=[k(P),k(C),k(-1*C),k(P),0,0,"cm"]}this.internal.write("q"),q?(this.internal.write([1,"0","0",1,Q(U),L(T+H),"cm"].join(" ")),this.internal.write(B.join(" ")),this.internal.write([Q(Y),"0","0",Q(H),"0","0","cm"].join(" "))):this.internal.write([Q(Y),"0","0",Q(H),Q(U),L(T+H),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+M.index+" Do"),this.internal.write("Q")},b=t.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};t.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var y=t.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},j=t.__addimage__.sHashCode=function(U){var T,Y,H=0;if(typeof U=="string")for(Y=U.length,T=0;T<Y;T++)H=(H<<5)-H+U.charCodeAt(T),H|=0;else if(I(U))for(Y=U.byteLength/2,T=0;T<Y;T++)H=(H<<5)-H+U[T],H|=0;return H},N=t.__addimage__.validateStringAsBase64=function(U){(U=U||"").toString().trim();var T=!0;return U.length===0&&(T=!1),U.length%4!=0&&(T=!1),/^[A-Za-z0-9+/]+$/.test(U.substr(0,U.length-2))===!1&&(T=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(U.substr(-2))===!1&&(T=!1),T},_=t.__addimage__.extractImageFromDataUrl=function(U){var T=(U=U||"").split("base64,"),Y=null;if(T.length===2){var H=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(T[0]);Array.isArray(H)&&(Y={mimeType:H[1],charset:H[2],data:T[1]})}return Y},F=t.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};t.__addimage__.isArrayBuffer=function(U){return F()&&U instanceof ArrayBuffer};var I=t.__addimage__.isArrayBufferView=function(U){return F()&&typeof Uint32Array<"u"&&(U instanceof Int8Array||U instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&U instanceof Uint8ClampedArray||U instanceof Int16Array||U instanceof Uint16Array||U instanceof Int32Array||U instanceof Uint32Array||U instanceof Float32Array||U instanceof Float64Array)},w=t.__addimage__.binaryStringToUint8Array=function(U){for(var T=U.length,Y=new Uint8Array(T),H=0;H<T;H++)Y[H]=U.charCodeAt(H);return Y},E=t.__addimage__.arrayBufferToBinaryString=function(U){for(var T="",Y=I(U)?U:new Uint8Array(U),H=0;H<Y.length;H+=8192)T+=String.fromCharCode.apply(null,Y.subarray(H,H+8192));return T};t.addImage=function(){var U,T,Y,H,M,q,z,Q,L;if(typeof arguments[1]=="number"?(T=s,Y=arguments[1],H=arguments[2],M=arguments[3],q=arguments[4],z=arguments[5],Q=arguments[6],L=arguments[7]):(T=arguments[1],Y=arguments[2],H=arguments[3],M=arguments[4],q=arguments[5],z=arguments[6],Q=arguments[7],L=arguments[8]),Wr(U=arguments[0])==="object"&&!h(U)&&"imageData"in U){var V=U;U=V.imageData,T=V.format||T||s,Y=V.x||Y||0,H=V.y||H||0,M=V.w||V.width||M,q=V.h||V.height||q,z=V.alias||z,Q=V.compression||Q,L=V.rotation||V.angle||L}var P=this.internal.getFilters();if(Q===void 0&&P.indexOf("FlateEncode")!==-1&&(Q="SLOW"),isNaN(Y)||isNaN(H))throw new Error("Invalid coordinates passed to jsPDF.addImage");o.call(this);var C=W.call(this,U,T,z,Q);return x.call(this,Y,H,M,q,C,L),this};var W=function(U,T,Y,H){var M,q,z;if(typeof U=="string"&&a(U)===s){U=unescape(U);var Q=R(U,!1);(Q!==""||(Q=t.loadFile(U,!0))!==void 0)&&(U=Q)}if(h(U)&&(U=m(U,T)),T=a(U,T),!c(T))throw new Error("addImage does not support files of type '"+T+"', please ensure that a plugin for '"+T+"' support is added.");if(((z=Y)==null||z.length===0)&&(Y=(function(L){return typeof L=="string"||I(L)?j(L):I(L.data)?j(L.data):null})(U)),(M=p.call(this,Y))||(F()&&(U instanceof Uint8Array||T==="RGBA"||(q=U,U=w(U))),M=this["process"+T.toUpperCase()](U,u.call(this),Y,(function(L){return L&&typeof L=="string"&&(L=L.toUpperCase()),L in t.image_compression?L:y.NONE})(H),q)),!M)throw new Error("An unknown error occurred whilst processing the image.");return M},R=t.__addimage__.convertBase64ToBinaryString=function(U,T){var Y;T=typeof T!="boolean"||T;var H,M="";if(typeof U=="string"){H=(Y=_(U))!==null?Y.data:U;try{M=rf(H)}catch(q){if(T)throw N(H)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+q.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return M};t.getImageProperties=function(U){var T,Y,H="";if(h(U)&&(U=m(U)),typeof U=="string"&&a(U)===s&&((H=R(U,!1))===""&&(H=t.loadFile(U)||""),U=H),Y=a(U),!c(Y))throw new Error("addImage does not support files of type '"+Y+"', please ensure that a plugin for '"+Y+"' support is added.");if(!F()||U instanceof Uint8Array||(U=w(U)),!(T=this["process"+Y.toUpperCase()](U)))throw new Error("An unknown error occurred whilst processing the image");return T.fileType=Y,T}})(hs.API),(function(t){var s=function(r){if(r!==void 0&&r!="")return!0};hs.API.events.push(["addPage",function(r){this.internal.getPageInfo(r.pageNumber).pageContext.annotations=[]}]),t.events.push(["putPage",function(r){for(var a,n,i,l=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,d=this.internal.getPageInfoByObjId(r.objId),u=r.pageContext.annotations,c=!1,h=0;h<u.length&&!c;h++)switch((a=u[h]).type){case"link":(s(a.options.url)||s(a.options.pageNumber))&&(c=!0);break;case"reference":case"text":case"freetext":c=!0}if(c!=0){this.internal.write("/Annots [");for(var m=0;m<u.length;m++){a=u[m];var p=this.internal.pdfEscape,g=this.internal.getEncryptor(r.objId);switch(a.type){case"reference":this.internal.write(" "+a.object.objId+" 0 R ");break;case"text":var x=this.internal.newAdditionalObject(),b=this.internal.newAdditionalObject(),y=this.internal.getEncryptor(x.objId),j=a.title||"Note";i="<</Type /Annot /Subtype /Text "+(n="/Rect ["+l(a.bounds.x)+" "+o(a.bounds.y+a.bounds.h)+" "+l(a.bounds.x+a.bounds.w)+" "+o(a.bounds.y)+"] ")+"/Contents ("+p(y(a.contents))+")",i+=" /Popup "+b.objId+" 0 R",i+=" /P "+d.objId+" 0 R",i+=" /T ("+p(y(j))+") >>",x.content=i;var N=x.objId+" 0 R";i="<</Type /Annot /Subtype /Popup "+(n="/Rect ["+l(a.bounds.x+30)+" "+o(a.bounds.y+a.bounds.h)+" "+l(a.bounds.x+a.bounds.w+30)+" "+o(a.bounds.y)+"] ")+" /Parent "+N,a.open&&(i+=" /Open true"),i+=" >>",b.content=i,this.internal.write(x.objId,"0 R",b.objId,"0 R");break;case"freetext":n="/Rect ["+l(a.bounds.x)+" "+o(a.bounds.y)+" "+l(a.bounds.x+a.bounds.w)+" "+o(a.bounds.y+a.bounds.h)+"] ";var _=a.color||"#000000";i="<</Type /Annot /Subtype /FreeText "+n+"/Contents ("+p(g(a.contents))+")",i+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+_+")",i+=" /Border [0 0 0]",i+=" >>",this.internal.write(i);break;case"link":if(a.options.name){var F=this.annotations._nameMap[a.options.name];a.options.pageNumber=F.page,a.options.top=F.y}else a.options.top||(a.options.top=0);if(n="/Rect ["+a.finalBounds.x+" "+a.finalBounds.y+" "+a.finalBounds.w+" "+a.finalBounds.h+"] ",i="",a.options.url)i="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /A <</S /URI /URI ("+p(g(a.options.url))+") >>";else if(a.options.pageNumber)switch(i="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(a.options.pageNumber).objId+" 0 R",a.options.magFactor=a.options.magFactor||"XYZ",a.options.magFactor){case"Fit":i+=" /Fit]";break;case"FitH":i+=" /FitH "+a.options.top+"]";break;case"FitV":a.options.left=a.options.left||0,i+=" /FitV "+a.options.left+"]";break;case"XYZ":default:var I=o(a.options.top);a.options.left=a.options.left||0,a.options.zoom===void 0&&(a.options.zoom=0),i+=" /XYZ "+a.options.left+" "+I+" "+a.options.zoom+"]"}i!=""&&(i+=" >>",this.internal.write(i))}}this.internal.write("]")}}]),t.createAnnotation=function(r){var a=this.internal.getCurrentPageInfo();switch(r.type){case"link":this.link(r.bounds.x,r.bounds.y,r.bounds.w,r.bounds.h,r);break;case"text":case"freetext":a.pageContext.annotations.push(r)}},t.link=function(r,a,n,i,l){var o=this.internal.getCurrentPageInfo(),d=this.internal.getCoordinateString,u=this.internal.getVerticalCoordinateString;o.pageContext.annotations.push({finalBounds:{x:d(r),y:u(a),w:d(r+n),h:u(a+i)},options:l,type:"link"})},t.textWithLink=function(r,a,n,i){var l,o,d=this.getTextWidth(r),u=this.internal.getLineHeight()/this.internal.scaleFactor;if(i.maxWidth!==void 0){o=i.maxWidth;var c=this.splitTextToSize(r,o).length;l=Math.ceil(u*c)}else o=d,l=u;return this.text(r,a,n,i),n+=.2*u,i.align==="center"&&(a-=d/2),i.align==="right"&&(a-=d),this.link(a,n-u,o,l,i),d},t.getTextWidth=function(r){var a=this.internal.getFontSize();return this.getStringUnitWidth(r)*a/this.internal.scaleFactor}})(hs.API),(function(t){var s={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},r={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},a={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},n=[1570,1571,1573,1575];t.__arabicParser__={};var i=t.__arabicParser__.isInArabicSubstitutionA=function(x){return s[x.charCodeAt(0)]!==void 0},l=t.__arabicParser__.isArabicLetter=function(x){return typeof x=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(x)},o=t.__arabicParser__.isArabicEndLetter=function(x){return l(x)&&i(x)&&s[x.charCodeAt(0)].length<=2},d=t.__arabicParser__.isArabicAlfLetter=function(x){return l(x)&&n.indexOf(x.charCodeAt(0))>=0};t.__arabicParser__.arabicLetterHasIsolatedForm=function(x){return l(x)&&i(x)&&s[x.charCodeAt(0)].length>=1};var u=t.__arabicParser__.arabicLetterHasFinalForm=function(x){return l(x)&&i(x)&&s[x.charCodeAt(0)].length>=2};t.__arabicParser__.arabicLetterHasInitialForm=function(x){return l(x)&&i(x)&&s[x.charCodeAt(0)].length>=3};var c=t.__arabicParser__.arabicLetterHasMedialForm=function(x){return l(x)&&i(x)&&s[x.charCodeAt(0)].length==4},h=t.__arabicParser__.resolveLigatures=function(x){var b=0,y=r,j="",N=0;for(b=0;b<x.length;b+=1)y[x.charCodeAt(b)]!==void 0?(N++,typeof(y=y[x.charCodeAt(b)])=="number"&&(j+=String.fromCharCode(y),y=r,N=0),b===x.length-1&&(y=r,j+=x.charAt(b-(N-1)),b-=N-1,N=0)):(y=r,j+=x.charAt(b-N),b-=N,N=0);return j};t.__arabicParser__.isArabicDiacritic=function(x){return x!==void 0&&a[x.charCodeAt(0)]!==void 0};var m=t.__arabicParser__.getCorrectForm=function(x,b,y){return l(x)?i(x)===!1?-1:!u(x)||!l(b)&&!l(y)||!l(y)&&o(b)||o(x)&&!l(b)||o(x)&&d(b)||o(x)&&o(b)?0:c(x)&&l(b)&&!o(b)&&l(y)&&u(y)?3:o(x)||!l(y)?1:2:-1},p=function(x){var b=0,y=0,j=0,N="",_="",F="",I=(x=x||"").split("\\s+"),w=[];for(b=0;b<I.length;b+=1){for(w.push(""),y=0;y<I[b].length;y+=1)N=I[b][y],_=I[b][y-1],F=I[b][y+1],l(N)?(j=m(N,_,F),w[b]+=j!==-1?String.fromCharCode(s[N.charCodeAt(0)][j]):N):w[b]+=N;w[b]=h(w[b])}return w.join(" ")},g=t.__arabicParser__.processArabic=t.processArabic=function(){var x,b=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,y=[];if(Array.isArray(b)){var j=0;for(y=[],j=0;j<b.length;j+=1)Array.isArray(b[j])?y.push([p(b[j][0]),b[j][1],b[j][2]]):y.push([p(b[j])]);x=y}else x=p(b);return typeof arguments[0]=="string"?x:(arguments[0].text=x,arguments[0])};t.events.push(["preProcessText",g])})(hs.API),hs.API.autoPrint=function(t){var s;switch((t=t||{}).variant=t.variant||"non-conform",t.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",(function(){s=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")})),this.internal.events.subscribe("putCatalog",(function(){this.internal.out("/OpenAction "+s+" 0 R")}))}return this},(function(t){var s=function(){var r=void 0;Object.defineProperty(this,"pdf",{get:function(){return r},set:function(o){r=o}});var a=150;Object.defineProperty(this,"width",{get:function(){return a},set:function(o){a=isNaN(o)||Number.isInteger(o)===!1||o<0?150:o,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=a+1)}});var n=300;Object.defineProperty(this,"height",{get:function(){return n},set:function(o){n=isNaN(o)||Number.isInteger(o)===!1||o<0?300:o,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=n+1)}});var i=[];Object.defineProperty(this,"childNodes",{get:function(){return i},set:function(o){i=o}});var l={};Object.defineProperty(this,"style",{get:function(){return l},set:function(o){l=o}}),Object.defineProperty(this,"parentNode",{})};s.prototype.getContext=function(r,a){var n;if((r=r||"2d")!=="2d")return null;for(n in a)this.pdf.context2d.hasOwnProperty(n)&&(this.pdf.context2d[n]=a[n]);return this.pdf.context2d._canvas=this,this.pdf.context2d},s.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},t.events.push(["initialized",function(){this.canvas=new s,this.canvas.pdf=this}])})(hs.API),(function(t){var s={left:0,top:0,bottom:0,right:0},r=!1,a=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},s),this.internal.__cell__.margins.width=this.getPageWidth(),n.call(this))},n=function(){this.internal.__cell__.lastCell=new i,this.internal.__cell__.pages=1},i=function(){var d=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return d},set:function(x){d=x}});var u=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return u},set:function(x){u=x}});var c=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return c},set:function(x){c=x}});var h=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return h},set:function(x){h=x}});var m=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return m},set:function(x){m=x}});var p=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return p},set:function(x){p=x}});var g=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return g},set:function(x){g=x}}),this};i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},i.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},t.setHeaderFunction=function(d){return a.call(this),this.internal.__cell__.headerFunction=typeof d=="function"?d:void 0,this},t.getTextDimensions=function(d,u){a.call(this);var c=(u=u||{}).fontSize||this.getFontSize(),h=u.font||this.getFont(),m=u.scaleFactor||this.internal.scaleFactor,p=0,g=0,x=0,b=this;if(!Array.isArray(d)&&typeof d!="string"){if(typeof d!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");d=String(d)}var y=u.maxWidth;y>0?typeof d=="string"?d=this.splitTextToSize(d,y):Object.prototype.toString.call(d)==="[object Array]"&&(d=d.reduce((function(N,_){return N.concat(b.splitTextToSize(_,y))}),[])):d=Array.isArray(d)?d:[d];for(var j=0;j<d.length;j++)p<(x=this.getStringUnitWidth(d[j],{font:h})*c)&&(p=x);return p!==0&&(g=d.length),{w:p/=m,h:Math.max((g*c*this.getLineHeightFactor()-c*(this.getLineHeightFactor()-1))/m,0)}},t.cellAddPage=function(){a.call(this),this.addPage();var d=this.internal.__cell__.margins||s;return this.internal.__cell__.lastCell=new i(d.left,d.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var l=t.cell=function(){var d;d=arguments[0]instanceof i?arguments[0]:new i(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),a.call(this);var u=this.internal.__cell__.lastCell,c=this.internal.__cell__.padding,h=this.internal.__cell__.margins||s,m=this.internal.__cell__.tableHeaderRow,p=this.internal.__cell__.printHeaders;return u.lineNumber!==void 0&&(u.lineNumber===d.lineNumber?(d.x=(u.x||0)+(u.width||0),d.y=u.y||0):u.y+u.height+d.height+h.bottom>this.getPageHeight()?(this.cellAddPage(),d.y=h.top,p&&m&&(this.printHeaderRow(d.lineNumber,!0),d.y+=m[0].height)):d.y=u.y+u.height||d.y),d.text[0]!==void 0&&(this.rect(d.x,d.y,d.width,d.height,r===!0?"FD":void 0),d.align==="right"?this.text(d.text,d.x+d.width-c,d.y+c,{align:"right",baseline:"top"}):d.align==="center"?this.text(d.text,d.x+d.width/2,d.y+c,{align:"center",baseline:"top",maxWidth:d.width-c-c}):this.text(d.text,d.x+c,d.y+c,{align:"left",baseline:"top",maxWidth:d.width-c-c})),this.internal.__cell__.lastCell=d,this};t.table=function(d,u,c,h,m){if(a.call(this),!c)throw new Error("No data for PDF table.");var p,g,x,b,y=[],j=[],N=[],_={},F={},I=[],w=[],E=(m=m||{}).autoSize||!1,W=m.printHeaders!==!1,R=m.css&&m.css["font-size"]!==void 0?16*m.css["font-size"]:m.fontSize||12,U=m.margins||Object.assign({width:this.getPageWidth()},s),T=typeof m.padding=="number"?m.padding:3,Y=m.headerBackgroundColor||"#c8c8c8",H=m.headerTextColor||"#000";if(n.call(this),this.internal.__cell__.printHeaders=W,this.internal.__cell__.margins=U,this.internal.__cell__.table_font_size=R,this.internal.__cell__.padding=T,this.internal.__cell__.headerBackgroundColor=Y,this.internal.__cell__.headerTextColor=H,this.setFontSize(R),h==null)j=y=Object.keys(c[0]),N=y.map((function(){return"left"}));else if(Array.isArray(h)&&Wr(h[0])==="object")for(y=h.map((function(V){return V.name})),j=h.map((function(V){return V.prompt||V.name||""})),N=h.map((function(V){return V.align||"left"})),p=0;p<h.length;p+=1)F[h[p].name]=h[p].width*(19.049976/25.4);else Array.isArray(h)&&typeof h[0]=="string"&&(j=y=h,N=y.map((function(){return"left"})));if(E||Array.isArray(h)&&typeof h[0]=="string")for(p=0;p<y.length;p+=1){for(_[b=y[p]]=c.map((function(V){return V[b]})),this.setFont(void 0,"bold"),I.push(this.getTextDimensions(j[p],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),g=_[b],this.setFont(void 0,"normal"),x=0;x<g.length;x+=1)I.push(this.getTextDimensions(g[x],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);F[b]=Math.max.apply(null,I)+T+T,I=[]}if(W){var M={};for(p=0;p<y.length;p+=1)M[y[p]]={},M[y[p]].text=j[p],M[y[p]].align=N[p];var q=o.call(this,M,F);w=y.map((function(V){return new i(d,u,F[V],q,M[V].text,void 0,M[V].align)})),this.setTableHeaderRow(w),this.printHeaderRow(1,!1)}var z=h.reduce((function(V,P){return V[P.name]=P.align,V}),{});for(p=0;p<c.length;p+=1){"rowStart"in m&&m.rowStart instanceof Function&&m.rowStart({row:p,data:c[p]},this);var Q=o.call(this,c[p],F);for(x=0;x<y.length;x+=1){var L=c[p][y[x]];"cellStart"in m&&m.cellStart instanceof Function&&m.cellStart({row:p,col:x,data:L},this),l.call(this,new i(d,u,F[y[x]],Q,L,p+2,z[y[x]]))}}return this.internal.__cell__.table_x=d,this.internal.__cell__.table_y=u,this};var o=function(d,u){var c=this.internal.__cell__.padding,h=this.internal.__cell__.table_font_size,m=this.internal.scaleFactor;return Object.keys(d).map((function(p){var g=d[p];return this.splitTextToSize(g.hasOwnProperty("text")?g.text:g,u[p]-c-c)}),this).map((function(p){return this.getLineHeightFactor()*p.length*h/m+c+c}),this).reduce((function(p,g){return Math.max(p,g)}),0)};t.setTableHeaderRow=function(d){a.call(this),this.internal.__cell__.tableHeaderRow=d},t.printHeaderRow=function(d,u){if(a.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var c;if(r=!0,typeof this.internal.__cell__.headerFunction=="function"){var h=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new i(h[0],h[1],h[2],h[3],void 0,-1)}this.setFont(void 0,"bold");for(var m=[],p=0;p<this.internal.__cell__.tableHeaderRow.length;p+=1){c=this.internal.__cell__.tableHeaderRow[p].clone(),u&&(c.y=this.internal.__cell__.margins.top||0,m.push(c)),c.lineNumber=d;var g=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),l.call(this,c),this.setTextColor(g)}m.length>0&&this.setTableHeaderRow(m),this.setFont(void 0,"normal"),r=!1}})(hs.API);var $5={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},V5=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],Oy=q5(V5),W5=[100,200,300,400,500,600,700,800,900],RR=q5(W5);function My(t){var s=t.family.replace(/"|'/g,"").toLowerCase(),r=(function(i){return $5[i=i||"normal"]?i:"normal"})(t.style),a=(function(i){if(!i)return 400;if(typeof i=="number")return i>=100&&i<=900&&i%100==0?i:400;if(/^\d00$/.test(i))return parseInt(i);switch(i){case"bold":return 700;case"normal":default:return 400}})(t.weight),n=(function(i){return typeof Oy[i=i||"normal"]=="number"?i:"normal"})(t.stretch);return{family:s,style:r,weight:a,stretch:n,src:t.src||[],ref:t.ref||{name:s,style:[n,r,a].join(" ")}}}function L_(t,s,r,a){var n;for(n=r;n>=0&&n<s.length;n+=a)if(t[s[n]])return t[s[n]];for(n=r;n>=0&&n<s.length;n-=a)if(t[s[n]])return t[s[n]]}var OR={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},D_={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function P_(t){return[t.stretch,t.style,t.weight,t.family].join(" ")}function MR(t,s,r){for(var a=(r=r||{}).defaultFontFamily||"times",n=Object.assign({},OR,r.genericFontFamilies||{}),i=null,l=null,o=0;o<s.length;++o)if(n[(i=My(s[o])).family]&&(i.family=n[i.family]),t.hasOwnProperty(i.family)){l=t[i.family];break}if(!(l=l||t[a]))throw new Error("Could not find a font-family for the rule '"+P_(i)+"' and default family '"+a+"'.");if(l=(function(d,u){if(u[d])return u[d];var c=Oy[d],h=c<=Oy.normal?-1:1,m=L_(u,V5,c,h);if(!m)throw new Error("Could not find a matching font-stretch value for "+d);return m})(i.stretch,l),l=(function(d,u){if(u[d])return u[d];for(var c=$5[d],h=0;h<c.length;++h)if(u[c[h]])return u[c[h]];throw new Error("Could not find a matching font-style for "+d)})(i.style,l),!(l=(function(d,u){if(u[d])return u[d];if(d===400&&u[500])return u[500];if(d===500&&u[400])return u[400];var c=RR[d],h=L_(u,W5,c,d<400?-1:1);if(!h)throw new Error("Could not find a matching font-weight for value "+d);return h})(i.weight,l)))throw new Error("Failed to resolve a font for the rule '"+P_(i)+"'.");return l}function U_(t){return t.trimLeft()}function QR(t,s){for(var r=0;r<t.length;){if(t.charAt(r)===s)return[t.substring(0,r),t.substring(r+1)];r+=1}return null}function HR(t){var s=t.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return s===null?null:[s[0],t.substring(s[0].length)]}var rx,R_,O_,ob=["times"];(function(t){var s,r,a,n,i,l,o,d,u,c=function(C){return C=C||{},this.isStrokeTransparent=C.isStrokeTransparent||!1,this.strokeOpacity=C.strokeOpacity||1,this.strokeStyle=C.strokeStyle||"#000000",this.fillStyle=C.fillStyle||"#000000",this.isFillTransparent=C.isFillTransparent||!1,this.fillOpacity=C.fillOpacity||1,this.font=C.font||"10px sans-serif",this.textBaseline=C.textBaseline||"alphabetic",this.textAlign=C.textAlign||"left",this.lineWidth=C.lineWidth||1,this.lineJoin=C.lineJoin||"miter",this.lineCap=C.lineCap||"butt",this.path=C.path||[],this.transform=C.transform!==void 0?C.transform.clone():new d,this.globalCompositeOperation=C.globalCompositeOperation||"normal",this.globalAlpha=C.globalAlpha||1,this.clip_path=C.clip_path||[],this.currentPoint=C.currentPoint||new l,this.miterLimit=C.miterLimit||10,this.lastPoint=C.lastPoint||new l,this.lineDashOffset=C.lineDashOffset||0,this.lineDash=C.lineDash||[],this.margin=C.margin||[0,0,0,0],this.prevPageLastElemOffset=C.prevPageLastElemOffset||0,this.ignoreClearRect=typeof C.ignoreClearRect!="boolean"||C.ignoreClearRect,this};t.events.push(["initialized",function(){this.context2d=new h(this),s=this.internal.f2,r=this.internal.getCoordinateString,a=this.internal.getVerticalCoordinateString,n=this.internal.getHorizontalCoordinate,i=this.internal.getVerticalCoordinate,l=this.internal.Point,o=this.internal.Rectangle,d=this.internal.Matrix,u=new c}]);var h=function(C){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var k=C;Object.defineProperty(this,"pdf",{get:function(){return k}});var B=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return B},set:function(le){B=!!le}});var G=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return G},set:function(le){G=!!le}});var O=0;Object.defineProperty(this,"posX",{get:function(){return O},set:function(le){isNaN(le)||(O=le)}});var K=0;Object.defineProperty(this,"posY",{get:function(){return K},set:function(le){isNaN(le)||(K=le)}}),Object.defineProperty(this,"margin",{get:function(){return u.margin},set:function(le){var X;typeof le=="number"?X=[le,le,le,le]:((X=new Array(4))[0]=le[0],X[1]=le.length>=2?le[1]:X[0],X[2]=le.length>=3?le[2]:X[0],X[3]=le.length>=4?le[3]:X[1]),u.margin=X}});var J=!1;Object.defineProperty(this,"autoPaging",{get:function(){return J},set:function(le){J=le}});var te=0;Object.defineProperty(this,"lastBreak",{get:function(){return te},set:function(le){te=le}});var se=[];Object.defineProperty(this,"pageBreaks",{get:function(){return se},set:function(le){se=le}}),Object.defineProperty(this,"ctx",{get:function(){return u},set:function(le){le instanceof c&&(u=le)}}),Object.defineProperty(this,"path",{get:function(){return u.path},set:function(le){u.path=le}});var ae=[];Object.defineProperty(this,"ctxStack",{get:function(){return ae},set:function(le){ae=le}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(le){var X;X=m(le),this.ctx.fillStyle=X.style,this.ctx.isFillTransparent=X.a===0,this.ctx.fillOpacity=X.a,this.pdf.setFillColor(X.r,X.g,X.b,{a:X.a}),this.pdf.setTextColor(X.r,X.g,X.b,{a:X.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(le){var X=m(le);this.ctx.strokeStyle=X.style,this.ctx.isStrokeTransparent=X.a===0,this.ctx.strokeOpacity=X.a,X.a===0?this.pdf.setDrawColor(255,255,255):(X.a,this.pdf.setDrawColor(X.r,X.g,X.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(le){["butt","round","square"].indexOf(le)!==-1&&(this.ctx.lineCap=le,this.pdf.setLineCap(le))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(le){isNaN(le)||(this.ctx.lineWidth=le,this.pdf.setLineWidth(le))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(le){["bevel","round","miter"].indexOf(le)!==-1&&(this.ctx.lineJoin=le,this.pdf.setLineJoin(le))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(le){isNaN(le)||(this.ctx.miterLimit=le,this.pdf.setMiterLimit(le))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(le){this.ctx.textBaseline=le}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(le){["right","end","center","left","start"].indexOf(le)!==-1&&(this.ctx.textAlign=le)}});var ne=null;function ue(le,X){if(ne===null){var me=(function(we){var Ie=[];return Object.keys(we).forEach((function(_e){we[_e].forEach((function(Fe){var Le=null;switch(Fe){case"bold":Le={family:_e,weight:"bold"};break;case"italic":Le={family:_e,style:"italic"};break;case"bolditalic":Le={family:_e,weight:"bold",style:"italic"};break;case"":case"normal":Le={family:_e}}Le!==null&&(Le.ref={name:_e,style:Fe},Ie.push(Le))}))})),Ie})(le.getFontList());ne=(function(we){for(var Ie={},_e=0;_e<we.length;++_e){var Fe=My(we[_e]),Le=Fe.family,rt=Fe.stretch,He=Fe.style,st=Fe.weight;Ie[Le]=Ie[Le]||{},Ie[Le][rt]=Ie[Le][rt]||{},Ie[Le][rt][He]=Ie[Le][rt][He]||{},Ie[Le][rt][He][st]=Fe}return Ie})(me.concat(X))}return ne}var oe=null;Object.defineProperty(this,"fontFaces",{get:function(){return oe},set:function(le){ne=null,oe=le}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(le){var X;if(this.ctx.font=le,(X=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(le))!==null){var me=X[1],we=(X[2],X[3]),Ie=X[4],_e=(X[5],X[6]),Fe=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Ie)[2];Ie=Math.floor(Fe==="px"?parseFloat(Ie)*this.pdf.internal.scaleFactor:Fe==="em"?parseFloat(Ie)*this.pdf.getFontSize():parseFloat(Ie)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Ie);var Le=(function(Pe){var fe,he,Ue=[],Ye=Pe.trim();if(Ye==="")return ob;if(Ye in D_)return[D_[Ye]];for(;Ye!=="";){switch(he=null,fe=(Ye=U_(Ye)).charAt(0)){case'"':case"'":he=QR(Ye.substring(1),fe);break;default:he=HR(Ye)}if(he===null||(Ue.push(he[0]),(Ye=U_(he[1]))!==""&&Ye.charAt(0)!==","))return ob;Ye=Ye.replace(/^,/,"")}return Ue})(_e);if(this.fontFaces){var rt=MR(ue(this.pdf,this.fontFaces),Le.map((function(Pe){return{family:Pe,stretch:"normal",weight:we,style:me}})));this.pdf.setFont(rt.ref.name,rt.ref.style)}else{var He="";(we==="bold"||parseInt(we,10)>=700||me==="bold")&&(He="bold"),me==="italic"&&(He+="italic"),He.length===0&&(He="normal");for(var st="",De={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Te=0;Te<Le.length;Te++){if(this.pdf.internal.getFont(Le[Te],He,{noFallback:!0,disableWarning:!0})!==void 0){st=Le[Te];break}if(He==="bolditalic"&&this.pdf.internal.getFont(Le[Te],"bold",{noFallback:!0,disableWarning:!0})!==void 0)st=Le[Te],He="bold";else if(this.pdf.internal.getFont(Le[Te],"normal",{noFallback:!0,disableWarning:!0})!==void 0){st=Le[Te],He="normal";break}}if(st===""){for(var Ce=0;Ce<Le.length;Ce++)if(De[Le[Ce]]){st=De[Le[Ce]];break}}st=st===""?"Times":st,this.pdf.setFont(st,He)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(le){this.ctx.globalCompositeOperation=le}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(le){this.ctx.globalAlpha=le}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(le){this.ctx.lineDashOffset=le,P.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(le){this.ctx.lineDash=le,P.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(le){this.ctx.ignoreClearRect=!!le}})};h.prototype.setLineDash=function(C){this.lineDash=C},h.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},h.prototype.fill=function(){_.call(this,"fill",!1)},h.prototype.stroke=function(){_.call(this,"stroke",!1)},h.prototype.beginPath=function(){this.path=[{type:"begin"}]},h.prototype.moveTo=function(C,k){if(isNaN(C)||isNaN(k))throw ea.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var B=this.ctx.transform.applyToPoint(new l(C,k));this.path.push({type:"mt",x:B.x,y:B.y}),this.ctx.lastPoint=new l(C,k)},h.prototype.closePath=function(){var C=new l(0,0),k=0;for(k=this.path.length-1;k!==-1;k--)if(this.path[k].type==="begin"&&Wr(this.path[k+1])==="object"&&typeof this.path[k+1].x=="number"){C=new l(this.path[k+1].x,this.path[k+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new l(C.x,C.y)},h.prototype.lineTo=function(C,k){if(isNaN(C)||isNaN(k))throw ea.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var B=this.ctx.transform.applyToPoint(new l(C,k));this.path.push({type:"lt",x:B.x,y:B.y}),this.ctx.lastPoint=new l(B.x,B.y)},h.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),_.call(this,null,!0)},h.prototype.quadraticCurveTo=function(C,k,B,G){if(isNaN(B)||isNaN(G)||isNaN(C)||isNaN(k))throw ea.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var O=this.ctx.transform.applyToPoint(new l(B,G)),K=this.ctx.transform.applyToPoint(new l(C,k));this.path.push({type:"qct",x1:K.x,y1:K.y,x:O.x,y:O.y}),this.ctx.lastPoint=new l(O.x,O.y)},h.prototype.bezierCurveTo=function(C,k,B,G,O,K){if(isNaN(O)||isNaN(K)||isNaN(C)||isNaN(k)||isNaN(B)||isNaN(G))throw ea.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var J=this.ctx.transform.applyToPoint(new l(O,K)),te=this.ctx.transform.applyToPoint(new l(C,k)),se=this.ctx.transform.applyToPoint(new l(B,G));this.path.push({type:"bct",x1:te.x,y1:te.y,x2:se.x,y2:se.y,x:J.x,y:J.y}),this.ctx.lastPoint=new l(J.x,J.y)},h.prototype.arc=function(C,k,B,G,O,K){if(isNaN(C)||isNaN(k)||isNaN(B)||isNaN(G)||isNaN(O))throw ea.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(K=!!K,!this.ctx.transform.isIdentity){var J=this.ctx.transform.applyToPoint(new l(C,k));C=J.x,k=J.y;var te=this.ctx.transform.applyToPoint(new l(0,B)),se=this.ctx.transform.applyToPoint(new l(0,0));B=Math.sqrt(Math.pow(te.x-se.x,2)+Math.pow(te.y-se.y,2))}Math.abs(O-G)>=2*Math.PI&&(G=0,O=2*Math.PI),this.path.push({type:"arc",x:C,y:k,radius:B,startAngle:G,endAngle:O,counterclockwise:K})},h.prototype.arcTo=function(C,k,B,G,O){throw new Error("arcTo not implemented.")},h.prototype.rect=function(C,k,B,G){if(isNaN(C)||isNaN(k)||isNaN(B)||isNaN(G))throw ea.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(C,k),this.lineTo(C+B,k),this.lineTo(C+B,k+G),this.lineTo(C,k+G),this.lineTo(C,k),this.lineTo(C+B,k),this.lineTo(C,k)},h.prototype.fillRect=function(C,k,B,G){if(isNaN(C)||isNaN(k)||isNaN(B)||isNaN(G))throw ea.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!p.call(this)){var O={};this.lineCap!=="butt"&&(O.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(O.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(C,k,B,G),this.fill(),O.hasOwnProperty("lineCap")&&(this.lineCap=O.lineCap),O.hasOwnProperty("lineJoin")&&(this.lineJoin=O.lineJoin)}},h.prototype.strokeRect=function(C,k,B,G){if(isNaN(C)||isNaN(k)||isNaN(B)||isNaN(G))throw ea.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");g.call(this)||(this.beginPath(),this.rect(C,k,B,G),this.stroke())},h.prototype.clearRect=function(C,k,B,G){if(isNaN(C)||isNaN(k)||isNaN(B)||isNaN(G))throw ea.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(C,k,B,G))},h.prototype.save=function(C){C=typeof C!="boolean"||C;for(var k=this.pdf.internal.getCurrentPageInfo().pageNumber,B=0;B<this.pdf.internal.getNumberOfPages();B++)this.pdf.setPage(B+1),this.pdf.internal.out("q");if(this.pdf.setPage(k),C){this.ctx.fontSize=this.pdf.internal.getFontSize();var G=new c(this.ctx);this.ctxStack.push(this.ctx),this.ctx=G}},h.prototype.restore=function(C){C=typeof C!="boolean"||C;for(var k=this.pdf.internal.getCurrentPageInfo().pageNumber,B=0;B<this.pdf.internal.getNumberOfPages();B++)this.pdf.setPage(B+1),this.pdf.internal.out("Q");this.pdf.setPage(k),C&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},h.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var m=function(C){var k,B,G,O;if(C.isCanvasGradient===!0&&(C=C.getColor()),!C)return{r:0,g:0,b:0,a:0,style:C};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(C))k=0,B=0,G=0,O=0;else{var K=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(C);if(K!==null)k=parseInt(K[1]),B=parseInt(K[2]),G=parseInt(K[3]),O=1;else if((K=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(C))!==null)k=parseInt(K[1]),B=parseInt(K[2]),G=parseInt(K[3]),O=parseFloat(K[4]);else{if(O=1,typeof C=="string"&&C.charAt(0)!=="#"){var J=new U5(C);C=J.ok?J.toHex():"#000000"}C.length===4?(k=C.substring(1,2),k+=k,B=C.substring(2,3),B+=B,G=C.substring(3,4),G+=G):(k=C.substring(1,3),B=C.substring(3,5),G=C.substring(5,7)),k=parseInt(k,16),B=parseInt(B,16),G=parseInt(G,16)}}return{r:k,g:B,b:G,a:O,style:C}},p=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},g=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};h.prototype.fillText=function(C,k,B,G){if(isNaN(k)||isNaN(B)||typeof C!="string")throw ea.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(G=isNaN(G)?void 0:G,!p.call(this)){var O=Q(this.ctx.transform.rotation),K=this.ctx.transform.scaleX;T.call(this,{text:C,x:k,y:B,scale:K,angle:O,align:this.textAlign,maxWidth:G})}},h.prototype.strokeText=function(C,k,B,G){if(isNaN(k)||isNaN(B)||typeof C!="string")throw ea.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!g.call(this)){G=isNaN(G)?void 0:G;var O=Q(this.ctx.transform.rotation),K=this.ctx.transform.scaleX;T.call(this,{text:C,x:k,y:B,scale:K,renderingMode:"stroke",angle:O,align:this.textAlign,maxWidth:G})}},h.prototype.measureText=function(C){if(typeof C!="string")throw ea.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var k=this.pdf,B=this.pdf.internal.scaleFactor,G=k.internal.getFontSize(),O=k.getStringUnitWidth(C)*G/k.internal.scaleFactor,K=function(J){var te=(J=J||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return te}}),this};return new K({width:O*=Math.round(96*B/72*1e4)/1e4})},h.prototype.scale=function(C,k){if(isNaN(C)||isNaN(k))throw ea.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var B=new d(C,0,0,k,0,0);this.ctx.transform=this.ctx.transform.multiply(B)},h.prototype.rotate=function(C){if(isNaN(C))throw ea.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var k=new d(Math.cos(C),Math.sin(C),-Math.sin(C),Math.cos(C),0,0);this.ctx.transform=this.ctx.transform.multiply(k)},h.prototype.translate=function(C,k){if(isNaN(C)||isNaN(k))throw ea.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var B=new d(1,0,0,1,C,k);this.ctx.transform=this.ctx.transform.multiply(B)},h.prototype.transform=function(C,k,B,G,O,K){if(isNaN(C)||isNaN(k)||isNaN(B)||isNaN(G)||isNaN(O)||isNaN(K))throw ea.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var J=new d(C,k,B,G,O,K);this.ctx.transform=this.ctx.transform.multiply(J)},h.prototype.setTransform=function(C,k,B,G,O,K){C=isNaN(C)?1:C,k=isNaN(k)?0:k,B=isNaN(B)?0:B,G=isNaN(G)?1:G,O=isNaN(O)?0:O,K=isNaN(K)?0:K,this.ctx.transform=new d(C,k,B,G,O,K)};var x=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};h.prototype.drawImage=function(C,k,B,G,O,K,J,te,se){var ae=this.pdf.getImageProperties(C),ne=1,ue=1,oe=1,le=1;G!==void 0&&te!==void 0&&(oe=te/G,le=se/O,ne=ae.width/G*te/G,ue=ae.height/O*se/O),K===void 0&&(K=k,J=B,k=0,B=0),G!==void 0&&te===void 0&&(te=G,se=O),G===void 0&&te===void 0&&(te=ae.width,se=ae.height);for(var X,me=this.ctx.transform.decompose(),we=Q(me.rotate.shx),Ie=new d,_e=(Ie=(Ie=(Ie=Ie.multiply(me.translate)).multiply(me.skew)).multiply(me.scale)).applyToRectangle(new o(K-k*oe,J-B*le,G*ne,O*ue)),Fe=b.call(this,_e),Le=[],rt=0;rt<Fe.length;rt+=1)Le.indexOf(Fe[rt])===-1&&Le.push(Fe[rt]);if(N(Le),this.autoPaging)for(var He=Le[0],st=Le[Le.length-1],De=He;De<st+1;De++){this.pdf.setPage(De);var Te=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Ce=De===1?this.posY+this.margin[0]:this.margin[0],Pe=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],fe=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],he=De===1?0:Pe+(De-2)*fe;if(this.ctx.clip_path.length!==0){var Ue=this.path;X=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=j(X,this.posX+this.margin[3],-he+Ce+this.ctx.prevPageLastElemOffset),F.call(this,"fill",!0),this.path=Ue}var Ye=JSON.parse(JSON.stringify(_e));Ye=j([Ye],this.posX+this.margin[3],-he+Ce+this.ctx.prevPageLastElemOffset)[0];var Ke=(De>He||De<st)&&x.call(this);Ke&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Te,fe,null).clip().discardPath()),this.pdf.addImage(C,"JPEG",Ye.x,Ye.y,Ye.w,Ye.h,null,null,we),Ke&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(C,"JPEG",_e.x,_e.y,_e.w,_e.h,null,null,we)};var b=function(C,k,B){var G=[];k=k||this.pdf.internal.pageSize.width,B=B||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var O=this.posY+this.ctx.prevPageLastElemOffset;switch(C.type){default:case"mt":case"lt":G.push(Math.floor((C.y+O)/B)+1);break;case"arc":G.push(Math.floor((C.y+O-C.radius)/B)+1),G.push(Math.floor((C.y+O+C.radius)/B)+1);break;case"qct":var K=L(this.ctx.lastPoint.x,this.ctx.lastPoint.y,C.x1,C.y1,C.x,C.y);G.push(Math.floor((K.y+O)/B)+1),G.push(Math.floor((K.y+K.h+O)/B)+1);break;case"bct":var J=V(this.ctx.lastPoint.x,this.ctx.lastPoint.y,C.x1,C.y1,C.x2,C.y2,C.x,C.y);G.push(Math.floor((J.y+O)/B)+1),G.push(Math.floor((J.y+J.h+O)/B)+1);break;case"rect":G.push(Math.floor((C.y+O)/B)+1),G.push(Math.floor((C.y+C.h+O)/B)+1)}for(var te=0;te<G.length;te+=1)for(;this.pdf.internal.getNumberOfPages()<G[te];)y.call(this);return G},y=function(){var C=this.fillStyle,k=this.strokeStyle,B=this.font,G=this.lineCap,O=this.lineWidth,K=this.lineJoin;this.pdf.addPage(),this.fillStyle=C,this.strokeStyle=k,this.font=B,this.lineCap=G,this.lineWidth=O,this.lineJoin=K},j=function(C,k,B){for(var G=0;G<C.length;G++)switch(C[G].type){case"bct":C[G].x2+=k,C[G].y2+=B;case"qct":C[G].x1+=k,C[G].y1+=B;case"mt":case"lt":case"arc":default:C[G].x+=k,C[G].y+=B}return C},N=function(C){return C.sort((function(k,B){return k-B}))},_=function(C,k){for(var B,G,O=this.fillStyle,K=this.strokeStyle,J=this.lineCap,te=this.lineWidth,se=Math.abs(te*this.ctx.transform.scaleX),ae=this.lineJoin,ne=JSON.parse(JSON.stringify(this.path)),ue=JSON.parse(JSON.stringify(this.path)),oe=[],le=0;le<ue.length;le++)if(ue[le].x!==void 0)for(var X=b.call(this,ue[le]),me=0;me<X.length;me+=1)oe.indexOf(X[me])===-1&&oe.push(X[me]);for(var we=0;we<oe.length;we++)for(;this.pdf.internal.getNumberOfPages()<oe[we];)y.call(this);if(N(oe),this.autoPaging)for(var Ie=oe[0],_e=oe[oe.length-1],Fe=Ie;Fe<_e+1;Fe++){this.pdf.setPage(Fe),this.fillStyle=O,this.strokeStyle=K,this.lineCap=J,this.lineWidth=se,this.lineJoin=ae;var Le=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],rt=Fe===1?this.posY+this.margin[0]:this.margin[0],He=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],st=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],De=Fe===1?0:He+(Fe-2)*st;if(this.ctx.clip_path.length!==0){var Te=this.path;B=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=j(B,this.posX+this.margin[3],-De+rt+this.ctx.prevPageLastElemOffset),F.call(this,C,!0),this.path=Te}if(G=JSON.parse(JSON.stringify(ne)),this.path=j(G,this.posX+this.margin[3],-De+rt+this.ctx.prevPageLastElemOffset),k===!1||Fe===0){var Ce=(Fe>Ie||Fe<_e)&&x.call(this);Ce&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Le,st,null).clip().discardPath()),F.call(this,C,k),Ce&&this.pdf.restoreGraphicsState()}this.lineWidth=te}else this.lineWidth=se,F.call(this,C,k),this.lineWidth=te;this.path=ne},F=function(C,k){if((C!=="stroke"||k||!g.call(this))&&(C==="stroke"||k||!p.call(this))){for(var B,G,O=[],K=this.path,J=0;J<K.length;J++){var te=K[J];switch(te.type){case"begin":O.push({begin:!0});break;case"close":O.push({close:!0});break;case"mt":O.push({start:te,deltas:[],abs:[]});break;case"lt":var se=O.length;if(K[J-1]&&!isNaN(K[J-1].x)&&(B=[te.x-K[J-1].x,te.y-K[J-1].y],se>0)){for(;se>=0;se--)if(O[se-1].close!==!0&&O[se-1].begin!==!0){O[se-1].deltas.push(B),O[se-1].abs.push(te);break}}break;case"bct":B=[te.x1-K[J-1].x,te.y1-K[J-1].y,te.x2-K[J-1].x,te.y2-K[J-1].y,te.x-K[J-1].x,te.y-K[J-1].y],O[O.length-1].deltas.push(B);break;case"qct":var ae=K[J-1].x+2/3*(te.x1-K[J-1].x),ne=K[J-1].y+2/3*(te.y1-K[J-1].y),ue=te.x+2/3*(te.x1-te.x),oe=te.y+2/3*(te.y1-te.y),le=te.x,X=te.y;B=[ae-K[J-1].x,ne-K[J-1].y,ue-K[J-1].x,oe-K[J-1].y,le-K[J-1].x,X-K[J-1].y],O[O.length-1].deltas.push(B);break;case"arc":O.push({deltas:[],abs:[],arc:!0}),Array.isArray(O[O.length-1].abs)&&O[O.length-1].abs.push(te)}}G=k?null:C==="stroke"?"stroke":"fill";for(var me=!1,we=0;we<O.length;we++)if(O[we].arc)for(var Ie=O[we].abs,_e=0;_e<Ie.length;_e++){var Fe=Ie[_e];Fe.type==="arc"?E.call(this,Fe.x,Fe.y,Fe.radius,Fe.startAngle,Fe.endAngle,Fe.counterclockwise,void 0,k,!me):Y.call(this,Fe.x,Fe.y),me=!0}else if(O[we].close===!0)this.pdf.internal.out("h"),me=!1;else if(O[we].begin!==!0){var Le=O[we].start.x,rt=O[we].start.y;H.call(this,O[we].deltas,Le,rt),me=!0}G&&W.call(this,G),k&&R.call(this)}},I=function(C){var k=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,B=k*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return C-B;case"top":return C+k-B;case"hanging":return C+k-2*B;case"middle":return C+k/2-B;case"ideographic":return C;case"alphabetic":default:return C}},w=function(C){return C+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};h.prototype.createLinearGradient=function(){var C=function(){};return C.colorStops=[],C.addColorStop=function(k,B){this.colorStops.push([k,B])},C.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},C.isCanvasGradient=!0,C},h.prototype.createPattern=function(){return this.createLinearGradient()},h.prototype.createRadialGradient=function(){return this.createLinearGradient()};var E=function(C,k,B,G,O,K,J,te,se){for(var ae=q.call(this,B,G,O,K),ne=0;ne<ae.length;ne++){var ue=ae[ne];ne===0&&(se?U.call(this,ue.x1+C,ue.y1+k):Y.call(this,ue.x1+C,ue.y1+k)),M.call(this,C,k,ue.x2,ue.y2,ue.x3,ue.y3,ue.x4,ue.y4)}te?R.call(this):W.call(this,J)},W=function(C){switch(C){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},R=function(){this.pdf.clip(),this.pdf.discardPath()},U=function(C,k){this.pdf.internal.out(r(C)+" "+a(k)+" m")},T=function(C){var k;switch(C.align){case"right":case"end":k="right";break;case"center":k="center";break;case"left":case"start":default:k="left"}var B=this.pdf.getTextDimensions(C.text),G=I.call(this,C.y),O=w.call(this,G)-B.h,K=this.ctx.transform.applyToPoint(new l(C.x,G)),J=this.ctx.transform.decompose(),te=new d;te=(te=(te=te.multiply(J.translate)).multiply(J.skew)).multiply(J.scale);for(var se,ae,ne,ue=this.ctx.transform.applyToRectangle(new o(C.x,G,B.w,B.h)),oe=te.applyToRectangle(new o(C.x,O,B.w,B.h)),le=b.call(this,oe),X=[],me=0;me<le.length;me+=1)X.indexOf(le[me])===-1&&X.push(le[me]);if(N(X),this.autoPaging)for(var we=X[0],Ie=X[X.length-1],_e=we;_e<Ie+1;_e++){this.pdf.setPage(_e);var Fe=_e===1?this.posY+this.margin[0]:this.margin[0],Le=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],rt=this.pdf.internal.pageSize.height-this.margin[2],He=rt-this.margin[0],st=this.pdf.internal.pageSize.width-this.margin[1],De=st-this.margin[3],Te=_e===1?0:Le+(_e-2)*He;if(this.ctx.clip_path.length!==0){var Ce=this.path;se=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=j(se,this.posX+this.margin[3],-1*Te+Fe),F.call(this,"fill",!0),this.path=Ce}var Pe=j([JSON.parse(JSON.stringify(oe))],this.posX+this.margin[3],-Te+Fe+this.ctx.prevPageLastElemOffset)[0];C.scale>=.01&&(ae=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ae*C.scale),ne=this.lineWidth,this.lineWidth=ne*C.scale);var fe=this.autoPaging!=="text";if(fe||Pe.y+Pe.h<=rt){if(fe||Pe.y>=Fe&&Pe.x<=st){var he=fe?C.text:this.pdf.splitTextToSize(C.text,C.maxWidth||st-Pe.x)[0],Ue=j([JSON.parse(JSON.stringify(ue))],this.posX+this.margin[3],-Te+Fe+this.ctx.prevPageLastElemOffset)[0],Ye=fe&&(_e>we||_e<Ie)&&x.call(this);Ye&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],De,He,null).clip().discardPath()),this.pdf.text(he,Ue.x,Ue.y,{angle:C.angle,align:k,renderingMode:C.renderingMode}),Ye&&this.pdf.restoreGraphicsState()}}else Pe.y<rt&&(this.ctx.prevPageLastElemOffset+=rt-Pe.y);C.scale>=.01&&(this.pdf.setFontSize(ae),this.lineWidth=ne)}else C.scale>=.01&&(ae=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ae*C.scale),ne=this.lineWidth,this.lineWidth=ne*C.scale),this.pdf.text(C.text,K.x+this.posX,K.y+this.posY,{angle:C.angle,align:k,renderingMode:C.renderingMode,maxWidth:C.maxWidth}),C.scale>=.01&&(this.pdf.setFontSize(ae),this.lineWidth=ne)},Y=function(C,k,B,G){B=B||0,G=G||0,this.pdf.internal.out(r(C+B)+" "+a(k+G)+" l")},H=function(C,k,B){return this.pdf.lines(C,k,B,null,null)},M=function(C,k,B,G,O,K,J,te){this.pdf.internal.out([s(n(B+C)),s(i(G+k)),s(n(O+C)),s(i(K+k)),s(n(J+C)),s(i(te+k)),"c"].join(" "))},q=function(C,k,B,G){for(var O=2*Math.PI,K=Math.PI/2;k>B;)k-=O;var J=Math.abs(B-k);J<O&&G&&(J=O-J);for(var te=[],se=G?-1:1,ae=k;J>1e-5;){var ne=ae+se*Math.min(J,K);te.push(z.call(this,C,ae,ne)),J-=Math.abs(ne-ae),ae=ne}return te},z=function(C,k,B){var G=(B-k)/2,O=C*Math.cos(G),K=C*Math.sin(G),J=O,te=-K,se=J*J+te*te,ae=se+J*O+te*K,ne=4/3*(Math.sqrt(2*se*ae)-ae)/(J*K-te*O),ue=J-ne*te,oe=te+ne*J,le=ue,X=-oe,me=G+k,we=Math.cos(me),Ie=Math.sin(me);return{x1:C*Math.cos(k),y1:C*Math.sin(k),x2:ue*we-oe*Ie,y2:ue*Ie+oe*we,x3:le*we-X*Ie,y3:le*Ie+X*we,x4:C*Math.cos(B),y4:C*Math.sin(B)}},Q=function(C){return 180*C/Math.PI},L=function(C,k,B,G,O,K){var J=C+.5*(B-C),te=k+.5*(G-k),se=O+.5*(B-O),ae=K+.5*(G-K),ne=Math.min(C,O,J,se),ue=Math.max(C,O,J,se),oe=Math.min(k,K,te,ae),le=Math.max(k,K,te,ae);return new o(ne,oe,ue-ne,le-oe)},V=function(C,k,B,G,O,K,J,te){var se,ae,ne,ue,oe,le,X,me,we,Ie,_e,Fe,Le,rt,He=B-C,st=G-k,De=O-B,Te=K-G,Ce=J-O,Pe=te-K;for(ae=0;ae<41;ae++)we=(X=(ne=C+(se=ae/40)*He)+se*((oe=B+se*De)-ne))+se*(oe+se*(O+se*Ce-oe)-X),Ie=(me=(ue=k+se*st)+se*((le=G+se*Te)-ue))+se*(le+se*(K+se*Pe-le)-me),ae==0?(_e=we,Fe=Ie,Le=we,rt=Ie):(_e=Math.min(_e,we),Fe=Math.min(Fe,Ie),Le=Math.max(Le,we),rt=Math.max(rt,Ie));return new o(Math.round(_e),Math.round(Fe),Math.round(Le-_e),Math.round(rt-Fe))},P=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var C,k,B=(C=this.ctx.lineDash,k=this.ctx.lineDashOffset,JSON.stringify({lineDash:C,lineDashOffset:k}));this.prevLineDash!==B&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=B)}}})(hs.API),(function(t){var s=function(i){var l,o,d,u,c,h,m,p,g,x;for(o=[],d=0,u=(i+=l="\0\0\0\0".slice(i.length%4||4)).length;u>d;d+=4)(c=(i.charCodeAt(d)<<24)+(i.charCodeAt(d+1)<<16)+(i.charCodeAt(d+2)<<8)+i.charCodeAt(d+3))!==0?(h=(c=((c=((c=((c=(c-(x=c%85))/85)-(g=c%85))/85)-(p=c%85))/85)-(m=c%85))/85)%85,o.push(h+33,m+33,p+33,g+33,x+33)):o.push(122);return(function(b,y){for(var j=y;j>0;j--)b.pop()})(o,l.length),String.fromCharCode.apply(String,o)+"~>"},r=function(i){var l,o,d,u,c,h=String,m="length",p=255,g="charCodeAt",x="slice",b="replace";for(i[x](-2),i=i[x](0,-2)[b](/\s/g,"")[b]("z","!!!!!"),d=[],u=0,c=(i+=l="uuuuu"[x](i[m]%5||5))[m];c>u;u+=5)o=52200625*(i[g](u)-33)+614125*(i[g](u+1)-33)+7225*(i[g](u+2)-33)+85*(i[g](u+3)-33)+(i[g](u+4)-33),d.push(p&o>>24,p&o>>16,p&o>>8,p&o);return(function(y,j){for(var N=j;N>0;N--)y.pop()})(d,l[m]),h.fromCharCode.apply(h,d)},a=function(i){var l=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((i=i.replace(/\s/g,"")).indexOf(">")!==-1&&(i=i.substr(0,i.indexOf(">"))),i.length%2&&(i+="0"),l.test(i)===!1)return"";for(var o="",d=0;d<i.length;d+=2)o+=String.fromCharCode("0x"+(i[d]+i[d+1]));return o},n=function(i){for(var l=new Uint8Array(i.length),o=i.length;o--;)l[o]=i.charCodeAt(o);return i=(l=Ly(l)).reduce((function(d,u){return d+String.fromCharCode(u)}),"")};t.processDataByFilters=function(i,l){var o=0,d=i||"",u=[];for(typeof(l=l||[])=="string"&&(l=[l]),o=0;o<l.length;o+=1)switch(l[o]){case"ASCII85Decode":case"/ASCII85Decode":d=r(d),u.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":d=s(d),u.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":d=a(d),u.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":d=d.split("").map((function(c){return("0"+c.charCodeAt().toString(16)).slice(-2)})).join("")+">",u.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":d=n(d),u.push("/FlateDecode");break;default:throw new Error('The filter: "'+l[o]+'" is not implemented')}return{data:d,reverseChain:u.reverse().join(" ")}}})(hs.API),(function(t){t.loadFile=function(s,r,a){return(function(n,i,l){i=i!==!1,l=typeof l=="function"?l:function(){};var o=void 0;try{o=(function(d,u,c){var h=new XMLHttpRequest,m=0,p=function(g){var x=g.length,b=[],y=String.fromCharCode;for(m=0;m<x;m+=1)b.push(y(255&g.charCodeAt(m)));return b.join("")};if(h.open("GET",d,!u),h.overrideMimeType("text/plain; charset=x-user-defined"),u===!1&&(h.onload=function(){h.status===200?c(p(this.responseText)):c(void 0)}),h.send(null),u&&h.status===200)return p(h.responseText)})(n,i,l)}catch{}return o})(s,r,a)},t.loadImageFile=t.loadFile})(hs.API),(function(t){function s(){return(Gs.html2canvas?Promise.resolve(Gs.html2canvas):Ey(()=>Promise.resolve().then(()=>BH),void 0)).catch((function(l){return Promise.reject(new Error("Could not load html2canvas: "+l))})).then((function(l){return l.default?l.default:l}))}function r(){return(Gs.DOMPurify?Promise.resolve(Gs.DOMPurify):Ey(()=>import("./purify.es-C_uT9hQ1.js"),[])).catch((function(l){return Promise.reject(new Error("Could not load dompurify: "+l))})).then((function(l){return l.default?l.default:l}))}var a=function(l){var o=Wr(l);return o==="undefined"?"undefined":o==="string"||l instanceof String?"string":o==="number"||l instanceof Number?"number":o==="function"||l instanceof Function?"function":l&&l.constructor===Array?"array":l&&l.nodeType===1?"element":o==="object"?"object":"unknown"},n=function(l,o){var d=document.createElement(l);for(var u in o.className&&(d.className=o.className),o.innerHTML&&o.dompurify&&(d.innerHTML=o.dompurify.sanitize(o.innerHTML)),o.style)d.style[u]=o.style[u];return d},i=function l(o){var d=Object.assign(l.convert(Promise.resolve()),JSON.parse(JSON.stringify(l.template))),u=l.convert(Promise.resolve(),d);return u=(u=u.setProgress(1,l,1,[l])).set(o)};(i.prototype=Object.create(Promise.prototype)).constructor=i,i.convert=function(l,o){return l.__proto__=o||i.prototype,l},i.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},i.prototype.from=function(l,o){return this.then((function(){switch(o=o||(function(d){switch(a(d)){case"string":return"string";case"element":return d.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(l)){case"string":return this.then(r).then((function(d){return this.set({src:n("div",{innerHTML:l,dompurify:d})})}));case"element":return this.set({src:l});case"canvas":return this.set({canvas:l});case"img":return this.set({img:l});default:return this.error("Unknown source type.")}}))},i.prototype.to=function(l){switch(l){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},i.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then((function(){var l={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},o=(function d(u,c){for(var h=u.nodeType===3?document.createTextNode(u.nodeValue):u.cloneNode(!1),m=u.firstChild;m;m=m.nextSibling)c!==!0&&m.nodeType===1&&m.nodeName==="SCRIPT"||h.appendChild(d(m,c));return u.nodeType===1&&(u.nodeName==="CANVAS"?(h.width=u.width,h.height=u.height,h.getContext("2d").drawImage(u,0,0)):u.nodeName!=="TEXTAREA"&&u.nodeName!=="SELECT"||(h.value=u.value),h.addEventListener("load",(function(){h.scrollTop=u.scrollTop,h.scrollLeft=u.scrollLeft}),!0)),h})(this.prop.src,this.opt.html2canvas.javascriptEnabled);o.tagName==="BODY"&&(l.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=n("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=n("div",{className:"html2pdf__container",style:l}),this.prop.container.appendChild(o),this.prop.container.firstChild.appendChild(n("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"}))},i.prototype.toCanvas=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(s).then((function(o){var d=Object.assign({},this.opt.html2canvas);return delete d.onrendered,o(this.prop.container,d)})).then((function(o){(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)}))},i.prototype.toContext2d=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(s).then((function(o){var d=this.opt.jsPDF,u=this.opt.fontFaces,c=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,h=Object.assign({async:!0,allowTaint:!0,scale:c,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete h.onrendered,d.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,d.context2d.posX=this.opt.x,d.context2d.posY=this.opt.y,d.context2d.margin=this.opt.margin,d.context2d.fontFaces=u,u)for(var m=0;m<u.length;++m){var p=u[m],g=p.src.find((function(x){return x.format==="truetype"}));g&&d.addFont(g.url,p.ref.name,p.ref.style)}return h.windowHeight=h.windowHeight||0,h.windowHeight=h.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):h.windowHeight,d.context2d.save(!0),o(this.prop.container,h)})).then((function(o){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)}))},i.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then((function(){var l=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=l}))},i.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then((function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF}))},i.prototype.output=function(l,o,d){return(d=d||"pdf").toLowerCase()==="img"||d.toLowerCase()==="image"?this.outputImg(l,o):this.outputPdf(l,o)},i.prototype.outputPdf=function(l,o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then((function(){return this.prop.pdf.output(l,o)}))},i.prototype.outputImg=function(l){return this.thenList([function(){return this.prop.img||this.toImg()}]).then((function(){switch(l){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+l+'" is not supported.'}}))},i.prototype.save=function(l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(l?{filename:l}:null).then((function(){this.prop.pdf.save(this.opt.filename)}))},i.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then((function(){this.prop.callback(this.prop.pdf)}))},i.prototype.set=function(l){if(a(l)!=="object")return this;var o=Object.keys(l||{}).map((function(d){if(d in i.template.prop)return function(){this.prop[d]=l[d]};switch(d){case"margin":return this.setMargin.bind(this,l.margin);case"jsPDF":return function(){return this.opt.jsPDF=l.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,l.pageSize);default:return function(){this.opt[d]=l[d]}}}),this);return this.then((function(){return this.thenList(o)}))},i.prototype.get=function(l,o){return this.then((function(){var d=l in i.template.prop?this.prop[l]:this.opt[l];return o?o(d):d}))},i.prototype.setMargin=function(l){return this.then((function(){switch(a(l)){case"number":l=[l,l,l,l];case"array":if(l.length===2&&(l=[l[0],l[1],l[0],l[1]]),l.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=l})).then(this.setPageSize)},i.prototype.setPageSize=function(l){function o(d,u){return Math.floor(d*u/72*96)}return this.then((function(){(l=l||hs.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(l.inner={width:l.width-this.opt.margin[1]-this.opt.margin[3],height:l.height-this.opt.margin[0]-this.opt.margin[2]},l.inner.px={width:o(l.inner.width,l.k),height:o(l.inner.height,l.k)},l.inner.ratio=l.inner.height/l.inner.width),this.prop.pageSize=l}))},i.prototype.setProgress=function(l,o,d,u){return l!=null&&(this.progress.val=l),o!=null&&(this.progress.state=o),d!=null&&(this.progress.n=d),u!=null&&(this.progress.stack=u),this.progress.ratio=this.progress.val/this.progress.state,this},i.prototype.updateProgress=function(l,o,d,u){return this.setProgress(l?this.progress.val+l:null,o||null,d?this.progress.n+d:null,u?this.progress.stack.concat(u):null)},i.prototype.then=function(l,o){var d=this;return this.thenCore(l,o,(function(u,c){return d.updateProgress(null,null,1,[u]),Promise.prototype.then.call(this,(function(h){return d.updateProgress(null,u),h})).then(u,c).then((function(h){return d.updateProgress(1),h}))}))},i.prototype.thenCore=function(l,o,d){d=d||Promise.prototype.then,l&&(l=l.bind(this)),o&&(o=o.bind(this));var u=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:i.convert(Object.assign({},this),Promise.prototype),c=d.call(u,l,o);return i.convert(c,this.__proto__)},i.prototype.thenExternal=function(l,o){return Promise.prototype.then.call(this,l,o)},i.prototype.thenList=function(l){var o=this;return l.forEach((function(d){o=o.thenCore(d)})),o},i.prototype.catch=function(l){l&&(l=l.bind(this));var o=Promise.prototype.catch.call(this,l);return i.convert(o,this)},i.prototype.catchExternal=function(l){return Promise.prototype.catch.call(this,l)},i.prototype.error=function(l){return this.then((function(){throw new Error(l)}))},i.prototype.using=i.prototype.set,i.prototype.saveAs=i.prototype.save,i.prototype.export=i.prototype.output,i.prototype.run=i.prototype.then,hs.getPageSize=function(l,o,d){if(Wr(l)==="object"){var u=l;l=u.orientation,o=u.unit||o,d=u.format||d}o=o||"mm",d=d||"a4",l=(""+(l||"P")).toLowerCase();var c,h=(""+d).toLowerCase(),m={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(o){case"pt":c=1;break;case"mm":c=72/25.4;break;case"cm":c=72/2.54;break;case"in":c=72;break;case"px":c=.75;break;case"pc":case"em":c=12;break;case"ex":c=6;break;default:throw"Invalid unit: "+o}var p,g=0,x=0;if(m.hasOwnProperty(h))g=m[h][1]/c,x=m[h][0]/c;else try{g=d[1],x=d[0]}catch{throw new Error("Invalid format: "+d)}if(l==="p"||l==="portrait")l="p",x>g&&(p=x,x=g,g=p);else{if(l!=="l"&&l!=="landscape")throw"Invalid orientation: "+l;l="l",g>x&&(p=x,x=g,g=p)}return{width:x,height:g,unit:o,k:c,orientation:l}},t.html=function(l,o){(o=o||{}).callback=o.callback||function(){},o.html2canvas=o.html2canvas||{},o.html2canvas.canvas=o.html2canvas.canvas||this.canvas,o.jsPDF=o.jsPDF||this,o.fontFaces=o.fontFaces?o.fontFaces.map(My):null;var d=new i(o);return o.worker?d:d.from(l).doCallback()}})(hs.API),hs.API.addJS=function(t){return O_=t,this.internal.events.subscribe("postPutResources",(function(){rx=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(rx+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),R_=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+O_+")"),this.internal.out(">>"),this.internal.out("endobj")})),this.internal.events.subscribe("putCatalog",(function(){rx!==void 0&&R_!==void 0&&this.internal.out("/Names <</JavaScript "+rx+" 0 R>>")})),this},(function(t){var s;t.events.push(["postPutResources",function(){var r=this,a=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var n=r.outline.render().split(/\r\n/),i=0;i<n.length;i++){var l=n[i],o=a.exec(l);if(o!=null){var d=o[1];r.internal.newObjectDeferredBegin(d,!1)}r.internal.write(l)}if(this.outline.createNamedDestinations){var u=this.internal.pages.length,c=[];for(i=0;i<u;i++){var h=r.internal.newObject();c.push(h);var m=r.internal.getPageInfo(i+1);r.internal.write("<< /D["+m.objId+" 0 R /XYZ null null null]>> endobj")}var p=r.internal.newObject();for(r.internal.write("<< /Names [ "),i=0;i<c.length;i++)r.internal.write("(page_"+(i+1)+")"+c[i]+" 0 R");r.internal.write(" ] >>","endobj"),s=r.internal.newObject(),r.internal.write("<< /Dests "+p+" 0 R"),r.internal.write(">>","endobj")}}]),t.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+s+" 0 R"))}]),t.events.push(["initialized",function(){var r=this;r.outline={createNamedDestinations:!1,root:{children:[]}},r.outline.add=function(a,n,i){var l={title:n,options:i,children:[]};return a==null&&(a=this.root),a.children.push(l),l},r.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=r,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},r.outline.genIds_r=function(a){a.id=r.internal.newObjectDeferred();for(var n=0;n<a.children.length;n++)this.genIds_r(a.children[n])},r.outline.renderRoot=function(a){this.objStart(a),this.line("/Type /Outlines"),a.children.length>0&&(this.line("/First "+this.makeRef(a.children[0])),this.line("/Last "+this.makeRef(a.children[a.children.length-1]))),this.line("/Count "+this.count_r({count:0},a)),this.objEnd()},r.outline.renderItems=function(a){for(var n=this.ctx.pdf.internal.getVerticalCoordinateString,i=0;i<a.children.length;i++){var l=a.children[i];this.objStart(l),this.line("/Title "+this.makeString(l.title)),this.line("/Parent "+this.makeRef(a)),i>0&&this.line("/Prev "+this.makeRef(a.children[i-1])),i<a.children.length-1&&this.line("/Next "+this.makeRef(a.children[i+1])),l.children.length>0&&(this.line("/First "+this.makeRef(l.children[0])),this.line("/Last "+this.makeRef(l.children[l.children.length-1])));var o=this.count=this.count_r({count:0},l);if(o>0&&this.line("/Count "+o),l.options&&l.options.pageNumber){var d=r.internal.getPageInfo(l.options.pageNumber);this.line("/Dest ["+d.objId+" 0 R /XYZ 0 "+n(0)+" 0]")}this.objEnd()}for(var u=0;u<a.children.length;u++)this.renderItems(a.children[u])},r.outline.line=function(a){this.ctx.val+=a+`\r
`},r.outline.makeRef=function(a){return a.id+" 0 R"},r.outline.makeString=function(a){return"("+r.internal.pdfEscape(a)+")"},r.outline.objStart=function(a){this.ctx.val+=`\r
`+a.id+` 0 obj\r
<<\r
`},r.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},r.outline.count_r=function(a,n){for(var i=0;i<n.children.length;i++)a.count++,this.count_r(a,n.children[i]);return a.count}}])})(hs.API),(function(t){var s=[192,193,194,195,196,197,198,199];t.processJPEG=function(r,a,n,i,l,o){var d,u=this.decode.DCT_DECODE,c=null;if(typeof r=="string"||this.__addimage__.isArrayBuffer(r)||this.__addimage__.isArrayBufferView(r)){switch(r=l||r,r=this.__addimage__.isArrayBuffer(r)?new Uint8Array(r):r,(d=(function(h){for(var m,p=256*h.charCodeAt(4)+h.charCodeAt(5),g=h.length,x={width:0,height:0,numcomponents:1},b=4;b<g;b+=2){if(b+=p,s.indexOf(h.charCodeAt(b+1))!==-1){m=256*h.charCodeAt(b+5)+h.charCodeAt(b+6),x={width:256*h.charCodeAt(b+7)+h.charCodeAt(b+8),height:m,numcomponents:h.charCodeAt(b+9)};break}p=256*h.charCodeAt(b+2)+h.charCodeAt(b+3)}return x})(r=this.__addimage__.isArrayBufferView(r)?this.__addimage__.arrayBufferToBinaryString(r):r)).numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}c={data:r,width:d.width,height:d.height,colorSpace:o,bitsPerComponent:8,filter:u,index:a,alias:n}}return c}})(hs.API);var mh,ax,M_,Q_,H_,qR=(function(){var t,s,r;function a(i){var l,o,d,u,c,h,m,p,g,x,b,y,j,N;for(this.data=i,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},h=null;;){switch(l=this.readUInt32(),g=(function(){var _,F;for(F=[],_=0;_<4;++_)F.push(String.fromCharCode(this.data[this.pos++]));return F}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(l);break;case"fcTL":h&&this.animation.frames.push(h),this.pos+=4,h={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},c=this.readUInt16(),u=this.readUInt16()||100,h.delay=1e3*c/u,h.disposeOp=this.data[this.pos++],h.blendOp=this.data[this.pos++],h.data=[];break;case"IDAT":case"fdAT":for(g==="fdAT"&&(this.pos+=4,l-=4),i=(h!=null?h.data:void 0)||this.imgData,y=0;0<=l?y<l:y>l;0<=l?++y:--y)i.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(d=this.palette.length/3,this.transparency.indexed=this.read(l),this.transparency.indexed.length>d)throw new Error("More transparent colors than palette size");if((x=d-this.transparency.indexed.length)>0)for(j=0;0<=x?j<x:j>x;0<=x?++j:--j)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(l)[0];break;case 2:this.transparency.rgb=this.read(l)}break;case"tEXt":m=(b=this.read(l)).indexOf(0),p=String.fromCharCode.apply(String,b.slice(0,m)),this.text[p]=String.fromCharCode.apply(String,b.slice(m+1));break;case"IEND":return h&&this.animation.frames.push(h),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(N=this.colorType)===4||N===6,o=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*o,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=l}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}a.prototype.read=function(i){var l,o;for(o=[],l=0;0<=i?l<i:l>i;0<=i?++l:--l)o.push(this.data[this.pos++]);return o},a.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},a.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},a.prototype.decodePixels=function(i){var l=this.pixelBitlength/8,o=new Uint8Array(this.width*this.height*l),d=0,u=this;if(i==null&&(i=this.imgData),i.length===0)return new Uint8Array(0);function c(h,m,p,g){var x,b,y,j,N,_,F,I,w,E,W,R,U,T,Y,H,M,q,z,Q,L,V=Math.ceil((u.width-h)/p),P=Math.ceil((u.height-m)/g),C=u.width==V&&u.height==P;for(T=l*V,R=C?o:new Uint8Array(T*P),_=i.length,U=0,b=0;U<P&&d<_;){switch(i[d++]){case 0:for(j=M=0;M<T;j=M+=1)R[b++]=i[d++];break;case 1:for(j=q=0;q<T;j=q+=1)x=i[d++],N=j<l?0:R[b-l],R[b++]=(x+N)%256;break;case 2:for(j=z=0;z<T;j=z+=1)x=i[d++],y=(j-j%l)/l,Y=U&&R[(U-1)*T+y*l+j%l],R[b++]=(Y+x)%256;break;case 3:for(j=Q=0;Q<T;j=Q+=1)x=i[d++],y=(j-j%l)/l,N=j<l?0:R[b-l],Y=U&&R[(U-1)*T+y*l+j%l],R[b++]=(x+Math.floor((N+Y)/2))%256;break;case 4:for(j=L=0;L<T;j=L+=1)x=i[d++],y=(j-j%l)/l,N=j<l?0:R[b-l],U===0?Y=H=0:(Y=R[(U-1)*T+y*l+j%l],H=y&&R[(U-1)*T+(y-1)*l+j%l]),F=N+Y-H,I=Math.abs(F-N),E=Math.abs(F-Y),W=Math.abs(F-H),w=I<=E&&I<=W?N:E<=W?Y:H,R[b++]=(x+w)%256;break;default:throw new Error("Invalid filter algorithm: "+i[d-1])}if(!C){var k=((m+U*g)*u.width+h)*l,B=U*T;for(j=0;j<V;j+=1){for(var G=0;G<l;G+=1)o[k++]=R[B++];k+=(p-1)*l}}U++}}return i=yR(i),u.interlaceMethod==1?(c(0,0,8,8),c(4,0,8,8),c(0,4,4,8),c(2,0,4,4),c(0,2,2,4),c(1,0,2,2),c(0,1,1,2)):c(0,0,1,1),o},a.prototype.decodePalette=function(){var i,l,o,d,u,c,h,m,p;for(o=this.palette,c=this.transparency.indexed||[],u=new Uint8Array((c.length||0)+o.length),d=0,i=0,l=h=0,m=o.length;h<m;l=h+=3)u[d++]=o[l],u[d++]=o[l+1],u[d++]=o[l+2],u[d++]=(p=c[i++])!=null?p:255;return u},a.prototype.copyToImageData=function(i,l){var o,d,u,c,h,m,p,g,x,b,y;if(d=this.colors,x=null,o=this.hasAlphaChannel,this.palette.length&&(x=(y=this._decodedPalette)!=null?y:this._decodedPalette=this.decodePalette(),d=4,o=!0),g=(u=i.data||i).length,h=x||l,c=m=0,d===1)for(;c<g;)p=x?4*l[c/4]:m,b=h[p++],u[c++]=b,u[c++]=b,u[c++]=b,u[c++]=o?h[p++]:255,m=p;else for(;c<g;)p=x?4*l[c/4]:m,u[c++]=h[p++],u[c++]=h[p++],u[c++]=h[p++],u[c++]=o?h[p++]:255,m=p},a.prototype.decode=function(){var i;return i=new Uint8Array(this.width*this.height*4),this.copyToImageData(i,this.decodePixels()),i};var n=function(){if(Object.prototype.toString.call(Gs)==="[object Window]"){try{s=Gs.document.createElement("canvas"),r=s.getContext("2d")}catch{return!1}return!0}return!1};return n(),t=function(i){var l;if(n()===!0)return r.width=i.width,r.height=i.height,r.clearRect(0,0,i.width,i.height),r.putImageData(i,0,0),(l=new Image).src=s.toDataURL(),l;throw new Error("This method requires a Browser with Canvas-capability.")},a.prototype.decodeFrames=function(i){var l,o,d,u,c,h,m,p;if(this.animation){for(p=[],o=c=0,h=(m=this.animation.frames).length;c<h;o=++c)l=m[o],d=i.createImageData(l.width,l.height),u=this.decodePixels(new Uint8Array(l.data)),this.copyToImageData(d,u),l.imageData=d,p.push(l.image=t(d));return p}},a.prototype.renderFrame=function(i,l){var o,d,u;return o=(d=this.animation.frames)[l],u=d[l-1],l===0&&i.clearRect(0,0,this.width,this.height),(u!=null?u.disposeOp:void 0)===1?i.clearRect(u.xOffset,u.yOffset,u.width,u.height):(u!=null?u.disposeOp:void 0)===2&&i.putImageData(u.imageData,u.xOffset,u.yOffset),o.blendOp===0&&i.clearRect(o.xOffset,o.yOffset,o.width,o.height),i.drawImage(o.image,o.xOffset,o.yOffset)},a.prototype.animate=function(i){var l,o,d,u,c,h,m=this;return o=0,h=this.animation,u=h.numFrames,d=h.frames,c=h.numPlays,(l=function(){var p,g;if(p=o++%u,g=d[p],m.renderFrame(i,p),u>1&&o/u<c)return m.animation._timeout=setTimeout(l,g.delay)})()},a.prototype.stopAnimation=function(){var i;return clearTimeout((i=this.animation)!=null?i._timeout:void 0)},a.prototype.render=function(i){var l,o;return i._png&&i._png.stopAnimation(),i._png=this,i.width=this.width,i.height=this.height,l=i.getContext("2d"),this.animation?(this.decodeFrames(l),this.animate(l)):(o=l.createImageData(this.width,this.height),this.copyToImageData(o,this.decodePixels()),l.putImageData(o,0,0))},a})();/**
 * @license
 *
 * Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 *//**
 * @license
 * (c) Dean McNamee <dean@gmail.com>, 2013.
 *
 * https://github.com/deanm/omggif
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
 * including animation and compression.  It does not rely on any specific
 * underlying system, so should run in the browser, Node, or Plask.
 */function $R(t){var s=0;if(t[s++]!==71||t[s++]!==73||t[s++]!==70||t[s++]!==56||(t[s++]+1&253)!=56||t[s++]!==97)throw new Error("Invalid GIF 87a/89a header.");var r=t[s++]|t[s++]<<8,a=t[s++]|t[s++]<<8,n=t[s++],i=n>>7,l=1<<(7&n)+1;t[s++],t[s++];var o=null,d=null;i&&(o=s,d=l,s+=3*l);var u=!0,c=[],h=0,m=null,p=0,g=null;for(this.width=r,this.height=a;u&&s<t.length;)switch(t[s++]){case 33:switch(t[s++]){case 255:if(t[s]!==11||t[s+1]==78&&t[s+2]==69&&t[s+3]==84&&t[s+4]==83&&t[s+5]==67&&t[s+6]==65&&t[s+7]==80&&t[s+8]==69&&t[s+9]==50&&t[s+10]==46&&t[s+11]==48&&t[s+12]==3&&t[s+13]==1&&t[s+16]==0)s+=14,g=t[s++]|t[s++]<<8,s++;else for(s+=12;;){if(!((U=t[s++])>=0))throw Error("Invalid block size");if(U===0)break;s+=U}break;case 249:if(t[s++]!==4||t[s+4]!==0)throw new Error("Invalid graphics extension block.");var x=t[s++];h=t[s++]|t[s++]<<8,m=t[s++],(1&x)==0&&(m=null),p=x>>2&7,s++;break;case 254:for(;;){if(!((U=t[s++])>=0))throw Error("Invalid block size");if(U===0)break;s+=U}break;default:throw new Error("Unknown graphic control label: 0x"+t[s-1].toString(16))}break;case 44:var b=t[s++]|t[s++]<<8,y=t[s++]|t[s++]<<8,j=t[s++]|t[s++]<<8,N=t[s++]|t[s++]<<8,_=t[s++],F=_>>6&1,I=1<<(7&_)+1,w=o,E=d,W=!1;_>>7&&(W=!0,w=s,E=I,s+=3*I);var R=s;for(s++;;){var U;if(!((U=t[s++])>=0))throw Error("Invalid block size");if(U===0)break;s+=U}c.push({x:b,y,width:j,height:N,has_local_palette:W,palette_offset:w,palette_size:E,data_offset:R,data_length:s-R,transparent_index:m,interlaced:!!F,delay:h,disposal:p});break;case 59:u=!1;break;default:throw new Error("Unknown gif block: 0x"+t[s-1].toString(16))}this.numFrames=function(){return c.length},this.loopCount=function(){return g},this.frameInfo=function(T){if(T<0||T>=c.length)throw new Error("Frame index out of range.");return c[T]},this.decodeAndBlitFrameBGRA=function(T,Y){var H=this.frameInfo(T),M=H.width*H.height,q=new Uint8Array(M);q_(t,H.data_offset,q,M);var z=H.palette_offset,Q=H.transparent_index;Q===null&&(Q=256);var L=H.width,V=r-L,P=L,C=4*(H.y*r+H.x),k=4*((H.y+H.height)*r+H.x),B=C,G=4*V;H.interlaced===!0&&(G+=4*r*7);for(var O=8,K=0,J=q.length;K<J;++K){var te=q[K];if(P===0&&(P=L,(B+=G)>=k&&(G=4*V+4*r*(O-1),B=C+(L+V)*(O<<1),O>>=1)),te===Q)B+=4;else{var se=t[z+3*te],ae=t[z+3*te+1],ne=t[z+3*te+2];Y[B++]=ne,Y[B++]=ae,Y[B++]=se,Y[B++]=255}--P}},this.decodeAndBlitFrameRGBA=function(T,Y){var H=this.frameInfo(T),M=H.width*H.height,q=new Uint8Array(M);q_(t,H.data_offset,q,M);var z=H.palette_offset,Q=H.transparent_index;Q===null&&(Q=256);var L=H.width,V=r-L,P=L,C=4*(H.y*r+H.x),k=4*((H.y+H.height)*r+H.x),B=C,G=4*V;H.interlaced===!0&&(G+=4*r*7);for(var O=8,K=0,J=q.length;K<J;++K){var te=q[K];if(P===0&&(P=L,(B+=G)>=k&&(G=4*V+4*r*(O-1),B=C+(L+V)*(O<<1),O>>=1)),te===Q)B+=4;else{var se=t[z+3*te],ae=t[z+3*te+1],ne=t[z+3*te+2];Y[B++]=se,Y[B++]=ae,Y[B++]=ne,Y[B++]=255}--P}}}function q_(t,s,r,a){for(var n=t[s++],i=1<<n,l=i+1,o=l+1,d=n+1,u=(1<<d)-1,c=0,h=0,m=0,p=t[s++],g=new Int32Array(4096),x=null;;){for(;c<16&&p!==0;)h|=t[s++]<<c,c+=8,p===1?p=t[s++]:--p;if(c<d)break;var b=h&u;if(h>>=d,c-=d,b!==i){if(b===l)break;for(var y=b<o?b:x,j=0,N=y;N>i;)N=g[N]>>8,++j;var _=N;if(m+j+(y!==b?1:0)>a)return void ea.log("Warning, gif stream longer than expected.");r[m++]=_;var F=m+=j;for(y!==b&&(r[m++]=_),N=y;j--;)N=g[N],r[--F]=255&N,N>>=8;x!==null&&o<4096&&(g[o++]=x<<8|_,o>=u+1&&d<12&&(++d,u=u<<1|1)),x=b}else o=l+1,u=(1<<(d=n+1))-1,x=null}return m!==a&&ea.log("Warning, gif stream shorter than expected."),r}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function cb(t){var s,r,a,n,i,l=Math.floor,o=new Array(64),d=new Array(64),u=new Array(64),c=new Array(64),h=new Array(65535),m=new Array(65535),p=new Array(64),g=new Array(64),x=[],b=0,y=7,j=new Array(64),N=new Array(64),_=new Array(64),F=new Array(256),I=new Array(2048),w=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],E=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],W=[0,1,2,3,4,5,6,7,8,9,10,11],R=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],U=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],T=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Y=[0,1,2,3,4,5,6,7,8,9,10,11],H=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],M=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function q(C,k){for(var B=0,G=0,O=new Array,K=1;K<=16;K++){for(var J=1;J<=C[K];J++)O[k[G]]=[],O[k[G]][0]=B,O[k[G]][1]=K,G++,B++;B*=2}return O}function z(C){for(var k=C[0],B=C[1]-1;B>=0;)k&1<<B&&(b|=1<<y),B--,--y<0&&(b==255?(Q(255),Q(0)):Q(b),y=7,b=0)}function Q(C){x.push(C)}function L(C){Q(C>>8&255),Q(255&C)}function V(C,k,B,G,O){for(var K,J=O[0],te=O[240],se=(function(Ie,_e){var Fe,Le,rt,He,st,De,Te,Ce,Pe,fe,he=0;for(Pe=0;Pe<8;++Pe){Fe=Ie[he],Le=Ie[he+1],rt=Ie[he+2],He=Ie[he+3],st=Ie[he+4],De=Ie[he+5],Te=Ie[he+6];var Ue=Fe+(Ce=Ie[he+7]),Ye=Fe-Ce,Ke=Le+Te,Je=Le-Te,xe=rt+De,ye=rt-De,Ae=He+st,be=He-st,Ee=Ue+Ae,dt=Ue-Ae,mt=Ke+xe,it=Ke-xe;Ie[he]=Ee+mt,Ie[he+4]=Ee-mt;var ht=.707106781*(it+dt);Ie[he+2]=dt+ht,Ie[he+6]=dt-ht;var ft=.382683433*((Ee=be+ye)-(it=Je+Ye)),Rt=.5411961*Ee+ft,Ge=1.306562965*it+ft,at=.707106781*(mt=ye+Je),je=Ye+at,Se=Ye-at;Ie[he+5]=Se+Rt,Ie[he+3]=Se-Rt,Ie[he+1]=je+Ge,Ie[he+7]=je-Ge,he+=8}for(he=0,Pe=0;Pe<8;++Pe){Fe=Ie[he],Le=Ie[he+8],rt=Ie[he+16],He=Ie[he+24],st=Ie[he+32],De=Ie[he+40],Te=Ie[he+48];var nt=Fe+(Ce=Ie[he+56]),Ze=Fe-Ce,gt=Le+Te,jt=Le-Te,Mt=rt+De,Ne=rt-De,ke=He+st,qe=He-st,ge=nt+ke,Me=nt-ke,Ve=gt+Mt,vt=gt-Mt;Ie[he]=ge+Ve,Ie[he+32]=ge-Ve;var St=.707106781*(vt+Me);Ie[he+16]=Me+St,Ie[he+48]=Me-St;var xt=.382683433*((ge=qe+Ne)-(vt=jt+Ze)),Ct=.5411961*ge+xt,Tt=1.306562965*vt+xt,bt=.707106781*(Ve=Ne+jt),Jt=Ze+bt,Gt=Ze-bt;Ie[he+40]=Gt+Ct,Ie[he+24]=Gt-Ct,Ie[he+8]=Jt+Tt,Ie[he+56]=Jt-Tt,he++}for(Pe=0;Pe<64;++Pe)fe=Ie[Pe]*_e[Pe],p[Pe]=fe>0?fe+.5|0:fe-.5|0;return p})(C,k),ae=0;ae<64;++ae)g[w[ae]]=se[ae];var ne=g[0]-B;B=g[0],ne==0?z(G[0]):(z(G[m[K=32767+ne]]),z(h[K]));for(var ue=63;ue>0&&g[ue]==0;)ue--;if(ue==0)return z(J),B;for(var oe,le=1;le<=ue;){for(var X=le;g[le]==0&&le<=ue;)++le;var me=le-X;if(me>=16){oe=me>>4;for(var we=1;we<=oe;++we)z(te);me&=15}K=32767+g[le],z(O[(me<<4)+m[K]]),z(h[K]),le++}return ue!=63&&z(J),B}function P(C){C=Math.min(Math.max(C,1),100),i!=C&&((function(k){for(var B=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],G=0;G<64;G++){var O=l((B[G]*k+50)/100);O=Math.min(Math.max(O,1),255),o[w[G]]=O}for(var K=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],J=0;J<64;J++){var te=l((K[J]*k+50)/100);te=Math.min(Math.max(te,1),255),d[w[J]]=te}for(var se=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],ae=0,ne=0;ne<8;ne++)for(var ue=0;ue<8;ue++)u[ae]=1/(o[w[ae]]*se[ne]*se[ue]*8),c[ae]=1/(d[w[ae]]*se[ne]*se[ue]*8),ae++})(C<50?Math.floor(5e3/C):Math.floor(200-2*C)),i=C)}this.encode=function(C,k){k&&P(k),x=new Array,b=0,y=7,L(65496),L(65504),L(16),Q(74),Q(70),Q(73),Q(70),Q(0),Q(1),Q(1),Q(0),L(1),L(1),Q(0),Q(0),(function(){L(65499),L(132),Q(0);for(var Le=0;Le<64;Le++)Q(o[Le]);Q(1);for(var rt=0;rt<64;rt++)Q(d[rt])})(),(function(Le,rt){L(65472),L(17),Q(8),L(rt),L(Le),Q(3),Q(1),Q(17),Q(0),Q(2),Q(17),Q(1),Q(3),Q(17),Q(1)})(C.width,C.height),(function(){L(65476),L(418),Q(0);for(var Le=0;Le<16;Le++)Q(E[Le+1]);for(var rt=0;rt<=11;rt++)Q(W[rt]);Q(16);for(var He=0;He<16;He++)Q(R[He+1]);for(var st=0;st<=161;st++)Q(U[st]);Q(1);for(var De=0;De<16;De++)Q(T[De+1]);for(var Te=0;Te<=11;Te++)Q(Y[Te]);Q(17);for(var Ce=0;Ce<16;Ce++)Q(H[Ce+1]);for(var Pe=0;Pe<=161;Pe++)Q(M[Pe])})(),L(65498),L(12),Q(3),Q(1),Q(0),Q(2),Q(17),Q(3),Q(17),Q(0),Q(63),Q(0);var B=0,G=0,O=0;b=0,y=7,this.encode.displayName="_encode_";for(var K,J,te,se,ae,ne,ue,oe,le,X=C.data,me=C.width,we=C.height,Ie=4*me,_e=0;_e<we;){for(K=0;K<Ie;){for(ae=Ie*_e+K,ue=-1,oe=0,le=0;le<64;le++)ne=ae+(oe=le>>3)*Ie+(ue=4*(7&le)),_e+oe>=we&&(ne-=Ie*(_e+1+oe-we)),K+ue>=Ie&&(ne-=K+ue-Ie+4),J=X[ne++],te=X[ne++],se=X[ne++],j[le]=(I[J]+I[te+256>>0]+I[se+512>>0]>>16)-128,N[le]=(I[J+768>>0]+I[te+1024>>0]+I[se+1280>>0]>>16)-128,_[le]=(I[J+1280>>0]+I[te+1536>>0]+I[se+1792>>0]>>16)-128;B=V(j,u,B,s,a),G=V(N,c,G,r,n),O=V(_,c,O,r,n),K+=32}_e+=8}if(y>=0){var Fe=[];Fe[1]=y+1,Fe[0]=(1<<y+1)-1,z(Fe)}return L(65497),new Uint8Array(x)},t=t||50,(function(){for(var C=String.fromCharCode,k=0;k<256;k++)F[k]=C(k)})(),s=q(E,W),r=q(T,Y),a=q(R,U),n=q(H,M),(function(){for(var C=1,k=2,B=1;B<=15;B++){for(var G=C;G<k;G++)m[32767+G]=B,h[32767+G]=[],h[32767+G][1]=B,h[32767+G][0]=G;for(var O=-(k-1);O<=-C;O++)m[32767+O]=B,h[32767+O]=[],h[32767+O][1]=B,h[32767+O][0]=k-1+O;C<<=1,k<<=1}})(),(function(){for(var C=0;C<256;C++)I[C]=19595*C,I[C+256>>0]=38470*C,I[C+512>>0]=7471*C+32768,I[C+768>>0]=-11059*C,I[C+1024>>0]=-21709*C,I[C+1280>>0]=32768*C+8421375,I[C+1536>>0]=-27439*C,I[C+1792>>0]=-5329*C})(),P(t)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function Uo(t,s){if(this.pos=0,this.buffer=t,this.datav=new DataView(t.buffer),this.is_with_alpha=!!s,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function $_(t){function s(E){if(!E)throw Error("assert :P")}function r(E,W,R){for(var U=0;4>U;U++)if(E[W+U]!=R.charCodeAt(U))return!0;return!1}function a(E,W,R,U,T){for(var Y=0;Y<T;Y++)E[W+Y]=R[U+Y]}function n(E,W,R,U){for(var T=0;T<U;T++)E[W+T]=R}function i(E){return new Int32Array(E)}function l(E,W){for(var R=[],U=0;U<E;U++)R.push(new W);return R}function o(E,W){var R=[];return(function U(T,Y,H){for(var M=H[Y],q=0;q<M&&(T.push(H.length>Y+1?[]:new W),!(H.length<Y+1));q++)U(T[q],Y+1,H)})(R,0,E),R}var d=function(){var E=this;function W(D,re){for(var de=1<<re-1>>>0;D&de;)de>>>=1;return de?(D&de-1)+de:D}function R(D,re,de,ve,Oe){s(!(ve%de));do D[re+(ve-=de)]=Oe;while(0<ve)}function U(D,re,de,ve,Oe){if(s(2328>=Oe),512>=Oe)var $e=i(512);else if(($e=i(Oe))==null)return 0;return(function(ze,Xe,et,ot,wt,Pt){var Ut,Ft,as=Xe,Kt=1<<et,kt=i(16),Et=i(16);for(s(wt!=0),s(ot!=null),s(ze!=null),s(0<et),Ft=0;Ft<wt;++Ft){if(15<ot[Ft])return 0;++kt[ot[Ft]]}if(kt[0]==wt)return 0;for(Et[1]=0,Ut=1;15>Ut;++Ut){if(kt[Ut]>1<<Ut)return 0;Et[Ut+1]=Et[Ut]+kt[Ut]}for(Ft=0;Ft<wt;++Ft)Ut=ot[Ft],0<ot[Ft]&&(Pt[Et[Ut]++]=Ft);if(Et[15]==1)return(ot=new T).g=0,ot.value=Pt[0],R(ze,as,1,Kt,ot),Kt;var Xt,Yt=-1,ts=Kt-1,_s=0,bs=1,Ms=1,ys=1<<et;for(Ft=0,Ut=1,wt=2;Ut<=et;++Ut,wt<<=1){if(bs+=Ms<<=1,0>(Ms-=kt[Ut]))return 0;for(;0<kt[Ut];--kt[Ut])(ot=new T).g=Ut,ot.value=Pt[Ft++],R(ze,as+_s,wt,ys,ot),_s=W(_s,Ut)}for(Ut=et+1,wt=2;15>=Ut;++Ut,wt<<=1){if(bs+=Ms<<=1,0>(Ms-=kt[Ut]))return 0;for(;0<kt[Ut];--kt[Ut]){if(ot=new T,(_s&ts)!=Yt){for(as+=ys,Xt=1<<(Yt=Ut)-et;15>Yt&&!(0>=(Xt-=kt[Yt]));)++Yt,Xt<<=1;Kt+=ys=1<<(Xt=Yt-et),ze[Xe+(Yt=_s&ts)].g=Xt+et,ze[Xe+Yt].value=as-Xe-Yt}ot.g=Ut-et,ot.value=Pt[Ft++],R(ze,as+(_s>>et),wt,ys,ot),_s=W(_s,Ut)}}return bs!=2*Et[15]-1?0:Kt})(D,re,de,ve,Oe,$e)}function T(){this.value=this.g=0}function Y(){this.value=this.g=0}function H(){this.G=l(5,T),this.H=i(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=l(pa,Y)}function M(D,re,de,ve){s(D!=null),s(re!=null),s(2147483648>ve),D.Ca=254,D.I=0,D.b=-8,D.Ka=0,D.oa=re,D.pa=de,D.Jd=re,D.Yc=de+ve,D.Zc=4<=ve?de+ve-4+1:de,K(D)}function q(D,re){for(var de=0;0<re--;)de|=te(D,128)<<re;return de}function z(D,re){var de=q(D,re);return J(D)?-de:de}function Q(D,re,de,ve){var Oe,$e=0;for(s(D!=null),s(re!=null),s(4294967288>ve),D.Sb=ve,D.Ra=0,D.u=0,D.h=0,4<ve&&(ve=4),Oe=0;Oe<ve;++Oe)$e+=re[de+Oe]<<8*Oe;D.Ra=$e,D.bb=ve,D.oa=re,D.pa=de}function L(D){for(;8<=D.u&&D.bb<D.Sb;)D.Ra>>>=8,D.Ra+=D.oa[D.pa+D.bb]<<Fd-8>>>0,++D.bb,D.u-=8;B(D)&&(D.h=1,D.u=0)}function V(D,re){if(s(0<=re),!D.h&&re<=Bd){var de=k(D)&Ed[re];return D.u+=re,L(D),de}return D.h=1,D.u=0}function P(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function C(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function k(D){return D.Ra>>>(D.u&Fd-1)>>>0}function B(D){return s(D.bb<=D.Sb),D.h||D.bb==D.Sb&&D.u>Fd}function G(D,re){D.u=re,D.h=B(D)}function O(D){D.u>=Td&&(s(D.u>=Td),L(D))}function K(D){s(D!=null&&D.oa!=null),D.pa<D.Zc?(D.I=(D.oa[D.pa++]|D.I<<8)>>>0,D.b+=8):(s(D!=null&&D.oa!=null),D.pa<D.Yc?(D.b+=8,D.I=D.oa[D.pa++]|D.I<<8):D.Ka?D.b=0:(D.I<<=8,D.b+=8,D.Ka=1))}function J(D){return q(D,1)}function te(D,re){var de=D.Ca;0>D.b&&K(D);var ve=D.b,Oe=de*re>>>8,$e=(D.I>>>ve>Oe)+0;for($e?(de-=Oe,D.I-=Oe+1<<ve>>>0):de=Oe+1,ve=de,Oe=0;256<=ve;)Oe+=8,ve>>=8;return ve=7^Oe+Pn[ve],D.b-=ve,D.Ca=(de<<ve)-1,$e}function se(D,re,de){D[re+0]=de>>24&255,D[re+1]=de>>16&255,D[re+2]=de>>8&255,D[re+3]=de>>0&255}function ae(D,re){return D[re+0]<<0|D[re+1]<<8}function ne(D,re){return ae(D,re)|D[re+2]<<16}function ue(D,re){return ae(D,re)|ae(D,re+2)<<16}function oe(D,re){var de=1<<re;return s(D!=null),s(0<re),D.X=i(de),D.X==null?0:(D.Mb=32-re,D.Xa=re,1)}function le(D,re){s(D!=null),s(re!=null),s(D.Xa==re.Xa),a(re.X,0,D.X,0,1<<re.Xa)}function X(){this.X=[],this.Xa=this.Mb=0}function me(D,re,de,ve){s(de!=null),s(ve!=null);var Oe=de[0],$e=ve[0];return Oe==0&&(Oe=(D*$e+re/2)/re),$e==0&&($e=(re*Oe+D/2)/D),0>=Oe||0>=$e?0:(de[0]=Oe,ve[0]=$e,1)}function we(D,re){return D+(1<<re)-1>>>re}function Ie(D,re){return((4278255360&D)+(4278255360&re)>>>0&4278255360)+((16711935&D)+(16711935&re)>>>0&16711935)>>>0}function _e(D,re){E[re]=function(de,ve,Oe,$e,ze,Xe,et){var ot;for(ot=0;ot<ze;++ot){var wt=E[D](Xe[et+ot-1],Oe,$e+ot);Xe[et+ot]=Ie(de[ve+ot],wt)}}}function Fe(){this.ud=this.hd=this.jd=0}function Le(D,re){return((4278124286&(D^re))>>>1)+(D&re)>>>0}function rt(D){return 0<=D&&256>D?D:0>D?0:255<D?255:void 0}function He(D,re){return rt(D+(D-re+.5>>1))}function st(D,re,de){return Math.abs(re-de)-Math.abs(D-de)}function De(D,re,de,ve,Oe,$e,ze){for(ve=$e[ze-1],de=0;de<Oe;++de)$e[ze+de]=ve=Ie(D[re+de],ve)}function Te(D,re,de,ve,Oe){var $e;for($e=0;$e<de;++$e){var ze=D[re+$e],Xe=ze>>8&255,et=16711935&(et=(et=16711935&ze)+((Xe<<16)+Xe));ve[Oe+$e]=(4278255360&ze)+et>>>0}}function Ce(D,re){re.jd=D>>0&255,re.hd=D>>8&255,re.ud=D>>16&255}function Pe(D,re,de,ve,Oe,$e){var ze;for(ze=0;ze<ve;++ze){var Xe=re[de+ze],et=Xe>>>8,ot=Xe,wt=255&(wt=(wt=Xe>>>16)+((D.jd<<24>>24)*(et<<24>>24)>>>5));ot=255&(ot=(ot=ot+((D.hd<<24>>24)*(et<<24>>24)>>>5))+((D.ud<<24>>24)*(wt<<24>>24)>>>5)),Oe[$e+ze]=(4278255360&Xe)+(wt<<16)+ot}}function fe(D,re,de,ve,Oe){E[re]=function($e,ze,Xe,et,ot,wt,Pt,Ut,Ft){for(et=Pt;et<Ut;++et)for(Pt=0;Pt<Ft;++Pt)ot[wt++]=Oe(Xe[ve($e[ze++])])},E[D]=function($e,ze,Xe,et,ot,wt,Pt){var Ut=8>>$e.b,Ft=$e.Ea,as=$e.K[0],Kt=$e.w;if(8>Ut)for($e=(1<<$e.b)-1,Kt=(1<<Ut)-1;ze<Xe;++ze){var kt,Et=0;for(kt=0;kt<Ft;++kt)kt&$e||(Et=ve(et[ot++])),wt[Pt++]=Oe(as[Et&Kt]),Et>>=Ut}else E["VP8LMapColor"+de](et,ot,as,Kt,wt,Pt,ze,Xe,Ft)}}function he(D,re,de,ve,Oe){for(de=re+de;re<de;){var $e=D[re++];ve[Oe++]=$e>>16&255,ve[Oe++]=$e>>8&255,ve[Oe++]=$e>>0&255}}function Ue(D,re,de,ve,Oe){for(de=re+de;re<de;){var $e=D[re++];ve[Oe++]=$e>>16&255,ve[Oe++]=$e>>8&255,ve[Oe++]=$e>>0&255,ve[Oe++]=$e>>24&255}}function Ye(D,re,de,ve,Oe){for(de=re+de;re<de;){var $e=(ze=D[re++])>>16&240|ze>>12&15,ze=ze>>0&240|ze>>28&15;ve[Oe++]=$e,ve[Oe++]=ze}}function Ke(D,re,de,ve,Oe){for(de=re+de;re<de;){var $e=(ze=D[re++])>>16&248|ze>>13&7,ze=ze>>5&224|ze>>3&31;ve[Oe++]=$e,ve[Oe++]=ze}}function Je(D,re,de,ve,Oe){for(de=re+de;re<de;){var $e=D[re++];ve[Oe++]=$e>>0&255,ve[Oe++]=$e>>8&255,ve[Oe++]=$e>>16&255}}function xe(D,re,de,ve,Oe,$e){if($e==0)for(de=re+de;re<de;)se(ve,(($e=D[re++])[0]>>24|$e[1]>>8&65280|$e[2]<<8&16711680|$e[3]<<24)>>>0),Oe+=32;else a(ve,Oe,D,re,de)}function ye(D,re){E[re][0]=E[D+"0"],E[re][1]=E[D+"1"],E[re][2]=E[D+"2"],E[re][3]=E[D+"3"],E[re][4]=E[D+"4"],E[re][5]=E[D+"5"],E[re][6]=E[D+"6"],E[re][7]=E[D+"7"],E[re][8]=E[D+"8"],E[re][9]=E[D+"9"],E[re][10]=E[D+"10"],E[re][11]=E[D+"11"],E[re][12]=E[D+"12"],E[re][13]=E[D+"13"],E[re][14]=E[D+"0"],E[re][15]=E[D+"0"]}function Ae(D){return D==Rd||D==Gc||D==$u||D==Vu}function be(){this.eb=[],this.size=this.A=this.fb=0}function Ee(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function dt(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new be,this.f.kb=new Ee,this.sd=null}function mt(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function it(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function ht(D){return alert("todo:WebPSamplerProcessPlane"),D.T}function ft(D,re){var de=D.T,ve=re.ba.f.RGBA,Oe=ve.eb,$e=ve.fb+D.ka*ve.A,ze=ri[re.ba.S],Xe=D.y,et=D.O,ot=D.f,wt=D.N,Pt=D.ea,Ut=D.W,Ft=re.cc,as=re.dc,Kt=re.Mc,kt=re.Nc,Et=D.ka,Xt=D.ka+D.T,Yt=D.U,ts=Yt+1>>1;for(Et==0?ze(Xe,et,null,null,ot,wt,Pt,Ut,ot,wt,Pt,Ut,Oe,$e,null,null,Yt):(ze(re.ec,re.fc,Xe,et,Ft,as,Kt,kt,ot,wt,Pt,Ut,Oe,$e-ve.A,Oe,$e,Yt),++de);Et+2<Xt;Et+=2)Ft=ot,as=wt,Kt=Pt,kt=Ut,wt+=D.Rc,Ut+=D.Rc,$e+=2*ve.A,ze(Xe,(et+=2*D.fa)-D.fa,Xe,et,Ft,as,Kt,kt,ot,wt,Pt,Ut,Oe,$e-ve.A,Oe,$e,Yt);return et+=D.fa,D.j+Xt<D.o?(a(re.ec,re.fc,Xe,et,Yt),a(re.cc,re.dc,ot,wt,ts),a(re.Mc,re.Nc,Pt,Ut,ts),de--):1&Xt||ze(Xe,et,null,null,ot,wt,Pt,Ut,ot,wt,Pt,Ut,Oe,$e+ve.A,null,null,Yt),de}function Rt(D,re,de){var ve=D.F,Oe=[D.J];if(ve!=null){var $e=D.U,ze=re.ba.S,Xe=ze==qu||ze==$u;re=re.ba.f.RGBA;var et=[0],ot=D.ka;et[0]=D.T,D.Kb&&(ot==0?--et[0]:(--ot,Oe[0]-=D.width),D.j+D.ka+D.T==D.o&&(et[0]=D.o-D.j-ot));var wt=re.eb;ot=re.fb+ot*re.A,D=Lr(ve,Oe[0],D.width,$e,et,wt,ot+(Xe?0:3),re.A),s(de==et),D&&Ae(ze)&&ti(wt,ot,Xe,$e,et,re.A)}return 0}function Ge(D){var re=D.ma,de=re.ba.S,ve=11>de,Oe=de==oc||de==Hu||de==qu||de==Hr||de==12||Ae(de);if(re.memory=null,re.Ib=null,re.Jb=null,re.Nd=null,!Cd(re.Oa,D,Oe?11:12))return 0;if(Oe&&Ae(de)&&cs(),D.da)alert("todo:use_scaling");else{if(ve){if(re.Ib=ht,D.Kb){if(de=D.U+1>>1,re.memory=i(D.U+2*de),re.memory==null)return 0;re.ec=re.memory,re.fc=0,re.cc=re.ec,re.dc=re.fc+D.U,re.Mc=re.cc,re.Nc=re.dc+de,re.Ib=ft,cs()}}else alert("todo:EmitYUV");Oe&&(re.Jb=Rt,ve&&Dt())}if(ve&&!un){for(D=0;256>D;++D)ai[D]=89858*(D-128)+xl>>_o,ni[D]=-22014*(D-128)+xl,Hd[D]=-45773*(D-128),Xc[D]=113618*(D-128)+xl>>_o;for(D=Dr;D<Rr;++D)re=76283*(D-16)+xl>>_o,Wm[D-Dr]=Ei(re,255),pp[D-Dr]=Ei(re+8>>4,15);un=1}return 1}function at(D){var re=D.ma,de=D.U,ve=D.T;return s(!(1&D.ka)),0>=de||0>=ve?0:(de=re.Ib(D,re),re.Jb!=null&&re.Jb(D,re,de),re.Dc+=de,1)}function je(D){D.ma.memory=null}function Se(D,re,de,ve){return V(D,8)!=47?0:(re[0]=V(D,14)+1,de[0]=V(D,14)+1,ve[0]=V(D,1),V(D,3)!=0?0:!D.h)}function nt(D,re){if(4>D)return D+1;var de=D-2>>1;return(2+(1&D)<<de)+V(re,de)+1}function Ze(D,re){return 120<re?re-120:1<=(de=((de=Og[re-1])>>4)*D+(8-(15&de)))?de:1;var de}function gt(D,re,de){var ve=k(de),Oe=D[re+=255&ve].g-8;return 0<Oe&&(G(de,de.u+8),ve=k(de),re+=D[re].value,re+=ve&(1<<Oe)-1),G(de,de.u+D[re].g),D[re].value}function jt(D,re,de){return de.g+=D.g,de.value+=D.value<<re>>>0,s(8>=de.g),D.g}function Mt(D,re,de){var ve=D.xc;return s((re=ve==0?0:D.vc[D.md*(de>>ve)+(re>>ve)])<D.Wb),D.Ya[re]}function Ne(D,re,de,ve){var Oe=D.ab,$e=D.c*re,ze=D.C;re=ze+re;var Xe=de,et=ve;for(ve=D.Ta,de=D.Ua;0<Oe--;){var ot=D.gc[Oe],wt=ze,Pt=re,Ut=Xe,Ft=et,as=(et=ve,Xe=de,ot.Ea);switch(s(wt<Pt),s(Pt<=ot.nc),ot.hc){case 2:Qm(Ut,Ft,(Pt-wt)*as,et,Xe);break;case 0:var Kt=wt,kt=Pt,Et=et,Xt=Xe,Yt=(ys=ot).Ea;Kt==0&&(Qc(Ut,Ft,null,null,1,Et,Xt),De(Ut,Ft+1,0,0,Yt-1,Et,Xt+1),Ft+=Yt,Xt+=Yt,++Kt);for(var ts=1<<ys.b,_s=ts-1,bs=we(Yt,ys.b),Ms=ys.K,ys=ys.w+(Kt>>ys.b)*bs;Kt<kt;){var jr=Ms,Nr=ys,gr=1;for(xo(Ut,Ft,Et,Xt-Yt,1,Et,Xt);gr<Yt;){var nr=(gr&~_s)+ts;nr>Yt&&(nr=Yt),(0,Ul[jr[Nr++]>>8&15])(Ut,Ft+ +gr,Et,Xt+gr-Yt,nr-gr,Et,Xt+gr),gr=nr}Ft+=Yt,Xt+=Yt,++Kt&_s||(ys+=bs)}Pt!=ot.nc&&a(et,Xe-as,et,Xe+(Pt-wt-1)*as,as);break;case 1:for(as=Ut,kt=Ft,Yt=(Ut=ot.Ea)-(Xt=Ut&~(Et=(Ft=1<<ot.b)-1)),Kt=we(Ut,ot.b),ts=ot.K,ot=ot.w+(wt>>ot.b)*Kt;wt<Pt;){for(_s=ts,bs=ot,Ms=new Fe,ys=kt+Xt,jr=kt+Ut;kt<ys;)Ce(_s[bs++],Ms),nc(Ms,as,kt,Ft,et,Xe),kt+=Ft,Xe+=Ft;kt<jr&&(Ce(_s[bs++],Ms),nc(Ms,as,kt,Yt,et,Xe),kt+=Yt,Xe+=Yt),++wt&Et||(ot+=Kt)}break;case 3:if(Ut==et&&Ft==Xe&&0<ot.b){for(kt=et,Ut=as=Xe+(Pt-wt)*as-(Xt=(Pt-wt)*we(ot.Ea,ot.b)),Ft=et,Et=Xe,Kt=[],Xt=(Yt=Xt)-1;0<=Xt;--Xt)Kt[Xt]=Ft[Et+Xt];for(Xt=Yt-1;0<=Xt;--Xt)kt[Ut+Xt]=Kt[Xt];Un(ot,wt,Pt,et,as,et,Xe)}else Un(ot,wt,Pt,Ut,Ft,et,Xe)}Xe=ve,et=de}et!=de&&a(ve,de,Xe,et,$e)}function ke(D,re){var de=D.V,ve=D.Ba+D.c*D.C,Oe=re-D.C;if(s(re<=D.l.o),s(16>=Oe),0<Oe){var $e=D.l,ze=D.Ta,Xe=D.Ua,et=$e.width;if(Ne(D,Oe,de,ve),Oe=Xe=[Xe],s((de=D.C)<(ve=re)),s($e.v<$e.va),ve>$e.o&&(ve=$e.o),de<$e.j){var ot=$e.j-de;de=$e.j,Oe[0]+=ot*et}if(de>=ve?de=0:(Oe[0]+=4*$e.v,$e.ka=de-$e.j,$e.U=$e.va-$e.v,$e.T=ve-de,de=1),de){if(Xe=Xe[0],11>(de=D.ca).S){var wt=de.f.RGBA,Pt=(ve=de.S,Oe=$e.U,$e=$e.T,ot=wt.eb,wt.A),Ut=$e;for(wt=wt.fb+D.Ma*wt.A;0<Ut--;){var Ft=ze,as=Xe,Kt=Oe,kt=ot,Et=wt;switch(ve){case Hm:Rn(Ft,as,Kt,kt,Et);break;case oc:bn(Ft,as,Kt,kt,Et);break;case Rd:bn(Ft,as,Kt,kt,Et),ti(kt,Et,0,Kt,1,0);break;case up:vo(Ft,as,Kt,kt,Et);break;case Hu:xe(Ft,as,Kt,kt,Et,1);break;case Gc:xe(Ft,as,Kt,kt,Et,1),ti(kt,Et,0,Kt,1,0);break;case qu:xe(Ft,as,Kt,kt,Et,0);break;case $u:xe(Ft,as,Kt,kt,Et,0),ti(kt,Et,1,Kt,1,0);break;case Hr:ic(Ft,as,Kt,kt,Et);break;case Vu:ic(Ft,as,Kt,kt,Et),Qr(kt,Et,Kt,1,0);break;case qm:go(Ft,as,Kt,kt,Et);break;default:s(0)}Xe+=et,wt+=Pt}D.Ma+=$e}else alert("todo:EmitRescaledRowsYUVA");s(D.Ma<=de.height)}}D.C=re,s(D.C<=D.i)}function qe(D){var re;if(0<D.ua)return 0;for(re=0;re<D.Wb;++re){var de=D.Ya[re].G,ve=D.Ya[re].H;if(0<de[1][ve[1]+0].g||0<de[2][ve[2]+0].g||0<de[3][ve[3]+0].g)return 0}return 1}function ge(D,re,de,ve,Oe,$e){if(D.Z!=0){var ze=D.qd,Xe=D.rd;for(s(jn[D.Z]!=null);re<de;++re)jn[D.Z](ze,Xe,ve,Oe,ve,Oe,$e),ze=ve,Xe=Oe,Oe+=$e;D.qd=ze,D.rd=Xe}}function Me(D,re){var de=D.l.ma,ve=de.Z==0||de.Z==1?D.l.j:D.C;if(ve=D.C<ve?ve:D.C,s(re<=D.l.o),re>ve){var Oe=D.l.width,$e=de.ca,ze=de.tb+Oe*ve,Xe=D.V,et=D.Ba+D.c*ve,ot=D.gc;s(D.ab==1),s(ot[0].hc==3),Ou(ot[0],ve,re,Xe,et,$e,ze),ge(de,ve,re,$e,ze,Oe)}D.C=D.Ma=re}function Ve(D,re,de,ve,Oe,$e,ze){var Xe=D.$/ve,et=D.$%ve,ot=D.m,wt=D.s,Pt=de+D.$,Ut=Pt;Oe=de+ve*Oe;var Ft=de+ve*$e,as=280+wt.ua,Kt=D.Pb?Xe:16777216,kt=0<wt.ua?wt.Wa:null,Et=wt.wc,Xt=Pt<Ft?Mt(wt,et,Xe):null;s(D.C<$e),s(Ft<=Oe);var Yt=!1;e:for(;;){for(;Yt||Pt<Ft;){var ts=0;if(Xe>=Kt){var _s=Pt-de;s((Kt=D).Pb),Kt.wd=Kt.m,Kt.xd=_s,0<Kt.s.ua&&le(Kt.s.Wa,Kt.s.vb),Kt=Xe+Vm}if(et&Et||(Xt=Mt(wt,et,Xe)),s(Xt!=null),Xt.Qb&&(re[Pt]=Xt.qb,Yt=!0),!Yt)if(O(ot),Xt.jc){ts=ot,_s=re;var bs=Pt,Ms=Xt.pd[k(ts)&pa-1];s(Xt.jc),256>Ms.g?(G(ts,ts.u+Ms.g),_s[bs]=Ms.value,ts=0):(G(ts,ts.u+Ms.g-256),s(256<=Ms.value),ts=Ms.value),ts==0&&(Yt=!0)}else ts=gt(Xt.G[0],Xt.H[0],ot);if(ot.h)break;if(Yt||256>ts){if(!Yt)if(Xt.nd)re[Pt]=(Xt.qb|ts<<8)>>>0;else{if(O(ot),Yt=gt(Xt.G[1],Xt.H[1],ot),O(ot),_s=gt(Xt.G[2],Xt.H[2],ot),bs=gt(Xt.G[3],Xt.H[3],ot),ot.h)break;re[Pt]=(bs<<24|Yt<<16|ts<<8|_s)>>>0}if(Yt=!1,++Pt,++et>=ve&&(et=0,++Xe,ze!=null&&Xe<=$e&&!(Xe%16)&&ze(D,Xe),kt!=null))for(;Ut<Pt;)ts=re[Ut++],kt.X[(506832829*ts&4294967295)>>>kt.Mb]=ts}else if(280>ts){if(ts=nt(ts-256,ot),_s=gt(Xt.G[4],Xt.H[4],ot),O(ot),_s=Ze(ve,_s=nt(_s,ot)),ot.h)break;if(Pt-de<_s||Oe-Pt<ts)break e;for(bs=0;bs<ts;++bs)re[Pt+bs]=re[Pt+bs-_s];for(Pt+=ts,et+=ts;et>=ve;)et-=ve,++Xe,ze!=null&&Xe<=$e&&!(Xe%16)&&ze(D,Xe);if(s(Pt<=Oe),et&Et&&(Xt=Mt(wt,et,Xe)),kt!=null)for(;Ut<Pt;)ts=re[Ut++],kt.X[(506832829*ts&4294967295)>>>kt.Mb]=ts}else{if(!(ts<as))break e;for(Yt=ts-280,s(kt!=null);Ut<Pt;)ts=re[Ut++],kt.X[(506832829*ts&4294967295)>>>kt.Mb]=ts;ts=Pt,s(!(Yt>>>(_s=kt).Xa)),re[ts]=_s.X[Yt],Yt=!0}Yt||s(ot.h==B(ot))}if(D.Pb&&ot.h&&Pt<Oe)s(D.m.h),D.a=5,D.m=D.wd,D.$=D.xd,0<D.s.ua&&le(D.s.vb,D.s.Wa);else{if(ot.h)break e;ze!=null&&ze(D,Xe>$e?$e:Xe),D.a=0,D.$=Pt-de}return 1}return D.a=3,0}function vt(D){s(D!=null),D.vc=null,D.yc=null,D.Ya=null;var re=D.Wa;re!=null&&(re.X=null),D.vb=null,s(D!=null)}function St(){var D=new rr;return D==null?null:(D.a=0,D.xb=Md,ye("Predictor","VP8LPredictors"),ye("Predictor","VP8LPredictors_C"),ye("PredictorAdd","VP8LPredictorsAdd"),ye("PredictorAdd","VP8LPredictorsAdd_C"),Qm=Te,nc=Pe,Rn=he,bn=Ue,ic=Ye,go=Ke,vo=Je,E.VP8LMapColor32b=Id,E.VP8LMapColor8b=Ld,D)}function xt(D,re,de,ve,Oe){var $e=1,ze=[D],Xe=[re],et=ve.m,ot=ve.s,wt=null,Pt=0;e:for(;;){if(de)for(;$e&&V(et,1);){var Ut=ze,Ft=Xe,as=ve,Kt=1,kt=as.m,Et=as.gc[as.ab],Xt=V(kt,2);if(as.Oc&1<<Xt)$e=0;else{switch(as.Oc|=1<<Xt,Et.hc=Xt,Et.Ea=Ut[0],Et.nc=Ft[0],Et.K=[null],++as.ab,s(4>=as.ab),Xt){case 0:case 1:Et.b=V(kt,3)+2,Kt=xt(we(Et.Ea,Et.b),we(Et.nc,Et.b),0,as,Et.K),Et.K=Et.K[0];break;case 3:var Yt,ts=V(kt,8)+1,_s=16<ts?0:4<ts?1:2<ts?2:3;if(Ut[0]=we(Et.Ea,_s),Et.b=_s,Yt=Kt=xt(ts,1,0,as,Et.K)){var bs,Ms=ts,ys=Et,jr=1<<(8>>ys.b),Nr=i(jr);if(Nr==null)Yt=0;else{var gr=ys.K[0],nr=ys.w;for(Nr[0]=ys.K[0][0],bs=1;bs<1*Ms;++bs)Nr[bs]=Ie(gr[nr+bs],Nr[bs-1]);for(;bs<4*jr;++bs)Nr[bs]=0;ys.K[0]=null,ys.K[0]=Nr,Yt=1}}Kt=Yt;break;case 2:break;default:s(0)}$e=Kt}}if(ze=ze[0],Xe=Xe[0],$e&&V(et,1)&&!($e=1<=(Pt=V(et,4))&&11>=Pt)){ve.a=3;break e}var Pr;if(Pr=$e)t:{var Or,zs,la,Qn=ve,ya=ze,Oa=Xe,kr=Pt,Nn=de,wn=Qn.m,oa=Qn.s,Ma=[null],mn=1,ii=0,Ji=hp[kr];s:for(;;){if(Nn&&V(wn,1)){var ca=V(wn,3)+2,Ea=we(ya,ca),Ti=we(Oa,ca),uc=Ea*Ti;if(!xt(Ea,Ti,0,Qn,Ma))break s;for(Ma=Ma[0],oa.xc=ca,Or=0;Or<uc;++Or){var Co=Ma[Or]>>8&65535;Ma[Or]=Co,Co>=mn&&(mn=Co+1)}}if(wn.h)break s;for(zs=0;5>zs;++zs){var Er=Kc[zs];!zs&&0<kr&&(Er+=1<<kr),ii<Er&&(ii=Er)}var Hl=l(mn*Ji,T),Gm=mn,AA=l(Gm,H);if(AA==null)var Zi=null;else s(65536>=Gm),Zi=AA;var el=i(ii);if(Zi==null||el==null||Hl==null){Qn.a=1;break s}var Zc=Hl;for(Or=la=0;Or<mn;++Or){var tl=Zi[Or],ko=tl.G,ed=tl.H,qd=0,Ii=1,$d=0;for(zs=0;5>zs;++zs){Er=Kc[zs],ko[zs]=Zc,ed[zs]=la,!zs&&0<kr&&(Er+=1<<kr);a:{var mc,Eo=Er,Vd=Qn,ql=el,gp=Zc,fA=la,Jr=0,gl=Vd.m,pA=V(gl,1);if(n(ql,0,0,Eo),pA){var xA=V(gl,1)+1,Km=V(gl,1),zm=V(gl,Km==0?1:8);ql[zm]=1,xA==2&&(ql[zm=V(gl,8)]=1);var $l=1}else{var sa=i(19),Ba=V(gl,4)+4;if(19<Ba){Vd.a=3;var ja=0;break a}for(mc=0;mc<Ba;++mc)sa[Rg[mc]]=V(gl,3);var Wd=void 0,Bo=void 0,Gd=Vd,$g=sa,Qa=Eo,Ym=ql,Yu=0,Vl=Gd.m,vl=8,Li=l(128,T);r:for(;U(Li,0,7,$g,19);){if(V(Vl,1)){var Xu=2+2*V(Vl,3);if((Wd=2+V(Vl,Xu))>Qa)break r}else Wd=Qa;for(Bo=0;Bo<Qa&&Wd--;){O(Vl);var Xm=Li[0+(127&k(Vl))];G(Vl,Vl.u+Xm.g);var hc=Xm.value;if(16>hc)Ym[Bo++]=hc,hc!=0&&(vl=hc);else{var vp=hc==16,gA=hc-16,bp=$m[gA],vA=V(Vl,Wu[gA])+bp;if(Bo+vA>Qa)break r;for(var yp=vp?vl:0;0<vA--;)Ym[Bo++]=yp}}Yu=1;break r}Yu||(Gd.a=3),$l=Yu}($l=$l&&!gl.h)&&(Jr=U(gp,fA,8,ql,Eo)),$l&&Jr!=0?ja=Jr:(Vd.a=3,ja=0)}if(ja==0)break s;if(Ii&&mp[zs]==1&&(Ii=Zc[la].g==0),qd+=Zc[la].g,la+=ja,3>=zs){var Kd,Jm=el[0];for(Kd=1;Kd<Er;++Kd)el[Kd]>Jm&&(Jm=el[Kd]);$d+=Jm}}if(tl.nd=Ii,tl.Qb=0,Ii&&(tl.qb=(ko[3][ed[3]+0].value<<24|ko[1][ed[1]+0].value<<16|ko[2][ed[2]+0].value)>>>0,qd==0&&256>ko[0][ed[0]+0].value&&(tl.Qb=1,tl.qb+=ko[0][ed[0]+0].value<<8)),tl.jc=!tl.Qb&&6>$d,tl.jc){var Ju,Di=tl;for(Ju=0;Ju<pa;++Ju){var Fo=Ju,bl=Di.pd[Fo],td=Di.G[0][Di.H[0]+Fo];256<=td.value?(bl.g=td.g+256,bl.value=td.value):(bl.g=0,bl.value=0,Fo>>=jt(td,8,bl),Fo>>=jt(Di.G[1][Di.H[1]+Fo],16,bl),Fo>>=jt(Di.G[2][Di.H[2]+Fo],0,bl),jt(Di.G[3][Di.H[3]+Fo],24,bl))}}}oa.vc=Ma,oa.Wb=mn,oa.Ya=Zi,oa.yc=Hl,Pr=1;break t}Pr=0}if(!($e=Pr)){ve.a=3;break e}if(0<Pt){if(ot.ua=1<<Pt,!oe(ot.Wa,Pt)){ve.a=1,$e=0;break e}}else ot.ua=0;var Zm=ve,eh=ze,jp=Xe,th=Zm.s,sh=th.xc;if(Zm.c=eh,Zm.i=jp,th.md=we(eh,sh),th.wc=sh==0?-1:(1<<sh)-1,de){ve.xb=Ql;break e}if((wt=i(ze*Xe))==null){ve.a=1,$e=0;break e}$e=($e=Ve(ve,wt,0,ze,Xe,Xe,null))&&!et.h;break e}return $e?(Oe!=null?Oe[0]=wt:(s(wt==null),s(de)),ve.$=0,de||vt(ot)):vt(ot),$e}function Ct(D,re){var de=D.c*D.i,ve=de+re+16*re;return s(D.c<=re),D.V=i(ve),D.V==null?(D.Ta=null,D.Ua=0,D.a=1,0):(D.Ta=D.V,D.Ua=D.Ba+de+re,1)}function Tt(D,re){var de=D.C,ve=re-de,Oe=D.V,$e=D.Ba+D.c*de;for(s(re<=D.l.o);0<ve;){var ze=16<ve?16:ve,Xe=D.l.ma,et=D.l.width,ot=et*ze,wt=Xe.ca,Pt=Xe.tb+et*de,Ut=D.Ta,Ft=D.Ua;Ne(D,ze,Oe,$e),xa(Ut,Ft,wt,Pt,ot),ge(Xe,de,de+ze,wt,Pt,et),ve-=ze,Oe+=ze*D.c,de+=ze}s(de==re),D.C=D.Ma=re}function bt(){this.ub=this.yd=this.td=this.Rb=0}function Jt(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Gt(){this.Fb=this.Bb=this.Cb=0,this.Zb=i(4),this.Lb=i(4)}function Ht(){this.Yb=(function(){var D=[];return(function re(de,ve,Oe){for(var $e=Oe[ve],ze=0;ze<$e&&(de.push(Oe.length>ve+1?[]:0),!(Oe.length<ve+1));ze++)re(de[ze],ve+1,Oe)})(D,0,[3,11]),D})()}function es(){this.jb=i(3),this.Wc=o([4,8],Ht),this.Xc=o([4,17],Ht)}function js(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new i(4),this.od=new i(4)}function Zs(){this.ld=this.La=this.dd=this.tc=0}function Xs(){this.Na=this.la=0}function Hs(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Bs(){this.ad=i(384),this.Za=0,this.Ob=i(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Ln(){this.uc=this.M=this.Nb=0,this.wa=Array(new Zs),this.Y=0,this.ya=Array(new Bs),this.aa=0,this.l=new Ja}function br(){this.y=i(16),this.f=i(8),this.ea=i(8)}function mr(){this.cb=this.a=0,this.sc="",this.m=new P,this.Od=new bt,this.Kc=new Jt,this.ed=new js,this.Qa=new Gt,this.Ic=this.$c=this.Aa=0,this.D=new Ln,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=l(8,P),this.ia=0,this.pb=l(4,Hs),this.Pa=new es,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new br),this.Hd=0,this.rb=Array(new Xs),this.sb=0,this.wa=Array(new Zs),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Bs),this.L=this.aa=0,this.gd=o([4,2],Zs),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Ja(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Tr(){var D=new mr;return D!=null&&(D.a=0,D.sc="OK",D.cb=0,D.Xb=0,zc||(zc=Sa)),D}function ta(D,re,de){return D.a==0&&(D.a=re,D.sc=de,D.cb=0),0}function fl(D,re,de){return 3<=de&&D[re+0]==157&&D[re+1]==1&&D[re+2]==42}function Za(D,re){if(D==null)return 0;if(D.a=0,D.sc="OK",re==null)return ta(D,2,"null VP8Io passed to VP8GetHeaders()");var de=re.data,ve=re.w,Oe=re.ha;if(4>Oe)return ta(D,7,"Truncated header.");var $e=de[ve+0]|de[ve+1]<<8|de[ve+2]<<16,ze=D.Od;if(ze.Rb=!(1&$e),ze.td=$e>>1&7,ze.yd=$e>>4&1,ze.ub=$e>>5,3<ze.td)return ta(D,3,"Incorrect keyframe parameters.");if(!ze.yd)return ta(D,4,"Frame not displayable.");ve+=3,Oe-=3;var Xe=D.Kc;if(ze.Rb){if(7>Oe)return ta(D,7,"cannot parse picture header");if(!fl(de,ve,Oe))return ta(D,3,"Bad code word");Xe.c=16383&(de[ve+4]<<8|de[ve+3]),Xe.Td=de[ve+4]>>6,Xe.i=16383&(de[ve+6]<<8|de[ve+5]),Xe.Ud=de[ve+6]>>6,ve+=7,Oe-=7,D.za=Xe.c+15>>4,D.Ub=Xe.i+15>>4,re.width=Xe.c,re.height=Xe.i,re.Da=0,re.j=0,re.v=0,re.va=re.width,re.o=re.height,re.da=0,re.ib=re.width,re.hb=re.height,re.U=re.width,re.T=re.height,n(($e=D.Pa).jb,0,255,$e.jb.length),s(($e=D.Qa)!=null),$e.Cb=0,$e.Bb=0,$e.Fb=1,n($e.Zb,0,0,$e.Zb.length),n($e.Lb,0,0,$e.Lb)}if(ze.ub>Oe)return ta(D,7,"bad partition length");M($e=D.m,de,ve,ze.ub),ve+=ze.ub,Oe-=ze.ub,ze.Rb&&(Xe.Ld=J($e),Xe.Kd=J($e)),Xe=D.Qa;var et,ot=D.Pa;if(s($e!=null),s(Xe!=null),Xe.Cb=J($e),Xe.Cb){if(Xe.Bb=J($e),J($e)){for(Xe.Fb=J($e),et=0;4>et;++et)Xe.Zb[et]=J($e)?z($e,7):0;for(et=0;4>et;++et)Xe.Lb[et]=J($e)?z($e,6):0}if(Xe.Bb)for(et=0;3>et;++et)ot.jb[et]=J($e)?q($e,8):255}else Xe.Bb=0;if($e.Ka)return ta(D,3,"cannot parse segment header");if((Xe=D.ed).zd=J($e),Xe.Tb=q($e,6),Xe.wb=q($e,3),Xe.Pc=J($e),Xe.Pc&&J($e)){for(ot=0;4>ot;++ot)J($e)&&(Xe.vd[ot]=z($e,6));for(ot=0;4>ot;++ot)J($e)&&(Xe.od[ot]=z($e,6))}if(D.L=Xe.Tb==0?0:Xe.zd?1:2,$e.Ka)return ta(D,3,"cannot parse filter header");var wt=Oe;if(Oe=et=ve,ve=et+wt,Xe=wt,D.Xb=(1<<q(D.m,2))-1,wt<3*(ot=D.Xb))de=7;else{for(et+=3*ot,Xe-=3*ot,wt=0;wt<ot;++wt){var Pt=de[Oe+0]|de[Oe+1]<<8|de[Oe+2]<<16;Pt>Xe&&(Pt=Xe),M(D.Jc[+wt],de,et,Pt),et+=Pt,Xe-=Pt,Oe+=3}M(D.Jc[+ot],de,et,Xe),de=et<ve?0:5}if(de!=0)return ta(D,de,"cannot parse partitions");for(de=q(et=D.m,7),Oe=J(et)?z(et,4):0,ve=J(et)?z(et,4):0,Xe=J(et)?z(et,4):0,ot=J(et)?z(et,4):0,et=J(et)?z(et,4):0,wt=D.Qa,Pt=0;4>Pt;++Pt){if(wt.Cb){var Ut=wt.Zb[Pt];wt.Fb||(Ut+=de)}else{if(0<Pt){D.pb[Pt]=D.pb[0];continue}Ut=de}var Ft=D.pb[Pt];Ft.Sc[0]=Od[Ei(Ut+Oe,127)],Ft.Sc[1]=Gu[Ei(Ut+0,127)],Ft.Eb[0]=2*Od[Ei(Ut+ve,127)],Ft.Eb[1]=101581*Gu[Ei(Ut+Xe,127)]>>16,8>Ft.Eb[1]&&(Ft.Eb[1]=8),Ft.Qc[0]=Od[Ei(Ut+ot,117)],Ft.Qc[1]=Gu[Ei(Ut+et,127)],Ft.lc=Ut+et}if(!ze.Rb)return ta(D,4,"Not a key frame.");for(J($e),ze=D.Pa,de=0;4>de;++de){for(Oe=0;8>Oe;++Oe)for(ve=0;3>ve;++ve)for(Xe=0;11>Xe;++Xe)ot=te($e,Qg[de][Oe][ve][Xe])?q($e,8):fp[de][Oe][ve][Xe],ze.Wc[de][Oe].Yb[ve][Xe]=ot;for(Oe=0;17>Oe;++Oe)ze.Xc[de][Oe]=ze.Wc[de][uA[Oe]]}return D.kc=J($e),D.kc&&(D.Bd=q($e,8)),D.cb=1}function Sa(D,re,de,ve,Oe,$e,ze){var Xe=re[Oe].Yb[de];for(de=0;16>Oe;++Oe){if(!te(D,Xe[de+0]))return Oe;for(;!te(D,Xe[de+1]);)if(Xe=re[++Oe].Yb[0],de=0,Oe==16)return 16;var et=re[Oe+1].Yb;if(te(D,Xe[de+2])){var ot=D,wt=0;if(te(ot,(Ut=Xe)[(Pt=de)+3]))if(te(ot,Ut[Pt+6])){for(Xe=0,Pt=2*(wt=te(ot,Ut[Pt+8]))+(Ut=te(ot,Ut[Pt+9+wt])),wt=0,Ut=cA[Pt];Ut[Xe];++Xe)wt+=wt+te(ot,Ut[Xe]);wt+=3+(8<<Pt)}else te(ot,Ut[Pt+7])?(wt=7+2*te(ot,165),wt+=te(ot,145)):wt=5+te(ot,159);else wt=te(ot,Ut[Pt+4])?3+te(ot,Ut[Pt+5]):2;Xe=et[2]}else wt=1,Xe=et[1];et=ze+dA[Oe],0>(ot=D).b&&K(ot);var Pt,Ut=ot.b,Ft=(Pt=ot.Ca>>1)-(ot.I>>Ut)>>31;--ot.b,ot.Ca+=Ft,ot.Ca|=1,ot.I-=(Pt+1&Ft)<<Ut,$e[et]=((wt^Ft)-Ft)*ve[(0<Oe)+0]}return 16}function Ci(D){var re=D.rb[D.sb-1];re.la=0,re.Na=0,n(D.zc,0,0,D.zc.length),D.ja=0}function Vi(D,re){if(D==null)return 0;if(re==null)return ta(D,2,"NULL VP8Io parameter in VP8Decode().");if(!D.cb&&!Za(D,re))return 0;if(s(D.cb),re.ac==null||re.ac(re)){re.ob&&(D.L=0);var de=Jc[D.L];if(D.L==2?(D.yb=0,D.zb=0):(D.yb=re.v-de>>4,D.zb=re.j-de>>4,0>D.yb&&(D.yb=0),0>D.zb&&(D.zb=0)),D.Va=re.o+15+de>>4,D.Hb=re.va+15+de>>4,D.Hb>D.za&&(D.Hb=D.za),D.Va>D.Ub&&(D.Va=D.Ub),0<D.L){var ve=D.ed;for(de=0;4>de;++de){var Oe;if(D.Qa.Cb){var $e=D.Qa.Lb[de];D.Qa.Fb||($e+=ve.Tb)}else $e=ve.Tb;for(Oe=0;1>=Oe;++Oe){var ze=D.gd[de][Oe],Xe=$e;if(ve.Pc&&(Xe+=ve.vd[0],Oe&&(Xe+=ve.od[0])),0<(Xe=0>Xe?0:63<Xe?63:Xe)){var et=Xe;0<ve.wb&&(et=4<ve.wb?et>>2:et>>1)>9-ve.wb&&(et=9-ve.wb),1>et&&(et=1),ze.dd=et,ze.tc=2*Xe+et,ze.ld=40<=Xe?2:15<=Xe?1:0}else ze.tc=0;ze.La=Oe}}}de=0}else ta(D,6,"Frame setup failed"),de=D.a;if(de=de==0){if(de){D.$c=0,0<D.Aa||(D.Ic=So);e:{de=D.Ic,ve=4*(et=D.za);var ot=32*et,wt=et+1,Pt=0<D.L?et*(0<D.Aa?2:1):0,Ut=(D.Aa==2?2:1)*et;if((ze=ve+832+(Oe=3*(16*de+Jc[D.L])/2*ot)+($e=D.Fa!=null&&0<D.Fa.length?D.Kc.c*D.Kc.i:0))!=ze)de=0;else{if(ze>D.Vb){if(D.Vb=0,D.Ec=i(ze),D.Fc=0,D.Ec==null){de=ta(D,1,"no memory during frame initialization.");break e}D.Vb=ze}ze=D.Ec,Xe=D.Fc,D.Ac=ze,D.Bc=Xe,Xe+=ve,D.Gd=l(ot,br),D.Hd=0,D.rb=l(wt+1,Xs),D.sb=1,D.wa=Pt?l(Pt,Zs):null,D.Y=0,D.D.Nb=0,D.D.wa=D.wa,D.D.Y=D.Y,0<D.Aa&&(D.D.Y+=et),s(!0),D.oc=ze,D.pc=Xe,Xe+=832,D.ya=l(Ut,Bs),D.aa=0,D.D.ya=D.ya,D.D.aa=D.aa,D.Aa==2&&(D.D.aa+=et),D.R=16*et,D.B=8*et,et=(ot=Jc[D.L])*D.R,ot=ot/2*D.B,D.sa=ze,D.ta=Xe+et,D.qa=D.sa,D.ra=D.ta+16*de*D.R+ot,D.Ha=D.qa,D.Ia=D.ra+8*de*D.B+ot,D.$c=0,Xe+=Oe,D.mb=$e?ze:null,D.nb=$e?Xe:null,s(Xe+$e<=D.Fc+D.Vb),Ci(D),n(D.Ac,D.Bc,0,ve),de=1}}if(de){if(re.ka=0,re.y=D.sa,re.O=D.ta,re.f=D.qa,re.N=D.ra,re.ea=D.Ha,re.Vd=D.Ia,re.fa=D.R,re.Rc=D.B,re.F=null,re.J=0,!Qu){for(de=-255;255>=de;++de)ka[255+de]=0>de?-de:de;for(de=-1020;1020>=de;++de)Ol[1020+de]=-128>de?-128:127<de?127:de;for(de=-112;112>=de;++de)Pd[112+de]=-16>de?-16:15<de?15:de;for(de=-255;510>=de;++de)Wc[255+de]=0>de?0:255<de?255:de;Qu=1}Dd=hr,bo=Il,yo=xn,yn=Pc,Bi=uo,wr=Jo,Hc=ns,Mu=os,qc=cn,$c=aa,Vc=fs,Fi=or,jo=pr,Rl=na,No=qt,wo=ss,lc=$t,dn=ms,Xi[0]=Ki,Xi[1]=Zo,Xi[2]=ho,Xi[3]=Gi,Xi[4]=Ua,Xi[5]=Ao,Xi[6]=Jn,Xi[7]=fo,Xi[8]=sc,Xi[9]=tc,Mn[0]=Wi,Mn[1]=Uc,Mn[2]=ki,Mn[3]=mo,Mn[4]=Ir,Mn[5]=Yn,Mn[6]=Xn,si[0]=gn,si[1]=ec,si[2]=Pu,si[3]=Ra,si[4]=Be,si[5]=po,si[6]=lt,de=1}else de=0}de&&(de=(function(Ft,as){for(Ft.M=0;Ft.M<Ft.Va;++Ft.M){var Kt,kt=Ft.Jc[Ft.M&Ft.Xb],Et=Ft.m,Xt=Ft;for(Kt=0;Kt<Xt.za;++Kt){var Yt=Et,ts=Xt,_s=ts.Ac,bs=ts.Bc+4*Kt,Ms=ts.zc,ys=ts.ya[ts.aa+Kt];if(ts.Qa.Bb?ys.$b=te(Yt,ts.Pa.jb[0])?2+te(Yt,ts.Pa.jb[2]):te(Yt,ts.Pa.jb[1]):ys.$b=0,ts.kc&&(ys.Ad=te(Yt,ts.Bd)),ys.Za=!te(Yt,145)+0,ys.Za){var jr=ys.Ob,Nr=0;for(ts=0;4>ts;++ts){var gr,nr=Ms[0+ts];for(gr=0;4>gr;++gr){nr=Mg[_s[bs+gr]][nr];for(var Pr=Ap[te(Yt,nr[0])];0<Pr;)Pr=Ap[2*Pr+te(Yt,nr[Pr])];nr=-Pr,_s[bs+gr]=nr}a(jr,Nr,_s,bs,4),Nr+=4,Ms[0+ts]=nr}}else nr=te(Yt,156)?te(Yt,128)?1:3:te(Yt,163)?2:0,ys.Ob[0]=nr,n(_s,bs,nr,4),n(Ms,0,nr,4);ys.Dd=te(Yt,142)?te(Yt,114)?te(Yt,183)?1:3:2:0}if(Xt.m.Ka)return ta(Ft,7,"Premature end-of-partition0 encountered.");for(;Ft.ja<Ft.za;++Ft.ja){if(Xt=kt,Yt=(Et=Ft).rb[Et.sb-1],_s=Et.rb[Et.sb+Et.ja],Kt=Et.ya[Et.aa+Et.ja],bs=Et.kc?Kt.Ad:0)Yt.la=_s.la=0,Kt.Za||(Yt.Na=_s.Na=0),Kt.Hc=0,Kt.Gc=0,Kt.ia=0;else{var Or,zs;if(Yt=_s,_s=Xt,bs=Et.Pa.Xc,Ms=Et.ya[Et.aa+Et.ja],ys=Et.pb[Ms.$b],ts=Ms.ad,jr=0,Nr=Et.rb[Et.sb-1],nr=gr=0,n(ts,jr,0,384),Ms.Za)var la=0,Qn=bs[3];else{Pr=i(16);var ya=Yt.Na+Nr.Na;if(ya=zc(_s,bs[1],ya,ys.Eb,0,Pr,0),Yt.Na=Nr.Na=(0<ya)+0,1<ya)Dd(Pr,0,ts,jr);else{var Oa=Pr[0]+3>>3;for(Pr=0;256>Pr;Pr+=16)ts[jr+Pr]=Oa}la=1,Qn=bs[0]}var kr=15&Yt.la,Nn=15&Nr.la;for(Pr=0;4>Pr;++Pr){var wn=1&Nn;for(Oa=zs=0;4>Oa;++Oa)kr=kr>>1|(wn=(ya=zc(_s,Qn,ya=wn+(1&kr),ys.Sc,la,ts,jr))>la)<<7,zs=zs<<2|(3<ya?3:1<ya?2:ts[jr+0]!=0),jr+=16;kr>>=4,Nn=Nn>>1|wn<<7,gr=(gr<<8|zs)>>>0}for(Qn=kr,la=Nn>>4,Or=0;4>Or;Or+=2){for(zs=0,kr=Yt.la>>4+Or,Nn=Nr.la>>4+Or,Pr=0;2>Pr;++Pr){for(wn=1&Nn,Oa=0;2>Oa;++Oa)ya=wn+(1&kr),kr=kr>>1|(wn=0<(ya=zc(_s,bs[2],ya,ys.Qc,0,ts,jr)))<<3,zs=zs<<2|(3<ya?3:1<ya?2:ts[jr+0]!=0),jr+=16;kr>>=2,Nn=Nn>>1|wn<<5}nr|=zs<<4*Or,Qn|=kr<<4<<Or,la|=(240&Nn)<<Or}Yt.la=Qn,Nr.la=la,Ms.Hc=gr,Ms.Gc=nr,Ms.ia=43690&nr?0:ys.ia,bs=!(gr|nr)}if(0<Et.L&&(Et.wa[Et.Y+Et.ja]=Et.gd[Kt.$b][Kt.Za],Et.wa[Et.Y+Et.ja].La|=!bs),Xt.Ka)return ta(Ft,7,"Premature end-of-file encountered.")}if(Ci(Ft),Et=as,Xt=1,Kt=(kt=Ft).D,Yt=0<kt.L&&kt.M>=kt.zb&&kt.M<=kt.Va,kt.Aa==0)e:{if(Kt.M=kt.M,Kt.uc=Yt,Sd(kt,Kt),Xt=1,Kt=(zs=kt.D).Nb,Yt=(nr=Jc[kt.L])*kt.R,_s=nr/2*kt.B,Pr=16*Kt*kt.R,Oa=8*Kt*kt.B,bs=kt.sa,Ms=kt.ta-Yt+Pr,ys=kt.qa,ts=kt.ra-_s+Oa,jr=kt.Ha,Nr=kt.Ia-_s+Oa,Nn=(kr=zs.M)==0,gr=kr>=kt.Va-1,kt.Aa==2&&Sd(kt,zs),zs.uc)for(wn=(ya=kt).D.M,s(ya.D.uc),zs=ya.yb;zs<ya.Hb;++zs){la=zs,Qn=wn;var oa=(Ma=(Er=ya).D).Nb;Or=Er.R;var Ma=Ma.wa[Ma.Y+la],mn=Er.sa,ii=Er.ta+16*oa*Or+16*la,Ji=Ma.dd,ca=Ma.tc;if(ca!=0)if(s(3<=ca),Er.L==1)0<la&&wo(mn,ii,Or,ca+4),Ma.La&&dn(mn,ii,Or,ca),0<Qn&&No(mn,ii,Or,ca+4),Ma.La&&lc(mn,ii,Or,ca);else{var Ea=Er.B,Ti=Er.qa,uc=Er.ra+8*oa*Ea+8*la,Co=Er.Ha,Er=Er.Ia+8*oa*Ea+8*la;oa=Ma.ld,0<la&&(Mu(mn,ii,Or,ca+4,Ji,oa),$c(Ti,uc,Co,Er,Ea,ca+4,Ji,oa)),Ma.La&&(Fi(mn,ii,Or,ca,Ji,oa),Rl(Ti,uc,Co,Er,Ea,ca,Ji,oa)),0<Qn&&(Hc(mn,ii,Or,ca+4,Ji,oa),qc(Ti,uc,Co,Er,Ea,ca+4,Ji,oa)),Ma.La&&(Vc(mn,ii,Or,ca,Ji,oa),jo(Ti,uc,Co,Er,Ea,ca,Ji,oa))}}if(kt.ia&&alert("todo:DitherRow"),Et.put!=null){if(zs=16*kr,kr=16*(kr+1),Nn?(Et.y=kt.sa,Et.O=kt.ta+Pr,Et.f=kt.qa,Et.N=kt.ra+Oa,Et.ea=kt.Ha,Et.W=kt.Ia+Oa):(zs-=nr,Et.y=bs,Et.O=Ms,Et.f=ys,Et.N=ts,Et.ea=jr,Et.W=Nr),gr||(kr-=nr),kr>Et.o&&(kr=Et.o),Et.F=null,Et.J=null,kt.Fa!=null&&0<kt.Fa.length&&zs<kr&&(Et.J=Uu(kt,Et,zs,kr-zs),Et.F=kt.mb,Et.F==null&&Et.F.length==0)){Xt=ta(kt,3,"Could not decode alpha data.");break e}zs<Et.j&&(nr=Et.j-zs,zs=Et.j,s(!(1&nr)),Et.O+=kt.R*nr,Et.N+=kt.B*(nr>>1),Et.W+=kt.B*(nr>>1),Et.F!=null&&(Et.J+=Et.width*nr)),zs<kr&&(Et.O+=Et.v,Et.N+=Et.v>>1,Et.W+=Et.v>>1,Et.F!=null&&(Et.J+=Et.v),Et.ka=zs-Et.j,Et.U=Et.va-Et.v,Et.T=kr-zs,Xt=Et.put(Et))}Kt+1!=kt.Ic||gr||(a(kt.sa,kt.ta-Yt,bs,Ms+16*kt.R,Yt),a(kt.qa,kt.ra-_s,ys,ts+8*kt.B,_s),a(kt.Ha,kt.Ia-_s,jr,Nr+8*kt.B,_s))}if(!Xt)return ta(Ft,6,"Output aborted.")}return 1})(D,re)),re.bc!=null&&re.bc(re),de&=1}return de?(D.cb=0,de):0}function va(D,re,de,ve,Oe){Oe=D[re+de+32*ve]+(Oe>>3),D[re+de+32*ve]=-256&Oe?0>Oe?0:255:Oe}function en(D,re,de,ve,Oe,$e){va(D,re,0,de,ve+Oe),va(D,re,1,de,ve+$e),va(D,re,2,de,ve-$e),va(D,re,3,de,ve-Oe)}function Pa(D){return(20091*D>>16)+D}function co(D,re,de,ve){var Oe,$e=0,ze=i(16);for(Oe=0;4>Oe;++Oe){var Xe=D[re+0]+D[re+8],et=D[re+0]-D[re+8],ot=(35468*D[re+4]>>16)-Pa(D[re+12]),wt=Pa(D[re+4])+(35468*D[re+12]>>16);ze[$e+0]=Xe+wt,ze[$e+1]=et+ot,ze[$e+2]=et-ot,ze[$e+3]=Xe-wt,$e+=4,re++}for(Oe=$e=0;4>Oe;++Oe)Xe=(D=ze[$e+0]+4)+ze[$e+8],et=D-ze[$e+8],ot=(35468*ze[$e+4]>>16)-Pa(ze[$e+12]),va(de,ve,0,0,Xe+(wt=Pa(ze[$e+4])+(35468*ze[$e+12]>>16))),va(de,ve,1,0,et+ot),va(de,ve,2,0,et-ot),va(de,ve,3,0,Xe-wt),$e++,ve+=32}function Jo(D,re,de,ve){var Oe=D[re+0]+4,$e=35468*D[re+4]>>16,ze=Pa(D[re+4]),Xe=35468*D[re+1]>>16;en(de,ve,0,Oe+ze,D=Pa(D[re+1]),Xe),en(de,ve,1,Oe+$e,D,Xe),en(de,ve,2,Oe-$e,D,Xe),en(de,ve,3,Oe-ze,D,Xe)}function Il(D,re,de,ve,Oe){co(D,re,de,ve),Oe&&co(D,re+16,de,ve+4)}function xn(D,re,de,ve){bo(D,re+0,de,ve,1),bo(D,re+32,de,ve+128,1)}function Pc(D,re,de,ve){var Oe;for(D=D[re+0]+4,Oe=0;4>Oe;++Oe)for(re=0;4>re;++re)va(de,ve,re,Oe,D)}function uo(D,re,de,ve){D[re+0]&&yn(D,re+0,de,ve),D[re+16]&&yn(D,re+16,de,ve+4),D[re+32]&&yn(D,re+32,de,ve+128),D[re+48]&&yn(D,re+48,de,ve+128+4)}function hr(D,re,de,ve){var Oe,$e=i(16);for(Oe=0;4>Oe;++Oe){var ze=D[re+0+Oe]+D[re+12+Oe],Xe=D[re+4+Oe]+D[re+8+Oe],et=D[re+4+Oe]-D[re+8+Oe],ot=D[re+0+Oe]-D[re+12+Oe];$e[0+Oe]=ze+Xe,$e[8+Oe]=ze-Xe,$e[4+Oe]=ot+et,$e[12+Oe]=ot-et}for(Oe=0;4>Oe;++Oe)ze=(D=$e[0+4*Oe]+3)+$e[3+4*Oe],Xe=$e[1+4*Oe]+$e[2+4*Oe],et=$e[1+4*Oe]-$e[2+4*Oe],ot=D-$e[3+4*Oe],de[ve+0]=ze+Xe>>3,de[ve+16]=ot+et>>3,de[ve+32]=ze-Xe>>3,de[ve+48]=ot-et>>3,ve+=64}function Ll(D,re,de){var ve,Oe=re-32,$e=On,ze=255-D[Oe-1];for(ve=0;ve<de;++ve){var Xe,et=$e,ot=ze+D[re-1];for(Xe=0;Xe<de;++Xe)D[re+Xe]=et[ot+D[Oe+Xe]];re+=32}}function Zo(D,re){Ll(D,re,4)}function ec(D,re){Ll(D,re,8)}function Uc(D,re){Ll(D,re,16)}function ki(D,re){var de;for(de=0;16>de;++de)a(D,re+32*de,D,re-32,16)}function mo(D,re){var de;for(de=16;0<de;--de)n(D,re,D[re-1],16),re+=32}function Dl(D,re,de){var ve;for(ve=0;16>ve;++ve)n(re,de+32*ve,D,16)}function Wi(D,re){var de,ve=16;for(de=0;16>de;++de)ve+=D[re-1+32*de]+D[re+de-32];Dl(ve>>5,D,re)}function Ir(D,re){var de,ve=8;for(de=0;16>de;++de)ve+=D[re-1+32*de];Dl(ve>>4,D,re)}function Yn(D,re){var de,ve=8;for(de=0;16>de;++de)ve+=D[re+de-32];Dl(ve>>4,D,re)}function Xn(D,re){Dl(128,D,re)}function Os(D,re,de){return D+2*re+de+2>>2}function ho(D,re){var de,ve=re-32;for(ve=new Uint8Array([Os(D[ve-1],D[ve+0],D[ve+1]),Os(D[ve+0],D[ve+1],D[ve+2]),Os(D[ve+1],D[ve+2],D[ve+3]),Os(D[ve+2],D[ve+3],D[ve+4])]),de=0;4>de;++de)a(D,re+32*de,ve,0,ve.length)}function Gi(D,re){var de=D[re-1],ve=D[re-1+32],Oe=D[re-1+64],$e=D[re-1+96];se(D,re+0,16843009*Os(D[re-1-32],de,ve)),se(D,re+32,16843009*Os(de,ve,Oe)),se(D,re+64,16843009*Os(ve,Oe,$e)),se(D,re+96,16843009*Os(Oe,$e,$e))}function Ki(D,re){var de,ve=4;for(de=0;4>de;++de)ve+=D[re+de-32]+D[re-1+32*de];for(ve>>=3,de=0;4>de;++de)n(D,re+32*de,ve,4)}function Ua(D,re){var de=D[re-1+0],ve=D[re-1+32],Oe=D[re-1+64],$e=D[re-1-32],ze=D[re+0-32],Xe=D[re+1-32],et=D[re+2-32],ot=D[re+3-32];D[re+0+96]=Os(ve,Oe,D[re-1+96]),D[re+1+96]=D[re+0+64]=Os(de,ve,Oe),D[re+2+96]=D[re+1+64]=D[re+0+32]=Os($e,de,ve),D[re+3+96]=D[re+2+64]=D[re+1+32]=D[re+0+0]=Os(ze,$e,de),D[re+3+64]=D[re+2+32]=D[re+1+0]=Os(Xe,ze,$e),D[re+3+32]=D[re+2+0]=Os(et,Xe,ze),D[re+3+0]=Os(ot,et,Xe)}function Jn(D,re){var de=D[re+1-32],ve=D[re+2-32],Oe=D[re+3-32],$e=D[re+4-32],ze=D[re+5-32],Xe=D[re+6-32],et=D[re+7-32];D[re+0+0]=Os(D[re+0-32],de,ve),D[re+1+0]=D[re+0+32]=Os(de,ve,Oe),D[re+2+0]=D[re+1+32]=D[re+0+64]=Os(ve,Oe,$e),D[re+3+0]=D[re+2+32]=D[re+1+64]=D[re+0+96]=Os(Oe,$e,ze),D[re+3+32]=D[re+2+64]=D[re+1+96]=Os($e,ze,Xe),D[re+3+64]=D[re+2+96]=Os(ze,Xe,et),D[re+3+96]=Os(Xe,et,et)}function Ao(D,re){var de=D[re-1+0],ve=D[re-1+32],Oe=D[re-1+64],$e=D[re-1-32],ze=D[re+0-32],Xe=D[re+1-32],et=D[re+2-32],ot=D[re+3-32];D[re+0+0]=D[re+1+64]=$e+ze+1>>1,D[re+1+0]=D[re+2+64]=ze+Xe+1>>1,D[re+2+0]=D[re+3+64]=Xe+et+1>>1,D[re+3+0]=et+ot+1>>1,D[re+0+96]=Os(Oe,ve,de),D[re+0+64]=Os(ve,de,$e),D[re+0+32]=D[re+1+96]=Os(de,$e,ze),D[re+1+32]=D[re+2+96]=Os($e,ze,Xe),D[re+2+32]=D[re+3+96]=Os(ze,Xe,et),D[re+3+32]=Os(Xe,et,ot)}function fo(D,re){var de=D[re+0-32],ve=D[re+1-32],Oe=D[re+2-32],$e=D[re+3-32],ze=D[re+4-32],Xe=D[re+5-32],et=D[re+6-32],ot=D[re+7-32];D[re+0+0]=de+ve+1>>1,D[re+1+0]=D[re+0+64]=ve+Oe+1>>1,D[re+2+0]=D[re+1+64]=Oe+$e+1>>1,D[re+3+0]=D[re+2+64]=$e+ze+1>>1,D[re+0+32]=Os(de,ve,Oe),D[re+1+32]=D[re+0+96]=Os(ve,Oe,$e),D[re+2+32]=D[re+1+96]=Os(Oe,$e,ze),D[re+3+32]=D[re+2+96]=Os($e,ze,Xe),D[re+3+64]=Os(ze,Xe,et),D[re+3+96]=Os(Xe,et,ot)}function tc(D,re){var de=D[re-1+0],ve=D[re-1+32],Oe=D[re-1+64],$e=D[re-1+96];D[re+0+0]=de+ve+1>>1,D[re+2+0]=D[re+0+32]=ve+Oe+1>>1,D[re+2+32]=D[re+0+64]=Oe+$e+1>>1,D[re+1+0]=Os(de,ve,Oe),D[re+3+0]=D[re+1+32]=Os(ve,Oe,$e),D[re+3+32]=D[re+1+64]=Os(Oe,$e,$e),D[re+3+64]=D[re+2+64]=D[re+0+96]=D[re+1+96]=D[re+2+96]=D[re+3+96]=$e}function sc(D,re){var de=D[re-1+0],ve=D[re-1+32],Oe=D[re-1+64],$e=D[re-1+96],ze=D[re-1-32],Xe=D[re+0-32],et=D[re+1-32],ot=D[re+2-32];D[re+0+0]=D[re+2+32]=de+ze+1>>1,D[re+0+32]=D[re+2+64]=ve+de+1>>1,D[re+0+64]=D[re+2+96]=Oe+ve+1>>1,D[re+0+96]=$e+Oe+1>>1,D[re+3+0]=Os(Xe,et,ot),D[re+2+0]=Os(ze,Xe,et),D[re+1+0]=D[re+3+32]=Os(de,ze,Xe),D[re+1+32]=D[re+3+64]=Os(ve,de,ze),D[re+1+64]=D[re+3+96]=Os(Oe,ve,de),D[re+1+96]=Os($e,Oe,ve)}function Pu(D,re){var de;for(de=0;8>de;++de)a(D,re+32*de,D,re-32,8)}function Ra(D,re){var de;for(de=0;8>de;++de)n(D,re,D[re-1],8),re+=32}function Dn(D,re,de){var ve;for(ve=0;8>ve;++ve)n(re,de+32*ve,D,8)}function gn(D,re){var de,ve=8;for(de=0;8>de;++de)ve+=D[re+de-32]+D[re-1+32*de];Dn(ve>>4,D,re)}function po(D,re){var de,ve=4;for(de=0;8>de;++de)ve+=D[re+de-32];Dn(ve>>3,D,re)}function Be(D,re){var de,ve=4;for(de=0;8>de;++de)ve+=D[re-1+32*de];Dn(ve>>3,D,re)}function lt(D,re){Dn(128,D,re)}function ut(D,re,de){var ve=D[re-de],Oe=D[re+0],$e=3*(Oe-ve)+Ml[1020+D[re-2*de]-D[re+de]],ze=Ud[112+($e+4>>3)];D[re-de]=On[255+ve+Ud[112+($e+3>>3)]],D[re+0]=On[255+Oe-ze]}function yt(D,re,de,ve){var Oe=D[re+0],$e=D[re+de];return Yi[255+D[re-2*de]-D[re-de]]>ve||Yi[255+$e-Oe]>ve}function It(D,re,de,ve){return 4*Yi[255+D[re-de]-D[re+0]]+Yi[255+D[re-2*de]-D[re+de]]<=ve}function Lt(D,re,de,ve,Oe){var $e=D[re-3*de],ze=D[re-2*de],Xe=D[re-de],et=D[re+0],ot=D[re+de],wt=D[re+2*de],Pt=D[re+3*de];return 4*Yi[255+Xe-et]+Yi[255+ze-ot]>ve?0:Yi[255+D[re-4*de]-$e]<=Oe&&Yi[255+$e-ze]<=Oe&&Yi[255+ze-Xe]<=Oe&&Yi[255+Pt-wt]<=Oe&&Yi[255+wt-ot]<=Oe&&Yi[255+ot-et]<=Oe}function qt(D,re,de,ve){var Oe=2*ve+1;for(ve=0;16>ve;++ve)It(D,re+ve,de,Oe)&&ut(D,re+ve,de)}function ss(D,re,de,ve){var Oe=2*ve+1;for(ve=0;16>ve;++ve)It(D,re+ve*de,1,Oe)&&ut(D,re+ve*de,1)}function $t(D,re,de,ve){var Oe;for(Oe=3;0<Oe;--Oe)qt(D,re+=4*de,de,ve)}function ms(D,re,de,ve){var Oe;for(Oe=3;0<Oe;--Oe)ss(D,re+=4,de,ve)}function Ns(D,re,de,ve,Oe,$e,ze,Xe){for($e=2*$e+1;0<Oe--;){if(Lt(D,re,de,$e,ze))if(yt(D,re,de,Xe))ut(D,re,de);else{var et=D,ot=re,wt=de,Pt=et[ot-2*wt],Ut=et[ot-wt],Ft=et[ot+0],as=et[ot+wt],Kt=et[ot+2*wt],kt=27*(Xt=Ml[1020+3*(Ft-Ut)+Ml[1020+Pt-as]])+63>>7,Et=18*Xt+63>>7,Xt=9*Xt+63>>7;et[ot-3*wt]=On[255+et[ot-3*wt]+Xt],et[ot-2*wt]=On[255+Pt+Et],et[ot-wt]=On[255+Ut+kt],et[ot+0]=On[255+Ft-kt],et[ot+wt]=On[255+as-Et],et[ot+2*wt]=On[255+Kt-Xt]}re+=ve}}function rs(D,re,de,ve,Oe,$e,ze,Xe){for($e=2*$e+1;0<Oe--;){if(Lt(D,re,de,$e,ze))if(yt(D,re,de,Xe))ut(D,re,de);else{var et=D,ot=re,wt=de,Pt=et[ot-wt],Ut=et[ot+0],Ft=et[ot+wt],as=Ud[112+((Kt=3*(Ut-Pt))+4>>3)],Kt=Ud[112+(Kt+3>>3)],kt=as+1>>1;et[ot-2*wt]=On[255+et[ot-2*wt]+kt],et[ot-wt]=On[255+Pt+Kt],et[ot+0]=On[255+Ut-as],et[ot+wt]=On[255+Ft-kt]}re+=ve}}function ns(D,re,de,ve,Oe,$e){Ns(D,re,de,1,16,ve,Oe,$e)}function os(D,re,de,ve,Oe,$e){Ns(D,re,1,de,16,ve,Oe,$e)}function fs(D,re,de,ve,Oe,$e){var ze;for(ze=3;0<ze;--ze)rs(D,re+=4*de,de,1,16,ve,Oe,$e)}function or(D,re,de,ve,Oe,$e){var ze;for(ze=3;0<ze;--ze)rs(D,re+=4,1,de,16,ve,Oe,$e)}function cn(D,re,de,ve,Oe,$e,ze,Xe){Ns(D,re,Oe,1,8,$e,ze,Xe),Ns(de,ve,Oe,1,8,$e,ze,Xe)}function aa(D,re,de,ve,Oe,$e,ze,Xe){Ns(D,re,1,Oe,8,$e,ze,Xe),Ns(de,ve,1,Oe,8,$e,ze,Xe)}function pr(D,re,de,ve,Oe,$e,ze,Xe){rs(D,re+4*Oe,Oe,1,8,$e,ze,Xe),rs(de,ve+4*Oe,Oe,1,8,$e,ze,Xe)}function na(D,re,de,ve,Oe,$e,ze,Xe){rs(D,re+4,1,Oe,8,$e,ze,Xe),rs(de,ve+4,1,Oe,8,$e,ze,Xe)}function tr(){this.ba=new dt,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new it,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function ba(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Zn(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Pl(){this.ua=0,this.Wa=new X,this.vb=new X,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new H,this.yc=new T}function rr(){this.xb=this.a=0,this.l=new Ja,this.ca=new dt,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new C,this.Pb=0,this.wd=new C,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Pl,this.ab=0,this.gc=l(4,Zn),this.Oc=0}function zr(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Ja,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function ei(D,re,de,ve,Oe,$e,ze){for(D=D==null?0:D[re+0],re=0;re<ze;++re)Oe[$e+re]=D+de[ve+re]&255,D=Oe[$e+re]}function Rc(D,re,de,ve,Oe,$e,ze){var Xe;if(D==null)ei(null,null,de,ve,Oe,$e,ze);else for(Xe=0;Xe<ze;++Xe)Oe[$e+Xe]=D[re+Xe]+de[ve+Xe]&255}function rc(D,re,de,ve,Oe,$e,ze){if(D==null)ei(null,null,de,ve,Oe,$e,ze);else{var Xe,et=D[re+0],ot=et,wt=et;for(Xe=0;Xe<ze;++Xe)ot=wt+(et=D[re+Xe])-ot,wt=de[ve+Xe]+(-256&ot?0>ot?0:255:ot)&255,ot=et,Oe[$e+Xe]=wt}}function Uu(D,re,de,ve){var Oe=re.width,$e=re.o;if(s(D!=null&&re!=null),0>de||0>=ve||de+ve>$e)return null;if(!D.Cc){if(D.ga==null){var ze;if(D.ga=new zr,(ze=D.ga==null)||(ze=re.width*re.o,s(D.Gb.length==0),D.Gb=i(ze),D.Uc=0,D.Gb==null?ze=0:(D.mb=D.Gb,D.nb=D.Uc,D.rc=null,ze=1),ze=!ze),!ze){ze=D.ga;var Xe=D.Fa,et=D.P,ot=D.qc,wt=D.mb,Pt=D.nb,Ut=et+1,Ft=ot-1,as=ze.l;if(s(Xe!=null&&wt!=null&&re!=null),jn[0]=null,jn[1]=ei,jn[2]=Rc,jn[3]=rc,ze.ca=wt,ze.tb=Pt,ze.c=re.width,ze.i=re.height,s(0<ze.c&&0<ze.i),1>=ot)re=0;else if(ze.$a=Xe[et+0]>>0&3,ze.Z=Xe[et+0]>>2&3,ze.Lc=Xe[et+0]>>4&3,et=Xe[et+0]>>6&3,0>ze.$a||1<ze.$a||4<=ze.Z||1<ze.Lc||et)re=0;else if(as.put=at,as.ac=Ge,as.bc=je,as.ma=ze,as.width=re.width,as.height=re.height,as.Da=re.Da,as.v=re.v,as.va=re.va,as.j=re.j,as.o=re.o,ze.$a)e:{s(ze.$a==1),re=St();t:for(;;){if(re==null){re=0;break e}if(s(ze!=null),ze.mc=re,re.c=ze.c,re.i=ze.i,re.l=ze.l,re.l.ma=ze,re.l.width=ze.c,re.l.height=ze.i,re.a=0,Q(re.m,Xe,Ut,Ft),!xt(ze.c,ze.i,1,re,null)||(re.ab==1&&re.gc[0].hc==3&&qe(re.s)?(ze.ic=1,Xe=re.c*re.i,re.Ta=null,re.Ua=0,re.V=i(Xe),re.Ba=0,re.V==null?(re.a=1,re=0):re=1):(ze.ic=0,re=Ct(re,ze.c)),!re))break t;re=1;break e}ze.mc=null,re=0}else re=Ft>=ze.c*ze.i;ze=!re}if(ze)return null;D.ga.Lc!=1?D.Ga=0:ve=$e-de}s(D.ga!=null),s(de+ve<=$e);e:{if(re=(Xe=D.ga).c,$e=Xe.l.o,Xe.$a==0){if(Ut=D.rc,Ft=D.Vc,as=D.Fa,et=D.P+1+de*re,ot=D.mb,wt=D.nb+de*re,s(et<=D.P+D.qc),Xe.Z!=0)for(s(jn[Xe.Z]!=null),ze=0;ze<ve;++ze)jn[Xe.Z](Ut,Ft,as,et,ot,wt,re),Ut=ot,Ft=wt,wt+=re,et+=re;else for(ze=0;ze<ve;++ze)a(ot,wt,as,et,re),Ut=ot,Ft=wt,wt+=re,et+=re;D.rc=Ut,D.Vc=Ft}else{if(s(Xe.mc!=null),re=de+ve,s((ze=Xe.mc)!=null),s(re<=ze.i),ze.C>=re)re=1;else if(Xe.ic||Dt(),Xe.ic){Xe=ze.V,Ut=ze.Ba,Ft=ze.c;var Kt=ze.i,kt=(as=1,et=ze.$/Ft,ot=ze.$%Ft,wt=ze.m,Pt=ze.s,ze.$),Et=Ft*Kt,Xt=Ft*re,Yt=Pt.wc,ts=kt<Xt?Mt(Pt,ot,et):null;s(kt<=Et),s(re<=Kt),s(qe(Pt));t:for(;;){for(;!wt.h&&kt<Xt;){if(ot&Yt||(ts=Mt(Pt,ot,et)),s(ts!=null),O(wt),256>(Kt=gt(ts.G[0],ts.H[0],wt)))Xe[Ut+kt]=Kt,++kt,++ot>=Ft&&(ot=0,++et<=re&&!(et%16)&&Me(ze,et));else{if(!(280>Kt)){as=0;break t}Kt=nt(Kt-256,wt);var _s,bs=gt(ts.G[4],ts.H[4],wt);if(O(wt),!(kt>=(bs=Ze(Ft,bs=nt(bs,wt)))&&Et-kt>=Kt)){as=0;break t}for(_s=0;_s<Kt;++_s)Xe[Ut+kt+_s]=Xe[Ut+kt+_s-bs];for(kt+=Kt,ot+=Kt;ot>=Ft;)ot-=Ft,++et<=re&&!(et%16)&&Me(ze,et);kt<Xt&&ot&Yt&&(ts=Mt(Pt,ot,et))}s(wt.h==B(wt))}Me(ze,et>re?re:et);break t}!as||wt.h&&kt<Et?(as=0,ze.a=wt.h?5:3):ze.$=kt,re=as}else re=Ve(ze,ze.V,ze.Ba,ze.c,ze.i,re,Tt);if(!re){ve=0;break e}}de+ve>=$e&&(D.Cc=1),ve=1}if(!ve)return null;if(D.Cc&&((ve=D.ga)!=null&&(ve.mc=null),D.ga=null,0<D.Ga))return alert("todo:WebPDequantizeLevels"),null}return D.nb+de*Oe}function ie(D,re,de,ve,Oe,$e){for(;0<Oe--;){var ze,Xe=D,et=re+(de?1:0),ot=D,wt=re+(de?0:3);for(ze=0;ze<ve;++ze){var Pt=ot[wt+4*ze];Pt!=255&&(Pt*=32897,Xe[et+4*ze+0]=Xe[et+4*ze+0]*Pt>>23,Xe[et+4*ze+1]=Xe[et+4*ze+1]*Pt>>23,Xe[et+4*ze+2]=Xe[et+4*ze+2]*Pt>>23)}re+=$e}}function Qe(D,re,de,ve,Oe){for(;0<ve--;){var $e;for($e=0;$e<de;++$e){var ze=D[re+2*$e+0],Xe=15&(ot=D[re+2*$e+1]),et=4369*Xe,ot=(240&ot|ot>>4)*et>>16;D[re+2*$e+0]=(240&ze|ze>>4)*et>>16&240|(15&ze|ze<<4)*et>>16>>4&15,D[re+2*$e+1]=240&ot|Xe}re+=Oe}}function At(D,re,de,ve,Oe,$e,ze,Xe){var et,ot,wt=255;for(ot=0;ot<Oe;++ot){for(et=0;et<ve;++et){var Pt=D[re+et];$e[ze+4*et]=Pt,wt&=Pt}re+=de,ze+=Xe}return wt!=255}function Nt(D,re,de,ve,Oe){var $e;for($e=0;$e<Oe;++$e)de[ve+$e]=D[re+$e]>>8}function Dt(){ti=ie,Qr=Qe,Lr=At,xa=Nt}function zt(D,re,de){E[D]=function(ve,Oe,$e,ze,Xe,et,ot,wt,Pt,Ut,Ft,as,Kt,kt,Et,Xt,Yt){var ts,_s=Yt-1>>1,bs=Xe[et+0]|ot[wt+0]<<16,Ms=Pt[Ut+0]|Ft[as+0]<<16;s(ve!=null);var ys=3*bs+Ms+131074>>2;for(re(ve[Oe+0],255&ys,ys>>16,Kt,kt),$e!=null&&(ys=3*Ms+bs+131074>>2,re($e[ze+0],255&ys,ys>>16,Et,Xt)),ts=1;ts<=_s;++ts){var jr=Xe[et+ts]|ot[wt+ts]<<16,Nr=Pt[Ut+ts]|Ft[as+ts]<<16,gr=bs+jr+Ms+Nr+524296,nr=gr+2*(jr+Ms)>>3;ys=nr+bs>>1,bs=(gr=gr+2*(bs+Nr)>>3)+jr>>1,re(ve[Oe+2*ts-1],255&ys,ys>>16,Kt,kt+(2*ts-1)*de),re(ve[Oe+2*ts-0],255&bs,bs>>16,Kt,kt+(2*ts-0)*de),$e!=null&&(ys=gr+Ms>>1,bs=nr+Nr>>1,re($e[ze+2*ts-1],255&ys,ys>>16,Et,Xt+(2*ts-1)*de),re($e[ze+2*ts+0],255&bs,bs>>16,Et,Xt+(2*ts+0)*de)),bs=jr,Ms=Nr}1&Yt||(ys=3*bs+Ms+131074>>2,re(ve[Oe+Yt-1],255&ys,ys>>16,Kt,kt+(Yt-1)*de),$e!=null&&(ys=3*Ms+bs+131074>>2,re($e[ze+Yt-1],255&ys,ys>>16,Et,Xt+(Yt-1)*de)))}}function cs(){ri[Hm]=Hg,ri[oc]=cc,ri[up]=qg,ri[Hu]=Qd,ri[qu]=Yc,ri[Hr]=Ku,ri[qm]=mA,ri[Rd]=cc,ri[Gc]=Qd,ri[$u]=Yc,ri[Vu]=Ku}function ws(D){return D&-16384?0>D?0:255:D>>dc}function Rs(D,re){return ws((19077*D>>8)+(26149*re>>8)-14234)}function sr(D,re,de){return ws((19077*D>>8)-(6419*re>>8)-(13320*de>>8)+8708)}function er(D,re){return ws((19077*D>>8)+(33050*re>>8)-17685)}function xr(D,re,de,ve,Oe){ve[Oe+0]=Rs(D,de),ve[Oe+1]=sr(D,re,de),ve[Oe+2]=er(D,re)}function ia(D,re,de,ve,Oe){ve[Oe+0]=er(D,re),ve[Oe+1]=sr(D,re,de),ve[Oe+2]=Rs(D,de)}function fa(D,re,de,ve,Oe){var $e=sr(D,re,de);re=$e<<3&224|er(D,re)>>3,ve[Oe+0]=248&Rs(D,de)|$e>>5,ve[Oe+1]=re}function Ca(D,re,de,ve,Oe){var $e=240&er(D,re)|15;ve[Oe+0]=240&Rs(D,de)|sr(D,re,de)>>4,ve[Oe+1]=$e}function vn(D,re,de,ve,Oe){ve[Oe+0]=255,xr(D,re,de,ve,Oe+1)}function tn(D,re,de,ve,Oe){ia(D,re,de,ve,Oe),ve[Oe+3]=255}function pl(D,re,de,ve,Oe){xr(D,re,de,ve,Oe),ve[Oe+3]=255}function Ei(D,re){return 0>D?0:D>re?re:D}function zi(D,re,de){E[D]=function(ve,Oe,$e,ze,Xe,et,ot,wt,Pt){for(var Ut=wt+(-2&Pt)*de;wt!=Ut;)re(ve[Oe+0],$e[ze+0],Xe[et+0],ot,wt),re(ve[Oe+1],$e[ze+0],Xe[et+0],ot,wt+de),Oe+=2,++ze,++et,wt+=2*de;1&Pt&&re(ve[Oe+0],$e[ze+0],Xe[et+0],ot,wt)}}function ac(D,re,de){return de==0?D==0?re==0?6:5:re==0?4:0:de}function Ru(D,re,de,ve,Oe){switch(D>>>30){case 3:bo(re,de,ve,Oe,0);break;case 2:wr(re,de,ve,Oe);break;case 1:yn(re,de,ve,Oe)}}function Sd(D,re){var de,ve,Oe=re.M,$e=re.Nb,ze=D.oc,Xe=D.pc+40,et=D.oc,ot=D.pc+584,wt=D.oc,Pt=D.pc+600;for(de=0;16>de;++de)ze[Xe+32*de-1]=129;for(de=0;8>de;++de)et[ot+32*de-1]=129,wt[Pt+32*de-1]=129;for(0<Oe?ze[Xe-1-32]=et[ot-1-32]=wt[Pt-1-32]=129:(n(ze,Xe-32-1,127,21),n(et,ot-32-1,127,9),n(wt,Pt-32-1,127,9)),ve=0;ve<D.za;++ve){var Ut=re.ya[re.aa+ve];if(0<ve){for(de=-1;16>de;++de)a(ze,Xe+32*de-4,ze,Xe+32*de+12,4);for(de=-1;8>de;++de)a(et,ot+32*de-4,et,ot+32*de+4,4),a(wt,Pt+32*de-4,wt,Pt+32*de+4,4)}var Ft=D.Gd,as=D.Hd+ve,Kt=Ut.ad,kt=Ut.Hc;if(0<Oe&&(a(ze,Xe-32,Ft[as].y,0,16),a(et,ot-32,Ft[as].f,0,8),a(wt,Pt-32,Ft[as].ea,0,8)),Ut.Za){var Et=ze,Xt=Xe-32+16;for(0<Oe&&(ve>=D.za-1?n(Et,Xt,Ft[as].y[15],4):a(Et,Xt,Ft[as+1].y,0,4)),de=0;4>de;de++)Et[Xt+128+de]=Et[Xt+256+de]=Et[Xt+384+de]=Et[Xt+0+de];for(de=0;16>de;++de,kt<<=2)Et=ze,Xt=Xe+hA[de],Xi[Ut.Ob[de]](Et,Xt),Ru(kt,Kt,16*+de,Et,Xt)}else if(Et=ac(ve,Oe,Ut.Ob[0]),Mn[Et](ze,Xe),kt!=0)for(de=0;16>de;++de,kt<<=2)Ru(kt,Kt,16*+de,ze,Xe+hA[de]);for(de=Ut.Gc,Et=ac(ve,Oe,Ut.Dd),si[Et](et,ot),si[Et](wt,Pt),kt=Kt,Et=et,Xt=ot,255&(Ut=de>>0)&&(170&Ut?yo(kt,256,Et,Xt):Bi(kt,256,Et,Xt)),Ut=wt,kt=Pt,255&(de>>=8)&&(170&de?yo(Kt,320,Ut,kt):Bi(Kt,320,Ut,kt)),Oe<D.Ub-1&&(a(Ft[as].y,0,ze,Xe+480,16),a(Ft[as].f,0,et,ot+224,8),a(Ft[as].ea,0,wt,Pt+224,8)),de=8*$e*D.B,Ft=D.sa,as=D.ta+16*ve+16*$e*D.R,Kt=D.qa,Ut=D.ra+8*ve+de,kt=D.Ha,Et=D.Ia+8*ve+de,de=0;16>de;++de)a(Ft,as+de*D.R,ze,Xe+32*de,16);for(de=0;8>de;++de)a(Kt,Ut+de*D.B,et,ot+32*de,8),a(kt,Et+de*D.B,wt,Pt+32*de,8)}}function Oc(D,re,de,ve,Oe,$e,ze,Xe,et){var ot=[0],wt=[0],Pt=0,Ut=et!=null?et.kd:0,Ft=et??new ba;if(D==null||12>de)return 7;Ft.data=D,Ft.w=re,Ft.ha=de,re=[re],de=[de],Ft.gb=[Ft.gb];e:{var as=re,Kt=de,kt=Ft.gb;if(s(D!=null),s(Kt!=null),s(kt!=null),kt[0]=0,12<=Kt[0]&&!r(D,as[0],"RIFF")){if(r(D,as[0]+8,"WEBP")){kt=3;break e}var Et=ue(D,as[0]+4);if(12>Et||4294967286<Et){kt=3;break e}if(Ut&&Et>Kt[0]-8){kt=7;break e}kt[0]=Et,as[0]+=12,Kt[0]-=12}kt=0}if(kt!=0)return kt;for(Et=0<Ft.gb[0],de=de[0];;){e:{var Xt=D;Kt=re,kt=de;var Yt=ot,ts=wt,_s=as=[0];if((ys=Pt=[Pt])[0]=0,8>kt[0])kt=7;else{if(!r(Xt,Kt[0],"VP8X")){if(ue(Xt,Kt[0]+4)!=10){kt=3;break e}if(18>kt[0]){kt=7;break e}var bs=ue(Xt,Kt[0]+8),Ms=1+ne(Xt,Kt[0]+12);if(2147483648<=Ms*(Xt=1+ne(Xt,Kt[0]+15))){kt=3;break e}_s!=null&&(_s[0]=bs),Yt!=null&&(Yt[0]=Ms),ts!=null&&(ts[0]=Xt),Kt[0]+=18,kt[0]-=18,ys[0]=1}kt=0}}if(Pt=Pt[0],as=as[0],kt!=0)return kt;if(Kt=!!(2&as),!Et&&Pt)return 3;if($e!=null&&($e[0]=!!(16&as)),ze!=null&&(ze[0]=Kt),Xe!=null&&(Xe[0]=0),ze=ot[0],as=wt[0],Pt&&Kt&&et==null){kt=0;break}if(4>de){kt=7;break}if(Et&&Pt||!Et&&!Pt&&!r(D,re[0],"ALPH")){de=[de],Ft.na=[Ft.na],Ft.P=[Ft.P],Ft.Sa=[Ft.Sa];e:{bs=D,kt=re,Et=de;var ys=Ft.gb;Yt=Ft.na,ts=Ft.P,_s=Ft.Sa,Ms=22,s(bs!=null),s(Et!=null),Xt=kt[0];var jr=Et[0];for(s(Yt!=null),s(_s!=null),Yt[0]=null,ts[0]=null,_s[0]=0;;){if(kt[0]=Xt,Et[0]=jr,8>jr){kt=7;break e}var Nr=ue(bs,Xt+4);if(4294967286<Nr){kt=3;break e}var gr=8+Nr+1&-2;if(Ms+=gr,0<ys&&Ms>ys){kt=3;break e}if(!r(bs,Xt,"VP8 ")||!r(bs,Xt,"VP8L")){kt=0;break e}if(jr[0]<gr){kt=7;break e}r(bs,Xt,"ALPH")||(Yt[0]=bs,ts[0]=Xt+8,_s[0]=Nr),Xt+=gr,jr-=gr}}if(de=de[0],Ft.na=Ft.na[0],Ft.P=Ft.P[0],Ft.Sa=Ft.Sa[0],kt!=0)break}de=[de],Ft.Ja=[Ft.Ja],Ft.xa=[Ft.xa];e:if(ys=D,kt=re,Et=de,Yt=Ft.gb[0],ts=Ft.Ja,_s=Ft.xa,bs=kt[0],Xt=!r(ys,bs,"VP8 "),Ms=!r(ys,bs,"VP8L"),s(ys!=null),s(Et!=null),s(ts!=null),s(_s!=null),8>Et[0])kt=7;else{if(Xt||Ms){if(ys=ue(ys,bs+4),12<=Yt&&ys>Yt-12){kt=3;break e}if(Ut&&ys>Et[0]-8){kt=7;break e}ts[0]=ys,kt[0]+=8,Et[0]-=8,_s[0]=Ms}else _s[0]=5<=Et[0]&&ys[bs+0]==47&&!(ys[bs+4]>>5),ts[0]=Et[0];kt=0}if(de=de[0],Ft.Ja=Ft.Ja[0],Ft.xa=Ft.xa[0],re=re[0],kt!=0)break;if(4294967286<Ft.Ja)return 3;if(Xe==null||Kt||(Xe[0]=Ft.xa?2:1),ze=[ze],as=[as],Ft.xa){if(5>de){kt=7;break}Xe=ze,Ut=as,Kt=$e,D==null||5>de?D=0:5<=de&&D[re+0]==47&&!(D[re+4]>>5)?(Et=[0],ys=[0],Yt=[0],Q(ts=new C,D,re,de),Se(ts,Et,ys,Yt)?(Xe!=null&&(Xe[0]=Et[0]),Ut!=null&&(Ut[0]=ys[0]),Kt!=null&&(Kt[0]=Yt[0]),D=1):D=0):D=0}else{if(10>de){kt=7;break}Xe=as,D==null||10>de||!fl(D,re+3,de-3)?D=0:(Ut=D[re+0]|D[re+1]<<8|D[re+2]<<16,Kt=16383&(D[re+7]<<8|D[re+6]),D=16383&(D[re+9]<<8|D[re+8]),1&Ut||3<(Ut>>1&7)||!(Ut>>4&1)||Ut>>5>=Ft.Ja||!Kt||!D?D=0:(ze&&(ze[0]=Kt),Xe&&(Xe[0]=D),D=1))}if(!D||(ze=ze[0],as=as[0],Pt&&(ot[0]!=ze||wt[0]!=as)))return 3;et!=null&&(et[0]=Ft,et.offset=re-et.w,s(4294967286>re-et.w),s(et.offset==et.ha-de));break}return kt==0||kt==7&&Pt&&et==null?($e!=null&&($e[0]|=Ft.na!=null&&0<Ft.na.length),ve!=null&&(ve[0]=ze),Oe!=null&&(Oe[0]=as),0):kt}function Cd(D,re,de){var ve=re.width,Oe=re.height,$e=0,ze=0,Xe=ve,et=Oe;if(re.Da=D!=null&&0<D.Da,re.Da&&(Xe=D.cd,et=D.bd,$e=D.v,ze=D.j,11>de||($e&=-2,ze&=-2),0>$e||0>ze||0>=Xe||0>=et||$e+Xe>ve||ze+et>Oe))return 0;if(re.v=$e,re.j=ze,re.va=$e+Xe,re.o=ze+et,re.U=Xe,re.T=et,re.da=D!=null&&0<D.da,re.da){if(!me(Xe,et,de=[D.ib],$e=[D.hb]))return 0;re.ib=de[0],re.hb=$e[0]}return re.ob=D!=null&&D.ob,re.Kb=D==null||!D.Sd,re.da&&(re.ob=re.ib<3*ve/4&&re.hb<3*Oe/4,re.Kb=0),1}function kd(D){if(D==null)return 2;if(11>D.S){var re=D.f.RGBA;re.fb+=(D.height-1)*re.A,re.A=-re.A}else re=D.f.kb,D=D.height,re.O+=(D-1)*re.fa,re.fa=-re.fa,re.N+=(D-1>>1)*re.Ab,re.Ab=-re.Ab,re.W+=(D-1>>1)*re.Db,re.Db=-re.Db,re.F!=null&&(re.J+=(D-1)*re.lb,re.lb=-re.lb);return 0}function Mc(D,re,de,ve){if(ve==null||0>=D||0>=re)return 2;if(de!=null){if(de.Da){var Oe=de.cd,$e=de.bd,ze=-2&de.v,Xe=-2&de.j;if(0>ze||0>Xe||0>=Oe||0>=$e||ze+Oe>D||Xe+$e>re)return 2;D=Oe,re=$e}if(de.da){if(!me(D,re,Oe=[de.ib],$e=[de.hb]))return 2;D=Oe[0],re=$e[0]}}ve.width=D,ve.height=re;e:{var et=ve.width,ot=ve.height;if(D=ve.S,0>=et||0>=ot||!(D>=Hm&&13>D))D=2;else{if(0>=ve.Rd&&ve.sd==null){ze=$e=Oe=re=0;var wt=(Xe=et*zu[D])*ot;if(11>D||($e=(ot+1)/2*(re=(et+1)/2),D==12&&(ze=(Oe=et)*ot)),(ot=i(wt+2*$e+ze))==null){D=1;break e}ve.sd=ot,11>D?((et=ve.f.RGBA).eb=ot,et.fb=0,et.A=Xe,et.size=wt):((et=ve.f.kb).y=ot,et.O=0,et.fa=Xe,et.Fd=wt,et.f=ot,et.N=0+wt,et.Ab=re,et.Cd=$e,et.ea=ot,et.W=0+wt+$e,et.Db=re,et.Ed=$e,D==12&&(et.F=ot,et.J=0+wt+2*$e),et.Tc=ze,et.lb=Oe)}if(re=1,Oe=ve.S,$e=ve.width,ze=ve.height,Oe>=Hm&&13>Oe)if(11>Oe)D=ve.f.RGBA,re&=(Xe=Math.abs(D.A))*(ze-1)+$e<=D.size,re&=Xe>=$e*zu[Oe],re&=D.eb!=null;else{D=ve.f.kb,Xe=($e+1)/2,wt=(ze+1)/2,et=Math.abs(D.fa),ot=Math.abs(D.Ab);var Pt=Math.abs(D.Db),Ut=Math.abs(D.lb),Ft=Ut*(ze-1)+$e;re&=et*(ze-1)+$e<=D.Fd,re&=ot*(wt-1)+Xe<=D.Cd,re=(re&=Pt*(wt-1)+Xe<=D.Ed)&et>=$e&ot>=Xe&Pt>=Xe,re&=D.y!=null,re&=D.f!=null,re&=D.ea!=null,Oe==12&&(re&=Ut>=$e,re&=Ft<=D.Tc,re&=D.F!=null)}else re=0;D=re?0:2}}return D!=0||de!=null&&de.fd&&(D=kd(ve)),D}var pa=64,Ed=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Bd=24,Fd=32,Td=8,Pn=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];_e("Predictor0","PredictorAdd0"),E.Predictor0=function(){return 4278190080},E.Predictor1=function(D){return D},E.Predictor2=function(D,re,de){return re[de+0]},E.Predictor3=function(D,re,de){return re[de+1]},E.Predictor4=function(D,re,de){return re[de-1]},E.Predictor5=function(D,re,de){return Le(Le(D,re[de+1]),re[de+0])},E.Predictor6=function(D,re,de){return Le(D,re[de-1])},E.Predictor7=function(D,re,de){return Le(D,re[de+0])},E.Predictor8=function(D,re,de){return Le(re[de-1],re[de+0])},E.Predictor9=function(D,re,de){return Le(re[de+0],re[de+1])},E.Predictor10=function(D,re,de){return Le(Le(D,re[de-1]),Le(re[de+0],re[de+1]))},E.Predictor11=function(D,re,de){var ve=re[de+0];return 0>=st(ve>>24&255,D>>24&255,(re=re[de-1])>>24&255)+st(ve>>16&255,D>>16&255,re>>16&255)+st(ve>>8&255,D>>8&255,re>>8&255)+st(255&ve,255&D,255&re)?ve:D},E.Predictor12=function(D,re,de){var ve=re[de+0];return(rt((D>>24&255)+(ve>>24&255)-((re=re[de-1])>>24&255))<<24|rt((D>>16&255)+(ve>>16&255)-(re>>16&255))<<16|rt((D>>8&255)+(ve>>8&255)-(re>>8&255))<<8|rt((255&D)+(255&ve)-(255&re)))>>>0},E.Predictor13=function(D,re,de){var ve=re[de-1];return(He((D=Le(D,re[de+0]))>>24&255,ve>>24&255)<<24|He(D>>16&255,ve>>16&255)<<16|He(D>>8&255,ve>>8&255)<<8|He(D>>0&255,ve>>0&255))>>>0};var Qc=E.PredictorAdd0;E.PredictorAdd1=De,_e("Predictor2","PredictorAdd2"),_e("Predictor3","PredictorAdd3"),_e("Predictor4","PredictorAdd4"),_e("Predictor5","PredictorAdd5"),_e("Predictor6","PredictorAdd6"),_e("Predictor7","PredictorAdd7"),_e("Predictor8","PredictorAdd8"),_e("Predictor9","PredictorAdd9"),_e("Predictor10","PredictorAdd10"),_e("Predictor11","PredictorAdd11"),_e("Predictor12","PredictorAdd12"),_e("Predictor13","PredictorAdd13");var xo=E.PredictorAdd2;fe("ColorIndexInverseTransform","MapARGB","32b",(function(D){return D>>8&255}),(function(D){return D})),fe("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",(function(D){return D}),(function(D){return D>>8&255}));var Qm,Un=E.ColorIndexInverseTransform,Id=E.MapARGB,Ou=E.VP8LColorIndexInverseTransformAlpha,Ld=E.MapAlpha,Ul=E.VP8LPredictorsAdd=[];Ul.length=16,(E.VP8LPredictors=[]).length=16,(E.VP8LPredictorsAdd_C=[]).length=16,(E.VP8LPredictors_C=[]).length=16;var nc,Rn,bn,ic,go,vo,Dd,bo,wr,yo,yn,Bi,Hc,Mu,qc,$c,Vc,Fi,jo,Rl,No,wo,lc,dn,ti,Qr,Lr,xa,ka=i(511),Ol=i(2041),Pd=i(225),Wc=i(767),Qu=0,Ml=Ol,Ud=Pd,On=Wc,Yi=ka,Hm=0,oc=1,up=2,Hu=3,qu=4,Hr=5,qm=6,Rd=7,Gc=8,$u=9,Vu=10,Wu=[2,3,7],$m=[3,3,11],Kc=[280,256,256,256,40],mp=[0,1,1,1,0],Rg=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Og=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],hp=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Vm=8,Od=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Gu=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],zc=null,cA=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],dA=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Ap=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],fp=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Mg=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Qg=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],uA=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Mn=[],Xi=[],si=[],Ql=1,Md=2,jn=[],ri=[];zt("UpsampleRgbLinePair",xr,3),zt("UpsampleBgrLinePair",ia,3),zt("UpsampleRgbaLinePair",pl,4),zt("UpsampleBgraLinePair",tn,4),zt("UpsampleArgbLinePair",vn,4),zt("UpsampleRgba4444LinePair",Ca,2),zt("UpsampleRgb565LinePair",fa,2);var Hg=E.UpsampleRgbLinePair,qg=E.UpsampleBgrLinePair,cc=E.UpsampleRgbaLinePair,Qd=E.UpsampleBgraLinePair,Yc=E.UpsampleArgbLinePair,Ku=E.UpsampleRgba4444LinePair,mA=E.UpsampleRgb565LinePair,_o=16,xl=1<<_o-1,Dr=-227,Rr=482,dc=6,un=0,ai=i(256),Xc=i(256),Hd=i(256),ni=i(256),Wm=i(Rr-Dr),pp=i(Rr-Dr);zi("YuvToRgbRow",xr,3),zi("YuvToBgrRow",ia,3),zi("YuvToRgbaRow",pl,4),zi("YuvToBgraRow",tn,4),zi("YuvToArgbRow",vn,4),zi("YuvToRgba4444Row",Ca,2),zi("YuvToRgb565Row",fa,2);var hA=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Jc=[0,2,8],xp=[8,7,6,4,4,2,2,2,1,1,1,1],So=1;this.WebPDecodeRGBA=function(D,re,de,ve,Oe){var $e=oc,ze=new tr,Xe=new dt;ze.ba=Xe,Xe.S=$e,Xe.width=[Xe.width],Xe.height=[Xe.height];var et=Xe.width,ot=Xe.height,wt=new mt;if(wt==null||D==null)var Pt=2;else s(wt!=null),Pt=Oc(D,re,de,wt.width,wt.height,wt.Pd,wt.Qd,wt.format,null);if(Pt!=0?et=0:(et!=null&&(et[0]=wt.width[0]),ot!=null&&(ot[0]=wt.height[0]),et=1),et){Xe.width=Xe.width[0],Xe.height=Xe.height[0],ve!=null&&(ve[0]=Xe.width),Oe!=null&&(Oe[0]=Xe.height);e:{if(ve=new Ja,(Oe=new ba).data=D,Oe.w=re,Oe.ha=de,Oe.kd=1,re=[0],s(Oe!=null),((D=Oc(Oe.data,Oe.w,Oe.ha,null,null,null,re,null,Oe))==0||D==7)&&re[0]&&(D=4),(re=D)==0){if(s(ze!=null),ve.data=Oe.data,ve.w=Oe.w+Oe.offset,ve.ha=Oe.ha-Oe.offset,ve.put=at,ve.ac=Ge,ve.bc=je,ve.ma=ze,Oe.xa){if((D=St())==null){ze=1;break e}if((function(Ut,Ft){var as=[0],Kt=[0],kt=[0];t:for(;;){if(Ut==null)return 0;if(Ft==null)return Ut.a=2,0;if(Ut.l=Ft,Ut.a=0,Q(Ut.m,Ft.data,Ft.w,Ft.ha),!Se(Ut.m,as,Kt,kt)){Ut.a=3;break t}if(Ut.xb=Md,Ft.width=as[0],Ft.height=Kt[0],!xt(as[0],Kt[0],1,Ut,null))break t;return 1}return s(Ut.a!=0),0})(D,ve)){if(ve=(re=Mc(ve.width,ve.height,ze.Oa,ze.ba))==0){t:{ve=D;s:for(;;){if(ve==null){ve=0;break t}if(s(ve.s.yc!=null),s(ve.s.Ya!=null),s(0<ve.s.Wb),s((de=ve.l)!=null),s((Oe=de.ma)!=null),ve.xb!=0){if(ve.ca=Oe.ba,ve.tb=Oe.tb,s(ve.ca!=null),!Cd(Oe.Oa,de,Hu)){ve.a=2;break s}if(!Ct(ve,de.width)||de.da)break s;if((de.da||Ae(ve.ca.S))&&Dt(),11>ve.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),ve.ca.f.kb.F!=null&&Dt()),ve.Pb&&0<ve.s.ua&&ve.s.vb.X==null&&!oe(ve.s.vb,ve.s.Wa.Xa)){ve.a=1;break s}ve.xb=0}if(!Ve(ve,ve.V,ve.Ba,ve.c,ve.i,de.o,ke))break s;Oe.Dc=ve.Ma,ve=1;break t}s(ve.a!=0),ve=0}ve=!ve}ve&&(re=D.a)}else re=D.a}else{if((D=new Tr)==null){ze=1;break e}if(D.Fa=Oe.na,D.P=Oe.P,D.qc=Oe.Sa,Za(D,ve)){if((re=Mc(ve.width,ve.height,ze.Oa,ze.ba))==0){if(D.Aa=0,de=ze.Oa,s((Oe=D)!=null),de!=null){if(0<(et=0>(et=de.Md)?0:100<et?255:255*et/100)){for(ot=wt=0;4>ot;++ot)12>(Pt=Oe.pb[ot]).lc&&(Pt.ia=et*xp[0>Pt.lc?0:Pt.lc]>>3),wt|=Pt.ia;wt&&(alert("todo:VP8InitRandom"),Oe.ia=1)}Oe.Ga=de.Id,100<Oe.Ga?Oe.Ga=100:0>Oe.Ga&&(Oe.Ga=0)}Vi(D,ve)||(re=D.a)}}else re=D.a}re==0&&ze.Oa!=null&&ze.Oa.fd&&(re=kd(ze.ba))}ze=re}$e=ze!=0?null:11>$e?Xe.f.RGBA.eb:Xe.f.kb.y}else $e=null;return $e};var zu=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function u(E,W){for(var R="",U=0;U<4;U++)R+=String.fromCharCode(E[W++]);return R}function c(E,W){return(E[W+0]<<0|E[W+1]<<8|E[W+2]<<16)>>>0}function h(E,W){return(E[W+0]<<0|E[W+1]<<8|E[W+2]<<16|E[W+3]<<24)>>>0}new d;var m=[0],p=[0],g=[],x=new d,b=t,y=(function(E,W){var R={},U=0,T=!1,Y=0,H=0;if(R.frames=[],!(function(k,B,G,O){for(var K=0;K<O;K++)if(k[B+K]!=G.charCodeAt(K))return!0;return!1})(E,W,"RIFF",4)){var M,q;for(h(E,W+=4),W+=8;W<E.length;){var z=u(E,W),Q=h(E,W+=4);W+=4;var L=Q+(1&Q);switch(z){case"VP8 ":case"VP8L":R.frames[U]===void 0&&(R.frames[U]={}),(C=R.frames[U]).src_off=T?H:W-8,C.src_size=Y+Q+8,U++,T&&(T=!1,Y=0,H=0);break;case"VP8X":(C=R.header={}).feature_flags=E[W];var V=W+4;C.canvas_width=1+c(E,V),V+=3,C.canvas_height=1+c(E,V),V+=3;break;case"ALPH":T=!0,Y=L+8,H=W-8;break;case"ANIM":(C=R.header).bgcolor=h(E,W),V=W+4,C.loop_count=(M=E)[(q=V)+0]<<0|M[q+1]<<8,V+=2;break;case"ANMF":var P,C;(C=R.frames[U]={}).offset_x=2*c(E,W),W+=3,C.offset_y=2*c(E,W),W+=3,C.width=1+c(E,W),W+=3,C.height=1+c(E,W),W+=3,C.duration=c(E,W),W+=3,P=E[W++],C.dispose=1&P,C.blend=P>>1&1}z!="ANMF"&&(W+=L)}return R}})(b,0);y.response=b,y.rgbaoutput=!0,y.dataurl=!1;var j=y.header?y.header:null,N=y.frames?y.frames:null;if(j){j.loop_counter=j.loop_count,m=[j.canvas_height],p=[j.canvas_width];for(var _=0;_<N.length&&N[_].blend!=0;_++);}var F=N[0],I=x.WebPDecodeRGBA(b,F.src_off,F.src_size,p,m);F.rgba=I,F.imgwidth=p[0],F.imgheight=m[0];for(var w=0;w<p[0]*m[0]*4;w++)g[w]=I[w];return this.width=p,this.height=m,this.data=g,this}(function(t){var s=function(){return typeof Ly=="function"},r=function(m,p,g,x){var b=4,y=l;switch(x){case t.image_compression.FAST:b=1,y=i;break;case t.image_compression.MEDIUM:b=6,y=o;break;case t.image_compression.SLOW:b=9,y=d}m=a(m,p,g,y);var j=Ly(m,{level:b});return t.__addimage__.arrayBufferToBinaryString(j)},a=function(m,p,g,x){for(var b,y,j,N=m.length/p,_=new Uint8Array(m.length+N),F=c(),I=0;I<N;I+=1){if(j=I*p,b=m.subarray(j,j+p),x)_.set(x(b,g,y),j+I);else{for(var w,E=F.length,W=[];w<E;w+=1)W[w]=F[w](b,g,y);var R=h(W.concat());_.set(W[R],j+I)}y=b}return _},n=function(m){var p=Array.apply([],m);return p.unshift(0),p},i=function(m,p){var g,x=[],b=m.length;x[0]=1;for(var y=0;y<b;y+=1)g=m[y-p]||0,x[y+1]=m[y]-g+256&255;return x},l=function(m,p,g){var x,b=[],y=m.length;b[0]=2;for(var j=0;j<y;j+=1)x=g&&g[j]||0,b[j+1]=m[j]-x+256&255;return b},o=function(m,p,g){var x,b,y=[],j=m.length;y[0]=3;for(var N=0;N<j;N+=1)x=m[N-p]||0,b=g&&g[N]||0,y[N+1]=m[N]+256-(x+b>>>1)&255;return y},d=function(m,p,g){var x,b,y,j,N=[],_=m.length;N[0]=4;for(var F=0;F<_;F+=1)x=m[F-p]||0,b=g&&g[F]||0,y=g&&g[F-p]||0,j=u(x,b,y),N[F+1]=m[F]-j+256&255;return N},u=function(m,p,g){if(m===p&&p===g)return m;var x=Math.abs(p-g),b=Math.abs(m-g),y=Math.abs(m+p-g-g);return x<=b&&x<=y?m:b<=y?p:g},c=function(){return[n,i,l,o,d]},h=function(m){var p=m.map((function(g){return g.reduce((function(x,b){return x+Math.abs(b)}),0)}));return p.indexOf(Math.min.apply(null,p))};t.processPNG=function(m,p,g,x){var b,y,j,N,_,F,I,w,E,W,R,U,T,Y,H,M=this.decode.FLATE_DECODE,q="";if(this.__addimage__.isArrayBuffer(m)&&(m=new Uint8Array(m)),this.__addimage__.isArrayBufferView(m)){if(m=(j=new qR(m)).imgData,y=j.bits,b=j.colorSpace,_=j.colors,[4,6].indexOf(j.colorType)!==-1){if(j.bits===8){E=(w=j.pixelBitlength==32?new Uint32Array(j.decodePixels().buffer):j.pixelBitlength==16?new Uint16Array(j.decodePixels().buffer):new Uint8Array(j.decodePixels().buffer)).length,R=new Uint8Array(E*j.colors),W=new Uint8Array(E);var z,Q=j.pixelBitlength-j.bits;for(Y=0,H=0;Y<E;Y++){for(T=w[Y],z=0;z<Q;)R[H++]=T>>>z&255,z+=j.bits;W[Y]=T>>>z&255}}if(j.bits===16){E=(w=new Uint32Array(j.decodePixels().buffer)).length,R=new Uint8Array(E*(32/j.pixelBitlength)*j.colors),W=new Uint8Array(E*(32/j.pixelBitlength)),U=j.colors>1,Y=0,H=0;for(var L=0;Y<E;)T=w[Y++],R[H++]=T>>>0&255,U&&(R[H++]=T>>>16&255,T=w[Y++],R[H++]=T>>>0&255),W[L++]=T>>>16&255;y=8}x!==t.image_compression.NONE&&s()?(m=r(R,j.width*j.colors,j.colors,x),I=r(W,j.width,1,x)):(m=R,I=W,M=void 0)}if(j.colorType===3&&(b=this.color_spaces.INDEXED,F=j.palette,j.transparency.indexed)){var V=j.transparency.indexed,P=0;for(Y=0,E=V.length;Y<E;++Y)P+=V[Y];if((P/=255)===E-1&&V.indexOf(0)!==-1)N=[V.indexOf(0)];else if(P!==E){for(w=j.decodePixels(),W=new Uint8Array(w.length),Y=0,E=w.length;Y<E;Y++)W[Y]=V[w[Y]];I=r(W,j.width,1)}}var C=(function(k){var B;switch(k){case t.image_compression.FAST:B=11;break;case t.image_compression.MEDIUM:B=13;break;case t.image_compression.SLOW:B=14;break;default:B=12}return B})(x);return M===this.decode.FLATE_DECODE&&(q="/Predictor "+C+" "),q+="/Colors "+_+" /BitsPerComponent "+y+" /Columns "+j.width,(this.__addimage__.isArrayBuffer(m)||this.__addimage__.isArrayBufferView(m))&&(m=this.__addimage__.arrayBufferToBinaryString(m)),(I&&this.__addimage__.isArrayBuffer(I)||this.__addimage__.isArrayBufferView(I))&&(I=this.__addimage__.arrayBufferToBinaryString(I)),{alias:g,data:m,index:p,filter:M,decodeParameters:q,transparency:N,palette:F,sMask:I,predictor:C,width:j.width,height:j.height,bitsPerComponent:y,colorSpace:b}}}})(hs.API),(function(t){t.processGIF89A=function(s,r,a,n){var i=new $R(s),l=i.width,o=i.height,d=[];i.decodeAndBlitFrameRGBA(0,d);var u={data:d,width:l,height:o},c=new cb(100).encode(u,100);return t.processJPEG.call(this,c,r,a,n)},t.processGIF87A=t.processGIF89A})(hs.API),Uo.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var t=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(t);for(var s=0;s<t;s++){var r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0);this.palette[s]={red:n,green:a,blue:r,quad:i}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Uo.prototype.parseBGR=function(){this.pos=this.offset;try{var t="bit"+this.bitPP,s=this.width*this.height*4;this.data=new Uint8Array(s),this[t]()}catch(r){ea.log("bit decode error:"+r)}},Uo.prototype.bit1=function(){var t,s=Math.ceil(this.width/8),r=s%4;for(t=this.height-1;t>=0;t--){for(var a=this.bottom_up?t:this.height-1-t,n=0;n<s;n++)for(var i=this.datav.getUint8(this.pos++,!0),l=a*this.width*4+8*n*4,o=0;o<8&&8*n+o<this.width;o++){var d=this.palette[i>>7-o&1];this.data[l+4*o]=d.blue,this.data[l+4*o+1]=d.green,this.data[l+4*o+2]=d.red,this.data[l+4*o+3]=255}r!==0&&(this.pos+=4-r)}},Uo.prototype.bit4=function(){for(var t=Math.ceil(this.width/2),s=t%4,r=this.height-1;r>=0;r--){for(var a=this.bottom_up?r:this.height-1-r,n=0;n<t;n++){var i=this.datav.getUint8(this.pos++,!0),l=a*this.width*4+2*n*4,o=i>>4,d=15&i,u=this.palette[o];if(this.data[l]=u.blue,this.data[l+1]=u.green,this.data[l+2]=u.red,this.data[l+3]=255,2*n+1>=this.width)break;u=this.palette[d],this.data[l+4]=u.blue,this.data[l+4+1]=u.green,this.data[l+4+2]=u.red,this.data[l+4+3]=255}s!==0&&(this.pos+=4-s)}},Uo.prototype.bit8=function(){for(var t=this.width%4,s=this.height-1;s>=0;s--){for(var r=this.bottom_up?s:this.height-1-s,a=0;a<this.width;a++){var n=this.datav.getUint8(this.pos++,!0),i=r*this.width*4+4*a;if(n<this.palette.length){var l=this.palette[n];this.data[i]=l.red,this.data[i+1]=l.green,this.data[i+2]=l.blue,this.data[i+3]=255}else this.data[i]=255,this.data[i+1]=255,this.data[i+2]=255,this.data[i+3]=255}t!==0&&(this.pos+=4-t)}},Uo.prototype.bit15=function(){for(var t=this.width%3,s=parseInt("11111",2),r=this.height-1;r>=0;r--){for(var a=this.bottom_up?r:this.height-1-r,n=0;n<this.width;n++){var i=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(i&s)/s*255|0,o=(i>>5&s)/s*255|0,d=(i>>10&s)/s*255|0,u=i>>15?255:0,c=a*this.width*4+4*n;this.data[c]=d,this.data[c+1]=o,this.data[c+2]=l,this.data[c+3]=u}this.pos+=t}},Uo.prototype.bit16=function(){for(var t=this.width%3,s=parseInt("11111",2),r=parseInt("111111",2),a=this.height-1;a>=0;a--){for(var n=this.bottom_up?a:this.height-1-a,i=0;i<this.width;i++){var l=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(l&s)/s*255|0,d=(l>>5&r)/r*255|0,u=(l>>11)/s*255|0,c=n*this.width*4+4*i;this.data[c]=u,this.data[c+1]=d,this.data[c+2]=o,this.data[c+3]=255}this.pos+=t}},Uo.prototype.bit24=function(){for(var t=this.height-1;t>=0;t--){for(var s=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var a=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),l=s*this.width*4+4*r;this.data[l]=i,this.data[l+1]=n,this.data[l+2]=a,this.data[l+3]=255}this.pos+=this.width%4}},Uo.prototype.bit32=function(){for(var t=this.height-1;t>=0;t--)for(var s=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var a=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),l=this.datav.getUint8(this.pos++,!0),o=s*this.width*4+4*r;this.data[o]=i,this.data[o+1]=n,this.data[o+2]=a,this.data[o+3]=l}},Uo.prototype.getData=function(){return this.data},(function(t){t.processBMP=function(s,r,a,n){var i=new Uo(s,!1),l=i.width,o=i.height,d={data:i.getData(),width:l,height:o},u=new cb(100).encode(d,100);return t.processJPEG.call(this,u,r,a,n)}})(hs.API),$_.prototype.getData=function(){return this.data},(function(t){t.processWEBP=function(s,r,a,n){var i=new $_(s),l=i.width,o=i.height,d={data:i.getData(),width:l,height:o},u=new cb(100).encode(d,100);return t.processJPEG.call(this,u,r,a,n)}})(hs.API),hs.API.processRGBA=function(t,s,r){for(var a=t.data,n=a.length,i=new Uint8Array(n/4*3),l=new Uint8Array(n/4),o=0,d=0,u=0;u<n;u+=4){var c=a[u],h=a[u+1],m=a[u+2],p=a[u+3];i[o++]=c,i[o++]=h,i[o++]=m,l[d++]=p}var g=this.__addimage__.arrayBufferToBinaryString(i);return{alpha:this.__addimage__.arrayBufferToBinaryString(l),data:g,index:s,alias:r,colorSpace:"DeviceRGB",bitsPerComponent:8,width:t.width,height:t.height}},hs.API.setLanguage=function(t){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[t]!==void 0&&(this.internal.languageSettings.languageCode=t,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",(function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")})),this.internal.languageSettings.isSubscribed=!0)),this},mh=hs.API,ax=mh.getCharWidthsArray=function(t,s){var r,a,n=(s=s||{}).font||this.internal.getFont(),i=s.fontSize||this.internal.getFontSize(),l=s.charSpace||this.internal.getCharSpace(),o=s.widths?s.widths:n.metadata.Unicode.widths,d=o.fof?o.fof:1,u=s.kerning?s.kerning:n.metadata.Unicode.kerning,c=u.fof?u.fof:1,h=s.doKerning!==!1,m=0,p=t.length,g=0,x=o[0]||d,b=[];for(r=0;r<p;r++)a=t.charCodeAt(r),typeof n.metadata.widthOfString=="function"?b.push((n.metadata.widthOfGlyph(n.metadata.characterToGlyph(a))+l*(1e3/i)||0)/1e3):(m=h&&Wr(u[a])==="object"&&!isNaN(parseInt(u[a][g],10))?u[a][g]/c:0,b.push((o[a]||x)/d+m)),g=a;return b},M_=mh.getStringUnitWidth=function(t,s){var r=(s=s||{}).fontSize||this.internal.getFontSize(),a=s.font||this.internal.getFont(),n=s.charSpace||this.internal.getCharSpace();return mh.processArabic&&(t=mh.processArabic(t)),typeof a.metadata.widthOfString=="function"?a.metadata.widthOfString(t,r,n)/r:ax.apply(this,arguments).reduce((function(i,l){return i+l}),0)},Q_=function(t,s,r,a){for(var n=[],i=0,l=t.length,o=0;i!==l&&o+s[i]<r;)o+=s[i],i++;n.push(t.slice(0,i));var d=i;for(o=0;i!==l;)o+s[i]>a&&(n.push(t.slice(d,i)),o=0,d=i),o+=s[i],i++;return d!==i&&n.push(t.slice(d,i)),n},H_=function(t,s,r){r||(r={});var a,n,i,l,o,d,u,c=[],h=[c],m=r.textIndent||0,p=0,g=0,x=t.split(" "),b=ax.apply(this,[" ",r])[0];if(d=r.lineIndent===-1?x[0].length+2:r.lineIndent||0){var y=Array(d).join(" "),j=[];x.map((function(_){(_=_.split(/\s*\n/)).length>1?j=j.concat(_.map((function(F,I){return(I&&F.length?`
`:"")+F}))):j.push(_[0])})),x=j,d=M_.apply(this,[y,r])}for(i=0,l=x.length;i<l;i++){var N=0;if(a=x[i],d&&a[0]==`
`&&(a=a.substr(1),N=1),m+p+(g=(n=ax.apply(this,[a,r])).reduce((function(_,F){return _+F}),0))>s||N){if(g>s){for(o=Q_.apply(this,[a,n,s-(m+p),s]),c.push(o.shift()),c=[o.pop()];o.length;)h.push([o.shift()]);g=n.slice(a.length-(c[0]?c[0].length:0)).reduce((function(_,F){return _+F}),0)}else c=[a];h.push(c),m=g+d,p=b}else c.push(a),m+=p+g,p=b}return u=d?function(_,F){return(F?y:"")+_.join(" ")}:function(_){return _.join(" ")},h.map(u)},mh.splitTextToSize=function(t,s,r){var a,n=(r=r||{}).fontSize||this.internal.getFontSize(),i=(function(c){if(c.widths&&c.kerning)return{widths:c.widths,kerning:c.kerning};var h=this.internal.getFont(c.fontName,c.fontStyle);return h.metadata.Unicode?{widths:h.metadata.Unicode.widths||{0:1},kerning:h.metadata.Unicode.kerning||{}}:{font:h.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,r);a=Array.isArray(t)?t:String(t).split(/\r?\n/);var l=1*this.internal.scaleFactor*s/n;i.textIndent=r.textIndent?1*r.textIndent*this.internal.scaleFactor/n:0,i.lineIndent=r.lineIndent;var o,d,u=[];for(o=0,d=a.length;o<d;o++)u=u.concat(H_.apply(this,[a[o],l,i]));return u},(function(t){t.__fontmetrics__=t.__fontmetrics__||{};for(var s="klmnopqrstuvwxyz",r={},a={},n=0;n<s.length;n++)r[s[n]]="0123456789abcdef"[n],a["0123456789abcdef"[n]]=s[n];var i=function(h){return"0x"+parseInt(h,10).toString(16)},l=t.__fontmetrics__.compress=function(h){var m,p,g,x,b=["{"];for(var y in h){if(m=h[y],isNaN(parseInt(y,10))?p="'"+y+"'":(y=parseInt(y,10),p=(p=i(y).slice(2)).slice(0,-1)+a[p.slice(-1)]),typeof m=="number")m<0?(g=i(m).slice(3),x="-"):(g=i(m).slice(2),x=""),g=x+g.slice(0,-1)+a[g.slice(-1)];else{if(Wr(m)!=="object")throw new Error("Don't know what to do with value type "+Wr(m)+".");g=l(m)}b.push(p+g)}return b.push("}"),b.join("")},o=t.__fontmetrics__.uncompress=function(h){if(typeof h!="string")throw new Error("Invalid argument passed to uncompress.");for(var m,p,g,x,b={},y=1,j=b,N=[],_="",F="",I=h.length-1,w=1;w<I;w+=1)(x=h[w])=="'"?m?(g=m.join(""),m=void 0):m=[]:m?m.push(x):x=="{"?(N.push([j,g]),j={},g=void 0):x=="}"?((p=N.pop())[0][p[1]]=j,g=void 0,j=p[0]):x=="-"?y=-1:g===void 0?r.hasOwnProperty(x)?(_+=r[x],g=parseInt(_,16)*y,y=1,_=""):_+=x:r.hasOwnProperty(x)?(F+=r[x],j[g]=parseInt(F,16)*y,y=1,g=void 0,F=""):F+=x;return b},d={codePages:["WinAnsiEncoding"],WinAnsiEncoding:o("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},u={Unicode:{Courier:d,"Courier-Bold":d,"Courier-BoldOblique":d,"Courier-Oblique":d,Helvetica:d,"Helvetica-Bold":d,"Helvetica-BoldOblique":d,"Helvetica-Oblique":d,"Times-Roman":d,"Times-Bold":d,"Times-BoldItalic":d,"Times-Italic":d}},c={Unicode:{"Courier-Oblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":o("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":o("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:o("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:o("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":o("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":o("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};t.events.push(["addFont",function(h){var m=h.font,p=c.Unicode[m.postScriptName];p&&(m.metadata.Unicode={},m.metadata.Unicode.widths=p.widths,m.metadata.Unicode.kerning=p.kerning);var g=u.Unicode[m.postScriptName];g&&(m.metadata.Unicode.encoding=g,m.encoding=g.codePages[0])}])})(hs.API),(function(t){var s=function(r){for(var a=r.length,n=new Uint8Array(a),i=0;i<a;i++)n[i]=r.charCodeAt(i);return n};t.API.events.push(["addFont",function(r){var a=void 0,n=r.font,i=r.instance;if(!n.isStandardFont){if(i===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");if(typeof(a=i.existsFileInVFS(n.postScriptName)===!1?i.loadFile(n.postScriptName):i.getFileFromVFS(n.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");(function(l,o){o=/^\x00\x01\x00\x00/.test(o)?s(o):s(rf(o)),l.metadata=t.API.TTFFont.open(o),l.metadata.Unicode=l.metadata.Unicode||{encoding:{},kerning:{},widths:[]},l.metadata.glyIdsUsed=[0]})(n,a)}}])})(hs),(function(t){function s(){return(Gs.canvg?Promise.resolve(Gs.canvg):Ey(()=>import("./index.es-CXJFdCws.js"),[])).catch((function(r){return Promise.reject(new Error("Could not load canvg: "+r))})).then((function(r){return r.default?r.default:r}))}hs.API.addSvgAsImage=function(r,a,n,i,l,o,d,u){if(isNaN(a)||isNaN(n))throw ea.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(i)||isNaN(l))throw ea.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=i,c.height=l;var h=c.getContext("2d");h.fillStyle="#fff",h.fillRect(0,0,c.width,c.height);var m={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},p=this;return s().then((function(g){return g.fromString(h,r,m)}),(function(){return Promise.reject(new Error("Could not load canvg."))})).then((function(g){return g.render(m)})).then((function(){p.addImage(c.toDataURL("image/jpeg",1),a,n,i,l,d,u)}))}})(),hs.API.putTotalPages=function(t){var s,r=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(s=new RegExp(t,"g"),r=this.internal.getNumberOfPages()):(s=new RegExp(this.pdfEscape16(t,this.internal.getFont()),"g"),r=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var a=1;a<=this.internal.getNumberOfPages();a++)for(var n=0;n<this.internal.pages[a].length;n++)this.internal.pages[a][n]=this.internal.pages[a][n].replace(s,r);return this},hs.API.viewerPreferences=function(t,s){var r;t=t||{},s=s||!1;var a,n,i,l={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(l),d=[],u=0,c=0,h=0;function m(g,x){var b,y=!1;for(b=0;b<g.length;b+=1)g[b]===x&&(y=!0);return y}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(l)),this.internal.viewerpreferences.isSubscribed=!1),r=this.internal.viewerpreferences.configuration,t==="reset"||s===!0){var p=o.length;for(h=0;h<p;h+=1)r[o[h]].value=r[o[h]].defaultValue,r[o[h]].explicitSet=!1}if(Wr(t)==="object"){for(n in t)if(i=t[n],m(o,n)&&i!==void 0){if(r[n].type==="boolean"&&typeof i=="boolean")r[n].value=i;else if(r[n].type==="name"&&m(r[n].valueSet,i))r[n].value=i;else if(r[n].type==="integer"&&Number.isInteger(i))r[n].value=i;else if(r[n].type==="array"){for(u=0;u<i.length;u+=1)if(a=!0,i[u].length===1&&typeof i[u][0]=="number")d.push(String(i[u]-1));else if(i[u].length>1){for(c=0;c<i[u].length;c+=1)typeof i[u][c]!="number"&&(a=!1);a===!0&&d.push([i[u][0]-1,i[u][1]-1].join(" "))}r[n].value="["+d.join(" ")+"]"}else r[n].value=r[n].defaultValue;r[n].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",(function(){var g,x=[];for(g in r)r[g].explicitSet===!0&&(r[g].type==="name"?x.push("/"+g+" /"+r[g].value):x.push("/"+g+" "+r[g].value));x.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+x.join(`
`)+`
>>`)})),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=r,this},(function(t){var s=function(){var a='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',n=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),i=unescape(encodeURIComponent(a)),l=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),o=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),d=unescape(encodeURIComponent("</x:xmpmeta>")),u=i.length+l.length+o.length+n.length+d.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+u+" >>"),this.internal.write("stream"),this.internal.write(n+i+l+o+d),this.internal.write("endstream"),this.internal.write("endobj")},r=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};t.addMetadata=function(a,n){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:a,namespaceuri:n||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",r),this.internal.events.subscribe("postPutResources",s)),this}})(hs.API),(function(t){var s=t.API,r=s.pdfEscape16=function(i,l){for(var o,d=l.metadata.Unicode.widths,u=["","0","00","000","0000"],c=[""],h=0,m=i.length;h<m;++h){if(o=l.metadata.characterToGlyph(i.charCodeAt(h)),l.metadata.glyIdsUsed.push(o),l.metadata.toUnicode[o]=i.charCodeAt(h),d.indexOf(o)==-1&&(d.push(o),d.push([parseInt(l.metadata.widthOfGlyph(o),10)])),o=="0")return c.join("");o=o.toString(16),c.push(u[4-o.length],o)}return c.join("")},a=function(i){var l,o,d,u,c,h,m;for(c=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,d=[],h=0,m=(o=Object.keys(i).sort((function(p,g){return p-g}))).length;h<m;h++)l=o[h],d.length>=100&&(c+=`
`+d.length+` beginbfchar
`+d.join(`
`)+`
endbfchar`,d=[]),i[l]!==void 0&&i[l]!==null&&typeof i[l].toString=="function"&&(u=("0000"+i[l].toString(16)).slice(-4),l=("0000"+(+l).toString(16)).slice(-4),d.push("<"+l+"><"+u+">"));return d.length&&(c+=`
`+d.length+` beginbfchar
`+d.join(`
`)+`
endbfchar
`),c+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};s.events.push(["putFont",function(i){(function(l){var o=l.font,d=l.out,u=l.newObject,c=l.putStream;if(o.metadata instanceof t.API.TTFFont&&o.encoding==="Identity-H"){for(var h=o.metadata.Unicode.widths,m=o.metadata.subset.encode(o.metadata.glyIdsUsed,1),p="",g=0;g<m.length;g++)p+=String.fromCharCode(m[g]);var x=u();c({data:p,addLength1:!0,objectId:x}),d("endobj");var b=u();c({data:a(o.metadata.toUnicode),addLength1:!0,objectId:b}),d("endobj");var y=u();d("<<"),d("/Type /FontDescriptor"),d("/FontName /"+wh(o.fontName)),d("/FontFile2 "+x+" 0 R"),d("/FontBBox "+t.API.PDFObject.convert(o.metadata.bbox)),d("/Flags "+o.metadata.flags),d("/StemV "+o.metadata.stemV),d("/ItalicAngle "+o.metadata.italicAngle),d("/Ascent "+o.metadata.ascender),d("/Descent "+o.metadata.decender),d("/CapHeight "+o.metadata.capHeight),d(">>"),d("endobj");var j=u();d("<<"),d("/Type /Font"),d("/BaseFont /"+wh(o.fontName)),d("/FontDescriptor "+y+" 0 R"),d("/W "+t.API.PDFObject.convert(h)),d("/CIDToGIDMap /Identity"),d("/DW 1000"),d("/Subtype /CIDFontType2"),d("/CIDSystemInfo"),d("<<"),d("/Supplement 0"),d("/Registry (Adobe)"),d("/Ordering ("+o.encoding+")"),d(">>"),d(">>"),d("endobj"),o.objectNumber=u(),d("<<"),d("/Type /Font"),d("/Subtype /Type0"),d("/ToUnicode "+b+" 0 R"),d("/BaseFont /"+wh(o.fontName)),d("/Encoding /"+o.encoding),d("/DescendantFonts ["+j+" 0 R]"),d(">>"),d("endobj"),o.isAlreadyPutted=!0}})(i)}]),s.events.push(["putFont",function(i){(function(l){var o=l.font,d=l.out,u=l.newObject,c=l.putStream;if(o.metadata instanceof t.API.TTFFont&&o.encoding==="WinAnsiEncoding"){for(var h=o.metadata.rawData,m="",p=0;p<h.length;p++)m+=String.fromCharCode(h[p]);var g=u();c({data:m,addLength1:!0,objectId:g}),d("endobj");var x=u();c({data:a(o.metadata.toUnicode),addLength1:!0,objectId:x}),d("endobj");var b=u();d("<<"),d("/Descent "+o.metadata.decender),d("/CapHeight "+o.metadata.capHeight),d("/StemV "+o.metadata.stemV),d("/Type /FontDescriptor"),d("/FontFile2 "+g+" 0 R"),d("/Flags 96"),d("/FontBBox "+t.API.PDFObject.convert(o.metadata.bbox)),d("/FontName /"+wh(o.fontName)),d("/ItalicAngle "+o.metadata.italicAngle),d("/Ascent "+o.metadata.ascender),d(">>"),d("endobj"),o.objectNumber=u();for(var y=0;y<o.metadata.hmtx.widths.length;y++)o.metadata.hmtx.widths[y]=parseInt(o.metadata.hmtx.widths[y]*(1e3/o.metadata.head.unitsPerEm));d("<</Subtype/TrueType/Type/Font/ToUnicode "+x+" 0 R/BaseFont/"+wh(o.fontName)+"/FontDescriptor "+b+" 0 R/Encoding/"+o.encoding+" /FirstChar 29 /LastChar 255 /Widths "+t.API.PDFObject.convert(o.metadata.hmtx.widths)+">>"),d("endobj"),o.isAlreadyPutted=!0}})(i)}]);var n=function(i){var l,o=i.text||"",d=i.x,u=i.y,c=i.options||{},h=i.mutex||{},m=h.pdfEscape,p=h.activeFontKey,g=h.fonts,x=p,b="",y=0,j="",N=g[x].encoding;if(g[x].encoding!=="Identity-H")return{text:o,x:d,y:u,options:c,mutex:h};for(j=o,x=p,Array.isArray(o)&&(j=o[0]),y=0;y<j.length;y+=1)g[x].metadata.hasOwnProperty("cmap")&&(l=g[x].metadata.cmap.unicode.codeMap[j[y].charCodeAt(0)]),l||j[y].charCodeAt(0)<256&&g[x].metadata.hasOwnProperty("Unicode")?b+=j[y]:b+="";var _="";return parseInt(x.slice(1))<14||N==="WinAnsiEncoding"?_=m(b,x).split("").map((function(F){return F.charCodeAt(0).toString(16)})).join(""):N==="Identity-H"&&(_=r(b,g[x])),h.isHex=!0,{text:_,x:d,y:u,options:c,mutex:h}};s.events.push(["postProcessText",function(i){var l=i.text||"",o=[],d={text:l,x:i.x,y:i.y,options:i.options,mutex:i.mutex};if(Array.isArray(l)){var u=0;for(u=0;u<l.length;u+=1)Array.isArray(l[u])&&l[u].length===3?o.push([n(Object.assign({},d,{text:l[u][0]})).text,l[u][1],l[u][2]]):o.push(n(Object.assign({},d,{text:l[u]})).text);i.text=o}else i.text=n(Object.assign({},d,{text:l})).text}])})(hs),(function(t){var s=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};t.existsFileInVFS=function(r){return s.call(this),this.internal.vFS[r]!==void 0},t.addFileToVFS=function(r,a){return s.call(this),this.internal.vFS[r]=a,this},t.getFileFromVFS=function(r){return s.call(this),this.internal.vFS[r]!==void 0?this.internal.vFS[r]:null}})(hs.API),(function(t){t.__bidiEngine__=t.prototype.__bidiEngine__=function(a){var n,i,l,o,d,u,c,h=s,m=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],p=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],g={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},x={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},b=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],y=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),j=!1,N=0;this.__bidiEngine__={};var _=function(U){var T=U.charCodeAt(),Y=T>>8,H=x[Y];return H!==void 0?h[256*H+(255&T)]:Y===252||Y===253?"AL":y.test(Y)?"L":Y===8?"R":"N"},F=function(U){for(var T,Y=0;Y<U.length;Y++){if((T=_(U.charAt(Y)))==="L")return!1;if(T==="R")return!0}return!1},I=function(U,T,Y,H){var M,q,z,Q,L=T[H];switch(L){case"L":case"R":j=!1;break;case"N":case"AN":break;case"EN":j&&(L="AN");break;case"AL":j=!0,L="R";break;case"WS":L="N";break;case"CS":H<1||H+1>=T.length||(M=Y[H-1])!=="EN"&&M!=="AN"||(q=T[H+1])!=="EN"&&q!=="AN"?L="N":j&&(q="AN"),L=q===M?q:"N";break;case"ES":L=(M=H>0?Y[H-1]:"B")==="EN"&&H+1<T.length&&T[H+1]==="EN"?"EN":"N";break;case"ET":if(H>0&&Y[H-1]==="EN"){L="EN";break}if(j){L="N";break}for(z=H+1,Q=T.length;z<Q&&T[z]==="ET";)z++;L=z<Q&&T[z]==="EN"?"EN":"N";break;case"NSM":if(l&&!o){for(Q=T.length,z=H+1;z<Q&&T[z]==="NSM";)z++;if(z<Q){var V=U[H],P=V>=1425&&V<=2303||V===64286;if(M=T[z],P&&(M==="R"||M==="AL")){L="R";break}}}L=H<1||(M=T[H-1])==="B"?"N":Y[H-1];break;case"B":j=!1,n=!0,L=N;break;case"S":i=!0,L="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":j=!1;break;case"BN":L="N"}return L},w=function(U,T,Y){var H=U.split("");return Y&&E(H,Y,{hiLevel:N}),H.reverse(),T&&T.reverse(),H.join("")},E=function(U,T,Y){var H,M,q,z,Q,L=-1,V=U.length,P=0,C=[],k=N?p:m,B=[];for(j=!1,n=!1,i=!1,M=0;M<V;M++)B[M]=_(U[M]);for(q=0;q<V;q++){if(Q=P,C[q]=I(U,B,C,q),H=240&(P=k[Q][g[C[q]]]),P&=15,T[q]=z=k[P][5],H>0)if(H===16){for(M=L;M<q;M++)T[M]=1;L=-1}else L=-1;if(k[P][6])L===-1&&(L=q);else if(L>-1){for(M=L;M<q;M++)T[M]=z;L=-1}B[q]==="B"&&(T[q]=0),Y.hiLevel|=z}i&&(function(G,O,K){for(var J=0;J<K;J++)if(G[J]==="S"){O[J]=N;for(var te=J-1;te>=0&&G[te]==="WS";te--)O[te]=N}})(B,T,V)},W=function(U,T,Y,H,M){if(!(M.hiLevel<U)){if(U===1&&N===1&&!n)return T.reverse(),void(Y&&Y.reverse());for(var q,z,Q,L,V=T.length,P=0;P<V;){if(H[P]>=U){for(Q=P+1;Q<V&&H[Q]>=U;)Q++;for(L=P,z=Q-1;L<z;L++,z--)q=T[L],T[L]=T[z],T[z]=q,Y&&(q=Y[L],Y[L]=Y[z],Y[z]=q);P=Q}P++}}},R=function(U,T,Y){var H=U.split(""),M={hiLevel:N};return Y||(Y=[]),E(H,Y,M),(function(q,z,Q){if(Q.hiLevel!==0&&c)for(var L,V=0;V<q.length;V++)z[V]===1&&(L=b.indexOf(q[V]))>=0&&(q[V]=b[L+1])})(H,Y,M),W(2,H,T,Y,M),W(1,H,T,Y,M),H.join("")};return this.__bidiEngine__.doBidiReorder=function(U,T,Y){if((function(M,q){if(q)for(var z=0;z<M.length;z++)q[z]=z;o===void 0&&(o=F(M)),u===void 0&&(u=F(M))})(U,T),l||!d||u)if(l&&d&&o^u)N=o?1:0,U=w(U,T,Y);else if(!l&&d&&u)N=o?1:0,U=R(U,T,Y),U=w(U,T);else if(!l||o||d||u){if(l&&!d&&o^u)U=w(U,T),o?(N=0,U=R(U,T,Y)):(N=1,U=R(U,T,Y),U=w(U,T));else if(l&&o&&!d&&u)N=1,U=R(U,T,Y),U=w(U,T);else if(!l&&!d&&o^u){var H=c;o?(N=1,U=R(U,T,Y),N=0,c=!1,U=R(U,T,Y),c=H):(N=0,U=R(U,T,Y),U=w(U,T),N=1,c=!1,U=R(U,T,Y),c=H,U=w(U,T))}}else N=0,U=R(U,T,Y);else N=o?1:0,U=R(U,T,Y);return U},this.__bidiEngine__.setOptions=function(U){U&&(l=U.isInputVisual,d=U.isOutputVisual,o=U.isInputRtl,u=U.isOutputRtl,c=U.isSymmetricSwapping)},this.__bidiEngine__.setOptions(a),this.__bidiEngine__};var s=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],r=new t.__bidiEngine__({isInputVisual:!0});t.API.events.push(["postProcessText",function(a){var n=a.text,i=(a.x,a.y,a.options||{}),l=(a.mutex,i.lang,[]);if(i.isInputVisual=typeof i.isInputVisual!="boolean"||i.isInputVisual,r.setOptions(i),Object.prototype.toString.call(n)==="[object Array]"){var o=0;for(l=[],o=0;o<n.length;o+=1)Object.prototype.toString.call(n[o])==="[object Array]"?l.push([r.doBidiReorder(n[o][0]),n[o][1],n[o][2]]):l.push([r.doBidiReorder(n[o])]);a.text=l}else a.text=r.doBidiReorder(n);r.setOptions({isInputVisual:!0})}])})(hs),hs.API.TTFFont=(function(){function t(s){var r;if(this.rawData=s,r=this.contents=new Cu(s),this.contents.pos=4,r.readString(4)==="ttcf")throw new Error("TTCF not supported.");r.pos=0,this.parse(),this.subset=new nO(this),this.registerTTF()}return t.open=function(s){return new t(s)},t.prototype.parse=function(){return this.directory=new VR(this.contents),this.head=new GR(this),this.name=new JR(this),this.cmap=new G5(this),this.toUnicode={},this.hhea=new KR(this),this.maxp=new ZR(this),this.hmtx=new eO(this),this.post=new YR(this),this.os2=new zR(this),this.loca=new aO(this),this.glyf=new tO(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},t.prototype.registerTTF=function(){var s,r,a,n,i;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var l,o,d,u;for(u=[],l=0,o=(d=this.bbox).length;l<o;l++)s=d[l],u.push(Math.round(s*this.scaleFactor));return u}).call(this),this.stemV=0,this.post.exists?(a=255&(n=this.post.italic_angle),(32768&(r=n>>16))!=0&&(r=-(1+(65535^r))),this.italicAngle=+(r+"."+a)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(i=this.familyClass)===1||i===2||i===3||i===4||i===5||i===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},t.prototype.characterToGlyph=function(s){var r;return((r=this.cmap.unicode)!=null?r.codeMap[s]:void 0)||0},t.prototype.widthOfGlyph=function(s){var r;return r=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(s).advance*r},t.prototype.widthOfString=function(s,r,a){var n,i,l,o;for(l=0,i=0,o=(s=""+s).length;0<=o?i<o:i>o;i=0<=o?++i:--i)n=s.charCodeAt(i),l+=this.widthOfGlyph(this.characterToGlyph(n))+a*(1e3/r)||0;return l*(r/1e3)},t.prototype.lineHeight=function(s,r){var a;return r==null&&(r=!1),a=r?this.lineGap:0,(this.ascender+a-this.decender)/1e3*s},t})();var Yo,Cu=(function(){function t(s){this.data=s??[],this.pos=0,this.length=this.data.length}return t.prototype.readByte=function(){return this.data[this.pos++]},t.prototype.writeByte=function(s){return this.data[this.pos++]=s},t.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},t.prototype.writeUInt32=function(s){return this.writeByte(s>>>24&255),this.writeByte(s>>16&255),this.writeByte(s>>8&255),this.writeByte(255&s)},t.prototype.readInt32=function(){var s;return(s=this.readUInt32())>=2147483648?s-4294967296:s},t.prototype.writeInt32=function(s){return s<0&&(s+=4294967296),this.writeUInt32(s)},t.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},t.prototype.writeUInt16=function(s){return this.writeByte(s>>8&255),this.writeByte(255&s)},t.prototype.readInt16=function(){var s;return(s=this.readUInt16())>=32768?s-65536:s},t.prototype.writeInt16=function(s){return s<0&&(s+=65536),this.writeUInt16(s)},t.prototype.readString=function(s){var r,a;for(a=[],r=0;0<=s?r<s:r>s;r=0<=s?++r:--r)a[r]=String.fromCharCode(this.readByte());return a.join("")},t.prototype.writeString=function(s){var r,a,n;for(n=[],r=0,a=s.length;0<=a?r<a:r>a;r=0<=a?++r:--r)n.push(this.writeByte(s.charCodeAt(r)));return n},t.prototype.readShort=function(){return this.readInt16()},t.prototype.writeShort=function(s){return this.writeInt16(s)},t.prototype.readLongLong=function(){var s,r,a,n,i,l,o,d;return s=this.readByte(),r=this.readByte(),a=this.readByte(),n=this.readByte(),i=this.readByte(),l=this.readByte(),o=this.readByte(),d=this.readByte(),128&s?-1*(72057594037927940*(255^s)+281474976710656*(255^r)+1099511627776*(255^a)+4294967296*(255^n)+16777216*(255^i)+65536*(255^l)+256*(255^o)+(255^d)+1):72057594037927940*s+281474976710656*r+1099511627776*a+4294967296*n+16777216*i+65536*l+256*o+d},t.prototype.writeLongLong=function(s){var r,a;return r=Math.floor(s/4294967296),a=4294967295&s,this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r),this.writeByte(a>>24&255),this.writeByte(a>>16&255),this.writeByte(a>>8&255),this.writeByte(255&a)},t.prototype.readInt=function(){return this.readInt32()},t.prototype.writeInt=function(s){return this.writeInt32(s)},t.prototype.read=function(s){var r,a;for(r=[],a=0;0<=s?a<s:a>s;a=0<=s?++a:--a)r.push(this.readByte());return r},t.prototype.write=function(s){var r,a,n,i;for(i=[],a=0,n=s.length;a<n;a++)r=s[a],i.push(this.writeByte(r));return i},t})(),VR=(function(){var t;function s(r){var a,n,i;for(this.scalarType=r.readInt(),this.tableCount=r.readShort(),this.searchRange=r.readShort(),this.entrySelector=r.readShort(),this.rangeShift=r.readShort(),this.tables={},n=0,i=this.tableCount;0<=i?n<i:n>i;n=0<=i?++n:--n)a={tag:r.readString(4),checksum:r.readInt(),offset:r.readInt(),length:r.readInt()},this.tables[a.tag]=a}return s.prototype.encode=function(r){var a,n,i,l,o,d,u,c,h,m,p,g,x;for(x in p=Object.keys(r).length,d=Math.log(2),h=16*Math.floor(Math.log(p)/d),l=Math.floor(h/d),c=16*p-h,(n=new Cu).writeInt(this.scalarType),n.writeShort(p),n.writeShort(h),n.writeShort(l),n.writeShort(c),i=16*p,u=n.pos+i,o=null,g=[],r)for(m=r[x],n.writeString(x),n.writeInt(t(m)),n.writeInt(u),n.writeInt(m.length),g=g.concat(m),x==="head"&&(o=u),u+=m.length;u%4;)g.push(0),u++;return n.write(g),a=2981146554-t(n.data),n.pos=o+8,n.writeUInt32(a),n.data},t=function(r){var a,n,i,l;for(r=K5.call(r);r.length%4;)r.push(0);for(i=new Cu(r),n=0,a=0,l=r.length;a<l;a=a+=4)n+=i.readUInt32();return 4294967295&n},s})(),WR={}.hasOwnProperty,Bc=function(t,s){for(var r in s)WR.call(s,r)&&(t[r]=s[r]);function a(){this.constructor=t}return a.prototype=s.prototype,t.prototype=new a,t.__super__=s.prototype,t};Yo=(function(){function t(s){var r;this.file=s,r=this.file.directory.tables[this.tag],this.exists=!!r,r&&(this.offset=r.offset,this.length=r.length,this.parse(this.file.contents))}return t.prototype.parse=function(){},t.prototype.encode=function(){},t.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},t})();var GR=(function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return Bc(s,Yo),s.prototype.tag="head",s.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.revision=r.readInt(),this.checkSumAdjustment=r.readInt(),this.magicNumber=r.readInt(),this.flags=r.readShort(),this.unitsPerEm=r.readShort(),this.created=r.readLongLong(),this.modified=r.readLongLong(),this.xMin=r.readShort(),this.yMin=r.readShort(),this.xMax=r.readShort(),this.yMax=r.readShort(),this.macStyle=r.readShort(),this.lowestRecPPEM=r.readShort(),this.fontDirectionHint=r.readShort(),this.indexToLocFormat=r.readShort(),this.glyphDataFormat=r.readShort()},s.prototype.encode=function(r){var a;return(a=new Cu).writeInt(this.version),a.writeInt(this.revision),a.writeInt(this.checkSumAdjustment),a.writeInt(this.magicNumber),a.writeShort(this.flags),a.writeShort(this.unitsPerEm),a.writeLongLong(this.created),a.writeLongLong(this.modified),a.writeShort(this.xMin),a.writeShort(this.yMin),a.writeShort(this.xMax),a.writeShort(this.yMax),a.writeShort(this.macStyle),a.writeShort(this.lowestRecPPEM),a.writeShort(this.fontDirectionHint),a.writeShort(r),a.writeShort(this.glyphDataFormat),a.data},s})(),V_=(function(){function t(s,r){var a,n,i,l,o,d,u,c,h,m,p,g,x,b,y,j,N;switch(this.platformID=s.readUInt16(),this.encodingID=s.readShort(),this.offset=r+s.readInt(),h=s.pos,s.pos=this.offset,this.format=s.readUInt16(),this.length=s.readUInt16(),this.language=s.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(d=0;d<256;++d)this.codeMap[d]=s.readByte();break;case 4:for(p=s.readUInt16(),m=p/2,s.pos+=6,i=(function(){var _,F;for(F=[],d=_=0;0<=m?_<m:_>m;d=0<=m?++_:--_)F.push(s.readUInt16());return F})(),s.pos+=2,x=(function(){var _,F;for(F=[],d=_=0;0<=m?_<m:_>m;d=0<=m?++_:--_)F.push(s.readUInt16());return F})(),u=(function(){var _,F;for(F=[],d=_=0;0<=m?_<m:_>m;d=0<=m?++_:--_)F.push(s.readUInt16());return F})(),c=(function(){var _,F;for(F=[],d=_=0;0<=m?_<m:_>m;d=0<=m?++_:--_)F.push(s.readUInt16());return F})(),n=(this.length-s.pos+this.offset)/2,o=(function(){var _,F;for(F=[],d=_=0;0<=n?_<n:_>n;d=0<=n?++_:--_)F.push(s.readUInt16());return F})(),d=y=0,N=i.length;y<N;d=++y)for(b=i[d],a=j=g=x[d];g<=b?j<=b:j>=b;a=g<=b?++j:--j)c[d]===0?l=a+u[d]:(l=o[c[d]/2+(a-g)-(m-d)]||0)!==0&&(l+=u[d]),this.codeMap[a]=65535&l}s.pos=h}return t.encode=function(s,r){var a,n,i,l,o,d,u,c,h,m,p,g,x,b,y,j,N,_,F,I,w,E,W,R,U,T,Y,H,M,q,z,Q,L,V,P,C,k,B,G,O,K,J,te,se,ae,ne;switch(H=new Cu,l=Object.keys(s).sort((function(ue,oe){return ue-oe})),r){case"macroman":for(x=0,b=(function(){var ue=[];for(g=0;g<256;++g)ue.push(0);return ue})(),j={0:0},i={},M=0,L=l.length;M<L;M++)j[te=s[n=l[M]]]==null&&(j[te]=++x),i[n]={old:s[n],new:j[s[n]]},b[n]=j[s[n]];return H.writeUInt16(1),H.writeUInt16(0),H.writeUInt32(12),H.writeUInt16(0),H.writeUInt16(262),H.writeUInt16(0),H.write(b),{charMap:i,subtable:H.data,maxGlyphID:x+1};case"unicode":for(T=[],h=[],N=0,j={},a={},y=u=null,q=0,V=l.length;q<V;q++)j[F=s[n=l[q]]]==null&&(j[F]=++N),a[n]={old:F,new:j[F]},o=j[F]-n,y!=null&&o===u||(y&&h.push(y),T.push(n),u=o),y=n;for(y&&h.push(y),h.push(65535),T.push(65535),R=2*(W=T.length),E=2*Math.pow(Math.log(W)/Math.LN2,2),m=Math.log(E/2)/Math.LN2,w=2*W-E,d=[],I=[],p=[],g=z=0,P=T.length;z<P;g=++z){if(U=T[g],c=h[g],U===65535){d.push(0),I.push(0);break}if(U-(Y=a[U].new)>=32768)for(d.push(0),I.push(2*(p.length+W-g)),n=Q=U;U<=c?Q<=c:Q>=c;n=U<=c?++Q:--Q)p.push(a[n].new);else d.push(Y-U),I.push(0)}for(H.writeUInt16(3),H.writeUInt16(1),H.writeUInt32(12),H.writeUInt16(4),H.writeUInt16(16+8*W+2*p.length),H.writeUInt16(0),H.writeUInt16(R),H.writeUInt16(E),H.writeUInt16(m),H.writeUInt16(w),K=0,C=h.length;K<C;K++)n=h[K],H.writeUInt16(n);for(H.writeUInt16(0),J=0,k=T.length;J<k;J++)n=T[J],H.writeUInt16(n);for(se=0,B=d.length;se<B;se++)o=d[se],H.writeUInt16(o);for(ae=0,G=I.length;ae<G;ae++)_=I[ae],H.writeUInt16(_);for(ne=0,O=p.length;ne<O;ne++)x=p[ne],H.writeUInt16(x);return{charMap:a,subtable:H.data,maxGlyphID:N+1}}},t})(),G5=(function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return Bc(s,Yo),s.prototype.tag="cmap",s.prototype.parse=function(r){var a,n,i;for(r.pos=this.offset,this.version=r.readUInt16(),i=r.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=i?n<i:n>i;n=0<=i?++n:--n)a=new V_(r,this.offset),this.tables.push(a),a.isUnicode&&this.unicode==null&&(this.unicode=a);return!0},s.encode=function(r,a){var n,i;return a==null&&(a="macroman"),n=V_.encode(r,a),(i=new Cu).writeUInt16(0),i.writeUInt16(1),n.table=i.data.concat(n.subtable),n},s})(),KR=(function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return Bc(s,Yo),s.prototype.tag="hhea",s.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.ascender=r.readShort(),this.decender=r.readShort(),this.lineGap=r.readShort(),this.advanceWidthMax=r.readShort(),this.minLeftSideBearing=r.readShort(),this.minRightSideBearing=r.readShort(),this.xMaxExtent=r.readShort(),this.caretSlopeRise=r.readShort(),this.caretSlopeRun=r.readShort(),this.caretOffset=r.readShort(),r.pos+=8,this.metricDataFormat=r.readShort(),this.numberOfMetrics=r.readUInt16()},s})(),zR=(function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return Bc(s,Yo),s.prototype.tag="OS/2",s.prototype.parse=function(r){if(r.pos=this.offset,this.version=r.readUInt16(),this.averageCharWidth=r.readShort(),this.weightClass=r.readUInt16(),this.widthClass=r.readUInt16(),this.type=r.readShort(),this.ySubscriptXSize=r.readShort(),this.ySubscriptYSize=r.readShort(),this.ySubscriptXOffset=r.readShort(),this.ySubscriptYOffset=r.readShort(),this.ySuperscriptXSize=r.readShort(),this.ySuperscriptYSize=r.readShort(),this.ySuperscriptXOffset=r.readShort(),this.ySuperscriptYOffset=r.readShort(),this.yStrikeoutSize=r.readShort(),this.yStrikeoutPosition=r.readShort(),this.familyClass=r.readShort(),this.panose=(function(){var a,n;for(n=[],a=0;a<10;++a)n.push(r.readByte());return n})(),this.charRange=(function(){var a,n;for(n=[],a=0;a<4;++a)n.push(r.readInt());return n})(),this.vendorID=r.readString(4),this.selection=r.readShort(),this.firstCharIndex=r.readShort(),this.lastCharIndex=r.readShort(),this.version>0&&(this.ascent=r.readShort(),this.descent=r.readShort(),this.lineGap=r.readShort(),this.winAscent=r.readShort(),this.winDescent=r.readShort(),this.codePageRange=(function(){var a,n;for(n=[],a=0;a<2;a=++a)n.push(r.readInt());return n})(),this.version>1))return this.xHeight=r.readShort(),this.capHeight=r.readShort(),this.defaultChar=r.readShort(),this.breakChar=r.readShort(),this.maxContext=r.readShort()},s})(),YR=(function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return Bc(s,Yo),s.prototype.tag="post",s.prototype.parse=function(r){var a,n,i;switch(r.pos=this.offset,this.format=r.readInt(),this.italicAngle=r.readInt(),this.underlinePosition=r.readShort(),this.underlineThickness=r.readShort(),this.isFixedPitch=r.readInt(),this.minMemType42=r.readInt(),this.maxMemType42=r.readInt(),this.minMemType1=r.readInt(),this.maxMemType1=r.readInt(),this.format){case 65536:break;case 131072:var l;for(n=r.readUInt16(),this.glyphNameIndex=[],l=0;0<=n?l<n:l>n;l=0<=n?++l:--l)this.glyphNameIndex.push(r.readUInt16());for(this.names=[],i=[];r.pos<this.offset+this.length;)a=r.readByte(),i.push(this.names.push(r.readString(a)));return i;case 151552:return n=r.readUInt16(),this.offsets=r.read(n);case 196608:break;case 262144:return this.map=(function(){var o,d,u;for(u=[],l=o=0,d=this.file.maxp.numGlyphs;0<=d?o<d:o>d;l=0<=d?++o:--o)u.push(r.readUInt32());return u}).call(this)}},s})(),XR=function(t,s){this.raw=t,this.length=t.length,this.platformID=s.platformID,this.encodingID=s.encodingID,this.languageID=s.languageID},JR=(function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return Bc(s,Yo),s.prototype.tag="name",s.prototype.parse=function(r){var a,n,i,l,o,d,u,c,h,m,p;for(r.pos=this.offset,r.readShort(),a=r.readShort(),d=r.readShort(),n=[],l=0;0<=a?l<a:l>a;l=0<=a?++l:--l)n.push({platformID:r.readShort(),encodingID:r.readShort(),languageID:r.readShort(),nameID:r.readShort(),length:r.readShort(),offset:this.offset+d+r.readShort()});for(u={},l=h=0,m=n.length;h<m;l=++h)i=n[l],r.pos=i.offset,c=r.readString(i.length),o=new XR(c,i),u[p=i.nameID]==null&&(u[p]=[]),u[i.nameID].push(o);this.strings=u,this.copyright=u[0],this.fontFamily=u[1],this.fontSubfamily=u[2],this.uniqueSubfamily=u[3],this.fontName=u[4],this.version=u[5];try{this.postscriptName=u[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=u[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=u[7],this.manufacturer=u[8],this.designer=u[9],this.description=u[10],this.vendorUrl=u[11],this.designerUrl=u[12],this.license=u[13],this.licenseUrl=u[14],this.preferredFamily=u[15],this.preferredSubfamily=u[17],this.compatibleFull=u[18],this.sampleText=u[19]},s})(),ZR=(function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return Bc(s,Yo),s.prototype.tag="maxp",s.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.numGlyphs=r.readUInt16(),this.maxPoints=r.readUInt16(),this.maxContours=r.readUInt16(),this.maxCompositePoints=r.readUInt16(),this.maxComponentContours=r.readUInt16(),this.maxZones=r.readUInt16(),this.maxTwilightPoints=r.readUInt16(),this.maxStorage=r.readUInt16(),this.maxFunctionDefs=r.readUInt16(),this.maxInstructionDefs=r.readUInt16(),this.maxStackElements=r.readUInt16(),this.maxSizeOfInstructions=r.readUInt16(),this.maxComponentElements=r.readUInt16(),this.maxComponentDepth=r.readUInt16()},s})(),eO=(function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return Bc(s,Yo),s.prototype.tag="hmtx",s.prototype.parse=function(r){var a,n,i,l,o,d,u;for(r.pos=this.offset,this.metrics=[],a=0,d=this.file.hhea.numberOfMetrics;0<=d?a<d:a>d;a=0<=d?++a:--a)this.metrics.push({advance:r.readUInt16(),lsb:r.readInt16()});for(i=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var c,h;for(h=[],a=c=0;0<=i?c<i:c>i;a=0<=i?++c:--c)h.push(r.readInt16());return h})(),this.widths=(function(){var c,h,m,p;for(p=[],c=0,h=(m=this.metrics).length;c<h;c++)l=m[c],p.push(l.advance);return p}).call(this),n=this.widths[this.widths.length-1],u=[],a=o=0;0<=i?o<i:o>i;a=0<=i?++o:--o)u.push(this.widths.push(n));return u},s.prototype.forGlyph=function(r){return r in this.metrics?this.metrics[r]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[r-this.metrics.length]}},s})(),K5=[].slice,tO=(function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return Bc(s,Yo),s.prototype.tag="glyf",s.prototype.parse=function(){return this.cache={}},s.prototype.glyphFor=function(r){var a,n,i,l,o,d,u,c,h,m;return r in this.cache?this.cache[r]:(l=this.file.loca,a=this.file.contents,n=l.indexOf(r),(i=l.lengthOf(r))===0?this.cache[r]=null:(a.pos=this.offset+n,o=(d=new Cu(a.read(i))).readShort(),c=d.readShort(),m=d.readShort(),u=d.readShort(),h=d.readShort(),this.cache[r]=o===-1?new rO(d,c,m,u,h):new sO(d,o,c,m,u,h),this.cache[r]))},s.prototype.encode=function(r,a,n){var i,l,o,d,u;for(o=[],l=[],d=0,u=a.length;d<u;d++)i=r[a[d]],l.push(o.length),i&&(o=o.concat(i.encode(n)));return l.push(o.length),{table:o,offsets:l}},s})(),sO=(function(){function t(s,r,a,n,i,l){this.raw=s,this.numberOfContours=r,this.xMin=a,this.yMin=n,this.xMax=i,this.yMax=l,this.compound=!1}return t.prototype.encode=function(){return this.raw.data},t})(),rO=(function(){function t(s,r,a,n,i){var l,o;for(this.raw=s,this.xMin=r,this.yMin=a,this.xMax=n,this.yMax=i,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],l=this.raw;o=l.readShort(),this.glyphOffsets.push(l.pos),this.glyphIDs.push(l.readUInt16()),32&o;)l.pos+=1&o?4:2,128&o?l.pos+=8:64&o?l.pos+=4:8&o&&(l.pos+=2)}return t.prototype.encode=function(){var s,r,a;for(r=new Cu(K5.call(this.raw.data)),s=0,a=this.glyphIDs.length;s<a;++s)r.pos=this.glyphOffsets[s];return r.data},t})(),aO=(function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return Bc(s,Yo),s.prototype.tag="loca",s.prototype.parse=function(r){var a,n;return r.pos=this.offset,a=this.file.head.indexToLocFormat,this.offsets=a===0?(function(){var i,l;for(l=[],n=0,i=this.length;n<i;n+=2)l.push(2*r.readUInt16());return l}).call(this):(function(){var i,l;for(l=[],n=0,i=this.length;n<i;n+=4)l.push(r.readUInt32());return l}).call(this)},s.prototype.indexOf=function(r){return this.offsets[r]},s.prototype.lengthOf=function(r){return this.offsets[r+1]-this.offsets[r]},s.prototype.encode=function(r,a){for(var n=new Uint32Array(this.offsets.length),i=0,l=0,o=0;o<n.length;++o)if(n[o]=i,l<a.length&&a[l]==o){++l,n[o]=i;var d=this.offsets[o],u=this.offsets[o+1]-d;u>0&&(i+=u)}for(var c=new Array(4*n.length),h=0;h<n.length;++h)c[4*h+3]=255&n[h],c[4*h+2]=(65280&n[h])>>8,c[4*h+1]=(16711680&n[h])>>16,c[4*h]=(4278190080&n[h])>>24;return c},s})(),nO=(function(){function t(s){this.font=s,this.subset={},this.unicodes={},this.next=33}return t.prototype.generateCmap=function(){var s,r,a,n,i;for(r in n=this.font.cmap.tables[0].codeMap,s={},i=this.subset)a=i[r],s[r]=n[a];return s},t.prototype.glyphsFor=function(s){var r,a,n,i,l,o,d;for(n={},l=0,o=s.length;l<o;l++)n[i=s[l]]=this.font.glyf.glyphFor(i);for(i in r=[],n)(a=n[i])!=null&&a.compound&&r.push.apply(r,a.glyphIDs);if(r.length>0)for(i in d=this.glyphsFor(r))a=d[i],n[i]=a;return n},t.prototype.encode=function(s,r){var a,n,i,l,o,d,u,c,h,m,p,g,x,b,y;for(n in a=G5.encode(this.generateCmap(),"unicode"),l=this.glyphsFor(s),p={0:0},y=a.charMap)p[(d=y[n]).old]=d.new;for(g in m=a.maxGlyphID,l)g in p||(p[g]=m++);return c=(function(j){var N,_;for(N in _={},j)_[j[N]]=N;return _})(p),h=Object.keys(c).sort((function(j,N){return j-N})),x=(function(){var j,N,_;for(_=[],j=0,N=h.length;j<N;j++)o=h[j],_.push(c[o]);return _})(),i=this.font.glyf.encode(l,x,p),u=this.font.loca.encode(i.offsets,x),b={cmap:this.font.cmap.raw(),glyf:i.table,loca:u,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(r)},this.font.os2.exists&&(b["OS/2"]=this.font.os2.raw()),this.font.directory.encode(b)},t})();hs.API.PDFObject=(function(){var t;function s(){}return t=function(r,a){return(Array(a+1).join("0")+r).slice(-a)},s.convert=function(r){var a,n,i,l;if(Array.isArray(r))return"["+(function(){var o,d,u;for(u=[],o=0,d=r.length;o<d;o++)a=r[o],u.push(s.convert(a));return u})().join(" ")+"]";if(typeof r=="string")return"/"+r;if(r!=null&&r.isString)return"("+r+")";if(r instanceof Date)return"(D:"+t(r.getUTCFullYear(),4)+t(r.getUTCMonth(),2)+t(r.getUTCDate(),2)+t(r.getUTCHours(),2)+t(r.getUTCMinutes(),2)+t(r.getUTCSeconds(),2)+"Z)";if({}.toString.call(r)==="[object Object]"){for(n in i=["<<"],r)l=r[n],i.push("/"+n+" "+s.convert(l));return i.push(">>"),i.join(`
`)}return""+r},s})();/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Qy=function(t,s){return Qy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(r[n]=a[n])},Qy(t,s)};function Xo(t,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");Qy(t,s);function r(){this.constructor=t}t.prototype=s===null?Object.create(s):(r.prototype=s.prototype,new r)}var Hy=function(){return Hy=Object.assign||function(s){for(var r,a=1,n=arguments.length;a<n;a++){r=arguments[a];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(s[i]=r[i])}return s},Hy.apply(this,arguments)};function Ri(t,s,r,a){function n(i){return i instanceof r?i:new r(function(l){l(i)})}return new(r||(r=Promise))(function(i,l){function o(c){try{u(a.next(c))}catch(h){l(h)}}function d(c){try{u(a.throw(c))}catch(h){l(h)}}function u(c){c.done?i(c.value):n(c.value).then(o,d)}u((a=a.apply(t,[])).next())})}function fi(t,s){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},a,n,i,l;return l={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function o(u){return function(c){return d([u,c])}}function d(u){if(a)throw new TypeError("Generator is already executing.");for(;r;)try{if(a=1,n&&(i=u[0]&2?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,n=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){r.label=u[1];break}if(u[0]===6&&r.label<i[1]){r.label=i[1],i=u;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(u);break}i[2]&&r.ops.pop(),r.trys.pop();continue}u=s.call(t,r)}catch(c){u=[6,c],n=0}finally{a=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function nx(t,s,r){if(arguments.length===2)for(var a=0,n=s.length,i;a<n;a++)(i||!(a in s))&&(i||(i=Array.prototype.slice.call(s,0,a)),i[a]=s[a]);return t.concat(i||s)}var vd=(function(){function t(s,r,a,n){this.left=s,this.top=r,this.width=a,this.height=n}return t.prototype.add=function(s,r,a,n){return new t(this.left+s,this.top+r,this.width+a,this.height+n)},t.fromClientRect=function(s,r){return new t(r.left+s.windowBounds.left,r.top+s.windowBounds.top,r.width,r.height)},t.fromDOMRectList=function(s,r){var a=Array.from(r).find(function(n){return n.width!==0});return a?new t(a.left+s.windowBounds.left,a.top+s.windowBounds.top,a.width,a.height):t.EMPTY},t.EMPTY=new t(0,0,0,0),t})(),vg=function(t,s){return vd.fromClientRect(t,s.getBoundingClientRect())},iO=function(t){var s=t.body,r=t.documentElement;if(!s||!r)throw new Error("Unable to get document size");var a=Math.max(Math.max(s.scrollWidth,r.scrollWidth),Math.max(s.offsetWidth,r.offsetWidth),Math.max(s.clientWidth,r.clientWidth)),n=Math.max(Math.max(s.scrollHeight,r.scrollHeight),Math.max(s.offsetHeight,r.offsetHeight),Math.max(s.clientHeight,r.clientHeight));return new vd(0,0,a,n)},bg=function(t){for(var s=[],r=0,a=t.length;r<a;){var n=t.charCodeAt(r++);if(n>=55296&&n<=56319&&r<a){var i=t.charCodeAt(r++);(i&64512)===56320?s.push(((n&1023)<<10)+(i&1023)+65536):(s.push(n),r--)}else s.push(n)}return s},Va=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];if(String.fromCodePoint)return String.fromCodePoint.apply(String,t);var r=t.length;if(!r)return"";for(var a=[],n=-1,i="";++n<r;){var l=t[n];l<=65535?a.push(l):(l-=65536,a.push((l>>10)+55296,l%1024+56320)),(n+1===r||a.length>16384)&&(i+=String.fromCharCode.apply(String,a),a.length=0)}return i},W_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lO=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var ix=0;ix<W_.length;ix++)lO[W_.charCodeAt(ix)]=ix;var G_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",qA=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var lx=0;lx<G_.length;lx++)qA[G_.charCodeAt(lx)]=lx;var oO=function(t){var s=t.length*.75,r=t.length,a,n=0,i,l,o,d;t[t.length-1]==="="&&(s--,t[t.length-2]==="="&&s--);var u=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(s):new Array(s),c=Array.isArray(u)?u:new Uint8Array(u);for(a=0;a<r;a+=4)i=qA[t.charCodeAt(a)],l=qA[t.charCodeAt(a+1)],o=qA[t.charCodeAt(a+2)],d=qA[t.charCodeAt(a+3)],c[n++]=i<<2|l>>4,c[n++]=(l&15)<<4|o>>2,c[n++]=(o&3)<<6|d&63;return u},cO=function(t){for(var s=t.length,r=[],a=0;a<s;a+=2)r.push(t[a+1]<<8|t[a]);return r},dO=function(t){for(var s=t.length,r=[],a=0;a<s;a+=4)r.push(t[a+3]<<24|t[a+2]<<16|t[a+1]<<8|t[a]);return r},bm=5,Jj=11,db=2,uO=Jj-bm,z5=65536>>bm,mO=1<<bm,ub=mO-1,hO=1024>>bm,AO=z5+hO,fO=AO,pO=32,xO=fO+pO,gO=65536>>Jj,vO=1<<uO,bO=vO-1,K_=function(t,s,r){return t.slice?t.slice(s,r):new Uint16Array(Array.prototype.slice.call(t,s,r))},yO=function(t,s,r){return t.slice?t.slice(s,r):new Uint32Array(Array.prototype.slice.call(t,s,r))},jO=function(t,s){var r=oO(t),a=Array.isArray(r)?dO(r):new Uint32Array(r),n=Array.isArray(r)?cO(r):new Uint16Array(r),i=24,l=K_(n,i/2,a[4]/2),o=a[5]===2?K_(n,(i+a[4])/2):yO(a,Math.ceil((i+a[4])/4));return new NO(a[0],a[1],a[2],a[3],l,o)},NO=(function(){function t(s,r,a,n,i,l){this.initialValue=s,this.errorValue=r,this.highStart=a,this.highValueIndex=n,this.index=i,this.data=l}return t.prototype.get=function(s){var r;if(s>=0){if(s<55296||s>56319&&s<=65535)return r=this.index[s>>bm],r=(r<<db)+(s&ub),this.data[r];if(s<=65535)return r=this.index[z5+(s-55296>>bm)],r=(r<<db)+(s&ub),this.data[r];if(s<this.highStart)return r=xO-gO+(s>>Jj),r=this.index[r],r+=s>>bm&bO,r=this.index[r],r=(r<<db)+(s&ub),this.data[r];if(s<=1114111)return this.data[this.highValueIndex]}return this.errorValue},t})(),z_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",wO=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var ox=0;ox<z_.length;ox++)wO[z_.charCodeAt(ox)]=ox;var _O="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",Y_=50,SO=1,Y5=2,X5=3,CO=4,kO=5,X_=7,J5=8,J_=9,pu=10,qy=11,Z_=12,$y=13,EO=14,$A=15,Vy=16,cx=17,IA=18,BO=19,e2=20,Wy=21,LA=22,mb=23,hh=24,Nl=25,VA=26,WA=27,Ah=28,FO=29,um=30,TO=31,dx=32,ux=33,Gy=34,Ky=35,zy=36,Cf=37,Yy=38,a0=39,n0=40,hb=41,Z5=42,IO=43,LO=[9001,65288],e4="!",vr="",mx="",Xy=jO(_O),nd=[um,zy],Jy=[SO,Y5,X5,kO],t4=[pu,J5],t2=[WA,VA],DO=Jy.concat(t4),s2=[Yy,a0,n0,Gy,Ky],PO=[$A,$y],UO=function(t,s){s===void 0&&(s="strict");var r=[],a=[],n=[];return t.forEach(function(i,l){var o=Xy.get(i);if(o>Y_?(n.push(!0),o-=Y_):n.push(!1),["normal","auto","loose"].indexOf(s)!==-1&&[8208,8211,12316,12448].indexOf(i)!==-1)return a.push(l),r.push(Vy);if(o===CO||o===qy){if(l===0)return a.push(l),r.push(um);var d=r[l-1];return DO.indexOf(d)===-1?(a.push(a[l-1]),r.push(d)):(a.push(l),r.push(um))}if(a.push(l),o===TO)return r.push(s==="strict"?Wy:Cf);if(o===Z5||o===FO)return r.push(um);if(o===IO)return i>=131072&&i<=196605||i>=196608&&i<=262141?r.push(Cf):r.push(um);r.push(o)}),[a,r,n]},Ab=function(t,s,r,a){var n=a[r];if(Array.isArray(t)?t.indexOf(n)!==-1:t===n)for(var i=r;i<=a.length;){i++;var l=a[i];if(l===s)return!0;if(l!==pu)break}if(n===pu)for(var i=r;i>0;){i--;var o=a[i];if(Array.isArray(t)?t.indexOf(o)!==-1:t===o)for(var d=r;d<=a.length;){d++;var l=a[d];if(l===s)return!0;if(l!==pu)break}if(o!==pu)break}return!1},r2=function(t,s){for(var r=t;r>=0;){var a=s[r];if(a===pu)r--;else return a}return 0},RO=function(t,s,r,a,n){if(r[a]===0)return vr;var i=a-1;if(Array.isArray(n)&&n[i]===!0)return vr;var l=i-1,o=i+1,d=s[i],u=l>=0?s[l]:0,c=s[o];if(d===Y5&&c===X5)return vr;if(Jy.indexOf(d)!==-1)return e4;if(Jy.indexOf(c)!==-1||t4.indexOf(c)!==-1)return vr;if(r2(i,s)===J5)return mx;if(Xy.get(t[i])===qy||(d===dx||d===ux)&&Xy.get(t[o])===qy||d===X_||c===X_||d===J_||[pu,$y,$A].indexOf(d)===-1&&c===J_||[cx,IA,BO,hh,Ah].indexOf(c)!==-1||r2(i,s)===LA||Ab(mb,LA,i,s)||Ab([cx,IA],Wy,i,s)||Ab(Z_,Z_,i,s))return vr;if(d===pu)return mx;if(d===mb||c===mb)return vr;if(c===Vy||d===Vy)return mx;if([$y,$A,Wy].indexOf(c)!==-1||d===EO||u===zy&&PO.indexOf(d)!==-1||d===Ah&&c===zy||c===e2||nd.indexOf(c)!==-1&&d===Nl||nd.indexOf(d)!==-1&&c===Nl||d===WA&&[Cf,dx,ux].indexOf(c)!==-1||[Cf,dx,ux].indexOf(d)!==-1&&c===VA||nd.indexOf(d)!==-1&&t2.indexOf(c)!==-1||t2.indexOf(d)!==-1&&nd.indexOf(c)!==-1||[WA,VA].indexOf(d)!==-1&&(c===Nl||[LA,$A].indexOf(c)!==-1&&s[o+1]===Nl)||[LA,$A].indexOf(d)!==-1&&c===Nl||d===Nl&&[Nl,Ah,hh].indexOf(c)!==-1)return vr;if([Nl,Ah,hh,cx,IA].indexOf(c)!==-1)for(var h=i;h>=0;){var m=s[h];if(m===Nl)return vr;if([Ah,hh].indexOf(m)!==-1)h--;else break}if([WA,VA].indexOf(c)!==-1)for(var h=[cx,IA].indexOf(d)!==-1?l:i;h>=0;){var m=s[h];if(m===Nl)return vr;if([Ah,hh].indexOf(m)!==-1)h--;else break}if(Yy===d&&[Yy,a0,Gy,Ky].indexOf(c)!==-1||[a0,Gy].indexOf(d)!==-1&&[a0,n0].indexOf(c)!==-1||[n0,Ky].indexOf(d)!==-1&&c===n0||s2.indexOf(d)!==-1&&[e2,VA].indexOf(c)!==-1||s2.indexOf(c)!==-1&&d===WA||nd.indexOf(d)!==-1&&nd.indexOf(c)!==-1||d===hh&&nd.indexOf(c)!==-1||nd.concat(Nl).indexOf(d)!==-1&&c===LA&&LO.indexOf(t[o])===-1||nd.concat(Nl).indexOf(c)!==-1&&d===IA)return vr;if(d===hb&&c===hb){for(var p=r[i],g=1;p>0&&(p--,s[p]===hb);)g++;if(g%2!==0)return vr}return d===dx&&c===ux?vr:mx},OO=function(t,s){s||(s={lineBreak:"normal",wordBreak:"normal"});var r=UO(t,s.lineBreak),a=r[0],n=r[1],i=r[2];(s.wordBreak==="break-all"||s.wordBreak==="break-word")&&(n=n.map(function(o){return[Nl,um,Z5].indexOf(o)!==-1?Cf:o}));var l=s.wordBreak==="keep-all"?i.map(function(o,d){return o&&t[d]>=19968&&t[d]<=40959}):void 0;return[a,n,l]},MO=(function(){function t(s,r,a,n){this.codePoints=s,this.required=r===e4,this.start=a,this.end=n}return t.prototype.slice=function(){return Va.apply(void 0,this.codePoints.slice(this.start,this.end))},t})(),QO=function(t,s){var r=bg(t),a=OO(r,s),n=a[0],i=a[1],l=a[2],o=r.length,d=0,u=0;return{next:function(){if(u>=o)return{done:!0,value:null};for(var c=vr;u<o&&(c=RO(r,i,n,++u,l))===vr;);if(c!==vr||u===o){var h=new MO(r,c,d,u);return d=u,{value:h,done:!1}}return{done:!0,value:null}}}},HO=1,qO=2,tp=4,a2=8,_0=10,n2=47,af=92,$O=9,VO=32,hx=34,DA=61,WO=35,GO=36,KO=37,Ax=39,fx=40,PA=41,zO=95,ll=45,YO=33,XO=60,JO=62,ZO=64,e8=91,t8=93,s8=61,r8=123,px=63,a8=125,i2=124,n8=126,i8=128,l2=65533,fb=42,fm=43,l8=44,o8=58,c8=59,kf=46,d8=0,u8=8,m8=11,h8=14,A8=31,f8=127,pc=-1,s4=48,r4=97,a4=101,p8=102,x8=117,g8=122,n4=65,i4=69,l4=70,v8=85,b8=90,xi=function(t){return t>=s4&&t<=57},y8=function(t){return t>=55296&&t<=57343},fh=function(t){return xi(t)||t>=n4&&t<=l4||t>=r4&&t<=p8},j8=function(t){return t>=r4&&t<=g8},N8=function(t){return t>=n4&&t<=b8},w8=function(t){return j8(t)||N8(t)},_8=function(t){return t>=i8},xx=function(t){return t===_0||t===$O||t===VO},S0=function(t){return w8(t)||_8(t)||t===zO},o2=function(t){return S0(t)||xi(t)||t===ll},S8=function(t){return t>=d8&&t<=u8||t===m8||t>=h8&&t<=A8||t===f8},uu=function(t,s){return t!==af?!1:s!==_0},gx=function(t,s,r){return t===ll?S0(s)||uu(s,r):S0(t)?!0:!!(t===af&&uu(t,s))},pb=function(t,s,r){return t===fm||t===ll?xi(s)?!0:s===kf&&xi(r):xi(t===kf?s:t)},C8=function(t){var s=0,r=1;(t[s]===fm||t[s]===ll)&&(t[s]===ll&&(r=-1),s++);for(var a=[];xi(t[s]);)a.push(t[s++]);var n=a.length?parseInt(Va.apply(void 0,a),10):0;t[s]===kf&&s++;for(var i=[];xi(t[s]);)i.push(t[s++]);var l=i.length,o=l?parseInt(Va.apply(void 0,i),10):0;(t[s]===i4||t[s]===a4)&&s++;var d=1;(t[s]===fm||t[s]===ll)&&(t[s]===ll&&(d=-1),s++);for(var u=[];xi(t[s]);)u.push(t[s++]);var c=u.length?parseInt(Va.apply(void 0,u),10):0;return r*(n+o*Math.pow(10,-l))*Math.pow(10,d*c)},k8={type:2},E8={type:3},B8={type:4},F8={type:13},T8={type:8},I8={type:21},L8={type:9},D8={type:10},P8={type:11},U8={type:12},R8={type:14},vx={type:23},O8={type:1},M8={type:25},Q8={type:24},H8={type:26},q8={type:27},$8={type:28},V8={type:29},W8={type:31},Zy={type:32},o4=(function(){function t(){this._value=[]}return t.prototype.write=function(s){this._value=this._value.concat(bg(s))},t.prototype.read=function(){for(var s=[],r=this.consumeToken();r!==Zy;)s.push(r),r=this.consumeToken();return s},t.prototype.consumeToken=function(){var s=this.consumeCodePoint();switch(s){case hx:return this.consumeStringToken(hx);case WO:var r=this.peekCodePoint(0),a=this.peekCodePoint(1),n=this.peekCodePoint(2);if(o2(r)||uu(a,n)){var i=gx(r,a,n)?qO:HO,l=this.consumeName();return{type:5,value:l,flags:i}}break;case GO:if(this.peekCodePoint(0)===DA)return this.consumeCodePoint(),F8;break;case Ax:return this.consumeStringToken(Ax);case fx:return k8;case PA:return E8;case fb:if(this.peekCodePoint(0)===DA)return this.consumeCodePoint(),R8;break;case fm:if(pb(s,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(s),this.consumeNumericToken();break;case l8:return B8;case ll:var o=s,d=this.peekCodePoint(0),u=this.peekCodePoint(1);if(pb(o,d,u))return this.reconsumeCodePoint(s),this.consumeNumericToken();if(gx(o,d,u))return this.reconsumeCodePoint(s),this.consumeIdentLikeToken();if(d===ll&&u===JO)return this.consumeCodePoint(),this.consumeCodePoint(),Q8;break;case kf:if(pb(s,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(s),this.consumeNumericToken();break;case n2:if(this.peekCodePoint(0)===fb)for(this.consumeCodePoint();;){var c=this.consumeCodePoint();if(c===fb&&(c=this.consumeCodePoint(),c===n2))return this.consumeToken();if(c===pc)return this.consumeToken()}break;case o8:return H8;case c8:return q8;case XO:if(this.peekCodePoint(0)===YO&&this.peekCodePoint(1)===ll&&this.peekCodePoint(2)===ll)return this.consumeCodePoint(),this.consumeCodePoint(),M8;break;case ZO:var h=this.peekCodePoint(0),m=this.peekCodePoint(1),p=this.peekCodePoint(2);if(gx(h,m,p)){var l=this.consumeName();return{type:7,value:l}}break;case e8:return $8;case af:if(uu(s,this.peekCodePoint(0)))return this.reconsumeCodePoint(s),this.consumeIdentLikeToken();break;case t8:return V8;case s8:if(this.peekCodePoint(0)===DA)return this.consumeCodePoint(),T8;break;case r8:return P8;case a8:return U8;case x8:case v8:var g=this.peekCodePoint(0),x=this.peekCodePoint(1);return g===fm&&(fh(x)||x===px)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(s),this.consumeIdentLikeToken();case i2:if(this.peekCodePoint(0)===DA)return this.consumeCodePoint(),L8;if(this.peekCodePoint(0)===i2)return this.consumeCodePoint(),I8;break;case n8:if(this.peekCodePoint(0)===DA)return this.consumeCodePoint(),D8;break;case pc:return Zy}return xx(s)?(this.consumeWhiteSpace(),W8):xi(s)?(this.reconsumeCodePoint(s),this.consumeNumericToken()):S0(s)?(this.reconsumeCodePoint(s),this.consumeIdentLikeToken()):{type:6,value:Va(s)}},t.prototype.consumeCodePoint=function(){var s=this._value.shift();return typeof s>"u"?-1:s},t.prototype.reconsumeCodePoint=function(s){this._value.unshift(s)},t.prototype.peekCodePoint=function(s){return s>=this._value.length?-1:this._value[s]},t.prototype.consumeUnicodeRangeToken=function(){for(var s=[],r=this.consumeCodePoint();fh(r)&&s.length<6;)s.push(r),r=this.consumeCodePoint();for(var a=!1;r===px&&s.length<6;)s.push(r),r=this.consumeCodePoint(),a=!0;if(a){var n=parseInt(Va.apply(void 0,s.map(function(d){return d===px?s4:d})),16),i=parseInt(Va.apply(void 0,s.map(function(d){return d===px?l4:d})),16);return{type:30,start:n,end:i}}var l=parseInt(Va.apply(void 0,s),16);if(this.peekCodePoint(0)===ll&&fh(this.peekCodePoint(1))){this.consumeCodePoint(),r=this.consumeCodePoint();for(var o=[];fh(r)&&o.length<6;)o.push(r),r=this.consumeCodePoint();var i=parseInt(Va.apply(void 0,o),16);return{type:30,start:l,end:i}}else return{type:30,start:l,end:l}},t.prototype.consumeIdentLikeToken=function(){var s=this.consumeName();return s.toLowerCase()==="url"&&this.peekCodePoint(0)===fx?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===fx?(this.consumeCodePoint(),{type:19,value:s}):{type:20,value:s}},t.prototype.consumeUrlToken=function(){var s=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===pc)return{type:22,value:""};var r=this.peekCodePoint(0);if(r===Ax||r===hx){var a=this.consumeStringToken(this.consumeCodePoint());return a.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===pc||this.peekCodePoint(0)===PA)?(this.consumeCodePoint(),{type:22,value:a.value}):(this.consumeBadUrlRemnants(),vx)}for(;;){var n=this.consumeCodePoint();if(n===pc||n===PA)return{type:22,value:Va.apply(void 0,s)};if(xx(n))return this.consumeWhiteSpace(),this.peekCodePoint(0)===pc||this.peekCodePoint(0)===PA?(this.consumeCodePoint(),{type:22,value:Va.apply(void 0,s)}):(this.consumeBadUrlRemnants(),vx);if(n===hx||n===Ax||n===fx||S8(n))return this.consumeBadUrlRemnants(),vx;if(n===af)if(uu(n,this.peekCodePoint(0)))s.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),vx;else s.push(n)}},t.prototype.consumeWhiteSpace=function(){for(;xx(this.peekCodePoint(0));)this.consumeCodePoint()},t.prototype.consumeBadUrlRemnants=function(){for(;;){var s=this.consumeCodePoint();if(s===PA||s===pc)return;uu(s,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},t.prototype.consumeStringSlice=function(s){for(var r=5e4,a="";s>0;){var n=Math.min(r,s);a+=Va.apply(void 0,this._value.splice(0,n)),s-=n}return this._value.shift(),a},t.prototype.consumeStringToken=function(s){var r="",a=0;do{var n=this._value[a];if(n===pc||n===void 0||n===s)return r+=this.consumeStringSlice(a),{type:0,value:r};if(n===_0)return this._value.splice(0,a),O8;if(n===af){var i=this._value[a+1];i!==pc&&i!==void 0&&(i===_0?(r+=this.consumeStringSlice(a),a=-1,this._value.shift()):uu(n,i)&&(r+=this.consumeStringSlice(a),r+=Va(this.consumeEscapedCodePoint()),a=-1))}a++}while(!0)},t.prototype.consumeNumber=function(){var s=[],r=tp,a=this.peekCodePoint(0);for((a===fm||a===ll)&&s.push(this.consumeCodePoint());xi(this.peekCodePoint(0));)s.push(this.consumeCodePoint());a=this.peekCodePoint(0);var n=this.peekCodePoint(1);if(a===kf&&xi(n))for(s.push(this.consumeCodePoint(),this.consumeCodePoint()),r=a2;xi(this.peekCodePoint(0));)s.push(this.consumeCodePoint());a=this.peekCodePoint(0),n=this.peekCodePoint(1);var i=this.peekCodePoint(2);if((a===i4||a===a4)&&((n===fm||n===ll)&&xi(i)||xi(n)))for(s.push(this.consumeCodePoint(),this.consumeCodePoint()),r=a2;xi(this.peekCodePoint(0));)s.push(this.consumeCodePoint());return[C8(s),r]},t.prototype.consumeNumericToken=function(){var s=this.consumeNumber(),r=s[0],a=s[1],n=this.peekCodePoint(0),i=this.peekCodePoint(1),l=this.peekCodePoint(2);if(gx(n,i,l)){var o=this.consumeName();return{type:15,number:r,flags:a,unit:o}}return n===KO?(this.consumeCodePoint(),{type:16,number:r,flags:a}):{type:17,number:r,flags:a}},t.prototype.consumeEscapedCodePoint=function(){var s=this.consumeCodePoint();if(fh(s)){for(var r=Va(s);fh(this.peekCodePoint(0))&&r.length<6;)r+=Va(this.consumeCodePoint());xx(this.peekCodePoint(0))&&this.consumeCodePoint();var a=parseInt(r,16);return a===0||y8(a)||a>1114111?l2:a}return s===pc?l2:s},t.prototype.consumeName=function(){for(var s="";;){var r=this.consumeCodePoint();if(o2(r))s+=Va(r);else if(uu(r,this.peekCodePoint(0)))s+=Va(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(r),s}},t})(),c4=(function(){function t(s){this._tokens=s}return t.create=function(s){var r=new o4;return r.write(s),new t(r.read())},t.parseValue=function(s){return t.create(s).parseComponentValue()},t.parseValues=function(s){return t.create(s).parseComponentValues()},t.prototype.parseComponentValue=function(){for(var s=this.consumeToken();s.type===31;)s=this.consumeToken();if(s.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(s);var r=this.consumeComponentValue();do s=this.consumeToken();while(s.type===31);if(s.type===32)return r;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},t.prototype.parseComponentValues=function(){for(var s=[];;){var r=this.consumeComponentValue();if(r.type===32)return s;s.push(r),s.push()}},t.prototype.consumeComponentValue=function(){var s=this.consumeToken();switch(s.type){case 11:case 28:case 2:return this.consumeSimpleBlock(s.type);case 19:return this.consumeFunction(s)}return s},t.prototype.consumeSimpleBlock=function(s){for(var r={type:s,values:[]},a=this.consumeToken();;){if(a.type===32||K8(a,s))return r;this.reconsumeToken(a),r.values.push(this.consumeComponentValue()),a=this.consumeToken()}},t.prototype.consumeFunction=function(s){for(var r={name:s.value,values:[],type:18};;){var a=this.consumeToken();if(a.type===32||a.type===3)return r;this.reconsumeToken(a),r.values.push(this.consumeComponentValue())}},t.prototype.consumeToken=function(){var s=this._tokens.shift();return typeof s>"u"?Zy:s},t.prototype.reconsumeToken=function(s){this._tokens.unshift(s)},t})(),sp=function(t){return t.type===15},aA=function(t){return t.type===17},Yr=function(t){return t.type===20},G8=function(t){return t.type===0},ej=function(t,s){return Yr(t)&&t.value===s},d4=function(t){return t.type!==31},Wh=function(t){return t.type!==31&&t.type!==4},Fc=function(t){var s=[],r=[];return t.forEach(function(a){if(a.type===4){if(r.length===0)throw new Error("Error parsing function args, zero tokens for arg");s.push(r),r=[];return}a.type!==31&&r.push(a)}),r.length&&s.push(r),s},K8=function(t,s){return s===11&&t.type===12||s===28&&t.type===29?!0:s===2&&t.type===3},ku=function(t){return t.type===17||t.type===15},ln=function(t){return t.type===16||ku(t)},u4=function(t){return t.length>1?[t[0],t[1]]:[t[0]]},zn={type:17,number:0,flags:tp},Zj={type:16,number:50,flags:tp},xu={type:16,number:100,flags:tp},GA=function(t,s,r){var a=t[0],n=t[1];return[ra(a,s),ra(typeof n<"u"?n:a,r)]},ra=function(t,s){if(t.type===16)return t.number/100*s;if(sp(t))switch(t.unit){case"rem":case"em":return 16*t.number;case"px":default:return t.number}return t.number},m4="deg",h4="grad",A4="rad",f4="turn",yg={name:"angle",parse:function(t,s){if(s.type===15)switch(s.unit){case m4:return Math.PI*s.number/180;case h4:return Math.PI/200*s.number;case A4:return s.number;case f4:return Math.PI*2*s.number}throw new Error("Unsupported angle type")}},p4=function(t){return t.type===15&&(t.unit===m4||t.unit===h4||t.unit===A4||t.unit===f4)},x4=function(t){var s=t.filter(Yr).map(function(r){return r.value}).join(" ");switch(s){case"to bottom right":case"to right bottom":case"left top":case"top left":return[zn,zn];case"to top":case"bottom":return ro(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[zn,xu];case"to right":case"left":return ro(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[xu,xu];case"to bottom":case"top":return ro(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[xu,zn];case"to left":case"right":return ro(270)}return 0},ro=function(t){return Math.PI*t/180},Nu={name:"color",parse:function(t,s){if(s.type===18){var r=z8[s.name];if(typeof r>"u")throw new Error('Attempting to parse an unsupported color function "'+s.name+'"');return r(t,s.values)}if(s.type===5){if(s.value.length===3){var a=s.value.substring(0,1),n=s.value.substring(1,2),i=s.value.substring(2,3);return gu(parseInt(a+a,16),parseInt(n+n,16),parseInt(i+i,16),1)}if(s.value.length===4){var a=s.value.substring(0,1),n=s.value.substring(1,2),i=s.value.substring(2,3),l=s.value.substring(3,4);return gu(parseInt(a+a,16),parseInt(n+n,16),parseInt(i+i,16),parseInt(l+l,16)/255)}if(s.value.length===6){var a=s.value.substring(0,2),n=s.value.substring(2,4),i=s.value.substring(4,6);return gu(parseInt(a,16),parseInt(n,16),parseInt(i,16),1)}if(s.value.length===8){var a=s.value.substring(0,2),n=s.value.substring(2,4),i=s.value.substring(4,6),l=s.value.substring(6,8);return gu(parseInt(a,16),parseInt(n,16),parseInt(i,16),parseInt(l,16)/255)}}if(s.type===20){var o=hd[s.value.toUpperCase()];if(typeof o<"u")return o}return hd.TRANSPARENT}},wu=function(t){return(255&t)===0},Cn=function(t){var s=255&t,r=255&t>>8,a=255&t>>16,n=255&t>>24;return s<255?"rgba("+n+","+a+","+r+","+s/255+")":"rgb("+n+","+a+","+r+")"},gu=function(t,s,r,a){return(t<<24|s<<16|r<<8|Math.round(a*255)<<0)>>>0},c2=function(t,s){if(t.type===17)return t.number;if(t.type===16){var r=s===3?1:255;return s===3?t.number/100*r:Math.round(t.number/100*r)}return 0},d2=function(t,s){var r=s.filter(Wh);if(r.length===3){var a=r.map(c2),n=a[0],i=a[1],l=a[2];return gu(n,i,l,1)}if(r.length===4){var o=r.map(c2),n=o[0],i=o[1],l=o[2],d=o[3];return gu(n,i,l,d)}return 0};function xb(t,s,r){return r<0&&(r+=1),r>=1&&(r-=1),r<1/6?(s-t)*r*6+t:r<1/2?s:r<2/3?(s-t)*6*(2/3-r)+t:t}var u2=function(t,s){var r=s.filter(Wh),a=r[0],n=r[1],i=r[2],l=r[3],o=(a.type===17?ro(a.number):yg.parse(t,a))/(Math.PI*2),d=ln(n)?n.number/100:0,u=ln(i)?i.number/100:0,c=typeof l<"u"&&ln(l)?ra(l,1):1;if(d===0)return gu(u*255,u*255,u*255,1);var h=u<=.5?u*(d+1):u+d-u*d,m=u*2-h,p=xb(m,h,o+1/3),g=xb(m,h,o),x=xb(m,h,o-1/3);return gu(p*255,g*255,x*255,c)},z8={hsl:u2,hsla:u2,rgb:d2,rgba:d2},nf=function(t,s){return Nu.parse(t,c4.create(s).parseComponentValue())},hd={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},Y8={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(t,s){return s.map(function(r){if(Yr(r))switch(r.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},X8={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},jg=function(t,s){var r=Nu.parse(t,s[0]),a=s[1];return a&&ln(a)?{color:r,stop:a}:{color:r,stop:null}},m2=function(t,s){var r=t[0],a=t[t.length-1];r.stop===null&&(r.stop=zn),a.stop===null&&(a.stop=xu);for(var n=[],i=0,l=0;l<t.length;l++){var o=t[l].stop;if(o!==null){var d=ra(o,s);d>i?n.push(d):n.push(i),i=d}else n.push(null)}for(var u=null,l=0;l<n.length;l++){var c=n[l];if(c===null)u===null&&(u=l);else if(u!==null){for(var h=l-u,m=n[u-1],p=(c-m)/(h+1),g=1;g<=h;g++)n[u+g-1]=p*g;u=null}}return t.map(function(x,b){var y=x.color;return{color:y,stop:Math.max(Math.min(1,n[b]/s),0)}})},J8=function(t,s,r){var a=s/2,n=r/2,i=ra(t[0],s)-a,l=n-ra(t[1],r);return(Math.atan2(l,i)+Math.PI*2)%(Math.PI*2)},Z8=function(t,s,r){var a=typeof t=="number"?t:J8(t,s,r),n=Math.abs(s*Math.sin(a))+Math.abs(r*Math.cos(a)),i=s/2,l=r/2,o=n/2,d=Math.sin(a-Math.PI/2)*o,u=Math.cos(a-Math.PI/2)*o;return[n,i-u,i+u,l-d,l+d]},Oo=function(t,s){return Math.sqrt(t*t+s*s)},h2=function(t,s,r,a,n){var i=[[0,0],[0,s],[t,0],[t,s]];return i.reduce(function(l,o){var d=o[0],u=o[1],c=Oo(r-d,a-u);return(n?c<l.optimumDistance:c>l.optimumDistance)?{optimumCorner:o,optimumDistance:c}:l},{optimumDistance:n?1/0:-1/0,optimumCorner:null}).optimumCorner},eM=function(t,s,r,a,n){var i=0,l=0;switch(t.size){case 0:t.shape===0?i=l=Math.min(Math.abs(s),Math.abs(s-a),Math.abs(r),Math.abs(r-n)):t.shape===1&&(i=Math.min(Math.abs(s),Math.abs(s-a)),l=Math.min(Math.abs(r),Math.abs(r-n)));break;case 2:if(t.shape===0)i=l=Math.min(Oo(s,r),Oo(s,r-n),Oo(s-a,r),Oo(s-a,r-n));else if(t.shape===1){var o=Math.min(Math.abs(r),Math.abs(r-n))/Math.min(Math.abs(s),Math.abs(s-a)),d=h2(a,n,s,r,!0),u=d[0],c=d[1];i=Oo(u-s,(c-r)/o),l=o*i}break;case 1:t.shape===0?i=l=Math.max(Math.abs(s),Math.abs(s-a),Math.abs(r),Math.abs(r-n)):t.shape===1&&(i=Math.max(Math.abs(s),Math.abs(s-a)),l=Math.max(Math.abs(r),Math.abs(r-n)));break;case 3:if(t.shape===0)i=l=Math.max(Oo(s,r),Oo(s,r-n),Oo(s-a,r),Oo(s-a,r-n));else if(t.shape===1){var o=Math.max(Math.abs(r),Math.abs(r-n))/Math.max(Math.abs(s),Math.abs(s-a)),h=h2(a,n,s,r,!1),u=h[0],c=h[1];i=Oo(u-s,(c-r)/o),l=o*i}break}return Array.isArray(t.size)&&(i=ra(t.size[0],a),l=t.size.length===2?ra(t.size[1],n):i),[i,l]},tM=function(t,s){var r=ro(180),a=[];return Fc(s).forEach(function(n,i){if(i===0){var l=n[0];if(l.type===20&&l.value==="to"){r=x4(n);return}else if(p4(l)){r=yg.parse(t,l);return}}var o=jg(t,n);a.push(o)}),{angle:r,stops:a,type:1}},bx=function(t,s){var r=ro(180),a=[];return Fc(s).forEach(function(n,i){if(i===0){var l=n[0];if(l.type===20&&["top","left","right","bottom"].indexOf(l.value)!==-1){r=x4(n);return}else if(p4(l)){r=(yg.parse(t,l)+ro(270))%ro(360);return}}var o=jg(t,n);a.push(o)}),{angle:r,stops:a,type:1}},sM=function(t,s){var r=ro(180),a=[],n=1,i=0,l=3,o=[];return Fc(s).forEach(function(d,u){var c=d[0];if(u===0){if(Yr(c)&&c.value==="linear"){n=1;return}else if(Yr(c)&&c.value==="radial"){n=2;return}}if(c.type===18){if(c.name==="from"){var h=Nu.parse(t,c.values[0]);a.push({stop:zn,color:h})}else if(c.name==="to"){var h=Nu.parse(t,c.values[0]);a.push({stop:xu,color:h})}else if(c.name==="color-stop"){var m=c.values.filter(Wh);if(m.length===2){var h=Nu.parse(t,m[1]),p=m[0];aA(p)&&a.push({stop:{type:16,number:p.number*100,flags:p.flags},color:h})}}}}),n===1?{angle:(r+ro(180))%ro(360),stops:a,type:n}:{size:l,shape:i,stops:a,position:o,type:n}},g4="closest-side",v4="farthest-side",b4="closest-corner",y4="farthest-corner",j4="circle",N4="ellipse",w4="cover",_4="contain",rM=function(t,s){var r=0,a=3,n=[],i=[];return Fc(s).forEach(function(l,o){var d=!0;if(o===0){var u=!1;d=l.reduce(function(h,m){if(u)if(Yr(m))switch(m.value){case"center":return i.push(Zj),h;case"top":case"left":return i.push(zn),h;case"right":case"bottom":return i.push(xu),h}else(ln(m)||ku(m))&&i.push(m);else if(Yr(m))switch(m.value){case j4:return r=0,!1;case N4:return r=1,!1;case"at":return u=!0,!1;case g4:return a=0,!1;case w4:case v4:return a=1,!1;case _4:case b4:return a=2,!1;case y4:return a=3,!1}else if(ku(m)||ln(m))return Array.isArray(a)||(a=[]),a.push(m),!1;return h},d)}if(d){var c=jg(t,l);n.push(c)}}),{size:a,shape:r,stops:n,position:i,type:2}},yx=function(t,s){var r=0,a=3,n=[],i=[];return Fc(s).forEach(function(l,o){var d=!0;if(o===0?d=l.reduce(function(c,h){if(Yr(h))switch(h.value){case"center":return i.push(Zj),!1;case"top":case"left":return i.push(zn),!1;case"right":case"bottom":return i.push(xu),!1}else if(ln(h)||ku(h))return i.push(h),!1;return c},d):o===1&&(d=l.reduce(function(c,h){if(Yr(h))switch(h.value){case j4:return r=0,!1;case N4:return r=1,!1;case _4:case g4:return a=0,!1;case v4:return a=1,!1;case b4:return a=2,!1;case w4:case y4:return a=3,!1}else if(ku(h)||ln(h))return Array.isArray(a)||(a=[]),a.push(h),!1;return c},d)),d){var u=jg(t,l);n.push(u)}}),{size:a,shape:r,stops:n,position:i,type:2}},aM=function(t){return t.type===1},nM=function(t){return t.type===2},eN={name:"image",parse:function(t,s){if(s.type===22){var r={url:s.value,type:0};return t.cache.addImage(s.value),r}if(s.type===18){var a=S4[s.name];if(typeof a>"u")throw new Error('Attempting to parse an unsupported image function "'+s.name+'"');return a(t,s.values)}throw new Error("Unsupported image type "+s.type)}};function iM(t){return!(t.type===20&&t.value==="none")&&(t.type!==18||!!S4[t.name])}var S4={"linear-gradient":tM,"-moz-linear-gradient":bx,"-ms-linear-gradient":bx,"-o-linear-gradient":bx,"-webkit-linear-gradient":bx,"radial-gradient":rM,"-moz-radial-gradient":yx,"-ms-radial-gradient":yx,"-o-radial-gradient":yx,"-webkit-radial-gradient":yx,"-webkit-gradient":sM},lM={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(t,s){if(s.length===0)return[];var r=s[0];return r.type===20&&r.value==="none"?[]:s.filter(function(a){return Wh(a)&&iM(a)}).map(function(a){return eN.parse(t,a)})}},oM={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(t,s){return s.map(function(r){if(Yr(r))switch(r.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},cM={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(t,s){return Fc(s).map(function(r){return r.filter(ln)}).map(u4)}},dM={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(t,s){return Fc(s).map(function(r){return r.filter(Yr).map(function(a){return a.value}).join(" ")}).map(uM)}},uM=function(t){switch(t){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},Uh;(function(t){t.AUTO="auto",t.CONTAIN="contain",t.COVER="cover"})(Uh||(Uh={}));var mM={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(t,s){return Fc(s).map(function(r){return r.filter(hM)})}},hM=function(t){return Yr(t)||ln(t)},Ng=function(t){return{name:"border-"+t+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},AM=Ng("top"),fM=Ng("right"),pM=Ng("bottom"),xM=Ng("left"),wg=function(t){return{name:"border-radius-"+t,initialValue:"0 0",prefix:!1,type:1,parse:function(s,r){return u4(r.filter(ln))}}},gM=wg("top-left"),vM=wg("top-right"),bM=wg("bottom-right"),yM=wg("bottom-left"),_g=function(t){return{name:"border-"+t+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(s,r){switch(r){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},jM=_g("top"),NM=_g("right"),wM=_g("bottom"),_M=_g("left"),Sg=function(t){return{name:"border-"+t+"-width",initialValue:"0",type:0,prefix:!1,parse:function(s,r){return sp(r)?r.number:0}}},SM=Sg("top"),CM=Sg("right"),kM=Sg("bottom"),EM=Sg("left"),BM={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},FM={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(t,s){switch(s){case"rtl":return 1;case"ltr":default:return 0}}},TM={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(t,s){return s.filter(Yr).reduce(function(r,a){return r|IM(a.value)},0)}},IM=function(t){switch(t){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},LM={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(t,s){switch(s){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},DM={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(t,s){return s.type===20&&s.value==="normal"?0:s.type===17||s.type===15?s.number:0}},C0;(function(t){t.NORMAL="normal",t.STRICT="strict"})(C0||(C0={}));var PM={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(t,s){switch(s){case"strict":return C0.STRICT;case"normal":default:return C0.NORMAL}}},UM={name:"line-height",initialValue:"normal",prefix:!1,type:4},A2=function(t,s){return Yr(t)&&t.value==="normal"?1.2*s:t.type===17?s*t.number:ln(t)?ra(t,s):s},RM={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(t,s){return s.type===20&&s.value==="none"?null:eN.parse(t,s)}},OM={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(t,s){switch(s){case"inside":return 0;case"outside":default:return 1}}},tj={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(t,s){switch(s){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},Cg=function(t){return{name:"margin-"+t,initialValue:"0",prefix:!1,type:4}},MM=Cg("top"),QM=Cg("right"),HM=Cg("bottom"),qM=Cg("left"),$M={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(t,s){return s.filter(Yr).map(function(r){switch(r.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},VM={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(t,s){switch(s){case"break-word":return"break-word";case"normal":default:return"normal"}}},kg=function(t){return{name:"padding-"+t,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},WM=kg("top"),GM=kg("right"),KM=kg("bottom"),zM=kg("left"),YM={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(t,s){switch(s){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},XM={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(t,s){switch(s){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},JM={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(t,s){return s.length===1&&ej(s[0],"none")?[]:Fc(s).map(function(r){for(var a={color:hd.TRANSPARENT,offsetX:zn,offsetY:zn,blur:zn},n=0,i=0;i<r.length;i++){var l=r[i];ku(l)?(n===0?a.offsetX=l:n===1?a.offsetY=l:a.blur=l,n++):a.color=Nu.parse(t,l)}return a})}},ZM={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(t,s){switch(s){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},eQ={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(t,s){if(s.type===20&&s.value==="none")return null;if(s.type===18){var r=rQ[s.name];if(typeof r>"u")throw new Error('Attempting to parse an unsupported transform function "'+s.name+'"');return r(s.values)}return null}},tQ=function(t){var s=t.filter(function(r){return r.type===17}).map(function(r){return r.number});return s.length===6?s:null},sQ=function(t){var s=t.filter(function(d){return d.type===17}).map(function(d){return d.number}),r=s[0],a=s[1];s[2],s[3];var n=s[4],i=s[5];s[6],s[7],s[8],s[9],s[10],s[11];var l=s[12],o=s[13];return s[14],s[15],s.length===16?[r,a,n,i,l,o]:null},rQ={matrix:tQ,matrix3d:sQ},f2={type:16,number:50,flags:tp},aQ=[f2,f2],nQ={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(t,s){var r=s.filter(ln);return r.length!==2?aQ:[r[0],r[1]]}},iQ={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(t,s){switch(s){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},lf;(function(t){t.NORMAL="normal",t.BREAK_ALL="break-all",t.KEEP_ALL="keep-all"})(lf||(lf={}));var lQ={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(t,s){switch(s){case"break-all":return lf.BREAK_ALL;case"keep-all":return lf.KEEP_ALL;case"normal":default:return lf.NORMAL}}},oQ={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(t,s){if(s.type===20)return{auto:!0,order:0};if(aA(s))return{auto:!1,order:s.number};throw new Error("Invalid z-index number parsed")}},C4={name:"time",parse:function(t,s){if(s.type===15)switch(s.unit.toLowerCase()){case"s":return 1e3*s.number;case"ms":return s.number}throw new Error("Unsupported time type")}},cQ={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(t,s){return aA(s)?s.number:1}},dQ={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},uQ={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(t,s){return s.filter(Yr).map(function(r){switch(r.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(r){return r!==0})}},mQ={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(t,s){var r=[],a=[];return s.forEach(function(n){switch(n.type){case 20:case 0:r.push(n.value);break;case 17:r.push(n.number.toString());break;case 4:a.push(r.join(" ")),r.length=0;break}}),r.length&&a.push(r.join(" ")),a.map(function(n){return n.indexOf(" ")===-1?n:"'"+n+"'"})}},hQ={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},AQ={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(t,s){if(aA(s))return s.number;if(Yr(s))switch(s.value){case"bold":return 700;case"normal":default:return 400}return 400}},fQ={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(t,s){return s.filter(Yr).map(function(r){return r.value})}},pQ={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(t,s){switch(s){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},An=function(t,s){return(t&s)!==0},xQ={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(t,s){if(s.length===0)return[];var r=s[0];return r.type===20&&r.value==="none"?[]:s}},gQ={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(t,s){if(s.length===0)return null;var r=s[0];if(r.type===20&&r.value==="none")return null;for(var a=[],n=s.filter(d4),i=0;i<n.length;i++){var l=n[i],o=n[i+1];if(l.type===20){var d=o&&aA(o)?o.number:1;a.push({counter:l.value,increment:d})}}return a}},vQ={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(t,s){if(s.length===0)return[];for(var r=[],a=s.filter(d4),n=0;n<a.length;n++){var i=a[n],l=a[n+1];if(Yr(i)&&i.value!=="none"){var o=l&&aA(l)?l.number:0;r.push({counter:i.value,reset:o})}}return r}},bQ={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(t,s){return s.filter(sp).map(function(r){return C4.parse(t,r)})}},yQ={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(t,s){if(s.length===0)return null;var r=s[0];if(r.type===20&&r.value==="none")return null;var a=[],n=s.filter(G8);if(n.length%2!==0)return null;for(var i=0;i<n.length;i+=2){var l=n[i].value,o=n[i+1].value;a.push({open:l,close:o})}return a}},p2=function(t,s,r){if(!t)return"";var a=t[Math.min(s,t.length-1)];return a?r?a.open:a.close:""},jQ={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(t,s){return s.length===1&&ej(s[0],"none")?[]:Fc(s).map(function(r){for(var a={color:255,offsetX:zn,offsetY:zn,blur:zn,spread:zn,inset:!1},n=0,i=0;i<r.length;i++){var l=r[i];ej(l,"inset")?a.inset=!0:ku(l)?(n===0?a.offsetX=l:n===1?a.offsetY=l:n===2?a.blur=l:a.spread=l,n++):a.color=Nu.parse(t,l)}return a})}},NQ={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(t,s){var r=[0,1,2],a=[];return s.filter(Yr).forEach(function(n){switch(n.value){case"stroke":a.push(1);break;case"fill":a.push(0);break;case"markers":a.push(2);break}}),r.forEach(function(n){a.indexOf(n)===-1&&a.push(n)}),a}},wQ={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},_Q={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(t,s){return sp(s)?s.number:0}},SQ=(function(){function t(s,r){var a,n;this.animationDuration=ks(s,bQ,r.animationDuration),this.backgroundClip=ks(s,Y8,r.backgroundClip),this.backgroundColor=ks(s,X8,r.backgroundColor),this.backgroundImage=ks(s,lM,r.backgroundImage),this.backgroundOrigin=ks(s,oM,r.backgroundOrigin),this.backgroundPosition=ks(s,cM,r.backgroundPosition),this.backgroundRepeat=ks(s,dM,r.backgroundRepeat),this.backgroundSize=ks(s,mM,r.backgroundSize),this.borderTopColor=ks(s,AM,r.borderTopColor),this.borderRightColor=ks(s,fM,r.borderRightColor),this.borderBottomColor=ks(s,pM,r.borderBottomColor),this.borderLeftColor=ks(s,xM,r.borderLeftColor),this.borderTopLeftRadius=ks(s,gM,r.borderTopLeftRadius),this.borderTopRightRadius=ks(s,vM,r.borderTopRightRadius),this.borderBottomRightRadius=ks(s,bM,r.borderBottomRightRadius),this.borderBottomLeftRadius=ks(s,yM,r.borderBottomLeftRadius),this.borderTopStyle=ks(s,jM,r.borderTopStyle),this.borderRightStyle=ks(s,NM,r.borderRightStyle),this.borderBottomStyle=ks(s,wM,r.borderBottomStyle),this.borderLeftStyle=ks(s,_M,r.borderLeftStyle),this.borderTopWidth=ks(s,SM,r.borderTopWidth),this.borderRightWidth=ks(s,CM,r.borderRightWidth),this.borderBottomWidth=ks(s,kM,r.borderBottomWidth),this.borderLeftWidth=ks(s,EM,r.borderLeftWidth),this.boxShadow=ks(s,jQ,r.boxShadow),this.color=ks(s,BM,r.color),this.direction=ks(s,FM,r.direction),this.display=ks(s,TM,r.display),this.float=ks(s,LM,r.cssFloat),this.fontFamily=ks(s,mQ,r.fontFamily),this.fontSize=ks(s,hQ,r.fontSize),this.fontStyle=ks(s,pQ,r.fontStyle),this.fontVariant=ks(s,fQ,r.fontVariant),this.fontWeight=ks(s,AQ,r.fontWeight),this.letterSpacing=ks(s,DM,r.letterSpacing),this.lineBreak=ks(s,PM,r.lineBreak),this.lineHeight=ks(s,UM,r.lineHeight),this.listStyleImage=ks(s,RM,r.listStyleImage),this.listStylePosition=ks(s,OM,r.listStylePosition),this.listStyleType=ks(s,tj,r.listStyleType),this.marginTop=ks(s,MM,r.marginTop),this.marginRight=ks(s,QM,r.marginRight),this.marginBottom=ks(s,HM,r.marginBottom),this.marginLeft=ks(s,qM,r.marginLeft),this.opacity=ks(s,cQ,r.opacity);var i=ks(s,$M,r.overflow);this.overflowX=i[0],this.overflowY=i[i.length>1?1:0],this.overflowWrap=ks(s,VM,r.overflowWrap),this.paddingTop=ks(s,WM,r.paddingTop),this.paddingRight=ks(s,GM,r.paddingRight),this.paddingBottom=ks(s,KM,r.paddingBottom),this.paddingLeft=ks(s,zM,r.paddingLeft),this.paintOrder=ks(s,NQ,r.paintOrder),this.position=ks(s,XM,r.position),this.textAlign=ks(s,YM,r.textAlign),this.textDecorationColor=ks(s,dQ,(a=r.textDecorationColor)!==null&&a!==void 0?a:r.color),this.textDecorationLine=ks(s,uQ,(n=r.textDecorationLine)!==null&&n!==void 0?n:r.textDecoration),this.textShadow=ks(s,JM,r.textShadow),this.textTransform=ks(s,ZM,r.textTransform),this.transform=ks(s,eQ,r.transform),this.transformOrigin=ks(s,nQ,r.transformOrigin),this.visibility=ks(s,iQ,r.visibility),this.webkitTextStrokeColor=ks(s,wQ,r.webkitTextStrokeColor),this.webkitTextStrokeWidth=ks(s,_Q,r.webkitTextStrokeWidth),this.wordBreak=ks(s,lQ,r.wordBreak),this.zIndex=ks(s,oQ,r.zIndex)}return t.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},t.prototype.isTransparent=function(){return wu(this.backgroundColor)},t.prototype.isTransformed=function(){return this.transform!==null},t.prototype.isPositioned=function(){return this.position!==0},t.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},t.prototype.isFloating=function(){return this.float!==0},t.prototype.isInlineLevel=function(){return An(this.display,4)||An(this.display,33554432)||An(this.display,268435456)||An(this.display,536870912)||An(this.display,67108864)||An(this.display,134217728)},t})(),CQ=(function(){function t(s,r){this.content=ks(s,xQ,r.content),this.quotes=ks(s,yQ,r.quotes)}return t})(),x2=(function(){function t(s,r){this.counterIncrement=ks(s,gQ,r.counterIncrement),this.counterReset=ks(s,vQ,r.counterReset)}return t})(),ks=function(t,s,r){var a=new o4,n=r!==null&&typeof r<"u"?r.toString():s.initialValue;a.write(n);var i=new c4(a.read());switch(s.type){case 2:var l=i.parseComponentValue();return s.parse(t,Yr(l)?l.value:s.initialValue);case 0:return s.parse(t,i.parseComponentValue());case 1:return s.parse(t,i.parseComponentValues());case 4:return i.parseComponentValue();case 3:switch(s.format){case"angle":return yg.parse(t,i.parseComponentValue());case"color":return Nu.parse(t,i.parseComponentValue());case"image":return eN.parse(t,i.parseComponentValue());case"length":var o=i.parseComponentValue();return ku(o)?o:zn;case"length-percentage":var d=i.parseComponentValue();return ln(d)?d:zn;case"time":return C4.parse(t,i.parseComponentValue())}break}},kQ="data-html2canvas-debug",EQ=function(t){var s=t.getAttribute(kQ);switch(s){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},sj=function(t,s){var r=EQ(t);return r===1||s===r},Tc=(function(){function t(s,r){if(this.context=s,this.textNodes=[],this.elements=[],this.flags=0,sj(r,3))debugger;this.styles=new SQ(s,window.getComputedStyle(r,null)),nj(r)&&(this.styles.animationDuration.some(function(a){return a>0})&&(r.style.animationDuration="0s"),this.styles.transform!==null&&(r.style.transform="none")),this.bounds=vg(this.context,r),sj(r,4)&&(this.flags|=16)}return t})(),BQ="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",g2="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",KA=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var jx=0;jx<g2.length;jx++)KA[g2.charCodeAt(jx)]=jx;var FQ=function(t){var s=t.length*.75,r=t.length,a,n=0,i,l,o,d;t[t.length-1]==="="&&(s--,t[t.length-2]==="="&&s--);var u=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(s):new Array(s),c=Array.isArray(u)?u:new Uint8Array(u);for(a=0;a<r;a+=4)i=KA[t.charCodeAt(a)],l=KA[t.charCodeAt(a+1)],o=KA[t.charCodeAt(a+2)],d=KA[t.charCodeAt(a+3)],c[n++]=i<<2|l>>4,c[n++]=(l&15)<<4|o>>2,c[n++]=(o&3)<<6|d&63;return u},TQ=function(t){for(var s=t.length,r=[],a=0;a<s;a+=2)r.push(t[a+1]<<8|t[a]);return r},IQ=function(t){for(var s=t.length,r=[],a=0;a<s;a+=4)r.push(t[a+3]<<24|t[a+2]<<16|t[a+1]<<8|t[a]);return r},ym=5,tN=11,gb=2,LQ=tN-ym,k4=65536>>ym,DQ=1<<ym,vb=DQ-1,PQ=1024>>ym,UQ=k4+PQ,RQ=UQ,OQ=32,MQ=RQ+OQ,QQ=65536>>tN,HQ=1<<LQ,qQ=HQ-1,v2=function(t,s,r){return t.slice?t.slice(s,r):new Uint16Array(Array.prototype.slice.call(t,s,r))},$Q=function(t,s,r){return t.slice?t.slice(s,r):new Uint32Array(Array.prototype.slice.call(t,s,r))},VQ=function(t,s){var r=FQ(t),a=Array.isArray(r)?IQ(r):new Uint32Array(r),n=Array.isArray(r)?TQ(r):new Uint16Array(r),i=24,l=v2(n,i/2,a[4]/2),o=a[5]===2?v2(n,(i+a[4])/2):$Q(a,Math.ceil((i+a[4])/4));return new WQ(a[0],a[1],a[2],a[3],l,o)},WQ=(function(){function t(s,r,a,n,i,l){this.initialValue=s,this.errorValue=r,this.highStart=a,this.highValueIndex=n,this.index=i,this.data=l}return t.prototype.get=function(s){var r;if(s>=0){if(s<55296||s>56319&&s<=65535)return r=this.index[s>>ym],r=(r<<gb)+(s&vb),this.data[r];if(s<=65535)return r=this.index[k4+(s-55296>>ym)],r=(r<<gb)+(s&vb),this.data[r];if(s<this.highStart)return r=MQ-QQ+(s>>tN),r=this.index[r],r+=s>>ym&qQ,r=this.index[r],r=(r<<gb)+(s&vb),this.data[r];if(s<=1114111)return this.data[this.highValueIndex]}return this.errorValue},t})(),b2="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",GQ=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var Nx=0;Nx<b2.length;Nx++)GQ[b2.charCodeAt(Nx)]=Nx;var KQ=1,bb=2,yb=3,y2=4,j2=5,zQ=7,N2=8,jb=9,Nb=10,w2=11,_2=12,S2=13,C2=14,wb=15,YQ=function(t){for(var s=[],r=0,a=t.length;r<a;){var n=t.charCodeAt(r++);if(n>=55296&&n<=56319&&r<a){var i=t.charCodeAt(r++);(i&64512)===56320?s.push(((n&1023)<<10)+(i&1023)+65536):(s.push(n),r--)}else s.push(n)}return s},XQ=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];if(String.fromCodePoint)return String.fromCodePoint.apply(String,t);var r=t.length;if(!r)return"";for(var a=[],n=-1,i="";++n<r;){var l=t[n];l<=65535?a.push(l):(l-=65536,a.push((l>>10)+55296,l%1024+56320)),(n+1===r||a.length>16384)&&(i+=String.fromCharCode.apply(String,a),a.length=0)}return i},JQ=VQ(BQ),Jl="",_b="",ZQ=function(t){return JQ.get(t)},e7=function(t,s,r){var a=r-2,n=s[a],i=s[r-1],l=s[r];if(i===bb&&l===yb)return Jl;if(i===bb||i===yb||i===y2||l===bb||l===yb||l===y2)return _b;if(i===N2&&[N2,jb,w2,_2].indexOf(l)!==-1||(i===w2||i===jb)&&(l===jb||l===Nb)||(i===_2||i===Nb)&&l===Nb||l===S2||l===j2||l===zQ||i===KQ)return Jl;if(i===S2&&l===C2){for(;n===j2;)n=s[--a];if(n===C2)return Jl}if(i===wb&&l===wb){for(var o=0;n===wb;)o++,n=s[--a];if(o%2===0)return Jl}return _b},t7=function(t){var s=YQ(t),r=s.length,a=0,n=0,i=s.map(ZQ);return{next:function(){if(a>=r)return{done:!0,value:null};for(var l=Jl;a<r&&(l=e7(s,i,++a))===Jl;);if(l!==Jl||a===r){var o=XQ.apply(null,s.slice(n,a));return n=a,{value:o,done:!1}}return{done:!0,value:null}}}},s7=function(t){for(var s=t7(t),r=[],a;!(a=s.next()).done;)a.value&&r.push(a.value.slice());return r},r7=function(t){var s=123;if(t.createRange){var r=t.createRange();if(r.getBoundingClientRect){var a=t.createElement("boundtest");a.style.height=s+"px",a.style.display="block",t.body.appendChild(a),r.selectNode(a);var n=r.getBoundingClientRect(),i=Math.round(n.height);if(t.body.removeChild(a),i===s)return!0}}return!1},a7=function(t){var s=t.createElement("boundtest");s.style.width="50px",s.style.display="block",s.style.fontSize="12px",s.style.letterSpacing="0px",s.style.wordSpacing="0px",t.body.appendChild(s);var r=t.createRange();s.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var a=s.firstChild,n=bg(a.data).map(function(d){return Va(d)}),i=0,l={},o=n.every(function(d,u){r.setStart(a,i),r.setEnd(a,i+d.length);var c=r.getBoundingClientRect();i+=d.length;var h=c.x>l.x||c.y>l.y;return l=c,u===0?!0:h});return t.body.removeChild(s),o},n7=function(){return typeof new Image().crossOrigin<"u"},i7=function(){return typeof new XMLHttpRequest().responseType=="string"},l7=function(t){var s=new Image,r=t.createElement("canvas"),a=r.getContext("2d");if(!a)return!1;s.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{a.drawImage(s,0,0),r.toDataURL()}catch{return!1}return!0},k2=function(t){return t[0]===0&&t[1]===255&&t[2]===0&&t[3]===255},o7=function(t){var s=t.createElement("canvas"),r=100;s.width=r,s.height=r;var a=s.getContext("2d");if(!a)return Promise.reject(!1);a.fillStyle="rgb(0, 255, 0)",a.fillRect(0,0,r,r);var n=new Image,i=s.toDataURL();n.src=i;var l=rj(r,r,0,0,n);return a.fillStyle="red",a.fillRect(0,0,r,r),E2(l).then(function(o){a.drawImage(o,0,0);var d=a.getImageData(0,0,r,r).data;a.fillStyle="red",a.fillRect(0,0,r,r);var u=t.createElement("div");return u.style.backgroundImage="url("+i+")",u.style.height=r+"px",k2(d)?E2(rj(r,r,0,0,u)):Promise.reject(!1)}).then(function(o){return a.drawImage(o,0,0),k2(a.getImageData(0,0,r,r).data)}).catch(function(){return!1})},rj=function(t,s,r,a,n){var i="http://www.w3.org/2000/svg",l=document.createElementNS(i,"svg"),o=document.createElementNS(i,"foreignObject");return l.setAttributeNS(null,"width",t.toString()),l.setAttributeNS(null,"height",s.toString()),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"x",r.toString()),o.setAttributeNS(null,"y",a.toString()),o.setAttributeNS(null,"externalResourcesRequired","true"),l.appendChild(o),o.appendChild(n),l},E2=function(t){return new Promise(function(s,r){var a=new Image;a.onload=function(){return s(a)},a.onerror=r,a.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(t))})},Wn={get SUPPORT_RANGE_BOUNDS(){var t=r7(document);return Object.defineProperty(Wn,"SUPPORT_RANGE_BOUNDS",{value:t}),t},get SUPPORT_WORD_BREAKING(){var t=Wn.SUPPORT_RANGE_BOUNDS&&a7(document);return Object.defineProperty(Wn,"SUPPORT_WORD_BREAKING",{value:t}),t},get SUPPORT_SVG_DRAWING(){var t=l7(document);return Object.defineProperty(Wn,"SUPPORT_SVG_DRAWING",{value:t}),t},get SUPPORT_FOREIGNOBJECT_DRAWING(){var t=typeof Array.from=="function"&&typeof window.fetch=="function"?o7(document):Promise.resolve(!1);return Object.defineProperty(Wn,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:t}),t},get SUPPORT_CORS_IMAGES(){var t=n7();return Object.defineProperty(Wn,"SUPPORT_CORS_IMAGES",{value:t}),t},get SUPPORT_RESPONSE_TYPE(){var t=i7();return Object.defineProperty(Wn,"SUPPORT_RESPONSE_TYPE",{value:t}),t},get SUPPORT_CORS_XHR(){var t="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Wn,"SUPPORT_CORS_XHR",{value:t}),t},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var t=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(Wn,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:t}),t}},of=(function(){function t(s,r){this.text=s,this.bounds=r}return t})(),c7=function(t,s,r,a){var n=m7(s,r),i=[],l=0;return n.forEach(function(o){if(r.textDecorationLine.length||o.trim().length>0)if(Wn.SUPPORT_RANGE_BOUNDS){var d=B2(a,l,o.length).getClientRects();if(d.length>1){var u=sN(o),c=0;u.forEach(function(m){i.push(new of(m,vd.fromDOMRectList(t,B2(a,c+l,m.length).getClientRects()))),c+=m.length})}else i.push(new of(o,vd.fromDOMRectList(t,d)))}else{var h=a.splitText(o.length);i.push(new of(o,d7(t,a))),a=h}else Wn.SUPPORT_RANGE_BOUNDS||(a=a.splitText(o.length));l+=o.length}),i},d7=function(t,s){var r=s.ownerDocument;if(r){var a=r.createElement("html2canvaswrapper");a.appendChild(s.cloneNode(!0));var n=s.parentNode;if(n){n.replaceChild(a,s);var i=vg(t,a);return a.firstChild&&n.replaceChild(a.firstChild,a),i}}return vd.EMPTY},B2=function(t,s,r){var a=t.ownerDocument;if(!a)throw new Error("Node has no owner document");var n=a.createRange();return n.setStart(t,s),n.setEnd(t,s+r),n},sN=function(t){if(Wn.SUPPORT_NATIVE_TEXT_SEGMENTATION){var s=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(s.segment(t)).map(function(r){return r.segment})}return s7(t)},u7=function(t,s){if(Wn.SUPPORT_NATIVE_TEXT_SEGMENTATION){var r=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(r.segment(t)).map(function(a){return a.segment})}return A7(t,s)},m7=function(t,s){return s.letterSpacing!==0?sN(t):u7(t,s)},h7=[32,160,4961,65792,65793,4153,4241],A7=function(t,s){for(var r=QO(t,{lineBreak:s.lineBreak,wordBreak:s.overflowWrap==="break-word"?"break-word":s.wordBreak}),a=[],n,i=function(){if(n.value){var l=n.value.slice(),o=bg(l),d="";o.forEach(function(u){h7.indexOf(u)===-1?d+=Va(u):(d.length&&a.push(d),a.push(Va(u)),d="")}),d.length&&a.push(d)}};!(n=r.next()).done;)i();return a},f7=(function(){function t(s,r,a){this.text=p7(r.data,a.textTransform),this.textBounds=c7(s,this.text,a,r)}return t})(),p7=function(t,s){switch(s){case 1:return t.toLowerCase();case 3:return t.replace(x7,g7);case 2:return t.toUpperCase();default:return t}},x7=/(^|\s|:|-|\(|\))([a-z])/g,g7=function(t,s,r){return t.length>0?s+r.toUpperCase():t},E4=(function(t){Xo(s,t);function s(r,a){var n=t.call(this,r,a)||this;return n.src=a.currentSrc||a.src,n.intrinsicWidth=a.naturalWidth,n.intrinsicHeight=a.naturalHeight,n.context.cache.addImage(n.src),n}return s})(Tc),B4=(function(t){Xo(s,t);function s(r,a){var n=t.call(this,r,a)||this;return n.canvas=a,n.intrinsicWidth=a.width,n.intrinsicHeight=a.height,n}return s})(Tc),F4=(function(t){Xo(s,t);function s(r,a){var n=t.call(this,r,a)||this,i=new XMLSerializer,l=vg(r,a);return a.setAttribute("width",l.width+"px"),a.setAttribute("height",l.height+"px"),n.svg="data:image/svg+xml,"+encodeURIComponent(i.serializeToString(a)),n.intrinsicWidth=a.width.baseVal.value,n.intrinsicHeight=a.height.baseVal.value,n.context.cache.addImage(n.svg),n}return s})(Tc),T4=(function(t){Xo(s,t);function s(r,a){var n=t.call(this,r,a)||this;return n.value=a.value,n}return s})(Tc),aj=(function(t){Xo(s,t);function s(r,a){var n=t.call(this,r,a)||this;return n.start=a.start,n.reversed=typeof a.reversed=="boolean"&&a.reversed===!0,n}return s})(Tc),v7=[{type:15,flags:0,unit:"px",number:3}],b7=[{type:16,flags:0,number:50}],y7=function(t){return t.width>t.height?new vd(t.left+(t.width-t.height)/2,t.top,t.height,t.height):t.width<t.height?new vd(t.left,t.top+(t.height-t.width)/2,t.width,t.width):t},j7=function(t){var s=t.type===N7?new Array(t.value.length+1).join(""):t.value;return s.length===0?t.placeholder||"":s},k0="checkbox",E0="radio",N7="password",F2=707406591,rN=(function(t){Xo(s,t);function s(r,a){var n=t.call(this,r,a)||this;switch(n.type=a.type.toLowerCase(),n.checked=a.checked,n.value=j7(a),(n.type===k0||n.type===E0)&&(n.styles.backgroundColor=3739148031,n.styles.borderTopColor=n.styles.borderRightColor=n.styles.borderBottomColor=n.styles.borderLeftColor=2779096575,n.styles.borderTopWidth=n.styles.borderRightWidth=n.styles.borderBottomWidth=n.styles.borderLeftWidth=1,n.styles.borderTopStyle=n.styles.borderRightStyle=n.styles.borderBottomStyle=n.styles.borderLeftStyle=1,n.styles.backgroundClip=[0],n.styles.backgroundOrigin=[0],n.bounds=y7(n.bounds)),n.type){case k0:n.styles.borderTopRightRadius=n.styles.borderTopLeftRadius=n.styles.borderBottomRightRadius=n.styles.borderBottomLeftRadius=v7;break;case E0:n.styles.borderTopRightRadius=n.styles.borderTopLeftRadius=n.styles.borderBottomRightRadius=n.styles.borderBottomLeftRadius=b7;break}return n}return s})(Tc),I4=(function(t){Xo(s,t);function s(r,a){var n=t.call(this,r,a)||this,i=a.options[a.selectedIndex||0];return n.value=i&&i.text||"",n}return s})(Tc),L4=(function(t){Xo(s,t);function s(r,a){var n=t.call(this,r,a)||this;return n.value=a.value,n}return s})(Tc),D4=(function(t){Xo(s,t);function s(r,a){var n=t.call(this,r,a)||this;n.src=a.src,n.width=parseInt(a.width,10)||0,n.height=parseInt(a.height,10)||0,n.backgroundColor=n.styles.backgroundColor;try{if(a.contentWindow&&a.contentWindow.document&&a.contentWindow.document.documentElement){n.tree=U4(r,a.contentWindow.document.documentElement);var i=a.contentWindow.document.documentElement?nf(r,getComputedStyle(a.contentWindow.document.documentElement).backgroundColor):hd.TRANSPARENT,l=a.contentWindow.document.body?nf(r,getComputedStyle(a.contentWindow.document.body).backgroundColor):hd.TRANSPARENT;n.backgroundColor=wu(i)?wu(l)?n.styles.backgroundColor:l:i}}catch{}return n}return s})(Tc),w7=["OL","UL","MENU"],i0=function(t,s,r,a){for(var n=s.firstChild,i=void 0;n;n=i)if(i=n.nextSibling,R4(n)&&n.data.trim().length>0)r.textNodes.push(new f7(t,n,r.styles));else if(Fh(n))if(H4(n)&&n.assignedNodes)n.assignedNodes().forEach(function(o){return i0(t,o,r,a)});else{var l=P4(t,n);l.styles.isVisible()&&(_7(n,l,a)?l.flags|=4:S7(l.styles)&&(l.flags|=2),w7.indexOf(n.tagName)!==-1&&(l.flags|=8),r.elements.push(l),n.slot,n.shadowRoot?i0(t,n.shadowRoot,l,a):!B0(n)&&!O4(n)&&!F0(n)&&i0(t,n,l,a))}},P4=function(t,s){return ij(s)?new E4(t,s):M4(s)?new B4(t,s):O4(s)?new F4(t,s):C7(s)?new T4(t,s):k7(s)?new aj(t,s):E7(s)?new rN(t,s):F0(s)?new I4(t,s):B0(s)?new L4(t,s):Q4(s)?new D4(t,s):new Tc(t,s)},U4=function(t,s){var r=P4(t,s);return r.flags|=4,i0(t,s,r,r),r},_7=function(t,s,r){return s.styles.isPositionedWithZIndex()||s.styles.opacity<1||s.styles.isTransformed()||aN(t)&&r.styles.isTransparent()},S7=function(t){return t.isPositioned()||t.isFloating()},R4=function(t){return t.nodeType===Node.TEXT_NODE},Fh=function(t){return t.nodeType===Node.ELEMENT_NODE},nj=function(t){return Fh(t)&&typeof t.style<"u"&&!l0(t)},l0=function(t){return typeof t.className=="object"},C7=function(t){return t.tagName==="LI"},k7=function(t){return t.tagName==="OL"},E7=function(t){return t.tagName==="INPUT"},B7=function(t){return t.tagName==="HTML"},O4=function(t){return t.tagName==="svg"},aN=function(t){return t.tagName==="BODY"},M4=function(t){return t.tagName==="CANVAS"},T2=function(t){return t.tagName==="VIDEO"},ij=function(t){return t.tagName==="IMG"},Q4=function(t){return t.tagName==="IFRAME"},I2=function(t){return t.tagName==="STYLE"},F7=function(t){return t.tagName==="SCRIPT"},B0=function(t){return t.tagName==="TEXTAREA"},F0=function(t){return t.tagName==="SELECT"},H4=function(t){return t.tagName==="SLOT"},L2=function(t){return t.tagName.indexOf("-")>0},T7=(function(){function t(){this.counters={}}return t.prototype.getCounterValue=function(s){var r=this.counters[s];return r&&r.length?r[r.length-1]:1},t.prototype.getCounterValues=function(s){var r=this.counters[s];return r||[]},t.prototype.pop=function(s){var r=this;s.forEach(function(a){return r.counters[a].pop()})},t.prototype.parse=function(s){var r=this,a=s.counterIncrement,n=s.counterReset,i=!0;a!==null&&a.forEach(function(o){var d=r.counters[o.counter];d&&o.increment!==0&&(i=!1,d.length||d.push(1),d[Math.max(0,d.length-1)]+=o.increment)});var l=[];return i&&n.forEach(function(o){var d=r.counters[o.counter];l.push(o.counter),d||(d=r.counters[o.counter]=[]),d.push(o.reset)}),l},t})(),D2={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},P2={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},I7={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},L7={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},ph=function(t,s,r,a,n,i){return t<s||t>r?Ef(t,n,i.length>0):a.integers.reduce(function(l,o,d){for(;t>=o;)t-=o,l+=a.values[d];return l},"")+i},q4=function(t,s,r,a){var n="";do r||t--,n=a(t)+n,t/=s;while(t*s>=s);return n},qa=function(t,s,r,a,n){var i=r-s+1;return(t<0?"-":"")+(q4(Math.abs(t),i,a,function(l){return Va(Math.floor(l%i)+s)})+n)},nm=function(t,s,r){r===void 0&&(r=". ");var a=s.length;return q4(Math.abs(t),a,!1,function(n){return s[Math.floor(n%a)]})+r},_h=1,cu=2,du=4,zA=8,id=function(t,s,r,a,n,i){if(t<-9999||t>9999)return Ef(t,4,n.length>0);var l=Math.abs(t),o=n;if(l===0)return s[0]+o;for(var d=0;l>0&&d<=4;d++){var u=l%10;u===0&&An(i,_h)&&o!==""?o=s[u]+o:u>1||u===1&&d===0||u===1&&d===1&&An(i,cu)||u===1&&d===1&&An(i,du)&&t>100||u===1&&d>1&&An(i,zA)?o=s[u]+(d>0?r[d-1]:"")+o:u===1&&d>0&&(o=r[d-1]+o),l=Math.floor(l/10)}return(t<0?a:"")+o},U2="",R2="",O2="",Sb="",Ef=function(t,s,r){var a=r?". ":"",n=r?"":"",i=r?", ":"",l=r?" ":"";switch(s){case 0:return""+l;case 1:return""+l;case 2:return""+l;case 5:var o=qa(t,48,57,!0,a);return o.length<4?"0"+o:o;case 4:return nm(t,"",n);case 6:return ph(t,1,3999,D2,3,a).toLowerCase();case 7:return ph(t,1,3999,D2,3,a);case 8:return qa(t,945,969,!1,a);case 9:return qa(t,97,122,!1,a);case 10:return qa(t,65,90,!1,a);case 11:return qa(t,1632,1641,!0,a);case 12:case 49:return ph(t,1,9999,P2,3,a);case 35:return ph(t,1,9999,P2,3,a).toLowerCase();case 13:return qa(t,2534,2543,!0,a);case 14:case 30:return qa(t,6112,6121,!0,a);case 15:return nm(t,"",n);case 16:return nm(t,"",n);case 17:case 48:return id(t,"",U2,"",n,cu|du|zA);case 47:return id(t,"",R2,"",n,_h|cu|du|zA);case 42:return id(t,"",U2,"",n,cu|du|zA);case 41:return id(t,"",R2,"",n,_h|cu|du|zA);case 26:return id(t,"","",O2,n,0);case 25:return id(t,"","",O2,n,_h|cu|du);case 31:return id(t,"","",Sb,i,_h|cu|du);case 33:return id(t,"","",Sb,i,0);case 32:return id(t,"","",Sb,i,_h|cu|du);case 18:return qa(t,2406,2415,!0,a);case 20:return ph(t,1,19999,L7,3,a);case 21:return qa(t,2790,2799,!0,a);case 22:return qa(t,2662,2671,!0,a);case 22:return ph(t,1,10999,I7,3,a);case 23:return nm(t,"");case 24:return nm(t,"");case 27:return qa(t,3302,3311,!0,a);case 28:return nm(t,"",n);case 29:return nm(t,"",n);case 34:return qa(t,3792,3801,!0,a);case 37:return qa(t,6160,6169,!0,a);case 38:return qa(t,4160,4169,!0,a);case 39:return qa(t,2918,2927,!0,a);case 40:return qa(t,1776,1785,!0,a);case 43:return qa(t,3046,3055,!0,a);case 44:return qa(t,3174,3183,!0,a);case 45:return qa(t,3664,3673,!0,a);case 46:return qa(t,3872,3881,!0,a);case 3:default:return qa(t,48,57,!0,a)}},$4="data-html2canvas-ignore",M2=(function(){function t(s,r,a){if(this.context=s,this.options=a,this.scrolledElements=[],this.referenceElement=r,this.counters=new T7,this.quoteDepth=0,!r.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(r.ownerDocument.documentElement,!1)}return t.prototype.toIFrame=function(s,r){var a=this,n=D7(s,r);if(!n.contentWindow)return Promise.reject("Unable to find iframe window");var i=s.defaultView.pageXOffset,l=s.defaultView.pageYOffset,o=n.contentWindow,d=o.document,u=R7(n).then(function(){return Ri(a,void 0,void 0,function(){var c,h;return fi(this,function(m){switch(m.label){case 0:return this.scrolledElements.forEach(H7),o&&(o.scrollTo(r.left,r.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(o.scrollY!==r.top||o.scrollX!==r.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(o.scrollX-r.left,o.scrollY-r.top,0,0))),c=this.options.onclone,h=this.clonedReferenceElement,typeof h>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:d.fonts&&d.fonts.ready?[4,d.fonts.ready]:[3,2];case 1:m.sent(),m.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,U7(d)]:[3,4];case 3:m.sent(),m.label=4;case 4:return typeof c=="function"?[2,Promise.resolve().then(function(){return c(d,h)}).then(function(){return n})]:[2,n]}})})});return d.open(),d.write(M7(document.doctype)+"<html></html>"),Q7(this.referenceElement.ownerDocument,i,l),d.replaceChild(d.adoptNode(this.documentElement),d.documentElement),d.close(),u},t.prototype.createElementClone=function(s){if(sj(s,2))debugger;if(M4(s))return this.createCanvasClone(s);if(T2(s))return this.createVideoClone(s);if(I2(s))return this.createStyleClone(s);var r=s.cloneNode(!1);return ij(r)&&(ij(s)&&s.currentSrc&&s.currentSrc!==s.src&&(r.src=s.currentSrc,r.srcset=""),r.loading==="lazy"&&(r.loading="eager")),L2(r)?this.createCustomElementClone(r):r},t.prototype.createCustomElementClone=function(s){var r=document.createElement("html2canvascustomelement");return Cb(s.style,r),r},t.prototype.createStyleClone=function(s){try{var r=s.sheet;if(r&&r.cssRules){var a=[].slice.call(r.cssRules,0).reduce(function(i,l){return l&&typeof l.cssText=="string"?i+l.cssText:i},""),n=s.cloneNode(!1);return n.textContent=a,n}}catch(i){if(this.context.logger.error("Unable to access cssRules property",i),i.name!=="SecurityError")throw i}return s.cloneNode(!1)},t.prototype.createCanvasClone=function(s){var r;if(this.options.inlineImages&&s.ownerDocument){var a=s.ownerDocument.createElement("img");try{return a.src=s.toDataURL(),a}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",s)}}var n=s.cloneNode(!1);try{n.width=s.width,n.height=s.height;var i=s.getContext("2d"),l=n.getContext("2d");if(l)if(!this.options.allowTaint&&i)l.putImageData(i.getImageData(0,0,s.width,s.height),0,0);else{var o=(r=s.getContext("webgl2"))!==null&&r!==void 0?r:s.getContext("webgl");if(o){var d=o.getContextAttributes();(d==null?void 0:d.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",s)}l.drawImage(s,0,0)}return n}catch{this.context.logger.info("Unable to clone canvas as it is tainted",s)}return n},t.prototype.createVideoClone=function(s){var r=s.ownerDocument.createElement("canvas");r.width=s.offsetWidth,r.height=s.offsetHeight;var a=r.getContext("2d");try{return a&&(a.drawImage(s,0,0,r.width,r.height),this.options.allowTaint||a.getImageData(0,0,r.width,r.height)),r}catch{this.context.logger.info("Unable to clone video as it is tainted",s)}var n=s.ownerDocument.createElement("canvas");return n.width=s.offsetWidth,n.height=s.offsetHeight,n},t.prototype.appendChildNode=function(s,r,a){(!Fh(r)||!F7(r)&&!r.hasAttribute($4)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(r)))&&(!this.options.copyStyles||!Fh(r)||!I2(r))&&s.appendChild(this.cloneNode(r,a))},t.prototype.cloneChildNodes=function(s,r,a){for(var n=this,i=s.shadowRoot?s.shadowRoot.firstChild:s.firstChild;i;i=i.nextSibling)if(Fh(i)&&H4(i)&&typeof i.assignedNodes=="function"){var l=i.assignedNodes();l.length&&l.forEach(function(o){return n.appendChildNode(r,o,a)})}else this.appendChildNode(r,i,a)},t.prototype.cloneNode=function(s,r){if(R4(s))return document.createTextNode(s.data);if(!s.ownerDocument)return s.cloneNode(!1);var a=s.ownerDocument.defaultView;if(a&&Fh(s)&&(nj(s)||l0(s))){var n=this.createElementClone(s);n.style.transitionProperty="none";var i=a.getComputedStyle(s),l=a.getComputedStyle(s,":before"),o=a.getComputedStyle(s,":after");this.referenceElement===s&&nj(n)&&(this.clonedReferenceElement=n),aN(n)&&V7(n);var d=this.counters.parse(new x2(this.context,i)),u=this.resolvePseudoContent(s,n,l,cf.BEFORE);L2(s)&&(r=!0),T2(s)||this.cloneChildNodes(s,n,r),u&&n.insertBefore(u,n.firstChild);var c=this.resolvePseudoContent(s,n,o,cf.AFTER);return c&&n.appendChild(c),this.counters.pop(d),(i&&(this.options.copyStyles||l0(s))&&!Q4(s)||r)&&Cb(i,n),(s.scrollTop!==0||s.scrollLeft!==0)&&this.scrolledElements.push([n,s.scrollLeft,s.scrollTop]),(B0(s)||F0(s))&&(B0(n)||F0(n))&&(n.value=s.value),n}return s.cloneNode(!1)},t.prototype.resolvePseudoContent=function(s,r,a,n){var i=this;if(a){var l=a.content,o=r.ownerDocument;if(!(!o||!l||l==="none"||l==="-moz-alt-content"||a.display==="none")){this.counters.parse(new x2(this.context,a));var d=new CQ(this.context,a),u=o.createElement("html2canvaspseudoelement");Cb(a,u),d.content.forEach(function(h){if(h.type===0)u.appendChild(o.createTextNode(h.value));else if(h.type===22){var m=o.createElement("img");m.src=h.value,m.style.opacity="1",u.appendChild(m)}else if(h.type===18){if(h.name==="attr"){var p=h.values.filter(Yr);p.length&&u.appendChild(o.createTextNode(s.getAttribute(p[0].value)||""))}else if(h.name==="counter"){var g=h.values.filter(Wh),x=g[0],b=g[1];if(x&&Yr(x)){var y=i.counters.getCounterValue(x.value),j=b&&Yr(b)?tj.parse(i.context,b.value):3;u.appendChild(o.createTextNode(Ef(y,j,!1)))}}else if(h.name==="counters"){var N=h.values.filter(Wh),x=N[0],_=N[1],b=N[2];if(x&&Yr(x)){var F=i.counters.getCounterValues(x.value),I=b&&Yr(b)?tj.parse(i.context,b.value):3,w=_&&_.type===0?_.value:"",E=F.map(function(U){return Ef(U,I,!1)}).join(w);u.appendChild(o.createTextNode(E))}}}else if(h.type===20)switch(h.value){case"open-quote":u.appendChild(o.createTextNode(p2(d.quotes,i.quoteDepth++,!0)));break;case"close-quote":u.appendChild(o.createTextNode(p2(d.quotes,--i.quoteDepth,!1)));break;default:u.appendChild(o.createTextNode(h.value))}}),u.className=lj+" "+oj;var c=n===cf.BEFORE?" "+lj:" "+oj;return l0(r)?r.className.baseValue+=c:r.className+=c,u}}},t.destroy=function(s){return s.parentNode?(s.parentNode.removeChild(s),!0):!1},t})(),cf;(function(t){t[t.BEFORE=0]="BEFORE",t[t.AFTER=1]="AFTER"})(cf||(cf={}));var D7=function(t,s){var r=t.createElement("iframe");return r.className="html2canvas-container",r.style.visibility="hidden",r.style.position="fixed",r.style.left="-10000px",r.style.top="0px",r.style.border="0",r.width=s.width.toString(),r.height=s.height.toString(),r.scrolling="no",r.setAttribute($4,"true"),t.body.appendChild(r),r},P7=function(t){return new Promise(function(s){if(t.complete){s();return}if(!t.src){s();return}t.onload=s,t.onerror=s})},U7=function(t){return Promise.all([].slice.call(t.images,0).map(P7))},R7=function(t){return new Promise(function(s,r){var a=t.contentWindow;if(!a)return r("No window assigned for iframe");var n=a.document;a.onload=t.onload=function(){a.onload=t.onload=null;var i=setInterval(function(){n.body.childNodes.length>0&&n.readyState==="complete"&&(clearInterval(i),s(t))},50)}})},O7=["all","d","content"],Cb=function(t,s){for(var r=t.length-1;r>=0;r--){var a=t.item(r);O7.indexOf(a)===-1&&s.style.setProperty(a,t.getPropertyValue(a))}return s},M7=function(t){var s="";return t&&(s+="<!DOCTYPE ",t.name&&(s+=t.name),t.internalSubset&&(s+=t.internalSubset),t.publicId&&(s+='"'+t.publicId+'"'),t.systemId&&(s+='"'+t.systemId+'"'),s+=">"),s},Q7=function(t,s,r){t&&t.defaultView&&(s!==t.defaultView.pageXOffset||r!==t.defaultView.pageYOffset)&&t.defaultView.scrollTo(s,r)},H7=function(t){var s=t[0],r=t[1],a=t[2];s.scrollLeft=r,s.scrollTop=a},q7=":before",$7=":after",lj="___html2canvas___pseudoelement_before",oj="___html2canvas___pseudoelement_after",Q2=`{
    content: "" !important;
    display: none !important;
}`,V7=function(t){W7(t,"."+lj+q7+Q2+`
         .`+oj+$7+Q2)},W7=function(t,s){var r=t.ownerDocument;if(r){var a=r.createElement("style");a.textContent=s,t.appendChild(a)}},V4=(function(){function t(){}return t.getOrigin=function(s){var r=t._link;return r?(r.href=s,r.href=r.href,r.protocol+r.hostname+r.port):"about:blank"},t.isSameOrigin=function(s){return t.getOrigin(s)===t._origin},t.setContext=function(s){t._link=s.document.createElement("a"),t._origin=t.getOrigin(s.location.href)},t._origin="about:blank",t})(),G7=(function(){function t(s,r){this.context=s,this._options=r,this._cache={}}return t.prototype.addImage=function(s){var r=Promise.resolve();return this.has(s)||(Eb(s)||X7(s))&&(this._cache[s]=this.loadImage(s)).catch(function(){}),r},t.prototype.match=function(s){return this._cache[s]},t.prototype.loadImage=function(s){return Ri(this,void 0,void 0,function(){var r,a,n,i,l=this;return fi(this,function(o){switch(o.label){case 0:return r=V4.isSameOrigin(s),a=!kb(s)&&this._options.useCORS===!0&&Wn.SUPPORT_CORS_IMAGES&&!r,n=!kb(s)&&!r&&!Eb(s)&&typeof this._options.proxy=="string"&&Wn.SUPPORT_CORS_XHR&&!a,!r&&this._options.allowTaint===!1&&!kb(s)&&!Eb(s)&&!n&&!a?[2]:(i=s,n?[4,this.proxy(i)]:[3,2]);case 1:i=o.sent(),o.label=2;case 2:return this.context.logger.debug("Added image "+s.substring(0,256)),[4,new Promise(function(d,u){var c=new Image;c.onload=function(){return d(c)},c.onerror=u,(J7(i)||a)&&(c.crossOrigin="anonymous"),c.src=i,c.complete===!0&&setTimeout(function(){return d(c)},500),l._options.imageTimeout>0&&setTimeout(function(){return u("Timed out ("+l._options.imageTimeout+"ms) loading image")},l._options.imageTimeout)})];case 3:return[2,o.sent()]}})})},t.prototype.has=function(s){return typeof this._cache[s]<"u"},t.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},t.prototype.proxy=function(s){var r=this,a=this._options.proxy;if(!a)throw new Error("No proxy defined");var n=s.substring(0,256);return new Promise(function(i,l){var o=Wn.SUPPORT_RESPONSE_TYPE?"blob":"text",d=new XMLHttpRequest;d.onload=function(){if(d.status===200)if(o==="text")i(d.response);else{var h=new FileReader;h.addEventListener("load",function(){return i(h.result)},!1),h.addEventListener("error",function(m){return l(m)},!1),h.readAsDataURL(d.response)}else l("Failed to proxy resource "+n+" with status code "+d.status)},d.onerror=l;var u=a.indexOf("?")>-1?"&":"?";if(d.open("GET",""+a+u+"url="+encodeURIComponent(s)+"&responseType="+o),o!=="text"&&d instanceof XMLHttpRequest&&(d.responseType=o),r._options.imageTimeout){var c=r._options.imageTimeout;d.timeout=c,d.ontimeout=function(){return l("Timed out ("+c+"ms) proxying "+n)}}d.send()})},t})(),K7=/^data:image\/svg\+xml/i,z7=/^data:image\/.*;base64,/i,Y7=/^data:image\/.*/i,X7=function(t){return Wn.SUPPORT_SVG_DRAWING||!Z7(t)},kb=function(t){return Y7.test(t)},J7=function(t){return z7.test(t)},Eb=function(t){return t.substr(0,4)==="blob"},Z7=function(t){return t.substr(-3).toLowerCase()==="svg"||K7.test(t)},Ss=(function(){function t(s,r){this.type=0,this.x=s,this.y=r}return t.prototype.add=function(s,r){return new t(this.x+s,this.y+r)},t})(),xh=function(t,s,r){return new Ss(t.x+(s.x-t.x)*r,t.y+(s.y-t.y)*r)},wx=(function(){function t(s,r,a,n){this.type=1,this.start=s,this.startControl=r,this.endControl=a,this.end=n}return t.prototype.subdivide=function(s,r){var a=xh(this.start,this.startControl,s),n=xh(this.startControl,this.endControl,s),i=xh(this.endControl,this.end,s),l=xh(a,n,s),o=xh(n,i,s),d=xh(l,o,s);return r?new t(this.start,a,l,d):new t(d,o,i,this.end)},t.prototype.add=function(s,r){return new t(this.start.add(s,r),this.startControl.add(s,r),this.endControl.add(s,r),this.end.add(s,r))},t.prototype.reverse=function(){return new t(this.end,this.endControl,this.startControl,this.start)},t})(),so=function(t){return t.type===1},eH=(function(){function t(s){var r=s.styles,a=s.bounds,n=GA(r.borderTopLeftRadius,a.width,a.height),i=n[0],l=n[1],o=GA(r.borderTopRightRadius,a.width,a.height),d=o[0],u=o[1],c=GA(r.borderBottomRightRadius,a.width,a.height),h=c[0],m=c[1],p=GA(r.borderBottomLeftRadius,a.width,a.height),g=p[0],x=p[1],b=[];b.push((i+d)/a.width),b.push((g+h)/a.width),b.push((l+x)/a.height),b.push((u+m)/a.height);var y=Math.max.apply(Math,b);y>1&&(i/=y,l/=y,d/=y,u/=y,h/=y,m/=y,g/=y,x/=y);var j=a.width-d,N=a.height-m,_=a.width-h,F=a.height-x,I=r.borderTopWidth,w=r.borderRightWidth,E=r.borderBottomWidth,W=r.borderLeftWidth,R=ra(r.paddingTop,s.bounds.width),U=ra(r.paddingRight,s.bounds.width),T=ra(r.paddingBottom,s.bounds.width),Y=ra(r.paddingLeft,s.bounds.width);this.topLeftBorderDoubleOuterBox=i>0||l>0?ga(a.left+W/3,a.top+I/3,i-W/3,l-I/3,Mr.TOP_LEFT):new Ss(a.left+W/3,a.top+I/3),this.topRightBorderDoubleOuterBox=i>0||l>0?ga(a.left+j,a.top+I/3,d-w/3,u-I/3,Mr.TOP_RIGHT):new Ss(a.left+a.width-w/3,a.top+I/3),this.bottomRightBorderDoubleOuterBox=h>0||m>0?ga(a.left+_,a.top+N,h-w/3,m-E/3,Mr.BOTTOM_RIGHT):new Ss(a.left+a.width-w/3,a.top+a.height-E/3),this.bottomLeftBorderDoubleOuterBox=g>0||x>0?ga(a.left+W/3,a.top+F,g-W/3,x-E/3,Mr.BOTTOM_LEFT):new Ss(a.left+W/3,a.top+a.height-E/3),this.topLeftBorderDoubleInnerBox=i>0||l>0?ga(a.left+W*2/3,a.top+I*2/3,i-W*2/3,l-I*2/3,Mr.TOP_LEFT):new Ss(a.left+W*2/3,a.top+I*2/3),this.topRightBorderDoubleInnerBox=i>0||l>0?ga(a.left+j,a.top+I*2/3,d-w*2/3,u-I*2/3,Mr.TOP_RIGHT):new Ss(a.left+a.width-w*2/3,a.top+I*2/3),this.bottomRightBorderDoubleInnerBox=h>0||m>0?ga(a.left+_,a.top+N,h-w*2/3,m-E*2/3,Mr.BOTTOM_RIGHT):new Ss(a.left+a.width-w*2/3,a.top+a.height-E*2/3),this.bottomLeftBorderDoubleInnerBox=g>0||x>0?ga(a.left+W*2/3,a.top+F,g-W*2/3,x-E*2/3,Mr.BOTTOM_LEFT):new Ss(a.left+W*2/3,a.top+a.height-E*2/3),this.topLeftBorderStroke=i>0||l>0?ga(a.left+W/2,a.top+I/2,i-W/2,l-I/2,Mr.TOP_LEFT):new Ss(a.left+W/2,a.top+I/2),this.topRightBorderStroke=i>0||l>0?ga(a.left+j,a.top+I/2,d-w/2,u-I/2,Mr.TOP_RIGHT):new Ss(a.left+a.width-w/2,a.top+I/2),this.bottomRightBorderStroke=h>0||m>0?ga(a.left+_,a.top+N,h-w/2,m-E/2,Mr.BOTTOM_RIGHT):new Ss(a.left+a.width-w/2,a.top+a.height-E/2),this.bottomLeftBorderStroke=g>0||x>0?ga(a.left+W/2,a.top+F,g-W/2,x-E/2,Mr.BOTTOM_LEFT):new Ss(a.left+W/2,a.top+a.height-E/2),this.topLeftBorderBox=i>0||l>0?ga(a.left,a.top,i,l,Mr.TOP_LEFT):new Ss(a.left,a.top),this.topRightBorderBox=d>0||u>0?ga(a.left+j,a.top,d,u,Mr.TOP_RIGHT):new Ss(a.left+a.width,a.top),this.bottomRightBorderBox=h>0||m>0?ga(a.left+_,a.top+N,h,m,Mr.BOTTOM_RIGHT):new Ss(a.left+a.width,a.top+a.height),this.bottomLeftBorderBox=g>0||x>0?ga(a.left,a.top+F,g,x,Mr.BOTTOM_LEFT):new Ss(a.left,a.top+a.height),this.topLeftPaddingBox=i>0||l>0?ga(a.left+W,a.top+I,Math.max(0,i-W),Math.max(0,l-I),Mr.TOP_LEFT):new Ss(a.left+W,a.top+I),this.topRightPaddingBox=d>0||u>0?ga(a.left+Math.min(j,a.width-w),a.top+I,j>a.width+w?0:Math.max(0,d-w),Math.max(0,u-I),Mr.TOP_RIGHT):new Ss(a.left+a.width-w,a.top+I),this.bottomRightPaddingBox=h>0||m>0?ga(a.left+Math.min(_,a.width-W),a.top+Math.min(N,a.height-E),Math.max(0,h-w),Math.max(0,m-E),Mr.BOTTOM_RIGHT):new Ss(a.left+a.width-w,a.top+a.height-E),this.bottomLeftPaddingBox=g>0||x>0?ga(a.left+W,a.top+Math.min(F,a.height-E),Math.max(0,g-W),Math.max(0,x-E),Mr.BOTTOM_LEFT):new Ss(a.left+W,a.top+a.height-E),this.topLeftContentBox=i>0||l>0?ga(a.left+W+Y,a.top+I+R,Math.max(0,i-(W+Y)),Math.max(0,l-(I+R)),Mr.TOP_LEFT):new Ss(a.left+W+Y,a.top+I+R),this.topRightContentBox=d>0||u>0?ga(a.left+Math.min(j,a.width+W+Y),a.top+I+R,j>a.width+W+Y?0:d-W+Y,u-(I+R),Mr.TOP_RIGHT):new Ss(a.left+a.width-(w+U),a.top+I+R),this.bottomRightContentBox=h>0||m>0?ga(a.left+Math.min(_,a.width-(W+Y)),a.top+Math.min(N,a.height+I+R),Math.max(0,h-(w+U)),m-(E+T),Mr.BOTTOM_RIGHT):new Ss(a.left+a.width-(w+U),a.top+a.height-(E+T)),this.bottomLeftContentBox=g>0||x>0?ga(a.left+W+Y,a.top+F,Math.max(0,g-(W+Y)),x-(E+T),Mr.BOTTOM_LEFT):new Ss(a.left+W+Y,a.top+a.height-(E+T))}return t})(),Mr;(function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP_RIGHT=1]="TOP_RIGHT",t[t.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",t[t.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(Mr||(Mr={}));var ga=function(t,s,r,a,n){var i=4*((Math.sqrt(2)-1)/3),l=r*i,o=a*i,d=t+r,u=s+a;switch(n){case Mr.TOP_LEFT:return new wx(new Ss(t,u),new Ss(t,u-o),new Ss(d-l,s),new Ss(d,s));case Mr.TOP_RIGHT:return new wx(new Ss(t,s),new Ss(t+l,s),new Ss(d,u-o),new Ss(d,u));case Mr.BOTTOM_RIGHT:return new wx(new Ss(d,s),new Ss(d,s+o),new Ss(t+l,u),new Ss(t,u));case Mr.BOTTOM_LEFT:default:return new wx(new Ss(d,u),new Ss(d-l,u),new Ss(t,s+o),new Ss(t,s))}},T0=function(t){return[t.topLeftBorderBox,t.topRightBorderBox,t.bottomRightBorderBox,t.bottomLeftBorderBox]},tH=function(t){return[t.topLeftContentBox,t.topRightContentBox,t.bottomRightContentBox,t.bottomLeftContentBox]},I0=function(t){return[t.topLeftPaddingBox,t.topRightPaddingBox,t.bottomRightPaddingBox,t.bottomLeftPaddingBox]},sH=(function(){function t(s,r,a){this.offsetX=s,this.offsetY=r,this.matrix=a,this.type=0,this.target=6}return t})(),_x=(function(){function t(s,r){this.path=s,this.target=r,this.type=1}return t})(),rH=(function(){function t(s){this.opacity=s,this.type=2,this.target=6}return t})(),aH=function(t){return t.type===0},W4=function(t){return t.type===1},nH=function(t){return t.type===2},H2=function(t,s){return t.length===s.length?t.some(function(r,a){return r===s[a]}):!1},iH=function(t,s,r,a,n){return t.map(function(i,l){switch(l){case 0:return i.add(s,r);case 1:return i.add(s+a,r);case 2:return i.add(s+a,r+n);case 3:return i.add(s,r+n)}return i})},G4=(function(){function t(s){this.element=s,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return t})(),K4=(function(){function t(s,r){if(this.container=s,this.parent=r,this.effects=[],this.curves=new eH(this.container),this.container.styles.opacity<1&&this.effects.push(new rH(this.container.styles.opacity)),this.container.styles.transform!==null){var a=this.container.bounds.left+this.container.styles.transformOrigin[0].number,n=this.container.bounds.top+this.container.styles.transformOrigin[1].number,i=this.container.styles.transform;this.effects.push(new sH(a,n,i))}if(this.container.styles.overflowX!==0){var l=T0(this.curves),o=I0(this.curves);H2(l,o)?this.effects.push(new _x(l,6)):(this.effects.push(new _x(l,2)),this.effects.push(new _x(o,4)))}}return t.prototype.getEffects=function(s){for(var r=[2,3].indexOf(this.container.styles.position)===-1,a=this.parent,n=this.effects.slice(0);a;){var i=a.effects.filter(function(d){return!W4(d)});if(r||a.container.styles.position!==0||!a.parent){if(n.unshift.apply(n,i),r=[2,3].indexOf(a.container.styles.position)===-1,a.container.styles.overflowX!==0){var l=T0(a.curves),o=I0(a.curves);H2(l,o)||n.unshift(new _x(o,6))}}else n.unshift.apply(n,i);a=a.parent}return n.filter(function(d){return An(d.target,s)})},t})(),cj=function(t,s,r,a){t.container.elements.forEach(function(n){var i=An(n.flags,4),l=An(n.flags,2),o=new K4(n,t);An(n.styles.display,2048)&&a.push(o);var d=An(n.flags,8)?[]:a;if(i||l){var u=i||n.styles.isPositioned()?r:s,c=new G4(o);if(n.styles.isPositioned()||n.styles.opacity<1||n.styles.isTransformed()){var h=n.styles.zIndex.order;if(h<0){var m=0;u.negativeZIndex.some(function(g,x){return h>g.element.container.styles.zIndex.order?(m=x,!1):m>0}),u.negativeZIndex.splice(m,0,c)}else if(h>0){var p=0;u.positiveZIndex.some(function(g,x){return h>=g.element.container.styles.zIndex.order?(p=x+1,!1):p>0}),u.positiveZIndex.splice(p,0,c)}else u.zeroOrAutoZIndexOrTransformedOrOpacity.push(c)}else n.styles.isFloating()?u.nonPositionedFloats.push(c):u.nonPositionedInlineLevel.push(c);cj(o,c,i?c:r,d)}else n.styles.isInlineLevel()?s.inlineLevel.push(o):s.nonInlineLevel.push(o),cj(o,s,r,d);An(n.flags,8)&&z4(n,d)})},z4=function(t,s){for(var r=t instanceof aj?t.start:1,a=t instanceof aj?t.reversed:!1,n=0;n<s.length;n++){var i=s[n];i.container instanceof T4&&typeof i.container.value=="number"&&i.container.value!==0&&(r=i.container.value),i.listValue=Ef(r,i.container.styles.listStyleType,!0),r+=a?-1:1}},lH=function(t){var s=new K4(t,null),r=new G4(s),a=[];return cj(s,r,r,a),z4(s.container,a),r},q2=function(t,s){switch(s){case 0:return ao(t.topLeftBorderBox,t.topLeftPaddingBox,t.topRightBorderBox,t.topRightPaddingBox);case 1:return ao(t.topRightBorderBox,t.topRightPaddingBox,t.bottomRightBorderBox,t.bottomRightPaddingBox);case 2:return ao(t.bottomRightBorderBox,t.bottomRightPaddingBox,t.bottomLeftBorderBox,t.bottomLeftPaddingBox);case 3:default:return ao(t.bottomLeftBorderBox,t.bottomLeftPaddingBox,t.topLeftBorderBox,t.topLeftPaddingBox)}},oH=function(t,s){switch(s){case 0:return ao(t.topLeftBorderBox,t.topLeftBorderDoubleOuterBox,t.topRightBorderBox,t.topRightBorderDoubleOuterBox);case 1:return ao(t.topRightBorderBox,t.topRightBorderDoubleOuterBox,t.bottomRightBorderBox,t.bottomRightBorderDoubleOuterBox);case 2:return ao(t.bottomRightBorderBox,t.bottomRightBorderDoubleOuterBox,t.bottomLeftBorderBox,t.bottomLeftBorderDoubleOuterBox);case 3:default:return ao(t.bottomLeftBorderBox,t.bottomLeftBorderDoubleOuterBox,t.topLeftBorderBox,t.topLeftBorderDoubleOuterBox)}},cH=function(t,s){switch(s){case 0:return ao(t.topLeftBorderDoubleInnerBox,t.topLeftPaddingBox,t.topRightBorderDoubleInnerBox,t.topRightPaddingBox);case 1:return ao(t.topRightBorderDoubleInnerBox,t.topRightPaddingBox,t.bottomRightBorderDoubleInnerBox,t.bottomRightPaddingBox);case 2:return ao(t.bottomRightBorderDoubleInnerBox,t.bottomRightPaddingBox,t.bottomLeftBorderDoubleInnerBox,t.bottomLeftPaddingBox);case 3:default:return ao(t.bottomLeftBorderDoubleInnerBox,t.bottomLeftPaddingBox,t.topLeftBorderDoubleInnerBox,t.topLeftPaddingBox)}},dH=function(t,s){switch(s){case 0:return Sx(t.topLeftBorderStroke,t.topRightBorderStroke);case 1:return Sx(t.topRightBorderStroke,t.bottomRightBorderStroke);case 2:return Sx(t.bottomRightBorderStroke,t.bottomLeftBorderStroke);case 3:default:return Sx(t.bottomLeftBorderStroke,t.topLeftBorderStroke)}},Sx=function(t,s){var r=[];return so(t)?r.push(t.subdivide(.5,!1)):r.push(t),so(s)?r.push(s.subdivide(.5,!0)):r.push(s),r},ao=function(t,s,r,a){var n=[];return so(t)?n.push(t.subdivide(.5,!1)):n.push(t),so(r)?n.push(r.subdivide(.5,!0)):n.push(r),so(a)?n.push(a.subdivide(.5,!0).reverse()):n.push(a),so(s)?n.push(s.subdivide(.5,!1).reverse()):n.push(s),n},Y4=function(t){var s=t.bounds,r=t.styles;return s.add(r.borderLeftWidth,r.borderTopWidth,-(r.borderRightWidth+r.borderLeftWidth),-(r.borderTopWidth+r.borderBottomWidth))},L0=function(t){var s=t.styles,r=t.bounds,a=ra(s.paddingLeft,r.width),n=ra(s.paddingRight,r.width),i=ra(s.paddingTop,r.width),l=ra(s.paddingBottom,r.width);return r.add(a+s.borderLeftWidth,i+s.borderTopWidth,-(s.borderRightWidth+s.borderLeftWidth+a+n),-(s.borderTopWidth+s.borderBottomWidth+i+l))},uH=function(t,s){return t===0?s.bounds:t===2?L0(s):Y4(s)},mH=function(t,s){return t===0?s.bounds:t===2?L0(s):Y4(s)},Bb=function(t,s,r){var a=uH(Sh(t.styles.backgroundOrigin,s),t),n=mH(Sh(t.styles.backgroundClip,s),t),i=hH(Sh(t.styles.backgroundSize,s),r,a),l=i[0],o=i[1],d=GA(Sh(t.styles.backgroundPosition,s),a.width-l,a.height-o),u=AH(Sh(t.styles.backgroundRepeat,s),d,i,a,n),c=Math.round(a.left+d[0]),h=Math.round(a.top+d[1]);return[u,c,h,l,o]},gh=function(t){return Yr(t)&&t.value===Uh.AUTO},Cx=function(t){return typeof t=="number"},hH=function(t,s,r){var a=s[0],n=s[1],i=s[2],l=t[0],o=t[1];if(!l)return[0,0];if(ln(l)&&o&&ln(o))return[ra(l,r.width),ra(o,r.height)];var d=Cx(i);if(Yr(l)&&(l.value===Uh.CONTAIN||l.value===Uh.COVER)){if(Cx(i)){var u=r.width/r.height;return u<i!=(l.value===Uh.COVER)?[r.width,r.width/i]:[r.height*i,r.height]}return[r.width,r.height]}var c=Cx(a),h=Cx(n),m=c||h;if(gh(l)&&(!o||gh(o))){if(c&&h)return[a,n];if(!d&&!m)return[r.width,r.height];if(m&&d){var p=c?a:n*i,g=h?n:a/i;return[p,g]}var x=c?a:r.width,b=h?n:r.height;return[x,b]}if(d){var y=0,j=0;return ln(l)?y=ra(l,r.width):ln(o)&&(j=ra(o,r.height)),gh(l)?y=j*i:(!o||gh(o))&&(j=y/i),[y,j]}var N=null,_=null;if(ln(l)?N=ra(l,r.width):o&&ln(o)&&(_=ra(o,r.height)),N!==null&&(!o||gh(o))&&(_=c&&h?N/a*n:r.height),_!==null&&gh(l)&&(N=c&&h?_/n*a:r.width),N!==null&&_!==null)return[N,_];throw new Error("Unable to calculate background-size for element")},Sh=function(t,s){var r=t[s];return typeof r>"u"?t[0]:r},AH=function(t,s,r,a,n){var i=s[0],l=s[1],o=r[0],d=r[1];switch(t){case 2:return[new Ss(Math.round(a.left),Math.round(a.top+l)),new Ss(Math.round(a.left+a.width),Math.round(a.top+l)),new Ss(Math.round(a.left+a.width),Math.round(d+a.top+l)),new Ss(Math.round(a.left),Math.round(d+a.top+l))];case 3:return[new Ss(Math.round(a.left+i),Math.round(a.top)),new Ss(Math.round(a.left+i+o),Math.round(a.top)),new Ss(Math.round(a.left+i+o),Math.round(a.height+a.top)),new Ss(Math.round(a.left+i),Math.round(a.height+a.top))];case 1:return[new Ss(Math.round(a.left+i),Math.round(a.top+l)),new Ss(Math.round(a.left+i+o),Math.round(a.top+l)),new Ss(Math.round(a.left+i+o),Math.round(a.top+l+d)),new Ss(Math.round(a.left+i),Math.round(a.top+l+d))];default:return[new Ss(Math.round(n.left),Math.round(n.top)),new Ss(Math.round(n.left+n.width),Math.round(n.top)),new Ss(Math.round(n.left+n.width),Math.round(n.height+n.top)),new Ss(Math.round(n.left),Math.round(n.height+n.top))]}},fH="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",$2="Hidden Text",pH=(function(){function t(s){this._data={},this._document=s}return t.prototype.parseMetrics=function(s,r){var a=this._document.createElement("div"),n=this._document.createElement("img"),i=this._document.createElement("span"),l=this._document.body;a.style.visibility="hidden",a.style.fontFamily=s,a.style.fontSize=r,a.style.margin="0",a.style.padding="0",a.style.whiteSpace="nowrap",l.appendChild(a),n.src=fH,n.width=1,n.height=1,n.style.margin="0",n.style.padding="0",n.style.verticalAlign="baseline",i.style.fontFamily=s,i.style.fontSize=r,i.style.margin="0",i.style.padding="0",i.appendChild(this._document.createTextNode($2)),a.appendChild(i),a.appendChild(n);var o=n.offsetTop-i.offsetTop+2;a.removeChild(i),a.appendChild(this._document.createTextNode($2)),a.style.lineHeight="normal",n.style.verticalAlign="super";var d=n.offsetTop-a.offsetTop+2;return l.removeChild(a),{baseline:o,middle:d}},t.prototype.getMetrics=function(s,r){var a=s+" "+r;return typeof this._data[a]>"u"&&(this._data[a]=this.parseMetrics(s,r)),this._data[a]},t})(),X4=(function(){function t(s,r){this.context=s,this.options=r}return t})(),xH=1e4,gH=(function(t){Xo(s,t);function s(r,a){var n=t.call(this,r,a)||this;return n._activeEffects=[],n.canvas=a.canvas?a.canvas:document.createElement("canvas"),n.ctx=n.canvas.getContext("2d"),a.canvas||(n.canvas.width=Math.floor(a.width*a.scale),n.canvas.height=Math.floor(a.height*a.scale),n.canvas.style.width=a.width+"px",n.canvas.style.height=a.height+"px"),n.fontMetrics=new pH(document),n.ctx.scale(n.options.scale,n.options.scale),n.ctx.translate(-a.x,-a.y),n.ctx.textBaseline="bottom",n._activeEffects=[],n.context.logger.debug("Canvas renderer initialized ("+a.width+"x"+a.height+") with scale "+a.scale),n}return s.prototype.applyEffects=function(r){for(var a=this;this._activeEffects.length;)this.popEffect();r.forEach(function(n){return a.applyEffect(n)})},s.prototype.applyEffect=function(r){this.ctx.save(),nH(r)&&(this.ctx.globalAlpha=r.opacity),aH(r)&&(this.ctx.translate(r.offsetX,r.offsetY),this.ctx.transform(r.matrix[0],r.matrix[1],r.matrix[2],r.matrix[3],r.matrix[4],r.matrix[5]),this.ctx.translate(-r.offsetX,-r.offsetY)),W4(r)&&(this.path(r.path),this.ctx.clip()),this._activeEffects.push(r)},s.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},s.prototype.renderStack=function(r){return Ri(this,void 0,void 0,function(){var a;return fi(this,function(n){switch(n.label){case 0:return a=r.element.container.styles,a.isVisible()?[4,this.renderStackContent(r)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})})},s.prototype.renderNode=function(r){return Ri(this,void 0,void 0,function(){return fi(this,function(a){switch(a.label){case 0:if(An(r.container.flags,16))debugger;return r.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(r)]:[3,3];case 1:return a.sent(),[4,this.renderNodeContent(r)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},s.prototype.renderTextWithLetterSpacing=function(r,a,n){var i=this;if(a===0)this.ctx.fillText(r.text,r.bounds.left,r.bounds.top+n);else{var l=sN(r.text);l.reduce(function(o,d){return i.ctx.fillText(d,o,r.bounds.top+n),o+i.ctx.measureText(d).width},r.bounds.left)}},s.prototype.createFontStyle=function(r){var a=r.fontVariant.filter(function(l){return l==="normal"||l==="small-caps"}).join(""),n=NH(r.fontFamily).join(", "),i=sp(r.fontSize)?""+r.fontSize.number+r.fontSize.unit:r.fontSize.number+"px";return[[r.fontStyle,a,r.fontWeight,i,n].join(" "),n,i]},s.prototype.renderTextNode=function(r,a){return Ri(this,void 0,void 0,function(){var n,i,l,o,d,u,c,h,m=this;return fi(this,function(p){return n=this.createFontStyle(a),i=n[0],l=n[1],o=n[2],this.ctx.font=i,this.ctx.direction=a.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",d=this.fontMetrics.getMetrics(l,o),u=d.baseline,c=d.middle,h=a.paintOrder,r.textBounds.forEach(function(g){h.forEach(function(x){switch(x){case 0:m.ctx.fillStyle=Cn(a.color),m.renderTextWithLetterSpacing(g,a.letterSpacing,u);var b=a.textShadow;b.length&&g.text.trim().length&&(b.slice(0).reverse().forEach(function(y){m.ctx.shadowColor=Cn(y.color),m.ctx.shadowOffsetX=y.offsetX.number*m.options.scale,m.ctx.shadowOffsetY=y.offsetY.number*m.options.scale,m.ctx.shadowBlur=y.blur.number,m.renderTextWithLetterSpacing(g,a.letterSpacing,u)}),m.ctx.shadowColor="",m.ctx.shadowOffsetX=0,m.ctx.shadowOffsetY=0,m.ctx.shadowBlur=0),a.textDecorationLine.length&&(m.ctx.fillStyle=Cn(a.textDecorationColor||a.color),a.textDecorationLine.forEach(function(y){switch(y){case 1:m.ctx.fillRect(g.bounds.left,Math.round(g.bounds.top+u),g.bounds.width,1);break;case 2:m.ctx.fillRect(g.bounds.left,Math.round(g.bounds.top),g.bounds.width,1);break;case 3:m.ctx.fillRect(g.bounds.left,Math.ceil(g.bounds.top+c),g.bounds.width,1);break}}));break;case 1:a.webkitTextStrokeWidth&&g.text.trim().length&&(m.ctx.strokeStyle=Cn(a.webkitTextStrokeColor),m.ctx.lineWidth=a.webkitTextStrokeWidth,m.ctx.lineJoin=window.chrome?"miter":"round",m.ctx.strokeText(g.text,g.bounds.left,g.bounds.top+u)),m.ctx.strokeStyle="",m.ctx.lineWidth=0,m.ctx.lineJoin="miter";break}})}),[2]})})},s.prototype.renderReplacedElement=function(r,a,n){if(n&&r.intrinsicWidth>0&&r.intrinsicHeight>0){var i=L0(r),l=I0(a);this.path(l),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(n,0,0,r.intrinsicWidth,r.intrinsicHeight,i.left,i.top,i.width,i.height),this.ctx.restore()}},s.prototype.renderNodeContent=function(r){return Ri(this,void 0,void 0,function(){var a,n,i,l,o,d,j,j,u,c,h,m,_,p,g,F,x,b,y,j,N,_,F;return fi(this,function(I){switch(I.label){case 0:this.applyEffects(r.getEffects(4)),a=r.container,n=r.curves,i=a.styles,l=0,o=a.textNodes,I.label=1;case 1:return l<o.length?(d=o[l],[4,this.renderTextNode(d,i)]):[3,4];case 2:I.sent(),I.label=3;case 3:return l++,[3,1];case 4:if(!(a instanceof E4))return[3,8];I.label=5;case 5:return I.trys.push([5,7,,8]),[4,this.context.cache.match(a.src)];case 6:return j=I.sent(),this.renderReplacedElement(a,n,j),[3,8];case 7:return I.sent(),this.context.logger.error("Error loading image "+a.src),[3,8];case 8:if(a instanceof B4&&this.renderReplacedElement(a,n,a.canvas),!(a instanceof F4))return[3,12];I.label=9;case 9:return I.trys.push([9,11,,12]),[4,this.context.cache.match(a.svg)];case 10:return j=I.sent(),this.renderReplacedElement(a,n,j),[3,12];case 11:return I.sent(),this.context.logger.error("Error loading svg "+a.svg.substring(0,255)),[3,12];case 12:return a instanceof D4&&a.tree?(u=new s(this.context,{scale:this.options.scale,backgroundColor:a.backgroundColor,x:0,y:0,width:a.width,height:a.height}),[4,u.render(a.tree)]):[3,14];case 13:c=I.sent(),a.width&&a.height&&this.ctx.drawImage(c,0,0,a.width,a.height,a.bounds.left,a.bounds.top,a.bounds.width,a.bounds.height),I.label=14;case 14:if(a instanceof rN&&(h=Math.min(a.bounds.width,a.bounds.height),a.type===k0?a.checked&&(this.ctx.save(),this.path([new Ss(a.bounds.left+h*.39363,a.bounds.top+h*.79),new Ss(a.bounds.left+h*.16,a.bounds.top+h*.5549),new Ss(a.bounds.left+h*.27347,a.bounds.top+h*.44071),new Ss(a.bounds.left+h*.39694,a.bounds.top+h*.5649),new Ss(a.bounds.left+h*.72983,a.bounds.top+h*.23),new Ss(a.bounds.left+h*.84,a.bounds.top+h*.34085),new Ss(a.bounds.left+h*.39363,a.bounds.top+h*.79)]),this.ctx.fillStyle=Cn(F2),this.ctx.fill(),this.ctx.restore()):a.type===E0&&a.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(a.bounds.left+h/2,a.bounds.top+h/2,h/4,0,Math.PI*2,!0),this.ctx.fillStyle=Cn(F2),this.ctx.fill(),this.ctx.restore())),vH(a)&&a.value.length){switch(m=this.createFontStyle(i),_=m[0],p=m[1],g=this.fontMetrics.getMetrics(_,p).baseline,this.ctx.font=_,this.ctx.fillStyle=Cn(i.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=yH(a.styles.textAlign),F=L0(a),x=0,a.styles.textAlign){case 1:x+=F.width/2;break;case 2:x+=F.width;break}b=F.add(x,0,0,-F.height/2+1),this.ctx.save(),this.path([new Ss(F.left,F.top),new Ss(F.left+F.width,F.top),new Ss(F.left+F.width,F.top+F.height),new Ss(F.left,F.top+F.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new of(a.value,b),i.letterSpacing,g),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!An(a.styles.display,2048))return[3,20];if(a.styles.listStyleImage===null)return[3,19];if(y=a.styles.listStyleImage,y.type!==0)return[3,18];j=void 0,N=y.url,I.label=15;case 15:return I.trys.push([15,17,,18]),[4,this.context.cache.match(N)];case 16:return j=I.sent(),this.ctx.drawImage(j,a.bounds.left-(j.width+10),a.bounds.top),[3,18];case 17:return I.sent(),this.context.logger.error("Error loading list-style-image "+N),[3,18];case 18:return[3,20];case 19:r.listValue&&a.styles.listStyleType!==-1&&(_=this.createFontStyle(i)[0],this.ctx.font=_,this.ctx.fillStyle=Cn(i.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",F=new vd(a.bounds.left,a.bounds.top+ra(a.styles.paddingTop,a.bounds.width),a.bounds.width,A2(i.lineHeight,i.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new of(r.listValue,F),i.letterSpacing,A2(i.lineHeight,i.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),I.label=20;case 20:return[2]}})})},s.prototype.renderStackContent=function(r){return Ri(this,void 0,void 0,function(){var a,n,y,i,l,y,o,d,y,u,c,y,h,m,y,p,g,y,x,b,y;return fi(this,function(j){switch(j.label){case 0:if(An(r.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(r.element)];case 1:j.sent(),a=0,n=r.negativeZIndex,j.label=2;case 2:return a<n.length?(y=n[a],[4,this.renderStack(y)]):[3,5];case 3:j.sent(),j.label=4;case 4:return a++,[3,2];case 5:return[4,this.renderNodeContent(r.element)];case 6:j.sent(),i=0,l=r.nonInlineLevel,j.label=7;case 7:return i<l.length?(y=l[i],[4,this.renderNode(y)]):[3,10];case 8:j.sent(),j.label=9;case 9:return i++,[3,7];case 10:o=0,d=r.nonPositionedFloats,j.label=11;case 11:return o<d.length?(y=d[o],[4,this.renderStack(y)]):[3,14];case 12:j.sent(),j.label=13;case 13:return o++,[3,11];case 14:u=0,c=r.nonPositionedInlineLevel,j.label=15;case 15:return u<c.length?(y=c[u],[4,this.renderStack(y)]):[3,18];case 16:j.sent(),j.label=17;case 17:return u++,[3,15];case 18:h=0,m=r.inlineLevel,j.label=19;case 19:return h<m.length?(y=m[h],[4,this.renderNode(y)]):[3,22];case 20:j.sent(),j.label=21;case 21:return h++,[3,19];case 22:p=0,g=r.zeroOrAutoZIndexOrTransformedOrOpacity,j.label=23;case 23:return p<g.length?(y=g[p],[4,this.renderStack(y)]):[3,26];case 24:j.sent(),j.label=25;case 25:return p++,[3,23];case 26:x=0,b=r.positiveZIndex,j.label=27;case 27:return x<b.length?(y=b[x],[4,this.renderStack(y)]):[3,30];case 28:j.sent(),j.label=29;case 29:return x++,[3,27];case 30:return[2]}})})},s.prototype.mask=function(r){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(r.slice(0).reverse()),this.ctx.closePath()},s.prototype.path=function(r){this.ctx.beginPath(),this.formatPath(r),this.ctx.closePath()},s.prototype.formatPath=function(r){var a=this;r.forEach(function(n,i){var l=so(n)?n.start:n;i===0?a.ctx.moveTo(l.x,l.y):a.ctx.lineTo(l.x,l.y),so(n)&&a.ctx.bezierCurveTo(n.startControl.x,n.startControl.y,n.endControl.x,n.endControl.y,n.end.x,n.end.y)})},s.prototype.renderRepeat=function(r,a,n,i){this.path(r),this.ctx.fillStyle=a,this.ctx.translate(n,i),this.ctx.fill(),this.ctx.translate(-n,-i)},s.prototype.resizeImage=function(r,a,n){var i;if(r.width===a&&r.height===n)return r;var l=(i=this.canvas.ownerDocument)!==null&&i!==void 0?i:document,o=l.createElement("canvas");o.width=Math.max(1,a),o.height=Math.max(1,n);var d=o.getContext("2d");return d.drawImage(r,0,0,r.width,r.height,0,0,a,n),o},s.prototype.renderBackgroundImage=function(r){return Ri(this,void 0,void 0,function(){var a,n,i,l,o,d;return fi(this,function(u){switch(u.label){case 0:a=r.styles.backgroundImage.length-1,n=function(c){var h,m,p,R,q,z,Y,H,E,g,R,q,z,Y,H,x,b,y,j,N,_,F,I,w,E,W,R,U,T,Y,H,M,q,z,Q,L,V,P,C,k,B,G;return fi(this,function(O){switch(O.label){case 0:if(c.type!==0)return[3,5];h=void 0,m=c.url,O.label=1;case 1:return O.trys.push([1,3,,4]),[4,i.context.cache.match(m)];case 2:return h=O.sent(),[3,4];case 3:return O.sent(),i.context.logger.error("Error loading background-image "+m),[3,4];case 4:return h&&(p=Bb(r,a,[h.width,h.height,h.width/h.height]),R=p[0],q=p[1],z=p[2],Y=p[3],H=p[4],E=i.ctx.createPattern(i.resizeImage(h,Y,H),"repeat"),i.renderRepeat(R,E,q,z)),[3,6];case 5:aM(c)?(g=Bb(r,a,[null,null,null]),R=g[0],q=g[1],z=g[2],Y=g[3],H=g[4],x=Z8(c.angle,Y,H),b=x[0],y=x[1],j=x[2],N=x[3],_=x[4],F=document.createElement("canvas"),F.width=Y,F.height=H,I=F.getContext("2d"),w=I.createLinearGradient(y,N,j,_),m2(c.stops,b).forEach(function(K){return w.addColorStop(K.stop,Cn(K.color))}),I.fillStyle=w,I.fillRect(0,0,Y,H),Y>0&&H>0&&(E=i.ctx.createPattern(F,"repeat"),i.renderRepeat(R,E,q,z))):nM(c)&&(W=Bb(r,a,[null,null,null]),R=W[0],U=W[1],T=W[2],Y=W[3],H=W[4],M=c.position.length===0?[Zj]:c.position,q=ra(M[0],Y),z=ra(M[M.length-1],H),Q=eM(c,q,z,Y,H),L=Q[0],V=Q[1],L>0&&V>0&&(P=i.ctx.createRadialGradient(U+q,T+z,0,U+q,T+z,L),m2(c.stops,L*2).forEach(function(K){return P.addColorStop(K.stop,Cn(K.color))}),i.path(R),i.ctx.fillStyle=P,L!==V?(C=r.bounds.left+.5*r.bounds.width,k=r.bounds.top+.5*r.bounds.height,B=V/L,G=1/B,i.ctx.save(),i.ctx.translate(C,k),i.ctx.transform(1,0,0,B,0,0),i.ctx.translate(-C,-k),i.ctx.fillRect(U,G*(T-k)+k,Y,H*G),i.ctx.restore()):i.ctx.fill())),O.label=6;case 6:return a--,[2]}})},i=this,l=0,o=r.styles.backgroundImage.slice(0).reverse(),u.label=1;case 1:return l<o.length?(d=o[l],[5,n(d)]):[3,4];case 2:u.sent(),u.label=3;case 3:return l++,[3,1];case 4:return[2]}})})},s.prototype.renderSolidBorder=function(r,a,n){return Ri(this,void 0,void 0,function(){return fi(this,function(i){return this.path(q2(n,a)),this.ctx.fillStyle=Cn(r),this.ctx.fill(),[2]})})},s.prototype.renderDoubleBorder=function(r,a,n,i){return Ri(this,void 0,void 0,function(){var l,o;return fi(this,function(d){switch(d.label){case 0:return a<3?[4,this.renderSolidBorder(r,n,i)]:[3,2];case 1:return d.sent(),[2];case 2:return l=oH(i,n),this.path(l),this.ctx.fillStyle=Cn(r),this.ctx.fill(),o=cH(i,n),this.path(o),this.ctx.fill(),[2]}})})},s.prototype.renderNodeBackgroundAndBorders=function(r){return Ri(this,void 0,void 0,function(){var a,n,i,l,o,d,u,c,h=this;return fi(this,function(m){switch(m.label){case 0:return this.applyEffects(r.getEffects(2)),a=r.container.styles,n=!wu(a.backgroundColor)||a.backgroundImage.length,i=[{style:a.borderTopStyle,color:a.borderTopColor,width:a.borderTopWidth},{style:a.borderRightStyle,color:a.borderRightColor,width:a.borderRightWidth},{style:a.borderBottomStyle,color:a.borderBottomColor,width:a.borderBottomWidth},{style:a.borderLeftStyle,color:a.borderLeftColor,width:a.borderLeftWidth}],l=bH(Sh(a.backgroundClip,0),r.curves),n||a.boxShadow.length?(this.ctx.save(),this.path(l),this.ctx.clip(),wu(a.backgroundColor)||(this.ctx.fillStyle=Cn(a.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(r.container)]):[3,2];case 1:m.sent(),this.ctx.restore(),a.boxShadow.slice(0).reverse().forEach(function(p){h.ctx.save();var g=T0(r.curves),x=p.inset?0:xH,b=iH(g,-x+(p.inset?1:-1)*p.spread.number,(p.inset?1:-1)*p.spread.number,p.spread.number*(p.inset?-2:2),p.spread.number*(p.inset?-2:2));p.inset?(h.path(g),h.ctx.clip(),h.mask(b)):(h.mask(g),h.ctx.clip(),h.path(b)),h.ctx.shadowOffsetX=p.offsetX.number+x,h.ctx.shadowOffsetY=p.offsetY.number,h.ctx.shadowColor=Cn(p.color),h.ctx.shadowBlur=p.blur.number,h.ctx.fillStyle=p.inset?Cn(p.color):"rgba(0,0,0,1)",h.ctx.fill(),h.ctx.restore()}),m.label=2;case 2:o=0,d=0,u=i,m.label=3;case 3:return d<u.length?(c=u[d],c.style!==0&&!wu(c.color)&&c.width>0?c.style!==2?[3,5]:[4,this.renderDashedDottedBorder(c.color,c.width,o,r.curves,2)]:[3,11]):[3,13];case 4:return m.sent(),[3,11];case 5:return c.style!==3?[3,7]:[4,this.renderDashedDottedBorder(c.color,c.width,o,r.curves,3)];case 6:return m.sent(),[3,11];case 7:return c.style!==4?[3,9]:[4,this.renderDoubleBorder(c.color,c.width,o,r.curves)];case 8:return m.sent(),[3,11];case 9:return[4,this.renderSolidBorder(c.color,o,r.curves)];case 10:m.sent(),m.label=11;case 11:o++,m.label=12;case 12:return d++,[3,3];case 13:return[2]}})})},s.prototype.renderDashedDottedBorder=function(r,a,n,i,l){return Ri(this,void 0,void 0,function(){var o,d,u,c,h,m,p,g,x,b,y,j,N,_,F,I,F,I;return fi(this,function(w){return this.ctx.save(),o=dH(i,n),d=q2(i,n),l===2&&(this.path(d),this.ctx.clip()),so(d[0])?(u=d[0].start.x,c=d[0].start.y):(u=d[0].x,c=d[0].y),so(d[1])?(h=d[1].end.x,m=d[1].end.y):(h=d[1].x,m=d[1].y),n===0||n===2?p=Math.abs(u-h):p=Math.abs(c-m),this.ctx.beginPath(),l===3?this.formatPath(o):this.formatPath(d.slice(0,2)),g=a<3?a*3:a*2,x=a<3?a*2:a,l===3&&(g=a,x=a),b=!0,p<=g*2?b=!1:p<=g*2+x?(y=p/(2*g+x),g*=y,x*=y):(j=Math.floor((p+x)/(g+x)),N=(p-j*g)/(j-1),_=(p-(j+1)*g)/j,x=_<=0||Math.abs(x-N)<Math.abs(x-_)?N:_),b&&(l===3?this.ctx.setLineDash([0,g+x]):this.ctx.setLineDash([g,x])),l===3?(this.ctx.lineCap="round",this.ctx.lineWidth=a):this.ctx.lineWidth=a*2+1.1,this.ctx.strokeStyle=Cn(r),this.ctx.stroke(),this.ctx.setLineDash([]),l===2&&(so(d[0])&&(F=d[3],I=d[0],this.ctx.beginPath(),this.formatPath([new Ss(F.end.x,F.end.y),new Ss(I.start.x,I.start.y)]),this.ctx.stroke()),so(d[1])&&(F=d[1],I=d[2],this.ctx.beginPath(),this.formatPath([new Ss(F.end.x,F.end.y),new Ss(I.start.x,I.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},s.prototype.render=function(r){return Ri(this,void 0,void 0,function(){var a;return fi(this,function(n){switch(n.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=Cn(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),a=lH(r),[4,this.renderStack(a)];case 1:return n.sent(),this.applyEffects([]),[2,this.canvas]}})})},s})(X4),vH=function(t){return t instanceof L4||t instanceof I4?!0:t instanceof rN&&t.type!==E0&&t.type!==k0},bH=function(t,s){switch(t){case 0:return T0(s);case 2:return tH(s);case 1:default:return I0(s)}},yH=function(t){switch(t){case 1:return"center";case 2:return"right";case 0:default:return"left"}},jH=["-apple-system","system-ui"],NH=function(t){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?t.filter(function(s){return jH.indexOf(s)===-1}):t},wH=(function(t){Xo(s,t);function s(r,a){var n=t.call(this,r,a)||this;return n.canvas=a.canvas?a.canvas:document.createElement("canvas"),n.ctx=n.canvas.getContext("2d"),n.options=a,n.canvas.width=Math.floor(a.width*a.scale),n.canvas.height=Math.floor(a.height*a.scale),n.canvas.style.width=a.width+"px",n.canvas.style.height=a.height+"px",n.ctx.scale(n.options.scale,n.options.scale),n.ctx.translate(-a.x,-a.y),n.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+a.width+"x"+a.height+" at "+a.x+","+a.y+") with scale "+a.scale),n}return s.prototype.render=function(r){return Ri(this,void 0,void 0,function(){var a,n;return fi(this,function(i){switch(i.label){case 0:return a=rj(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,r),[4,_H(a)];case 1:return n=i.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=Cn(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(n,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},s})(X4),_H=function(t){return new Promise(function(s,r){var a=new Image;a.onload=function(){s(a)},a.onerror=r,a.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(t))})},SH=(function(){function t(s){var r=s.id,a=s.enabled;this.id=r,this.enabled=a,this.start=Date.now()}return t.prototype.debug=function(){for(var s=[],r=0;r<arguments.length;r++)s[r]=arguments[r];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,nx([this.id,this.getTime()+"ms"],s)):this.info.apply(this,s))},t.prototype.getTime=function(){return Date.now()-this.start},t.prototype.info=function(){for(var s=[],r=0;r<arguments.length;r++)s[r]=arguments[r];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,nx([this.id,this.getTime()+"ms"],s))},t.prototype.warn=function(){for(var s=[],r=0;r<arguments.length;r++)s[r]=arguments[r];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,nx([this.id,this.getTime()+"ms"],s)):this.info.apply(this,s))},t.prototype.error=function(){for(var s=[],r=0;r<arguments.length;r++)s[r]=arguments[r];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,nx([this.id,this.getTime()+"ms"],s)):this.info.apply(this,s))},t.instances={},t})(),CH=(function(){function t(s,r){var a;this.windowBounds=r,this.instanceName="#"+t.instanceCount++,this.logger=new SH({id:this.instanceName,enabled:s.logging}),this.cache=(a=s.cache)!==null&&a!==void 0?a:new G7(this,s)}return t.instanceCount=1,t})(),wi=function(t,s){return s===void 0&&(s={}),kH(t,s)};typeof window<"u"&&V4.setContext(window);var kH=function(t,s){return Ri(void 0,void 0,void 0,function(){var r,a,n,i,l,o,d,u,c,h,m,p,g,x,b,y,j,N,_,F,w,I,w,E,W,R,U,T,Y,H,M,q,z,Q,L,V,P,C,k,B;return fi(this,function(G){switch(G.label){case 0:if(!t||typeof t!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(r=t.ownerDocument,!r)throw new Error("Element is not attached to a Document");if(a=r.defaultView,!a)throw new Error("Document is not attached to a Window");return n={allowTaint:(E=s.allowTaint)!==null&&E!==void 0?E:!1,imageTimeout:(W=s.imageTimeout)!==null&&W!==void 0?W:15e3,proxy:s.proxy,useCORS:(R=s.useCORS)!==null&&R!==void 0?R:!1},i=Hy({logging:(U=s.logging)!==null&&U!==void 0?U:!0,cache:s.cache},n),l={windowWidth:(T=s.windowWidth)!==null&&T!==void 0?T:a.innerWidth,windowHeight:(Y=s.windowHeight)!==null&&Y!==void 0?Y:a.innerHeight,scrollX:(H=s.scrollX)!==null&&H!==void 0?H:a.pageXOffset,scrollY:(M=s.scrollY)!==null&&M!==void 0?M:a.pageYOffset},o=new vd(l.scrollX,l.scrollY,l.windowWidth,l.windowHeight),d=new CH(i,o),u=(q=s.foreignObjectRendering)!==null&&q!==void 0?q:!1,c={allowTaint:(z=s.allowTaint)!==null&&z!==void 0?z:!1,onclone:s.onclone,ignoreElements:s.ignoreElements,inlineImages:u,copyStyles:u},d.logger.debug("Starting document clone with size "+o.width+"x"+o.height+" scrolled to "+-o.left+","+-o.top),h=new M2(d,t,c),m=h.clonedReferenceElement,m?[4,h.toIFrame(r,o)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return p=G.sent(),g=aN(m)||B7(m)?iO(m.ownerDocument):vg(d,m),x=g.width,b=g.height,y=g.left,j=g.top,N=EH(d,m,s.backgroundColor),_={canvas:s.canvas,backgroundColor:N,scale:(L=(Q=s.scale)!==null&&Q!==void 0?Q:a.devicePixelRatio)!==null&&L!==void 0?L:1,x:((V=s.x)!==null&&V!==void 0?V:0)+y,y:((P=s.y)!==null&&P!==void 0?P:0)+j,width:(C=s.width)!==null&&C!==void 0?C:Math.ceil(x),height:(k=s.height)!==null&&k!==void 0?k:Math.ceil(b)},u?(d.logger.debug("Document cloned, using foreign object rendering"),w=new wH(d,_),[4,w.render(m)]):[3,3];case 2:return F=G.sent(),[3,5];case 3:return d.logger.debug("Document cloned, element located at "+y+","+j+" with size "+x+"x"+b+" using computed rendering"),d.logger.debug("Starting DOM parsing"),I=U4(d,m),N===I.styles.backgroundColor&&(I.styles.backgroundColor=hd.TRANSPARENT),d.logger.debug("Starting renderer for element at "+_.x+","+_.y+" with size "+_.width+"x"+_.height),w=new gH(d,_),[4,w.render(I)];case 4:F=G.sent(),G.label=5;case 5:return(!((B=s.removeContainer)!==null&&B!==void 0)||B)&&(M2.destroy(p)||d.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),d.logger.debug("Finished rendering"),[2,F]}})})},EH=function(t,s,r){var a=s.ownerDocument,n=a.documentElement?nf(t,getComputedStyle(a.documentElement).backgroundColor):hd.TRANSPARENT,i=a.body?nf(t,getComputedStyle(a.body).backgroundColor):hd.TRANSPARENT,l=typeof r=="string"?nf(t,r):r===null?hd.TRANSPARENT:4294967295;return s===a.documentElement?wu(n)?wu(i)?l:i:n:l};const BH=Object.freeze(Object.defineProperty({__proto__:null,default:wi},Symbol.toStringTag,{value:"Module"}));function FH(){const t=ps(),{canPerformAction:s}=Ls(),[r,a]=f.useState([]),[n,i]=f.useState(!0),[l,o]=f.useState(""),[d,u]=f.useState(""),[c,h]=f.useState("ALL"),[m,p]=f.useState({name:"",address:"",city:"",state:"",country:"",postalCode:"",phone:"",email:"",website:"",taxId:"",registrationNo:"",logoUrl:""});f.useEffect(()=>{g()},[]);const g=async()=>{var R,U,T;try{i(!0),o("");const Y=await Z.get("/sales/quotations"),H=Y.data&&Y.data.data&&Y.data.data.items||((R=Y.data)==null?void 0:R.items)||[];a(Array.isArray(H)?H:[])}catch(Y){o(((T=(U=Y==null?void 0:Y.response)==null?void 0:U.data)==null?void 0:T.message)||"Error fetching quotations"),console.error("Error fetching quotations:",Y)}finally{i(!1)}};f.useEffect(()=>{let R=!0;async function U(){var T,Y,H;try{const q=(Y=(T=(await Z.get("/admin/me")).data)==null?void 0:T.scope)==null?void 0:Y.companyId;if(!q)return;const Q=((H=(await Z.get(`/admin/companies/${q}`)).data)==null?void 0:H.item)||{},L=Q.has_logo===1||Q.has_logo===!0?`/api/admin/companies/${q}/logo`:"";if(!R)return;p({name:Q.name||"Company",address:Q.address||"",city:Q.city||"",state:Q.state||"",country:Q.country||"",postalCode:Q.postal_code||"",phone:Q.telephone||"",email:Q.email||"",website:Q.website||"",taxId:Q.tax_id||"",registrationNo:Q.registration_no||"",logoUrl:String(L||"")})}catch{}}return U(),()=>{R=!1}},[]);function x(R){return String(R??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function b(R){return`<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Quotation</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 16px; color: #0f172a; }
      table { border-collapse: collapse; width: 100%; }
      th, td { border: 1px solid #e2e8f0; padding: 6px 8px; vertical-align: top; }
      th { background: #f8fafc; text-align: left; }
    </style>
  </head>
  <body>${R||""}</body>
</html>`}async function y(R){var T;const U=Array.from(((T=R==null?void 0:R.querySelectorAll)==null?void 0:T.call(R,"img"))||[]);U.length&&await Promise.all(U.map(Y=>new Promise(H=>{if(Y.complete)return H();const M=()=>H();Y.addEventListener("load",M,{once:!0}),Y.addEventListener("error",M,{once:!0})})))}const j=(R,U)=>{const T=String(m.logoUrl||"").trim(),Y=T?`<img src="${T}" alt="${x(m.name||"Company")}" style="max-height:80px;object-fit:contain;" />`:"",H=(Array.isArray(U)?U:[]).map(Q=>{const L=Number(Q.qty??Q.quantity??0),V=Number(Q.unit_price??0),P=Number(Q.discount_percent??0),C=Number(Q.net_amount??L*V-L*V*P/100);return{item_name:String(Q.item_name||""),qty:L.toFixed(2),unit_price:V.toFixed(2),discount:P.toFixed(2),net:C.toFixed(2)}}),M=H.reduce((Q,L)=>Q+Number(L.qty)*Number(L.unit_price),0),q=H.reduce((Q,L)=>Q+Number(L.qty)*Number(L.unit_price)*Number(L.discount)/100,0),z=M-q;return{company:{name:m.name||"",address:m.address||"",city:m.city||"",state:m.state||"",country:m.country||"",postalCode:m.postalCode||"",phone:m.phone||"",email:m.email||"",website:m.website||"",taxId:m.taxId||"",registrationNo:m.registrationNo||"",logoUrl:T,logoHtml:Y},quotation:{quotation_no:String(R.quotation_no||""),quotation_date:R.quotation_date?String(R.quotation_date).slice(0,10):"",valid_until:R.valid_until?String(R.valid_until).slice(0,10):"",payment_type:String(R.payment_type||""),price_type:String(R.price_type||"")},customer:{name:String(R.customer_name||""),address:String(R.address||""),city:String(R.city||""),state:String(R.state||""),country:String(R.country||""),phone:String(R.phone||""),email:String(R.email||"")},items:H,totals:{subtotal:M.toFixed(2),discount:q.toFixed(2),netSubtotal:z.toFixed(2),total:Number(R.net_amount??R.total_amount??z).toFixed(2)}}};function N(R){const U=R.company||{},T=R.quotation||{},Y=R.customer||{},H=Array.isArray(R.items)?R.items:[],M=R.totals||{};return`
      <style>
        .doc { color: #0f172a; font-size: 12px; }
        .doc-header { display: flex; justify-content: space-between; align-items: center; }
        .doc-title { font-weight: 800; font-size: 18px; color: #296d8f; }
        .company-block { display: flex; gap: 12px; align-items: center; }
        .company-logo { max-height: 80px; object-fit: contain; }
        .company-info div { line-height: 1.4; }
        .meta { text-align: right; font-size: 12px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        table { border-collapse: collapse; width: 100%; font-size: 12px; }
        th, td { border: 1px solid #e2e8f0; padding: 6px 8px; vertical-align: top; }
        th { background: #f8fafc; text-align: left; }
        .totals { display: flex; justify-content: flex-end; margin-top: 12px; }
        .totals table { width: 360px; }
      </style>
      <div class="doc">
        <div class="doc-header">
          <div class="company-block">
            ${U.logoUrl?`<img src="${U.logoUrl}" alt="${x(U.name||"Company")}" class="company-logo" />`:""}
            <div class="company-info">
              <div>${x(U.name||"")}</div>
              <div>${x(U.address||"")}</div>
              <div>${x(U.city||"")}${U.city?",":""} ${x(U.state||"")} ${x(U.country||"")}</div>
              <div>${x(U.phone||"")} ${x(U.email||"")}</div>
              <div>${x(U.website||"")}</div>
              <div>${U.taxId?`Tax ID: ${x(U.taxId)}`:""}</div>
              <div>${U.registrationNo?`Reg No: ${x(U.registrationNo)}`:""}</div>
            </div>
          </div>
          <div class="meta">
            <div class="doc-title">Quotation</div>
            <div>Quotation No: ${x(T.quotation_no||"")}</div>
            <div>Date: ${x(T.quotation_date||"")}</div>
            <div>Valid Until: ${x(T.valid_until||"")}</div>
          </div>
        </div>
        <div class="grid-2" style="margin-top: 6px;">
          <div>
            <div style="font-weight:700;margin-bottom:4px;">Customer</div>
            <div>${x(Y.name||"")}</div>
            <div>${x(Y.address||"")}</div>
            <div>${x(Y.city||"")}${Y.city?",":""} ${x(Y.state||"")} ${x(Y.country||"")}</div>
            <div>${x(Y.phone||"")} ${x(Y.email||"")}</div>
          </div>
          <div>
            <div style="font-weight:700;margin-bottom:4px;">Payment</div>
            <div>Payment Type: ${x(T.payment_type||"")}</div>
            <div>Price Type: ${x(T.price_type||"")}</div>
          </div>
        </div>
        <table style="margin-top: 8px;">
          <thead>
            <tr>
              <th>Description</th>
              <th style="text-align:right;">Qty</th>
              <th style="text-align:right;">Unit Price</th>
              <th style="text-align:right;">Discount</th>
              <th style="text-align:right;">Net</th>
            </tr>
          </thead>
          <tbody>
            ${H.map(q=>`
                <tr>
                  <td>${x(q.item_name||"")}</td>
                  <td style="text-align:right;">${x(q.qty||"")}</td>
                  <td style="text-align:right;">${x(q.unit_price||"")}</td>
                  <td style="text-align:right;">${x(q.discount||"")}</td>
                  <td style="text-align:right;">${x(q.net||"")}</td>
                </tr>
              `).join("")}
          </tbody>
        </table>
        <div class="totals">
          <table>
            <tbody>
              <tr><td>Subtotal</td><td style="text-align:right;">${x(M.subtotal||"")}</td></tr>
              <tr><td>Discount</td><td style="text-align:right;">${x(M.discount||"")}</td></tr>
              <tr><td>Net Subtotal</td><td style="text-align:right;">${x(M.netSubtotal||"")}</td></tr>
              <tr><td><strong>Total</strong></td><td style="text-align:right;"><strong>${x(M.total||"")}</strong></td></tr>
            </tbody>
          </table>
        </div>
      </div>
    `}async function _(R){var U,T,Y;try{const H=await Z.get(`/sales/quotations/${R}`),M=((U=H.data)==null?void 0:U.item)||{},q=Array.isArray((T=H.data)==null?void 0:T.details)?H.data.details:[],z=j(M,q),Q=b(N(z)),L=document.createElement("iframe");L.style.position="fixed",L.style.right="0",L.style.bottom="0",L.style.width="0",L.style.height="0",L.style.border="0",document.body.appendChild(L);const V=((Y=L.contentWindow)==null?void 0:Y.document)||L.contentDocument||null;if(!V){document.body.removeChild(L);return}V.open(),V.write(Q),V.close();const P=L.contentWindow||window;setTimeout(()=>{P.focus();try{P.print()}catch{}setTimeout(()=>{document.body.removeChild(L)},100)},200)}catch{}}async function F(R){var U,T;try{const Y=await Z.get(`/sales/quotations/${R}`),H=((U=Y.data)==null?void 0:U.item)||{},M=Array.isArray((T=Y.data)==null?void 0:T.details)?Y.data.details:[],q=j(H,M),z=N(q),Q=document.createElement("div");Q.style.position="fixed",Q.style.left="-10000px",Q.style.top="0",Q.style.width="794px",Q.style.background="white",Q.style.padding="32px",Q.innerHTML=z,document.body.appendChild(Q);try{await y(Q);const L=await wi(Q,{scale:2,useCORS:!0}),V=L.toDataURL("image/png"),P=new hs("p","mm","a4"),C=P.internal.pageSize.getWidth(),k=P.internal.pageSize.getHeight(),B=C,G=L.height*B/L.width;let O=0;for(;O<G;)P.addImage(V,"PNG",0,-O,B,G),O+=k,O<G&&P.addPage();const K="Quotation_"+(String(H.quotation_no||"").replaceAll(" ","_")||new Date().toISOString().slice(0,10))+".pdf";P.save(K)}finally{document.body.removeChild(Q)}}catch{}}const I=R=>{const U={DRAFT:"badge badge-warning",SENT:"badge badge-info",ACCEPTED:"badge badge-success",REJECTED:"badge badge-error",EXPIRED:"badge bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300"};return e.jsx("span",{className:U[R]||"badge",children:R})},w=r.filter(R=>{const U=String(R.quotation_no||"").toLowerCase().includes(d.toLowerCase())||String(R.customer_name||"").toLowerCase().includes(d.toLowerCase()),T=c==="ALL"||R.status===c;return U&&T});function E(R){const U=String(R||"").trim();if(!U)return"-";const T=new Date(U);return isNaN(T.getTime())?"-":T.toLocaleDateString()}function W(R){const U=Number(R);return isFinite(U)?U.toLocaleString("en-US",{minimumFractionDigits:2}):"0.00"}return n?e.jsx("div",{className:"text-center py-8",children:"Loading quotations..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Sales Quotations"}),e.jsx("p",{className:"text-sm mt-1",children:"Manage customer quotations and proposals"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/sales",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/sales/quotations/new",className:"btn-success",children:"+ New Quotation"})]})]})})}),l&&e.jsx("div",{className:"alert alert-error",children:e.jsx("span",{children:l})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by quotation number or customer...",className:"input",value:d,onChange:R=>u(R.target.value)})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs("select",{className:"input",value:c,onChange:R=>h(R.target.value),children:[e.jsx("option",{value:"ALL",children:"All Status"}),e.jsx("option",{value:"DRAFT",children:"Draft"}),e.jsx("option",{value:"SENT",children:"Sent"}),e.jsx("option",{value:"ACCEPTED",children:"Accepted"}),e.jsx("option",{value:"REJECTED",children:"Rejected"}),e.jsx("option",{value:"EXPIRED",children:"Expired"})]})})]}),n?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-brand"}),e.jsx("p",{className:"mt-2",children:"Loading quotations..."})]}):w.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"No quotations found."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Quotation No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Valid Until"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:w.map(R=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:R.quotation_no}),e.jsx("td",{children:E(R.quotation_date)}),e.jsx("td",{children:R.customer_name}),e.jsx("td",{children:E(R.valid_until)}),e.jsx("td",{className:"font-semibold",children:W(R.total_amount)}),e.jsx("td",{children:I(R.status)}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[s("sales:quotation","view")&&e.jsx("button",{onClick:()=>t(`/sales/quotations/${R.id}?mode=view`),className:"text-brand hover:text-brand-600 font-medium text-sm",children:"View"}),s("sales:quotation","edit")&&e.jsx("button",{onClick:()=>t(`/sales/quotations/${R.id}?mode=edit`),className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:"Edit"}),e.jsx("button",{onClick:()=>_(R.id),className:"inline-flex items-center px-3 py-1.5 rounded bg-green-600 hover:bg-green-700 text-white text-xs font-semibold",children:"Print"}),e.jsx("button",{onClick:()=>F(R.id),className:"inline-flex items-center px-3 py-1.5 rounded bg-purple-600 hover:bg-purple-700 text-white text-xs font-semibold",children:"PDF"})]})})]},R.id))})]})})]})})]})}const Ws="/assets/OMNISUITE_LOGO_FILL-CeKU3wr4.png";function V2(){var xe,ye;const t=ps(),{id:s}=Ps(),r=!!s,{user:a}=Kr(),[n,i]=f.useState(!1),[l,o]=f.useState(""),[d,u]=f.useState({quotation_no:"",quotation_date:new Date().toISOString().split("T")[0],customer_id:"",valid_days:30,valid_until:"",status:"DRAFT",terms_and_conditions:"",remarks:"",warehouse_id:"",price_type:"RETAIL",payment_type:"CASH",currency_id:4,exchange_rate:1}),[c,h]=f.useState([]),[m,p]=f.useState({item_id:"",item_name:"",qty:"",unit_price:"",discount_percent:0,tax_type:"",remarks:""}),[g,x]=f.useState([]),[b,y]=f.useState([]),[j,N]=f.useState([]),[_,F]=f.useState([]),[I,w]=f.useState([]),[E,W]=f.useState([]),[R,U]=f.useState(""),[T,Y]=f.useState(!1),[H,M]=f.useState({}),[q,z]=f.useState(""),[Q,L]=f.useState(""),[V,P]=f.useState(""),[C,k]=f.useState(""),[B,G]=f.useState({name:"",address:"",phone:"",email:"",city:"",state:"",country:"",logoUrl:""}),[O,K]=f.useState(""),J=f.useRef(null),te=[{value:"DRAFT",label:"Draft",color:"bg-gray-100 text-gray-800"},{value:"SENT",label:"Sent",color:"bg-blue-100 text-blue-800"},{value:"ACCEPTED",label:"Accepted",color:"bg-green-100 text-green-800"},{value:"REJECTED",label:"Rejected",color:"bg-red-100 text-red-800"},{value:"EXPIRED",label:"Expired",color:"bg-orange-100 text-orange-800"}],se=(Ae,be)=>{if(!Ae||!be)return"";const Ee=new Date(Ae);return Ee.setDate(Ee.getDate()+parseInt(be)),Ee.toISOString().split("T")[0]},ae=Ae=>{var Ge;const be=parseFloat(Ae.qty)||0,Ee=parseFloat(Ae.unit_price)||0,dt=parseFloat(Ae.discount_percent)||0,mt=be*Ee,it=mt*dt/100,ht=mt-it,ft=((Ge=I.find(at=>String(at.value)===String(Ae.tax_type)))==null?void 0:Ge.rate)||0,Rt=ht*ft/100;return{sub:mt,discAmt:it,net:ht,taxAmt:Rt,total:ht+Rt}},ne=()=>{const Ae=c.reduce((Ee,dt)=>Ee+(dt.net||0),0),be=c.reduce((Ee,dt)=>Ee+(dt.taxAmt||0),0);return{sub:Ae,tax:be,total:Ae+be}},ue=()=>{const Ae=c.reduce((it,ht)=>it+(ht.net||0),0),be={};c.forEach(it=>{(H[String(it.tax_type)]||[]).forEach(ft=>{const Rt=Number(ft.rate_percent)||0,Ge=(it.net||0)*Rt/100,at=ft.component_name;be[at]||(be[at]={amount:0,rate:Rt,sort_order:ft.sort_order||0}),be[at].amount+=Ge})});const Ee=Object.keys(be).map(it=>({name:it,amount:be[it].amount,rate:be[it].rate,sort_order:be[it].sort_order})).sort((it,ht)=>it.sort_order-ht.sort_order),dt=Ee.reduce((it,ht)=>it+ht.amount,0),mt=Ae+dt;return{sub:Ae,components:Ee,taxTotal:dt,total:mt}},oe=()=>{const Ae=c.reduce((ht,ft)=>ht+(ft.sub||0),0),be=c.reduce((ht,ft)=>ht+(ft.discAmt||0),0),Ee=c.reduce((ht,ft)=>ht+(ft.net||0),0),dt=ue(),mt=dt.taxTotal,it=Ee+mt;return{grossSub:Ae,discountTotal:be,netSub:Ee,components:dt.components,taxTotal:mt,grand:it}},le=async()=>{const be=Array.from(new Set(c.map(Ee=>String(Ee.tax_type)).filter(Boolean))).filter(Ee=>!(Ee in H));be.length&&await Promise.all(be.map(Ee=>He(Ee)))};f.useEffect(()=>{X(),me(),we(),Ie(),_e(),Fe(),Le(),r?De():(u(Ae=>({...Ae,valid_until:se(Ae.quotation_date,Ae.valid_days)})),Z.get("/sales/quotations/next-no").then(Ae=>{var Ee;const be=(Ee=Ae.data)==null?void 0:Ee.nextNo;be&&u(dt=>({...dt,quotation_no:be}))}).catch(()=>{u(Ae=>({...Ae,quotation_no:Ae.quotation_no||"QN000001"}))}))},[s]),f.useEffect(()=>{a!=null&&a.username&&K(a.username)},[a]);const X=async()=>{var Ae;try{const be=await Z.get("/sales/customers");x(Array.isArray((Ae=be.data)==null?void 0:Ae.items)?be.data.items:[])}catch(be){console.error("Error fetching customers:",be)}},me=async()=>{var Ae;try{const be=await Z.get("/inventory/items");y(Array.isArray((Ae=be.data)==null?void 0:Ae.items)?be.data.items:[])}catch(be){console.error("Error fetching items:",be)}},we=async()=>{var Ae;try{const be=await Z.get("/inventory/warehouses");N(Array.isArray((Ae=be.data)==null?void 0:Ae.items)?be.data.items:[])}catch(be){console.error("Error fetching warehouses:",be)}},Ie=async()=>{var Ae;try{const be=await Z.get("/finance/currencies"),Ee=Array.isArray((Ae=be.data)==null?void 0:Ae.items)?be.data.items:[];F(Ee);const dt=Ee.find(mt=>String(mt.code||mt.currency_code||"").toUpperCase()==="GHS")||Ee.find(mt=>/ghana|cedi/i.test(String(mt.name||mt.currency_name||"")));dt&&u(mt=>({...mt,currency_id:dt.id}))}catch(be){console.error("Error fetching currencies:",be)}},_e=async()=>{var Ae;try{const be=await Z.get("/finance/tax-codes"),dt=(Array.isArray((Ae=be.data)==null?void 0:Ae.items)?be.data.items:[]).map(mt=>({value:mt.id,label:mt.name,rate:Number(mt.rate_percent),code:mt.code}));if(w(dt),dt.length>0&&!m.tax_type){const mt=dt.find(it=>Number(it.rate)===20&&/vat/i.test(it.label))||dt.find(it=>Number(it.rate)===20)||dt.find(it=>/vat/i.test(it.label))||dt[0];p(it=>({...it,tax_type:mt==null?void 0:mt.value,tax_rate:mt==null?void 0:mt.rate}))}}catch(be){console.error("Error fetching tax codes:",be)}};f.useEffect(()=>{!I.length||!c.length||h(Ae=>Ae.map(be=>({...be,...ae(be)})))},[I]);const Fe=async()=>{var Ae;try{const be=await Z.get("/sales/price-types");W(Array.isArray((Ae=be.data)==null?void 0:Ae.items)?be.data.items:[])}catch(be){console.error("Error fetching price types:",be)}},Le=async()=>{var Ae,be,Ee,dt,mt;try{const it=(a==null?void 0:a.username)||"";K(it);const ht=await Z.get("/admin/me"),ft=(be=(Ae=ht.data)==null?void 0:Ae.scope)==null?void 0:be.companyId,Rt=((dt=(Ee=ht.data)==null?void 0:Ee.user)==null?void 0:dt.username)||"";if(!it&&Rt&&K(Rt),ft){const at=((mt=(await Z.get(`/admin/companies/${ft}`)).data)==null?void 0:mt.item)||{};G(je=>({...je,name:at.name||je.name||"",address:at.address||je.address||"",phone:at.telephone||je.phone||"",email:at.email||je.email||"",city:at.city||je.city||"",state:at.state||je.state||"",country:at.country||je.country||"",logoUrl:at.has_logo===1||at.has_logo===!0?`/api/admin/companies/${ft}/logo`:Ws}))}else G(Ge=>({...Ge,logoUrl:Ge.logoUrl||Ws}))}catch{a!=null&&a.username&&K(a.username),G(it=>({...it,logoUrl:it.logoUrl||Ws}))}},rt=Ae=>{if(!Ae||!E.length)return null;const be=E.find(Ee=>String(Ee.name||"").toUpperCase()===String(Ae).toUpperCase());return be?be.id:null},He=async Ae=>{var Ee;const be=String(Ae||"");if(be)try{const dt=await Z.get(`/finance/tax-codes/${Ae}/components`),mt=Array.isArray((Ee=dt.data)==null?void 0:Ee.items)?dt.data.items:[];M(it=>({...it,[be]:mt}))}catch{}},st=async(Ae,be)=>{var Ee;try{const dt=await Z.get("/sales/prices/standard"),mt=Array.isArray((Ee=dt.data)==null?void 0:Ee.items)?dt.data.items:[],it=rt(d.price_type),ht=mt.filter(ft=>String(ft.product_id)===String(Ae)&&(it?String(ft.price_type_id)===String(it):!0)).sort((ft,Rt)=>{const Ge=ft.effective_date?new Date(ft.effective_date).getTime():0;return(Rt.effective_date?new Date(Rt.effective_date).getTime():0)-Ge||new Date(Rt.created_at).getTime()-new Date(ft.created_at).getTime()});return ht.length>0?Number(ht[0].selling_price)||be||0:be||0}catch(dt){return console.error("Error fetching standard price:",dt),be||0}},De=async()=>{var Ae,be,Ee,dt;try{i(!0);const mt=await Z.get(`/sales/quotations/${s}`),it=(Ae=mt.data)==null?void 0:Ae.item;if(it){if(u({quotation_no:it.quotation_no||"",quotation_date:it.quotation_date||new Date().toISOString().split("T")[0],customer_id:it.customer_id||"",valid_days:it.valid_days||30,valid_until:it.valid_until||"",status:it.status||"DRAFT",terms_and_conditions:it.terms_and_conditions||"",remarks:it.remarks||"",warehouse_id:it.warehouse_id||"",price_type:it.price_type||"RETAIL",payment_type:it.payment_type||"CASH",currency_id:it.currency_id||4,exchange_rate:it.exchange_rate||1}),it.customer_id){const ht=g.find(ft=>String(ft.id)===String(it.customer_id));ht&&(U(it.customer_name||ht.customer_name||""),z(it.customer_address||ht.address||""),L(it.customer_city||ht.city||""),P(it.customer_state||ht.state||""),k(it.customer_country||ht.country||""))}if((be=mt.data)!=null&&be.details){const ht=mt.data.details.map((ft,Rt)=>{var at;const Ge=ae({qty:ft.qty,unit_price:ft.unit_price,discount_percent:ft.discount_percent,tax_type:ft.tax_type||((at=I==null?void 0:I[0])==null?void 0:at.value)||""});return{...ft,line_id:Rt+1,...Ge}});h(ht)}}}catch(mt){o(((dt=(Ee=mt==null?void 0:mt.response)==null?void 0:Ee.data)==null?void 0:dt.message)||"Error fetching quotation"),console.error("Error fetching quotation:",mt)}finally{i(!1)}},Te=async()=>{var be;if(d.customer_id)return Number(d.customer_id);const Ae=R.trim();if(!Ae)throw new Error("Please enter a customer name");Y(!0);try{const Ee=rt(d.price_type),mt=(be=(await Z.post("/sales/customers",{customer_name:Ae,price_type_id:Ee,address:q||null,city:Q||null,state:V||null,country:C||null})).data)==null?void 0:be.id;if(!mt)throw new Error("Failed to create customer");return u(it=>({...it,customer_id:mt})),Number(mt)}finally{Y(!1)}},Ce=Ae=>{const{name:be,value:Ee}=Ae.target;if(be==="quotation_date"||be==="valid_days"){const dt=be==="quotation_date"?Ee:d.quotation_date,mt=be==="valid_days"?Ee:d.valid_days;u(it=>({...it,[be]:Ee,valid_until:se(dt,mt)}))}else u(dt=>({...dt,[be]:Ee}))},Pe=Ae=>{var dt;const{name:be,value:Ee}=Ae.target;if(be==="item_id"){const mt=b.find(ht=>ht.id===parseInt(Ee)),it=(mt==null?void 0:mt.selling_price)||0;p(ht=>({...ht,item_id:Ee,item_name:(mt==null?void 0:mt.item_name)||"",unit_price:it,qty:1})),st(Ee,it).then(ht=>p(ft=>({...ft,unit_price:ht}))),Ee&&Z.get(`/finance/item-tax/${Ee}`).then(ht=>{var Rt,Ge,at;const ft=(Rt=ht.data)==null?void 0:Rt.tax;if(ft){const je=ft.id||((Ge=I.find(nt=>nt.code===ft.tax_code))==null?void 0:Ge.value)||null,Se=je?(at=I.find(nt=>String(nt.value)===String(je)))==null?void 0:at.rate:null;p(nt=>({...nt,tax_type:je??nt.tax_type,tax_rate:Se??ft.tax_rate}))}else p(je=>({...je,tax_rate:void 0}))}).catch(()=>{p(ht=>({...ht,tax_rate:void 0}))})}else{if(be==="tax_type"){const mt=((dt=I.find(it=>String(it.value)===String(Ee)))==null?void 0:dt.rate)||0;p(it=>({...it,[be]:Ee,tax_rate:mt}));return}p(mt=>({...mt,[be]:Ee}))}},fe=()=>{var be,Ee;if(!m.item_id||!m.qty||!m.unit_price){alert("Please fill all required item fields");return}const Ae=ae(m);h([...c,{...m,line_id:Date.now(),...Ae}]),p({item_id:"",item_name:"",qty:"",unit_price:"",discount_percent:0,tax_type:((be=I.find(dt=>Number(dt.rate)===20&&/vat/i.test(dt.label))||I.find(dt=>Number(dt.rate)===20)||I.find(dt=>/vat/i.test(dt.label))||I[0])==null?void 0:be.value)||"",tax_rate:((Ee=I.find(dt=>Number(dt.rate)===20&&/vat/i.test(dt.label))||I.find(dt=>Number(dt.rate)===20)||I.find(dt=>/vat/i.test(dt.label))||I[0])==null?void 0:Ee.rate)||void 0,remarks:""})},he=Ae=>{h(c.filter(be=>be.line_id!==Ae))},Ue=()=>{le().finally(()=>window.print())},Ye=async()=>{await le();const Ae=J.current;if(!Ae)return;const be=Ae.style.cssText;Ae.style.cssText=be+";position:fixed;left:-10000px;top:0;display:block;z-index:-1;background:white;width:794px;padding:32px;";try{const Ee=await wi(Ae,{scale:2,useCORS:!0}),dt=Ee.toDataURL("image/png"),mt=new hs("p","mm","a4"),it=mt.internal.pageSize.getWidth(),ht=mt.internal.pageSize.getHeight(),ft=it,Rt=Ee.height*ft/Ee.width;let Ge=0;for(;Ge<Rt;)mt.addImage(dt,"PNG",0,-Ge,ft,Rt),Ge+=ht,Ge<Rt&&mt.addPage();const at="Quotation_"+(d.quotation_no||new Date().toISOString().slice(0,10))+".pdf";mt.save(at)}finally{Ae.style.cssText=be}},Ke=Ae=>{if(Ae==null)return null;if(typeof Ae!="object")return Ae;if(Array.isArray(Ae))return Ae.map(Ee=>Ee===void 0?null:Ke(Ee));const be={};return Object.keys(Ae).forEach(Ee=>{const dt=Ae[Ee];be[Ee]=dt===void 0?null:Ke(dt)}),be},Je=async Ae=>{var dt,mt,it;if(Ae.preventDefault(),!d.customer_id&&!R.trim()||c.length===0){alert("Please enter customer name and add at least one item");return}i(!0);const be=oe();let Ee=d.quotation_no;if(!Ee)try{Ee=((dt=(await Z.get("/sales/quotations/next-no")).data)==null?void 0:dt.nextNo)||"QN000001"}catch{Ee="QN000001"}try{const ht=await Te();if(!ht){alert("Failed to get customer ID. Please try again."),i(!1);return}const ft=c.filter(at=>at.item_id&&Number(at.item_id)>0).map(at=>{const je=ae(at),Se=at.tax_type!==null&&at.tax_type!==void 0&&at.tax_type!==""?Number(at.tax_type):null,nt=Se!==null?I.find(Ze=>String(Ze.value)===String(Se)):null;return{item_id:Number(at.item_id),qty:Number(at.qty)||0,quantity:Number(at.qty)||0,unit_price:Number(at.unit_price)||0,discount_percent:Number(at.discount_percent)||0,tax_type:Se,tax_id:Se,tax_rate:nt&&Number(nt.rate)||0,tax_amount:Number(je.taxAmt)||0,line_total:Number(je.total)||0,total_amount:Number(je.total)||0,net_amount:Number(je.net)||0}}),Rt={quotation_no:Ee?String(Ee):null,quotation_date:d.quotation_date?String(d.quotation_date):null,customer_id:ht?Number(ht):null,valid_until:d.valid_until?String(d.valid_until):null,status:d.status?String(d.status):"DRAFT",terms_and_conditions:d.terms_and_conditions&&d.terms_and_conditions.trim()?String(d.terms_and_conditions):null,remarks:d.remarks&&d.remarks.trim()?String(d.remarks):null,warehouse_id:d.warehouse_id?Number(d.warehouse_id):null,price_type:d.price_type?String(d.price_type):null,payment_type:d.payment_type?String(d.payment_type):null,customer_name:R?String(R):null,customer_address:q?String(q):null,customer_city:Q?String(Q):null,customer_state:V?String(V):null,customer_country:C?String(C):null,total_amount:be.grand?Number(be.grand):0,items:ft},Ge=Ke(Rt);if(!Ge.customer_id||isNaN(Ge.customer_id)){alert("Invalid customer ID. Please try again."),i(!1);return}Ge.quotation_no=Ge.quotation_no||null,Ge.quotation_date=Ge.quotation_date||null,Ge.valid_until=Ge.valid_until||null,Ge.status=Ge.status||"DRAFT",Ge.remarks=Ge.remarks||null,Ge.terms_and_conditions=Ge.terms_and_conditions||null,Ge.warehouse_id=Ge.warehouse_id||null,Ge.price_type=Ge.price_type||null,Ge.payment_type=Ge.payment_type||null,Ge.customer_name=Ge.customer_name||null,Ge.customer_address=Ge.customer_address||null,Ge.customer_city=Ge.customer_city||null,Ge.customer_state=Ge.customer_state||null,Ge.customer_country=Ge.customer_country||null,Ge.total_amount=Ge.total_amount||0,Ge.items&&Array.isArray(Ge.items)&&(Ge.items=Ge.items.map(at=>({item_id:Number(at.item_id)||null,qty:Number(at.qty)||0,quantity:Number(at.qty)||0,unit_price:Number(at.unit_price)||0,tax_id:at.tax_id!==null&&at.tax_id!==void 0?Number(at.tax_id):null,tax_type:at.tax_type!==null&&at.tax_type!==void 0?Number(at.tax_type):null,tax_rate:Number(at.tax_rate)||0,tax_amount:Number(at.tax_amount)||0,line_total:Number(at.line_total)||0,total_amount:Number(at.total_amount)||0}))),r?await Z.put(`/sales/quotations/${s}`,Ge):await Z.post("/sales/quotations",Ge),console.log("Submitting:",Rt),alert(r?"Quotation updated successfully!":"Quotation created successfully!"),t("/sales/quotations")}catch(ht){console.error("Error saving quotation:",ht);const ft=((it=(mt=ht.response)==null?void 0:mt.data)==null?void 0:it.message)||ht.message||"Unknown error";alert(`Error saving quotation: ${ft}`)}finally{i(!1)}};return e.jsxs("div",{className:"max-w-7xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden my-6 print:shadow-none print:my-0 print:w-full print:max-w-none",children:[e.jsx("style",{children:`
        @media print {
          @page { margin: 1cm; }
          body { 
            background: white; 
            -webkit-print-color-adjust: exact; 
            print-color-adjust: exact; 
          }
          #root > div > header,
          #root > div > div > aside { display: none !important; }
          .print\\:hidden { display: none !important; }
          .print\\:block { display: block !important; }
          #root > div > div > main { padding: 0 !important; }
          input, select, textarea {
            border: none !important;
            background: transparent !important;
            padding: 0 !important;
            appearance: none !important;
            -webkit-appearance: none !important;
            resize: none;
            overflow: visible;
          }
        }
        .quotation-table { 
          border-collapse: collapse; 
          table-layout: fixed; 
          width: 100%; 
          max-width: 100%; 
          border-spacing: 0; 
          box-sizing: border-box;
          margin: 0;
        }
        .quotation-table th, .quotation-table td { 
          border: 1px solid #000000; 
          box-sizing: border-box; 
          word-break: break-word; 
          overflow-wrap: anywhere; 
          white-space: normal; 
          padding: 6px 4px;
          font-size: 10px;
        }
        .quotation-table td {
          overflow: visible;
        }
        .quotation-table thead th { 
          background: #0E3646; 
          color: #ffffff; 
        }
        .quotation-table thead th:last-child,
        .quotation-table tbody td:last-child {
          background: #ffffff;
          color: #000000;
        }
        .quotation-table thead th:last-child {
          border-top: 1px solid #ffffff;
          border-right: 1px solid #ffffff;
          border-bottom: 1px solid #ffffff;
          border-left: 1px solid #000000;
        }
        .quotation-table tbody td:last-child {
          border-top: 1px solid #ffffff;
          border-right: 1px solid #ffffff;
          border-bottom: 1px solid #ffffff;
          border-left: 1px solid #000000;
        }
        @media print {
          .quotation-table {
            width: 100%;
            max-width: 100%;
          }
          .quotation-table thead th:last-child,
          .quotation-table tbody td:last-child {
            background: #ffffff !important;
            color: #000000 !important;
          }
          .quotation-table thead th:last-child {
            border-top: 1px solid #ffffff !important;
            border-right: 1px solid #ffffff !important;
            border-bottom: 1px solid #ffffff !important;
            border-left: 1px solid #000000 !important;
          }
          .quotation-table tbody td:last-child {
            border-top: 1px solid #ffffff !important;
            border-right: 1px solid #ffffff !important;
            border-bottom: 1px solid #ffffff !important;
            border-left: 1px solid #000000 !important;
          }
        }
      `}),e.jsx("div",{className:"p-6 border-b text-white print:hidden",style:{backgroundColor:"#0E3646"},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold",children:[r?"Edit":"New"," Quotation"]}),e.jsx("p",{className:"text-sm opacity-80",children:r?"Update quotation details":"Create a new sales quotation"})]}),e.jsxs("div",{className:"flex gap-4 print:hidden items-center",children:[e.jsxs("button",{onClick:Ye,className:"flex items-center gap-2 bg-white/10 hover:bg-white/20 text-white px-3 py-1.5 rounded-lg transition-colors text-sm font-medium border border-white/20",title:"Save as PDF",children:[e.jsx(Cc,{className:"w-4 h-4"}),"Download PDF"]}),e.jsx("button",{onClick:Ue,className:"text-white hover:text-gray-200",title:"Print",children:e.jsx(tA,{className:"w-6 h-6"})}),e.jsx(Re,{to:"/sales/quotations",className:"text-white hover:text-gray-200",children:e.jsx(Xf,{className:"w-6 h-6"})})]})]})}),e.jsx("div",{className:"p-6 print:hidden",children:e.jsxs("form",{onSubmit:Je,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quotation #"}),e.jsx("input",{type:"text",name:"quotation_no",value:d.quotation_no,onChange:Ce,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-[#0E3646]",placeholder:"Auto-generated",readOnly:!r&&!d.quotation_no})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date *"}),e.jsx("input",{type:"date",name:"quotation_date",value:d.quotation_date,onChange:Ce,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer *"}),e.jsx("input",{type:"text",value:R,onChange:Ae=>U(Ae.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",placeholder:"Type customer name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("input",{type:"text",value:q,onChange:Ae=>z(Ae.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",placeholder:"Enter address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("input",{type:"text",value:Q,onChange:Ae=>L(Ae.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",placeholder:"Enter city"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"State"}),e.jsx("input",{type:"text",value:V,onChange:Ae=>P(Ae.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",placeholder:"Enter state"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Country"}),e.jsx("input",{type:"text",value:C,onChange:Ae=>k(Ae.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",placeholder:"Enter country"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Warehouse"}),e.jsxs("select",{name:"warehouse_id",value:d.warehouse_id,onChange:Ce,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:[e.jsx("option",{value:"",children:"Select Warehouse"}),j.map(Ae=>e.jsx("option",{value:Ae.id,children:Ae.warehouse_name},Ae.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valid Days *"}),e.jsx("input",{type:"number",name:"valid_days",value:d.valid_days,onChange:Ce,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expiry Date"}),e.jsx("input",{type:"date",value:d.valid_until,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",readOnly:!0})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsx("select",{name:"status",value:d.status,onChange:Ce,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:te.map(Ae=>e.jsx("option",{value:Ae.value,children:Ae.label},Ae.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price Type"}),e.jsxs("select",{name:"price_type",value:d.price_type,onChange:Ce,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:[e.jsx("option",{value:"RETAIL",children:"Retail"}),e.jsx("option",{value:"WHOLESALE",children:"Wholesale"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Type"}),e.jsxs("select",{name:"payment_type",value:d.payment_type,onChange:Ce,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:[e.jsx("option",{value:"CASH",children:"Cash"}),e.jsx("option",{value:"CHEQUE",children:"Cheque"}),e.jsx("option",{value:"CREDIT",children:"Credit"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency"}),e.jsx("select",{name:"currency_id",value:d.currency_id,onChange:Ce,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:_.map(Ae=>e.jsxs("option",{value:Ae.id,children:[Ae.code||Ae.currency_code," - ",Ae.name||Ae.currency_name]},Ae.id))})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Terms & Conditions"}),e.jsx("textarea",{name:"terms_and_conditions",value:d.terms_and_conditions,onChange:Ce,rows:"2",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646] print:hidden",placeholder:"Enter terms and conditions..."}),e.jsx("div",{className:"hidden print:block whitespace-pre-wrap text-sm text-gray-800 border-none p-0",children:d.terms_and_conditions||"None"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Remarks"}),e.jsx("textarea",{name:"remarks",value:d.remarks,onChange:Ce,rows:"2",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646] print:hidden",placeholder:"Enter remarks..."}),e.jsx("div",{className:"hidden print:block whitespace-pre-wrap text-sm text-gray-800 border-none p-0",children:d.remarks||"None"})]})]}),e.jsxs("div",{className:"border-t pt-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Quotation Items"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-6 border border-gray-200 print:hidden",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3 mb-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Item *"}),e.jsxs("select",{name:"item_id",value:m.item_id,onChange:Pe,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:[e.jsx("option",{value:"",children:"Select Item"}),b.map(Ae=>e.jsxs("option",{value:Ae.id,children:[Ae.item_code," - ",Ae.item_name]},Ae.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Qty *"}),e.jsx("input",{type:"number",name:"qty",value:m.qty,onChange:Pe,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Price *"}),e.jsx("input",{type:"number",name:"unit_price",value:m.unit_price,onChange:Pe,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Disc %"}),e.jsx("input",{type:"number",name:"discount_percent",value:m.discount_percent,onChange:Pe,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",min:"0",max:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tax"}),e.jsx("select",{name:"tax_type",value:m.tax_type,onChange:Pe,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:I.map(Ae=>e.jsx("option",{value:Ae.value,children:Ae.label},Ae.value))}),m.tax_rate!==void 0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Tax rate: ",Number(m.tax_rate).toFixed(2),"%"]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",onClick:fe,className:"flex items-center gap-2 px-4 py-2 text-white rounded-lg hover:opacity-90 transition-opacity",style:{backgroundColor:"#0E3646"},children:[e.jsx(Ec,{className:"w-4 h-4"}),"Add Item"]})})]}),c.length>0&&e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Item"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Disc%"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Net"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Tax"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider print:hidden",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:c.map(Ae=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:Ae.item_name}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:Ae.qty}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:parseFloat(Ae.unit_price).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:parseFloat(Ae.discount_percent||0).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:Ae.net.toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:Ae.taxAmt.toFixed(2)}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:Ae.total.toFixed(2)}),e.jsx("td",{className:"px-4 py-3 print:hidden",children:e.jsx("button",{type:"button",onClick:()=>he(Ae.line_id),className:"text-red-600 hover:text-red-900 transition-colors",children:e.jsx(ol,{className:"w-4 h-4"})})})]},Ae.line_id))}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-4 py-3 text-right font-semibold text-gray-700",children:"Totals:"}),e.jsx("td",{className:"px-4 py-3 font-bold text-gray-900",children:ne().sub.toFixed(2)}),e.jsx("td",{className:"px-4 py-3 font-bold text-gray-900",children:ne().tax.toFixed(2)}),e.jsx("td",{className:"px-4 py-3 font-bold text-gray-900",children:ne().total.toFixed(2)}),e.jsx("td",{className:"print:hidden"})]})})]})}),c.length===0&&e.jsx("div",{className:"text-center py-10 text-gray-500 bg-gray-50 rounded-lg border border-dashed border-gray-300",children:e.jsx("p",{children:"No items added yet. Use the form above to add items to this quotation."})})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-gray-200 print:hidden",children:[e.jsx(Re,{to:"/sales/quotations",className:"px-6 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"flex items-center gap-2 px-6 py-2 text-white rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50",style:{backgroundColor:"#0E3646"},disabled:n,children:[e.jsx(sA,{className:"w-5 h-5"}),n?"Saving...":r?"Update Quotation":"Create Quotation"]})]})]})}),e.jsxs("div",{className:"hidden print:block p-8 max-w-[19cm] mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:B.logoUrl||Ws,alt:B.name||"Company",className:"w-16 h-16 object-contain border border-gray-300"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold text-base",children:B.name||"Company"}),B.address&&e.jsx("div",{children:B.address}),(B.city||B.state||B.country)&&e.jsx("div",{children:[B.city,B.state,B.country].filter(Boolean).join(", ")}),e.jsxs("div",{className:"flex gap-3",children:[B.phone&&e.jsx("span",{children:B.phone}),B.email&&e.jsx("span",{children:B.email})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-xl font-semibold",children:"Quotation"})}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{children:["DATE: ",d.quotation_date||""]}),e.jsxs("div",{children:["Quotation #: ",d.quotation_no||""]}),e.jsxs("div",{children:["Customer:"," ",R||d.potential_cust_name||""]}),e.jsxs("div",{children:["Valid until: ",d.valid_until||""]}),e.jsxs("div",{children:["Prepared by: ",O||""]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-32",children:"Customer Name"}),e.jsx("div",{className:"flex-1",children:R||((xe=g.find(Ae=>String(Ae.id)===String(d.customer_id)))==null?void 0:xe.customer_name)||""})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-32",children:"Address"}),e.jsx("div",{className:"flex-1",children:q||""})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-32",children:"City"}),e.jsx("div",{className:"flex-1",children:Q||""})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-32",children:"State"}),e.jsx("div",{className:"flex-1",children:V||""})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-32",children:"Country"}),e.jsx("div",{className:"flex-1",children:C||""})]})]}),e.jsx("div",{className:"text-right"})]}),e.jsx("div",{className:"mb-2",children:e.jsxs("table",{className:"quotation-table text-sm",children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"40%"}}),e.jsx("col",{style:{width:"15%"}}),e.jsx("col",{style:{width:"20%"}}),e.jsx("col",{style:{width:"25%"}})]}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left",children:"Description"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Quantity"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Unit Price"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Total"})]})}),e.jsx("tbody",{children:c.map((Ae,be)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2",children:Ae.item_name}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Ae.qty||0).toFixed(2)}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Ae.unit_price||0).toFixed(2)}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Ae.total||0).toFixed(2)})]},Ae.line_id))})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx("div",{}),e.jsx("div",{children:e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx("div",{className:"px-2 py-1 font-medium",children:"Subtotal"}),e.jsx("div",{className:"px-2 py-1 text-right",children:oe().grossSub.toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-medium",children:"Discount"}),e.jsx("div",{className:"px-2 py-1 text-right",children:oe().discountTotal.toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-medium",children:"Net Sub Total"}),e.jsx("div",{className:"px-2 py-1 text-right font-semibold",children:oe().netSub.toFixed(2)}),oe().components.map(Ae=>e.jsxs(Is.Fragment,{children:[e.jsxs("div",{className:"px-2 py-1",children:[Ae.name," [",Ae.rate,"%]"]}),e.jsx("div",{className:"px-2 py-1 text-right",children:Ae.amount.toFixed(2)})]},Ae.name)),e.jsx("div",{className:"px-2 py-1 font-semibold",children:"Total"}),e.jsx("div",{className:"px-2 py-1 text-right font-semibold",children:oe().grand.toFixed(2)})]})})})]}),e.jsxs("div",{className:"mt-6 text-sm",children:[e.jsx("div",{children:"Terms and conditions :"}),e.jsx("div",{className:"mt-1",children:d.terms_and_conditions||"None"})]}),e.jsx("div",{className:"mt-6 text-center text-sm",children:"THANK YOU FOR YOUR BUSINESS!"})]}),e.jsxs("div",{ref:J,className:"hidden p-8 bg-white",style:{width:"794px",maxWidth:"794px"},children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:B.logoUrl||Ws,alt:B.name||"Company",className:"w-16 h-16 object-contain border border-gray-300"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold text-base",children:B.name||"Company"}),B.address&&e.jsx("div",{children:B.address}),(B.city||B.state||B.country)&&e.jsx("div",{children:[B.city,B.state,B.country].filter(Boolean).join(", ")}),e.jsxs("div",{className:"flex gap-3",children:[B.phone&&e.jsx("span",{children:B.phone}),B.email&&e.jsx("span",{children:B.email})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-xl font-semibold",children:"Quotation"})}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{children:["DATE: ",d.quotation_date||""]}),e.jsxs("div",{children:["Quotation #: ",d.quotation_no||""]}),e.jsxs("div",{children:["Customer: ",R||""]}),e.jsxs("div",{children:["Valid until: ",d.valid_until||""]}),e.jsxs("div",{children:["Prepared by: ",O||""]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-32",children:"Customer Name"}),e.jsx("div",{className:"flex-1",children:R||((ye=g.find(Ae=>String(Ae.id)===String(d.customer_id)))==null?void 0:ye.customer_name)||""})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-32",children:"Address"}),e.jsx("div",{className:"flex-1",children:q||""})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-32",children:"City"}),e.jsx("div",{className:"flex-1",children:Q||""})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-32",children:"State"}),e.jsx("div",{className:"flex-1",children:V||""})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-32",children:"Country"}),e.jsx("div",{className:"flex-1",children:C||""})]})]}),e.jsx("div",{className:"text-right"})]}),e.jsx("div",{className:"mb-2",style:{width:"100%",overflow:"visible"},children:e.jsxs("table",{className:"quotation-table text-sm",style:{width:"100%",tableLayout:"fixed"},children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"35%"}}),e.jsx("col",{style:{width:"15%"}}),e.jsx("col",{style:{width:"25%"}}),e.jsx("col",{style:{width:"25%"}})]}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left",children:"Description"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Quantity"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Unit Price"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Total"})]})}),e.jsx("tbody",{children:c.map(Ae=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2",children:Ae.item_name}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Ae.qty||0).toFixed(2)}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Ae.unit_price||0).toFixed(2)}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Ae.total||0).toFixed(2)})]},Ae.line_id))})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx("div",{}),e.jsx("div",{children:e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx("div",{className:"px-2 py-1 font-medium",children:"Subtotal"}),e.jsx("div",{className:"px-2 py-1 text-right",children:oe().grossSub.toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-medium",children:"Discount"}),e.jsx("div",{className:"px-2 py-1 text-right",children:oe().discountTotal.toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-medium",children:"Net Sub Total"}),e.jsx("div",{className:"px-2 py-1 text-right font-semibold",children:oe().netSub.toFixed(2)}),oe().components.map(Ae=>e.jsxs(Is.Fragment,{children:[e.jsxs("div",{className:"px-2 py-1",children:[Ae.name," [",Ae.rate,"%]"]}),e.jsx("div",{className:"px-2 py-1 text-right",children:Ae.amount.toFixed(2)})]},Ae.name)),e.jsx("div",{className:"px-2 py-1 font-semibold",children:"Total"}),e.jsx("div",{className:"px-2 py-1 text-right font-semibold",children:oe().grand.toFixed(2)})]})})})]}),e.jsx("div",{className:"mt-6 text-center text-sm",children:"THANK YOU FOR YOUR BUSINESS!"})]})]})}function TH(){const t=ps(),{canPerformAction:s}=Ls(),[r,a]=f.useState([]),[n,i]=f.useState(!0),[l,o]=f.useState(""),[d,u]=f.useState(""),[c,h]=f.useState("ALL"),[m,p]=f.useState(!1),[g,x]=f.useState(!1),[b,y]=f.useState(""),[j,N]=f.useState(null),[_,F]=f.useState([]),[I,w]=f.useState(null),[E,W]=f.useState(null),[R,U]=f.useState(null),[T,Y]=f.useState(!1),[H,M]=f.useState(null),[q,z]=f.useState({name:"",address:"",city:"",state:"",country:"",postalCode:"",phone:"",email:"",website:"",taxId:"",registrationNo:"",logoUrl:""}),[Q,L]=f.useState("");f.useEffect(()=>{let ue=!0;async function oe(){var le,X,me,we;try{const Ie=await Z.get("/admin/me"),_e=(X=(le=Ie.data)==null?void 0:le.scope)==null?void 0:X.companyId,Fe=((me=Ie.data)==null?void 0:me.user)||{},Le=String(Fe.username||"").trim(),rt=String(Fe.full_name||"").trim(),He=String(Fe.name||"").trim(),st=String(Fe.email||"").trim();if(ue&&L(Le||rt||He||st||""),!_e)return;const Ce=((we=(await Z.get(`/admin/companies/${_e}`)).data)==null?void 0:we.item)||{},Pe=Ce.has_logo===1||Ce.has_logo===!0?`/api/admin/companies/${_e}/logo`:"";if(!ue)return;z({name:String(Ce.name||""),address:String(Ce.address||""),city:String(Ce.city||""),state:String(Ce.state||""),country:String(Ce.country||""),postalCode:String(Ce.postal_code||""),phone:String(Ce.telephone||""),email:String(Ce.email||""),website:String(Ce.website||""),taxId:String(Ce.tax_id||""),registrationNo:String(Ce.registration_no||""),logoUrl:String(Pe||"")})}catch{}}return oe(),()=>{ue=!1}},[]);function V(ue){return String(ue??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function P(ue){return`<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sales Order</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 16px; color: #0f172a; }
      table { border-collapse: collapse; width: 100%; }
      th, td { border: 1px solid #e2e8f0; padding: 6px 8px; vertical-align: top; }
      th { background: #f8fafc; text-align: left; }
    </style>
  </head>
  <body>${ue||""}</body>
</html>`}async function C(ue){var le;const oe=Array.from(((le=ue==null?void 0:ue.querySelectorAll)==null?void 0:le.call(ue,"img"))||[]);oe.length&&await Promise.all(oe.map(X=>new Promise(me=>{if(X.complete)return me();const we=()=>me();X.addEventListener("load",we,{once:!0}),X.addEventListener("error",we,{once:!0})})))}const k=(ue,oe)=>{const le=String(q.logoUrl||"").trim(),X=le?`<img src="${le}" alt="${V(q.name||"Company")}" style="max-height:80px;object-fit:contain;" />`:"",me=(Array.isArray(oe)?oe:[]).map((He,st)=>{const De=Number(He.qty??He.quantity??0),Te=Number(He.unit_price??0),Ce=Number(He.discount_percent??0),Pe=Number(He.tax_amount??0),fe=Number(He.total_amount??De*Te-De*Te*Ce/100+Pe);return{sr:String(st+1),code:String(He.item_code||""),name:String(He.item_name||""),quantity:De.toFixed(2),uom:String(He.uom||He.uom_code||""),price:Te.toFixed(2),discount:Ce.toFixed(2),tax:Pe.toFixed(2),amount:fe.toFixed(2)}}),we=me.reduce((He,st)=>He+Number(st.price)*Number(st.quantity),0),Ie=me.reduce((He,st)=>He+Number(st.price)*Number(st.quantity)*Number(st.discount)/100,0),_e=me.reduce((He,st)=>He+Number(st.tax||0),0),Fe=we-Ie,Le=ue.net_amount??ue.total_amount??Fe+_e,rt=Number(Le??0);return{company:{name:q.name||"",address:q.address||"",city:q.city||"",state:q.state||"",country:q.country||"",postalCode:q.postalCode||"",phone:q.phone||"",email:q.email||"",website:q.website||"",taxId:q.taxId||"",registrationNo:q.registrationNo||"",logoUrl:le,logoHtml:X},sales_order:{number:String(ue.order_no||""),date:ue.order_date?String(ue.order_date).slice(0,10):"",payment_type:String(ue.payment_type||""),price_type:String(ue.price_type||"")},customer:{name:String(ue.customer_name||""),address:String(ue.address||""),city:String(ue.city||""),state:String(ue.state||""),country:String(ue.country||""),phone:String(ue.phone||""),email:String(ue.email||"")},items:me,totals:{sub_total:we.toFixed(2),discount:Ie.toFixed(2),tax_amount:_e.toFixed(2),total:Number(rt||0).toFixed(2)},prepared_by:Q||""}};function B(ue){const oe=ue.company||{},le=ue.sales_order||{},X=ue.customer||{},me=Array.isArray(ue.items)?ue.items:[],we=ue.totals||{};return`
      <style>
        .doc { color: #0f172a; font-size: 12px; }
        .doc-header { display: flex; justify-content: space-between; align-items: center; }
        .doc-title { font-weight: 800; font-size: 18px; color: #296d8f; }
        .company-block { display: flex; gap: 12px; align-items: center; }
        .company-logo { max-height: 80px; object-fit: contain; }
        .company-info div { line-height: 1.4; }
        .meta { text-align: right; font-size: 12px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        table { border-collapse: collapse; width: 100%; font-size: 12px; }
        th, td { border: 1px solid #e2e8f0; padding: 6px 8px; vertical-align: top; }
        th { background: #f8fafc; text-align: left; }
        .totals { display: flex; justify-content: flex-end; margin-top: 12px; }
        .totals table { width: 360px; }
      </style>
      <div class="doc">
        <div class="doc-header">
          <div class="company-block">
            ${oe.logoUrl?`<img src="${oe.logoUrl}" alt="${V(oe.name||"Company")}" class="company-logo" />`:""}
            <div class="company-info">
              <div>${V(oe.name||"")}</div>
              <div>${V(oe.address||"")}</div>
              <div>${V(oe.city||"")}${oe.city?",":""} ${V(oe.state||"")} ${V(oe.country||"")}</div>
              <div>${V(oe.phone||"")} ${V(oe.email||"")}</div>
              <div>${V(oe.website||"")}</div>
              <div>${oe.taxId?`Tax ID: ${V(oe.taxId)}`:""}</div>
              <div>${oe.registrationNo?`Reg No: ${V(oe.registrationNo)}`:""}</div>
            </div>
          </div>
          <div class="meta">
            <div class="doc-title">Sales Order</div>
            <div>Order No: ${V(le.number||"")}</div>
            <div>Order Date: ${V(le.date||"")}</div>
          </div>
        </div>
        <div class="grid-2" style="margin-top: 6px;">
          <div>
            <div style="font-weight:700;margin-bottom:4px;">Customer</div>
            <div>${V(X.name||"")}</div>
            <div>${V(X.address||"")}</div>
            <div>${V(X.city||"")}${X.city?",":""} ${V(X.state||"")} ${V(X.country||"")}</div>
            <div>${V(X.phone||"")} ${V(X.email||"")}</div>
          </div>
          <div>
            <div style="font-weight:700;margin-bottom:4px;">Payment</div>
            <div>Payment Type: ${V(le.payment_type||"")}</div>
            <div>Price Type: ${V(le.price_type||"")}</div>
          </div>
        </div>
        <table style="margin-top: 8px;">
          <thead>
            <tr>
              <th>#</th>
              <th>Code</th>
              <th>Description</th>
              <th style="text-align:right;">Qty</th>
              <th>UOM</th>
              <th style="text-align:right;">Unit Price</th>
              <th style="text-align:right;">Disc%</th>
              <th style="text-align:right;">Tax</th>
              <th style="text-align:right;">Amount</th>
            </tr>
          </thead>
          <tbody>
            ${me.map(Ie=>`
                <tr>
                  <td>${V(Ie.sr||"")}</td>
                  <td>${V(Ie.code||"")}</td>
                  <td>${V(Ie.name||"")}</td>
                  <td style="text-align:right;">${V(Ie.quantity||"")}</td>
                  <td>${V(Ie.uom||"")}</td>
                  <td style="text-align:right;">${V(Ie.price||"")}</td>
                  <td style="text-align:right;">${V(Ie.discount||"")}</td>
                  <td style="text-align:right;">${V(Ie.tax||"")}</td>
                  <td style="text-align:right;">${V(Ie.amount||"")}</td>
                </tr>
              `).join("")}
          </tbody>
        </table>
        <div class="totals">
          <table>
            <tbody>
              <tr><td>Sub Total</td><td style="text-align:right;">${V(we.sub_total||"")}</td></tr>
              <tr><td>Discount</td><td style="text-align:right;">${V(we.discount||"")}</td></tr>
              <tr><td>Tax</td><td style="text-align:right;">${V(we.tax_amount||"")}</td></tr>
              <tr><td><strong>Total</strong></td><td style="text-align:right;"><strong>${V(we.total||"")}</strong></td></tr>
            </tbody>
          </table>
        </div>
        <div style="margin-top:10px;font-size:12px;">
          <div>Prepared By: ${V(String(ue.prepared_by||""))}</div>
        </div>
      </div>
    `}async function G(ue){var oe,le,X;try{const me=await Z.get(`/sales/orders/${ue}`),we=((oe=me.data)==null?void 0:oe.item)||{},Ie=Array.isArray((le=me.data)==null?void 0:le.details)?me.data.details:[],_e=k(we,Ie),Fe=P(B(_e)),Le=document.createElement("iframe");Le.style.position="fixed",Le.style.right="0",Le.style.bottom="0",Le.style.width="0",Le.style.height="0",Le.style.border="0",document.body.appendChild(Le);const rt=((X=Le.contentWindow)==null?void 0:X.document)||Le.contentDocument||null;if(!rt){document.body.removeChild(Le);return}rt.open(),rt.write(Fe),rt.close();const He=Le.contentWindow||window;setTimeout(()=>{He.focus();try{He.print()}catch{}setTimeout(()=>{document.body.removeChild(Le)},100)},200)}catch{}}async function O(ue){var oe,le;try{const X=await Z.get(`/sales/orders/${ue}`),me=((oe=X.data)==null?void 0:oe.item)||{},we=Array.isArray((le=X.data)==null?void 0:le.details)?X.data.details:[],Ie=k(me,we),_e=B(Ie),Fe=document.createElement("div");Fe.style.position="fixed",Fe.style.left="-10000px",Fe.style.top="0",Fe.style.width="794px",Fe.style.background="white",Fe.style.padding="32px",Fe.innerHTML=_e,document.body.appendChild(Fe);try{await C(Fe);const Le=await wi(Fe,{scale:2,useCORS:!0}),rt=Le.toDataURL("image/png"),He=new hs("p","mm","a4"),st=He.internal.pageSize.getWidth(),De=He.internal.pageSize.getHeight(),Te=st,Ce=Le.height*Te/Le.width;let Pe=0;for(;Pe<Ce;)He.addImage(rt,"PNG",0,-Pe,Te,Ce),Pe+=De,Pe<Ce&&He.addPage();const fe="SalesOrder_"+(String(me.order_no||"").replaceAll(" ","_")||new Date().toISOString().slice(0,10))+".pdf";He.save(fe)}finally{document.body.removeChild(Fe)}}catch{}}f.useEffect(()=>{K()},[]);const K=async()=>{var ue,oe,le;try{i(!0),o("");const X=await Z.get("/sales/orders");a(Array.isArray((ue=X.data)==null?void 0:ue.items)?X.data.items:[])}catch(X){o(((le=(oe=X==null?void 0:X.response)==null?void 0:oe.data)==null?void 0:le.message)||"Error fetching orders"),console.error("Error fetching orders:",X)}finally{i(!1)}},J=r.filter(ue=>{const oe=String(ue.order_no||"").toLowerCase().includes(d.toLowerCase())||String(ue.customer_name||"").toLowerCase().includes(d.toLowerCase()),le=c==="ALL"||ue.status===c;return oe&&le}),te=async ue=>{var oe,le,X;if(M(ue),p(!0),y(""),E)await ae();else try{x(!0);const me=await Z.get("/workflows"),we=Array.isArray((oe=me.data)==null?void 0:oe.items)?me.data.items:[];W(we),await se(we)}catch(me){y(((X=(le=me==null?void 0:me.response)==null?void 0:le.data)==null?void 0:X.message)||"Failed to load workflows")}finally{x(!1)}},se=async ue=>{var me,we,Ie;if(!ue||!ue.length){N(null),w(null),y("");return}const oe="/sales/sales-orders",le=_e=>String(_e||"").trim().toUpperCase().replace(/\s+/g,"_"),X=ue.find(_e=>Number(_e.is_active)===1&&String(_e.document_route)===oe)||ue.find(_e=>Number(_e.is_active)===1&&le(_e.document_type)==="SALES_ORDER")||null;if(N(X||null),w(null),!!X)try{x(!0);const Fe=(me=(await Z.get(`/workflows/${X.id}`)).data)==null?void 0:me.item,Le=Array.isArray(Fe==null?void 0:Fe.steps)?Fe.steps:[];F(Le);const rt=Le[0]||null;if(w(rt?{userId:rt.approver_user_id,name:rt.approver_name,stepName:rt.step_name,stepOrder:rt.step_order,approvalLimit:rt.approval_limit}:null),rt){const He=(Array.isArray(rt.approvers)&&rt.approvers.length?rt.approvers[0].id:rt.approver_user_id)||null;U(He)}else U(null)}catch(_e){y(((Ie=(we=_e==null?void 0:_e.response)==null?void 0:we.data)==null?void 0:Ie.message)||"Failed to load workflow details")}finally{x(!1)}},ae=async()=>{var X,me,we;if(!E||!E.length){N(null),w(null),y("");return}const ue="/sales/sales-orders",oe=Ie=>String(Ie||"").trim().toUpperCase().replace(/\s+/g,"_"),le=E.find(Ie=>Number(Ie.is_active)===1&&String(Ie.document_route)===ue)||E.find(Ie=>Number(Ie.is_active)===1&&oe(Ie.document_type)==="SALES_ORDER")||null;if(N(le||null),w(null),!!le)try{x(!0);const _e=(X=(await Z.get(`/workflows/${le.id}`)).data)==null?void 0:X.item,Fe=Array.isArray(_e==null?void 0:_e.steps)?_e.steps:[];F(Fe);const Le=Fe[0]||null;if(w(Le?{userId:Le.approver_user_id,name:Le.approver_name,stepName:Le.step_name,stepOrder:Le.step_order,approvalLimit:Le.approval_limit}:null),Le){const rt=(Array.isArray(Le.approvers)&&Le.approvers.length?Le.approvers[0].id:Le.approver_user_id)||null;U(rt)}else U(null)}catch(Ie){y(((we=(me=Ie==null?void 0:Ie.response)==null?void 0:me.data)==null?void 0:we.message)||"Failed to load workflow details")}finally{x(!1)}};async function ne(){var ue,oe,le;if(H){Y(!0),y("");try{const X=H.total_amount===void 0||H.total_amount===null?null:Number(H.total_amount||0),me=await Z.post(`/sales/orders/${H.id}/submit`,{amount:X,workflow_id:j?j.id:null,target_user_id:R||null}),we=((ue=me==null?void 0:me.data)==null?void 0:ue.status)||"PENDING_APPROVAL";a(Ie=>Ie.map(_e=>_e.id===H.id?{..._e,status:we}:_e)),p(!1),M(null)}catch(X){y(((le=(oe=X==null?void 0:X.response)==null?void 0:oe.data)==null?void 0:le.message)||"Failed to forward for approval")}finally{Y(!1)}}}return n?e.jsx("div",{className:"text-center py-8",children:"Loading orders..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Sales Orders"}),e.jsx("p",{className:"text-sm mt-1",children:"Manage customer orders and track fulfillment"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/sales",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/sales/sales-orders/new",className:"btn-success",children:"+ New Sales Order"})]})]})})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by order number or customer...",className:"input",value:d,onChange:ue=>u(ue.target.value)})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs("select",{className:"input",value:c,onChange:ue=>h(ue.target.value),children:[e.jsx("option",{value:"ALL",children:"All Status"}),e.jsx("option",{value:"DRAFT",children:"Draft"}),e.jsx("option",{value:"CONFIRMED",children:"Confirmed"}),e.jsx("option",{value:"PROCESSING",children:"Processing"}),e.jsx("option",{value:"SHIPPED",children:"Shipped"}),e.jsx("option",{value:"DELIVERED",children:"Delivered"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})})]}),n?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-brand"}),e.jsx("p",{className:"mt-2",children:"Loading sales orders..."})]}):J.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"No sales orders found."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Order No"}),e.jsx("th",{children:"Order Date"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Priority"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:J.map(ue=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:ue.order_no}),e.jsx("td",{children:new Date(ue.order_date).toLocaleDateString()}),e.jsx("td",{children:ue.customer_name}),e.jsx("td",{children:ue.priority||"-"}),e.jsx("td",{className:"font-semibold",children:ue.total_amount.toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[s("sales:sales-orders","view")&&e.jsx("button",{onClick:()=>t(`/sales/sales-orders/${ue.id}?mode=view`),className:"text-brand hover:text-brand-600 font-medium text-sm",children:"View"}),String(ue.status||"").toUpperCase()!=="CONFIRMED"&&s("sales:sales-orders","edit")&&e.jsx("button",{onClick:()=>t(`/sales/sales-orders/${ue.id}?mode=edit`),className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:"Edit"}),ue.status==="APPROVED"?e.jsx("span",{className:"ml-3 text-sm font-medium px-2 py-1 rounded bg-green-500 text-white",children:"Approved"}):ue.status==="DRAFT"?e.jsx("button",{type:"button",className:"ml-3 text-sm font-medium px-2 py-1 rounded bg-brand text-white hover:bg-brand-700 transition-colors",onClick:()=>te(ue),disabled:T,children:"Forward for Approval"}):null,e.jsx("button",{onClick:()=>G(ue.id),className:"inline-flex items-center px-3 py-1.5 rounded bg-green-600 hover:bg-green-700 text-white text-xs font-semibold",children:"Print"}),e.jsx("button",{onClick:()=>O(ue.id),className:"inline-flex items-center px-3 py-1.5 rounded bg-purple-600 hover:bg-purple-700 text-white text-xs font-semibold",children:"PDF"})]})})]},ue.id))})]})})]})}),m?e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-erp w/full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-brand text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Forward for Approval"}),e.jsx("button",{onClick:()=>{p(!1),M(null),N(null),w(null),U(null),F([]),y("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Document No:"," ",e.jsx("span",{className:"font-semibold",children:(H==null?void 0:H.order_no)||"-"})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:j?`${j.workflow_name} (${j.workflow_code})`:"None (inactive)"})]}),e.jsx("div",{children:g?e.jsx("div",{className:"text-sm",children:"Loading workflow..."}):null}),e.jsx("div",{children:b?e.jsx("div",{className:"text-sm text-red-600",children:b}):null}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Target Approver"}),(()=>{const oe=Array.isArray(_)&&_.length>0?_[0]:null,le=oe?Array.isArray(oe.approvers)&&oe.approvers.length?oe.approvers.map(X=>({id:X.id,name:X.username})):oe.approver_user_id?[{id:oe.approver_user_id,name:oe.approver_name||String(oe.approver_user_id)}]:[]:[];return le.length>0?e.jsxs("div",{className:"mt-1",children:[e.jsxs("select",{className:"input w-full",value:R||"",onChange:X=>U(X.target.value?Number(X.target.value):null),children:[e.jsx("option",{value:"",children:"Select target approver"}),le.map(X=>e.jsx("option",{value:X.id,children:X.name},X.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:I?`Step ${I.stepOrder}  ${I.stepName}${I.approvalLimit!=null?`  Limit: ${Number(I.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:j?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})()]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{p(!1),M(null),N(null),w(null),U(null),F([]),y("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:ne,disabled:T||!H||Array.isArray(_)&&_.length>0&&j&&!R,children:T?"Forwarding...":"Forward"})]})]})}):null]})}const $i=(t=0)=>{const s=Rj(),r=ud(l=>l.inventoryRef.uoms),a=ud(l=>l.inventoryRef.status.uoms),n=ud(l=>l.inventoryRef.error.uoms);return f.useEffect(()=>{(a==="idle"||t)&&s(tf())},[s,a,t]),{uoms:r,loading:a==="loading",error:n,refresh:()=>{s(tf())}}};function Ic({open:t,onClose:s,itemId:r,defaultUom:a="",currentUom:n="",conversions:i=null,onApply:l}){const[o,d]=f.useState(!1),[u,c]=f.useState(""),[h,m]=f.useState(Array.isArray(i)?i:[]),[p,g]=f.useState(""),[x,b]=f.useState(n||""),[y,j]=f.useState(a||"");f.useEffect(()=>{c(""),g(""),b(n||""),j(a||"")},[r,n,a,t]),f.useEffect(()=>{if(!t)return;if(Array.isArray(i)){m(i);return}let E=!0;return d(!0),Z.get("/inventory/unit-conversions").then(W=>{var R;E&&m(Array.isArray((R=W.data)==null?void 0:R.items)?W.data.items:[])}).catch(W=>{var R,U;E&&c(((U=(R=W==null?void 0:W.response)==null?void 0:R.data)==null?void 0:U.message)||"Failed to load conversions")}).finally(()=>{E&&d(!1)}),()=>{E=!1}},[t,i]);const N=f.useMemo(()=>{const E=r?Number(r):null,W=Array.isArray(h)?h:[];return E?W.filter(R=>Number(R.item_id)===E):[]},[h,r]),_=f.useMemo(()=>{const E=new Set;for(const W of N)Number(W.is_active)&&E.add(String(W.from_uom));return Array.from(E)},[N]),F=f.useMemo(()=>{const E=new Set;for(const W of N)Number(W.is_active)&&E.add(String(W.to_uom));return Array.from(E)},[N]),I=f.useMemo(()=>{const E=N.find(R=>Number(R.is_active)&&String(R.from_uom)===String(x||"")&&String(R.to_uom)===String(y||"")),W=Number((E==null?void 0:E.conversion_factor)||0);return Number.isFinite(W)&&W>0?W:null},[N,x,y]),w=f.useMemo(()=>{const E=Number(p);return!Number.isFinite(E)||E<=0||!I?null:E*I},[p,I]);return t?e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow max-w-xl w-full",children:[e.jsxs("div",{className:"px-5 py-4 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Unit Conversion"}),e.jsx("button",{className:"btn-outline",onClick:s,children:""})]}),e.jsxs("div",{className:"p-5",children:[u?e.jsx("div",{className:"text-sm text-red-600 mb-3",children:u}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From Unit"}),e.jsxs("select",{className:"input",value:x,onChange:E=>b(E.target.value),children:[e.jsx("option",{value:"",children:"Select unit"}),_.map(E=>e.jsx("option",{value:E,children:E},E))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To Unit"}),e.jsxs("select",{className:"input",value:y,onChange:E=>j(E.target.value),children:[e.jsx("option",{value:"",children:"Select unit"}),F.map(E=>e.jsx("option",{value:E,children:E},E))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Factor"}),e.jsx("input",{type:"text",className:"input",value:I!=null?String(I):"",readOnly:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Value to Convert"}),e.jsx("input",{type:"number",step:"0.000001",className:"input",value:p,onChange:E=>g(E.target.value)}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:I?`1 ${x||""} = ${I} ${y||""}`:"Select valid From and To units"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"label",children:"Result"}),e.jsx("div",{className:"p-3 border-2 rounded text-center text-lg font-semibold",children:w!=null?`${p||0} ${x||""} = ${w} ${y||""}`:""})]})})]})]}),e.jsxs("div",{className:"px-5 py-4 border-t flex justify-end gap-2",children:[e.jsx("button",{className:"btn-outline",onClick:s,children:"Close"}),e.jsx("button",{className:"btn-success",disabled:!l||!I||!Number.isFinite(Number(p))||Number(p)<=0,onClick:()=>{l&&(l({item_id:r,from_uom:x,to_uom:y,input_qty:p,converted_qty:w}),s&&s())},children:"Apply"})]})]})}):null}function W2(){var dt,mt,it,ht,ft,Rt;const t=ps(),{id:s}=Ps(),r=!!s,{user:a}=Kr(),[n]=Vf(),i=String(n.get("mode")||"").toLowerCase()==="view",[l,o]=f.useState(!1),[d,u]=f.useState(""),[c,h]=f.useState("details"),[m,p]=f.useState({order_no:"",order_date:new Date().toISOString().split("T")[0],customer_id:"",quotation_id:"",status:"DRAFT",currency_id:4,exchange_rate:1,sales_person_id:"",warehouse_id:"",price_type:"RETAIL",payment_type:"CASH",payment_terms:"",priority:"MEDIUM",shipping_charges:0,delivery_time:"",internal_notes:"",customer_notes:"",city:"",state:"",country:"",phone:"",remarks:""}),[g,x]=f.useState([]),[b,y]=f.useState([]),[j,N]=f.useState([]),[_,F]=f.useState([]),[I,w]=f.useState([]),[E,W]=f.useState([]),[R,U]=f.useState([]),T=f.useRef(null),[Y,H]=f.useState({}),[M,q]=f.useState({name:"",address:"",phone:"",email:"",city:"",state:"",postalCode:"",country:"",website:"",taxId:"",registrationNo:"",logoUrl:""}),[z,Q]=f.useState(""),{uoms:L}=$i(),V=Is.useMemo(()=>{const Ge=Array.isArray(L)?L:[],at=Ge.find(je=>String(je.uom_code||"").toUpperCase()==="PCS")||Ge[0];return at&&at.uom_code?at.uom_code:"PCS"},[L]),[P,C]=f.useState({open:!1,itemId:null,defaultUom:"",currentUom:"",rowId:null}),[k,B]=f.useState([]),[G,O]=f.useState(!1),[K,J]=f.useState(""),[te,se]=f.useState(!1);f.useEffect(()=>{Z.get("/inventory/unit-conversions").then(Ge=>{var at;B(Array.isArray((at=Ge.data)==null?void 0:at.items)?Ge.data.items:[])}).catch(()=>{B([])})},[]);const[ae,ne]=f.useState({item_id:"",item_name:"",qty:"",unit_price:"",discount_percent:0,tax_type:"",remarks:"",uom:""}),ue=[{value:"LOW",label:"Low"},{value:"MEDIUM",label:"Medium"},{value:"HIGH",label:"High"},{value:"URGENT",label:"Urgent"}],oe=Ge=>{var Ne;const at=parseFloat(Ge.qty)||0,je=parseFloat(Ge.unit_price)||0,Se=parseFloat(Ge.discount_percent)||0,nt=at*je,Ze=nt*Se/100,gt=nt-Ze,jt=((Ne=R.find(ke=>String(ke.value)===String(Ge.tax_type)))==null?void 0:Ne.rate)||0,Mt=gt*jt/100;return{sub:nt,discAmt:Ze,net:gt,taxAmt:Mt,total:gt+Mt}},le=()=>{const Ge=g.reduce((je,Se)=>je+(Se.net||0),0),at=g.reduce((je,Se)=>je+(Se.taxAmt||0),0);return{sub:Ge,tax:at,total:Ge+at}},X=Ge=>{if(Ge==null||Ge==="")return null;const at=Number(Ge);if(Number.isFinite(at)&&String(at)===String(Ge))return at;const je=R.find(Se=>String(Se.code||"")===String(Ge||""));return je?je.value:null},me=async()=>{var Ge;try{const at=await Z.get("/sales/orders"),je=Array.isArray((Ge=at.data)==null?void 0:Ge.items)?at.data.items:[];let Se=0;for(const Ze of je){const gt=String(Ze.order_no||"").match(/^SO-(\d{6})$/);if(gt){const jt=Number(gt[1]);Number.isFinite(jt)&&jt>Se&&(Se=jt)}}const nt=Se+1;return`SO-${String(nt).padStart(6,"0")}`}catch{return"SO-000001"}},we=async(Ge,at)=>{var je;if(!Ge||!at)return 0;try{const Se=await Z.get(`/inventory/stock/available?warehouse_id=${Ge}&item_id=${at}`);return Number(((je=Se.data)==null?void 0:je.qty)||0)}catch{return 0}};f.useEffect(()=>{if(_e(),Fe(),Pe(),Le(),rt(),He(),Ie(),r)fe();else{let Ge=!0;return me().then(at=>{Ge&&p(je=>({...je,order_no:je.order_no||at||"SO-000001"}))}).catch(()=>{Ge&&p(at=>({...at,order_no:at.order_no||"SO-000001"}))}),()=>{Ge=!1}}},[s]),f.useEffect(()=>{a!=null&&a.username&&Q(a.username)},[a]);const Ie=async()=>{var Ge,at,je,Se,nt;try{const Ze=(a==null?void 0:a.username)||"";Q(Ze);const gt=await Z.get("/admin/me"),jt=(at=(Ge=gt.data)==null?void 0:Ge.scope)==null?void 0:at.companyId,Mt=((Se=(je=gt.data)==null?void 0:je.user)==null?void 0:Se.username)||"";if(!Ze&&Mt&&Q(Mt),jt){const ke=((nt=(await Z.get(`/admin/companies/${jt}`)).data)==null?void 0:nt.item)||{};q(qe=>({...qe,name:ke.name||qe.name||"",address:ke.address||qe.address||"",phone:ke.telephone||qe.phone||"",email:ke.email||qe.email||"",city:ke.city||qe.city||"",state:ke.state||qe.state||"",postalCode:ke.postal_code||qe.postalCode||"",country:ke.country||qe.country||"",website:ke.website||qe.website||"",taxId:ke.tax_id||qe.taxId||"",registrationNo:ke.registration_no||qe.registrationNo||"",logoUrl:ke.has_logo===1||ke.has_logo===!0?`/api/admin/companies/${jt}/logo`:Ws}))}else q(Ne=>({...Ne,logoUrl:Ne.logoUrl||Ws}))}catch{a!=null&&a.username&&Q(a.username),q(Ze=>({...Ze,logoUrl:Ze.logoUrl||Ws}))}},_e=async()=>{var Ge;try{const at=await Z.get("/sales/customers");y(Array.isArray((Ge=at.data)==null?void 0:Ge.items)?at.data.items:[])}catch(at){console.error("Error fetching customers:",at)}},Fe=async()=>{var Ge;try{const at=await Z.get("/inventory/items");N(Array.isArray((Ge=at.data)==null?void 0:Ge.items)?at.data.items:[])}catch(at){console.error("Error fetching items:",at)}},Le=async()=>{var Ge;try{const at=await Z.get("/inventory/warehouses");w(Array.isArray((Ge=at.data)==null?void 0:Ge.items)?at.data.items:[])}catch(at){console.error("Error fetching warehouses:",at)}},rt=async()=>{var Ge;try{const at=await Z.get("/finance/currencies"),je=Array.isArray((Ge=at.data)==null?void 0:Ge.items)?at.data.items:[];W(je);const Se=je.find(nt=>String(nt.code||nt.currency_code||"").toUpperCase()==="GHS")||je.find(nt=>/ghana|cedi/i.test(String(nt.name||nt.currency_name||"")));!r&&Se&&p(nt=>({...nt,currency_id:Se.id}))}catch(at){console.error("Error fetching currencies:",at)}},He=async()=>{var Ge;try{const at=await Z.get("/finance/tax-codes"),Se=(Array.isArray((Ge=at.data)==null?void 0:Ge.items)?at.data.items:[]).map(nt=>({value:nt.id,label:nt.name,rate:Number(nt.rate_percent),code:nt.code}));U(Se),Se.length>0&&!ae.tax_type&&ne(nt=>({...nt,tax_type:Se[0].value}))}catch(at){console.error("Error fetching tax codes:",at)}},st=async Ge=>{var je;const at=String(Ge||"");if(at)try{const Se=await Z.get(`/finance/tax-codes/${Ge}/components`),nt=Array.isArray((je=Se.data)==null?void 0:je.items)?Se.data.items:[];H(Ze=>({...Ze,[at]:nt}))}catch{}},De=async()=>{const at=Array.from(new Set(g.map(je=>String(je.tax_type)).filter(Boolean))).filter(je=>!(je in Y));at.length&&await Promise.all(at.map(je=>st(je)))},Te=()=>{const Ge=g.reduce((Ze,gt)=>Ze+(gt.net||0),0),at={};g.forEach(Ze=>{(Y[String(Ze.tax_type)]||[]).forEach(jt=>{const Mt=Number(jt.rate_percent)||0,Ne=(Ze.net||0)*Mt/100,ke=jt.component_name;at[ke]||(at[ke]={amount:0,rate:Mt,sort_order:jt.sort_order||0}),at[ke].amount+=Ne})});const je=Object.keys(at).map(Ze=>({name:Ze,amount:at[Ze].amount,rate:at[Ze].rate,sort_order:at[Ze].sort_order})).sort((Ze,gt)=>Ze.sort_order-gt.sort_order),Se=je.reduce((Ze,gt)=>Ze+gt.amount,0),nt=Ge+Se;return{sub:Ge,components:je,taxTotal:Se,total:nt}},Ce=()=>{const Ge=g.reduce((Ze,gt)=>Ze+(gt.sub||0),0),at=g.reduce((Ze,gt)=>Ze+(gt.discAmt||0),0),je=g.reduce((Ze,gt)=>Ze+(gt.net||0),0),Se=Te(),nt=je+Se.taxTotal;return{grossSub:Ge,discountTotal:at,netSub:je,components:Se.components,taxTotal:Se.taxTotal,grand:nt}},Pe=async()=>{var Ge,at,je;try{const[Se,nt]=await Promise.all([Z.get("/sales/quotations"),Z.get("/sales/orders")]),Ze=Array.isArray((Ge=Se.data)==null?void 0:Ge.items)?Se.data.items:[],gt=Array.isArray((at=nt.data)==null?void 0:at.items)?nt.data.items:[],jt=new Set(gt.map(Ne=>Ne==null?void 0:Ne.quotation_id).filter(Ne=>Ne!=null).map(Ne=>String(Ne)));let Mt=Ze.filter(Ne=>!jt.has(String(Ne.id)));if(r&&(m!=null&&m.quotation_id)){const Ne=String(m.quotation_id);if(!Mt.some(qe=>String(qe.id)===Ne))try{const ge=(je=(await Z.get(`/sales/quotations/${Ne}`)).data)==null?void 0:je.item;ge&&(Mt=[ge,...Mt])}catch{Mt=[{id:m.quotation_id,quotation_no:Ne,customer_name:""},...Mt]}}F(Mt)}catch(Se){console.error("Error fetching quotations:",Se)}},fe=async()=>{var Ge,at,je,Se;try{o(!0);const nt=await Z.get(`/sales/orders/${s}`),Ze=(Ge=nt.data)==null?void 0:Ge.item;if(Ze){if(p(gt=>({order_no:Ze.order_no||"",order_date:Ze.order_date?new Date(Ze.order_date).toISOString().split("T")[0]:"",customer_id:Ze.customer_id||"",quotation_id:Ze.quotation_id||"",status:Ze.status||"DRAFT",warehouse_id:Ze.warehouse_id||"",price_type:Ze.price_type||"RETAIL",payment_type:Ze.payment_type||"CASH",currency_id:Ze.currency_id??gt.currency_id??"",exchange_rate:Ze.exchange_rate||1,sales_person_id:Ze.sales_person_id||"",payment_terms:Ze.payment_terms||"",priority:Ze.priority||"MEDIUM",shipping_charges:Ze.shipping_charges||0,delivery_time:Ze.delivery_time||"",internal_notes:Ze.internal_notes||"",customer_notes:Ze.customer_notes||"",remarks:Ze.remarks||""})),(at=nt.data)!=null&&at.details){let gt=nt.data.details.map((Mt,Ne)=>{var qe;const ke=oe({qty:Mt.qty??Mt.quantity??0,unit_price:Mt.unit_price??0,discount_percent:Mt.discount_percent??0,tax_type:Mt.tax_id??((qe=R==null?void 0:R[0])==null?void 0:qe.value)??""});return{...Mt,line_id:Ne+1,...ke}});const jt=Ze.warehouse_id||m.warehouse_id||"";jt&&(gt=await Promise.all(gt.map(async Ne=>({...Ne,available_qty:await we(jt,Ne.item_id)})))),x(gt)}await Pe()}}catch(nt){u(((Se=(je=nt==null?void 0:nt.response)==null?void 0:je.data)==null?void 0:Se.message)||"Error fetching order"),console.error("Error fetching order:",nt)}finally{o(!1)}},he=async Ge=>{const at=Ge.target.value;if(p(je=>({...je,quotation_id:at})),!!at)try{o(!0);const je=await Z.get(`/sales/quotations/${at}`),{item:Se,details:nt}=je.data;if(Se&&p(Ze=>({...Ze,customer_id:Se.customer_id||"",currency_id:Se.currency_id||Ze.currency_id||"",exchange_rate:Se.exchange_rate||Ze.exchange_rate||1,remarks:Se.remarks||"",payment_terms:Se.terms_and_conditions||Ze.payment_terms||"",price_type:Se.price_type||Ze.price_type||"RETAIL",payment_type:Se.payment_type||Ze.payment_type||"CASH",warehouse_id:Se.warehouse_id||Ze.warehouse_id||""})),nt&&Array.isArray(nt)){const Ze=nt.map((gt,jt)=>{var vt,St;const Mt=j.find(xt=>xt.id==gt.item_id),Ne=gt.qty??gt.quantity??0,ke=gt.unit_price??0,qe=X(gt.tax_id??((vt=R==null?void 0:R[0])==null?void 0:vt.value)??""),ge=oe({qty:Ne,unit_price:ke,discount_percent:gt.discount_percent??0,tax_type:qe}),Me=gt.tax_amount!==void 0&&gt.tax_amount!==null?Number(gt.tax_amount):ge.taxAmt,Ve=gt.total_amount!==void 0&&gt.total_amount!==null?Number(gt.total_amount):ge.total;return{item_id:gt.item_id,item_name:(Mt==null?void 0:Mt.item_name)||gt.item_name||"Item "+gt.item_id,qty:Ne,unit_price:ke,discount_percent:gt.discount_percent??0,tax_type:qe,tax_rate:gt.tax_rate!==void 0&&gt.tax_rate!==null?Number(gt.tax_rate):(St=R.find(xt=>String(xt.value)===String(qe)))==null?void 0:St.rate,remarks:gt.remarks||"",line_id:Date.now()+jt,...ge,taxAmt:Me,total:Ve}});x(Ze)}}catch(je){console.error("Error fetching quotation details:",je),alert("Failed to load quotation details")}finally{o(!1)}},Ue=Ge=>{const{name:at,value:je}=Ge.target;if(at==="customer_id"){const Se=b.find(nt=>String(nt.id)===String(je));p(nt=>({...nt,customer_id:je,city:(Se==null?void 0:Se.city)||"",state:(Se==null?void 0:Se.state)||"",country:(Se==null?void 0:Se.country)||"",phone:(Se==null?void 0:Se.phone)||(Se==null?void 0:Se.customer_phone)||""}));return}p(Se=>({...Se,[at]:je}))},Ye=Ge=>{const{name:at,value:je}=Ge.target;if(at==="item_id"){const Se=j.find(nt=>nt.id===parseInt(je));if(ne(nt=>({...nt,item_id:je,item_name:(Se==null?void 0:Se.item_name)||"",unit_price:(Se==null?void 0:Se.selling_price)||"",qty:1,uom:String((Se==null?void 0:Se.uom)||"")||V})),je){m.customer_id&&Z.post("/sales/prices/best-price",{product_id:je,customer_id:m.customer_id,quantity:1,date:m.order_date,price_type:typeof m.price_type=="string"?m.price_type:String(m.price_type||""),only_standard:!0}).then(Ze=>{Ze.data&&Ze.data.price!==void 0&&ne(gt=>({...gt,unit_price:Ze.data.price}))}).catch(Ze=>console.error("Error fetching price:",Ze)),Z.get(`/finance/item-tax/${je}`).then(Ze=>{var jt,Mt,Ne;const gt=(jt=Ze.data)==null?void 0:jt.tax;if(gt){const ke=gt.id||((Mt=R.find(ge=>ge.code===gt.tax_code))==null?void 0:Mt.value)||null,qe=ke?(Ne=R.find(ge=>String(ge.value)===String(ke)))==null?void 0:Ne.rate:null;ne(ge=>({...ge,tax_type:ke??ge.tax_type,tax_rate:qe??gt.tax_rate}))}else ne(ke=>({...ke,tax_rate:void 0}))}).catch(()=>{ne(Ze=>({...Ze,tax_rate:void 0}))});const nt=m.warehouse_id;nt?we(nt,Number(je)).then(Ze=>ne(gt=>({...gt,available_qty:Ze}))):ne(Ze=>({...Ze,available_qty:void 0}))}}else ne(Se=>({...Se,[at]:je}))},Ke=()=>{if(!ae.item_id||!ae.qty||!ae.unit_price){alert("Please fill all required item fields");return}if(m.warehouse_id&&ae.available_qty!==void 0&&Number(ae.qty||0)>Number(ae.available_qty||0)){alert("Quantity exceeds available stock for selected warehouse");return}const Ge=X(ae.tax_type)??(R.length>0?R[0].value:null),at=oe({...ae,tax_type:Ge});x([...g,{...ae,tax_type:Ge,line_id:Date.now(),...at,available_qty:ae.available_qty,uom:ae.uom||V}]),ne({item_id:"",item_name:"",qty:"",unit_price:"",discount_percent:0,tax_type:R.length>0?R[0].value:"",tax_rate:void 0,remarks:"",available_qty:void 0,uom:V})},Je=Ge=>{x(g.filter(at=>at.line_id!==Ge))};f.useEffect(()=>{const Ge=m.warehouse_id;if(!Ge){x(at=>at.map(je=>({...je,available_qty:void 0}))),ne(at=>({...at,available_qty:void 0}));return}(async()=>{const at=await Promise.all(g.map(async je=>({...je,available_qty:await we(Ge,je.item_id)})));if(x(at),ae.item_id){const je=await we(Ge,Number(ae.item_id));ne(Se=>({...Se,available_qty:je}))}})()},[m.warehouse_id]);const xe=async()=>{De().finally(()=>window.print())},ye=async()=>{await De();const Ge=T.current;if(!Ge)return;const at=Ge.style.cssText;Ge.style.cssText=at+";position:fixed;left:-10000px;top:0;display:block;z-index:-1;background:white;width:794px;padding:32px;";try{const je=await wi(Ge,{scale:2,useCORS:!0}),Se=je.toDataURL("image/png"),nt=new hs("p","mm","a4"),Ze=nt.internal.pageSize.getWidth(),gt=nt.internal.pageSize.getHeight(),jt=Ze,Mt=je.height*jt/je.width;let Ne=0;for(;Ne<Mt;)nt.addImage(Se,"PNG",0,-Ne,jt,Mt),Ne+=gt,Ne<Mt&&nt.addPage();const ke="SalesOrder_"+(m.order_no||new Date().toISOString().slice(0,10))+".pdf";nt.save(ke)}finally{Ge.style.cssText=at}},Ae=async Ge=>{var Se,nt;if(Ge.preventDefault(),!m.customer_id||g.length===0){alert("Please select a customer and add at least one item");return}o(!0);const at=le();let je=m.order_no;if(!je){const Ze=new Date().toISOString().slice(0,10).replace(/-/g,""),gt=Math.floor(Math.random()*1e3).toString().padStart(3,"0");je=`SO-${Ze}-${gt}`}try{const Ze={...m,order_no:je,customer_id:Number(m.customer_id),quotation_id:m.quotation_id?Number(m.quotation_id):null,total_amount:at.total,sub_total:at.sub,tax_amount:at.tax,items:g.map(gt=>{const jt=X(gt.tax_type),Mt=R.find(Ne=>String(Ne.value)===String(jt));return{item_id:gt.item_id,quantity:Number(gt.qty),unit_price:Number(gt.unit_price),discount_percent:Number(gt.discount_percent),tax_id:jt,tax_rate:Mt?Mt.rate:Number(gt.tax_rate||0)||0,tax_amount:gt.taxAmt,total_amount:gt.total,net_amount:gt.net,uom:String(gt.uom||V)}})};r?await Z.put(`/sales/orders/${s}`,Ze):await Z.post("/sales/orders",Ze),ct.success(r?"Order updated successfully!":"Order created successfully!"),t("/sales/sales-orders")}catch(Ze){console.error("Error saving order:",Ze);const gt=((nt=(Se=Ze.response)==null?void 0:Se.data)==null?void 0:nt.message)||Ze.message||"Unknown error";alert(`Error saving order: ${gt}`)}finally{o(!1)}},be=String(m.status||"").toUpperCase()==="CONFIRMED",Ee=i&&be;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"max-w-7xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden my-6 print:shadow-none print:my-0 print:w-full print:max-w-none",children:[e.jsx("style",{children:`
        @media print {
          @page { margin: 1cm; }
          body { 
            background: white; 
            -webkit-print-color-adjust: exact; 
            print-color-adjust: exact; 
          }
          #root > div > header,
          #root > div > div > aside { display: none !important; }
          .print\\:hidden { display: none !important; }
          .print\\:block { display: block !important; }
          #root > div > div > main { padding: 0 !important; }
          input, select, textarea {
            border: none !important;
            background: transparent !important;
            padding: 0 !important;
            appearance: none !important;
            -webkit-appearance: none !important;
            resize: none;
            overflow: visible;
          }
        }
        .quotation-table { 
          border-collapse: collapse; 
          table-layout: fixed; 
          width: 100%; 
          max-width: 100%; 
          border-spacing: 0; 
          box-sizing: border-box;
          margin: 0 auto;
        }
        .view-mode input, .view-mode select, .view-mode textarea {
          background-color: #eff6ff !important;
        }
        .quotation-table th, .quotation-table td { 
          border: 1px solid #000000; 
          box-sizing: border-box; 
          word-break: break-word; 
          overflow-wrap: anywhere; 
          white-space: normal; 
          padding: 6px 4px;
          font-size: 10px;
        }
        .quotation-table td {
          overflow: visible;
        }
        .quotation-table thead th { 
          background: #0E3646; 
          color: #ffffff; 
        }
        .quotation-table thead th:last-child,
        .quotation-table tbody td:last-child {
          background: #ffffff;
          color: #000000;
        }
        .quotation-table thead th:last-child {
          border-top: 1px solid #ffffff;
          border-right: 1px solid #ffffff;
          border-bottom: 1px solid #ffffff;
          border-left: 1px solid #000000;
        }
        .quotation-table tbody td:last-child {
          border-top: 1px solid #ffffff;
          border-right: 1px solid #ffffff;
          border-bottom: 1px solid #ffffff;
          border-left: 1px solid #000000;
        }
        @media print {
          .quotation-table {
            width: 100%;
            max-width: 100%;
          }
          .quotation-table thead th:last-child,
          .quotation-table tbody td:last-child {
            background: #ffffff !important;
            color: #000000 !important;
          }
          .quotation-table thead th:last-child {
            border-top: 1px solid #ffffff !important;
            border-right: 1px solid #ffffff !important;
            border-bottom: 1px solid #ffffff !important;
            border-left: 1px solid #000000 !important;
          }
          .quotation-table tbody td:last-child {
            border-top: 1px solid #ffffff !important;
            border-right: 1px solid #ffffff !important;
            border-bottom: 1px solid #ffffff !important;
            border-left: 1px solid #000000 !important;
          }
        }
      `}),e.jsx("div",{className:"p-6 border-b text-white print:hidden",style:{backgroundColor:"#0E3646"},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold",children:[r?"Edit":"New"," Sales Order"]}),e.jsx("p",{className:"text-sm opacity-80",children:r?"Update order details":"Create a new sales order"})]}),e.jsxs("div",{className:"flex gap-4 print:hidden items-center",children:[r?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:async()=>{var Ge,at;try{const je=await Z.post(`/documents/sales-order/${s}/render`,{format:"html"});J(String(je.data||"")),O(!0)}catch(je){ct.error(((at=(Ge=je==null?void 0:je.response)==null?void 0:Ge.data)==null?void 0:at.message)||"Failed to render")}},className:"flex items-center gap-2 bg-white/10 hover:bg-white/20 text-white px-3 py-1.5 rounded-lg transition-colors text-sm font-medium border border-white/20",children:[e.jsx(Pj,{className:"w-4 h-4"}),"Template Preview"]}),e.jsxs("button",{onClick:async()=>{var Ge,at;try{se(!0);const Se=(await Z.post(`/documents/sales-order/${s}/render?format=pdf`,{},{responseType:"blob"})).data,nt=URL.createObjectURL(Se),Ze=document.createElement("a");Ze.href=nt,Ze.download=`sales-order-${s}.pdf`,Ze.click(),URL.revokeObjectURL(nt)}catch(je){ct.error(((at=(Ge=je==null?void 0:je.response)==null?void 0:Ge.data)==null?void 0:at.message)||"Failed to download")}finally{se(!1)}},className:"flex items-center gap-2 bg-white/10 hover:bg-white/20 text-white px-3 py-1.5 rounded-lg transition-colors text-sm font-medium border border-white/20",children:[e.jsx(Cc,{className:"w-4 h-4"}),"Template PDF"]})]}):null,e.jsxs("button",{onClick:ye,className:"flex items-center gap-2 bg-white/10 hover:bg-white/20 text-white px-3 py-1.5 rounded-lg transition-colors text-sm font-medium border border-white/20",children:[e.jsx(Cc,{className:"w-4 h-4"}),"Download PDF"]}),e.jsx("button",{onClick:xe,className:"text-white hover:text-gray-200",children:e.jsx(tA,{className:"w-6 h-6"})}),e.jsx(Re,{to:"/sales/sales-orders",className:"text-white hover:text-gray-200",children:e.jsx(Xf,{className:"w-6 h-6"})})]})]})}),e.jsx("div",{className:"p-6 print:hidden",children:e.jsxs("form",{onSubmit:Ae,children:[e.jsx("div",{className:"flex gap-4 border-b mb-6 print:hidden",children:e.jsx("button",{type:"button",onClick:()=>h("details"),className:`pb-2 px-4 font-medium transition-colors ${c==="details"?"border-b-2 border-[#0E3646] text-[#0E3646]":"text-gray-500 hover:text-gray-700"}`,children:"Order Details"})}),e.jsx("fieldset",{disabled:Ee,className:i?"view-mode":"",children:e.jsxs("div",{className:"block",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order #"}),e.jsx("input",{type:"text",name:"order_no",value:m.order_no,onChange:Ue,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-[#0E3646]",placeholder:"Auto-generated",readOnly:!r&&!m.order_no})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date *"}),e.jsx("input",{type:"date",name:"order_date",value:m.order_date,onChange:Ue,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer *"}),e.jsxs("select",{name:"customer_id",value:m.customer_id,onChange:Ue,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",required:!0,children:[e.jsx("option",{value:"",children:"Select Customer"}),b.map(Ge=>e.jsx("option",{value:Ge.id,children:Ge.customer_name},Ge.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Warehouse"}),e.jsxs("select",{name:"warehouse_id",value:m.warehouse_id,onChange:Ue,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:[e.jsx("option",{value:"",children:"Select Warehouse"}),I.map(Ge=>e.jsx("option",{value:Ge.id,children:Ge.warehouse_name},Ge.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quotation Ref"}),e.jsxs("select",{name:"quotation_id",value:m.quotation_id,onChange:he,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:[e.jsx("option",{value:"",children:"Select Quotation"}),_.map(Ge=>e.jsxs("option",{value:Ge.id,children:[Ge.quotation_no," - ",Ge.customer_name]},Ge.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),e.jsx("select",{name:"priority",value:m.priority,onChange:Ue,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:ue.map(Ge=>e.jsx("option",{value:Ge.value,children:Ge.label},Ge.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price Type"}),e.jsxs("select",{name:"price_type",value:m.price_type,onChange:Ue,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:[e.jsx("option",{value:"RETAIL",children:"Retail"}),e.jsx("option",{value:"WHOLESALE",children:"Wholesale"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Type"}),e.jsxs("select",{name:"payment_type",value:m.payment_type,onChange:Ue,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:[e.jsx("option",{value:"CASH",children:"Cash"}),e.jsx("option",{value:"CHEQUE",children:"Cheque"}),e.jsx("option",{value:"CREDIT",children:"Credit"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency"}),e.jsx("select",{name:"currency_id",value:m.currency_id,onChange:Ue,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:E.map(Ge=>e.jsxs("option",{value:Ge.id,children:[Ge.code||Ge.currency_code," -"," ",Ge.name||Ge.currency_name]},Ge.id))})]})]}),e.jsxs("div",{className:"border-t pt-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Order Items"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-6 border border-gray-200 print:hidden",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-7 gap-3 mb-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Item *"}),e.jsxs("select",{name:"item_id",value:ae.item_id,onChange:Ye,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:[e.jsx("option",{value:"",children:"Select Item"}),j.map(Ge=>e.jsxs("option",{value:Ge.id,children:[Ge.item_code," - ",Ge.item_name]},Ge.id))]}),(()=>{const Ge=j.find(nt=>String(nt.id)===String(ae.item_id)),at=(Ge==null?void 0:Ge.uom)&&String(Ge.uom)||ae.uom&&String(ae.uom)||(V?String(V):""),je=String(ae.uom||"");return je&&at&&je!==at&&String(ae.item_id||"")?e.jsx("button",{type:"button",className:"mt-2 px-2 py-1 text-xs border border-brand text-brand rounded hover:bg-brand hover:text-white transition-colors",onClick:()=>C({open:!0,itemId:ae.item_id,defaultUom:at,currentUom:je}),children:`number of ${je}`}):null})()]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"UOM *"}),e.jsx("select",{name:"uom",value:ae.uom||V,onChange:Ye,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:(Array.isArray(L)?L:[]).map(Ge=>e.jsx("option",{value:Ge.uom_code,children:Ge.uom_name?`${Ge.uom_name} (${Ge.uom_code})`:Ge.uom_code},Ge.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Qty *"}),e.jsx("input",{type:"number",name:"qty",value:ae.qty,onChange:Ye,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",min:"1"})]}),e.jsx("div",{className:"flex items-end",children:(()=>{const Ge=j.find(Ze=>String(Ze.id)===String(ae.item_id)),at=(Ge==null?void 0:Ge.uom)&&String(Ge.uom)||ae.uom&&String(ae.uom)||(V?String(V):""),je=(Array.isArray(k)?k:[]).filter(Ze=>Number(Ze.is_active)&&String(Ze.to_uom)===at&&Number(Ze.item_id)===Number(ae.item_id)).map(Ze=>String(Ze.from_uom)),Se=je[0]||"";return je.length>0&&Se&&Se!==at?e.jsx("button",{type:"button",className:"ml-2 px-2 py-1 text-xs border border-brand text-brand rounded hover:bg-brand hover:text-white transition-colors",onClick:()=>C({open:!0,itemId:ae.item_id,defaultUom:at,currentUom:Se,rowId:null}),children:`number of ${Se}`}):null})()}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Available"}),e.jsx("input",{type:"text",value:m.warehouse_id?Number(ae.available_qty||0).toFixed(2):"",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg bg-gray-50",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Price *"}),e.jsx("input",{type:"number",name:"unit_price",value:ae.unit_price,onChange:Ye,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Disc %"}),e.jsx("input",{type:"number",name:"discount_percent",value:ae.discount_percent,onChange:Ye,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",min:"0",max:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tax"}),e.jsx("select",{name:"tax_type",value:ae.tax_type,onChange:Ye,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:R.map(Ge=>e.jsx("option",{value:Ge.value,children:Ge.label},Ge.value))}),ae.tax_rate!==void 0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Tax rate: ",Number(ae.tax_rate).toFixed(2),"%"]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",onClick:Ke,className:"bg-[#0E3646] text-white px-4 py-2 rounded-lg hover:bg-[#092530] flex items-center gap-2 transition-colors text-sm",children:[e.jsx(Ec,{className:"w-4 h-4"})," Add Item"]})})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Item"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"UOM"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Convert"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Available"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Disc%"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Net"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Tax"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider print:hidden",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"px-4 py-8 text-center text-gray-500",children:"No items added yet"})}):g.map(Ge=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:Ge.item_name}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:Ge.uom||V}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:Ge.qty}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:(()=>{const at=j.find(gt=>String(gt.id)===String(Ge.item_id)),je=(at==null?void 0:at.uom)&&String(at.uom)||Ge.uom&&String(Ge.uom)||(V?String(V):""),Se=(Array.isArray(k)?k:[]).filter(gt=>Number(gt.is_active)&&String(gt.to_uom)===je&&Number(gt.item_id)===Number(Ge.item_id)).map(gt=>String(gt.from_uom)),nt=Se[0]||"";return Se.length>0&&nt&&nt!==je?e.jsx("button",{type:"button",className:"px-2 py-1 text-xs border border-brand text-brand rounded hover:bg-brand hover:text-white transition-colors",onClick:()=>C({open:!0,itemId:Ge.item_id,defaultUom:je,currentUom:nt,rowId:Ge.line_id}),children:`number of ${nt}`}):null})()}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:m.warehouse_id?Number(Ge.available_qty||0).toFixed(2):""}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:parseFloat(Ge.unit_price).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:parseFloat(Ge.discount_percent||0).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:Ge.net.toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:Ge.taxAmt.toFixed(2)}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:Ge.total.toFixed(2)}),e.jsx("td",{className:"px-4 py-3 print:hidden",children:e.jsx("button",{type:"button",onClick:()=>Je(Ge.line_id),className:"text-red-600 hover:text-red-900 transition-colors",children:e.jsx(ol,{className:"w-4 h-4"})})})]},Ge.line_id))}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"px-4 py-3 text-right font-semibold text-gray-700",children:"Totals:"}),e.jsx("td",{className:"px-4 py-3 font-bold text-gray-900",children:le().sub.toFixed(2)}),e.jsx("td",{className:"px-4 py-3 font-bold text-gray-900",children:le().tax.toFixed(2)}),e.jsx("td",{className:"px-4 py-3 font-bold text-gray-900",children:le().total.toFixed(2)}),e.jsx("td",{className:"print:hidden"})]})})]})})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-6 border-t print:hidden",children:[e.jsx(Re,{to:"/sales/sales-orders",className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:l,className:"px-6 py-2 bg-[#0E3646] text-white rounded-lg hover:bg-[#092530] font-medium transition-colors flex items-center gap-2",children:l?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(sA,{className:"w-4 h-4"}),r?"Update Order":"Create Order"]})})]})]})}),e.jsxs("div",{className:"hidden print:block p-8 max-w-[19cm] mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:M.logoUrl||Ws,alt:M.name||"Company",className:"w-16 h-16 object-contain border border-gray-300"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold text-base",children:M.name||"Company"}),M.address&&e.jsx("div",{children:M.address}),(M.city||M.state||M.country)&&e.jsx("div",{children:[M.city,M.state,M.country].filter(Boolean).join(", ")}),e.jsxs("div",{className:"flex gap-3",children:[M.phone&&e.jsx("span",{children:M.phone}),M.email&&e.jsx("span",{children:M.email})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-xl font-semibold",children:"Sales Order"})}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{children:["DATE: ",m.order_date||""]}),e.jsxs("div",{children:["Order #: ",m.order_no||""]}),e.jsxs("div",{children:["Customer:"," ",((dt=b.find(Ge=>String(Ge.id)===String(m.customer_id)))==null?void 0:dt.customer_name)||""]}),e.jsxs("div",{children:["City: ",m.city||""]}),e.jsxs("div",{children:["State: ",m.state||""]}),e.jsxs("div",{children:["Country: ",m.country||""]}),e.jsxs("div",{children:["Phone: ",m.phone||""]}),e.jsxs("div",{children:["Price Type: ",m.price_type||""]}),e.jsxs("div",{children:["Payment Type: ",m.payment_type||""]}),e.jsxs("div",{children:["Currency:"," ",((mt=E.find(Ge=>String(Ge.id)===String(m.currency_id)))==null?void 0:mt.code)||""]}),e.jsxs("div",{children:["Warehouse:"," ",((it=I.find(Ge=>String(Ge.id)===String(m.warehouse_id)))==null?void 0:it.warehouse_name)||""]}),e.jsxs("div",{children:["Prepared by: ",z||""]})]})]}),e.jsx("div",{className:"mb-2 mx-auto",children:e.jsxs("table",{className:"quotation-table text-sm",children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"35%"}}),e.jsx("col",{style:{width:"15%"}}),e.jsx("col",{style:{width:"25%"}}),e.jsx("col",{style:{width:"25%"}})]}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left",children:"Description"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Quantity"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Unit Price"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Total"})]})}),e.jsx("tbody",{children:g.map(Ge=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2",children:Ge.item_name}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Ge.qty||0).toFixed(2)}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Ge.unit_price||0).toFixed(2)}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Ge.total||0).toFixed(2)})]},Ge.line_id))})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx("div",{}),e.jsx("div",{children:e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx("div",{className:"px-2 py-1 font-medium",children:"Subtotal"}),e.jsx("div",{className:"px-2 py-1 text-right",children:Ce().grossSub.toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-medium",children:"Discount"}),e.jsx("div",{className:"px-2 py-1 text-right",children:Ce().discountTotal.toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-medium",children:"Net Sub Total"}),e.jsx("div",{className:"px-2 py-1 text-right font-semibold",children:Ce().netSub.toFixed(2)}),Ce().components.map(Ge=>e.jsxs(Is.Fragment,{children:[e.jsxs("div",{className:"px-2 py-1",children:[Ge.name," [",Ge.rate,"%]"]}),e.jsx("div",{className:"px-2 py-1 text-right",children:Ge.amount.toFixed(2)})]},Ge.name)),e.jsx("div",{className:"px-2 py-1 font-semibold",children:"Total"}),e.jsx("div",{className:"px-2 py-1 text-right font-semibold",children:Ce().grand.toFixed(2)})]})})})]}),e.jsx("div",{className:"mt-6 text-center text-sm",children:"THANK YOU FOR YOUR BUSINESS!"})]}),e.jsxs("div",{ref:T,className:"hidden p-8 bg-white",style:{width:"794px",maxWidth:"794px"},children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:M.logoUrl||Ws,alt:M.name||"Company",className:"w-16 h-16 object-contain border border-gray-300"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold text-base",children:M.name||"Company"}),M.address&&e.jsx("div",{children:M.address}),(M.city||M.state||M.country)&&e.jsx("div",{children:[M.city,M.state,M.country].filter(Boolean).join(", ")}),e.jsxs("div",{className:"flex gap-3",children:[M.phone&&e.jsx("span",{children:M.phone}),M.email&&e.jsx("span",{children:M.email})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-xl font-semibold",children:"Sales Order"})}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{children:["DATE: ",m.order_date||""]}),e.jsxs("div",{children:["Order #: ",m.order_no||""]}),e.jsxs("div",{children:["Customer:"," ",((ht=b.find(Ge=>String(Ge.id)===String(m.customer_id)))==null?void 0:ht.customer_name)||""]}),e.jsxs("div",{children:["City: ",m.city||""]}),e.jsxs("div",{children:["State: ",m.state||""]}),e.jsxs("div",{children:["Country: ",m.country||""]}),e.jsxs("div",{children:["Phone: ",m.phone||""]}),e.jsxs("div",{children:["Price Type: ",m.price_type||""]}),e.jsxs("div",{children:["Payment Type: ",m.payment_type||""]}),e.jsxs("div",{children:["Currency:"," ",((ft=E.find(Ge=>String(Ge.id)===String(m.currency_id)))==null?void 0:ft.code)||""]}),e.jsxs("div",{children:["Warehouse:"," ",((Rt=I.find(Ge=>String(Ge.id)===String(m.warehouse_id)))==null?void 0:Rt.warehouse_name)||""]}),e.jsxs("div",{children:["Prepared by: ",z||""]})]})]}),e.jsx("div",{className:"mb-2",style:{width:"100%",overflow:"visible",margin:"0 auto"},children:e.jsxs("table",{className:"quotation-table text-sm",style:{width:"100%",tableLayout:"fixed"},children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"35%"}}),e.jsx("col",{style:{width:"15%"}}),e.jsx("col",{style:{width:"25%"}}),e.jsx("col",{style:{width:"25%"}})]}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left",children:"Description"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Quantity"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Unit Price"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Total"})]})}),e.jsx("tbody",{children:g.map(Ge=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2",children:Ge.item_name}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Ge.qty||0).toFixed(2)}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Ge.unit_price||0).toFixed(2)}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Ge.total||0).toFixed(2)})]},Ge.line_id))})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx("div",{}),e.jsx("div",{children:e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx("div",{className:"px-2 py-1 font-medium",children:"Gross Subtotal"}),e.jsx("div",{className:"px-2 py-1 text-right",children:Ce().grossSub.toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-medium",children:"Discount"}),e.jsx("div",{className:"px-2 py-1 text-right",children:Ce().discountTotal.toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-medium",children:"Net Sub Total"}),e.jsx("div",{className:"px-2 py-1 text-right font-semibold",children:Ce().netSub.toFixed(2)}),Ce().components.map(Ge=>e.jsxs("div",{className:"contents",children:[e.jsxs("div",{className:"px-2 py-1",children:[Ge.name," [",Ge.rate,"%]"]}),e.jsx("div",{className:"px-2 py-1 text-right",children:Ge.amount.toFixed(2)})]},Ge.name)),e.jsx("div",{className:"px-2 py-1 font-semibold",children:"Total"}),e.jsx("div",{className:"px-2 py-1 text-right font-semibold",children:Ce().grand.toFixed(2)})]})})})]})]})]}),e.jsx(C5,{open:G,onClose:()=>O(!1),html:K,downloading:te,onDownload:async()=>{var Ge,at;try{se(!0);const Se=(await Z.post(`/documents/sales-order/${s}/render?format=pdf`,{},{responseType:"blob"})).data,nt=URL.createObjectURL(Se),Ze=document.createElement("a");Ze.href=nt,Ze.download=`sales-order-${s}.pdf`,Ze.click(),URL.revokeObjectURL(nt)}catch(je){ct.error(((at=(Ge=je==null?void 0:je.response)==null?void 0:Ge.data)==null?void 0:at.message)||"Failed to download")}finally{se(!1)}}}),e.jsx(Ic,{open:P.open,itemId:P.itemId,defaultUom:P.defaultUom,currentUom:P.currentUom,onClose:()=>C({open:!1,itemId:null,defaultUom:"",currentUom:"",rowId:null}),onApply:Ge=>{const{converted_qty:at}=Ge||{},je=Number(at||0);P.rowId!=null?x(Se=>Se.map(nt=>String(nt.line_id)===String(P.rowId)?{...nt,qty:je,uom:P.defaultUom||nt.uom}:nt)):ne(Se=>({...Se,qty:je,uom:P.defaultUom||Se.uom}))}})]})}function IH(){const t=ps(),{canPerformAction:s}=Ls(),[r,a]=f.useState([]),[n,i]=f.useState([]),[l,o]=f.useState([]),[d,u]=f.useState(!0),[c,h]=f.useState(""),[m,p]=f.useState(""),[g,x]=f.useState("ALL"),[b,y]=f.useState(null),[j,N]=f.useState({name:"",address:"",city:"",state:"",country:"",postalCode:"",phone:"",email:"",website:"",taxId:"",registrationNo:"",logoUrl:""});f.useEffect(()=>{_()},[]);const _=async()=>{var M,q,z,Q,L;try{u(!0),h("");const[V,P,C]=await Promise.all([Z.get("/sales/invoices"),Z.get("/finance/currencies"),Z.get("/inventory/warehouses")]);a(Array.isArray((M=V.data)==null?void 0:M.items)?V.data.items:[]),i(Array.isArray((q=P.data)==null?void 0:q.items)?P.data.items:[]),o(Array.isArray((z=C.data)==null?void 0:z.items)?C.data.items:[])}catch(V){h(((L=(Q=V==null?void 0:V.response)==null?void 0:Q.data)==null?void 0:L.message)||"Error fetching invoices"),console.error("Error fetching invoices:",V)}finally{u(!1)}};f.useEffect(()=>{let M=!0;async function q(){var z,Q,L;try{const P=(Q=(z=(await Z.get("/admin/me")).data)==null?void 0:z.scope)==null?void 0:Q.companyId;if(!P)return void 0;const k=((L=(await Z.get(`/admin/companies/${P}`)).data)==null?void 0:L.item)||{};if(!M)return;N(B=>({...B,name:k.name||B.name||"",address:k.address||B.address||"",city:k.city||B.city||"",state:k.state||B.state||"",country:k.country||B.country||"",postalCode:k.postal_code||B.postalCode||"",phone:k.telephone||B.phone||"",email:k.email||B.email||"",website:k.website||B.website||"",taxId:k.tax_id||B.taxId||"",registrationNo:k.registration_no||B.registrationNo||"",logoUrl:k.has_logo===1||k.has_logo===!0?`/api/admin/companies/${P}/logo`:B.logoUrl||""}))}catch{}}return q(),()=>{M=!1}},[]);function F(M){return String(M??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function I(M){return`<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Invoice</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 16px; color: #0f172a; }
      table { border-collapse: collapse; width: 100%; }
      th, td { border: 1px solid #e2e8f0; padding: 6px 8px; vertical-align: top; }
      th { background: #f8fafc; text-align: left; }
    </style>
  </head>
  <body>${M||""}</body>
</html>`}async function w(M){var z;const q=Array.from(((z=M==null?void 0:M.querySelectorAll)==null?void 0:z.call(M,"img"))||[]);q.length&&await Promise.all(q.map(Q=>new Promise(L=>{if(Q.complete)return L();const V=()=>L();Q.addEventListener("load",V,{once:!0}),Q.addEventListener("error",V,{once:!0})})))}const E=(M,q)=>{var L;const z=(Array.isArray(q)?q:[]).map(V=>{const P=Number(V.quantity||V.qty||0),C=Number(V.unit_price||0),k=Number(V.discount_percent||0),B=Number(V.total_amount||P*C),G=Number(V.net_amount||B-P*C*k/100);return{item_name:String(V.item_name||""),qty:P.toFixed(2),unit_price:C.toFixed(2),total:B.toFixed(2),discount:Number(k||0).toFixed(2),net:G.toFixed(2)}}),Q=((L=n.find(V=>String(V.id)===String(M.currency_id)))==null?void 0:L.code)||"";return{company:{name:j.name||"Company",address:j.address||"",city:j.city||"",state:j.state||"",postalCode:j.postalCode||"",country:j.country||"",phone:j.phone||"",email:j.email||"",website:j.website||"",taxId:j.taxId||"",registrationNo:j.registrationNo||"",logoUrl:String(j.logoUrl||"")},invoice:{invoice_no:String(M.invoice_no||""),invoice_date:M.invoice_date?String(M.invoice_date).slice(0,10):"",due_date:String(M.due_date||""),payment_type:String(M.payment_type||""),price_type:String(M.price_type||""),currency:String(Q||""),prepared_by:""},customer:{id:String(M.customer_id||""),code:"",name:String(M.customer_name||""),type:"",contactPerson:"",email:"",phone:String(M.phone||""),mobile:"",address:String(M.address||""),city:String(M.city||""),state:String(M.state||""),zone:"",country:String(M.country||""),paymentTerms:"",creditLimit:"0.00"},items:z,totals:{subtotal:Number(z.reduce((V,P)=>V+Number(P.total||0),0)).toFixed(2),discount:Number(z.reduce((V,P)=>V+Number(P.discount||0),0)).toFixed(2),netSubtotal:Number(z.reduce((V,P)=>V+Number(P.net||0),0)).toFixed(2),tax:"0.00",total:Number(M.net_amount||M.total_amount||0).toFixed(2)}}};function W(M){const q=M.company||{},z=M.invoice||{},Q=M.customer||{},L=Array.isArray(M.items)?M.items:[],V=M.totals||{};return`
      <style>
        .doc { color: #0f172a; font-size: 12px; }
        .doc-header { display: flex; justify-content: space-between; align-items: center; }
        .doc-title { font-weight: 800; font-size: 18px; color: #296d8f; }
        .company-block { display: flex; gap: 12px; align-items: center; }
        .company-logo { max-height: 80px; object-fit: contain; }
        .company-info div { line-height: 1.4; }
        .meta { text-align: right; font-size: 12px; }
        .section-title { font-weight: 700; margin-top: 8px; margin-bottom: 4px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        table { border-collapse: collapse; width: 100%; font-size: 12px; }
        th, td { border: 1px solid #e2e8f0; padding: 6px 8px; vertical-align: top; }
        th { background: #f8fafc; text-align: left; }
        .totals { display: flex; justify-content: flex-end; margin-top: 12px; }
        .totals table { width: 320px; }
      </style>
      <div class="doc">
        <div class="doc-header">
          <div class="company-block">
            ${q.logoUrl?`<img src="${q.logoUrl}" alt="${F(q.name||"Company")}" class="company-logo" />`:""}
            <div class="company-info">
              <div>${F(q.name||"")}</div>
              <div>${F(q.address||"")}</div>
              <div>${F(q.city||"")}${q.city?",":""} ${F(q.state||"")} ${F(q.country||"")}</div>
              <div>${F(q.phone||"")} ${F(q.email||"")}</div>
              <div>${F(q.website||"")}</div>
              <div>${q.taxId?`Tax ID: ${F(q.taxId)}`:""}</div>
              <div>${q.registrationNo?`Reg No: ${F(q.registrationNo)}`:""}</div>
            </div>
          </div>
          <div class="meta">
            <div class="doc-title">Invoice</div>
            <div>Invoice No: ${F(z.invoice_no||"")}</div>
            <div>Invoice Date: ${F(z.invoice_date||"")}</div>
            <div>Due Date: ${F(z.due_date||"")}</div>
            <div>Status: ${F(String(z.status||""))}</div>
          </div>
        </div>

        <div class="grid-2" style="margin-top: 6px;">
          <div>
            <div class="section-title">Customer</div>
            <div>${F(Q.name||"")}</div>
            <div>${F(Q.address||"")}</div>
            <div>${F(Q.city||"")}${Q.city?",":""} ${F(Q.state||"")} ${F(Q.country||"")}</div>
            <div>${F(Q.phone||"")} ${F(Q.email||"")}</div>
          </div>
          <div>
            <div class="section-title">Payment</div>
            <div>Currency: ${F(z.currency||"")}</div>
            <div>Payment Type: ${F(z.payment_type||"")}</div>
            <div>Price Type: ${F(z.price_type||"")}</div>
          </div>
        </div>

        <table style="margin-top: 8px;">
          <thead>
            <tr>
              <th>Description</th>
              <th style="text-align:right;">Qty</th>
              <th style="text-align:right;">Unit Price</th>
              <th style="text-align:right;">Discount</th>
              <th style="text-align:right;">Net</th>
            </tr>
          </thead>
          <tbody>
            ${L.map(P=>`
                <tr>
                  <td>${F(P.item_name||"")}</td>
                  <td style="text-align:right;">${F(P.qty||"")}</td>
                  <td style="text-align:right;">${F(P.unit_price||"")}</td>
                  <td style="text-align:right;">${F(P.discount||"")}</td>
                  <td style="text-align:right;">${F(P.net||"")}</td>
                </tr>
              `).join("")}
          </tbody>
        </table>

        <div class="totals">
          <table>
            <tbody>
              <tr><td>Subtotal</td><td style="text-align:right;">${F(V.subtotal||"")}</td></tr>
              <tr><td>Discount</td><td style="text-align:right;">${F(V.discount||"")}</td></tr>
              <tr><td>Net Subtotal</td><td style="text-align:right;">${F(V.netSubtotal||"")}</td></tr>
              <tr><td>Tax</td><td style="text-align:right;">${F(V.tax||"")}</td></tr>
              <tr><td><strong>Total</strong></td><td style="text-align:right;"><strong>${F(V.total||"")}</strong></td></tr>
            </tbody>
          </table>
        </div>
      </div>
    `}async function R(M){var q,z,Q,L,V;try{const P=await Z.get(`/sales/invoices/${M}`),C=((q=P.data)==null?void 0:q.item)||{},k=Array.isArray((z=P.data)==null?void 0:z.details)?P.data.details:[],B=E(C,k),G=I(W(B)),O=document.createElement("iframe");O.style.position="fixed",O.style.right="0",O.style.bottom="0",O.style.width="0",O.style.height="0",O.style.border="0",document.body.appendChild(O);const K=((Q=O.contentWindow)==null?void 0:Q.document)||O.contentDocument||null;if(!K){document.body.removeChild(O);return}K.open(),K.write(G),K.close();const J=O.contentWindow||window;setTimeout(()=>{J.focus();try{J.print()}catch{}setTimeout(()=>{document.body.removeChild(O)},100)},200)}catch(P){ct.error(((V=(L=P==null?void 0:P.response)==null?void 0:L.data)==null?void 0:V.message)||"Failed to print invoice")}}async function U(M){var q,z,Q,L;try{const V=await Z.get(`/sales/invoices/${M}`),P=((q=V.data)==null?void 0:q.item)||{},C=Array.isArray((z=V.data)==null?void 0:z.details)?V.data.details:[],k=E(P,C),B=W(k),G=document.createElement("div");G.style.position="fixed",G.style.left="-10000px",G.style.top="0",G.style.width="794px",G.style.background="white",G.style.padding="32px",G.innerHTML=B,document.body.appendChild(G);try{await w(G);const O=await wi(G,{scale:2,useCORS:!0}),K=O.toDataURL("image/png"),J=new hs("p","mm","a4"),te=J.internal.pageSize.getWidth(),se=J.internal.pageSize.getHeight(),ae=te,ne=O.height*ae/O.width;let ue=0;for(;ue<ne;)J.addImage(K,"PNG",0,-ue,ae,ne),ue+=se,ue<ne&&J.addPage();const oe="Invoice_"+(String(P.invoice_no||"").replaceAll(" ","_")||new Date().toISOString().slice(0,10))+".pdf";J.save(oe)}finally{document.body.removeChild(G)}}catch(V){ct.error(((L=(Q=V==null?void 0:V.response)==null?void 0:Q.data)==null?void 0:L.message)||"Failed to download invoice")}}const T=M=>{const q={DRAFT:"badge badge-warning",POSTED:"badge badge-success",CANCELLED:"badge badge-error"};return e.jsx("span",{className:q[M]||"badge",children:M})},Y=M=>{const q={UNPAID:"badge badge-error",PARTIALLY_PAID:"badge badge-warning",PAID:"badge badge-success"},z=String(M||"").trim()||"UNPAID";return e.jsx("span",{className:q[z]||"badge",children:z})},H=r.filter(M=>{const q=M.invoice_no.toLowerCase().includes(m.toLowerCase())||M.customer_name.toLowerCase().includes(m.toLowerCase()),z=g==="ALL"||M.status===g;return q&&z});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Sales Invoices"}),e.jsx("p",{className:"text-sm mt-1",children:"Generate and manage customer invoices"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/sales",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/sales/invoices/new",className:"btn-success",children:"+ New Invoice"})]})]})})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by invoice number or customer...",className:"input",value:m,onChange:M=>p(M.target.value)})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs("select",{className:"input",value:g,onChange:M=>x(M.target.value),children:[e.jsx("option",{value:"ALL",children:"All Status"}),e.jsx("option",{value:"DRAFT",children:"Draft"}),e.jsx("option",{value:"POSTED",children:"Posted"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})})]}),d?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-brand"}),e.jsx("p",{className:"mt-2",children:"Loading invoices..."})]}):H.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"No invoices found."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Invoice No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Payment"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Net Amount"}),e.jsx("th",{children:"Actions"}),e.jsx("th",{children:"Payment Type"}),e.jsx("th",{children:"Price Type"}),e.jsx("th",{children:"Warehouse"}),e.jsx("th",{className:"text-right",children:"Balance"}),e.jsx("th",{children:"Remarks"})]})}),e.jsx("tbody",{children:H.map(M=>{var q;return e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:M.invoice_no}),e.jsx("td",{children:new Date(M.invoice_date).toLocaleDateString()}),e.jsx("td",{children:M.customer_name}),e.jsx("td",{children:Y(M.payment_status)}),e.jsx("td",{children:T(M.status)}),e.jsx("td",{className:"font-semibold",children:M.net_amount.toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[s("sales:invoices","view")&&e.jsx("button",{onClick:()=>t(`/sales/invoices/${M.id}?mode=view`),className:"text-brand hover:text-brand-600 font-medium text-sm",children:"View"}),M.status!=="POSTED"&&s("sales:invoices","edit")&&e.jsx("button",{onClick:()=>t(`/sales/invoices/${M.id}`),className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:"Edit"}),e.jsx("button",{onClick:()=>R(M.id),className:"inline-flex items-center px-3 py-1.5 rounded bg-green-600 hover:bg-green-700 text-white text-xs font-semibold",children:"Print"}),e.jsx("button",{onClick:()=>U(M.id),className:"inline-flex items-center px-3 py-1.5 rounded bg-purple-600 hover:bg-purple-700 text-white text-xs font-semibold",children:"PDF"})]})}),e.jsx("td",{children:M.payment_type||""}),e.jsx("td",{children:M.price_type||""}),e.jsx("td",{children:((q=l.find(z=>String(z.id)===String(M.warehouse_id)))==null?void 0:q.warehouse_name)||""}),e.jsx("td",{className:"text-right",children:Number(M.balance_amount||0).toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsx("td",{children:M.remarks||""})]},M.id)})})]})})]})})]})}function G2(){var it,ht,ft,Rt,Ge,at;const t=ps(),{id:s}=Ps(),r=!!s,{user:a}=Kr(),{search:n}=Ur(),i=new URLSearchParams(n),l=i.get("action"),d=i.get("mode")==="view",u=!d,[c,h]=f.useState(!1),[m,p]=f.useState(""),[g,x]=f.useState([]),[b,y]=f.useState([]),[j,N]=f.useState([]),[_,F]=f.useState([]),[I,w]=f.useState([]),[E,W]=f.useState([]),[R,U]=f.useState({invoice_no:"",invoice_date:new Date().toISOString().split("T")[0],customer_id:"",sales_order_id:"",status:"POSTED",warehouse_id:"",price_type:"RETAIL",payment_type:"CASH",currency_id:"",exchange_rate:1,city:"",state:"",country:"",phone:"",remarks:""}),[T,Y]=f.useState([]),[H,M]=f.useState({item_id:"",item_name:"",qty:"",unit_price:"",discount_percent:"",tax_type:"",tax_rate:void 0,remarks:"",uom:""}),q=f.useRef(null),[z,Q]=f.useState({}),[L,V]=f.useState({name:"",address:"",phone:"",email:"",city:"",state:"",postalCode:"",country:"",website:"",taxId:"",registrationNo:"",logoUrl:""}),[P,C]=f.useState(""),[k,B]=f.useState([]),{uoms:G}=$i(),O=Is.useMemo(()=>{const je=Array.isArray(G)?G:[],Se=je.find(nt=>String(nt.uom_code||"").toUpperCase()==="PCS")||je[0];return Se&&Se.uom_code?Se.uom_code:"PCS"},[G]),[K,J]=f.useState({open:!1,itemId:null,defaultUom:"",currentUom:"",rowId:null}),[te,se]=f.useState([]),[ae,ne]=f.useState(!1);f.useEffect(()=>{Z.get("/inventory/unit-conversions").then(je=>{var Se;se(Array.isArray((Se=je.data)==null?void 0:Se.items)?je.data.items:[])}).catch(()=>{se([])})},[]);const ue=je=>!je||typeof je!="string"?je:je.startsWith("INV")&&je.length===9&&/^\d{6}$/.test(je.substring(3))?`INV-${je.substring(3)}`:je,oe=async(je,Se)=>{var nt;if(!je||!Se)return 0;try{const Ze=await Z.get(`/inventory/stock/available?warehouse_id=${je}&item_id=${Se}`);return Number(((nt=Ze.data)==null?void 0:nt.qty)||0)}catch{return 0}};f.useEffect(()=>{if(le(),X(),me(),we(),Ie(),_e(),De(),r)Te();else{const je=Ee(R.invoice_date,R.payment_terms);U(Se=>({...Se,due_date:je})),Z.get("/sales/invoices/next-no").then(Se=>{var Ze;const nt=(Ze=Se.data)==null?void 0:Ze.nextNo;nt&&U(gt=>({...gt,invoice_no:ue(nt)}))}).catch(()=>{U(Se=>({...Se,invoice_no:Se.invoice_no||"INV-000001"}))})}},[r,s]),f.useEffect(()=>{r&&me()},[R.sales_order_id]),f.useEffect(()=>{(async()=>{if(r){if(l==="print"){try{await rt()}catch{}setTimeout(()=>window.print(),200)}else if(l==="pdf"){const Se=q.current;if(!Se)return;const nt=Se.style.cssText;Se.style.cssText=nt+";position:fixed;left:-10000px;top:0;display:block;z-index:-1;background:white;width:794px;padding:32px;";try{const Ze=await wi(Se,{scale:2,useCORS:!0}),gt=Ze.toDataURL("image/png"),jt=new hs("p","mm","a4"),Mt=jt.internal.pageSize.getWidth(),Ne=jt.internal.pageSize.getHeight(),ke=Mt,qe=Ze.height*ke/Ze.width;let ge=0;for(;ge<qe;)jt.addImage(gt,"PNG",0,-ge,ke,qe),ge+=Ne,ge<qe&&jt.addPage();const Me="Invoice_"+(R.invoice_no||new Date().toISOString().slice(0,10))+".pdf";jt.save(Me)}finally{Se.style.cssText=nt}}}})()},[l,r]);const le=async()=>{var je;try{const Se=await Z.get("/sales/customers");x(Array.isArray((je=Se.data)==null?void 0:je.items)?Se.data.items:[])}catch(Se){console.error("Error fetching customers:",Se)}},X=async()=>{var je,Se,nt,Ze;try{const[gt,jt]=await Promise.allSettled([Z.get("/inventory/items"),Z.get("/sales/prices/standard")]),Mt=gt.status==="fulfilled"&&Array.isArray((Se=(je=gt.value)==null?void 0:je.data)==null?void 0:Se.items)?gt.value.data.items:[],Ne=jt.status==="fulfilled"&&Array.isArray((Ze=(nt=jt.value)==null?void 0:nt.data)==null?void 0:Ze.items)?jt.value.data.items:[],ke=new Map;for(const ge of Ne){const Me=ge.product_id;Me&&(ke.has(Me)||ke.set(Me,ge))}const qe=Mt.map(ge=>{const Me=ke.get(ge.id),Ve=Me&&Me.selling_price!==void 0&&Me.selling_price!==null?Number(Me.selling_price):ge.selling_price;return{...ge,selling_price:Ve}});y(qe)}catch(gt){console.error("Error fetching items:",gt),y([])}},me=async()=>{var je,Se,nt;try{const[Ze,gt]=await Promise.all([Z.get("/sales/orders"),Z.get("/sales/invoices")]),jt=Array.isArray((je=Ze.data)==null?void 0:je.items)?Ze.data.items:[],Mt=Array.isArray((Se=gt.data)==null?void 0:Se.items)?gt.data.items:[],Ne=new Set(Mt.map(qe=>qe==null?void 0:qe.sales_order_id).filter(qe=>qe!=null).map(qe=>String(qe)));let ke=jt.filter(qe=>!Ne.has(String(qe.id)));if(r&&R.sales_order_id){const qe=String(R.sales_order_id);if(!ke.some(Me=>String(Me.id)===qe))try{const Ve=(nt=(await Z.get(`/sales/orders/${R.sales_order_id}`)).data)==null?void 0:nt.item;Ve&&(ke=[Ve,...ke])}catch{}}N(ke)}catch(Ze){console.error("Error fetching orders:",Ze)}},we=async()=>{var je;try{const Se=await Z.get("/inventory/warehouses");F(Array.isArray((je=Se.data)==null?void 0:je.items)?Se.data.items:[])}catch(Se){console.error("Error fetching warehouses:",Se)}},Ie=async()=>{var je;try{const Se=await Z.get("/finance/currencies"),nt=Array.isArray((je=Se.data)==null?void 0:je.items)?Se.data.items:[];w(nt);const Ze=nt.find(gt=>String(gt.code||gt.currency_code||"").toUpperCase()==="GHS")||nt.find(gt=>/ghana|cedi/i.test(String(gt.name||gt.currency_name||"")));U(gt=>({...gt,currency_id:gt.currency_id||(Ze==null?void 0:Ze.id)||"",exchange_rate:gt.exchange_rate||1}))}catch(Se){console.error("Error fetching currencies:",Se)}};f.useEffect(()=>{Array.from(new Set(T.map(nt=>String(nt.tax_type)).filter(Boolean))).filter(nt=>!(nt in z)).length&&rt()},[T,z]);const _e=async()=>{var je;try{const Se=await Z.get("/finance/tax-codes"),Ze=(Array.isArray((je=Se.data)==null?void 0:je.items)?Se.data.items:[]).map(gt=>({value:gt.id,label:gt.name,rate:Number(gt.rate_percent)}));W(Ze),Ze.length>0&&!H.tax_type&&M(gt=>({...gt,tax_type:Ze[0].value}))}catch(Se){console.error("Error fetching tax codes:",Se)}},Fe=async()=>{var je;if(R.customer_id)try{const Se=await Z.get(`/sales/prices/customer?customer_id=${R.customer_id}`);B(Array.isArray((je=Se.data)==null?void 0:je.items)?Se.data.items:[])}catch(Se){console.error("Error fetching customer prices:",Se)}},Le=async je=>{var nt;const Se=String(je||"");if(Se)try{const Ze=await Z.get(`/finance/tax-codes/${je}/components`),gt=Array.isArray((nt=Ze.data)==null?void 0:nt.items)?Ze.data.items:[];Q(jt=>({...jt,[Se]:gt}))}catch{}},rt=async()=>{const Se=Array.from(new Set(T.map(nt=>String(nt.tax_type)).filter(Boolean))).filter(nt=>!(nt in z));Se.length&&await Promise.all(Se.map(nt=>Le(nt)))},He=()=>{const je=T.reduce((jt,Mt)=>jt+(Mt.net||0),0),Se={};T.forEach(jt=>{(z[String(jt.tax_type)]||[]).forEach(Ne=>{const ke=Number(Ne.rate_percent)||0,qe=(jt.net||0)*ke/100,ge=Ne.component_name;Se[ge]||(Se[ge]={amount:0,rate:ke,sort_order:Ne.sort_order||0}),Se[ge].amount+=qe})});const nt=Object.keys(Se).map(jt=>({name:jt,amount:Se[jt].amount,rate:Se[jt].rate,sort_order:Se[jt].sort_order})).sort((jt,Mt)=>jt.sort_order-Mt.sort_order),Ze=nt.reduce((jt,Mt)=>jt+Mt.amount,0),gt=je+Ze;return{sub:je,components:nt,taxTotal:Ze,total:gt}},st=()=>{const je=T.reduce((Ne,ke)=>Ne+(ke.sub||0),0),Se=T.reduce((Ne,ke)=>Ne+(ke.discAmt||0),0),nt=T.reduce((Ne,ke)=>Ne+(ke.net||0),0),Ze=He(),gt=T.reduce((Ne,ke)=>Ne+Number(ke.taxAmt||0),0),jt=Ze.taxTotal>0?Ze.taxTotal:gt,Mt=nt+jt;return{grossSub:je,discountTotal:Se,netSub:nt,components:Ze.components,taxTotal:jt,grand:Mt}},De=async()=>{var je,Se,nt,Ze,gt;try{const jt=(a==null?void 0:a.username)||"";C(jt);const Mt=await Z.get("/admin/me"),Ne=(Se=(je=Mt.data)==null?void 0:je.scope)==null?void 0:Se.companyId,ke=((Ze=(nt=Mt.data)==null?void 0:nt.user)==null?void 0:Ze.username)||"";if(!jt&&ke&&C(ke),Ne){const ge=((gt=(await Z.get(`/admin/companies/${Ne}`)).data)==null?void 0:gt.item)||{};V(Me=>({...Me,name:ge.name||Me.name||"",address:ge.address||Me.address||"",phone:ge.telephone||Me.phone||"",email:ge.email||Me.email||"",city:ge.city||Me.city||"",state:ge.state||Me.state||"",postalCode:ge.postal_code||Me.postalCode||"",country:ge.country||Me.country||"",website:ge.website||Me.website||"",taxId:ge.tax_id||Me.taxId||"",registrationNo:ge.registration_no||Me.registrationNo||"",logoUrl:ge.has_logo===1||ge.has_logo===!0?`/api/admin/companies/${Ne}/logo`:Ws}))}else V(qe=>({...qe,logoUrl:qe.logoUrl||Ws}))}catch{a!=null&&a.username&&C(a.username),V(jt=>({...jt,logoUrl:jt.logoUrl||Ws}))}},Te=async()=>{var je,Se,nt,Ze;try{h(!0);const gt=await Z.get(`/sales/invoices/${s}`),jt=(je=gt.data)==null?void 0:je.item;if(jt){U({invoice_no:jt.invoice_no||"",invoice_date:be(jt.invoice_date||new Date),customer_id:jt.customer_id||"",status:jt.status||"POSTED",due_date:be(jt.due_date||""),city:"",state:"",country:"",phone:"",remarks:jt.remarks||"",warehouse_id:jt.warehouse_id||"",price_type:jt.price_type||"RETAIL",payment_type:jt.payment_type||"CASH",currency_id:jt.currency_id||"",exchange_rate:Number(jt.exchange_rate||1),sales_order_id:jt.sales_order_id||""});const Mt=g.find(Ne=>String(Ne.id)===String(jt.customer_id));Mt&&U(Ne=>({...Ne,city:Mt.city||"",state:Mt.state||"",country:Mt.country||"",phone:Mt.phone||Mt.customer_phone||""}))}if((Se=gt.data)!=null&&Se.details){let Mt=gt.data.details.map((ke,qe)=>{var Jt;const ge=Math.round(Number(ke.quantity||0)*100)/100,Me=Math.round(Number(ke.unit_price||0)*100)/100,Ve=Math.round(Number(ke.discount_percent||0)*100)/100,vt=ke.tax_id||"",St=ke.tax_rate!==void 0&&ke.tax_rate!==null?Number(ke.tax_rate):((Jt=E.find(Gt=>String(Gt.value)===String(vt)))==null?void 0:Jt.rate)||0,xt=ye({qty:ge,unit_price:Me,discount_percent:Ve,tax_type:vt}),Ct=ke.net_amount!==void 0&&ke.net_amount!==null?Math.round(Number(ke.net_amount)*100)/100:xt.net,Tt=ke.tax_amount!==void 0&&ke.tax_amount!==null?Math.round(Number(ke.tax_amount)*100)/100:xt.taxAmt,bt=ke.total_amount!==void 0&&ke.total_amount!==null?Math.round(Number(ke.total_amount)*100)/100:xt.total;return{line_id:qe+1,item_id:ke.item_id,item_name:ke.item_name||"",remarks:ke.remarks||"",qty:ge,unit_price:Me,discount_percent:Ve,tax_rate:St,tax_type:vt,sub:Math.round(Number(ge*Me)*100)/100,discAmt:Math.round(Number(ge*Me*Ve/100)*100)/100,net:Ct,taxAmt:Tt,total:bt}});const Ne=jt.warehouse_id||R.warehouse_id||"";Ne&&(Mt=await Promise.all(Mt.map(async qe=>({...qe,available_qty:await oe(Ne,qe.item_id)})))),Y(Mt)}}catch(gt){p(((Ze=(nt=gt==null?void 0:gt.response)==null?void 0:nt.data)==null?void 0:Ze.message)||"Error fetching invoice"),console.error("Error fetching invoice:",gt)}finally{h(!1)}};async function Ce(je){try{const Se=[...T],nt=await Promise.all(Se.map(async Ze=>{if(!Ze.item_id){const jt={...Ze};return{...jt,...ye(jt)}}try{const jt=await Z.post("/sales/prices/best-price",{product_id:Ze.item_id,customer_id:R.customer_id,quantity:Number(Ze.qty||1),date:R.invoice_date,price_type:typeof je=="string"?je:String(je||""),only_standard:!0});if(jt.data&&jt.data.price!==void 0){const Mt={...Ze,unit_price:Math.round(Number(jt.data.price||0)*100)/100};return{...Mt,...ye(Mt)}}}catch{}const gt={...Ze};return{...gt,...ye(gt)}}));Y(nt)}catch{}}function Pe(je,Se){let nt={...R,[je]:Se};if(je==="customer_id"){const Ze=g.find(gt=>gt.id==Se);nt.city=(Ze==null?void 0:Ze.city)||"",nt.state=(Ze==null?void 0:Ze.state)||"",nt.country=(Ze==null?void 0:Ze.country)||"",nt.phone=(Ze==null?void 0:Ze.phone)||(Ze==null?void 0:Ze.customer_phone)||"",Fe()}je==="sales_order_id"&&Se&&fe(Se),je==="price_type"&&Ce(Se),U(nt)}async function fe(je){var Se,nt;try{const Ze=await Z.get(`/sales/orders/${je}`),gt=(Se=Ze.data)==null?void 0:Se.item,jt=Array.isArray((nt=Ze.data)==null?void 0:nt.details)?Ze.data.details:[];if(gt&&U(Mt=>({...Mt,customer_id:gt.customer_id||Mt.customer_id,warehouse_id:gt.warehouse_id||Mt.warehouse_id||""})),jt.length){let Mt=jt.map(ke=>{var bt;const qe=Math.round(Number(ke.qty||0)*100)/100,ge=Math.round(Number(ke.unit_price||0)*100)/100,Me=Math.round(Number(ke.discount_percent||0)*100)/100,Ve=ke.tax_id||"",vt=ye({qty:qe,unit_price:ge,discount_percent:Me,tax_type:Ve}),St=ke.tax_rate!==void 0&&ke.tax_rate!==null?Number(ke.tax_rate):((bt=E.find(Jt=>String(Jt.value)===String(Ve)))==null?void 0:bt.rate)||0,xt=ke.tax_amount!==void 0&&ke.tax_amount!==null?Math.round(Number(ke.tax_amount)*100)/100:vt.taxAmt,Ct=ke.total_amount!==void 0&&ke.total_amount!==null?Math.round(Number(ke.total_amount)*100)/100:vt.total,Tt=b.find(Jt=>Jt.id==ke.item_id);return{line_id:Date.now()+Math.random(),item_id:ke.item_id,item_name:ke.item_name||(Tt==null?void 0:Tt.item_name)||"",qty:qe,unit_price:ge,discount_percent:Me,tax_type:Ve,tax_rate:St,...vt,taxAmt:xt,total:Ct}});const Ne=(gt==null?void 0:gt.warehouse_id)||R.warehouse_id||"";Ne&&(Mt=await Promise.all(Mt.map(async qe=>({...qe,available_qty:await oe(Ne,qe.item_id)})))),Y(Mt)}}catch(Ze){console.error("Failed to apply order to invoice",Ze)}}function he(je){const{name:Se,value:nt}=je.target;if(Se==="item_id"){const Ze=b.find(gt=>gt.id===parseInt(nt));if(M(gt=>({...gt,item_id:nt,item_name:(Ze==null?void 0:Ze.item_name)||"",unit_price:"",qty:1,uom:String((Ze==null?void 0:Ze.uom)||"")||O})),nt){{const jt={product_id:nt,quantity:1,date:R.invoice_date,price_type:typeof R.price_type=="string"?R.price_type:String(R.price_type||""),only_standard:!0,...R.customer_id?{customer_id:R.customer_id}:{}};Z.post("/sales/prices/best-price",jt).then(Mt=>{Mt.data&&Mt.data.price!==void 0&&M(Ne=>({...Ne,unit_price:Math.round(Number(Mt.data.price||0)*100)/100}))}).catch(Mt=>console.error("Error fetching price:",Mt))}Z.get(`/finance/item-tax/${nt}`).then(jt=>{var Ne,ke,qe;const Mt=(Ne=jt.data)==null?void 0:Ne.tax;if(Mt){const ge=Mt.id||((ke=E.find(Ve=>Ve.code===Mt.tax_code))==null?void 0:ke.value)||null,Me=ge?(qe=E.find(Ve=>String(Ve.value)===String(ge)))==null?void 0:qe.rate:null;M(Ve=>({...Ve,tax_type:ge??Ve.tax_type,tax_rate:Me??Mt.tax_rate}))}else M(ge=>({...ge,tax_rate:void 0}))}).catch(()=>{M(jt=>({...jt,tax_rate:void 0}))});const gt=R.warehouse_id;gt?oe(gt,Number(nt)).then(jt=>M(Mt=>({...Mt,available_qty:jt}))):M(jt=>({...jt,available_qty:void 0}))}}else if(Se==="unit_price"||Se==="qty"||Se==="discount_percent"){const Ze=nt===""?"":Math.round(Number(nt)*100)/100;M(gt=>({...gt,[Se]:Ze}))}else M(Ze=>({...Ze,[Se]:nt}))}function Ue(){if(!H.item_id||!H.qty||!H.unit_price)return;if(R.warehouse_id&&H.available_qty!==void 0&&Number(H.qty||0)>Number(H.available_qty||0)){ct.error("Quantity exceeds available stock for selected warehouse");return}const je=ye(H);Y(Se=>[...Se,{...H,line_id:Date.now(),...je,available_qty:H.available_qty,uom:H.uom||O}]),M({item_id:"",item_name:"",qty:"",unit_price:"",discount_percent:"",tax_type:E.length>0?E[0].value:"",tax_rate:void 0,remarks:"",available_qty:void 0,uom:O})}async function Ye(je,Se){try{const nt={product_id:Se,quantity:1,date:R.invoice_date,price_type:typeof R.price_type=="string"?R.price_type:String(R.price_type||""),only_standard:!0,...R.customer_id?{customer_id:R.customer_id}:{}},Ze=await Z.post("/sales/prices/best-price",nt);Ze.data&&Ze.data.price!==void 0&&Y(gt=>gt.map((jt,Mt)=>{if(Mt!==je)return jt;const Ne={...jt,unit_price:Math.round(Number(Ze.data.price||0)*100)/100};return{...Ne,...ye(Ne)}}))}catch(nt){console.error("Error fetching price:",nt)}}function Ke(je,Se){Se.item_id&&Ye(je,Se.item_id),Y(nt=>nt.map((Ze,gt)=>{var Mt;if(gt!==je)return Ze;let jt={...Ze,...Se};if("unit_price"in Se&&(jt.unit_price=Se.unit_price===""||Se.unit_price==null?"":Math.round(Number(Se.unit_price)*100)/100),"qty"in Se&&(jt.qty=Se.qty===""||Se.qty==null?"":Math.round(Number(Se.qty)*100)/100),"discount_percent"in Se&&(jt.discount_percent=Se.discount_percent===""||Se.discount_percent==null?"":Math.round(Number(Se.discount_percent)*100)/100),Se.item_id){const Ne=b.find(ke=>ke.id==Se.item_id);if(jt.item_name=(Ne==null?void 0:Ne.item_name)||jt.item_name||"",jt.uom=jt.uom||String((Ne==null?void 0:Ne.uom)||"")||O,dt(Se.item_id,ke=>{jt.tax_rate=ke==null?void 0:ke.tax_rate,jt.tax_type=(ke==null?void 0:ke.tax_code)||jt.tax_type||"VAT15"}),R.warehouse_id)return oe(Number(R.warehouse_id),Number(Se.item_id)).then(ke=>{Y(qe=>qe.map((ge,Me)=>Me===je?{...jt,available_qty:ke,...ye(jt)}:ge))}),jt}if(Se.tax_type){const Ne=((Mt=E.find(ke=>String(ke.value)===String(Se.tax_type)))==null?void 0:Mt.rate)||0;jt.tax_rate=Ne}return jt={...jt,...ye(jt)},jt}))}function Je(je){const Se=b.find(nt=>String(nt.id)===String(je));return Se&&Se.item_code||""}function xe(je){Y(Se=>Se.filter(nt=>nt.line_id!==je))}function ye(je){var ge;const Se=Math.round(Number(je.qty||0)*100)/100,nt=Math.round(Number(je.unit_price||0)*100)/100,Ze=Math.round(Number(je.discount_percent||0)*100)/100,gt=Math.round(Se*nt*100)/100,jt=Math.round(gt*Ze/100*100)/100,Mt=Math.round((gt-jt)*100)/100,Ne=((ge=E.find(Me=>String(Me.value)===String(je.tax_type)))==null?void 0:ge.rate)||0,ke=Math.round(Mt*Ne/100*100)/100,qe=Math.round((Mt+ke)*100)/100;return{sub:gt,discAmt:jt,net:Mt,taxAmt:ke,total:qe,line_total:qe}}f.useEffect(()=>{const je=R.warehouse_id;if(!je){Y(Se=>Se.map(nt=>({...nt,available_qty:void 0}))),M(Se=>({...Se,available_qty:void 0}));return}(async()=>{const Se=await Promise.all(T.map(async nt=>({...nt,available_qty:await oe(je,nt.item_id)})));if(Y(Se),H.item_id){const nt=await oe(je,Number(H.item_id));M(Ze=>({...Ze,available_qty:nt}))}})()},[R.warehouse_id]);function Ae(){const je=T.reduce((nt,Ze)=>nt+Number(Ze.net||0),0),Se=T.reduce((nt,Ze)=>nt+Number(Ze.taxAmt||0),0);return{sub:je,tax:Se,total:je+Se}}function be(je){if(!je)return"";if(je instanceof Date)return je.toISOString().split("T")[0];const Se=String(je);return Se.includes("T")?Se.split("T")[0]:Se.slice(0,10)}function Ee(je,Se){if(!je)return"";const nt=new Date(je);return nt.setDate(nt.getDate()+Number(Se||0)),nt.toISOString().split("T")[0]}function dt(je,Se){Z.get(`/finance/item-tax/${je}`).then(nt=>{var Ze;return Se(((Ze=nt.data)==null?void 0:Ze.tax)||null)}).catch(()=>Se(null))}async function mt(je){var Se,nt,Ze,gt,jt,Mt,Ne,ke,qe,ge,Me,Ve;je.preventDefault(),h(!0),p("");try{if(!R.warehouse_id){ct.error("Select Warehouse before saving the invoice"),h(!1);return}const St=H.item_id&&H.qty&&H.unit_price?[...T,{...H,...ye(H)}]:[...T];if(!St.length){ct.error("Add at least one item before saving the invoice"),h(!1);return}const xt=new Date().toISOString().slice(0,10).replace(/-/g,"");let Ct=R.invoice_no;if(!Ct){const Gt=Math.floor(Math.random()*1e3).toString().padStart(3,"0");Ct=`INV-${xt}-${Gt}`}const Tt=(()=>{const Gt=St.reduce((es,js)=>es+Number(js.net||0),0),Ht=St.reduce((es,js)=>es+Number(js.taxAmt||0),0);return{sub:Gt,tax:Ht,total:Gt+Ht}})(),bt={...R,invoice_date:be(R.invoice_date),invoice_no:Ct,customer_id:Number(R.customer_id),due_date:be(R.due_date)||null,warehouse_id:R.warehouse_id?Number(R.warehouse_id):null,price_type:R.price_type,payment_type:R.payment_type,currency_id:R.currency_id?Number(R.currency_id):null,exchange_rate:Number(R.exchange_rate||1),total_amount:Math.round(Number(Tt.total||0)*100)/100,tax_amount:Math.round(Number(Tt.tax||0)*100)/100,net_amount:Math.round(Number(Tt.sub||0)*100)/100,...R.sales_order_id?{sales_order_id:Number(R.sales_order_id)}:{},items:St.map(Gt=>{var Xs;const Ht=Gt.tax_type,es=Number(Ht);let js=Number.isFinite(es)&&es>0?es:null;if(!js&&Ht){const Hs=E.find(Bs=>String(Bs.label||"").toUpperCase()===String(Ht||"").toUpperCase());Hs&&(js=Number(Hs.value))}const Zs=((Xs=E.find(Hs=>Number(Hs.value)===Number(js)))==null?void 0:Xs.rate)||0;return{item_id:Gt.item_id,quantity:Math.round(Number(Gt.qty||0)*100)/100,unit_price:Math.round(Number(Gt.unit_price||0)*100)/100,discount_percent:Math.round(Number(Gt.discount_percent||0)*100)/100,tax_id:js||null,tax_rate:Zs,tax_amount:Math.round(Number(Gt.taxAmt||0)*100)/100,total_amount:Math.round(Number(Gt.total||0)*100)/100,net_amount:Math.round(Number(Gt.net||0)*100)/100,uom:String(Gt.uom||O)}})};let Jt=0;if(r){const Gt=await Z.put(`/sales/invoices/${s}`,bt);Jt=Number(((Se=Gt==null?void 0:Gt.data)==null?void 0:Se.id)||s)}else{const Gt=await Z.post("/sales/invoices",bt);Jt=Number(((nt=Gt==null?void 0:Gt.data)==null?void 0:nt.id)||0)}try{const Gt=await Z.post(`/sales/invoices/${Jt}/submit`),Ht=((Ze=Gt==null?void 0:Gt.data)==null?void 0:Ze.payment_status)||"UNPAID";if(ct.success(`Invoice ${Ct} saved and submitted (${Ht})`),ae)try{const es=await Z.get("/sales/deliveries/next-no"),js=((gt=es==null?void 0:es.data)==null?void 0:gt.nextNo)||"",Zs={delivery_no:js||`DN${String(Date.now()).slice(-6)}`,delivery_date:be(R.invoice_date),customer_id:Number(R.customer_id),sales_order_id:R.sales_order_id?Number(R.sales_order_id):null,invoice_id:Jt||null,remarks:`Auto delivery for invoice ${Ct}`,status:"DELIVERED",items:St.map(Bs=>({item_id:Number(Bs.item_id),quantity:Math.round(Number(Bs.qty||0)*100)/100,unit_price:Math.round(Number(Bs.unit_price||0)*100)/100,uom:String(Bs.uom||O)}))},Xs=await Z.post("/sales/deliveries",Zs),Hs=js||Zs.delivery_no;(Mt=(jt=Xs==null?void 0:Xs.data)==null?void 0:jt.item)!=null&&Mt.delivery_no?ct.success(`Delivery ${Xs.data.item.delivery_no} created automatically`):ct.success(`Delivery ${Hs} created automatically`)}catch(es){const js=((ke=(Ne=es==null?void 0:es.response)==null?void 0:Ne.data)==null?void 0:ke.message)||"Failed to create delivery note";ct.error(js)}t("/sales/invoices")}catch(Gt){const Ht=((ge=(qe=Gt==null?void 0:Gt.response)==null?void 0:qe.data)==null?void 0:ge.message)||"Failed to submit invoice";/already submitted/i.test(Ht)?(ct.info(`Invoice ${Ct} already submitted`),t("/sales/invoices")):(/no line items/i.test(Ht)||/warehouse_id is required/i.test(Ht)||/insufficient stock/i.test(Ht),ct.error(Ht))}}catch(vt){const St=((Ve=(Me=vt==null?void 0:vt.response)==null?void 0:Me.data)==null?void 0:Ve.message)||"Error saving invoice";p(St),ct.error(St)}finally{h(!1)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("style",{children:`
        @media print {
          @page { margin: 1cm; }
          body { 
            background: white; 
            -webkit-print-color-adjust: exact; 
            print-color-adjust: exact; 
          }
          #root > div > header,
          #root > div > div > aside { display: none !important; }
          .print\\:hidden { display: none !important; }
          .print\\:block { display: block !important; }
          #root > div > div > main { padding: 0 !important; }
          input, select, textarea {
            border: none !important;
            background: transparent !important;
            padding: 0 !important;
            appearance: none !important;
            -webkit-appearance: none !important;
            resize: none;
            overflow: visible;
          }
        }
        .quotation-table { 
          border-collapse: collapse; 
          table-layout: fixed; 
          width: 100%; 
          max-width: 100%; 
          border-spacing: 0; 
          box-sizing: border-box;
          margin: 0 auto;
        }
        .quotation-table th, .quotation-table td { 
          border: 1px solid #000000; 
          box-sizing: border-box; 
          word-break: break-word; 
          overflow-wrap: anywhere; 
          white-space: normal; 
          padding: 6px 4px;
          font-size: 10px;
        }
        .quotation-table thead th { 
          background: #0E3646; 
          color: #ffffff; 
        }
        .quotation-table thead th:last-child,
        .quotation-table tbody td:last-child {
          background: #ffffff;
          color: #000000;
        }
        .quotation-table thead th:last-child {
          border-top: 1px solid #ffffff;
          border-right: 1px solid #ffffff;
          border-bottom: 1px solid #ffffff;
          border-left: 1px solid #000000;
        }
        .quotation-table tbody td:last-child {
          border-top: 1px solid #ffffff;
          border-right: 1px solid #ffffff;
          border-bottom: 1px solid #ffffff;
          border-left: 1px solid #000000;
        }
        @media print {
          .quotation-table {
            width: 100%;
            max-width: 100%;
          }
          .quotation-table thead th:last-child,
          .quotation-table tbody td:last-child {
            background: #ffffff !important;
            color: #000000 !important;
          }
          .quotation-table thead th:last-child {
            border-top: 1px solid #ffffff !important;
            border-right: 1px solid #ffffff !important;
            border-bottom: 1px solid #ffffff !important;
            border-left: 1px solid #000000 !important;
          }
          .quotation-table tbody td:last-child {
            border-top: 1px solid #ffffff !important;
            border-right: 1px solid #ffffff !important;
            border-bottom: 1px solid #ffffff !important;
            border-left: 1px solid #000000 !important;
          }
        }
      `}),e.jsx("div",{className:"card print:hidden",children:e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"Edit Invoice":"New Invoice"}),e.jsx("p",{className:"text-sm mt-1",children:"Create and manage sales invoices"})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("button",{type:"button",onClick:async()=>{try{await rt()}catch{}window.print()},className:"btn-secondary",title:"Print",children:[e.jsx(tA,{className:"w-4 h-4 inline mr-1"}),"Print"]}),e.jsxs("button",{type:"button",onClick:async()=>{const je=q.current;if(!je)return;const Se=je.style.cssText;je.style.cssText=Se+";position:fixed;left:-10000px;top:0;display:block;z-index:-1;background:white;width:794px;padding:32px;";try{const nt=await wi(je,{scale:2,useCORS:!0}),Ze=nt.toDataURL("image/png"),gt=new hs("p","mm","a4"),jt=gt.internal.pageSize.getWidth(),Mt=gt.internal.pageSize.getHeight(),Ne=jt,ke=nt.height*Ne/nt.width;let qe=0;for(;qe<ke;)gt.addImage(Ze,"PNG",0,-qe,Ne,ke),qe+=Mt,qe<ke&&gt.addPage();const ge="Invoice_"+(R.invoice_no||new Date().toISOString().slice(0,10))+".pdf";gt.save(ge)}finally{je.style.cssText=Se}},className:"btn-secondary",title:"Download PDF",children:[e.jsx(Cc,{className:"w-4 h-4 inline mr-1"}),"Download PDF"]}),e.jsx(Re,{to:"/sales/invoices",className:"btn-success",children:"Back"})]})]})})}),e.jsx("form",{onSubmit:mt,className:"print:hidden",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Invoice #"}),e.jsx("input",{className:"input bg-gray-50",value:R.invoice_no,onChange:je=>Pe("invoice_no",je.target.value),placeholder:"Auto-generated",readOnly:!r&&!R.invoice_no,disabled:d})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Invoice Date *"}),e.jsx("input",{className:"input",type:"date",value:R.invoice_date,onChange:je=>Pe("invoice_date",je.target.value),required:!0,disabled:d})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Customer *"}),e.jsxs("select",{className:"input",value:R.customer_id,onChange:je=>Pe("customer_id",je.target.value),required:!0,disabled:d,children:[e.jsx("option",{value:"",children:"Select Customer"}),g.map(je=>e.jsx("option",{value:je.id,children:je.customer_name},je.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Warehouse"}),e.jsxs("select",{className:"input",value:R.warehouse_id,onChange:je=>Pe("warehouse_id",je.target.value),required:!0,disabled:d,children:[e.jsx("option",{value:"",children:"Select Warehouse"}),_.map(je=>e.jsxs("option",{value:je.id,children:[je.warehouse_code," - ",je.warehouse_name]},je.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Sales Order"}),e.jsxs("select",{className:"input",value:R.sales_order_id,onChange:je=>Pe("sales_order_id",je.target.value),disabled:d,children:[e.jsx("option",{value:"",children:"Select Sales Order (Optional)"}),j.map(je=>e.jsx("option",{value:je.id,children:je.order_no},je.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Price Type"}),e.jsxs("select",{className:"input",value:R.price_type,onChange:je=>Pe("price_type",je.target.value),disabled:d,children:[e.jsx("option",{value:"RETAIL",children:"Retail"}),e.jsx("option",{value:"WHOLESALE",children:"Wholesale"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Payment Type"}),e.jsxs("select",{className:"input",value:R.payment_type,onChange:je=>Pe("payment_type",je.target.value),disabled:d,children:[e.jsx("option",{value:"CASH",children:"Cash"}),e.jsx("option",{value:"CHEQUE",children:"Cheque"}),e.jsx("option",{value:"CREDIT",children:"Credit"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsxs("select",{className:"input",value:R.currency_id,onChange:je=>Pe("currency_id",je.target.value),disabled:d,children:[e.jsx("option",{value:"",children:"Select Currency"}),I.map(je=>e.jsxs("option",{value:je.id,children:[je.code," - ",je.name]},je.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"City"}),e.jsx("input",{className:"input bg-gray-50",value:R.city,onChange:je=>Pe("city",je.target.value),placeholder:"Auto",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"State"}),e.jsx("input",{className:"input bg-gray-50",value:R.state,onChange:je=>Pe("state",je.target.value),placeholder:"Auto",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Country"}),e.jsx("input",{className:"input bg-gray-50",value:R.country,onChange:je=>Pe("country",je.target.value),placeholder:"Auto",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Phone"}),e.jsx("input",{className:"input bg-gray-50",value:R.phone,onChange:je=>Pe("phone",je.target.value),placeholder:"Auto",readOnly:!0})]})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("div",{className:"font-semibold",children:"Invoice Items"})}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-6 border border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-7 gap-3 mb-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Item *"}),e.jsxs("select",{name:"item_id",value:H.item_id,onChange:he,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:[e.jsx("option",{value:"",children:"Select Item"}),b.map(je=>e.jsxs("option",{value:je.id,children:[je.item_code," - ",je.item_name]},je.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"UOM *"}),e.jsx("select",{name:"uom",value:H.uom||O,onChange:he,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:(Array.isArray(G)?G:[]).map(je=>e.jsx("option",{value:je.uom_code,children:je.uom_name?`${je.uom_name} (${je.uom_code})`:je.uom_code},je.id))}),(()=>{const je=b.find(gt=>String(gt.id)===String(H.item_id)),Se=(je==null?void 0:je.uom)&&String(je.uom)||H.uom&&String(H.uom)||(O?String(O):""),nt=String(H.uom||"");return nt&&Se&&nt!==Se&&String(H.item_id||"")?e.jsx("button",{type:"button",className:"mt-2 px-2 py-1 text-xs border border-brand text-brand rounded hover:bg-brand hover:text-white transition-colors",onClick:()=>J({open:!0,itemId:H.item_id,defaultUom:Se,currentUom:nt}),children:`number of ${nt}`}):null})()]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Qty *"}),e.jsx("input",{type:"number",name:"qty",value:H.qty===""?"":H.qty,onChange:he,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",min:"1",step:"1"})]}),e.jsx("div",{className:"flex items-end",children:(()=>{const je=b.find(jt=>String(jt.id)===String(H.item_id)),Se=(je==null?void 0:je.uom)&&String(je.uom)||H.uom&&String(H.uom)||(O?String(O):""),nt=(Array.isArray(te)?te:[]).filter(jt=>Number(jt.is_active)&&String(jt.to_uom)===Se&&Number(jt.item_id)===Number(H.item_id)).map(jt=>String(jt.from_uom)),Ze=nt[0]||"";return nt.length>0&&Ze&&Ze!==Se?e.jsx("button",{type:"button",className:"ml-2 px-2 py-1 text-xs border border-brand text-brand rounded hover:bg-brand hover:text-white transition-colors",onClick:()=>J({open:!0,itemId:H.item_id,defaultUom:Se,currentUom:Ze,rowId:null}),children:`number of ${Ze}`}):null})()}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Available"}),e.jsx("input",{type:"text",value:R.warehouse_id?Number(H.available_qty||0).toFixed(2):"",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg bg-gray-50",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Price *"}),e.jsx("input",{type:"number",name:"unit_price",value:H.unit_price===""?"":H.unit_price,onChange:he,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",step:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Disc %"}),e.jsx("input",{type:"number",name:"discount_percent",value:H.discount_percent===""?"":H.discount_percent,onChange:he,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",min:"0",max:"100",step:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tax"}),e.jsx("select",{name:"tax_type",value:H.tax_type,onChange:he,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0E3646]",children:E.map(je=>e.jsx("option",{value:je.value,children:je.label},je.value))}),H.tax_rate!==void 0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Tax rate: ",Number(H.tax_rate).toFixed(2),"%"]})]})]}),e.jsx("div",{className:"flex justify-end",children:!d&&e.jsxs("button",{type:"button",onClick:Ue,className:"bg-[#0E3646] text-white px-4 py-2 rounded-lg hover:bg-[#092530] flex items-center gap-2 transition-colors text-sm",children:[e.jsx(Ec,{className:"w-4 h-4"})," Add Item"]})})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"24rem"}}),e.jsx("col",{style:{width:"10rem"}}),e.jsx("col",{style:{width:"9rem"}}),e.jsx("col",{style:{width:"8rem"}}),e.jsx("col",{style:{width:"10rem"}}),e.jsx("col",{style:{width:"8rem"}}),e.jsx("col",{style:{width:"10rem"}}),e.jsx("col",{style:{width:"8rem"}}),e.jsx("col",{style:{width:"12rem"}}),e.jsx("col",{style:{width:"8rem"}}),e.jsx("col",{style:{width:"8rem"}}),e.jsx("col",{style:{width:"9rem"}}),e.jsx("col",{style:{width:"16rem"}}),e.jsx("col",{style:{width:"8rem"}})]}),e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Item"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Code"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"UOM"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Convert"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Available"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Disc%"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Tax Code"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Net"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Tax"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Remarks"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:T.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"px-4 py-8 text-center text-gray-500",children:"No items added yet"})}):T.map((je,Se)=>{var nt;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:u?e.jsxs("select",{className:"input w-full min-w-[20rem]",value:je.item_id,onChange:Ze=>Ke(Se,{item_id:Number(Ze.target.value)}),children:[e.jsx("option",{value:"",children:"Select Item"}),b.map(Ze=>e.jsxs("option",{value:Ze.id,children:[Ze.item_code," - ",Ze.item_name]},Ze.id))]}):je.item_name}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:Je(je.item_id)}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:u?e.jsx("select",{className:"input w-full min-w-[7rem]",value:je.uom||O,onChange:Ze=>Ke(Se,{uom:Ze.target.value}),children:(Array.isArray(G)?G:[]).map(Ze=>e.jsx("option",{value:Ze.uom_code,children:Ze.uom_name?`${Ze.uom_name} (${Ze.uom_code})`:Ze.uom_code},Ze.id))}):je.uom||O}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:u?e.jsx("input",{className:"input w-full min-w-[7rem]",type:"number",min:"0",step:"0.01",value:je.qty===""?"":je.qty,onChange:Ze=>Ke(Se,{qty:Ze.target.value===""?"":Number(Ze.target.value)})}):je.qty}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:(()=>{const Ze=b.find(ke=>String(ke.id)===String(je.item_id)),gt=(Ze==null?void 0:Ze.uom)&&String(Ze.uom)||je.uom&&String(je.uom)||(O?String(O):""),jt=(Array.isArray(te)?te:[]).filter(ke=>Number(ke.is_active)&&String(ke.to_uom)===gt&&Number(ke.item_id)===Number(je.item_id)).map(ke=>String(ke.from_uom)),Mt=jt[0]||"";return jt.length>0&&Mt&&Mt!==gt?e.jsx("button",{type:"button",className:"px-2 py-1 text-xs border border-brand text-brand rounded hover:bg-brand hover:text-white transition-colors",onClick:()=>J({open:!0,itemId:je.item_id,defaultUom:gt,currentUom:Mt,rowId:je.line_id}),children:`number of ${Mt}`}):null})()}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:R.warehouse_id?Number(je.available_qty||0).toFixed(2):""}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:u?e.jsx("input",{className:"input w-full min-w-[8rem]",type:"number",step:"0.01",value:je.unit_price===""?"":je.unit_price,onChange:Ze=>Ke(Se,{unit_price:Ze.target.value===""?"":Number(Ze.target.value)})}):parseFloat(je.unit_price).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:u?e.jsx("input",{className:"input w-full min-w-[7rem]",type:"number",min:"0",max:"100",step:"1",value:je.discount_percent===""?"":je.discount_percent||0,onChange:Ze=>Ke(Se,{discount_percent:Ze.target.value===""?"":Number(Ze.target.value)})}):parseFloat(je.discount_percent||0).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:u?e.jsx("select",{className:"input w-full min-w-[9rem]",value:je.tax_type,onChange:Ze=>Ke(Se,{tax_type:Ze.target.value}),children:E.map(Ze=>e.jsx("option",{value:Ze.value,children:Ze.label},Ze.value))}):((nt=E.find(Ze=>String(Ze.value)===String(je.tax_type)))==null?void 0:nt.label)||""}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:Number(je.net||0).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:Number(je.taxAmt||0).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:Number(je.total||0).toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:u?e.jsx("input",{className:"input w-full min-w-[12rem]",type:"text",value:je.remarks||"",onChange:Ze=>Ke(Se,{remarks:Ze.target.value})}):je.remarks||""}),e.jsx("td",{className:"px-4 py-3",children:u&&e.jsx("button",{type:"button",onClick:()=>xe(je.line_id),className:"text-red-600 hover:text-red-900 transition-colors",children:"Discard"})})]},je.line_id)})}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"7",className:"px-4 py-3 text-right font-semibold text-gray-700",children:"Totals:"}),e.jsx("td",{className:"px-4 py-3 font-bold text-gray-900",children:Ae().sub.toFixed(2)}),e.jsx("td",{className:"px-4 py-3 font-bold text-gray-900",children:Ae().tax.toFixed(2)}),e.jsx("td",{className:"px-4 py-3 font-bold text-gray-900",children:Ae().total.toFixed(2)}),e.jsx("td",{})]})})]})}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{children:st().grossSub.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Total Discount:"}),e.jsx("span",{children:st().discountTotal.toFixed(2)})]}),st().components.length>0&&st().components.map(je=>e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsxs("span",{children:[je.name," [",je.rate,"%]"]}),e.jsx("span",{children:je.amount.toFixed(2)})]},je.name)),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Total Tax:"}),e.jsx("span",{children:st().taxTotal.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between font-semibold text-slate-900",children:[e.jsx("span",{children:"Grand Total:"}),e.jsx("span",{children:st().grand.toFixed(2)})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Remarks / Notes"}),e.jsx("textarea",{className:"input",rows:3,value:R.remarks,onChange:je=>Pe("remarks",je.target.value),placeholder:"Additional notes or terms...",disabled:d})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/sales/invoices",className:"btn-success",children:"Cancel"}),e.jsxs("label",{className:"flex items-center gap-2 mr-4",children:[e.jsx("input",{type:"checkbox",checked:ae,onChange:je=>ne(je.target.checked),disabled:d||c}),e.jsx("span",{className:"text-sm",children:"Auto Delivery"})]}),!d&&e.jsx("button",{className:"btn-success",type:"submit",disabled:c,children:c?"Saving...":"Save Invoice"})]})]})})}),e.jsxs("div",{className:"hidden print:block p-8 max-w-[19cm] mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:L.logoUrl||Ws,alt:L.name||"Company",className:"w-16 h-16 object-contain border border-gray-300"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold text-base",children:L.name||"Company"}),L.address&&e.jsx("div",{children:L.address}),(L.city||L.state||L.country)&&e.jsx("div",{children:[L.city,L.state,L.country].filter(Boolean).join(", ")}),e.jsxs("div",{className:"flex gap-3",children:[L.phone&&e.jsx("span",{children:L.phone}),L.email&&e.jsx("span",{children:L.email})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-xl font-semibold",children:"Invoice"})}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{children:["DATE: ",R.invoice_date||""]}),e.jsxs("div",{children:["Invoice #: ",R.invoice_no||""]}),e.jsxs("div",{children:["Customer:"," ",((it=g.find(je=>String(je.id)===String(R.customer_id)))==null?void 0:it.customer_name)||""]}),e.jsxs("div",{children:["City: ",R.city||""]}),e.jsxs("div",{children:["State: ",R.state||""]}),e.jsxs("div",{children:["Country: ",R.country||""]}),e.jsxs("div",{children:["Phone: ",R.phone||""]}),e.jsxs("div",{children:["Price Type: ",R.price_type||""]}),e.jsxs("div",{children:["Payment Type: ",R.payment_type||""]}),e.jsxs("div",{children:["Currency:"," ",((ht=I.find(je=>String(je.id)===String(R.currency_id)))==null?void 0:ht.code)||""]}),e.jsxs("div",{children:["Warehouse:"," ",((ft=_.find(je=>String(je.id)===String(R.warehouse_id)))==null?void 0:ft.warehouse_name)||""]}),e.jsxs("div",{children:["Prepared by: ",P||""]})]})]}),e.jsx("div",{className:"mb-2 mx-auto",children:e.jsxs("table",{className:"quotation-table text-sm",children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"35%"}}),e.jsx("col",{style:{width:"15%"}}),e.jsx("col",{style:{width:"25%"}}),e.jsx("col",{style:{width:"25%"}})]}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left",children:"Description"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Quantity"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Unit Price"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Total"})]})}),e.jsx("tbody",{children:T.map(je=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2",children:je.item_name}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(je.qty||0).toFixed(2)}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(je.unit_price||0).toFixed(2)}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(je.total||0).toFixed(2)})]},je.line_id))})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx("div",{}),e.jsx("div",{children:e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx("div",{className:"px-2 py-1 font-medium",children:"Subtotal"}),e.jsx("div",{className:"px-2 py-1 text-right",children:st().grossSub.toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-medium",children:"Discount"}),e.jsx("div",{className:"px-2 py-1 text-right",children:st().discountTotal.toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-medium",children:"Net Sub Total"}),e.jsx("div",{className:"px-2 py-1 text-right font-semibold",children:st().netSub.toFixed(2)}),st().components.map(je=>e.jsxs(Is.Fragment,{children:[e.jsxs("div",{className:"px-2 py-1",children:[je.name," [",je.rate,"%]"]}),e.jsx("div",{className:"px-2 py-1 text-right",children:je.amount.toFixed(2)})]},je.name)),e.jsx("div",{className:"px-2 py-1 font-semibold",children:"Total"}),e.jsx("div",{className:"px-2 py-1 text-right font-semibold",children:st().grand.toFixed(2)})]})})})]}),e.jsx("div",{className:"mt-6 text-center text-sm",children:"THANK YOU FOR YOUR BUSINESS!"})]}),e.jsxs("div",{ref:q,className:"hidden p-8 bg-white",style:{width:"794px",maxWidth:"794px"},children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:L.logoUrl||Ws,alt:L.name||"Company",className:"w-16 h-16 object-contain border border-gray-300"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold text-base",children:L.name||"Company"}),L.address&&e.jsx("div",{children:L.address}),(L.city||L.state||L.country)&&e.jsx("div",{children:[L.city,L.state,L.country].filter(Boolean).join(", ")}),e.jsxs("div",{className:"flex gap-3",children:[L.phone&&e.jsx("span",{children:L.phone}),L.email&&e.jsx("span",{children:L.email})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-xl font-semibold",children:"Invoice"})}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{children:["DATE: ",R.invoice_date||""]}),e.jsxs("div",{children:["Invoice #: ",R.invoice_no||""]}),e.jsxs("div",{children:["Customer:"," ",((Rt=g.find(je=>String(je.id)===String(R.customer_id)))==null?void 0:Rt.customer_name)||""]}),e.jsxs("div",{children:["City: ",R.city||""]}),e.jsxs("div",{children:["State: ",R.state||""]}),e.jsxs("div",{children:["Country: ",R.country||""]}),e.jsxs("div",{children:["Phone: ",R.phone||""]}),e.jsxs("div",{children:["Price Type: ",R.price_type||""]}),e.jsxs("div",{children:["Payment Type: ",R.payment_type||""]}),e.jsxs("div",{children:["Currency:"," ",((Ge=I.find(je=>String(je.id)===String(R.currency_id)))==null?void 0:Ge.code)||""]}),e.jsxs("div",{children:["Warehouse:"," ",((at=_.find(je=>String(je.id)===String(R.warehouse_id)))==null?void 0:at.warehouse_name)||""]}),e.jsxs("div",{children:["Prepared by: ",P||""]})]})]}),e.jsx("div",{className:"mb-2",style:{width:"100%",overflow:"visible",margin:"0 auto"},children:e.jsxs("table",{className:"quotation-table text-sm",style:{width:"100%",tableLayout:"fixed"},children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"35%"}}),e.jsx("col",{style:{width:"15%"}}),e.jsx("col",{style:{width:"25%"}}),e.jsx("col",{style:{width:"25%"}})]}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left",children:"Description"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Quantity"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Unit Price"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Total"})]})}),e.jsx("tbody",{children:T.map(je=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2",children:je.item_name}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(je.qty||0).toFixed(2)}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(je.unit_price||0).toFixed(2)}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(je.total||0).toFixed(2)})]},je.line_id))})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx("div",{}),e.jsx("div",{children:e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx("div",{className:"px-2 py-1 font-medium",children:"Subtotal"}),e.jsx("div",{className:"px-2 py-1 text-right",children:st().grossSub.toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-medium",children:"Discount"}),e.jsx("div",{className:"px-2 py-1 text-right",children:st().discountTotal.toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-medium",children:"Net Sub Total"}),e.jsx("div",{className:"px-2 py-1 text-right font-semibold",children:st().netSub.toFixed(2)}),st().components.map(je=>e.jsxs("div",{className:"contents",children:[e.jsxs("div",{className:"px-2 py-1",children:[je.name," [",je.rate,"%]"]}),e.jsx("div",{className:"px-2 py-1 text-right",children:je.amount.toFixed(2)})]},je.name)),e.jsx("div",{className:"px-2 py-1 font-semibold",children:"Total"}),e.jsx("div",{className:"px-2 py-1 text-right font-semibold",children:st().grand.toFixed(2)})]})})})]})]}),e.jsx(Ic,{open:K.open,itemId:K.itemId,defaultUom:K.defaultUom,currentUom:K.currentUom,onClose:()=>J({open:!1,itemId:null,defaultUom:"",currentUom:"",rowId:null}),onApply:je=>{const{converted_qty:Se}=je||{},nt=Number(Se||0);K.rowId!=null?Y(Ze=>Ze.map(gt=>String(gt.line_id)===String(K.rowId)?{...gt,qty:nt,uom:K.defaultUom||gt.uom}:gt)):M(Ze=>({...Ze,qty:nt,uom:K.defaultUom||Ze.uom}))}})]})}function Zr(t){return String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function LH(t){return`<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Delivery Note</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 24px; color: #0f172a; background: #fff; }
      .dn { font-size: 12px; }
      .dn table { border-collapse: collapse; width: 100%; }
      .dn th, .dn td { border: 1px solid #e2e8f0; padding: 6px 8px; vertical-align: top; }
      .dn th { background: #f8fafc; text-align: left; }
      .dn .right { text-align: right; }
      .dn .center { text-align: center; }
      .dn-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 8px; }
      .dn-logo { min-width: 120px; max-width: 200px; }
      .dn-company { text-align: right; font-size: 11px; line-height: 1.35; }
      .dn-company .name { font-weight: 800; font-size: 14px; }
      .dn-titlebar { display: flex; align-items: center; gap: 10px; color: #0f172a; margin: 4px 0 10px; }
      .dn-titlebar .line { flex: 1; height: 1px; background: #0f172a; }
      .dn-titlebar .title { font-weight: 700; }
      .dn-details { width: 100%; margin-bottom: 10px; border: 1px solid #cbd5e1; }
      .dn-details td { border-color: #cbd5e1; }
      .dn-details .label { width: 32%; color: #475569; }
      .dn-details .label-wide { width: 40%; color: #475569; }
      .dn-cust { padding: 8px; }
      .dn-cust .row { display: flex; gap: 6px; margin: 2px 0; }
      .dn-cust .label { color: #475569; min-width: 110px; }
      .dn-cust .value { flex: 1; }
      .dn-items thead th { font-weight: 600; }
      .dn-footer a { color: inherit; text-decoration: underline; }
      .dn-sign { margin-top: 14px; }
      .dn-sign .line { border-bottom: 1px solid #0f172a; display: inline-block; }
    </style>
  </head>
  <body>${t||""}</body>
</html>`}function K2(t){var i;const s=t.company||{},r=t.delivery||{},a=t.customer||{},n=Array.isArray(t.items)?t.items:[];return String(((i=t.totals)==null?void 0:i.total)||""),`
  <div class="dn">
  <div class="dn-header">
    <div class="dn-logo">${s.logoHtml||""}</div>
    <div class="dn-company">
      <div class="name">${Zr(s.name||"")}</div>
      <div>${Zr(s.address||"")}</div>
      <div>${Zr([s.city,s.state,s.country].filter(Boolean).join(", "))} ${Zr(s.postalCode||"")}</div>
      <div>Telephone: ${Zr(s.phone||"")}</div>
      <div>Email: ${Zr(s.email||"")}</div>
      <div>${Zr(s.website||"")}</div>
      <div>TIN: ${Zr(s.taxId||"")} &nbsp; Reg: ${Zr(s.registrationNo||"")}</div>
    </div>
  </div>
  <div class="dn-titlebar">
    <div class="line"></div>
    <div class="title">* Delivery Note *</div>
    <div class="line"></div>
  </div>
  <table class="dn-details">
    <tr>
      <td style="width:50%;vertical-align:top;border-right:1px solid #cbd5e1;">
        <div class="dn-cust">
          <div class="row"><div class="label">Customer Name</div><div class="value">: ${Zr(a.name||"")}</div></div>
          <div class="row"><div class="label">Address</div><div class="value">: ${Zr(a.address||"")}</div></div>
          <div class="row"><div class="label">City</div><div class="value">: ${Zr(a.city||"")}</div></div>
          <div class="row"><div class="label">State</div><div class="value">: ${Zr(a.state||"")}</div></div>
          <div class="row"><div class="label">Country</div><div class="value">: ${Zr(a.country||"")}</div></div>
        </div>
      </td>
      <td style="width:50%;vertical-align:top;">
        <table style="width:100%;">
          <tr><td class="label-wide">Delivery No</td><td>:</td><td>${Zr(r.delivery_no||"")}</td></tr>
          <tr><td class="label-wide">Delivery Date</td><td>:</td><td>${Zr(r.delivery_date||"")}</td></tr>
          <tr><td class="label-wide">Order No</td><td>:</td><td>${Zr(r.order_no||"")}</td></tr>
          <tr><td class="label-wide">Order Date</td><td>:</td><td>${Zr(r.order_date||"")}</td></tr>
          <tr><td class="label-wide">Del Method</td><td>:</td><td>${Zr(r.delivery_method||"")}</td></tr>
          <tr><td class="label-wide">Our Ref</td><td>:</td><td>${Zr(r.our_ref||"")}</td></tr>
        </table>
      </td>
    </tr>
  </table>
  <table class="dn-items">
    <thead>
      <tr>
        <th style="width:6%;">Sr No.</th>
        <th style="width:16%;">Product Code</th>
        <th>Product Description</th>
        <th class="right" style="width:18%;">Quantity Unit</th>
      </tr>
    </thead>
    <tbody>
      ${n.map((l,o)=>`
        <tr>
          <td class="center">${String(o+1)}</td>
          <td>${Zr(l.item_code||"")}</td>
          <td>${Zr(l.item_name||"")}</td>
          <td class="right">${Zr(l.qty_display||l.qty||"")}</td>
        </tr>
      `).join("")}
      <tr>
        <td colspan="3" class="right"><strong>Total Quantity</strong></td>
        <td class="right"><strong>${Zr(n.reduce((l,o)=>l+Number(o.qty||0),0).toFixed(2))}</strong></td>
      </tr>
    </tbody>
  </table>
  <div class="dn-footer" style="margin-top:10px;">
    <table style="width:100%;">
      <tr><td style="width:20%;">Item Count</td><td>:</td><td>${String(n.length)}</td></tr>
      <tr><td>Vehicle No</td><td>:</td><td>${Zr(r.vehicle_no||"")}</td></tr>
      <tr><td>DRIVER NAME AND SIGN</td><td>:</td><td></td></tr>
      <tr><td>WAY BILL NO & CARRIER</td><td>:</td><td>${Zr(r.waybill_no||"")}</td></tr>
      <tr><td>GOODS ISSUED BY (SIGN)</td><td>:</td><td></td></tr>
    </table>
  </div>
  <div class="dn-sign">
    <div style="text-align:right;">
      <span class="line">All above goods received in good order and condition</span>
    </div>
    <div style="height:40px;"></div>
    <div style="text-align:right;">
      <span class="line">Signature with Company's Rubber Stamp</span>
    </div>
  </div>
  </div>
  `}async function DH(t){const s=Array.from(t.querySelectorAll("img"));s.length&&await Promise.all(s.map(r=>new Promise(a=>{if(r.complete)return a();const n=()=>a();r.addEventListener("load",n,{once:!0}),r.addEventListener("error",n,{once:!0})})))}function PH(){const{canPerformAction:t}=Ls(),s=ps(),[r,a]=f.useState([]),[n,i]=f.useState(!0),[l,o]=f.useState(""),[d,u]=f.useState(""),[c,h]=f.useState({name:"",address:"",phone:"",email:"",city:"",state:"",country:"",postalCode:"",website:"",taxId:"",registrationNo:"",logoUrl:""});f.useEffect(()=>{m()},[]),f.useEffect(()=>{let F=!0;async function I(){var w,E,W;try{const U=(E=(w=(await Z.get("/admin/me")).data)==null?void 0:w.scope)==null?void 0:E.companyId;if(!U){if(!F)return;h(H=>({...H,logoUrl:H.logoUrl||Ws}));return}const Y=((W=(await Z.get(`/admin/companies/${U}`)).data)==null?void 0:W.item)||{};if(!F)return;h(H=>({...H,name:Y.name||H.name||"",address:Y.address||H.address||"",phone:Y.telephone||H.phone||"",email:Y.email||H.email||"",city:Y.city||H.city||"",state:Y.state||H.state||"",country:Y.country||H.country||"",postalCode:Y.postal_code||H.postalCode||"",website:Y.website||H.website||"",taxId:Y.tax_id||H.taxId||"",registrationNo:Y.registration_no||H.registrationNo||"",logoUrl:Y.has_logo===1||Y.has_logo===!0?`/api/admin/companies/${U}/logo`:H.logoUrl||Ws}))}catch{if(!F)return;h(R=>({...R,logoUrl:R.logoUrl||Ws}))}}return I(),()=>{F=!1}},[]);const m=async()=>{var F,I,w;try{i(!0),o("");const E=await Z.get("/sales/deliveries");a(Array.isArray((F=E.data)==null?void 0:F.items)?E.data.items:[])}catch(E){o(((w=(I=E==null?void 0:E.response)==null?void 0:I.data)==null?void 0:w.message)||"Error fetching deliveries"),console.error("Error fetching deliveries:",E)}finally{i(!1)}},p=r.filter(F=>{const I=d.trim().toLowerCase();return!I||String(F.delivery_no).toLowerCase().includes(I)||String(F.customer_name).toLowerCase().includes(I)});async function g(F){var T,Y;await b();const I=await Z.get(`/sales/deliveries/${F}`),w=((T=I.data)==null?void 0:T.item)||{},E=Array.isArray((Y=I.data)==null?void 0:Y.details)?I.data.details:[],W=await y(w)||await x(w.customer_id)||null,R=j(w,E,W),U=K2(R);return LH(U)}async function x(F){var I;try{const w=Number(F),E=await Z.get("/sales/customers"),W=Array.isArray((I=E.data)==null?void 0:I.items)?E.data.items:[];if(Number.isFinite(w)){const R=W.find(U=>Number(U.id)===w)||null;if(R)return R}return null}catch{return null}}async function b(){var F,I,w;try{if(!(!String(c.name||"").trim()||!String(c.address||"").trim()||!String(c.phone||"").trim()||!String(c.email||"").trim()))return;const R=(I=(F=(await Z.get("/admin/me")).data)==null?void 0:F.scope)==null?void 0:I.companyId;if(!R)return;const T=((w=(await Z.get(`/admin/companies/${R}`)).data)==null?void 0:w.item)||{};h(Y=>({...Y,name:T.name||Y.name||"",address:T.address||Y.address||"",phone:T.telephone||Y.phone||"",email:T.email||Y.email||"",city:T.city||Y.city||"",state:T.state||Y.state||"",country:T.country||Y.country||"",postalCode:T.postal_code||Y.postalCode||"",website:T.website||Y.website||"",taxId:T.tax_id||Y.taxId||"",registrationNo:T.registration_no||Y.registrationNo||"",logoUrl:T.has_logo===1||T.has_logo===!0?`/api/admin/companies/${R}/logo`:Y.logoUrl||Ws}))}catch{}}async function y(F){var I;try{const w=await Z.get("/sales/customers"),E=Array.isArray((I=w.data)==null?void 0:I.items)?w.data.items:[],W=Number(F.customer_id);if(Number.isFinite(W)){const U=E.find(T=>Number(T.id)===W)||null;if(U)return U}const R=String(F.customer_name||"").trim().toLowerCase();if(R){const U=E.find(T=>String(T.customer_name||"").trim().toLowerCase()===R)||null;if(U)return U}return null}catch{return null}}const j=(F,I,w)=>{const E=String(c.logoUrl||"").trim(),W=E?`<img src="${E}" alt="${Zr(c.name||"Company")}" style="max-height:80px;object-fit:contain;" />`:"",R=(Array.isArray(I)?I:[]).map((Y,H)=>{const M=Number(Y.quantity||Y.qty||0),q=Number(Y.unit_price||0),z=M*q;return{sr_no:H+1,item_code:String(Y.item_code||Y.item_id||""),item_name:String(Y.item_name||Y.item_code||Y.item_id||""),qty:M.toFixed(2),qty_display:[M.toFixed(2),String(Y.uom||"").trim()].filter(Boolean).join(" "),unit_price:q.toFixed(2),total:z.toFixed(2)}}),U=R.reduce((Y,H)=>Y+Number(H.total||0),0),T=R.reduce((Y,H)=>Y+Number(H.qty||0),0);return{company:{name:c.name||"Company",address:c.address||"",city:c.city||"",state:c.state||"",country:c.country||"",postalCode:c.postalCode||"",phone:c.phone||"",email:c.email||"",website:c.website||"",taxId:c.taxId||"",registrationNo:c.registrationNo||"",logoUrl:E,logoHtml:W},delivery:{delivery_no:String(F.delivery_no||""),delivery_date:F.delivery_date?String(F.delivery_date).slice(0,10):"",order_no:String(F.order_no||""),order_date:F.order_date?String(F.order_date).slice(0,10):"",delivery_method:String(F.delivery_method||""),our_ref:String(F.our_ref||""),vehicle_no:String(F.vehicle_no||""),waybill_no:String(F.waybill_no||"")},customer:{id:String((w&&w.id)??F.customer_id??""),code:String((w&&w.customer_code)??F.customer_code??""),name:String((w&&w.customer_name)??F.customer_name??""),type:String((w&&w.customer_type)??F.customer_type??""),contactPerson:String((w&&w.contact_person)??F.contact_person??""),email:String((w&&w.email)??F.email??""),phone:String((w&&w.phone)??F.phone??""),mobile:String((w&&w.mobile)??F.mobile??""),address:String((w&&w.address)??F.address??""),city:String((w&&w.city)??F.city??""),state:String((w&&w.state)??F.state??""),zone:String((w&&w.zone)??F.zone??""),country:String((w&&w.country)??F.country??""),paymentTerms:String((w&&w.payment_terms)??F.payment_terms??""),creditLimit:Number((w&&w.credit_limit)??F.credit_limit??0).toFixed(2),priceTypeName:String((w&&w.price_type_name)??""),currencyId:String((w&&w.currency_id)??"")},items:R,totals:{total:U.toFixed(2),total_qty:T.toFixed(2)}}};async function N(F){var I,w,E;try{o("");const W=await g(F),R=document.createElement("iframe");R.style.position="fixed",R.style.right="0",R.style.bottom="0",R.style.width="0",R.style.height="0",R.style.border="0",document.body.appendChild(R);const U=((I=R.contentWindow)==null?void 0:I.document)||R.contentDocument||null;if(!U){document.body.removeChild(R);return}U.open(),U.write(W),U.close();const T=R.contentWindow||window;setTimeout(()=>{T.focus();try{T.print()}catch{}setTimeout(()=>{document.body.removeChild(R)},100)},200)}catch(W){o(((E=(w=W==null?void 0:W.response)==null?void 0:w.data)==null?void 0:E.message)||"Failed to print delivery"),console.error(W)}}async function _(F){var I,w,E,W;try{o("");const R=await Z.get(`/sales/deliveries/${F}`),U=((I=R.data)==null?void 0:I.item)||{},T=Array.isArray((w=R.data)==null?void 0:w.details)?R.data.details:[],Y=await y(U)||await x(U.customer_id)||null,H=j(U,T,Y),M=K2(H),q=document.createElement("div");q.style.position="fixed",q.style.left="-10000px",q.style.top="0",q.style.width="794px",q.style.background="white",q.style.padding="32px",q.innerHTML=M,document.body.appendChild(q);try{await DH(q);const z=await wi(q,{scale:2,useCORS:!0}),Q=z.toDataURL("image/png"),L=new hs("p","mm","a4"),V=L.internal.pageSize.getWidth(),P=L.internal.pageSize.getHeight(),C=V,k=z.height*C/z.width;let B=0;for(;B<k;)L.addImage(Q,"PNG",0,-B,C,k),B+=P,B<k&&L.addPage();const G=String(U.delivery_no||"DN").replaceAll(" ","_");L.save(`delivery-${G}.pdf`)}finally{document.body.removeChild(q)}}catch(R){o(((W=(E=R==null?void 0:R.response)==null?void 0:E.data)==null?void 0:W.message)||"Failed to download delivery"),console.error(R)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Delivery Notes"}),e.jsx("p",{className:"text-sm mt-1",children:"Track deliveries issued for sales orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/sales",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/sales/delivery/new",className:"btn-success",children:"+ New Delivery"})]})]})})}),l&&e.jsx("div",{className:"alert alert-error",children:e.jsx("span",{children:l})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"flex gap-4 mb-6",children:e.jsx("div",{className:"flex-1",children:e.jsx("input",{className:"input",placeholder:"Search delivery no or customer...",value:d,onChange:F=>u(F.target.value)})})}),n?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-brand"}),e.jsx("p",{className:"mt-2",children:"Loading deliveries..."})]}):p.length===0?e.jsx("div",{className:"text-center py-12",children:"No deliveries found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Delivery No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:p.map(F=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:F.delivery_no}),e.jsx("td",{children:new Date(F.delivery_date).toLocaleDateString()}),e.jsx("td",{children:F.customer_name}),e.jsx("td",{children:F.status}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",className:"ml-2 btn-primary text-xs px-3 py-1.5 gap-1",onClick:()=>N(F.id),children:[e.jsx(Pj,{className:"w-4 h-4"}),"Print"]}),e.jsxs("button",{type:"button",className:"ml-1 btn-outline text-xs px-3 py-1.5 gap-1",onClick:()=>_(F.id),children:[e.jsx(Cc,{className:"w-4 h-4"}),"Download"]}),String(F.status||"").toUpperCase()!=="DELIVERED"&&t("sales:delivery","edit")&&e.jsx("button",{className:"text-blue-600 hover:text-blue-700 font-medium text-sm",onClick:()=>s(`/sales/delivery/${F.id}`),children:"Edit"})]})})]},F.id))})]})})]})})]})}function z2(){const t=ps(),{id:s}=Ps(),r=!!s,{scope:a}=Kr(),[n,i]=f.useState(!1),[l,o]=f.useState(!1),[d,u]=f.useState(null),[c,h]=f.useState(null),[m,p]=f.useState([]),[g,x]=f.useState({delivery_no:"",delivery_date:new Date().toISOString().split("T")[0],customer_id:"",sales_order_id:"",invoice_id:"",status:"DRAFT",remarks:"",items:[]}),[b,y]=f.useState(""),[j,N]=f.useState([]),[_,F]=f.useState([]),[I,w]=f.useState([]);f.useEffect(()=>{E(),W(),R(),T(),r?Y(s):(async()=>{try{const z=await U();x(Q=>({...Q,delivery_no:z}))}catch{x(z=>({...z,delivery_no:"DN-000001"}))}})()},[s]);async function E(){try{const z=await Z.get("/sales/customers");N(z.data.items||[])}catch(z){console.error("Failed to load customers",z)}}async function W(){var z,Q;try{const[L,V]=await Promise.all([Z.get("/sales/invoices"),Z.get("/sales/deliveries")]),P=Array.isArray((z=L.data)==null?void 0:z.items)?L.data.items:[],C=Array.isArray((Q=V.data)==null?void 0:Q.items)?V.data.items:[],k=new Set(C.map(O=>O==null?void 0:O.invoice_id).filter(O=>O!=null).map(O=>String(O))),B=new Set(C.map(O=>O==null?void 0:O.sales_order_id).filter(O=>O!=null).map(O=>String(O)));let G=P;k.size>0?G=G.filter(O=>!k.has(String(O.id))):G=G.filter(O=>!B.has(String(O.sales_order_id))),F(G)}catch(L){console.error("Failed to load invoices",L)}}async function R(){var z;try{const Q=await Z.get("/inventory/items");w(Array.isArray((z=Q.data)==null?void 0:z.items)?Q.data.items:[])}catch(Q){console.error("Failed to load items",Q)}}async function U(){var z;try{return((z=(await Z.get("/sales/deliveries/next-no")).data)==null?void 0:z.nextNo)||""||"DN-000001"}catch(Q){return console.error("Failed to fetch deliveries for next no",Q),"DN-000001"}}const T=async()=>{var z;try{const Q=await Z.get("/finance/tax-codes"),V=(Array.isArray((z=Q.data)==null?void 0:z.items)?Q.data.items:[]).map(P=>({value:P.id,label:P.name,rate:Number(P.rate_percent)}));p(V)}catch(Q){console.error("Error fetching tax codes:",Q)}};async function Y(z){var Q,L;try{i(!0);const V=await Z.get(`/sales/deliveries/${z}`),P=((Q=V.data)==null?void 0:Q.item)||{},C=Array.isArray((L=V.data)==null?void 0:L.details)?V.data.details:[];x(k=>({...k,delivery_no:P.delivery_no||k.delivery_no,delivery_date:(P.delivery_date?String(P.delivery_date).slice(0,10):k.delivery_date)||k.delivery_date,customer_id:P.customer_id||"",sales_order_id:P.sales_order_id||"",invoice_id:P.invoice_id||"",status:P.status||k.status,remarks:P.remarks||"",items:C.map(B=>({item_id:B.item_id,item_name:B.item_name||"",quantity:Number(B.quantity||0),ordered_qty:Number(B.quantity||0),tax_type:B.tax_id||"",uom:B.uom||"PCS",unit_price:Number(B.unit_price||0)}))})),i(!1)}catch{u("Failed to load delivery"),i(!1)}}async function H(z){var Q,L,V,P,C;if(z)try{i(!0);const k=await Z.get(`/sales/invoices/${z}`),B=((Q=k.data)==null?void 0:Q.item)||{};let O=Array.isArray((L=k.data)==null?void 0:L.details)?k.data.details:[];if(O.length)y("");else{const K=_.find(J=>String(J.id)===String(z));if(K!=null&&K.sales_order_id){const J=await Z.get(`/sales/orders/${K.sales_order_id}`);O=Array.isArray((V=J.data)==null?void 0:V.details)?J.data.details:[],y(((C=(P=J.data)==null?void 0:P.item)==null?void 0:C.order_no)||"")}else y("")}x(K=>({...K,customer_id:B.customer_id||K.customer_id,sales_order_id:B.sales_order_id||"",invoice_id:B.id||z,items:O.map(J=>{var te;return{item_id:J.item_id,item_name:J.item_name||((te=I.find(se=>String(se.id)===String(J.item_id)))==null?void 0:te.item_name)||"",quantity:Number(J.quantity||0),ordered_qty:Number(J.quantity||0),tax_type:m.length>0?m[0].value:"",uom:J.uom||"PCS",unit_price:Number(J.unit_price||0)}})})),h(`Loaded from Invoice ${B.invoice_no||String(z)}`)}catch(k){console.error(k),alert("Error loading invoice details")}finally{i(!1)}}async function M(z){var Q,L,V,P,C;if(z.preventDefault(),!g.customer_id){alert("Please select a customer");return}try{o(!0),console.log("Scope companyId before payload:",a==null?void 0:a.companyId);const k={...g,company_id:(a==null?void 0:a.companyId)||1,branch_id:a==null?void 0:a.branchId,invoice_id:g.invoice_id||null,sales_order_id:g.sales_order_id||null,items:g.items.map(B=>{const G=m.find(K=>K.value==B.tax_type),O={item_id:B.item_id,quantity:Number(B.quantity)};return B.tax_type&&(O.tax_id=B.tax_type,O.tax_rate=G?G.rate:0,O.tax_amount=0),O})};console.log("Delivery payload:",k),r?await Z.put(`/sales/deliveries/${s}`,k):await Z.post("/sales/deliveries",k),h("Delivery saved successfully"),setTimeout(()=>t("/sales/delivery"),1500)}catch(k){const B=((L=(Q=k==null?void 0:k.response)==null?void 0:Q.data)==null?void 0:L.message)||((P=(V=k==null?void 0:k.response)==null?void 0:V.data)==null?void 0:P.error)||(k==null?void 0:k.message)||"Failed to save delivery";u(B),console.error("Failed to save delivery",((C=k==null?void 0:k.response)==null?void 0:C.data)||k)}finally{o(!1)}}function q(z){r&&s?(async()=>{try{await Z.put(`/sales/deliveries/${s}/status`,{status:z}),x(Q=>({...Q,status:z})),h(`Status updated to ${z}`)}catch(Q){u("Failed to update status"),console.error(Q)}})():x(Q=>({...Q,status:z}))}return n&&!g.customer_id?e.jsx("div",{className:"p-8",children:"Loading..."}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t(-1),className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(Xf,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-2xl font-bold",children:r?"Edit Delivery":"New Delivery"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>q("DELIVERED"),disabled:!r||l||String(g.status||"").toUpperCase()==="DELIVERED",className:"btn-success flex items-center gap-2",children:[e.jsx(wL,{className:"w-4 h-4"}),"Auto Delivery"]}),e.jsxs("button",{onClick:M,disabled:l,className:"btn-primary flex items-center gap-2",children:[e.jsx(sA,{className:"w-4 h-4"}),"Save Delivery"]})]})]}),d&&e.jsx("div",{className:"bg-red-50 text-red-600 p-4 rounded mb-6",children:d}),c&&e.jsx("div",{className:"bg-green-50 text-green-600 p-4 rounded mb-6",children:c}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded shadow-sm border",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Delivery Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery No"}),e.jsx("input",{type:"text",value:g.delivery_no,onChange:z=>x({...g,delivery_no:z.target.value}),className:"w-full border rounded p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),e.jsx("input",{type:"date",value:g.delivery_date,onChange:z=>x({...g,delivery_date:z.target.value}),className:"w-full border rounded p-2"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer"}),e.jsxs("select",{id:"customer",value:g.customer_id,onChange:z=>{const Q=z.target.value;x({...g,customer_id:Q,invoice_id:"",sales_order_id:"",items:[]}),y("")},className:"w-full border rounded p-2",children:[e.jsx("option",{value:"",children:"Select Customer"}),j.map(z=>e.jsx("option",{value:z.id,children:z.customer_name},z.id))]})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded shadow-sm border",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Load Items"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded border col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Invoice"}),e.jsxs("select",{className:"w-full border rounded p-2",onChange:z=>H(z.target.value),defaultValue:"",children:[e.jsx("option",{value:"",disabled:!0,children:"Select an Invoice..."}),_.filter(z=>g.customer_id?String(z.customer_id)===String(g.customer_id):!0).map(z=>e.jsxs("option",{value:z.id,children:[z.invoice_no," -"," ",new Date(z.invoice_date).toLocaleDateString()," (",z.total_amount,")"]},z.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Selecting an invoice will populate customer and order details."})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded border col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sales Order Number"}),e.jsx("input",{type:"text",placeholder:"Sales Order No",value:b,readOnly:!0,className:"w-full border rounded p-2 bg-gray-100 text-gray-500 cursor-not-allowed"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Item"}),e.jsx("th",{className:"p-3 w-28",children:"Ordered Qty"}),e.jsx("th",{className:"p-3 w-28",children:"To Deliver"}),e.jsx("th",{className:"p-3 w-20",children:"UOM"}),e.jsx("th",{className:"p-3 w-28",children:"Unit Price"}),e.jsx("th",{className:"p-3 w-40",children:"Tax"}),e.jsx("th",{className:"p-3 w-12",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y",children:g.items.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"p-8 text-center text-gray-500",children:"No items loaded. Search for an order or invoice."})}):g.items.map((z,Q)=>{var L;return e.jsxs("tr",{children:[e.jsx("td",{className:"p-3",children:z.item_name||((L=I.find(V=>String(V.id)===String(z.item_id)))==null?void 0:L.item_name)||""}),e.jsx("td",{className:"p-3",children:z.ordered_qty}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",value:z.quantity,onChange:V=>{const P=[...g.items];P[Q].quantity=parseFloat(V.target.value)||0,x({...g,items:P})},className:"w-full border rounded p-1"})}),e.jsx("td",{className:"p-3",children:z.uom||"PCS"}),e.jsx("td",{className:"p-3",children:Number(z.unit_price||0).toFixed(2)}),e.jsx("td",{className:"p-3",children:e.jsxs("select",{value:z.tax_type||"",onChange:V=>{const P=[...g.items];P[Q].tax_type=V.target.value,x({...g,items:P})},className:"w-full border rounded p-1",children:[e.jsx("option",{value:"",children:"None"}),m.map(V=>e.jsx("option",{value:V.value,children:V.label},V.value))]})}),e.jsx("td",{className:"p-3",children:e.jsx("button",{onClick:()=>{const V=g.items.filter((P,C)=>C!==Q);x({...g,items:V})},className:"text-red-500 hover:text-red-700",children:""})})]},Q)})})]})})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow-sm border",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Shipping Info"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Remarks"}),e.jsx("textarea",{value:g.remarks,onChange:z=>x({...g,remarks:z.target.value}),rows:"4",className:"w-full border rounded p-2"})]})})]})})]})]})}/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var D0={};D0.version="0.18.5";var J4=1252,UH=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],nN={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},iN=function(t){UH.indexOf(t)!=-1&&(J4=nN[0]=t)};function RH(){iN(1252)}var qo=function(t){iN(t)};function lN(){qo(1200),RH()}function Y2(t){for(var s=[],r=0,a=t.length;r<a;++r)s[r]=t.charCodeAt(r);return s}function OH(t){for(var s=[],r=0;r<t.length>>1;++r)s[r]=String.fromCharCode(t.charCodeAt(2*r)+(t.charCodeAt(2*r+1)<<8));return s.join("")}function Z4(t){for(var s=[],r=0;r<t.length>>1;++r)s[r]=String.fromCharCode(t.charCodeAt(2*r+1)+(t.charCodeAt(2*r)<<8));return s.join("")}var YA=function(t){var s=t.charCodeAt(0),r=t.charCodeAt(1);return s==255&&r==254?OH(t.slice(2)):s==254&&r==255?Z4(t.slice(2)):s==65279?t.slice(1):t},kx=function(s){return String.fromCharCode(s)},X2=function(s){return String.fromCharCode(s)},Bf,vu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Ff(t){for(var s="",r=0,a=0,n=0,i=0,l=0,o=0,d=0,u=0;u<t.length;)r=t.charCodeAt(u++),i=r>>2,a=t.charCodeAt(u++),l=(r&3)<<4|a>>4,n=t.charCodeAt(u++),o=(a&15)<<2|n>>6,d=n&63,isNaN(a)?o=d=64:isNaN(n)&&(d=64),s+=vu.charAt(i)+vu.charAt(l)+vu.charAt(o)+vu.charAt(d);return s}function Tl(t){var s="",r=0,a=0,n=0,i=0,l=0,o=0,d=0;t=t.replace(/[^\w\+\/\=]/g,"");for(var u=0;u<t.length;)i=vu.indexOf(t.charAt(u++)),l=vu.indexOf(t.charAt(u++)),r=i<<2|l>>4,s+=String.fromCharCode(r),o=vu.indexOf(t.charAt(u++)),a=(l&15)<<4|o>>2,o!==64&&(s+=String.fromCharCode(a)),d=vu.indexOf(t.charAt(u++)),n=(o&3)<<6|d,d!==64&&(s+=String.fromCharCode(n));return s}var ur=(function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node})(),Nd=(function(){if(typeof Buffer<"u"){var t=!Buffer.from;if(!t)try{Buffer.from("foo","utf8")}catch{t=!0}return t?function(s,r){return r?new Buffer(s,r):new Buffer(s)}:Buffer.from.bind(Buffer)}return function(){}})();function Eu(t){return ur?Buffer.alloc?Buffer.alloc(t):new Buffer(t):typeof Uint8Array<"u"?new Uint8Array(t):new Array(t)}function J2(t){return ur?Buffer.allocUnsafe?Buffer.allocUnsafe(t):new Buffer(t):typeof Uint8Array<"u"?new Uint8Array(t):new Array(t)}var Sl=function(s){return ur?Nd(s,"binary"):s.split("").map(function(r){return r.charCodeAt(0)&255})};function Eg(t){if(typeof ArrayBuffer>"u")return Sl(t);for(var s=new ArrayBuffer(t.length),r=new Uint8Array(s),a=0;a!=t.length;++a)r[a]=t.charCodeAt(a)&255;return s}function Iu(t){if(Array.isArray(t))return t.map(function(a){return String.fromCharCode(a)}).join("");for(var s=[],r=0;r<t.length;++r)s[r]=String.fromCharCode(t[r]);return s.join("")}function MH(t){if(typeof Uint8Array>"u")throw new Error("Unsupported");return new Uint8Array(t)}function oN(t){if(typeof ArrayBuffer>"u")throw new Error("Unsupported");if(t instanceof ArrayBuffer)return oN(new Uint8Array(t));for(var s=new Array(t.length),r=0;r<t.length;++r)s[r]=t[r];return s}var Fn=ur?function(t){return Buffer.concat(t.map(function(s){return Buffer.isBuffer(s)?s:Nd(s)}))}:function(t){if(typeof Uint8Array<"u"){var s=0,r=0;for(s=0;s<t.length;++s)r+=t[s].length;var a=new Uint8Array(r),n=0;for(s=0,r=0;s<t.length;r+=n,++s)if(n=t[s].length,t[s]instanceof Uint8Array)a.set(t[s],r);else{if(typeof t[s]=="string")throw"wtf";a.set(new Uint8Array(t[s]),r)}return a}return[].concat.apply([],t.map(function(i){return Array.isArray(i)?i:[].slice.call(i)}))};function QH(t){for(var s=[],r=0,a=t.length+250,n=Eu(t.length+255),i=0;i<t.length;++i){var l=t.charCodeAt(i);if(l<128)n[r++]=l;else if(l<2048)n[r++]=192|l>>6&31,n[r++]=128|l&63;else if(l>=55296&&l<57344){l=(l&1023)+64;var o=t.charCodeAt(++i)&1023;n[r++]=240|l>>8&7,n[r++]=128|l>>2&63,n[r++]=128|o>>6&15|(l&3)<<4,n[r++]=128|o&63}else n[r++]=224|l>>12&15,n[r++]=128|l>>6&63,n[r++]=128|l&63;r>a&&(s.push(n.slice(0,r)),r=0,n=Eu(65535),a=65530)}return s.push(n.slice(0,r)),Fn(s)}var Hi=/\u0000/g,XA=/[\u0001-\u0006]/g;function Rh(t){for(var s="",r=t.length-1;r>=0;)s+=t.charAt(r--);return s}function $o(t,s){var r=""+t;return r.length>=s?r:Ia("0",s-r.length)+r}function cN(t,s){var r=""+t;return r.length>=s?r:Ia(" ",s-r.length)+r}function P0(t,s){var r=""+t;return r.length>=s?r:r+Ia(" ",s-r.length)}function HH(t,s){var r=""+Math.round(t);return r.length>=s?r:Ia("0",s-r.length)+r}function qH(t,s){var r=""+t;return r.length>=s?r:Ia("0",s-r.length)+r}var Z2=Math.pow(2,32);function vh(t,s){if(t>Z2||t<-Z2)return HH(t,s);var r=Math.round(t);return qH(r,s)}function U0(t,s){return s=s||0,t.length>=7+s&&(t.charCodeAt(s)|32)===103&&(t.charCodeAt(s+1)|32)===101&&(t.charCodeAt(s+2)|32)===110&&(t.charCodeAt(s+3)|32)===101&&(t.charCodeAt(s+4)|32)===114&&(t.charCodeAt(s+5)|32)===97&&(t.charCodeAt(s+6)|32)===108}var eS=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],Fb=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function $H(t){return t||(t={}),t[0]="General",t[1]="0",t[2]="0.00",t[3]="#,##0",t[4]="#,##0.00",t[9]="0%",t[10]="0.00%",t[11]="0.00E+00",t[12]="# ?/?",t[13]="# ??/??",t[14]="m/d/yy",t[15]="d-mmm-yy",t[16]="d-mmm",t[17]="mmm-yy",t[18]="h:mm AM/PM",t[19]="h:mm:ss AM/PM",t[20]="h:mm",t[21]="h:mm:ss",t[22]="m/d/yy h:mm",t[37]="#,##0 ;(#,##0)",t[38]="#,##0 ;[Red](#,##0)",t[39]="#,##0.00;(#,##0.00)",t[40]="#,##0.00;[Red](#,##0.00)",t[45]="mm:ss",t[46]="[h]:mm:ss",t[47]="mmss.0",t[48]="##0.0E+0",t[49]="@",t[56]='"/ "hh""mm""ss" "',t}var Vs={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"/ "hh""mm""ss" "'},tS={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},VH={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function R0(t,s,r){for(var a=t<0?-1:1,n=t*a,i=0,l=1,o=0,d=1,u=0,c=0,h=Math.floor(n);u<s&&(h=Math.floor(n),o=h*l+i,c=h*u+d,!(n-h<5e-8));)n=1/(n-h),i=l,l=o,d=u,u=c;if(c>s&&(u>s?(c=d,o=i):(c=u,o=l)),!r)return[0,a*o,c];var m=Math.floor(a*o/c);return[m,a*o-m*c,c]}function pm(t,s,r){if(t>2958465||t<0)return null;var a=t|0,n=Math.floor(86400*(t-a)),i=0,l=[],o={D:a,T:n,u:86400*(t-a)-n,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(o.u)<1e-6&&(o.u=0),s&&s.date1904&&(a+=1462),o.u>.9999&&(o.u=0,++n==86400&&(o.T=n=0,++a,++o.D)),a===60)l=r?[1317,10,29]:[1900,2,29],i=3;else if(a===0)l=r?[1317,8,29]:[1900,1,0],i=6;else{a>60&&--a;var d=new Date(1900,0,1);d.setDate(d.getDate()+a-1),l=[d.getFullYear(),d.getMonth()+1,d.getDate()],i=d.getDay(),a<60&&(i=(i+6)%7),r&&(i=XH(d,l))}return o.y=l[0],o.m=l[1],o.d=l[2],o.S=n%60,n=Math.floor(n/60),o.M=n%60,n=Math.floor(n/60),o.H=n,o.q=i,o}var eE=new Date(1899,11,31,0,0,0),WH=eE.getTime(),GH=new Date(1900,2,1,0,0,0);function tE(t,s){var r=t.getTime();return s?r-=1461*24*60*60*1e3:t>=GH&&(r+=1440*60*1e3),(r-(WH+(t.getTimezoneOffset()-eE.getTimezoneOffset())*6e4))/(1440*60*1e3)}function dN(t){return t.indexOf(".")==-1?t:t.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function KH(t){return t.indexOf("E")==-1?t:t.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function zH(t){var s=t<0?12:11,r=dN(t.toFixed(12));return r.length<=s||(r=t.toPrecision(10),r.length<=s)?r:t.toExponential(5)}function YH(t){var s=dN(t.toFixed(11));return s.length>(t<0?12:11)||s==="0"||s==="-0"?t.toPrecision(6):s}function Tf(t){var s=Math.floor(Math.log(Math.abs(t))*Math.LOG10E),r;return s>=-4&&s<=-1?r=t.toPrecision(10+s):Math.abs(s)<=9?r=zH(t):s===10?r=t.toFixed(10).substr(0,12):r=YH(t),dN(KH(r.toUpperCase()))}function km(t,s){switch(typeof t){case"string":return t;case"boolean":return t?"TRUE":"FALSE";case"number":return(t|0)===t?t.toString(10):Tf(t);case"undefined":return"";case"object":if(t==null)return"";if(t instanceof Date)return io(14,tE(t,s&&s.date1904),s)}throw new Error("unsupported value in General format: "+t)}function XH(t,s){s[0]-=581;var r=t.getDay();return t<60&&(r=(r+6)%7),r}function JH(t,s,r,a){var n="",i=0,l=0,o=r.y,d,u=0;switch(t){case 98:o=r.y+543;case 121:switch(s.length){case 1:case 2:d=o%100,u=2;break;default:d=o%1e4,u=4;break}break;case 109:switch(s.length){case 1:case 2:d=r.m,u=s.length;break;case 3:return Fb[r.m-1][1];case 5:return Fb[r.m-1][0];default:return Fb[r.m-1][2]}break;case 100:switch(s.length){case 1:case 2:d=r.d,u=s.length;break;case 3:return eS[r.q][0];default:return eS[r.q][1]}break;case 104:switch(s.length){case 1:case 2:d=1+(r.H+11)%12,u=s.length;break;default:throw"bad hour format: "+s}break;case 72:switch(s.length){case 1:case 2:d=r.H,u=s.length;break;default:throw"bad hour format: "+s}break;case 77:switch(s.length){case 1:case 2:d=r.M,u=s.length;break;default:throw"bad minute format: "+s}break;case 115:if(s!="s"&&s!="ss"&&s!=".0"&&s!=".00"&&s!=".000")throw"bad second format: "+s;return r.u===0&&(s=="s"||s=="ss")?$o(r.S,s.length):(a>=2?l=a===3?1e3:100:l=a===1?10:1,i=Math.round(l*(r.S+r.u)),i>=60*l&&(i=0),s==="s"?i===0?"0":""+i/l:(n=$o(i,2+a),s==="ss"?n.substr(0,2):"."+n.substr(2,s.length-1)));case 90:switch(s){case"[h]":case"[hh]":d=r.D*24+r.H;break;case"[m]":case"[mm]":d=(r.D*24+r.H)*60+r.M;break;case"[s]":case"[ss]":d=((r.D*24+r.H)*60+r.M)*60+Math.round(r.S+r.u);break;default:throw"bad abstime format: "+s}u=s.length===3?1:2;break;case 101:d=o,u=1;break}var c=u>0?$o(d,u):"";return c}function bu(t){var s=3;if(t.length<=s)return t;for(var r=t.length%s,a=t.substr(0,r);r!=t.length;r+=s)a+=(a.length>0?",":"")+t.substr(r,s);return a}var sE=/%/g;function ZH(t,s,r){var a=s.replace(sE,""),n=s.length-a.length;return Ad(t,a,r*Math.pow(10,2*n))+Ia("%",n)}function e9(t,s,r){for(var a=s.length-1;s.charCodeAt(a-1)===44;)--a;return Ad(t,s.substr(0,a),r/Math.pow(10,3*(s.length-a)))}function rE(t,s){var r,a=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(s==0)return"0.0E+0";if(s<0)return"-"+rE(t,-s);var n=t.indexOf(".");n===-1&&(n=t.indexOf("E"));var i=Math.floor(Math.log(s)*Math.LOG10E)%n;if(i<0&&(i+=n),r=(s/Math.pow(10,i)).toPrecision(a+1+(n+i)%n),r.indexOf("e")===-1){var l=Math.floor(Math.log(s)*Math.LOG10E);for(r.indexOf(".")===-1?r=r.charAt(0)+"."+r.substr(1)+"E+"+(l-r.length+i):r+="E+"+(l-i);r.substr(0,2)==="0.";)r=r.charAt(0)+r.substr(2,n)+"."+r.substr(2+n),r=r.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");r=r.replace(/\+-/,"-")}r=r.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(o,d,u,c){return d+u+c.substr(0,(n+i)%n)+"."+c.substr(i)+"E"})}else r=s.toExponential(a);return t.match(/E\+00$/)&&r.match(/e[+-]\d$/)&&(r=r.substr(0,r.length-1)+"0"+r.charAt(r.length-1)),t.match(/E\-/)&&r.match(/e\+/)&&(r=r.replace(/e\+/,"e")),r.replace("e","E")}var aE=/# (\?+)( ?)\/( ?)(\d+)/;function t9(t,s,r){var a=parseInt(t[4],10),n=Math.round(s*a),i=Math.floor(n/a),l=n-i*a,o=a;return r+(i===0?"":""+i)+" "+(l===0?Ia(" ",t[1].length+1+t[4].length):cN(l,t[1].length)+t[2]+"/"+t[3]+$o(o,t[4].length))}function s9(t,s,r){return r+(s===0?"":""+s)+Ia(" ",t[1].length+2+t[4].length)}var nE=/^#*0*\.([0#]+)/,iE=/\).*[0#]/,lE=/\(###\) ###\\?-####/;function Oi(t){for(var s="",r,a=0;a!=t.length;++a)switch(r=t.charCodeAt(a)){case 35:break;case 63:s+=" ";break;case 48:s+="0";break;default:s+=String.fromCharCode(r)}return s}function sS(t,s){var r=Math.pow(10,s);return""+Math.round(t*r)/r}function rS(t,s){var r=t-Math.floor(t),a=Math.pow(10,s);return s<(""+Math.round(r*a)).length?0:Math.round(r*a)}function r9(t,s){return s<(""+Math.round((t-Math.floor(t))*Math.pow(10,s))).length?1:0}function a9(t){return t<2147483647&&t>-2147483648?""+(t>=0?t|0:t-1|0):""+Math.floor(t)}function zl(t,s,r){if(t.charCodeAt(0)===40&&!s.match(iE)){var a=s.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return r>=0?zl("n",a,r):"("+zl("n",a,-r)+")"}if(s.charCodeAt(s.length-1)===44)return e9(t,s,r);if(s.indexOf("%")!==-1)return ZH(t,s,r);if(s.indexOf("E")!==-1)return rE(s,r);if(s.charCodeAt(0)===36)return"$"+zl(t,s.substr(s.charAt(1)==" "?2:1),r);var n,i,l,o,d=Math.abs(r),u=r<0?"-":"";if(s.match(/^00+$/))return u+vh(d,s.length);if(s.match(/^[#?]+$/))return n=vh(r,0),n==="0"&&(n=""),n.length>s.length?n:Oi(s.substr(0,s.length-n.length))+n;if(i=s.match(aE))return t9(i,d,u);if(s.match(/^#+0+$/))return u+vh(d,s.length-s.indexOf("0"));if(i=s.match(nE))return n=sS(r,i[1].length).replace(/^([^\.]+)$/,"$1."+Oi(i[1])).replace(/\.$/,"."+Oi(i[1])).replace(/\.(\d*)$/,function(g,x){return"."+x+Ia("0",Oi(i[1]).length-x.length)}),s.indexOf("0.")!==-1?n:n.replace(/^0\./,".");if(s=s.replace(/^#+([0.])/,"$1"),i=s.match(/^(0*)\.(#*)$/))return u+sS(d,i[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,i[1].length?"0.":".");if(i=s.match(/^#{1,3},##0(\.?)$/))return u+bu(vh(d,0));if(i=s.match(/^#,##0\.([#0]*0)$/))return r<0?"-"+zl(t,s,-r):bu(""+(Math.floor(r)+r9(r,i[1].length)))+"."+$o(rS(r,i[1].length),i[1].length);if(i=s.match(/^#,#*,#0/))return zl(t,s.replace(/^#,#*,/,""),r);if(i=s.match(/^([0#]+)(\\?-([0#]+))+$/))return n=Rh(zl(t,s.replace(/[\\-]/g,""),r)),l=0,Rh(Rh(s.replace(/\\/g,"")).replace(/[0#]/g,function(g){return l<n.length?n.charAt(l++):g==="0"?"0":""}));if(s.match(lE))return n=zl(t,"##########",r),"("+n.substr(0,3)+") "+n.substr(3,3)+"-"+n.substr(6);var c="";if(i=s.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return l=Math.min(i[4].length,7),o=R0(d,Math.pow(10,l)-1,!1),n=""+u,c=Ad("n",i[1],o[1]),c.charAt(c.length-1)==" "&&(c=c.substr(0,c.length-1)+"0"),n+=c+i[2]+"/"+i[3],c=P0(o[2],l),c.length<i[4].length&&(c=Oi(i[4].substr(i[4].length-c.length))+c),n+=c,n;if(i=s.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return l=Math.min(Math.max(i[1].length,i[4].length),7),o=R0(d,Math.pow(10,l)-1,!0),u+(o[0]||(o[1]?"":"0"))+" "+(o[1]?cN(o[1],l)+i[2]+"/"+i[3]+P0(o[2],l):Ia(" ",2*l+1+i[2].length+i[3].length));if(i=s.match(/^[#0?]+$/))return n=vh(r,0),s.length<=n.length?n:Oi(s.substr(0,s.length-n.length))+n;if(i=s.match(/^([#0?]+)\.([#0]+)$/)){n=""+r.toFixed(Math.min(i[2].length,10)).replace(/([^0])0+$/,"$1"),l=n.indexOf(".");var h=s.indexOf(".")-l,m=s.length-n.length-h;return Oi(s.substr(0,h)+n+s.substr(s.length-m))}if(i=s.match(/^00,000\.([#0]*0)$/))return l=rS(r,i[1].length),r<0?"-"+zl(t,s,-r):bu(a9(r)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(g){return"00,"+(g.length<3?$o(0,3-g.length):"")+g})+"."+$o(l,i[1].length);switch(s){case"###,##0.00":return zl(t,"#,##0.00",r);case"###,###":case"##,###":case"#,###":var p=bu(vh(d,0));return p!=="0"?u+p:"";case"###,###.00":return zl(t,"###,##0.00",r).replace(/^0\./,".");case"#,###.00":return zl(t,"#,##0.00",r).replace(/^0\./,".")}throw new Error("unsupported format |"+s+"|")}function n9(t,s,r){for(var a=s.length-1;s.charCodeAt(a-1)===44;)--a;return Ad(t,s.substr(0,a),r/Math.pow(10,3*(s.length-a)))}function i9(t,s,r){var a=s.replace(sE,""),n=s.length-a.length;return Ad(t,a,r*Math.pow(10,2*n))+Ia("%",n)}function oE(t,s){var r,a=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(s==0)return"0.0E+0";if(s<0)return"-"+oE(t,-s);var n=t.indexOf(".");n===-1&&(n=t.indexOf("E"));var i=Math.floor(Math.log(s)*Math.LOG10E)%n;if(i<0&&(i+=n),r=(s/Math.pow(10,i)).toPrecision(a+1+(n+i)%n),!r.match(/[Ee]/)){var l=Math.floor(Math.log(s)*Math.LOG10E);r.indexOf(".")===-1?r=r.charAt(0)+"."+r.substr(1)+"E+"+(l-r.length+i):r+="E+"+(l-i),r=r.replace(/\+-/,"-")}r=r.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(o,d,u,c){return d+u+c.substr(0,(n+i)%n)+"."+c.substr(i)+"E"})}else r=s.toExponential(a);return t.match(/E\+00$/)&&r.match(/e[+-]\d$/)&&(r=r.substr(0,r.length-1)+"0"+r.charAt(r.length-1)),t.match(/E\-/)&&r.match(/e\+/)&&(r=r.replace(/e\+/,"e")),r.replace("e","E")}function bc(t,s,r){if(t.charCodeAt(0)===40&&!s.match(iE)){var a=s.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return r>=0?bc("n",a,r):"("+bc("n",a,-r)+")"}if(s.charCodeAt(s.length-1)===44)return n9(t,s,r);if(s.indexOf("%")!==-1)return i9(t,s,r);if(s.indexOf("E")!==-1)return oE(s,r);if(s.charCodeAt(0)===36)return"$"+bc(t,s.substr(s.charAt(1)==" "?2:1),r);var n,i,l,o,d=Math.abs(r),u=r<0?"-":"";if(s.match(/^00+$/))return u+$o(d,s.length);if(s.match(/^[#?]+$/))return n=""+r,r===0&&(n=""),n.length>s.length?n:Oi(s.substr(0,s.length-n.length))+n;if(i=s.match(aE))return s9(i,d,u);if(s.match(/^#+0+$/))return u+$o(d,s.length-s.indexOf("0"));if(i=s.match(nE))return n=(""+r).replace(/^([^\.]+)$/,"$1."+Oi(i[1])).replace(/\.$/,"."+Oi(i[1])),n=n.replace(/\.(\d*)$/,function(g,x){return"."+x+Ia("0",Oi(i[1]).length-x.length)}),s.indexOf("0.")!==-1?n:n.replace(/^0\./,".");if(s=s.replace(/^#+([0.])/,"$1"),i=s.match(/^(0*)\.(#*)$/))return u+(""+d).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,i[1].length?"0.":".");if(i=s.match(/^#{1,3},##0(\.?)$/))return u+bu(""+d);if(i=s.match(/^#,##0\.([#0]*0)$/))return r<0?"-"+bc(t,s,-r):bu(""+r)+"."+Ia("0",i[1].length);if(i=s.match(/^#,#*,#0/))return bc(t,s.replace(/^#,#*,/,""),r);if(i=s.match(/^([0#]+)(\\?-([0#]+))+$/))return n=Rh(bc(t,s.replace(/[\\-]/g,""),r)),l=0,Rh(Rh(s.replace(/\\/g,"")).replace(/[0#]/g,function(g){return l<n.length?n.charAt(l++):g==="0"?"0":""}));if(s.match(lE))return n=bc(t,"##########",r),"("+n.substr(0,3)+") "+n.substr(3,3)+"-"+n.substr(6);var c="";if(i=s.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return l=Math.min(i[4].length,7),o=R0(d,Math.pow(10,l)-1,!1),n=""+u,c=Ad("n",i[1],o[1]),c.charAt(c.length-1)==" "&&(c=c.substr(0,c.length-1)+"0"),n+=c+i[2]+"/"+i[3],c=P0(o[2],l),c.length<i[4].length&&(c=Oi(i[4].substr(i[4].length-c.length))+c),n+=c,n;if(i=s.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return l=Math.min(Math.max(i[1].length,i[4].length),7),o=R0(d,Math.pow(10,l)-1,!0),u+(o[0]||(o[1]?"":"0"))+" "+(o[1]?cN(o[1],l)+i[2]+"/"+i[3]+P0(o[2],l):Ia(" ",2*l+1+i[2].length+i[3].length));if(i=s.match(/^[#0?]+$/))return n=""+r,s.length<=n.length?n:Oi(s.substr(0,s.length-n.length))+n;if(i=s.match(/^([#0]+)\.([#0]+)$/)){n=""+r.toFixed(Math.min(i[2].length,10)).replace(/([^0])0+$/,"$1"),l=n.indexOf(".");var h=s.indexOf(".")-l,m=s.length-n.length-h;return Oi(s.substr(0,h)+n+s.substr(s.length-m))}if(i=s.match(/^00,000\.([#0]*0)$/))return r<0?"-"+bc(t,s,-r):bu(""+r).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(g){return"00,"+(g.length<3?$o(0,3-g.length):"")+g})+"."+$o(0,i[1].length);switch(s){case"###,###":case"##,###":case"#,###":var p=bu(""+d);return p!=="0"?u+p:"";default:if(s.match(/\.[0#?]*$/))return bc(t,s.slice(0,s.lastIndexOf(".")),r)+Oi(s.slice(s.lastIndexOf(".")))}throw new Error("unsupported format |"+s+"|")}function Ad(t,s,r){return(r|0)===r?bc(t,s,r):zl(t,s,r)}function l9(t){for(var s=[],r=!1,a=0,n=0;a<t.length;++a)switch(t.charCodeAt(a)){case 34:r=!r;break;case 95:case 42:case 92:++a;break;case 59:s[s.length]=t.substr(n,a-n),n=a+1}if(s[s.length]=t.substr(n),r===!0)throw new Error("Format |"+t+"| unterminated string ");return s}var cE=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function nA(t){for(var s=0,r="",a="";s<t.length;)switch(r=t.charAt(s)){case"G":U0(t,s)&&(s+=6),s++;break;case'"':for(;t.charCodeAt(++s)!==34&&s<t.length;);++s;break;case"\\":s+=2;break;case"_":s+=2;break;case"@":++s;break;case"B":case"b":if(t.charAt(s+1)==="1"||t.charAt(s+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"":if(t.substr(s,3).toUpperCase()==="A/P"||t.substr(s,5).toUpperCase()==="AM/PM"||t.substr(s,5).toUpperCase()==="/")return!0;++s;break;case"[":for(a=r;t.charAt(s++)!=="]"&&s<t.length;)a+=t.charAt(s);if(a.match(cE))return!0;break;case".":case"0":case"#":for(;s<t.length&&("0#?.,E+-%".indexOf(r=t.charAt(++s))>-1||r=="\\"&&t.charAt(s+1)=="-"&&"0#".indexOf(t.charAt(s+2))>-1););break;case"?":for(;t.charAt(++s)===r;);break;case"*":++s,(t.charAt(s)==" "||t.charAt(s)=="*")&&++s;break;case"(":case")":++s;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;s<t.length&&"0123456789".indexOf(t.charAt(++s))>-1;);break;case" ":++s;break;default:++s;break}return!1}function o9(t,s,r,a){for(var n=[],i="",l=0,o="",d="t",u,c,h,m="H";l<t.length;)switch(o=t.charAt(l)){case"G":if(!U0(t,l))throw new Error("unrecognized character "+o+" in "+t);n[n.length]={t:"G",v:"General"},l+=7;break;case'"':for(i="";(h=t.charCodeAt(++l))!==34&&l<t.length;)i+=String.fromCharCode(h);n[n.length]={t:"t",v:i},++l;break;case"\\":var p=t.charAt(++l),g=p==="("||p===")"?p:"t";n[n.length]={t:g,v:p},++l;break;case"_":n[n.length]={t:"t",v:" "},l+=2;break;case"@":n[n.length]={t:"T",v:s},++l;break;case"B":case"b":if(t.charAt(l+1)==="1"||t.charAt(l+1)==="2"){if(u==null&&(u=pm(s,r,t.charAt(l+1)==="2"),u==null))return"";n[n.length]={t:"X",v:t.substr(l,2)},d=o,l+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":o=o.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(s<0||u==null&&(u=pm(s,r),u==null))return"";for(i=o;++l<t.length&&t.charAt(l).toLowerCase()===o;)i+=o;o==="m"&&d.toLowerCase()==="h"&&(o="M"),o==="h"&&(o=m),n[n.length]={t:o,v:i},d=o;break;case"A":case"a":case"":var x={t:o,v:o};if(u==null&&(u=pm(s,r)),t.substr(l,3).toUpperCase()==="A/P"?(u!=null&&(x.v=u.H>=12?"P":"A"),x.t="T",m="h",l+=3):t.substr(l,5).toUpperCase()==="AM/PM"?(u!=null&&(x.v=u.H>=12?"PM":"AM"),x.t="T",l+=5,m="h"):t.substr(l,5).toUpperCase()==="/"?(u!=null&&(x.v=u.H>=12?"":""),x.t="T",l+=5,m="h"):(x.t="t",++l),u==null&&x.t==="T")return"";n[n.length]=x,d=o;break;case"[":for(i=o;t.charAt(l++)!=="]"&&l<t.length;)i+=t.charAt(l);if(i.slice(-1)!=="]")throw'unterminated "[" block: |'+i+"|";if(i.match(cE)){if(u==null&&(u=pm(s,r),u==null))return"";n[n.length]={t:"Z",v:i.toLowerCase()},d=i.charAt(1)}else i.indexOf("$")>-1&&(i=(i.match(/\$([^-\[\]]*)/)||[])[1]||"$",nA(t)||(n[n.length]={t:"t",v:i}));break;case".":if(u!=null){for(i=o;++l<t.length&&(o=t.charAt(l))==="0";)i+=o;n[n.length]={t:"s",v:i};break}case"0":case"#":for(i=o;++l<t.length&&"0#?.,E+-%".indexOf(o=t.charAt(l))>-1;)i+=o;n[n.length]={t:"n",v:i};break;case"?":for(i=o;t.charAt(++l)===o;)i+=o;n[n.length]={t:o,v:i},d=o;break;case"*":++l,(t.charAt(l)==" "||t.charAt(l)=="*")&&++l;break;case"(":case")":n[n.length]={t:a===1?"t":o,v:o},++l;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(i=o;l<t.length&&"0123456789".indexOf(t.charAt(++l))>-1;)i+=t.charAt(l);n[n.length]={t:"D",v:i};break;case" ":n[n.length]={t:o,v:o},++l;break;case"$":n[n.length]={t:"t",v:"$"},++l;break;default:if(",$-+/():!^&'~{}<>=acfijklopqrtuvwxzP".indexOf(o)===-1)throw new Error("unrecognized character "+o+" in "+t);n[n.length]={t:"t",v:o},++l;break}var b=0,y=0,j;for(l=n.length-1,d="t";l>=0;--l)switch(n[l].t){case"h":case"H":n[l].t=m,d="h",b<1&&(b=1);break;case"s":(j=n[l].v.match(/\.0+$/))&&(y=Math.max(y,j[0].length-1)),b<3&&(b=3);case"d":case"y":case"M":case"e":d=n[l].t;break;case"m":d==="s"&&(n[l].t="M",b<2&&(b=2));break;case"X":break;case"Z":b<1&&n[l].v.match(/[Hh]/)&&(b=1),b<2&&n[l].v.match(/[Mm]/)&&(b=2),b<3&&n[l].v.match(/[Ss]/)&&(b=3)}switch(b){case 0:break;case 1:u.u>=.5&&(u.u=0,++u.S),u.S>=60&&(u.S=0,++u.M),u.M>=60&&(u.M=0,++u.H);break;case 2:u.u>=.5&&(u.u=0,++u.S),u.S>=60&&(u.S=0,++u.M);break}var N="",_;for(l=0;l<n.length;++l)switch(n[l].t){case"t":case"T":case" ":case"D":break;case"X":n[l].v="",n[l].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":n[l].v=JH(n[l].t.charCodeAt(0),n[l].v,u,y),n[l].t="t";break;case"n":case"?":for(_=l+1;n[_]!=null&&((o=n[_].t)==="?"||o==="D"||(o===" "||o==="t")&&n[_+1]!=null&&(n[_+1].t==="?"||n[_+1].t==="t"&&n[_+1].v==="/")||n[l].t==="("&&(o===" "||o==="n"||o===")")||o==="t"&&(n[_].v==="/"||n[_].v===" "&&n[_+1]!=null&&n[_+1].t=="?"));)n[l].v+=n[_].v,n[_]={v:"",t:";"},++_;N+=n[l].v,l=_-1;break;case"G":n[l].t="t",n[l].v=km(s,r);break}var F="",I,w;if(N.length>0){N.charCodeAt(0)==40?(I=s<0&&N.charCodeAt(0)===45?-s:s,w=Ad("n",N,I)):(I=s<0&&a>1?-s:s,w=Ad("n",N,I),I<0&&n[0]&&n[0].t=="t"&&(w=w.substr(1),n[0].v="-"+n[0].v)),_=w.length-1;var E=n.length;for(l=0;l<n.length;++l)if(n[l]!=null&&n[l].t!="t"&&n[l].v.indexOf(".")>-1){E=l;break}var W=n.length;if(E===n.length&&w.indexOf("E")===-1){for(l=n.length-1;l>=0;--l)n[l]==null||"n?".indexOf(n[l].t)===-1||(_>=n[l].v.length-1?(_-=n[l].v.length,n[l].v=w.substr(_+1,n[l].v.length)):_<0?n[l].v="":(n[l].v=w.substr(0,_+1),_=-1),n[l].t="t",W=l);_>=0&&W<n.length&&(n[W].v=w.substr(0,_+1)+n[W].v)}else if(E!==n.length&&w.indexOf("E")===-1){for(_=w.indexOf(".")-1,l=E;l>=0;--l)if(!(n[l]==null||"n?".indexOf(n[l].t)===-1)){for(c=n[l].v.indexOf(".")>-1&&l===E?n[l].v.indexOf(".")-1:n[l].v.length-1,F=n[l].v.substr(c+1);c>=0;--c)_>=0&&(n[l].v.charAt(c)==="0"||n[l].v.charAt(c)==="#")&&(F=w.charAt(_--)+F);n[l].v=F,n[l].t="t",W=l}for(_>=0&&W<n.length&&(n[W].v=w.substr(0,_+1)+n[W].v),_=w.indexOf(".")+1,l=E;l<n.length;++l)if(!(n[l]==null||"n?(".indexOf(n[l].t)===-1&&l!==E)){for(c=n[l].v.indexOf(".")>-1&&l===E?n[l].v.indexOf(".")+1:0,F=n[l].v.substr(0,c);c<n[l].v.length;++c)_<w.length&&(F+=w.charAt(_++));n[l].v=F,n[l].t="t",W=l}}}for(l=0;l<n.length;++l)n[l]!=null&&"n?".indexOf(n[l].t)>-1&&(I=a>1&&s<0&&l>0&&n[l-1].v==="-"?-s:s,n[l].v=Ad(n[l].t,n[l].v,I),n[l].t="t");var R="";for(l=0;l!==n.length;++l)n[l]!=null&&(R+=n[l].v);return R}var aS=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function nS(t,s){if(s==null)return!1;var r=parseFloat(s[2]);switch(s[1]){case"=":if(t==r)return!0;break;case">":if(t>r)return!0;break;case"<":if(t<r)return!0;break;case"<>":if(t!=r)return!0;break;case">=":if(t>=r)return!0;break;case"<=":if(t<=r)return!0;break}return!1}function c9(t,s){var r=l9(t),a=r.length,n=r[a-1].indexOf("@");if(a<4&&n>-1&&--a,r.length>4)throw new Error("cannot find right format for |"+r.join("|")+"|");if(typeof s!="number")return[4,r.length===4||n>-1?r[r.length-1]:"@"];switch(r.length){case 1:r=n>-1?["General","General","General",r[0]]:[r[0],r[0],r[0],"@"];break;case 2:r=n>-1?[r[0],r[0],r[0],r[1]]:[r[0],r[1],r[0],"@"];break;case 3:r=n>-1?[r[0],r[1],r[0],r[2]]:[r[0],r[1],r[2],"@"];break}var i=s>0?r[0]:s<0?r[1]:r[2];if(r[0].indexOf("[")===-1&&r[1].indexOf("[")===-1)return[a,i];if(r[0].match(/\[[=<>]/)!=null||r[1].match(/\[[=<>]/)!=null){var l=r[0].match(aS),o=r[1].match(aS);return nS(s,l)?[a,r[0]]:nS(s,o)?[a,r[1]]:[a,r[l!=null&&o!=null?2:1]]}return[a,i]}function io(t,s,r){r==null&&(r={});var a="";switch(typeof t){case"string":t=="m/d/yy"&&r.dateNF?a=r.dateNF:a=t;break;case"number":t==14&&r.dateNF?a=r.dateNF:a=(r.table!=null?r.table:Vs)[t],a==null&&(a=r.table&&r.table[tS[t]]||Vs[tS[t]]),a==null&&(a=VH[t]||"General");break}if(U0(a,0))return km(s,r);s instanceof Date&&(s=tE(s,r.date1904));var n=c9(a,s);if(U0(n[1]))return km(s,r);if(s===!0)s="TRUE";else if(s===!1)s="FALSE";else if(s===""||s==null)return"";return o9(n[1],s,r,n[0])}function fd(t,s){if(typeof s!="number"){s=+s||-1;for(var r=0;r<392;++r){if(Vs[r]==null){s<0&&(s=r);continue}if(Vs[r]==t){s=r;break}}s<0&&(s=391)}return Vs[s]=t,s}function Bg(t){for(var s=0;s!=392;++s)t[s]!==void 0&&fd(t[s],s)}function iA(){Vs=$H()}var d9={5:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',23:"General",24:"General",25:"General",26:"General",27:"m/d/yy",28:"m/d/yy",29:"m/d/yy",30:"m/d/yy",31:"m/d/yy",32:"h:mm:ss",33:"h:mm:ss",34:"h:mm:ss",35:"h:mm:ss",36:"m/d/yy",41:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* (#,##0);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* (#,##0.00);_("$"* "-"??_);_(@_)',50:"m/d/yy",51:"m/d/yy",52:"m/d/yy",53:"m/d/yy",54:"m/d/yy",55:"m/d/yy",56:"m/d/yy",57:"m/d/yy",58:"m/d/yy",59:"0",60:"0.00",61:"#,##0",62:"#,##0.00",63:'"$"#,##0_);\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',67:"0%",68:"0.00%",69:"# ?/?",70:"# ??/??",71:"m/d/yy",72:"m/d/yy",73:"d-mmm-yy",74:"d-mmm",75:"mmm-yy",76:"h:mm",77:"h:mm:ss",78:"m/d/yy h:mm",79:"mm:ss",80:"[h]:mm:ss",81:"mmss.0"},dE=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function u9(t){var s=typeof t=="number"?Vs[t]:t;return s=s.replace(dE,"(\\d+)"),new RegExp("^"+s+"$")}function m9(t,s,r){var a=-1,n=-1,i=-1,l=-1,o=-1,d=-1;(s.match(dE)||[]).forEach(function(h,m){var p=parseInt(r[m+1],10);switch(h.toLowerCase().charAt(0)){case"y":a=p;break;case"d":i=p;break;case"h":l=p;break;case"s":d=p;break;case"m":l>=0?o=p:n=p;break}}),d>=0&&o==-1&&n>=0&&(o=n,n=-1);var u=(""+(a>=0?a:new Date().getFullYear())).slice(-4)+"-"+("00"+(n>=1?n:1)).slice(-2)+"-"+("00"+(i>=1?i:1)).slice(-2);u.length==7&&(u="0"+u),u.length==8&&(u="20"+u);var c=("00"+(l>=0?l:0)).slice(-2)+":"+("00"+(o>=0?o:0)).slice(-2)+":"+("00"+(d>=0?d:0)).slice(-2);return l==-1&&o==-1&&d==-1?u:a==-1&&n==-1&&i==-1?c:u+"T"+c}var h9=(function(){var t={};t.version="1.2.0";function s(){for(var w=0,E=new Array(256),W=0;W!=256;++W)w=W,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,E[W]=w;return typeof Int32Array<"u"?new Int32Array(E):E}var r=s();function a(w){var E=0,W=0,R=0,U=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(R=0;R!=256;++R)U[R]=w[R];for(R=0;R!=256;++R)for(W=w[R],E=256+R;E<4096;E+=256)W=U[E]=W>>>8^w[W&255];var T=[];for(R=1;R!=16;++R)T[R-1]=typeof Int32Array<"u"?U.subarray(R*256,R*256+256):U.slice(R*256,R*256+256);return T}var n=a(r),i=n[0],l=n[1],o=n[2],d=n[3],u=n[4],c=n[5],h=n[6],m=n[7],p=n[8],g=n[9],x=n[10],b=n[11],y=n[12],j=n[13],N=n[14];function _(w,E){for(var W=E^-1,R=0,U=w.length;R<U;)W=W>>>8^r[(W^w.charCodeAt(R++))&255];return~W}function F(w,E){for(var W=E^-1,R=w.length-15,U=0;U<R;)W=N[w[U++]^W&255]^j[w[U++]^W>>8&255]^y[w[U++]^W>>16&255]^b[w[U++]^W>>>24]^x[w[U++]]^g[w[U++]]^p[w[U++]]^m[w[U++]]^h[w[U++]]^c[w[U++]]^u[w[U++]]^d[w[U++]]^o[w[U++]]^l[w[U++]]^i[w[U++]]^r[w[U++]];for(R+=15;U<R;)W=W>>>8^r[(W^w[U++])&255];return~W}function I(w,E){for(var W=E^-1,R=0,U=w.length,T=0,Y=0;R<U;)T=w.charCodeAt(R++),T<128?W=W>>>8^r[(W^T)&255]:T<2048?(W=W>>>8^r[(W^(192|T>>6&31))&255],W=W>>>8^r[(W^(128|T&63))&255]):T>=55296&&T<57344?(T=(T&1023)+64,Y=w.charCodeAt(R++)&1023,W=W>>>8^r[(W^(240|T>>8&7))&255],W=W>>>8^r[(W^(128|T>>2&63))&255],W=W>>>8^r[(W^(128|Y>>6&15|(T&3)<<4))&255],W=W>>>8^r[(W^(128|Y&63))&255]):(W=W>>>8^r[(W^(224|T>>12&15))&255],W=W>>>8^r[(W^(128|T>>6&63))&255],W=W>>>8^r[(W^(128|T&63))&255]);return~W}return t.table=r,t.bstr=_,t.buf=F,t.str=I,t})(),Qs=(function(){var s={};s.version="1.2.1";function r(Ne,ke){for(var qe=Ne.split("/"),ge=ke.split("/"),Me=0,Ve=0,vt=Math.min(qe.length,ge.length);Me<vt;++Me){if(Ve=qe[Me].length-ge[Me].length)return Ve;if(qe[Me]!=ge[Me])return qe[Me]<ge[Me]?-1:1}return qe.length-ge.length}function a(Ne){if(Ne.charAt(Ne.length-1)=="/")return Ne.slice(0,-1).indexOf("/")===-1?Ne:a(Ne.slice(0,-1));var ke=Ne.lastIndexOf("/");return ke===-1?Ne:Ne.slice(0,ke+1)}function n(Ne){if(Ne.charAt(Ne.length-1)=="/")return n(Ne.slice(0,-1));var ke=Ne.lastIndexOf("/");return ke===-1?Ne:Ne.slice(ke+1)}function i(Ne,ke){typeof ke=="string"&&(ke=new Date(ke));var qe=ke.getHours();qe=qe<<6|ke.getMinutes(),qe=qe<<5|ke.getSeconds()>>>1,Ne.write_shift(2,qe);var ge=ke.getFullYear()-1980;ge=ge<<4|ke.getMonth()+1,ge=ge<<5|ke.getDate(),Ne.write_shift(2,ge)}function l(Ne){var ke=Ne.read_shift(2)&65535,qe=Ne.read_shift(2)&65535,ge=new Date,Me=qe&31;qe>>>=5;var Ve=qe&15;qe>>>=4,ge.setMilliseconds(0),ge.setFullYear(qe+1980),ge.setMonth(Ve-1),ge.setDate(Me);var vt=ke&31;ke>>>=5;var St=ke&63;return ke>>>=6,ge.setHours(ke),ge.setMinutes(St),ge.setSeconds(vt<<1),ge}function o(Ne){Gn(Ne,0);for(var ke={},qe=0;Ne.l<=Ne.length-4;){var ge=Ne.read_shift(2),Me=Ne.read_shift(2),Ve=Ne.l+Me,vt={};switch(ge){case 21589:qe=Ne.read_shift(1),qe&1&&(vt.mtime=Ne.read_shift(4)),Me>5&&(qe&2&&(vt.atime=Ne.read_shift(4)),qe&4&&(vt.ctime=Ne.read_shift(4))),vt.mtime&&(vt.mt=new Date(vt.mtime*1e3));break}Ne.l=Ve,ke[ge]=vt}return ke}var d;function u(){return d||(d={})}function c(Ne,ke){if(Ne[0]==80&&Ne[1]==75)return Ee(Ne,ke);if((Ne[0]|32)==109&&(Ne[1]|32)==105)return je(Ne,ke);if(Ne.length<512)throw new Error("CFB file size "+Ne.length+" < 512");var qe=3,ge=512,Me=0,Ve=0,vt=0,St=0,xt=0,Ct=[],Tt=Ne.slice(0,512);Gn(Tt,0);var bt=h(Tt);switch(qe=bt[0],qe){case 3:ge=512;break;case 4:ge=4096;break;case 0:if(bt[1]==0)return Ee(Ne,ke);default:throw new Error("Major Version: Expected 3 or 4 saw "+qe)}ge!==512&&(Tt=Ne.slice(0,ge),Gn(Tt,28));var Jt=Ne.slice(0,ge);m(Tt,qe);var Gt=Tt.read_shift(4,"i");if(qe===3&&Gt!==0)throw new Error("# Directory Sectors: Expected 0 saw "+Gt);Tt.l+=4,vt=Tt.read_shift(4,"i"),Tt.l+=4,Tt.chk("00100000","Mini Stream Cutoff Size: "),St=Tt.read_shift(4,"i"),Me=Tt.read_shift(4,"i"),xt=Tt.read_shift(4,"i"),Ve=Tt.read_shift(4,"i");for(var Ht=-1,es=0;es<109&&(Ht=Tt.read_shift(4,"i"),!(Ht<0));++es)Ct[es]=Ht;var js=p(Ne,ge);b(xt,Ve,js,ge,Ct);var Zs=j(js,vt,Ct,ge);Zs[vt].name="!Directory",Me>0&&St!==Y&&(Zs[St].name="!MiniFAT"),Zs[Ct[0]].name="!FAT",Zs.fat_addrs=Ct,Zs.ssz=ge;var Xs={},Hs=[],Bs=[],Ln=[];N(vt,Zs,js,Hs,Me,Xs,Bs,St),g(Bs,Ln,Hs),Hs.shift();var br={FileIndex:Bs,FullPaths:Ln};return ke&&ke.raw&&(br.raw={header:Jt,sectors:js}),br}function h(Ne){if(Ne[Ne.l]==80&&Ne[Ne.l+1]==75)return[0,0];Ne.chk(H,"Header Signature: "),Ne.l+=16;var ke=Ne.read_shift(2,"u");return[Ne.read_shift(2,"u"),ke]}function m(Ne,ke){var qe=9;switch(Ne.l+=2,qe=Ne.read_shift(2)){case 9:if(ke!=3)throw new Error("Sector Shift: Expected 9 saw "+qe);break;case 12:if(ke!=4)throw new Error("Sector Shift: Expected 12 saw "+qe);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+qe)}Ne.chk("0600","Mini Sector Shift: "),Ne.chk("000000000000","Reserved: ")}function p(Ne,ke){for(var qe=Math.ceil(Ne.length/ke)-1,ge=[],Me=1;Me<qe;++Me)ge[Me-1]=Ne.slice(Me*ke,(Me+1)*ke);return ge[qe-1]=Ne.slice(qe*ke),ge}function g(Ne,ke,qe){for(var ge=0,Me=0,Ve=0,vt=0,St=0,xt=qe.length,Ct=[],Tt=[];ge<xt;++ge)Ct[ge]=Tt[ge]=ge,ke[ge]=qe[ge];for(;St<Tt.length;++St)ge=Tt[St],Me=Ne[ge].L,Ve=Ne[ge].R,vt=Ne[ge].C,Ct[ge]===ge&&(Me!==-1&&Ct[Me]!==Me&&(Ct[ge]=Ct[Me]),Ve!==-1&&Ct[Ve]!==Ve&&(Ct[ge]=Ct[Ve])),vt!==-1&&(Ct[vt]=ge),Me!==-1&&ge!=Ct[ge]&&(Ct[Me]=Ct[ge],Tt.lastIndexOf(Me)<St&&Tt.push(Me)),Ve!==-1&&ge!=Ct[ge]&&(Ct[Ve]=Ct[ge],Tt.lastIndexOf(Ve)<St&&Tt.push(Ve));for(ge=1;ge<xt;++ge)Ct[ge]===ge&&(Ve!==-1&&Ct[Ve]!==Ve?Ct[ge]=Ct[Ve]:Me!==-1&&Ct[Me]!==Me&&(Ct[ge]=Ct[Me]));for(ge=1;ge<xt;++ge)if(Ne[ge].type!==0){if(St=ge,St!=Ct[St])do St=Ct[St],ke[ge]=ke[St]+"/"+ke[ge];while(St!==0&&Ct[St]!==-1&&St!=Ct[St]);Ct[ge]=-1}for(ke[0]+="/",ge=1;ge<xt;++ge)Ne[ge].type!==2&&(ke[ge]+="/")}function x(Ne,ke,qe){for(var ge=Ne.start,Me=Ne.size,Ve=[],vt=ge;qe&&Me>0&&vt>=0;)Ve.push(ke.slice(vt*T,vt*T+T)),Me-=T,vt=mm(qe,vt*4);return Ve.length===0?Zt(0):Fn(Ve).slice(0,Ne.size)}function b(Ne,ke,qe,ge,Me){var Ve=Y;if(Ne===Y){if(ke!==0)throw new Error("DIFAT chain shorter than expected")}else if(Ne!==-1){var vt=qe[Ne],St=(ge>>>2)-1;if(!vt)return;for(var xt=0;xt<St&&(Ve=mm(vt,xt*4))!==Y;++xt)Me.push(Ve);b(mm(vt,ge-4),ke-1,qe,ge,Me)}}function y(Ne,ke,qe,ge,Me){var Ve=[],vt=[];Me||(Me=[]);var St=ge-1,xt=0,Ct=0;for(xt=ke;xt>=0;){Me[xt]=!0,Ve[Ve.length]=xt,vt.push(Ne[xt]);var Tt=qe[Math.floor(xt*4/ge)];if(Ct=xt*4&St,ge<4+Ct)throw new Error("FAT boundary crossed: "+xt+" 4 "+ge);if(!Ne[Tt])break;xt=mm(Ne[Tt],Ct)}return{nodes:Ve,data:xS([vt])}}function j(Ne,ke,qe,ge){var Me=Ne.length,Ve=[],vt=[],St=[],xt=[],Ct=ge-1,Tt=0,bt=0,Jt=0,Gt=0;for(Tt=0;Tt<Me;++Tt)if(St=[],Jt=Tt+ke,Jt>=Me&&(Jt-=Me),!vt[Jt]){xt=[];var Ht=[];for(bt=Jt;bt>=0;){Ht[bt]=!0,vt[bt]=!0,St[St.length]=bt,xt.push(Ne[bt]);var es=qe[Math.floor(bt*4/ge)];if(Gt=bt*4&Ct,ge<4+Gt)throw new Error("FAT boundary crossed: "+bt+" 4 "+ge);if(!Ne[es]||(bt=mm(Ne[es],Gt),Ht[bt]))break}Ve[Jt]={nodes:St,data:xS([xt])}}return Ve}function N(Ne,ke,qe,ge,Me,Ve,vt,St){for(var xt=0,Ct=ge.length?2:0,Tt=ke[Ne].data,bt=0,Jt=0,Gt;bt<Tt.length;bt+=128){var Ht=Tt.slice(bt,bt+128);Gn(Ht,64),Jt=Ht.read_shift(2),Gt=xN(Ht,0,Jt-Ct),ge.push(Gt);var es={name:Gt,type:Ht.read_shift(1),color:Ht.read_shift(1),L:Ht.read_shift(4,"i"),R:Ht.read_shift(4,"i"),C:Ht.read_shift(4,"i"),clsid:Ht.read_shift(16),state:Ht.read_shift(4,"i"),start:0,size:0},js=Ht.read_shift(2)+Ht.read_shift(2)+Ht.read_shift(2)+Ht.read_shift(2);js!==0&&(es.ct=_(Ht,Ht.l-8));var Zs=Ht.read_shift(2)+Ht.read_shift(2)+Ht.read_shift(2)+Ht.read_shift(2);Zs!==0&&(es.mt=_(Ht,Ht.l-8)),es.start=Ht.read_shift(4,"i"),es.size=Ht.read_shift(4,"i"),es.size<0&&es.start<0&&(es.size=es.type=0,es.start=Y,es.name=""),es.type===5?(xt=es.start,Me>0&&xt!==Y&&(ke[xt].name="!StreamData")):es.size>=4096?(es.storage="fat",ke[es.start]===void 0&&(ke[es.start]=y(qe,es.start,ke.fat_addrs,ke.ssz)),ke[es.start].name=es.name,es.content=ke[es.start].data.slice(0,es.size)):(es.storage="minifat",es.size<0?es.size=0:xt!==Y&&es.start!==Y&&ke[xt]&&(es.content=x(es,ke[xt].data,(ke[St]||{}).data))),es.content&&Gn(es.content,0),Ve[Gt]=es,vt.push(es)}}function _(Ne,ke){return new Date((_l(Ne,ke+4)/1e7*Math.pow(2,32)+_l(Ne,ke)/1e7-11644473600)*1e3)}function F(Ne,ke){return u(),c(d.readFileSync(Ne),ke)}function I(Ne,ke){var qe=ke&&ke.type;switch(qe||ur&&Buffer.isBuffer(Ne)&&(qe="buffer"),qe||"base64"){case"file":return F(Ne,ke);case"base64":return c(Sl(Tl(Ne)),ke);case"binary":return c(Sl(Ne),ke)}return c(Ne,ke)}function w(Ne,ke){var qe=ke||{},ge=qe.root||"Root Entry";if(Ne.FullPaths||(Ne.FullPaths=[]),Ne.FileIndex||(Ne.FileIndex=[]),Ne.FullPaths.length!==Ne.FileIndex.length)throw new Error("inconsistent CFB structure");Ne.FullPaths.length===0&&(Ne.FullPaths[0]=ge+"/",Ne.FileIndex[0]={name:ge,type:5}),qe.CLSID&&(Ne.FileIndex[0].clsid=qe.CLSID),E(Ne)}function E(Ne){var ke="Sh33tJ5";if(!Qs.find(Ne,"/"+ke)){var qe=Zt(4);qe[0]=55,qe[1]=qe[3]=50,qe[2]=54,Ne.FileIndex.push({name:ke,type:2,content:qe,size:4,L:69,R:69,C:69}),Ne.FullPaths.push(Ne.FullPaths[0]+ke),W(Ne)}}function W(Ne,ke){w(Ne);for(var qe=!1,ge=!1,Me=Ne.FullPaths.length-1;Me>=0;--Me){var Ve=Ne.FileIndex[Me];switch(Ve.type){case 0:ge?qe=!0:(Ne.FileIndex.pop(),Ne.FullPaths.pop());break;case 1:case 2:case 5:ge=!0,isNaN(Ve.R*Ve.L*Ve.C)&&(qe=!0),Ve.R>-1&&Ve.L>-1&&Ve.R==Ve.L&&(qe=!0);break;default:qe=!0;break}}if(!(!qe&&!ke)){var vt=new Date(1987,1,19),St=0,xt=Object.create?Object.create(null):{},Ct=[];for(Me=0;Me<Ne.FullPaths.length;++Me)xt[Ne.FullPaths[Me]]=!0,Ne.FileIndex[Me].type!==0&&Ct.push([Ne.FullPaths[Me],Ne.FileIndex[Me]]);for(Me=0;Me<Ct.length;++Me){var Tt=a(Ct[Me][0]);ge=xt[Tt],ge||(Ct.push([Tt,{name:n(Tt).replace("/",""),type:1,clsid:q,ct:vt,mt:vt,content:null}]),xt[Tt]=!0)}for(Ct.sort(function(Gt,Ht){return r(Gt[0],Ht[0])}),Ne.FullPaths=[],Ne.FileIndex=[],Me=0;Me<Ct.length;++Me)Ne.FullPaths[Me]=Ct[Me][0],Ne.FileIndex[Me]=Ct[Me][1];for(Me=0;Me<Ct.length;++Me){var bt=Ne.FileIndex[Me],Jt=Ne.FullPaths[Me];if(bt.name=n(Jt).replace("/",""),bt.L=bt.R=bt.C=-(bt.color=1),bt.size=bt.content?bt.content.length:0,bt.start=0,bt.clsid=bt.clsid||q,Me===0)bt.C=Ct.length>1?1:-1,bt.size=0,bt.type=5;else if(Jt.slice(-1)=="/"){for(St=Me+1;St<Ct.length&&a(Ne.FullPaths[St])!=Jt;++St);for(bt.C=St>=Ct.length?-1:St,St=Me+1;St<Ct.length&&a(Ne.FullPaths[St])!=a(Jt);++St);bt.R=St>=Ct.length?-1:St,bt.type=1}else a(Ne.FullPaths[Me+1]||"")==a(Jt)&&(bt.R=Me+1),bt.type=2}}}function R(Ne,ke){var qe=ke||{};if(qe.fileType=="mad")return Se(Ne,qe);switch(W(Ne),qe.fileType){case"zip":return mt(Ne,qe)}var ge=(function(Gt){for(var Ht=0,es=0,js=0;js<Gt.FileIndex.length;++js){var Zs=Gt.FileIndex[js];if(Zs.content){var Xs=Zs.content.length;Xs>0&&(Xs<4096?Ht+=Xs+63>>6:es+=Xs+511>>9)}}for(var Hs=Gt.FullPaths.length+3>>2,Bs=Ht+7>>3,Ln=Ht+127>>7,br=Bs+es+Hs+Ln,mr=br+127>>7,Ja=mr<=109?0:Math.ceil((mr-109)/127);br+mr+Ja+127>>7>mr;)Ja=++mr<=109?0:Math.ceil((mr-109)/127);var Tr=[1,Ja,mr,Ln,Hs,es,Ht,0];return Gt.FileIndex[0].size=Ht<<6,Tr[7]=(Gt.FileIndex[0].start=Tr[0]+Tr[1]+Tr[2]+Tr[3]+Tr[4]+Tr[5])+(Tr[6]+7>>3),Tr})(Ne),Me=Zt(ge[7]<<9),Ve=0,vt=0;{for(Ve=0;Ve<8;++Ve)Me.write_shift(1,M[Ve]);for(Ve=0;Ve<8;++Ve)Me.write_shift(2,0);for(Me.write_shift(2,62),Me.write_shift(2,3),Me.write_shift(2,65534),Me.write_shift(2,9),Me.write_shift(2,6),Ve=0;Ve<3;++Ve)Me.write_shift(2,0);for(Me.write_shift(4,0),Me.write_shift(4,ge[2]),Me.write_shift(4,ge[0]+ge[1]+ge[2]+ge[3]-1),Me.write_shift(4,0),Me.write_shift(4,4096),Me.write_shift(4,ge[3]?ge[0]+ge[1]+ge[2]-1:Y),Me.write_shift(4,ge[3]),Me.write_shift(-4,ge[1]?ge[0]-1:Y),Me.write_shift(4,ge[1]),Ve=0;Ve<109;++Ve)Me.write_shift(-4,Ve<ge[2]?ge[1]+Ve:-1)}if(ge[1])for(vt=0;vt<ge[1];++vt){for(;Ve<236+vt*127;++Ve)Me.write_shift(-4,Ve<ge[2]?ge[1]+Ve:-1);Me.write_shift(-4,vt===ge[1]-1?Y:vt+1)}var St=function(Gt){for(vt+=Gt;Ve<vt-1;++Ve)Me.write_shift(-4,Ve+1);Gt&&(++Ve,Me.write_shift(-4,Y))};for(vt=Ve=0,vt+=ge[1];Ve<vt;++Ve)Me.write_shift(-4,z.DIFSECT);for(vt+=ge[2];Ve<vt;++Ve)Me.write_shift(-4,z.FATSECT);St(ge[3]),St(ge[4]);for(var xt=0,Ct=0,Tt=Ne.FileIndex[0];xt<Ne.FileIndex.length;++xt)Tt=Ne.FileIndex[xt],Tt.content&&(Ct=Tt.content.length,!(Ct<4096)&&(Tt.start=vt,St(Ct+511>>9)));for(St(ge[6]+7>>3);Me.l&511;)Me.write_shift(-4,z.ENDOFCHAIN);for(vt=Ve=0,xt=0;xt<Ne.FileIndex.length;++xt)Tt=Ne.FileIndex[xt],Tt.content&&(Ct=Tt.content.length,!(!Ct||Ct>=4096)&&(Tt.start=vt,St(Ct+63>>6)));for(;Me.l&511;)Me.write_shift(-4,z.ENDOFCHAIN);for(Ve=0;Ve<ge[4]<<2;++Ve){var bt=Ne.FullPaths[Ve];if(!bt||bt.length===0){for(xt=0;xt<17;++xt)Me.write_shift(4,0);for(xt=0;xt<3;++xt)Me.write_shift(4,-1);for(xt=0;xt<12;++xt)Me.write_shift(4,0);continue}Tt=Ne.FileIndex[Ve],Ve===0&&(Tt.start=Tt.size?Tt.start-1:Y);var Jt=Ve===0&&qe.root||Tt.name;if(Ct=2*(Jt.length+1),Me.write_shift(64,Jt,"utf16le"),Me.write_shift(2,Ct),Me.write_shift(1,Tt.type),Me.write_shift(1,Tt.color),Me.write_shift(-4,Tt.L),Me.write_shift(-4,Tt.R),Me.write_shift(-4,Tt.C),Tt.clsid)Me.write_shift(16,Tt.clsid,"hex");else for(xt=0;xt<4;++xt)Me.write_shift(4,0);Me.write_shift(4,Tt.state||0),Me.write_shift(4,0),Me.write_shift(4,0),Me.write_shift(4,0),Me.write_shift(4,0),Me.write_shift(4,Tt.start),Me.write_shift(4,Tt.size),Me.write_shift(4,0)}for(Ve=1;Ve<Ne.FileIndex.length;++Ve)if(Tt=Ne.FileIndex[Ve],Tt.size>=4096)if(Me.l=Tt.start+1<<9,ur&&Buffer.isBuffer(Tt.content))Tt.content.copy(Me,Me.l,0,Tt.size),Me.l+=Tt.size+511&-512;else{for(xt=0;xt<Tt.size;++xt)Me.write_shift(1,Tt.content[xt]);for(;xt&511;++xt)Me.write_shift(1,0)}for(Ve=1;Ve<Ne.FileIndex.length;++Ve)if(Tt=Ne.FileIndex[Ve],Tt.size>0&&Tt.size<4096)if(ur&&Buffer.isBuffer(Tt.content))Tt.content.copy(Me,Me.l,0,Tt.size),Me.l+=Tt.size+63&-64;else{for(xt=0;xt<Tt.size;++xt)Me.write_shift(1,Tt.content[xt]);for(;xt&63;++xt)Me.write_shift(1,0)}if(ur)Me.l=Me.length;else for(;Me.l<Me.length;)Me.write_shift(1,0);return Me}function U(Ne,ke){var qe=Ne.FullPaths.map(function(xt){return xt.toUpperCase()}),ge=qe.map(function(xt){var Ct=xt.split("/");return Ct[Ct.length-(xt.slice(-1)=="/"?2:1)]}),Me=!1;ke.charCodeAt(0)===47?(Me=!0,ke=qe[0].slice(0,-1)+ke):Me=ke.indexOf("/")!==-1;var Ve=ke.toUpperCase(),vt=Me===!0?qe.indexOf(Ve):ge.indexOf(Ve);if(vt!==-1)return Ne.FileIndex[vt];var St=!Ve.match(XA);for(Ve=Ve.replace(Hi,""),St&&(Ve=Ve.replace(XA,"!")),vt=0;vt<qe.length;++vt)if((St?qe[vt].replace(XA,"!"):qe[vt]).replace(Hi,"")==Ve||(St?ge[vt].replace(XA,"!"):ge[vt]).replace(Hi,"")==Ve)return Ne.FileIndex[vt];return null}var T=64,Y=-2,H="d0cf11e0a1b11ae1",M=[208,207,17,224,161,177,26,225],q="00000000000000000000000000000000",z={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:Y,FREESECT:-1,HEADER_SIGNATURE:H,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:q,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function Q(Ne,ke,qe){u();var ge=R(Ne,qe);d.writeFileSync(ke,ge)}function L(Ne){for(var ke=new Array(Ne.length),qe=0;qe<Ne.length;++qe)ke[qe]=String.fromCharCode(Ne[qe]);return ke.join("")}function V(Ne,ke){var qe=R(Ne,ke);switch(ke&&ke.type||"buffer"){case"file":return u(),d.writeFileSync(ke.filename,qe),qe;case"binary":return typeof qe=="string"?qe:L(qe);case"base64":return Ff(typeof qe=="string"?qe:L(qe));case"buffer":if(ur)return Buffer.isBuffer(qe)?qe:Nd(qe);case"array":return typeof qe=="string"?Sl(qe):qe}return qe}var P;function C(Ne){try{var ke=Ne.InflateRaw,qe=new ke;if(qe._processChunk(new Uint8Array([3,0]),qe._finishFlushFlag),qe.bytesRead)P=Ne;else throw new Error("zlib does not expose bytesRead")}catch(ge){console.error("cannot use native zlib: "+(ge.message||ge))}}function k(Ne,ke){if(!P)return Ae(Ne,ke);var qe=P.InflateRaw,ge=new qe,Me=ge._processChunk(Ne.slice(Ne.l),ge._finishFlushFlag);return Ne.l+=ge.bytesRead,Me}function B(Ne){return P?P.deflateRawSync(Ne):fe(Ne)}var G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],O=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],K=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function J(Ne){var ke=(Ne<<1|Ne<<11)&139536|(Ne<<5|Ne<<15)&558144;return(ke>>16|ke>>8|ke)&255}for(var te=typeof Uint8Array<"u",se=te?new Uint8Array(256):[],ae=0;ae<256;++ae)se[ae]=J(ae);function ne(Ne,ke){var qe=se[Ne&255];return ke<=8?qe>>>8-ke:(qe=qe<<8|se[Ne>>8&255],ke<=16?qe>>>16-ke:(qe=qe<<8|se[Ne>>16&255],qe>>>24-ke))}function ue(Ne,ke){var qe=ke&7,ge=ke>>>3;return(Ne[ge]|(qe<=6?0:Ne[ge+1]<<8))>>>qe&3}function oe(Ne,ke){var qe=ke&7,ge=ke>>>3;return(Ne[ge]|(qe<=5?0:Ne[ge+1]<<8))>>>qe&7}function le(Ne,ke){var qe=ke&7,ge=ke>>>3;return(Ne[ge]|(qe<=4?0:Ne[ge+1]<<8))>>>qe&15}function X(Ne,ke){var qe=ke&7,ge=ke>>>3;return(Ne[ge]|(qe<=3?0:Ne[ge+1]<<8))>>>qe&31}function me(Ne,ke){var qe=ke&7,ge=ke>>>3;return(Ne[ge]|(qe<=1?0:Ne[ge+1]<<8))>>>qe&127}function we(Ne,ke,qe){var ge=ke&7,Me=ke>>>3,Ve=(1<<qe)-1,vt=Ne[Me]>>>ge;return qe<8-ge||(vt|=Ne[Me+1]<<8-ge,qe<16-ge)||(vt|=Ne[Me+2]<<16-ge,qe<24-ge)||(vt|=Ne[Me+3]<<24-ge),vt&Ve}function Ie(Ne,ke,qe){var ge=ke&7,Me=ke>>>3;return ge<=5?Ne[Me]|=(qe&7)<<ge:(Ne[Me]|=qe<<ge&255,Ne[Me+1]=(qe&7)>>8-ge),ke+3}function _e(Ne,ke,qe){var ge=ke&7,Me=ke>>>3;return qe=(qe&1)<<ge,Ne[Me]|=qe,ke+1}function Fe(Ne,ke,qe){var ge=ke&7,Me=ke>>>3;return qe<<=ge,Ne[Me]|=qe&255,qe>>>=8,Ne[Me+1]=qe,ke+8}function Le(Ne,ke,qe){var ge=ke&7,Me=ke>>>3;return qe<<=ge,Ne[Me]|=qe&255,qe>>>=8,Ne[Me+1]=qe&255,Ne[Me+2]=qe>>>8,ke+16}function rt(Ne,ke){var qe=Ne.length,ge=2*qe>ke?2*qe:ke+5,Me=0;if(qe>=ke)return Ne;if(ur){var Ve=J2(ge);if(Ne.copy)Ne.copy(Ve);else for(;Me<Ne.length;++Me)Ve[Me]=Ne[Me];return Ve}else if(te){var vt=new Uint8Array(ge);if(vt.set)vt.set(Ne);else for(;Me<qe;++Me)vt[Me]=Ne[Me];return vt}return Ne.length=ge,Ne}function He(Ne){for(var ke=new Array(Ne),qe=0;qe<Ne;++qe)ke[qe]=0;return ke}function st(Ne,ke,qe){var ge=1,Me=0,Ve=0,vt=0,St=0,xt=Ne.length,Ct=te?new Uint16Array(32):He(32);for(Ve=0;Ve<32;++Ve)Ct[Ve]=0;for(Ve=xt;Ve<qe;++Ve)Ne[Ve]=0;xt=Ne.length;var Tt=te?new Uint16Array(xt):He(xt);for(Ve=0;Ve<xt;++Ve)Ct[Me=Ne[Ve]]++,ge<Me&&(ge=Me),Tt[Ve]=0;for(Ct[0]=0,Ve=1;Ve<=ge;++Ve)Ct[Ve+16]=St=St+Ct[Ve-1]<<1;for(Ve=0;Ve<xt;++Ve)St=Ne[Ve],St!=0&&(Tt[Ve]=Ct[St+16]++);var bt=0;for(Ve=0;Ve<xt;++Ve)if(bt=Ne[Ve],bt!=0)for(St=ne(Tt[Ve],ge)>>ge-bt,vt=(1<<ge+4-bt)-1;vt>=0;--vt)ke[St|vt<<bt]=bt&15|Ve<<4;return ge}var De=te?new Uint16Array(512):He(512),Te=te?new Uint16Array(32):He(32);if(!te){for(var Ce=0;Ce<512;++Ce)De[Ce]=0;for(Ce=0;Ce<32;++Ce)Te[Ce]=0}(function(){for(var Ne=[],ke=0;ke<32;ke++)Ne.push(5);st(Ne,Te,32);var qe=[];for(ke=0;ke<=143;ke++)qe.push(8);for(;ke<=255;ke++)qe.push(9);for(;ke<=279;ke++)qe.push(7);for(;ke<=287;ke++)qe.push(8);st(qe,De,288)})();var Pe=(function(){for(var ke=te?new Uint8Array(32768):[],qe=0,ge=0;qe<K.length-1;++qe)for(;ge<K[qe+1];++ge)ke[ge]=qe;for(;ge<32768;++ge)ke[ge]=29;var Me=te?new Uint8Array(259):[];for(qe=0,ge=0;qe<O.length-1;++qe)for(;ge<O[qe+1];++ge)Me[ge]=qe;function Ve(St,xt){for(var Ct=0;Ct<St.length;){var Tt=Math.min(65535,St.length-Ct),bt=Ct+Tt==St.length;for(xt.write_shift(1,+bt),xt.write_shift(2,Tt),xt.write_shift(2,~Tt&65535);Tt-- >0;)xt[xt.l++]=St[Ct++]}return xt.l}function vt(St,xt){for(var Ct=0,Tt=0,bt=te?new Uint16Array(32768):[];Tt<St.length;){var Jt=Math.min(65535,St.length-Tt);if(Jt<10){for(Ct=Ie(xt,Ct,+(Tt+Jt==St.length)),Ct&7&&(Ct+=8-(Ct&7)),xt.l=Ct/8|0,xt.write_shift(2,Jt),xt.write_shift(2,~Jt&65535);Jt-- >0;)xt[xt.l++]=St[Tt++];Ct=xt.l*8;continue}Ct=Ie(xt,Ct,+(Tt+Jt==St.length)+2);for(var Gt=0;Jt-- >0;){var Ht=St[Tt];Gt=(Gt<<5^Ht)&32767;var es=-1,js=0;if((es=bt[Gt])&&(es|=Tt&-32768,es>Tt&&(es-=32768),es<Tt))for(;St[es+js]==St[Tt+js]&&js<250;)++js;if(js>2){Ht=Me[js],Ht<=22?Ct=Fe(xt,Ct,se[Ht+1]>>1)-1:(Fe(xt,Ct,3),Ct+=5,Fe(xt,Ct,se[Ht-23]>>5),Ct+=3);var Zs=Ht<8?0:Ht-4>>2;Zs>0&&(Le(xt,Ct,js-O[Ht]),Ct+=Zs),Ht=ke[Tt-es],Ct=Fe(xt,Ct,se[Ht]>>3),Ct-=3;var Xs=Ht<4?0:Ht-2>>1;Xs>0&&(Le(xt,Ct,Tt-es-K[Ht]),Ct+=Xs);for(var Hs=0;Hs<js;++Hs)bt[Gt]=Tt&32767,Gt=(Gt<<5^St[Tt])&32767,++Tt;Jt-=js-1}else Ht<=143?Ht=Ht+48:Ct=_e(xt,Ct,1),Ct=Fe(xt,Ct,se[Ht]),bt[Gt]=Tt&32767,++Tt}Ct=Fe(xt,Ct,0)-1}return xt.l=(Ct+7)/8|0,xt.l}return function(xt,Ct){return xt.length<8?Ve(xt,Ct):vt(xt,Ct)}})();function fe(Ne){var ke=Zt(50+Math.floor(Ne.length*1.1)),qe=Pe(Ne,ke);return ke.slice(0,qe)}var he=te?new Uint16Array(32768):He(32768),Ue=te?new Uint16Array(32768):He(32768),Ye=te?new Uint16Array(128):He(128),Ke=1,Je=1;function xe(Ne,ke){var qe=X(Ne,ke)+257;ke+=5;var ge=X(Ne,ke)+1;ke+=5;var Me=le(Ne,ke)+4;ke+=4;for(var Ve=0,vt=te?new Uint8Array(19):He(19),St=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],xt=1,Ct=te?new Uint8Array(8):He(8),Tt=te?new Uint8Array(8):He(8),bt=vt.length,Jt=0;Jt<Me;++Jt)vt[G[Jt]]=Ve=oe(Ne,ke),xt<Ve&&(xt=Ve),Ct[Ve]++,ke+=3;var Gt=0;for(Ct[0]=0,Jt=1;Jt<=xt;++Jt)Tt[Jt]=Gt=Gt+Ct[Jt-1]<<1;for(Jt=0;Jt<bt;++Jt)(Gt=vt[Jt])!=0&&(St[Jt]=Tt[Gt]++);var Ht=0;for(Jt=0;Jt<bt;++Jt)if(Ht=vt[Jt],Ht!=0){Gt=se[St[Jt]]>>8-Ht;for(var es=(1<<7-Ht)-1;es>=0;--es)Ye[Gt|es<<Ht]=Ht&7|Jt<<3}var js=[];for(xt=1;js.length<qe+ge;)switch(Gt=Ye[me(Ne,ke)],ke+=Gt&7,Gt>>>=3){case 16:for(Ve=3+ue(Ne,ke),ke+=2,Gt=js[js.length-1];Ve-- >0;)js.push(Gt);break;case 17:for(Ve=3+oe(Ne,ke),ke+=3;Ve-- >0;)js.push(0);break;case 18:for(Ve=11+me(Ne,ke),ke+=7;Ve-- >0;)js.push(0);break;default:js.push(Gt),xt<Gt&&(xt=Gt);break}var Zs=js.slice(0,qe),Xs=js.slice(qe);for(Jt=qe;Jt<286;++Jt)Zs[Jt]=0;for(Jt=ge;Jt<30;++Jt)Xs[Jt]=0;return Ke=st(Zs,he,286),Je=st(Xs,Ue,30),ke}function ye(Ne,ke){if(Ne[0]==3&&!(Ne[1]&3))return[Eu(ke),2];for(var qe=0,ge=0,Me=J2(ke||1<<18),Ve=0,vt=Me.length>>>0,St=0,xt=0;(ge&1)==0;){if(ge=oe(Ne,qe),qe+=3,ge>>>1)ge>>1==1?(St=9,xt=5):(qe=xe(Ne,qe),St=Ke,xt=Je);else{qe&7&&(qe+=8-(qe&7));var Ct=Ne[qe>>>3]|Ne[(qe>>>3)+1]<<8;if(qe+=32,Ct>0)for(!ke&&vt<Ve+Ct&&(Me=rt(Me,Ve+Ct),vt=Me.length);Ct-- >0;)Me[Ve++]=Ne[qe>>>3],qe+=8;continue}for(;;){!ke&&vt<Ve+32767&&(Me=rt(Me,Ve+32767),vt=Me.length);var Tt=we(Ne,qe,St),bt=ge>>>1==1?De[Tt]:he[Tt];if(qe+=bt&15,bt>>>=4,(bt>>>8&255)===0)Me[Ve++]=bt;else{if(bt==256)break;bt-=257;var Jt=bt<8?0:bt-4>>2;Jt>5&&(Jt=0);var Gt=Ve+O[bt];Jt>0&&(Gt+=we(Ne,qe,Jt),qe+=Jt),Tt=we(Ne,qe,xt),bt=ge>>>1==1?Te[Tt]:Ue[Tt],qe+=bt&15,bt>>>=4;var Ht=bt<4?0:bt-2>>1,es=K[bt];for(Ht>0&&(es+=we(Ne,qe,Ht),qe+=Ht),!ke&&vt<Gt&&(Me=rt(Me,Gt+100),vt=Me.length);Ve<Gt;)Me[Ve]=Me[Ve-es],++Ve}}}return ke?[Me,qe+7>>>3]:[Me.slice(0,Ve),qe+7>>>3]}function Ae(Ne,ke){var qe=Ne.slice(Ne.l||0),ge=ye(qe,ke);return Ne.l+=ge[1],ge[0]}function be(Ne,ke){if(Ne)typeof console<"u"&&console.error(ke);else throw new Error(ke)}function Ee(Ne,ke){var qe=Ne;Gn(qe,0);var ge=[],Me=[],Ve={FileIndex:ge,FullPaths:Me};w(Ve,{root:ke.root});for(var vt=qe.length-4;(qe[vt]!=80||qe[vt+1]!=75||qe[vt+2]!=5||qe[vt+3]!=6)&&vt>=0;)--vt;qe.l=vt+4,qe.l+=4;var St=qe.read_shift(2);qe.l+=6;var xt=qe.read_shift(4);for(qe.l=xt,vt=0;vt<St;++vt){qe.l+=20;var Ct=qe.read_shift(4),Tt=qe.read_shift(4),bt=qe.read_shift(2),Jt=qe.read_shift(2),Gt=qe.read_shift(2);qe.l+=8;var Ht=qe.read_shift(4),es=o(qe.slice(qe.l+bt,qe.l+bt+Jt));qe.l+=bt+Jt+Gt;var js=qe.l;qe.l=Ht+4,dt(qe,Ct,Tt,Ve,es),qe.l=js}return Ve}function dt(Ne,ke,qe,ge,Me){Ne.l+=2;var Ve=Ne.read_shift(2),vt=Ne.read_shift(2),St=l(Ne);if(Ve&8257)throw new Error("Unsupported ZIP encryption");for(var xt=Ne.read_shift(4),Ct=Ne.read_shift(4),Tt=Ne.read_shift(4),bt=Ne.read_shift(2),Jt=Ne.read_shift(2),Gt="",Ht=0;Ht<bt;++Ht)Gt+=String.fromCharCode(Ne[Ne.l++]);if(Jt){var es=o(Ne.slice(Ne.l,Ne.l+Jt));(es[21589]||{}).mt&&(St=es[21589].mt),((Me||{})[21589]||{}).mt&&(St=Me[21589].mt)}Ne.l+=Jt;var js=Ne.slice(Ne.l,Ne.l+Ct);switch(vt){case 8:js=k(Ne,Tt);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+vt)}var Zs=!1;Ve&8&&(xt=Ne.read_shift(4),xt==134695760&&(xt=Ne.read_shift(4),Zs=!0),Ct=Ne.read_shift(4),Tt=Ne.read_shift(4)),Ct!=ke&&be(Zs,"Bad compressed size: "+ke+" != "+Ct),Tt!=qe&&be(Zs,"Bad uncompressed size: "+qe+" != "+Tt),Ze(ge,Gt,js,{unsafe:!0,mt:St})}function mt(Ne,ke){var qe=ke||{},ge=[],Me=[],Ve=Zt(1),vt=qe.compression?8:0,St=0,xt=0,Ct=0,Tt=0,bt=0,Jt=Ne.FullPaths[0],Gt=Jt,Ht=Ne.FileIndex[0],es=[],js=0;for(xt=1;xt<Ne.FullPaths.length;++xt)if(Gt=Ne.FullPaths[xt].slice(Jt.length),Ht=Ne.FileIndex[xt],!(!Ht.size||!Ht.content||Gt=="Sh33tJ5")){var Zs=Tt,Xs=Zt(Gt.length);for(Ct=0;Ct<Gt.length;++Ct)Xs.write_shift(1,Gt.charCodeAt(Ct)&127);Xs=Xs.slice(0,Xs.l),es[bt]=h9.buf(Ht.content,0);var Hs=Ht.content;vt==8&&(Hs=B(Hs)),Ve=Zt(30),Ve.write_shift(4,67324752),Ve.write_shift(2,20),Ve.write_shift(2,St),Ve.write_shift(2,vt),Ht.mt?i(Ve,Ht.mt):Ve.write_shift(4,0),Ve.write_shift(-4,es[bt]),Ve.write_shift(4,Hs.length),Ve.write_shift(4,Ht.content.length),Ve.write_shift(2,Xs.length),Ve.write_shift(2,0),Tt+=Ve.length,ge.push(Ve),Tt+=Xs.length,ge.push(Xs),Tt+=Hs.length,ge.push(Hs),Ve=Zt(46),Ve.write_shift(4,33639248),Ve.write_shift(2,0),Ve.write_shift(2,20),Ve.write_shift(2,St),Ve.write_shift(2,vt),Ve.write_shift(4,0),Ve.write_shift(-4,es[bt]),Ve.write_shift(4,Hs.length),Ve.write_shift(4,Ht.content.length),Ve.write_shift(2,Xs.length),Ve.write_shift(2,0),Ve.write_shift(2,0),Ve.write_shift(2,0),Ve.write_shift(2,0),Ve.write_shift(4,0),Ve.write_shift(4,Zs),js+=Ve.l,Me.push(Ve),js+=Xs.length,Me.push(Xs),++bt}return Ve=Zt(22),Ve.write_shift(4,101010256),Ve.write_shift(2,0),Ve.write_shift(2,0),Ve.write_shift(2,bt),Ve.write_shift(2,bt),Ve.write_shift(4,js),Ve.write_shift(4,Tt),Ve.write_shift(2,0),Fn([Fn(ge),Fn(Me),Ve])}var it={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function ht(Ne,ke){if(Ne.ctype)return Ne.ctype;var qe=Ne.name||"",ge=qe.match(/\.([^\.]+)$/);return ge&&it[ge[1]]||ke&&(ge=(qe=ke).match(/[\.\\]([^\.\\])+$/),ge&&it[ge[1]])?it[ge[1]]:"application/octet-stream"}function ft(Ne){for(var ke=Ff(Ne),qe=[],ge=0;ge<ke.length;ge+=76)qe.push(ke.slice(ge,ge+76));return qe.join(`\r
`)+`\r
`}function Rt(Ne){var ke=Ne.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(Ct){var Tt=Ct.charCodeAt(0).toString(16).toUpperCase();return"="+(Tt.length==1?"0"+Tt:Tt)});ke=ke.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),ke.charAt(0)==`
`&&(ke="=0D"+ke.slice(1)),ke=ke.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var qe=[],ge=ke.split(`\r
`),Me=0;Me<ge.length;++Me){var Ve=ge[Me];if(Ve.length==0){qe.push("");continue}for(var vt=0;vt<Ve.length;){var St=76,xt=Ve.slice(vt,vt+St);xt.charAt(St-1)=="="?St--:xt.charAt(St-2)=="="?St-=2:xt.charAt(St-3)=="="&&(St-=3),xt=Ve.slice(vt,vt+St),vt+=St,vt<Ve.length&&(xt+="="),qe.push(xt)}}return qe.join(`\r
`)}function Ge(Ne){for(var ke=[],qe=0;qe<Ne.length;++qe){for(var ge=Ne[qe];qe<=Ne.length&&ge.charAt(ge.length-1)=="=";)ge=ge.slice(0,ge.length-1)+Ne[++qe];ke.push(ge)}for(var Me=0;Me<ke.length;++Me)ke[Me]=ke[Me].replace(/[=][0-9A-Fa-f]{2}/g,function(Ve){return String.fromCharCode(parseInt(Ve.slice(1),16))});return Sl(ke.join(`\r
`))}function at(Ne,ke,qe){for(var ge="",Me="",Ve="",vt,St=0;St<10;++St){var xt=ke[St];if(!xt||xt.match(/^\s*$/))break;var Ct=xt.match(/^(.*?):\s*([^\s].*)$/);if(Ct)switch(Ct[1].toLowerCase()){case"content-location":ge=Ct[2].trim();break;case"content-type":Ve=Ct[2].trim();break;case"content-transfer-encoding":Me=Ct[2].trim();break}}switch(++St,Me.toLowerCase()){case"base64":vt=Sl(Tl(ke.slice(St).join("")));break;case"quoted-printable":vt=Ge(ke.slice(St));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+Me)}var Tt=Ze(Ne,ge.slice(qe.length),vt,{unsafe:!0});Ve&&(Tt.ctype=Ve)}function je(Ne,ke){if(L(Ne.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var qe=ke&&ke.root||"",ge=(ur&&Buffer.isBuffer(Ne)?Ne.toString("binary"):L(Ne)).split(`\r
`),Me=0,Ve="";for(Me=0;Me<ge.length;++Me)if(Ve=ge[Me],!!/^Content-Location:/i.test(Ve)&&(Ve=Ve.slice(Ve.indexOf("file")),qe||(qe=Ve.slice(0,Ve.lastIndexOf("/")+1)),Ve.slice(0,qe.length)!=qe))for(;qe.length>0&&(qe=qe.slice(0,qe.length-1),qe=qe.slice(0,qe.lastIndexOf("/")+1),Ve.slice(0,qe.length)!=qe););var vt=(ge[1]||"").match(/boundary="(.*?)"/);if(!vt)throw new Error("MAD cannot find boundary");var St="--"+(vt[1]||""),xt=[],Ct=[],Tt={FileIndex:xt,FullPaths:Ct};w(Tt);var bt,Jt=0;for(Me=0;Me<ge.length;++Me){var Gt=ge[Me];Gt!==St&&Gt!==St+"--"||(Jt++&&at(Tt,ge.slice(bt,Me),qe),bt=Me)}return Tt}function Se(Ne,ke){var qe=ke||{},ge=qe.boundary||"SheetJS";ge="------="+ge;for(var Me=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+ge.slice(2)+'"',"","",""],Ve=Ne.FullPaths[0],vt=Ve,St=Ne.FileIndex[0],xt=1;xt<Ne.FullPaths.length;++xt)if(vt=Ne.FullPaths[xt].slice(Ve.length),St=Ne.FileIndex[xt],!(!St.size||!St.content||vt=="Sh33tJ5")){vt=vt.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(js){return"_x"+js.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(js){return"_u"+js.charCodeAt(0).toString(16)+"_"});for(var Ct=St.content,Tt=ur&&Buffer.isBuffer(Ct)?Ct.toString("binary"):L(Ct),bt=0,Jt=Math.min(1024,Tt.length),Gt=0,Ht=0;Ht<=Jt;++Ht)(Gt=Tt.charCodeAt(Ht))>=32&&Gt<128&&++bt;var es=bt>=Jt*4/5;Me.push(ge),Me.push("Content-Location: "+(qe.root||"file:///C:/SheetJS/")+vt),Me.push("Content-Transfer-Encoding: "+(es?"quoted-printable":"base64")),Me.push("Content-Type: "+ht(St,vt)),Me.push(""),Me.push(es?Rt(Tt):ft(Tt))}return Me.push(ge+`--\r
`),Me.join(`\r
`)}function nt(Ne){var ke={};return w(ke,Ne),ke}function Ze(Ne,ke,qe,ge){var Me=ge&&ge.unsafe;Me||w(Ne);var Ve=!Me&&Qs.find(Ne,ke);if(!Ve){var vt=Ne.FullPaths[0];ke.slice(0,vt.length)==vt?vt=ke:(vt.slice(-1)!="/"&&(vt+="/"),vt=(vt+ke).replace("//","/")),Ve={name:n(ke),type:2},Ne.FileIndex.push(Ve),Ne.FullPaths.push(vt),Me||Qs.utils.cfb_gc(Ne)}return Ve.content=qe,Ve.size=qe?qe.length:0,ge&&(ge.CLSID&&(Ve.clsid=ge.CLSID),ge.mt&&(Ve.mt=ge.mt),ge.ct&&(Ve.ct=ge.ct)),Ve}function gt(Ne,ke){w(Ne);var qe=Qs.find(Ne,ke);if(qe){for(var ge=0;ge<Ne.FileIndex.length;++ge)if(Ne.FileIndex[ge]==qe)return Ne.FileIndex.splice(ge,1),Ne.FullPaths.splice(ge,1),!0}return!1}function jt(Ne,ke,qe){w(Ne);var ge=Qs.find(Ne,ke);if(ge){for(var Me=0;Me<Ne.FileIndex.length;++Me)if(Ne.FileIndex[Me]==ge)return Ne.FileIndex[Me].name=n(qe),Ne.FullPaths[Me]=qe,!0}return!1}function Mt(Ne){W(Ne,!0)}return s.find=U,s.read=I,s.parse=c,s.write=V,s.writeFile=Q,s.utils={cfb_new:nt,cfb_add:Ze,cfb_del:gt,cfb_mov:jt,cfb_gc:Mt,ReadShift:df,CheckField:TE,prep_blob:Gn,bconcat:Fn,use_zlib:C,_deflateRaw:fe,_inflateRaw:Ae,consts:z},s})();function A9(t){return typeof t=="string"?Eg(t):Array.isArray(t)?MH(t):t}function rp(t,s,r){if(typeof Deno<"u"){if(r&&typeof s=="string")switch(r){case"utf8":s=new TextEncoder(r).encode(s);break;case"binary":s=Eg(s);break;default:throw new Error("Unsupported encoding "+r)}return Deno.writeFileSync(t,s)}var a=r=="utf8"?Nc(s):s;if(typeof IE_SaveFile<"u")return IE_SaveFile(a,t);if(typeof Blob<"u"){var n=new Blob([A9(a)],{type:"application/octet-stream"});if(typeof navigator<"u"&&navigator.msSaveBlob)return navigator.msSaveBlob(n,t);if(typeof saveAs<"u")return saveAs(n,t);if(typeof URL<"u"&&typeof document<"u"&&document.createElement&&URL.createObjectURL){var i=URL.createObjectURL(n);if(typeof chrome=="object"&&typeof(chrome.downloads||{}).download=="function")return URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(i)},6e4),chrome.downloads.download({url:i,filename:t,saveAs:!0});var l=document.createElement("a");if(l.download!=null)return l.download=t,l.href=i,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(i)},6e4),i}}if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var o=File(t);return o.open("w"),o.encoding="binary",Array.isArray(s)&&(s=Iu(s)),o.write(s),o.close(),s}catch(d){if(!d.message||!d.message.match(/onstruct/))throw d}throw new Error("cannot save file "+t)}function f9(t){if(typeof Deno<"u")return Deno.readFileSync(t);if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var s=File(t);s.open("r"),s.encoding="binary";var r=s.read();return s.close(),r}catch(a){if(!a.message||!a.message.match(/onstruct/))throw a}throw new Error("Cannot access file "+t)}function Da(t){for(var s=Object.keys(t),r=[],a=0;a<s.length;++a)Object.prototype.hasOwnProperty.call(t,s[a])&&r.push(s[a]);return r}function iS(t,s){for(var r=[],a=Da(t),n=0;n!==a.length;++n)r[t[a[n]][s]]==null&&(r[t[a[n]][s]]=a[n]);return r}function Fg(t){for(var s=[],r=Da(t),a=0;a!==r.length;++a)s[t[r[a]]]=r[a];return s}function Tg(t){for(var s=[],r=Da(t),a=0;a!==r.length;++a)s[t[r[a]]]=parseInt(r[a],10);return s}function p9(t){for(var s=[],r=Da(t),a=0;a!==r.length;++a)s[t[r[a]]]==null&&(s[t[r[a]]]=[]),s[t[r[a]]].push(r[a]);return s}var O0=new Date(1899,11,30,0,0,0);function pn(t,s){var r=t.getTime(),a=O0.getTime()+(t.getTimezoneOffset()-O0.getTimezoneOffset())*6e4;return(r-a)/(1440*60*1e3)}var uE=new Date,x9=O0.getTime()+(uE.getTimezoneOffset()-O0.getTimezoneOffset())*6e4,lS=uE.getTimezoneOffset();function Ig(t){var s=new Date;return s.setTime(t*24*60*60*1e3+x9),s.getTimezoneOffset()!==lS&&s.setTime(s.getTime()+(s.getTimezoneOffset()-lS)*6e4),s}function g9(t){var s=0,r=0,a=!1,n=t.match(/P([0-9\.]+Y)?([0-9\.]+M)?([0-9\.]+D)?T([0-9\.]+H)?([0-9\.]+M)?([0-9\.]+S)?/);if(!n)throw new Error("|"+t+"| is not an ISO8601 Duration");for(var i=1;i!=n.length;++i)if(n[i]){switch(r=1,i>3&&(a=!0),n[i].slice(n[i].length-1)){case"Y":throw new Error("Unsupported ISO Duration Field: "+n[i].slice(n[i].length-1));case"D":r*=24;case"H":r*=60;case"M":if(a)r*=60;else throw new Error("Unsupported ISO Duration Field: M")}s+=r*parseInt(n[i],10)}return s}var oS=new Date("2017-02-19T19:06:09.000Z"),mE=isNaN(oS.getFullYear())?new Date("2/19/17"):oS,v9=mE.getFullYear()==2017;function ma(t,s){var r=new Date(t);if(v9)return s>0?r.setTime(r.getTime()+r.getTimezoneOffset()*60*1e3):s<0&&r.setTime(r.getTime()-r.getTimezoneOffset()*60*1e3),r;if(t instanceof Date)return t;if(mE.getFullYear()==1917&&!isNaN(r.getFullYear())){var a=r.getFullYear();return t.indexOf(""+a)>-1||r.setFullYear(r.getFullYear()+100),r}var n=t.match(/\d+/g)||["2017","2","19","0","0","0"],i=new Date(+n[0],+n[1]-1,+n[2],+n[3]||0,+n[4]||0,+n[5]||0);return t.indexOf("Z")>-1&&(i=new Date(i.getTime()-i.getTimezoneOffset()*60*1e3)),i}function Em(t,s){if(ur&&Buffer.isBuffer(t)){if(s){if(t[0]==255&&t[1]==254)return Nc(t.slice(2).toString("utf16le"));if(t[1]==254&&t[2]==255)return Nc(Z4(t.slice(2).toString("binary")))}return t.toString("binary")}if(typeof TextDecoder<"u")try{if(s){if(t[0]==255&&t[1]==254)return Nc(new TextDecoder("utf-16le").decode(t.slice(2)));if(t[0]==254&&t[1]==255)return Nc(new TextDecoder("utf-16be").decode(t.slice(2)))}var r={"":"","":"",:"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"","":"","":"","":"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"",:""};return Array.isArray(t)&&(t=new Uint8Array(t)),new TextDecoder("latin1").decode(t).replace(/[]/g,function(i){return r[i]||i})}catch{}for(var a=[],n=0;n!=t.length;++n)a.push(String.fromCharCode(t[n]));return a.join("")}function ha(t){if(typeof JSON<"u"&&!Array.isArray(t))return JSON.parse(JSON.stringify(t));if(typeof t!="object"||t==null)return t;if(t instanceof Date)return new Date(t.getTime());var s={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=ha(t[r]));return s}function Ia(t,s){for(var r="";r.length<s;)r+=t;return r}function Vo(t){var s=Number(t);if(!isNaN(s))return isFinite(s)?s:NaN;if(!/\d/.test(t))return s;var r=1,a=t.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return r*=100,""});return!isNaN(s=Number(a))||(a=a.replace(/[(](.*)[)]/,function(n,i){return r=-r,i}),!isNaN(s=Number(a)))?s/r:s}var b9=["january","february","march","april","may","june","july","august","september","october","november","december"];function Gh(t){var s=new Date(t),r=new Date(NaN),a=s.getYear(),n=s.getMonth(),i=s.getDate();if(isNaN(i))return r;var l=t.toLowerCase();if(l.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(l=l.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),l.length>3&&b9.indexOf(l)==-1)return r}else if(l.match(/[a-z]/))return r;return a<0||a>8099?r:(n>0||i>1)&&a!=101?s:t.match(/[^-0-9:,\/\\]/)?r:s}var y9=(function(){var t="abacaba".split(/(:?b)/i).length==5;return function(r,a,n){if(t||typeof a=="string")return r.split(a);for(var i=r.split(a),l=[i[0]],o=1;o<i.length;++o)l.push(n),l.push(i[o]);return l}})();function hE(t){return t?t.content&&t.type?Em(t.content,!0):t.data?YA(t.data):t.asNodeBuffer&&ur?YA(t.asNodeBuffer().toString("binary")):t.asBinary?YA(t.asBinary()):t._data&&t._data.getContent?YA(Em(Array.prototype.slice.call(t._data.getContent(),0))):null:null}function AE(t){if(!t)return null;if(t.data)return Y2(t.data);if(t.asNodeBuffer&&ur)return t.asNodeBuffer();if(t._data&&t._data.getContent){var s=t._data.getContent();return typeof s=="string"?Y2(s):Array.prototype.slice.call(s)}return t.content&&t.type?t.content:null}function j9(t){return t&&t.name.slice(-4)===".bin"?AE(t):hE(t)}function Zl(t,s){for(var r=t.FullPaths||Da(t.files),a=s.toLowerCase().replace(/[\/]/g,"\\"),n=a.replace(/\\/g,"/"),i=0;i<r.length;++i){var l=r[i].replace(/^Root Entry[\/]/,"").toLowerCase();if(a==l||n==l)return t.files?t.files[r[i]]:t.FileIndex[i]}return null}function uN(t,s){var r=Zl(t,s);if(r==null)throw new Error("Cannot find file "+s+" in zip");return r}function an(t,s,r){if(!r)return j9(uN(t,s));if(!s)return null;try{return an(t,s)}catch{return null}}function Cl(t,s,r){if(!r)return hE(uN(t,s));if(!s)return null;try{return Cl(t,s)}catch{return null}}function N9(t,s,r){return AE(uN(t,s))}function cS(t){for(var s=t.FullPaths||Da(t.files),r=[],a=0;a<s.length;++a)s[a].slice(-1)!="/"&&r.push(s[a].replace(/^Root Entry[\/]/,""));return r.sort()}function cr(t,s,r){if(t.FullPaths){if(typeof r=="string"){var a;return ur?a=Nd(r):a=QH(r),Qs.utils.cfb_add(t,s,a)}Qs.utils.cfb_add(t,s,r)}else t.file(s,r)}function mN(){return Qs.utils.cfb_new()}function fE(t,s){switch(s.type){case"base64":return Qs.read(t,{type:"base64"});case"binary":return Qs.read(t,{type:"binary"});case"buffer":case"array":return Qs.read(t,{type:"buffer"})}throw new Error("Unrecognized type "+s.type)}function JA(t,s){if(t.charAt(0)=="/")return t.slice(1);var r=s.split("/");s.slice(-1)!="/"&&r.pop();for(var a=t.split("/");a.length!==0;){var n=a.shift();n===".."?r.pop():n!=="."&&r.push(n)}return r.join("/")}var Xa=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,w9=/([^"\s?>\/]+)\s*=\s*((?:")([^"]*)(?:")|(?:')([^']*)(?:')|([^'">\s]+))/g,dS=/<[\/\?]?[a-zA-Z0-9:_-]+(?:\s+[^"\s?>\/]+\s*=\s*(?:"[^"]*"|'[^']*'|[^'">\s=]+))*\s*[\/\?]?>/mg,_9=/<[^>]*>/g,Si=Xa.match(dS)?dS:_9,S9=/<\w*:/,C9=/<(\/?)\w+:/;function Ys(t,s,r){for(var a={},n=0,i=0;n!==t.length&&!((i=t.charCodeAt(n))===32||i===10||i===13);++n);if(s||(a[0]=t.slice(0,n)),n===t.length)return a;var l=t.match(w9),o=0,d="",u=0,c="",h="",m=1;if(l)for(u=0;u!=l.length;++u){for(h=l[u],i=0;i!=h.length&&h.charCodeAt(i)!==61;++i);for(c=h.slice(0,i).trim();h.charCodeAt(i+1)==32;)++i;for(m=(n=h.charCodeAt(i+1))==34||n==39?1:0,d=h.slice(i+1+m,h.length-m),o=0;o!=c.length&&c.charCodeAt(o)!==58;++o);if(o===c.length)c.indexOf("_")>0&&(c=c.slice(0,c.indexOf("_"))),a[c]=d,a[c.toLowerCase()]=d;else{var p=(o===5&&c.slice(0,5)==="xmlns"?"xmlns":"")+c.slice(o+1);if(a[p]&&c.slice(o-3,o)=="ext")continue;a[p]=d,a[p.toLowerCase()]=d}}return a}function Lc(t){return t.replace(C9,"<$1")}var pE={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},hN=Fg(pE),Sr=(function(){var t=/&(?:quot|apos|gt|lt|amp|#x?([\da-fA-F]+));/ig,s=/_x([\da-fA-F]{4})_/ig;return function r(a){var n=a+"",i=n.indexOf("<![CDATA[");if(i==-1)return n.replace(t,function(o,d){return pE[o]||String.fromCharCode(parseInt(d,o.indexOf("x")>-1?16:10))||o}).replace(s,function(o,d){return String.fromCharCode(parseInt(d,16))});var l=n.indexOf("]]>");return r(n.slice(0,i))+n.slice(i+9,l)+r(n.slice(l+3))}})(),AN=/[&<>'"]/g,k9=/[\u0000-\u0008\u000b-\u001f]/g;function Gr(t){var s=t+"";return s.replace(AN,function(r){return hN[r]}).replace(k9,function(r){return"_x"+("000"+r.charCodeAt(0).toString(16)).slice(-4)+"_"})}function uS(t){return Gr(t).replace(/ /g,"_x0020_")}var xE=/[\u0000-\u001f]/g;function fN(t){var s=t+"";return s.replace(AN,function(r){return hN[r]}).replace(/\n/g,"<br/>").replace(xE,function(r){return"&#x"+("000"+r.charCodeAt(0).toString(16)).slice(-4)+";"})}function E9(t){var s=t+"";return s.replace(AN,function(r){return hN[r]}).replace(xE,function(r){return"&#x"+r.charCodeAt(0).toString(16).toUpperCase()+";"})}var mS=(function(){var t=/&#(\d+);/g;function s(r,a){return String.fromCharCode(parseInt(a,10))}return function(a){return a.replace(t,s)}})();function B9(t){return t.replace(/(\r\n|[\r\n])/g,"&#10;")}function da(t){switch(t){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function Tb(t){for(var s="",r=0,a=0,n=0,i=0,l=0,o=0;r<t.length;){if(a=t.charCodeAt(r++),a<128){s+=String.fromCharCode(a);continue}if(n=t.charCodeAt(r++),a>191&&a<224){l=(a&31)<<6,l|=n&63,s+=String.fromCharCode(l);continue}if(i=t.charCodeAt(r++),a<240){s+=String.fromCharCode((a&15)<<12|(n&63)<<6|i&63);continue}l=t.charCodeAt(r++),o=((a&7)<<18|(n&63)<<12|(i&63)<<6|l&63)-65536,s+=String.fromCharCode(55296+(o>>>10&1023)),s+=String.fromCharCode(56320+(o&1023))}return s}function hS(t){var s=Eu(2*t.length),r,a,n=1,i=0,l=0,o;for(a=0;a<t.length;a+=n)n=1,(o=t.charCodeAt(a))<128?r=o:o<224?(r=(o&31)*64+(t.charCodeAt(a+1)&63),n=2):o<240?(r=(o&15)*4096+(t.charCodeAt(a+1)&63)*64+(t.charCodeAt(a+2)&63),n=3):(n=4,r=(o&7)*262144+(t.charCodeAt(a+1)&63)*4096+(t.charCodeAt(a+2)&63)*64+(t.charCodeAt(a+3)&63),r-=65536,l=55296+(r>>>10&1023),r=56320+(r&1023)),l!==0&&(s[i++]=l&255,s[i++]=l>>>8,l=0),s[i++]=r%256,s[i++]=r>>>8;return s.slice(0,i).toString("ucs2")}function AS(t){return Nd(t,"binary").toString("utf8")}var Ex="foo bar baz",Xr=ur&&(AS(Ex)==Tb(Ex)&&AS||hS(Ex)==Tb(Ex)&&hS)||Tb,Nc=ur?function(t){return Nd(t,"utf8").toString("binary")}:function(t){for(var s=[],r=0,a=0,n=0;r<t.length;)switch(a=t.charCodeAt(r++),!0){case a<128:s.push(String.fromCharCode(a));break;case a<2048:s.push(String.fromCharCode(192+(a>>6))),s.push(String.fromCharCode(128+(a&63)));break;case(a>=55296&&a<57344):a-=55296,n=t.charCodeAt(r++)-56320+(a<<10),s.push(String.fromCharCode(240+(n>>18&7))),s.push(String.fromCharCode(144+(n>>12&63))),s.push(String.fromCharCode(128+(n>>6&63))),s.push(String.fromCharCode(128+(n&63)));break;default:s.push(String.fromCharCode(224+(a>>12))),s.push(String.fromCharCode(128+(a>>6&63))),s.push(String.fromCharCode(128+(a&63)))}return s.join("")},If=(function(){var t={};return function(r,a){var n=r+"|"+(a||"");return t[n]?t[n]:t[n]=new RegExp("<(?:\\w+:)?"+r+'(?: xml:space="preserve")?(?:[^>]*)>([\\s\\S]*?)</(?:\\w+:)?'+r+">",a||"")}})(),gE=(function(){var t=[["nbsp"," "],["middot",""],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(s){return[new RegExp("&"+s[0]+";","ig"),s[1]]});return function(r){for(var a=r.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),n=0;n<t.length;++n)a=a.replace(t[n][0],t[n][1]);return a}})(),F9=(function(){var t={};return function(r){return t[r]!==void 0?t[r]:t[r]=new RegExp("<(?:vt:)?"+r+">([\\s\\S]*?)</(?:vt:)?"+r+">","g")}})(),T9=/<\/?(?:vt:)?variant>/g,I9=/<(?:vt:)([^>]*)>([\s\S]*)</;function fS(t,s){var r=Ys(t),a=t.match(F9(r.baseType))||[],n=[];if(a.length!=r.size){if(s.WTF)throw new Error("unexpected vector length "+a.length+" != "+r.size);return n}return a.forEach(function(i){var l=i.replace(T9,"").match(I9);l&&n.push({v:Xr(l[2]),t:l[1]})}),n}var vE=/(^\s|\s$|\n)/;function Kn(t,s){return"<"+t+(s.match(vE)?' xml:space="preserve"':"")+">"+s+"</"+t+">"}function Lf(t){return Da(t).map(function(s){return" "+s+'="'+t[s]+'"'}).join("")}function gs(t,s,r){return"<"+t+(r!=null?Lf(r):"")+(s!=null?(s.match(vE)?' xml:space="preserve"':"")+">"+s+"</"+t:"/")+">"}function dj(t,s){try{return t.toISOString().replace(/\.\d*/,"")}catch(r){if(s)throw r}return""}function L9(t,s){switch(typeof t){case"string":var r=gs("vt:lpwstr",Gr(t));return r=r.replace(/&quot;/g,"_x0022_"),r;case"number":return gs((t|0)==t?"vt:i4":"vt:r8",Gr(String(t)));case"boolean":return gs("vt:bool",t?"true":"false")}if(t instanceof Date)return gs("vt:filetime",dj(t));throw new Error("Unable to serialize "+t)}function pN(t){if(ur&&Buffer.isBuffer(t))return t.toString("utf8");if(typeof t=="string")return t;if(typeof Uint8Array<"u"&&t instanceof Uint8Array)return Xr(Iu(oN(t)));throw new Error("Bad input format: expected Buffer or string")}var Df=/<(\/?)([^\s?><!\/:]*:|)([^\s?<>:\/]+)(?:[\s?:\/][^>]*)?>/mg,fn={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},Dm=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],wl={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"};function D9(t,s){for(var r=1-2*(t[s+7]>>>7),a=((t[s+7]&127)<<4)+(t[s+6]>>>4&15),n=t[s+6]&15,i=5;i>=0;--i)n=n*256+t[s+i];return a==2047?n==0?r*(1/0):NaN:(a==0?a=-1022:(a-=1023,n+=Math.pow(2,52)),r*Math.pow(2,a-52)*n)}function P9(t,s,r){var a=(s<0||1/s==-1/0?1:0)<<7,n=0,i=0,l=a?-s:s;isFinite(l)?l==0?n=i=0:(n=Math.floor(Math.log(l)/Math.LN2),i=l*Math.pow(2,52-n),n<=-1023&&(!isFinite(i)||i<Math.pow(2,52))?n=-1022:(i-=Math.pow(2,52),n+=1023)):(n=2047,i=isNaN(s)?26985:0);for(var o=0;o<=5;++o,i/=256)t[r+o]=i&255;t[r+6]=(n&15)<<4|i&15,t[r+7]=n>>4|a}var pS=function(t){for(var s=[],r=10240,a=0;a<t[0].length;++a)if(t[0][a])for(var n=0,i=t[0][a].length;n<i;n+=r)s.push.apply(s,t[0][a].slice(n,n+r));return s},xS=ur?function(t){return t[0].length>0&&Buffer.isBuffer(t[0][0])?Buffer.concat(t[0].map(function(s){return Buffer.isBuffer(s)?s:Nd(s)})):pS(t)}:pS,gS=function(t,s,r){for(var a=[],n=s;n<r;n+=2)a.push(String.fromCharCode(cd(t,n)));return a.join("").replace(Hi,"")},xN=ur?function(t,s,r){return Buffer.isBuffer(t)?t.toString("utf16le",s,r).replace(Hi,""):gS(t,s,r)}:gS,vS=function(t,s,r){for(var a=[],n=s;n<s+r;++n)a.push(("0"+t[n].toString(16)).slice(-2));return a.join("")},bE=ur?function(t,s,r){return Buffer.isBuffer(t)?t.toString("hex",s,s+r):vS(t,s,r)}:vS,bS=function(t,s,r){for(var a=[],n=s;n<r;n++)a.push(String.fromCharCode(Ch(t,n)));return a.join("")},ap=ur?function(s,r,a){return Buffer.isBuffer(s)?s.toString("utf8",r,a):bS(s,r,a)}:bS,yE=function(t,s){var r=_l(t,s);return r>0?ap(t,s+4,s+4+r-1):""},jE=yE,NE=function(t,s){var r=_l(t,s);return r>0?ap(t,s+4,s+4+r-1):""},wE=NE,_E=function(t,s){var r=2*_l(t,s);return r>0?ap(t,s+4,s+4+r-1):""},SE=_E,CE=function(s,r){var a=_l(s,r);return a>0?xN(s,r+4,r+4+a):""},kE=CE,EE=function(t,s){var r=_l(t,s);return r>0?ap(t,s+4,s+4+r):""},BE=EE,FE=function(t,s){return D9(t,s)},M0=FE,gN=function(s){return Array.isArray(s)||typeof Uint8Array<"u"&&s instanceof Uint8Array};ur&&(jE=function(s,r){if(!Buffer.isBuffer(s))return yE(s,r);var a=s.readUInt32LE(r);return a>0?s.toString("utf8",r+4,r+4+a-1):""},wE=function(s,r){if(!Buffer.isBuffer(s))return NE(s,r);var a=s.readUInt32LE(r);return a>0?s.toString("utf8",r+4,r+4+a-1):""},SE=function(s,r){if(!Buffer.isBuffer(s))return _E(s,r);var a=2*s.readUInt32LE(r);return s.toString("utf16le",r+4,r+4+a-1)},kE=function(s,r){if(!Buffer.isBuffer(s))return CE(s,r);var a=s.readUInt32LE(r);return s.toString("utf16le",r+4,r+4+a)},BE=function(s,r){if(!Buffer.isBuffer(s))return EE(s,r);var a=s.readUInt32LE(r);return s.toString("utf8",r+4,r+4+a)},M0=function(s,r){return Buffer.isBuffer(s)?s.readDoubleLE(r):FE(s,r)},gN=function(s){return Buffer.isBuffer(s)||Array.isArray(s)||typeof Uint8Array<"u"&&s instanceof Uint8Array});var Ch=function(t,s){return t[s]},cd=function(t,s){return t[s+1]*256+t[s]},U9=function(t,s){var r=t[s+1]*256+t[s];return r<32768?r:(65535-r+1)*-1},_l=function(t,s){return t[s+3]*(1<<24)+(t[s+2]<<16)+(t[s+1]<<8)+t[s]},mm=function(t,s){return t[s+3]<<24|t[s+2]<<16|t[s+1]<<8|t[s]},R9=function(t,s){return t[s]<<24|t[s+1]<<16|t[s+2]<<8|t[s+3]};function df(t,s){var r="",a,n,i=[],l,o,d,u;switch(s){case"dbcs":if(u=this.l,ur&&Buffer.isBuffer(this))r=this.slice(this.l,this.l+2*t).toString("utf16le");else for(d=0;d<t;++d)r+=String.fromCharCode(cd(this,u)),u+=2;t*=2;break;case"utf8":r=ap(this,this.l,this.l+t);break;case"utf16le":t*=2,r=xN(this,this.l,this.l+t);break;case"wstr":return df.call(this,t,"dbcs");case"lpstr-ansi":r=jE(this,this.l),t=4+_l(this,this.l);break;case"lpstr-cp":r=wE(this,this.l),t=4+_l(this,this.l);break;case"lpwstr":r=SE(this,this.l),t=4+2*_l(this,this.l);break;case"lpp4":t=4+_l(this,this.l),r=kE(this,this.l),t&2&&(t+=2);break;case"8lpp4":t=4+_l(this,this.l),r=BE(this,this.l),t&3&&(t+=4-(t&3));break;case"cstr":for(t=0,r="";(l=Ch(this,this.l+t++))!==0;)i.push(kx(l));r=i.join("");break;case"_wstr":for(t=0,r="";(l=cd(this,this.l+t))!==0;)i.push(kx(l)),t+=2;t+=2,r=i.join("");break;case"dbcs-cont":for(r="",u=this.l,d=0;d<t;++d){if(this.lens&&this.lens.indexOf(u)!==-1)return l=Ch(this,u),this.l=u+1,o=df.call(this,t-d,l?"dbcs-cont":"sbcs-cont"),i.join("")+o;i.push(kx(cd(this,u))),u+=2}r=i.join(""),t*=2;break;case"cpstr":case"sbcs-cont":for(r="",u=this.l,d=0;d!=t;++d){if(this.lens&&this.lens.indexOf(u)!==-1)return l=Ch(this,u),this.l=u+1,o=df.call(this,t-d,l?"dbcs-cont":"sbcs-cont"),i.join("")+o;i.push(kx(Ch(this,u))),u+=1}r=i.join("");break;default:switch(t){case 1:return a=Ch(this,this.l),this.l++,a;case 2:return a=(s==="i"?U9:cd)(this,this.l),this.l+=2,a;case 4:case-4:return s==="i"||(this[this.l+3]&128)===0?(a=(t>0?mm:R9)(this,this.l),this.l+=4,a):(n=_l(this,this.l),this.l+=4,n);case 8:case-8:if(s==="f")return t==8?n=M0(this,this.l):n=M0([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,n;t=8;case 16:r=bE(this,this.l,t);break}}return this.l+=t,r}var O9=function(t,s,r){t[r]=s&255,t[r+1]=s>>>8&255,t[r+2]=s>>>16&255,t[r+3]=s>>>24&255},M9=function(t,s,r){t[r]=s&255,t[r+1]=s>>8&255,t[r+2]=s>>16&255,t[r+3]=s>>24&255},Q9=function(t,s,r){t[r]=s&255,t[r+1]=s>>>8&255};function H9(t,s,r){var a=0,n=0;if(r==="dbcs"){for(n=0;n!=s.length;++n)Q9(this,s.charCodeAt(n),this.l+2*n);a=2*s.length}else if(r==="sbcs"){for(s=s.replace(/[^\x00-\x7F]/g,"_"),n=0;n!=s.length;++n)this[this.l+n]=s.charCodeAt(n)&255;a=s.length}else if(r==="hex"){for(;n<t;++n)this[this.l++]=parseInt(s.slice(2*n,2*n+2),16)||0;return this}else if(r==="utf16le"){var i=Math.min(this.l+t,this.length);for(n=0;n<Math.min(s.length,t);++n){var l=s.charCodeAt(n);this[this.l++]=l&255,this[this.l++]=l>>8}for(;this.l<i;)this[this.l++]=0;return this}else switch(t){case 1:a=1,this[this.l]=s&255;break;case 2:a=2,this[this.l]=s&255,s>>>=8,this[this.l+1]=s&255;break;case 3:a=3,this[this.l]=s&255,s>>>=8,this[this.l+1]=s&255,s>>>=8,this[this.l+2]=s&255;break;case 4:a=4,O9(this,s,this.l);break;case 8:if(a=8,r==="f"){P9(this,s,this.l);break}case 16:break;case-4:a=4,M9(this,s,this.l);break}return this.l+=a,this}function TE(t,s){var r=bE(this,this.l,t.length>>1);if(r!==t)throw new Error(s+"Expected "+t+" saw "+r);this.l+=t.length>>1}function Gn(t,s){t.l=s,t.read_shift=df,t.chk=TE,t.write_shift=H9}function _i(t,s){t.l+=s}function Zt(t){var s=Eu(t);return Gn(s,0),s}function wd(t,s,r){if(t){var a,n,i;Gn(t,t.l||0);for(var l=t.length,o=0,d=0;t.l<l;){o=t.read_shift(1),o&128&&(o=(o&127)+((t.read_shift(1)&127)<<7));var u=Qf[o]||Qf[65535];for(a=t.read_shift(1),i=a&127,n=1;n<4&&a&128;++n)i+=((a=t.read_shift(1))&127)<<7*n;d=t.l+i;var c=u.f&&u.f(t,i,r);if(t.l=d,s(c,u,o))return}}}function ul(){var t=[],s=ur?256:2048,r=function(u){var c=Zt(u);return Gn(c,0),c},a=r(s),n=function(){a&&(a.length>a.l&&(a=a.slice(0,a.l),a.l=a.length),a.length>0&&t.push(a),a=null)},i=function(u){return a&&u<a.length-a.l?a:(n(),a=r(Math.max(u+1,s)))},l=function(){return n(),Fn(t)},o=function(u){n(),a=u,a.l==null&&(a.l=a.length),i(s)};return{next:i,push:o,end:l,_bufs:t}}function ls(t,s,r,a){var n=+s,i;if(!isNaN(n)){a||(a=Qf[n].p||(r||[]).length||0),i=1+(n>=128?1:0)+1,a>=128&&++i,a>=16384&&++i,a>=2097152&&++i;var l=t.next(i);n<=127?l.write_shift(1,n):(l.write_shift(1,(n&127)+128),l.write_shift(1,n>>7));for(var o=0;o!=4;++o)if(a>=128)l.write_shift(1,(a&127)+128),a>>=7;else{l.write_shift(1,a);break}a>0&&gN(r)&&t.push(r)}}function uf(t,s,r){var a=ha(t);if(s.s?(a.cRel&&(a.c+=s.s.c),a.rRel&&(a.r+=s.s.r)):(a.cRel&&(a.c+=s.c),a.rRel&&(a.r+=s.r)),!r||r.biff<12){for(;a.c>=256;)a.c-=256;for(;a.r>=65536;)a.r-=65536}return a}function yS(t,s,r){var a=ha(t);return a.s=uf(a.s,s.s,r),a.e=uf(a.e,s.s,r),a}function mf(t,s){if(t.cRel&&t.c<0)for(t=ha(t);t.c<0;)t.c+=s>8?16384:256;if(t.rRel&&t.r<0)for(t=ha(t);t.r<0;)t.r+=s>8?1048576:s>5?65536:16384;var r=Ks(t);return!t.cRel&&t.cRel!=null&&(r=V9(r)),!t.rRel&&t.rRel!=null&&(r=q9(r)),r}function Ib(t,s){return t.s.r==0&&!t.s.rRel&&t.e.r==(s.biff>=12?1048575:s.biff>=8?65536:16384)&&!t.e.rRel?(t.s.cRel?"":"$")+Na(t.s.c)+":"+(t.e.cRel?"":"$")+Na(t.e.c):t.s.c==0&&!t.s.cRel&&t.e.c==(s.biff>=12?16383:255)&&!t.e.cRel?(t.s.rRel?"":"$")+za(t.s.r)+":"+(t.e.rRel?"":"$")+za(t.e.r):mf(t.s,s.biff)+":"+mf(t.e,s.biff)}function vN(t){return parseInt($9(t),10)-1}function za(t){return""+(t+1)}function q9(t){return t.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function $9(t){return t.replace(/\$(\d+)$/,"$1")}function bN(t){for(var s=W9(t),r=0,a=0;a!==s.length;++a)r=26*r+s.charCodeAt(a)-64;return r-1}function Na(t){if(t<0)throw new Error("invalid column "+t);var s="";for(++t;t;t=Math.floor((t-1)/26))s=String.fromCharCode((t-1)%26+65)+s;return s}function V9(t){return t.replace(/^([A-Z])/,"$$$1")}function W9(t){return t.replace(/^\$([A-Z])/,"$1")}function G9(t){return t.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function wa(t){for(var s=0,r=0,a=0;a<t.length;++a){var n=t.charCodeAt(a);n>=48&&n<=57?s=10*s+(n-48):n>=65&&n<=90&&(r=26*r+(n-64))}return{c:r-1,r:s-1}}function Ks(t){for(var s=t.c+1,r="";s;s=(s-1)/26|0)r=String.fromCharCode((s-1)%26+65)+r;return r+(t.r+1)}function ml(t){var s=t.indexOf(":");return s==-1?{s:wa(t),e:wa(t)}:{s:wa(t.slice(0,s)),e:wa(t.slice(s+1))}}function lr(t,s){return typeof s>"u"||typeof s=="number"?lr(t.s,t.e):(typeof t!="string"&&(t=Ks(t)),typeof s!="string"&&(s=Ks(s)),t==s?t:t+":"+s)}function Cr(t){var s={s:{c:0,r:0},e:{c:0,r:0}},r=0,a=0,n=0,i=t.length;for(r=0;a<i&&!((n=t.charCodeAt(a)-64)<1||n>26);++a)r=26*r+n;for(s.s.c=--r,r=0;a<i&&!((n=t.charCodeAt(a)-48)<0||n>9);++a)r=10*r+n;if(s.s.r=--r,a===i||n!=10)return s.e.c=s.s.c,s.e.r=s.s.r,s;for(++a,r=0;a!=i&&!((n=t.charCodeAt(a)-64)<1||n>26);++a)r=26*r+n;for(s.e.c=--r,r=0;a!=i&&!((n=t.charCodeAt(a)-48)<0||n>9);++a)r=10*r+n;return s.e.r=--r,s}function jS(t,s){var r=t.t=="d"&&s instanceof Date;if(t.z!=null)try{return t.w=io(t.z,r?pn(s):s)}catch{}try{return t.w=io((t.XF||{}).numFmtId||(r?14:0),r?pn(s):s)}catch{return""+s}}function bd(t,s,r){return t==null||t.t==null||t.t=="z"?"":t.w!==void 0?t.w:(t.t=="d"&&!t.z&&r&&r.dateNF&&(t.z=r.dateNF),t.t=="e"?_d[t.v]||t.v:s==null?jS(t,t.v):jS(t,s))}function Lu(t,s){var r=s&&s.sheet?s.sheet:"Sheet1",a={};return a[r]=t,{SheetNames:[r],Sheets:a}}function IE(t,s,r){var a=r||{},n=t?Array.isArray(t):a.dense,i=t||(n?[]:{}),l=0,o=0;if(i&&a.origin!=null){if(typeof a.origin=="number")l=a.origin;else{var d=typeof a.origin=="string"?wa(a.origin):a.origin;l=d.r,o=d.c}i["!ref"]||(i["!ref"]="A1:A1")}var u={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(i["!ref"]){var c=Cr(i["!ref"]);u.s.c=c.s.c,u.s.r=c.s.r,u.e.c=Math.max(u.e.c,c.e.c),u.e.r=Math.max(u.e.r,c.e.r),l==-1&&(u.e.r=l=c.e.r+1)}for(var h=0;h!=s.length;++h)if(s[h]){if(!Array.isArray(s[h]))throw new Error("aoa_to_sheet expects an array of arrays");for(var m=0;m!=s[h].length;++m)if(!(typeof s[h][m]>"u")){var p={v:s[h][m]},g=l+h,x=o+m;if(u.s.r>g&&(u.s.r=g),u.s.c>x&&(u.s.c=x),u.e.r<g&&(u.e.r=g),u.e.c<x&&(u.e.c=x),s[h][m]&&typeof s[h][m]=="object"&&!Array.isArray(s[h][m])&&!(s[h][m]instanceof Date))p=s[h][m];else if(Array.isArray(p.v)&&(p.f=s[h][m][1],p.v=p.v[0]),p.v===null)if(p.f)p.t="n";else if(a.nullError)p.t="e",p.v=0;else if(a.sheetStubs)p.t="z";else continue;else typeof p.v=="number"?p.t="n":typeof p.v=="boolean"?p.t="b":p.v instanceof Date?(p.z=a.dateNF||Vs[14],a.cellDates?(p.t="d",p.w=io(p.z,pn(p.v))):(p.t="n",p.v=pn(p.v),p.w=io(p.z,p.v))):p.t="s";if(n)i[g]||(i[g]=[]),i[g][x]&&i[g][x].z&&(p.z=i[g][x].z),i[g][x]=p;else{var b=Ks({c:x,r:g});i[b]&&i[b].z&&(p.z=i[b].z),i[b]=p}}}return u.s.c<1e7&&(i["!ref"]=lr(u)),i}function lA(t,s){return IE(null,t,s)}function K9(t){return t.read_shift(4,"i")}function Wo(t,s){return s||(s=Zt(4)),s.write_shift(4,t),s}function Ni(t){var s=t.read_shift(4);return s===0?"":t.read_shift(s,"dbcs")}function Tn(t,s){var r=!1;return s==null&&(r=!0,s=Zt(4+2*t.length)),s.write_shift(4,t.length),t.length>0&&s.write_shift(0,t,"dbcs"),r?s.slice(0,s.l):s}function z9(t){return{ich:t.read_shift(2),ifnt:t.read_shift(2)}}function Y9(t,s){return s||(s=Zt(4)),s.write_shift(2,0),s.write_shift(2,0),s}function yN(t,s){var r=t.l,a=t.read_shift(1),n=Ni(t),i=[],l={t:n,h:n};if((a&1)!==0){for(var o=t.read_shift(4),d=0;d!=o;++d)i.push(z9(t));l.r=i}else l.r=[{ich:0,ifnt:0}];return t.l=r+s,l}function X9(t,s){var r=!1;return s==null&&(r=!0,s=Zt(15+4*t.t.length)),s.write_shift(1,0),Tn(t.t,s),r?s.slice(0,s.l):s}var J9=yN;function Z9(t,s){var r=!1;return s==null&&(r=!0,s=Zt(23+4*t.t.length)),s.write_shift(1,1),Tn(t.t,s),s.write_shift(4,1),Y9({},s),r?s.slice(0,s.l):s}function oo(t){var s=t.read_shift(4),r=t.read_shift(2);return r+=t.read_shift(1)<<16,t.l++,{c:s,iStyleRef:r}}function Pm(t,s){return s==null&&(s=Zt(8)),s.write_shift(-4,t.c),s.write_shift(3,t.iStyleRef||t.s),s.write_shift(1,0),s}function Um(t){var s=t.read_shift(2);return s+=t.read_shift(1)<<16,t.l++,{c:-1,iStyleRef:s}}function Rm(t,s){return s==null&&(s=Zt(4)),s.write_shift(3,t.iStyleRef||t.s),s.write_shift(1,0),s}var eq=Ni,LE=Tn;function jN(t){var s=t.read_shift(4);return s===0||s===4294967295?"":t.read_shift(s,"dbcs")}function Q0(t,s){var r=!1;return s==null&&(r=!0,s=Zt(127)),s.write_shift(4,t.length>0?t.length:4294967295),t.length>0&&s.write_shift(0,t,"dbcs"),r?s.slice(0,s.l):s}var tq=Ni,uj=jN,NN=Q0;function wN(t){var s=t.slice(t.l,t.l+4),r=s[0]&1,a=s[0]&2;t.l+=4;var n=a===0?M0([0,0,0,0,s[0]&252,s[1],s[2],s[3]],0):mm(s,0)>>2;return r?n/100:n}function DE(t,s){s==null&&(s=Zt(4));var r=0,a=0,n=t*100;if(t==(t|0)&&t>=-536870912&&t<1<<29?a=1:n==(n|0)&&n>=-536870912&&n<1<<29&&(a=1,r=1),a)s.write_shift(-4,((r?n:t)<<2)+(r+2));else throw new Error("unsupported RkNumber "+t)}function PE(t){var s={s:{},e:{}};return s.s.r=t.read_shift(4),s.e.r=t.read_shift(4),s.s.c=t.read_shift(4),s.e.c=t.read_shift(4),s}function sq(t,s){return s||(s=Zt(16)),s.write_shift(4,t.s.r),s.write_shift(4,t.e.r),s.write_shift(4,t.s.c),s.write_shift(4,t.e.c),s}var Om=PE,oA=sq;function ji(t){if(t.length-t.l<8)throw"XLS Xnum Buffer underflow";return t.read_shift(8,"f")}function Bm(t,s){return(s||Zt(8)).write_shift(8,t,"f")}function rq(t){var s={},r=t.read_shift(1),a=r>>>1,n=t.read_shift(1),i=t.read_shift(2,"i"),l=t.read_shift(1),o=t.read_shift(1),d=t.read_shift(1);switch(t.l++,a){case 0:s.auto=1;break;case 1:s.index=n;var u=jm[n];u&&(s.rgb=Uf(u));break;case 2:s.rgb=Uf([l,o,d]);break;case 3:s.theme=n;break}return i!=0&&(s.tint=i>0?i/32767:i/32768),s}function H0(t,s){if(s||(s=Zt(8)),!t||t.auto)return s.write_shift(4,0),s.write_shift(4,0),s;t.index!=null?(s.write_shift(1,2),s.write_shift(1,t.index)):t.theme!=null?(s.write_shift(1,6),s.write_shift(1,t.theme)):(s.write_shift(1,5),s.write_shift(1,0));var r=t.tint||0;if(r>0?r*=32767:r<0&&(r*=32768),s.write_shift(2,r),!t.rgb||t.theme!=null)s.write_shift(2,0),s.write_shift(1,0),s.write_shift(1,0);else{var a=t.rgb||"FFFFFF";typeof a=="number"&&(a=("000000"+a.toString(16)).slice(-6)),s.write_shift(1,parseInt(a.slice(0,2),16)),s.write_shift(1,parseInt(a.slice(2,4),16)),s.write_shift(1,parseInt(a.slice(4,6),16)),s.write_shift(1,255)}return s}function aq(t){var s=t.read_shift(1);t.l++;var r={fBold:s&1,fItalic:s&2,fUnderline:s&4,fStrikeout:s&8,fOutline:s&16,fShadow:s&32,fCondense:s&64,fExtend:s&128};return r}function nq(t,s){s||(s=Zt(2));var r=(t.italic?2:0)|(t.strike?8:0)|(t.outline?16:0)|(t.shadow?32:0)|(t.condense?64:0)|(t.extend?128:0);return s.write_shift(1,r),s.write_shift(1,0),s}function UE(t,s){var r={2:"BITMAP",3:"METAFILEPICT",8:"DIB",14:"ENHMETAFILE"},a=t.read_shift(4);switch(a){case 0:return"";case 4294967295:case 4294967294:return r[t.read_shift(4)]||""}if(a>400)throw new Error("Unsupported Clipboard: "+a.toString(16));return t.l-=4,t.read_shift(0,s==1?"lpstr":"lpwstr")}function iq(t){return UE(t,1)}function lq(t){return UE(t,2)}var _N=2,il=3,Bx=11,NS=12,q0=19,Fx=64,oq=65,cq=71,dq=4108,uq=4126,kn=80,RE=81,mq=[kn,RE],mj={1:{n:"CodePage",t:_N},2:{n:"Category",t:kn},3:{n:"PresentationFormat",t:kn},4:{n:"ByteCount",t:il},5:{n:"LineCount",t:il},6:{n:"ParagraphCount",t:il},7:{n:"SlideCount",t:il},8:{n:"NoteCount",t:il},9:{n:"HiddenCount",t:il},10:{n:"MultimediaClipCount",t:il},11:{n:"ScaleCrop",t:Bx},12:{n:"HeadingPairs",t:dq},13:{n:"TitlesOfParts",t:uq},14:{n:"Manager",t:kn},15:{n:"Company",t:kn},16:{n:"LinksUpToDate",t:Bx},17:{n:"CharacterCount",t:il},19:{n:"SharedDoc",t:Bx},22:{n:"HyperlinksChanged",t:Bx},23:{n:"AppVersion",t:il,p:"version"},24:{n:"DigSig",t:oq},26:{n:"ContentType",t:kn},27:{n:"ContentStatus",t:kn},28:{n:"Language",t:kn},29:{n:"Version",t:kn},255:{},2147483648:{n:"Locale",t:q0},2147483651:{n:"Behavior",t:q0},1919054434:{}},hj={1:{n:"CodePage",t:_N},2:{n:"Title",t:kn},3:{n:"Subject",t:kn},4:{n:"Author",t:kn},5:{n:"Keywords",t:kn},6:{n:"Comments",t:kn},7:{n:"Template",t:kn},8:{n:"LastAuthor",t:kn},9:{n:"RevNumber",t:kn},10:{n:"EditTime",t:Fx},11:{n:"LastPrinted",t:Fx},12:{n:"CreatedDate",t:Fx},13:{n:"ModifiedDate",t:Fx},14:{n:"PageCount",t:il},15:{n:"WordCount",t:il},16:{n:"CharCount",t:il},17:{n:"Thumbnail",t:cq},18:{n:"Application",t:kn},19:{n:"DocSecurity",t:il},255:{},2147483648:{n:"Locale",t:q0},2147483651:{n:"Behavior",t:q0},1919054434:{}},wS={1:"US",2:"CA",3:"",7:"RU",20:"EG",30:"GR",31:"NL",32:"BE",33:"FR",34:"ES",36:"HU",39:"IT",41:"CH",43:"AT",44:"GB",45:"DK",46:"SE",47:"NO",48:"PL",49:"DE",52:"MX",55:"BR",61:"AU",64:"NZ",66:"TH",81:"JP",82:"KR",84:"VN",86:"CN",90:"TR",105:"JS",213:"DZ",216:"MA",218:"LY",351:"PT",354:"IS",358:"FI",420:"CZ",886:"TW",961:"LB",962:"JO",963:"SY",964:"IQ",965:"KW",966:"SA",971:"AE",972:"IL",974:"QA",981:"IR",65535:"US"},hq=[null,"solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];function Aq(t){return t.map(function(s){return[s>>16&255,s>>8&255,s&255]})}var fq=Aq([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),jm=ha(fq),_d={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},OE={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43,"#WTF?":255},Aj={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},Tx={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function SN(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function pq(t){var s=SN();if(!t||!t.match)return s;var r={};if((t.match(Si)||[]).forEach(function(a){var n=Ys(a);switch(n[0].replace(S9,"<")){case"<?xml":break;case"<Types":s.xmlns=n["xmlns"+(n[0].match(/<(\w+):/)||["",""])[1]];break;case"<Default":r[n.Extension]=n.ContentType;break;case"<Override":s[Aj[n.ContentType]]!==void 0&&s[Aj[n.ContentType]].push(n.PartName);break}}),s.xmlns!==fn.CT)throw new Error("Unknown Namespace: "+s.xmlns);return s.calcchain=s.calcchains.length>0?s.calcchains[0]:"",s.sst=s.strs.length>0?s.strs[0]:"",s.style=s.styles.length>0?s.styles[0]:"",s.defaults=r,delete s.calcchains,s}function ME(t,s){var r=p9(Aj),a=[],n;a[a.length]=Xa,a[a.length]=gs("Types",null,{xmlns:fn.CT,"xmlns:xsd":fn.xsd,"xmlns:xsi":fn.xsi}),a=a.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(d){return gs("Default",null,{Extension:d[0],ContentType:d[1]})}));var i=function(d){t[d]&&t[d].length>0&&(n=t[d][0],a[a.length]=gs("Override",null,{PartName:(n[0]=="/"?"":"/")+n,ContentType:Tx[d][s.bookType]||Tx[d].xlsx}))},l=function(d){(t[d]||[]).forEach(function(u){a[a.length]=gs("Override",null,{PartName:(u[0]=="/"?"":"/")+u,ContentType:Tx[d][s.bookType]||Tx[d].xlsx})})},o=function(d){(t[d]||[]).forEach(function(u){a[a.length]=gs("Override",null,{PartName:(u[0]=="/"?"":"/")+u,ContentType:r[d][0]})})};return i("workbooks"),l("sheets"),l("charts"),o("themes"),["strs","styles"].forEach(i),["coreprops","extprops","custprops"].forEach(o),o("vba"),o("comments"),o("threadedcomments"),o("drawings"),l("metadata"),o("people"),a.length>2&&(a[a.length]="</Types>",a[1]=a[1].replace("/>",">")),a.join("")}var fr={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function Pf(t){var s=t.lastIndexOf("/");return t.slice(0,s+1)+"_rels/"+t.slice(s+1)+".rels"}function hf(t,s){var r={"!id":{}};if(!t)return r;s.charAt(0)!=="/"&&(s="/"+s);var a={};return(t.match(Si)||[]).forEach(function(n){var i=Ys(n);if(i[0]==="<Relationship"){var l={};l.Type=i.Type,l.Target=i.Target,l.Id=i.Id,i.TargetMode&&(l.TargetMode=i.TargetMode);var o=i.TargetMode==="External"?i.Target:JA(i.Target,s);r[o]=l,a[i.Id]=l}}),r["!id"]=a,r}function Oh(t){var s=[Xa,gs("Relationships",null,{xmlns:fn.RELS})];return Da(t["!id"]).forEach(function(r){s[s.length]=gs("Relationship",null,t["!id"][r])}),s.length>2&&(s[s.length]="</Relationships>",s[1]=s[1].replace("/>",">")),s.join("")}function Vr(t,s,r,a,n,i){if(n||(n={}),t["!id"]||(t["!id"]={}),t["!idx"]||(t["!idx"]=1),s<0)for(s=t["!idx"];t["!id"]["rId"+s];++s);if(t["!idx"]=s+1,n.Id="rId"+s,n.Type=a,n.Target=r,[fr.HLINK,fr.XPATH,fr.XMISS].indexOf(n.Type)>-1&&(n.TargetMode="External"),t["!id"][n.Id])throw new Error("Cannot rewrite rId "+s);return t["!id"][n.Id]=n,t[("/"+n.Target).replace("//","/")]=n,s}var xq="application/vnd.oasis.opendocument.spreadsheet";function gq(t,s){for(var r=pN(t),a,n;a=Df.exec(r);)switch(a[3]){case"manifest":break;case"file-entry":if(n=Ys(a[0],!1),n.path=="/"&&n.type!==xq)throw new Error("This OpenDocument is not a spreadsheet");break;case"encryption-data":case"algorithm":case"start-key-generation":case"key-derivation":throw new Error("Unsupported ODS Encryption");default:if(s&&s.WTF)throw a}}function vq(t){var s=[Xa];s.push(`<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">
`),s.push(`  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
`);for(var r=0;r<t.length;++r)s.push('  <manifest:file-entry manifest:full-path="'+t[r][0]+'" manifest:media-type="'+t[r][1]+`"/>
`);return s.push("</manifest:manifest>"),s.join("")}function _S(t,s,r){return['  <rdf:Description rdf:about="'+t+`">
`,'    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(r||"odf")+"#"+s+`"/>
`,`  </rdf:Description>
`].join("")}function bq(t,s){return['  <rdf:Description rdf:about="'+t+`">
`,'    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+s+`"/>
`,`  </rdf:Description>
`].join("")}function yq(t){var s=[Xa];s.push(`<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
`);for(var r=0;r!=t.length;++r)s.push(_S(t[r][0],t[r][1])),s.push(bq("",t[r][0]));return s.push(_S("","Document","pkg")),s.push("</rdf:RDF>"),s.join("")}function QE(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+D0.version+"</meta:generator></office:meta></office:document-meta>"}var no=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]],jq=(function(){for(var t=new Array(no.length),s=0;s<no.length;++s){var r=no[s],a="(?:"+r[0].slice(0,r[0].indexOf(":"))+":)"+r[0].slice(r[0].indexOf(":")+1);t[s]=new RegExp("<"+a+"[^>]*>([\\s\\S]*?)</"+a+">")}return t})();function HE(t){var s={};t=Xr(t);for(var r=0;r<no.length;++r){var a=no[r],n=t.match(jq[r]);n!=null&&n.length>0&&(s[a[1]]=Sr(n[1])),a[2]==="date"&&s[a[1]]&&(s[a[1]]=ma(s[a[1]]))}return s}function Lb(t,s,r,a,n){n[t]!=null||s==null||s===""||(n[t]=s,s=Gr(s),a[a.length]=r?gs(t,s,r):Kn(t,s))}function qE(t,s){var r=s||{},a=[Xa,gs("cp:coreProperties",null,{"xmlns:cp":fn.CORE_PROPS,"xmlns:dc":fn.dc,"xmlns:dcterms":fn.dcterms,"xmlns:dcmitype":fn.dcmitype,"xmlns:xsi":fn.xsi})],n={};if(!t&&!r.Props)return a.join("");t&&(t.CreatedDate!=null&&Lb("dcterms:created",typeof t.CreatedDate=="string"?t.CreatedDate:dj(t.CreatedDate,r.WTF),{"xsi:type":"dcterms:W3CDTF"},a,n),t.ModifiedDate!=null&&Lb("dcterms:modified",typeof t.ModifiedDate=="string"?t.ModifiedDate:dj(t.ModifiedDate,r.WTF),{"xsi:type":"dcterms:W3CDTF"},a,n));for(var i=0;i!=no.length;++i){var l=no[i],o=r.Props&&r.Props[l[1]]!=null?r.Props[l[1]]:t?t[l[1]]:null;o===!0?o="1":o===!1?o="0":typeof o=="number"&&(o=String(o)),o!=null&&Lb(l[0],o,null,a,n)}return a.length>2&&(a[a.length]="</cp:coreProperties>",a[1]=a[1].replace("/>",">")),a.join("")}var Nm=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],$E=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function VE(t,s,r,a){var n=[];if(typeof t=="string")n=fS(t,a);else for(var i=0;i<t.length;++i)n=n.concat(t[i].map(function(c){return{v:c}}));var l=typeof s=="string"?fS(s,a).map(function(c){return c.v}):s,o=0,d=0;if(l.length>0)for(var u=0;u!==n.length;u+=2){switch(d=+n[u+1].v,n[u].v){case"Worksheets":case"":case"":case" ":case"":case" ":case"Arbeitsbltter":case"alma Sayfalar":case"Feuilles de calcul":case"Fogli di lavoro":case"Folhas de clculo":case"Planilhas":case"Regneark":case"Hojas de clculo":case"Werkbladen":r.Worksheets=d,r.SheetNames=l.slice(o,o+d);break;case"Named Ranges":case"Rangos con nombre":case"":case"Benannte Bereiche":case"Navngivne omrder":r.NamedRanges=d,r.DefinedNames=l.slice(o,o+d);break;case"Charts":case"Diagramme":r.Chartsheets=d,r.ChartNames=l.slice(o,o+d);break}o+=d}}function Nq(t,s,r){var a={};return s||(s={}),t=Xr(t),Nm.forEach(function(n){var i=(t.match(If(n[0]))||[])[1];switch(n[2]){case"string":i&&(s[n[1]]=Sr(i));break;case"bool":s[n[1]]=i==="true";break;case"raw":var l=t.match(new RegExp("<"+n[0]+"[^>]*>([\\s\\S]*?)</"+n[0]+">"));l&&l.length>0&&(a[n[1]]=l[1]);break}}),a.HeadingPairs&&a.TitlesOfParts&&VE(a.HeadingPairs,a.TitlesOfParts,s,r),s}function WE(t){var s=[],r=gs;return t||(t={}),t.Application="SheetJS",s[s.length]=Xa,s[s.length]=gs("Properties",null,{xmlns:fn.EXT_PROPS,"xmlns:vt":fn.vt}),Nm.forEach(function(a){if(t[a[1]]!==void 0){var n;switch(a[2]){case"string":n=Gr(String(t[a[1]]));break;case"bool":n=t[a[1]]?"true":"false";break}n!==void 0&&(s[s.length]=r(a[0],n))}}),s[s.length]=r("HeadingPairs",r("vt:vector",r("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+r("vt:variant",r("vt:i4",String(t.Worksheets))),{size:2,baseType:"variant"})),s[s.length]=r("TitlesOfParts",r("vt:vector",t.SheetNames.map(function(a){return"<vt:lpstr>"+Gr(a)+"</vt:lpstr>"}).join(""),{size:t.Worksheets,baseType:"lpstr"})),s.length>2&&(s[s.length]="</Properties>",s[1]=s[1].replace("/>",">")),s.join("")}var wq=/<[^>]+>[^<]*/g;function _q(t,s){var r={},a="",n=t.match(wq);if(n)for(var i=0;i!=n.length;++i){var l=n[i],o=Ys(l);switch(o[0]){case"<?xml":break;case"<Properties":break;case"<property":a=Sr(o.name);break;case"</property>":a=null;break;default:if(l.indexOf("<vt:")===0){var d=l.split(">"),u=d[0].slice(4),c=d[1];switch(u){case"lpstr":case"bstr":case"lpwstr":r[a]=Sr(c);break;case"bool":r[a]=da(c);break;case"i1":case"i2":case"i4":case"i8":case"int":case"uint":r[a]=parseInt(c,10);break;case"r4":case"r8":case"decimal":r[a]=parseFloat(c);break;case"filetime":case"date":r[a]=ma(c);break;case"cy":case"error":r[a]=Sr(c);break;default:if(u.slice(-1)=="/")break;s.WTF&&typeof console<"u"&&console.warn("Unexpected",l,u,d)}}else if(l.slice(0,2)!=="</"){if(s.WTF)throw new Error(l)}}}return r}function GE(t){var s=[Xa,gs("Properties",null,{xmlns:fn.CUST_PROPS,"xmlns:vt":fn.vt})];if(!t)return s.join("");var r=1;return Da(t).forEach(function(n){++r,s[s.length]=gs("property",L9(t[n]),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:r,name:Gr(n)})}),s.length>2&&(s[s.length]="</Properties>",s[1]=s[1].replace("/>",">")),s.join("")}var fj={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"},Db;function Sq(t,s,r){Db||(Db=Fg(fj)),s=Db[s]||s,t[s]=r}function Cq(t,s){var r=[];return Da(fj).map(function(a){for(var n=0;n<no.length;++n)if(no[n][1]==a)return no[n];for(n=0;n<Nm.length;++n)if(Nm[n][1]==a)return Nm[n];throw a}).forEach(function(a){if(t[a[1]]!=null){var n=s&&s.Props&&s.Props[a[1]]!=null?s.Props[a[1]]:t[a[1]];switch(a[2]){case"date":n=new Date(n).toISOString().replace(/\.\d*Z/,"Z");break}typeof n=="number"?n=String(n):n===!0||n===!1?n=n?"1":"0":n instanceof Date&&(n=new Date(n).toISOString().replace(/\.\d*Z/,"")),r.push(Kn(fj[a[1]]||a[1],n))}}),gs("DocumentProperties",r.join(""),{xmlns:wl.o})}function kq(t,s){var r=["Worksheets","SheetNames"],a="CustomDocumentProperties",n=[];return t&&Da(t).forEach(function(i){if(Object.prototype.hasOwnProperty.call(t,i)){for(var l=0;l<no.length;++l)if(i==no[l][1])return;for(l=0;l<Nm.length;++l)if(i==Nm[l][1])return;for(l=0;l<r.length;++l)if(i==r[l])return;var o=t[i],d="string";typeof o=="number"?(d="float",o=String(o)):o===!0||o===!1?(d="boolean",o=o?"1":"0"):o=String(o),n.push(gs(uS(i),o,{"dt:dt":d}))}}),s&&Da(s).forEach(function(i){if(Object.prototype.hasOwnProperty.call(s,i)&&!(t&&Object.prototype.hasOwnProperty.call(t,i))){var l=s[i],o="string";typeof l=="number"?(o="float",l=String(l)):l===!0||l===!1?(o="boolean",l=l?"1":"0"):l instanceof Date?(o="dateTime.tz",l=l.toISOString()):l=String(l),n.push(gs(uS(i),l,{"dt:dt":o}))}}),"<"+a+' xmlns="'+wl.o+'">'+n.join("")+"</"+a+">"}function CN(t){var s=t.read_shift(4),r=t.read_shift(4);return new Date((r/1e7*Math.pow(2,32)+s/1e7-11644473600)*1e3).toISOString().replace(/\.000/,"")}function Eq(t){var s=typeof t=="string"?new Date(Date.parse(t)):t,r=s.getTime()/1e3+11644473600,a=r%Math.pow(2,32),n=(r-a)/Math.pow(2,32);a*=1e7,n*=1e7;var i=a/Math.pow(2,32)|0;i>0&&(a=a%Math.pow(2,32),n+=i);var l=Zt(8);return l.write_shift(4,a),l.write_shift(4,n),l}function KE(t,s,r){var a=t.l,n=t.read_shift(0,"lpstr-cp");if(r)for(;t.l-a&3;)++t.l;return n}function zE(t,s,r){var a=t.read_shift(0,"lpwstr");return a}function YE(t,s,r){return s===31?zE(t):KE(t,s,r)}function pj(t,s,r){return YE(t,s,r===!1?0:4)}function Bq(t,s){if(!s)throw new Error("VtUnalignedString must have positive length");return YE(t,s,0)}function Fq(t){for(var s=t.read_shift(4),r=[],a=0;a!=s;++a){var n=t.l;r[a]=t.read_shift(0,"lpwstr").replace(Hi,""),t.l-n&2&&(t.l+=2)}return r}function Tq(t){for(var s=t.read_shift(4),r=[],a=0;a!=s;++a)r[a]=t.read_shift(0,"lpstr-cp").replace(Hi,"");return r}function Iq(t){var s=t.l,r=$0(t,RE);t[t.l]==0&&t[t.l+1]==0&&t.l-s&2&&(t.l+=2);var a=$0(t,il);return[r,a]}function Lq(t){for(var s=t.read_shift(4),r=[],a=0;a<s/2;++a)r.push(Iq(t));return r}function SS(t,s){for(var r=t.read_shift(4),a={},n=0;n!=r;++n){var i=t.read_shift(4),l=t.read_shift(4);a[i]=t.read_shift(l,s===1200?"utf16le":"utf8").replace(Hi,"").replace(XA,"!"),s===1200&&l%2&&(t.l+=2)}return t.l&3&&(t.l=t.l>>3<<2),a}function XE(t){var s=t.read_shift(4),r=t.slice(t.l,t.l+s);return t.l+=s,(s&3)>0&&(t.l+=4-(s&3)&3),r}function Dq(t){var s={};return s.Size=t.read_shift(4),t.l+=s.Size+3-(s.Size-1)%4,s}function $0(t,s,r){var a=t.read_shift(2),n,i=r||{};if(t.l+=2,s!==NS&&a!==s&&mq.indexOf(s)===-1&&!((s&65534)==4126&&(a&65534)==4126))throw new Error("Expected type "+s+" saw "+a);switch(s===NS?a:s){case 2:return n=t.read_shift(2,"i"),i.raw||(t.l+=2),n;case 3:return n=t.read_shift(4,"i"),n;case 11:return t.read_shift(4)!==0;case 19:return n=t.read_shift(4),n;case 30:return KE(t,a,4).replace(Hi,"");case 31:return zE(t);case 64:return CN(t);case 65:return XE(t);case 71:return Dq(t);case 80:return pj(t,a,!i.raw).replace(Hi,"");case 81:return Bq(t,a).replace(Hi,"");case 4108:return Lq(t);case 4126:case 4127:return a==4127?Fq(t):Tq(t);default:throw new Error("TypedPropertyValue unrecognized type "+s+" "+a)}}function CS(t,s){var r=Zt(4),a=Zt(4);switch(r.write_shift(4,t==80?31:t),t){case 3:a.write_shift(-4,s);break;case 5:a=Zt(8),a.write_shift(8,s,"f");break;case 11:a.write_shift(4,s?1:0);break;case 64:a=Eq(s);break;case 31:case 80:for(a=Zt(4+2*(s.length+1)+(s.length%2?0:2)),a.write_shift(4,s.length+1),a.write_shift(0,s,"dbcs");a.l!=a.length;)a.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+t+" "+s)}return Fn([r,a])}function kS(t,s){var r=t.l,a=t.read_shift(4),n=t.read_shift(4),i=[],l=0,o=0,d=-1,u={};for(l=0;l!=n;++l){var c=t.read_shift(4),h=t.read_shift(4);i[l]=[c,h+r]}i.sort(function(j,N){return j[1]-N[1]});var m={};for(l=0;l!=n;++l){if(t.l!==i[l][1]){var p=!0;if(l>0&&s)switch(s[i[l-1][0]].t){case 2:t.l+2===i[l][1]&&(t.l+=2,p=!1);break;case 80:t.l<=i[l][1]&&(t.l=i[l][1],p=!1);break;case 4108:t.l<=i[l][1]&&(t.l=i[l][1],p=!1);break}if((!s||l==0)&&t.l<=i[l][1]&&(p=!1,t.l=i[l][1]),p)throw new Error("Read Error: Expected address "+i[l][1]+" at "+t.l+" :"+l)}if(s){var g=s[i[l][0]];if(m[g.n]=$0(t,g.t,{raw:!0}),g.p==="version"&&(m[g.n]=String(m[g.n]>>16)+"."+("0000"+String(m[g.n]&65535)).slice(-4)),g.n=="CodePage")switch(m[g.n]){case 0:m[g.n]=1252;case 874:case 932:case 936:case 949:case 950:case 1250:case 1251:case 1253:case 1254:case 1255:case 1256:case 1257:case 1258:case 1e4:case 1200:case 1201:case 1252:case 65e3:case-536:case 65001:case-535:qo(o=m[g.n]>>>0&65535);break;default:throw new Error("Unsupported CodePage: "+m[g.n])}}else if(i[l][0]===1){if(o=m.CodePage=$0(t,_N),qo(o),d!==-1){var x=t.l;t.l=i[d][1],u=SS(t,o),t.l=x}}else if(i[l][0]===0){if(o===0){d=l,t.l=i[l+1][1];continue}u=SS(t,o)}else{var b=u[i[l][0]],y;switch(t[t.l]){case 65:t.l+=4,y=XE(t);break;case 30:t.l+=4,y=pj(t,t[t.l-4]).replace(/\u0000+$/,"");break;case 31:t.l+=4,y=pj(t,t[t.l-4]).replace(/\u0000+$/,"");break;case 3:t.l+=4,y=t.read_shift(4,"i");break;case 19:t.l+=4,y=t.read_shift(4);break;case 5:t.l+=4,y=t.read_shift(8,"f");break;case 11:t.l+=4,y=$a(t,4);break;case 64:t.l+=4,y=ma(CN(t));break;default:throw new Error("unparsed value: "+t[t.l])}m[b]=y}}return t.l=r+a,m}var JE=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function Pq(t){switch(typeof t){case"boolean":return 11;case"number":return(t|0)==t?3:5;case"string":return 31;case"object":if(t instanceof Date)return 64;break}return-1}function ES(t,s,r){var a=Zt(8),n=[],i=[],l=8,o=0,d=Zt(8),u=Zt(8);if(d.write_shift(4,2),d.write_shift(4,1200),u.write_shift(4,1),i.push(d),n.push(u),l+=8+d.length,!s){u=Zt(8),u.write_shift(4,0),n.unshift(u);var c=[Zt(4)];for(c[0].write_shift(4,t.length),o=0;o<t.length;++o){var h=t[o][0];for(d=Zt(8+2*(h.length+1)+(h.length%2?0:2)),d.write_shift(4,o+2),d.write_shift(4,h.length+1),d.write_shift(0,h,"dbcs");d.l!=d.length;)d.write_shift(1,0);c.push(d)}d=Fn(c),i.unshift(d),l+=8+d.length}for(o=0;o<t.length;++o)if(!(s&&!s[t[o][0]])&&!(JE.indexOf(t[o][0])>-1||$E.indexOf(t[o][0])>-1)&&t[o][1]!=null){var m=t[o][1],p=0;if(s){p=+s[t[o][0]];var g=r[p];if(g.p=="version"&&typeof m=="string"){var x=m.split(".");m=(+x[0]<<16)+(+x[1]||0)}d=CS(g.t,m)}else{var b=Pq(m);b==-1&&(b=31,m=String(m)),d=CS(b,m)}i.push(d),u=Zt(8),u.write_shift(4,s?p:2+o),n.push(u),l+=8+d.length}var y=8*(i.length+1);for(o=0;o<i.length;++o)n[o].write_shift(4,y),y+=i[o].length;return a.write_shift(4,l),a.write_shift(4,i.length),Fn([a].concat(n).concat(i))}function BS(t,s,r){var a=t.content;if(!a)return{};Gn(a,0);var n,i,l,o,d=0;a.chk("feff","Byte Order: "),a.read_shift(2);var u=a.read_shift(4),c=a.read_shift(16);if(c!==Qs.utils.consts.HEADER_CLSID&&c!==r)throw new Error("Bad PropertySet CLSID "+c);if(n=a.read_shift(4),n!==1&&n!==2)throw new Error("Unrecognized #Sets: "+n);if(i=a.read_shift(16),o=a.read_shift(4),n===1&&o!==a.l)throw new Error("Length mismatch: "+o+" !== "+a.l);n===2&&(l=a.read_shift(16),d=a.read_shift(4));var h=kS(a,s),m={SystemIdentifier:u};for(var p in h)m[p]=h[p];if(m.FMTID=i,n===1)return m;if(d-a.l==2&&(a.l+=2),a.l!==d)throw new Error("Length mismatch 2: "+a.l+" !== "+d);var g;try{g=kS(a,null)}catch{}for(p in g)m[p]=g[p];return m.FMTID=[i,l],m}function FS(t,s,r,a,n,i){var l=Zt(n?68:48),o=[l];l.write_shift(2,65534),l.write_shift(2,0),l.write_shift(4,842412599),l.write_shift(16,Qs.utils.consts.HEADER_CLSID,"hex"),l.write_shift(4,n?2:1),l.write_shift(16,s,"hex"),l.write_shift(4,n?68:48);var d=ES(t,r,a);if(o.push(d),n){var u=ES(n,null,null);l.write_shift(16,i,"hex"),l.write_shift(4,68+d.length),o.push(u)}return Fn(o)}function lu(t,s){return t.read_shift(s),null}function Uq(t,s){s||(s=Zt(t));for(var r=0;r<t;++r)s.write_shift(1,0);return s}function Rq(t,s,r){for(var a=[],n=t.l+s;t.l<n;)a.push(r(t,n-t.l));if(n!==t.l)throw new Error("Slurp error");return a}function $a(t,s){return t.read_shift(s)===1}function Mi(t,s){return s||(s=Zt(2)),s.write_shift(2,+!!t),s}function nn(t){return t.read_shift(2,"u")}function eo(t,s){return s||(s=Zt(2)),s.write_shift(2,t),s}function ZE(t,s){return Rq(t,s,nn)}function Oq(t){var s=t.read_shift(1),r=t.read_shift(1);return r===1?s:s===1}function eB(t,s,r){return r||(r=Zt(2)),r.write_shift(1,s=="e"?+t:+!!t),r.write_shift(1,s=="e"?1:0),r}function np(t,s,r){var a=t.read_shift(r&&r.biff>=12?2:1),n="sbcs-cont";if(r&&r.biff>=8,!r||r.biff==8){var i=t.read_shift(1);i&&(n="dbcs-cont")}else r.biff==12&&(n="wstr");r.biff>=2&&r.biff<=5&&(n="cpstr");var l=a?t.read_shift(a,n):"";return l}function Mq(t){var s=t.read_shift(2),r=t.read_shift(1),a=r&4,n=r&8,i=1+(r&1),l=0,o,d={};n&&(l=t.read_shift(2)),a&&(o=t.read_shift(4));var u=i==2?"dbcs-cont":"sbcs-cont",c=s===0?"":t.read_shift(s,u);return n&&(t.l+=4*l),a&&(t.l+=o),d.t=c,n||(d.raw="<t>"+d.t+"</t>",d.r=d.t),d}function Qq(t){var s=t.t||"",r=Zt(3);r.write_shift(2,s.length),r.write_shift(1,1);var a=Zt(2*s.length);a.write_shift(2*s.length,s,"utf16le");var n=[r,a];return Fn(n)}function Fm(t,s,r){var a;if(r){if(r.biff>=2&&r.biff<=5)return t.read_shift(s,"cpstr");if(r.biff>=12)return t.read_shift(s,"dbcs-cont")}var n=t.read_shift(1);return n===0?a=t.read_shift(s,"sbcs-cont"):a=t.read_shift(s,"dbcs-cont"),a}function ip(t,s,r){var a=t.read_shift(r&&r.biff==2?1:2);return a===0?(t.l++,""):Fm(t,a,r)}function Mm(t,s,r){if(r.biff>5)return ip(t,s,r);var a=t.read_shift(1);return a===0?(t.l++,""):t.read_shift(a,r.biff<=4||!t.lens?"cpstr":"sbcs-cont")}function tB(t,s,r){return r||(r=Zt(3+2*t.length)),r.write_shift(2,t.length),r.write_shift(1,1),r.write_shift(31,t,"utf16le"),r}function Hq(t){var s=t.read_shift(1);t.l++;var r=t.read_shift(2);return t.l+=2,[s,r]}function qq(t){var s=t.read_shift(4),r=t.l,a=!1;s>24&&(t.l+=s-24,t.read_shift(16)==="795881f43b1d7f48af2c825dc4852763"&&(a=!0),t.l=r);var n=t.read_shift((a?s-24:s)>>1,"utf16le").replace(Hi,"");return a&&(t.l+=24),n}function $q(t){for(var s=t.read_shift(2),r="";s-- >0;)r+="../";var a=t.read_shift(0,"lpstr-ansi");if(t.l+=2,t.read_shift(2)!=57005)throw new Error("Bad FileMoniker");var n=t.read_shift(4);if(n===0)return r+a.replace(/\\/g,"/");var i=t.read_shift(4);if(t.read_shift(2)!=3)throw new Error("Bad FileMoniker");var l=t.read_shift(i>>1,"utf16le").replace(Hi,"");return r+l}function Vq(t,s){var r=t.read_shift(16);switch(r){case"e0c9ea79f9bace118c8200aa004ba90b":return qq(t);case"0303000000000000c000000000000046":return $q(t);default:throw new Error("Unsupported Moniker "+r)}}function Ix(t){var s=t.read_shift(4),r=s>0?t.read_shift(s,"utf16le").replace(Hi,""):"";return r}function TS(t,s){s||(s=Zt(6+t.length*2)),s.write_shift(4,1+t.length);for(var r=0;r<t.length;++r)s.write_shift(2,t.charCodeAt(r));return s.write_shift(2,0),s}function Wq(t,s){var r=t.l+s,a=t.read_shift(4);if(a!==2)throw new Error("Unrecognized streamVersion: "+a);var n=t.read_shift(2);t.l+=2;var i,l,o,d,u="",c,h;n&16&&(i=Ix(t,r-t.l)),n&128&&(l=Ix(t,r-t.l)),(n&257)===257&&(o=Ix(t,r-t.l)),(n&257)===1&&(d=Vq(t,r-t.l)),n&8&&(u=Ix(t,r-t.l)),n&32&&(c=t.read_shift(16)),n&64&&(h=CN(t)),t.l=r;var m=l||o||d||"";m&&u&&(m+="#"+u),m||(m="#"+u),n&2&&m.charAt(0)=="/"&&m.charAt(1)!="/"&&(m="file://"+m);var p={Target:m};return c&&(p.guid=c),h&&(p.time=h),i&&(p.Tooltip=i),p}function Gq(t){var s=Zt(512),r=0,a=t.Target;a.slice(0,7)=="file://"&&(a=a.slice(7));var n=a.indexOf("#"),i=n>-1?31:23;switch(a.charAt(0)){case"#":i=28;break;case".":i&=-3;break}s.write_shift(4,2),s.write_shift(4,i);var l=[8,6815827,6619237,4849780,83];for(r=0;r<l.length;++r)s.write_shift(4,l[r]);if(i==28)a=a.slice(1),TS(a,s);else if(i&2){for(l="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),r=0;r<l.length;++r)s.write_shift(1,parseInt(l[r],16));var o=n>-1?a.slice(0,n):a;for(s.write_shift(4,2*(o.length+1)),r=0;r<o.length;++r)s.write_shift(2,o.charCodeAt(r));s.write_shift(2,0),i&8&&TS(n>-1?a.slice(n+1):"",s)}else{for(l="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),r=0;r<l.length;++r)s.write_shift(1,parseInt(l[r],16));for(var d=0;a.slice(d*3,d*3+3)=="../"||a.slice(d*3,d*3+3)=="..\\";)++d;for(s.write_shift(2,d),s.write_shift(4,a.length-3*d+1),r=0;r<a.length-3*d;++r)s.write_shift(1,a.charCodeAt(r+3*d)&255);for(s.write_shift(1,0),s.write_shift(2,65535),s.write_shift(2,57005),r=0;r<6;++r)s.write_shift(4,0)}return s.slice(0,s.l)}function sB(t){var s=t.read_shift(1),r=t.read_shift(1),a=t.read_shift(1),n=t.read_shift(1);return[s,r,a,n]}function rB(t,s){var r=sB(t);return r[3]=0,r}function Dc(t){var s=t.read_shift(2),r=t.read_shift(2),a=t.read_shift(2);return{r:s,c:r,ixfe:a}}function Tm(t,s,r,a){return a||(a=Zt(6)),a.write_shift(2,t),a.write_shift(2,s),a.write_shift(2,r||0),a}function Kq(t){var s=t.read_shift(2),r=t.read_shift(2);return t.l+=8,{type:s,flags:r}}function zq(t,s,r){return s===0?"":Mm(t,s,r)}function Yq(t,s,r){var a=r.biff>8?4:2,n=t.read_shift(a),i=t.read_shift(a,"i"),l=t.read_shift(a,"i");return[n,i,l]}function aB(t){var s=t.read_shift(2),r=wN(t);return[s,r]}function Xq(t,s,r){t.l+=4,s-=4;var a=t.l+s,n=np(t,s,r),i=t.read_shift(2);if(a-=t.l,i!==a)throw new Error("Malformed AddinUdf: padding = "+a+" != "+i);return t.l+=i,n}function Lg(t){var s=t.read_shift(2),r=t.read_shift(2),a=t.read_shift(2),n=t.read_shift(2);return{s:{c:a,r:s},e:{c:n,r}}}function nB(t,s){return s||(s=Zt(8)),s.write_shift(2,t.s.r),s.write_shift(2,t.e.r),s.write_shift(2,t.s.c),s.write_shift(2,t.e.c),s}function iB(t){var s=t.read_shift(2),r=t.read_shift(2),a=t.read_shift(1),n=t.read_shift(1);return{s:{c:a,r:s},e:{c:n,r}}}var Jq=iB;function lB(t){t.l+=4;var s=t.read_shift(2),r=t.read_shift(2),a=t.read_shift(2);return t.l+=12,[r,s,a]}function Zq(t){var s={};return t.l+=4,t.l+=16,s.fSharedNote=t.read_shift(2),t.l+=4,s}function e$(t){var s={};return t.l+=4,t.cf=t.read_shift(2),s}function hi(t){t.l+=2,t.l+=t.read_shift(2)}var t$={0:hi,4:hi,5:hi,6:hi,7:e$,8:hi,9:hi,10:hi,11:hi,12:hi,13:Zq,14:hi,15:hi,16:hi,17:hi,18:hi,19:hi,20:hi,21:lB};function s$(t,s){for(var r=t.l+s,a=[];t.l<r;){var n=t.read_shift(2);t.l-=2;try{a.push(t$[n](t,r-t.l))}catch{return t.l=r,a}}return t.l!=r&&(t.l=r),a}function Lx(t,s){var r={BIFFVer:0,dt:0};switch(r.BIFFVer=t.read_shift(2),s-=2,s>=2&&(r.dt=t.read_shift(2),t.l-=2),r.BIFFVer){case 1536:case 1280:case 1024:case 768:case 512:case 2:case 7:break;default:if(s>6)throw new Error("Unexpected BIFF Ver "+r.BIFFVer)}return t.read_shift(s),r}function kN(t,s,r){var a=1536,n=16;switch(r.bookType){case"biff8":break;case"biff5":a=1280,n=8;break;case"biff4":a=4,n=6;break;case"biff3":a=3,n=6;break;case"biff2":a=2,n=4;break;case"xla":break;default:throw new Error("unsupported BIFF version")}var i=Zt(n);return i.write_shift(2,a),i.write_shift(2,s),n>4&&i.write_shift(2,29282),n>6&&i.write_shift(2,1997),n>8&&(i.write_shift(2,49161),i.write_shift(2,1),i.write_shift(2,1798),i.write_shift(2,0)),i}function r$(t,s){return s===0||t.read_shift(2),1200}function a$(t,s,r){if(r.enc)return t.l+=s,"";var a=t.l,n=Mm(t,0,r);return t.read_shift(s+a-t.l),n}function n$(t,s){var r=!s||s.biff==8,a=Zt(r?112:54);for(a.write_shift(s.biff==8?2:1,7),r&&a.write_shift(1,0),a.write_shift(4,859007059),a.write_shift(4,5458548|(r?0:536870912));a.l<a.length;)a.write_shift(1,r?0:32);return a}function i$(t,s,r){var a=r&&r.biff==8||s==2?t.read_shift(2):(t.l+=s,0);return{fDialog:a&16,fBelow:a&64,fRight:a&128}}function l$(t,s,r){var a=t.read_shift(4),n=t.read_shift(1)&3,i=t.read_shift(1);switch(i){case 0:i="Worksheet";break;case 1:i="Macrosheet";break;case 2:i="Chartsheet";break;case 6:i="VBAModule";break}var l=np(t,0,r);return l.length===0&&(l="Sheet1"),{pos:a,hs:n,dt:i,name:l}}function o$(t,s){var r=!s||s.biff>=8?2:1,a=Zt(8+r*t.name.length);a.write_shift(4,t.pos),a.write_shift(1,t.hs||0),a.write_shift(1,t.dt),a.write_shift(1,t.name.length),s.biff>=8&&a.write_shift(1,1),a.write_shift(r*t.name.length,t.name,s.biff<8?"sbcs":"utf16le");var n=a.slice(0,a.l);return n.l=a.l,n}function c$(t,s){for(var r=t.l+s,a=t.read_shift(4),n=t.read_shift(4),i=[],l=0;l!=n&&t.l<r;++l)i.push(Mq(t));return i.Count=a,i.Unique=n,i}function d$(t,s){var r=Zt(8);r.write_shift(4,t.Count),r.write_shift(4,t.Unique);for(var a=[],n=0;n<t.length;++n)a[n]=Qq(t[n]);var i=Fn([r].concat(a));return i.parts=[r.length].concat(a.map(function(l){return l.length})),i}function u$(t,s){var r={};return r.dsst=t.read_shift(2),t.l+=s-2,r}function m$(t){var s={};s.r=t.read_shift(2),s.c=t.read_shift(2),s.cnt=t.read_shift(2)-s.c;var r=t.read_shift(2);t.l+=4;var a=t.read_shift(1);return t.l+=3,a&7&&(s.level=a&7),a&32&&(s.hidden=!0),a&64&&(s.hpt=r/20),s}function h$(t){var s=Kq(t);if(s.type!=2211)throw new Error("Invalid Future Record "+s.type);var r=t.read_shift(4);return r!==0}function A$(t){return t.read_shift(2),t.read_shift(4)}function IS(t,s,r){var a=0;r&&r.biff==2||(a=t.read_shift(2));var n=t.read_shift(2);r&&r.biff==2&&(a=1-(n>>15),n&=32767);var i={Unsynced:a&1,DyZero:(a&2)>>1,ExAsc:(a&4)>>2,ExDsc:(a&8)>>3};return[i,n]}function f$(t){var s=t.read_shift(2),r=t.read_shift(2),a=t.read_shift(2),n=t.read_shift(2),i=t.read_shift(2),l=t.read_shift(2),o=t.read_shift(2),d=t.read_shift(2),u=t.read_shift(2);return{Pos:[s,r],Dim:[a,n],Flags:i,CurTab:l,FirstTab:o,Selected:d,TabRatio:u}}function p$(){var t=Zt(18);return t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,29280),t.write_shift(2,17600),t.write_shift(2,56),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,1),t.write_shift(2,500),t}function x$(t,s,r){if(r&&r.biff>=2&&r.biff<5)return{};var a=t.read_shift(2);return{RTL:a&64}}function g$(t){var s=Zt(18),r=1718;return t&&t.RTL&&(r|=64),s.write_shift(2,r),s.write_shift(4,0),s.write_shift(4,64),s.write_shift(4,0),s.write_shift(4,0),s}function v$(){}function b$(t,s,r){var a={dyHeight:t.read_shift(2),fl:t.read_shift(2)};switch(r&&r.biff||8){case 2:break;case 3:case 4:t.l+=2;break;default:t.l+=10;break}return a.name=np(t,0,r),a}function y$(t,s){var r=t.name||"Arial",a=s&&s.biff==5,n=a?15+r.length:16+2*r.length,i=Zt(n);return i.write_shift(2,t.sz*20),i.write_shift(4,0),i.write_shift(2,400),i.write_shift(4,0),i.write_shift(2,0),i.write_shift(1,r.length),a||i.write_shift(1,1),i.write_shift((a?1:2)*r.length,r,a?"sbcs":"utf16le"),i}function j$(t){var s=Dc(t);return s.isst=t.read_shift(4),s}function N$(t,s,r,a){var n=Zt(10);return Tm(t,s,a,n),n.write_shift(4,r),n}function w$(t,s,r){r.biffguess&&r.biff==2&&(r.biff=5);var a=t.l+s,n=Dc(t);r.biff==2&&t.l++;var i=ip(t,a-t.l,r);return n.val=i,n}function _$(t,s,r,a,n){var i=!n||n.biff==8,l=Zt(8+ +i+(1+i)*r.length);return Tm(t,s,a,l),l.write_shift(2,r.length),i&&l.write_shift(1,1),l.write_shift((1+i)*r.length,r,i?"utf16le":"sbcs"),l}function S$(t,s,r){var a=t.read_shift(2),n=Mm(t,0,r);return[a,n]}function C$(t,s,r,a){var n=r&&r.biff==5;a||(a=Zt(n?3+s.length:5+2*s.length)),a.write_shift(2,t),a.write_shift(n?1:2,s.length),n||a.write_shift(1,1),a.write_shift((n?1:2)*s.length,s,n?"sbcs":"utf16le");var i=a.length>a.l?a.slice(0,a.l):a;return i.l==null&&(i.l=i.length),i}var k$=Mm;function LS(t,s,r){var a=t.l+s,n=r.biff==8||!r.biff?4:2,i=t.read_shift(n),l=t.read_shift(n),o=t.read_shift(2),d=t.read_shift(2);return t.l=a,{s:{r:i,c:o},e:{r:l,c:d}}}function E$(t,s){var r=s.biff==8||!s.biff?4:2,a=Zt(2*r+6);return a.write_shift(r,t.s.r),a.write_shift(r,t.e.r+1),a.write_shift(2,t.s.c),a.write_shift(2,t.e.c+1),a.write_shift(2,0),a}function B$(t){var s=t.read_shift(2),r=t.read_shift(2),a=aB(t);return{r:s,c:r,ixfe:a[0],rknum:a[1]}}function F$(t,s){for(var r=t.l+s-2,a=t.read_shift(2),n=t.read_shift(2),i=[];t.l<r;)i.push(aB(t));if(t.l!==r)throw new Error("MulRK read error");var l=t.read_shift(2);if(i.length!=l-n+1)throw new Error("MulRK length mismatch");return{r:a,c:n,C:l,rkrec:i}}function T$(t,s){for(var r=t.l+s-2,a=t.read_shift(2),n=t.read_shift(2),i=[];t.l<r;)i.push(t.read_shift(2));if(t.l!==r)throw new Error("MulBlank read error");var l=t.read_shift(2);if(i.length!=l-n+1)throw new Error("MulBlank length mismatch");return{r:a,c:n,C:l,ixfe:i}}function I$(t,s,r,a){var n={},i=t.read_shift(4),l=t.read_shift(4),o=t.read_shift(4),d=t.read_shift(2);return n.patternType=hq[o>>26],a.cellStyles&&(n.alc=i&7,n.fWrap=i>>3&1,n.alcV=i>>4&7,n.fJustLast=i>>7&1,n.trot=i>>8&255,n.cIndent=i>>16&15,n.fShrinkToFit=i>>20&1,n.iReadOrder=i>>22&2,n.fAtrNum=i>>26&1,n.fAtrFnt=i>>27&1,n.fAtrAlc=i>>28&1,n.fAtrBdr=i>>29&1,n.fAtrPat=i>>30&1,n.fAtrProt=i>>31&1,n.dgLeft=l&15,n.dgRight=l>>4&15,n.dgTop=l>>8&15,n.dgBottom=l>>12&15,n.icvLeft=l>>16&127,n.icvRight=l>>23&127,n.grbitDiag=l>>30&3,n.icvTop=o&127,n.icvBottom=o>>7&127,n.icvDiag=o>>14&127,n.dgDiag=o>>21&15,n.icvFore=d&127,n.icvBack=d>>7&127,n.fsxButton=d>>14&1),n}function L$(t,s,r){var a={};return a.ifnt=t.read_shift(2),a.numFmtId=t.read_shift(2),a.flags=t.read_shift(2),a.fStyle=a.flags>>2&1,s-=6,a.data=I$(t,s,a.fStyle,r),a}function DS(t,s,r,a){var n=r&&r.biff==5;a||(a=Zt(n?16:20)),a.write_shift(2,0),t.style?(a.write_shift(2,t.numFmtId||0),a.write_shift(2,65524)):(a.write_shift(2,t.numFmtId||0),a.write_shift(2,s<<4));var i=0;return t.numFmtId>0&&n&&(i|=1024),a.write_shift(4,i),a.write_shift(4,0),n||a.write_shift(4,0),a.write_shift(2,0),a}function D$(t){t.l+=4;var s=[t.read_shift(2),t.read_shift(2)];if(s[0]!==0&&s[0]--,s[1]!==0&&s[1]--,s[0]>7||s[1]>7)throw new Error("Bad Gutters: "+s.join("|"));return s}function P$(t){var s=Zt(8);return s.write_shift(4,0),s.write_shift(2,0),s.write_shift(2,0),s}function PS(t,s,r){var a=Dc(t);(r.biff==2||s==9)&&++t.l;var n=Oq(t);return a.val=n,a.t=n===!0||n===!1?"b":"e",a}function U$(t,s,r,a,n,i){var l=Zt(8);return Tm(t,s,a,l),eB(r,i,l),l}function R$(t,s,r){r.biffguess&&r.biff==2&&(r.biff=5);var a=Dc(t),n=ji(t);return a.val=n,a}function O$(t,s,r,a){var n=Zt(14);return Tm(t,s,a,n),Bm(r,n),n}var US=zq;function M$(t,s,r){var a=t.l+s,n=t.read_shift(2),i=t.read_shift(2);if(r.sbcch=i,i==1025||i==14849)return[i,n];if(i<1||i>255)throw new Error("Unexpected SupBook type: "+i);for(var l=Fm(t,i),o=[];a>t.l;)o.push(ip(t));return[i,n,l,o]}function RS(t,s,r){var a=t.read_shift(2),n,i={fBuiltIn:a&1,fWantAdvise:a>>>1&1,fWantPict:a>>>2&1,fOle:a>>>3&1,fOleLink:a>>>4&1,cf:a>>>5&1023,fIcon:a>>>15&1};return r.sbcch===14849&&(n=Xq(t,s-2,r)),i.body=n||t.read_shift(s-2),typeof n=="string"&&(i.Name=n),i}var Q$=["_xlnm.Consolidate_Area","_xlnm.Auto_Open","_xlnm.Auto_Close","_xlnm.Extract","_xlnm.Database","_xlnm.Criteria","_xlnm.Print_Area","_xlnm.Print_Titles","_xlnm.Recorder","_xlnm.Data_Form","_xlnm.Auto_Activate","_xlnm.Auto_Deactivate","_xlnm.Sheet_Title","_xlnm._FilterDatabase"];function OS(t,s,r){var a=t.l+s,n=t.read_shift(2),i=t.read_shift(1),l=t.read_shift(1),o=t.read_shift(r&&r.biff==2?1:2),d=0;(!r||r.biff>=5)&&(r.biff!=5&&(t.l+=2),d=t.read_shift(2),r.biff==5&&(t.l+=2),t.l+=4);var u=Fm(t,l,r);n&32&&(u=Q$[u.charCodeAt(0)]);var c=a-t.l;r&&r.biff==2&&--c;var h=a==t.l||o===0||!(c>0)?[]:sz(t,c,r,o);return{chKey:i,Name:u,itab:d,rgce:h}}function oB(t,s,r){if(r.biff<8)return H$(t,s,r);for(var a=[],n=t.l+s,i=t.read_shift(r.biff>8?4:2);i--!==0;)a.push(Yq(t,r.biff>8?12:6,r));if(t.l!=n)throw new Error("Bad ExternSheet: "+t.l+" != "+n);return a}function H$(t,s,r){t[t.l+1]==3&&t[t.l]++;var a=np(t,s,r);return a.charCodeAt(0)==3?a.slice(1):a}function q$(t,s,r){if(r.biff<8){t.l+=s;return}var a=t.read_shift(2),n=t.read_shift(2),i=Fm(t,a,r),l=Fm(t,n,r);return[i,l]}function $$(t,s,r){var a=iB(t);t.l++;var n=t.read_shift(1);return s-=8,[rz(t,s,r),n,a]}function MS(t,s,r){var a=Jq(t);switch(r.biff){case 2:t.l++,s-=7;break;case 3:case 4:t.l+=2,s-=8;break;default:t.l+=6,s-=12}return[a,ez(t,s,r)]}function V$(t){var s=t.read_shift(4)!==0,r=t.read_shift(4)!==0,a=t.read_shift(4);return[s,r,a]}function W$(t,s,r){if(!(r.biff<8)){var a=t.read_shift(2),n=t.read_shift(2),i=t.read_shift(2),l=t.read_shift(2),o=Mm(t,0,r);return r.biff<8&&t.read_shift(1),[{r:a,c:n},o,l,i]}}function G$(t,s,r){return W$(t,s,r)}function K$(t,s){for(var r=[],a=t.read_shift(2);a--;)r.push(Lg(t));return r}function z$(t){var s=Zt(2+t.length*8);s.write_shift(2,t.length);for(var r=0;r<t.length;++r)nB(t[r],s);return s}function Y$(t,s,r){if(r&&r.biff<8)return J$(t,s,r);var a=lB(t),n=s$(t,s-22,a[1]);return{cmo:a,ft:n}}var X$={8:function(t,s){var r=t.l+s;t.l+=10;var a=t.read_shift(2);t.l+=4,t.l+=2,t.l+=2,t.l+=2,t.l+=4;var n=t.read_shift(1);return t.l+=n,t.l=r,{fmt:a}}};function J$(t,s,r){t.l+=4;var a=t.read_shift(2),n=t.read_shift(2),i=t.read_shift(2);t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=6,s-=36;var l=[];return l.push((X$[a]||_i)(t,s,r)),{cmo:[n,a,i],ft:l}}function Z$(t,s,r){var a=t.l,n="";try{t.l+=4;var i=(r.lastobj||{cmo:[0,0]}).cmo[1],l;[0,5,7,11,12,14].indexOf(i)==-1?t.l+=6:l=Hq(t,6,r);var o=t.read_shift(2);t.read_shift(2),nn(t,2);var d=t.read_shift(2);t.l+=d;for(var u=1;u<t.lens.length-1;++u){if(t.l-a!=t.lens[u])throw new Error("TxO: bad continue record");var c=t[t.l],h=Fm(t,t.lens[u+1]-t.lens[u]-1);if(n+=h,n.length>=(c?o:2*o))break}if(n.length!==o&&n.length!==o*2)throw new Error("cchText: "+o+" != "+n.length);return t.l=a+s,{t:n}}catch{return t.l=a+s,{t:n}}}function eV(t,s){var r=Lg(t);t.l+=16;var a=Wq(t,s-24);return[r,a]}function tV(t){var s=Zt(24),r=wa(t[0]);s.write_shift(2,r.r),s.write_shift(2,r.r),s.write_shift(2,r.c),s.write_shift(2,r.c);for(var a="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),n=0;n<16;++n)s.write_shift(1,parseInt(a[n],16));return Fn([s,Gq(t[1])])}function sV(t,s){t.read_shift(2);var r=Lg(t),a=t.read_shift((s-10)/2,"dbcs-cont");return a=a.replace(Hi,""),[r,a]}function rV(t){var s=t[1].Tooltip,r=Zt(10+2*(s.length+1));r.write_shift(2,2048);var a=wa(t[0]);r.write_shift(2,a.r),r.write_shift(2,a.r),r.write_shift(2,a.c),r.write_shift(2,a.c);for(var n=0;n<s.length;++n)r.write_shift(2,s.charCodeAt(n));return r.write_shift(2,0),r}function aV(t){var s=[0,0],r;return r=t.read_shift(2),s[0]=wS[r]||r,r=t.read_shift(2),s[1]=wS[r]||r,s}function nV(t){return t||(t=Zt(4)),t.write_shift(2,1),t.write_shift(2,1),t}function iV(t){for(var s=t.read_shift(2),r=[];s-- >0;)r.push(rB(t));return r}function lV(t){for(var s=t.read_shift(2),r=[];s-- >0;)r.push(rB(t));return r}function oV(t){t.l+=2;var s={cxfs:0,crc:0};return s.cxfs=t.read_shift(2),s.crc=t.read_shift(4),s}function cB(t,s,r){if(!r.cellStyles)return _i(t,s);var a=r&&r.biff>=12?4:2,n=t.read_shift(a),i=t.read_shift(a),l=t.read_shift(a),o=t.read_shift(a),d=t.read_shift(2);a==2&&(t.l+=2);var u={s:n,e:i,w:l,ixfe:o,flags:d};return(r.biff>=5||!r.biff)&&(u.level=d>>8&7),u}function cV(t,s){var r=Zt(12);r.write_shift(2,s),r.write_shift(2,s),r.write_shift(2,t.width*256),r.write_shift(2,0);var a=0;return t.hidden&&(a|=1),r.write_shift(1,a),a=t.level||0,r.write_shift(1,a),r.write_shift(2,0),r}function dV(t,s){var r={};return s<32||(t.l+=16,r.header=ji(t),r.footer=ji(t),t.l+=2),r}function uV(t,s,r){var a={area:!1};if(r.biff!=5)return t.l+=s,a;var n=t.read_shift(1);return t.l+=3,n&16&&(a.area=!0),a}function mV(t){for(var s=Zt(2*t),r=0;r<t;++r)s.write_shift(2,r+1);return s}var hV=Dc,AV=ZE,fV=ip;function pV(t){var s=t.read_shift(2),r=t.read_shift(2),a=t.read_shift(4),n={fmt:s,env:r,len:a,data:t.slice(t.l,t.l+a)};return t.l+=a,n}function xV(t,s,r){r.biffguess&&r.biff==5&&(r.biff=2);var a=Dc(t);++t.l;var n=Mm(t,s-7,r);return a.t="str",a.val=n,a}function gV(t){var s=Dc(t);++t.l;var r=ji(t);return s.t="n",s.val=r,s}function vV(t,s,r){var a=Zt(15);return dp(a,t,s),a.write_shift(8,r,"f"),a}function bV(t){var s=Dc(t);++t.l;var r=t.read_shift(2);return s.t="n",s.val=r,s}function yV(t,s,r){var a=Zt(9);return dp(a,t,s),a.write_shift(2,r),a}function jV(t){var s=t.read_shift(1);return s===0?(t.l++,""):t.read_shift(s,"sbcs-cont")}function NV(t,s){t.l+=6,t.l+=2,t.l+=1,t.l+=3,t.l+=1,t.l+=s-13}function wV(t,s,r){var a=t.l+s,n=Dc(t),i=t.read_shift(2),l=Fm(t,i,r);return t.l=a,n.t="str",n.val=l,n}var _V=[2,3,48,49,131,139,140,245],xj=(function(){var t={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},s=Fg({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function r(o,d){var u=[],c=Eu(1);switch(d.type){case"base64":c=Sl(Tl(o));break;case"binary":c=Sl(o);break;case"buffer":case"array":c=o;break}Gn(c,0);var h=c.read_shift(1),m=!!(h&136),p=!1,g=!1;switch(h){case 2:break;case 3:break;case 48:p=!0,m=!0;break;case 49:p=!0,m=!0;break;case 131:break;case 139:break;case 140:g=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+h.toString(16))}var x=0,b=521;h==2&&(x=c.read_shift(2)),c.l+=3,h!=2&&(x=c.read_shift(4)),x>1048576&&(x=1e6),h!=2&&(b=c.read_shift(2));var y=c.read_shift(2),j=d.codepage||1252;h!=2&&(c.l+=16,c.read_shift(1),c[c.l]!==0&&(j=t[c[c.l]]),c.l+=1,c.l+=2),g&&(c.l+=36);for(var N=[],_={},F=Math.min(c.length,h==2?521:b-10-(p?264:0)),I=g?32:11;c.l<F&&c[c.l]!=13;)switch(_={},_.name=Bf.utils.decode(j,c.slice(c.l,c.l+I)).replace(/[\u0000\r\n].*$/g,""),c.l+=I,_.type=String.fromCharCode(c.read_shift(1)),h!=2&&!g&&(_.offset=c.read_shift(4)),_.len=c.read_shift(1),h==2&&(_.offset=c.read_shift(2)),_.dec=c.read_shift(1),_.name.length&&N.push(_),h!=2&&(c.l+=g?13:14),_.type){case"B":(!p||_.len!=8)&&d.WTF&&console.log("Skipping "+_.name+":"+_.type);break;case"G":case"P":d.WTF&&console.log("Skipping "+_.name+":"+_.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+_.type)}if(c[c.l]!==13&&(c.l=b-1),c.read_shift(1)!==13)throw new Error("DBF Terminator not found "+c.l+" "+c[c.l]);c.l=b;var w=0,E=0;for(u[0]=[],E=0;E!=N.length;++E)u[0][E]=N[E].name;for(;x-- >0;){if(c[c.l]===42){c.l+=y;continue}for(++c.l,u[++w]=[],E=0,E=0;E!=N.length;++E){var W=c.slice(c.l,c.l+N[E].len);c.l+=N[E].len,Gn(W,0);var R=Bf.utils.decode(j,W);switch(N[E].type){case"C":R.trim().length&&(u[w][E]=R.replace(/\s+$/,""));break;case"D":R.length===8?u[w][E]=new Date(+R.slice(0,4),+R.slice(4,6)-1,+R.slice(6,8)):u[w][E]=R;break;case"F":u[w][E]=parseFloat(R.trim());break;case"+":case"I":u[w][E]=g?W.read_shift(-4,"i")^2147483648:W.read_shift(4,"i");break;case"L":switch(R.trim().toUpperCase()){case"Y":case"T":u[w][E]=!0;break;case"N":case"F":u[w][E]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+R+"|")}break;case"M":if(!m)throw new Error("DBF Unexpected MEMO for type "+h.toString(16));u[w][E]="##MEMO##"+(g?parseInt(R.trim(),10):W.read_shift(4));break;case"N":R=R.replace(/\u0000/g,"").trim(),R&&R!="."&&(u[w][E]=+R||0);break;case"@":u[w][E]=new Date(W.read_shift(-8,"f")-621356832e5);break;case"T":u[w][E]=new Date((W.read_shift(4)-2440588)*864e5+W.read_shift(4));break;case"Y":u[w][E]=W.read_shift(4,"i")/1e4+W.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":u[w][E]=-W.read_shift(-8,"f");break;case"B":if(p&&N[E].len==8){u[w][E]=W.read_shift(8,"f");break}case"G":case"P":W.l+=N[E].len;break;case"0":if(N[E].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+N[E].type)}}}if(h!=2&&c.l<c.length&&c[c.l++]!=26)throw new Error("DBF EOF Marker missing "+(c.l-1)+" of "+c.length+" "+c[c.l-1].toString(16));return d&&d.sheetRows&&(u=u.slice(0,d.sheetRows)),d.DBF=N,u}function a(o,d){var u=d||{};u.dateNF||(u.dateNF="yyyymmdd");var c=lA(r(o,u),u);return c["!cols"]=u.DBF.map(function(h){return{wch:h.len,DBF:h}}),delete u.DBF,c}function n(o,d){try{return Lu(a(o,d),d)}catch(u){if(d&&d.WTF)throw u}return{SheetNames:[],Sheets:{}}}var i={B:8,C:250,L:1,D:8,"?":0,"":0};function l(o,d){var u=d||{};if(+u.codepage>=0&&qo(+u.codepage),u.type=="string")throw new Error("Cannot write DBF to JS string");var c=ul(),h=G0(o,{header:1,raw:!0,cellDates:!0}),m=h[0],p=h.slice(1),g=o["!cols"]||[],x=0,b=0,y=0,j=1;for(x=0;x<m.length;++x){if(((g[x]||{}).DBF||{}).name){m[x]=g[x].DBF.name,++y;continue}if(m[x]!=null){if(++y,typeof m[x]=="number"&&(m[x]=m[x].toString(10)),typeof m[x]!="string")throw new Error("DBF Invalid column name "+m[x]+" |"+typeof m[x]+"|");if(m.indexOf(m[x])!==x){for(b=0;b<1024;++b)if(m.indexOf(m[x]+"_"+b)==-1){m[x]+="_"+b;break}}}}var N=Cr(o["!ref"]),_=[],F=[],I=[];for(x=0;x<=N.e.c-N.s.c;++x){var w="",E="",W=0,R=[];for(b=0;b<p.length;++b)p[b][x]!=null&&R.push(p[b][x]);if(R.length==0||m[x]==null){_[x]="?";continue}for(b=0;b<R.length;++b){switch(typeof R[b]){case"number":E="B";break;case"string":E="C";break;case"boolean":E="L";break;case"object":E=R[b]instanceof Date?"D":"C";break;default:E="C"}W=Math.max(W,String(R[b]).length),w=w&&w!=E?"C":E}W>250&&(W=250),E=((g[x]||{}).DBF||{}).type,E=="C"&&g[x].DBF.len>W&&(W=g[x].DBF.len),w=="B"&&E=="N"&&(w="N",I[x]=g[x].DBF.dec,W=g[x].DBF.len),F[x]=w=="C"||E=="N"?W:i[w]||0,j+=F[x],_[x]=w}var U=c.next(32);for(U.write_shift(4,318902576),U.write_shift(4,p.length),U.write_shift(2,296+32*y),U.write_shift(2,j),x=0;x<4;++x)U.write_shift(4,0);for(U.write_shift(4,0|(+s[J4]||3)<<8),x=0,b=0;x<m.length;++x)if(m[x]!=null){var T=c.next(32),Y=(m[x].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);T.write_shift(1,Y,"sbcs"),T.write_shift(1,_[x]=="?"?"C":_[x],"sbcs"),T.write_shift(4,b),T.write_shift(1,F[x]||i[_[x]]||0),T.write_shift(1,I[x]||0),T.write_shift(1,2),T.write_shift(4,0),T.write_shift(1,0),T.write_shift(4,0),T.write_shift(4,0),b+=F[x]||i[_[x]]||0}var H=c.next(264);for(H.write_shift(4,13),x=0;x<65;++x)H.write_shift(4,0);for(x=0;x<p.length;++x){var M=c.next(j);for(M.write_shift(1,0),b=0;b<m.length;++b)if(m[b]!=null)switch(_[b]){case"L":M.write_shift(1,p[x][b]==null?63:p[x][b]?84:70);break;case"B":M.write_shift(8,p[x][b]||0,"f");break;case"N":var q="0";for(typeof p[x][b]=="number"&&(q=p[x][b].toFixed(I[b]||0)),y=0;y<F[b]-q.length;++y)M.write_shift(1,32);M.write_shift(1,q,"sbcs");break;case"D":p[x][b]?(M.write_shift(4,("0000"+p[x][b].getFullYear()).slice(-4),"sbcs"),M.write_shift(2,("00"+(p[x][b].getMonth()+1)).slice(-2),"sbcs"),M.write_shift(2,("00"+p[x][b].getDate()).slice(-2),"sbcs")):M.write_shift(8,"00000000","sbcs");break;case"C":var z=String(p[x][b]!=null?p[x][b]:"").slice(0,F[b]);for(M.write_shift(1,z,"sbcs"),y=0;y<F[b]-z.length;++y)M.write_shift(1,32);break}}return c.next(1).write_shift(1,26),c.end()}return{to_workbook:n,to_sheet:a,from_sheet:l}})(),dB=(function(){var t={AA:"",BA:"",CA:"",DA:195,HA:"",JA:197,AE:"",BE:"",CE:"",HE:"",AI:"",BI:"",CI:"",HI:"",AO:"",BO:"",CO:"",DO:213,HO:"",AU:"",BU:"",CU:"",HU:"",Aa:"",Ba:"",Ca:"",Da:227,Ha:"",Ja:229,Ae:"",Be:"",Ce:"",He:"",Ai:"",Bi:"",Ci:"",Hi:"",Ao:"",Bo:"",Co:"",Do:245,Ho:"",Au:"",Bu:"",Cu:"",Hu:"",KC:"",Kc:"",q:"",z:"",a:"",j:"",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},s=new RegExp("\x1BN("+Da(t).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),r=function(m,p){var g=t[p];return typeof g=="number"?X2(g):g},a=function(m,p,g){var x=p.charCodeAt(0)-32<<4|g.charCodeAt(0)-48;return x==59?m:X2(x)};t["|"]=254;function n(m,p){switch(p.type){case"base64":return i(Tl(m),p);case"binary":return i(m,p);case"buffer":return i(ur&&Buffer.isBuffer(m)?m.toString("binary"):Iu(m),p);case"array":return i(Em(m),p)}throw new Error("Unrecognized type "+p.type)}function i(m,p){var g=m.split(/[\n\r]+/),x=-1,b=-1,y=0,j=0,N=[],_=[],F=null,I={},w=[],E=[],W=[],R=0,U;for(+p.codepage>=0&&qo(+p.codepage);y!==g.length;++y){R=0;var T=g[y].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,a).replace(s,r),Y=T.replace(/;;/g,"\0").split(";").map(function(G){return G.replace(/\u0000/g,";")}),H=Y[0],M;if(T.length>0)switch(H){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":Y[1].charAt(0)=="P"&&_.push(T.slice(3).replace(/;;/g,";"));break;case"C":var q=!1,z=!1,Q=!1,L=!1,V=-1,P=-1;for(j=1;j<Y.length;++j)switch(Y[j].charAt(0)){case"A":break;case"X":b=parseInt(Y[j].slice(1))-1,z=!0;break;case"Y":for(x=parseInt(Y[j].slice(1))-1,z||(b=0),U=N.length;U<=x;++U)N[U]=[];break;case"K":M=Y[j].slice(1),M.charAt(0)==='"'?M=M.slice(1,M.length-1):M==="TRUE"?M=!0:M==="FALSE"?M=!1:isNaN(Vo(M))?isNaN(Gh(M).getDate())||(M=ma(M)):(M=Vo(M),F!==null&&nA(F)&&(M=Ig(M))),q=!0;break;case"E":L=!0;var C=Mh(Y[j].slice(1),{r:x,c:b});N[x][b]=[N[x][b],C];break;case"S":Q=!0,N[x][b]=[N[x][b],"S5S"];break;case"G":break;case"R":V=parseInt(Y[j].slice(1))-1;break;case"C":P=parseInt(Y[j].slice(1))-1;break;default:if(p&&p.WTF)throw new Error("SYLK bad record "+T)}if(q&&(N[x][b]&&N[x][b].length==2?N[x][b][0]=M:N[x][b]=M,F=null),Q){if(L)throw new Error("SYLK shared formula cannot have own formula");var k=V>-1&&N[V][P];if(!k||!k[1])throw new Error("SYLK shared formula cannot find base");N[x][b][1]=kB(k[1],{r:x-V,c:b-P})}break;case"F":var B=0;for(j=1;j<Y.length;++j)switch(Y[j].charAt(0)){case"X":b=parseInt(Y[j].slice(1))-1,++B;break;case"Y":for(x=parseInt(Y[j].slice(1))-1,U=N.length;U<=x;++U)N[U]=[];break;case"M":R=parseInt(Y[j].slice(1))/20;break;case"F":break;case"G":break;case"P":F=_[parseInt(Y[j].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(W=Y[j].slice(1).split(" "),U=parseInt(W[0],10);U<=parseInt(W[1],10);++U)R=parseInt(W[2],10),E[U-1]=R===0?{hidden:!0}:{wch:R},Bu(E[U-1]);break;case"C":b=parseInt(Y[j].slice(1))-1,E[b]||(E[b]={});break;case"R":x=parseInt(Y[j].slice(1))-1,w[x]||(w[x]={}),R>0?(w[x].hpt=R,w[x].hpx=zh(R)):R===0&&(w[x].hidden=!0);break;default:if(p&&p.WTF)throw new Error("SYLK bad record "+T)}B<1&&(F=null);break;default:if(p&&p.WTF)throw new Error("SYLK bad record "+T)}}return w.length>0&&(I["!rows"]=w),E.length>0&&(I["!cols"]=E),p&&p.sheetRows&&(N=N.slice(0,p.sheetRows)),[N,I]}function l(m,p){var g=n(m,p),x=g[0],b=g[1],y=lA(x,p);return Da(b).forEach(function(j){y[j]=b[j]}),y}function o(m,p){return Lu(l(m,p),p)}function d(m,p,g,x){var b="C;Y"+(g+1)+";X"+(x+1)+";K";switch(m.t){case"n":b+=m.v||0,m.f&&!m.F&&(b+=";E"+LN(m.f,{r:g,c:x}));break;case"b":b+=m.v?"TRUE":"FALSE";break;case"e":b+=m.w||m.v;break;case"d":b+='"'+(m.w||m.v)+'"';break;case"s":b+='"'+m.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return b}function u(m,p){p.forEach(function(g,x){var b="F;W"+(x+1)+" "+(x+1)+" ";g.hidden?b+="0":(typeof g.width=="number"&&!g.wpx&&(g.wpx=Rf(g.width)),typeof g.wpx=="number"&&!g.wch&&(g.wch=Of(g.wpx)),typeof g.wch=="number"&&(b+=Math.round(g.wch))),b.charAt(b.length-1)!=" "&&m.push(b)})}function c(m,p){p.forEach(function(g,x){var b="F;";g.hidden?b+="M0;":g.hpt?b+="M"+20*g.hpt+";":g.hpx&&(b+="M"+20*Mf(g.hpx)+";"),b.length>2&&m.push(b+"R"+(x+1))})}function h(m,p){var g=["ID;PWXL;N;E"],x=[],b=Cr(m["!ref"]),y,j=Array.isArray(m),N=`\r
`;g.push("P;PGeneral"),g.push("F;P0;DG0G8;M255"),m["!cols"]&&u(g,m["!cols"]),m["!rows"]&&c(g,m["!rows"]),g.push("B;Y"+(b.e.r-b.s.r+1)+";X"+(b.e.c-b.s.c+1)+";D"+[b.s.c,b.s.r,b.e.c,b.e.r].join(" "));for(var _=b.s.r;_<=b.e.r;++_)for(var F=b.s.c;F<=b.e.c;++F){var I=Ks({r:_,c:F});y=j?(m[_]||[])[F]:m[I],!(!y||y.v==null&&(!y.f||y.F))&&x.push(d(y,m,_,F))}return g.join(N)+N+x.join(N)+N+"E"+N}return{to_workbook:o,to_sheet:l,from_sheet:h}})(),uB=(function(){function t(i,l){switch(l.type){case"base64":return s(Tl(i),l);case"binary":return s(i,l);case"buffer":return s(ur&&Buffer.isBuffer(i)?i.toString("binary"):Iu(i),l);case"array":return s(Em(i),l)}throw new Error("Unrecognized type "+l.type)}function s(i,l){for(var o=i.split(`
`),d=-1,u=-1,c=0,h=[];c!==o.length;++c){if(o[c].trim()==="BOT"){h[++d]=[],u=0;continue}if(!(d<0)){var m=o[c].trim().split(","),p=m[0],g=m[1];++c;for(var x=o[c]||"";(x.match(/["]/g)||[]).length&1&&c<o.length-1;)x+=`
`+o[++c];switch(x=x.trim(),+p){case-1:if(x==="BOT"){h[++d]=[],u=0;continue}else if(x!=="EOD")throw new Error("Unrecognized DIF special command "+x);break;case 0:x==="TRUE"?h[d][u]=!0:x==="FALSE"?h[d][u]=!1:isNaN(Vo(g))?isNaN(Gh(g).getDate())?h[d][u]=g:h[d][u]=ma(g):h[d][u]=Vo(g),++u;break;case 1:x=x.slice(1,x.length-1),x=x.replace(/""/g,'"'),x&&x.match(/^=".*"$/)&&(x=x.slice(2,-1)),h[d][u++]=x!==""?x:null;break}if(x==="EOD")break}}return l&&l.sheetRows&&(h=h.slice(0,l.sheetRows)),h}function r(i,l){return lA(t(i,l),l)}function a(i,l){return Lu(r(i,l),l)}var n=(function(){var i=function(d,u,c,h,m){d.push(u),d.push(c+","+h),d.push('"'+m.replace(/"/g,'""')+'"')},l=function(d,u,c,h){d.push(u+","+c),d.push(u==1?'"'+h.replace(/"/g,'""')+'"':h)};return function(d){var u=[],c=Cr(d["!ref"]),h,m=Array.isArray(d);i(u,"TABLE",0,1,"sheetjs"),i(u,"VECTORS",0,c.e.r-c.s.r+1,""),i(u,"TUPLES",0,c.e.c-c.s.c+1,""),i(u,"DATA",0,0,"");for(var p=c.s.r;p<=c.e.r;++p){l(u,-1,0,"BOT");for(var g=c.s.c;g<=c.e.c;++g){var x=Ks({r:p,c:g});if(h=m?(d[p]||[])[g]:d[x],!h){l(u,1,0,"");continue}switch(h.t){case"n":var b=h.w;!b&&h.v!=null&&(b=h.v),b==null?h.f&&!h.F?l(u,1,0,"="+h.f):l(u,1,0,""):l(u,0,b,"V");break;case"b":l(u,0,h.v?1:0,h.v?"TRUE":"FALSE");break;case"s":l(u,1,0,isNaN(h.v)?h.v:'="'+h.v+'"');break;case"d":h.w||(h.w=io(h.z||Vs[14],pn(ma(h.v)))),l(u,0,h.w,"V");break;default:l(u,1,0,"")}}}l(u,-1,0,"EOD");var y=`\r
`,j=u.join(y);return j}})();return{to_workbook:a,to_sheet:r,from_sheet:n}})(),mB=(function(){function t(h){return h.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function s(h){return h.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function r(h,m){for(var p=h.split(`
`),g=-1,x=-1,b=0,y=[];b!==p.length;++b){var j=p[b].trim().split(":");if(j[0]==="cell"){var N=wa(j[1]);if(y.length<=N.r)for(g=y.length;g<=N.r;++g)y[g]||(y[g]=[]);switch(g=N.r,x=N.c,j[2]){case"t":y[g][x]=t(j[3]);break;case"v":y[g][x]=+j[3];break;case"vtf":var _=j[j.length-1];case"vtc":switch(j[3]){case"nl":y[g][x]=!!+j[4];break;default:y[g][x]=+j[4];break}j[2]=="vtf"&&(y[g][x]=[y[g][x],_])}}}return m&&m.sheetRows&&(y=y.slice(0,m.sheetRows)),y}function a(h,m){return lA(r(h,m),m)}function n(h,m){return Lu(a(h,m),m)}var i=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),l=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,o=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),d="--SocialCalcSpreadsheetControlSave--";function u(h){if(!h||!h["!ref"])return"";for(var m=[],p=[],g,x="",b=ml(h["!ref"]),y=Array.isArray(h),j=b.s.r;j<=b.e.r;++j)for(var N=b.s.c;N<=b.e.c;++N)if(x=Ks({r:j,c:N}),g=y?(h[j]||[])[N]:h[x],!(!g||g.v==null||g.t==="z")){switch(p=["cell",x,"t"],g.t){case"s":case"str":p.push(s(g.v));break;case"n":g.f?(p[2]="vtf",p[3]="n",p[4]=g.v,p[5]=s(g.f)):(p[2]="v",p[3]=g.v);break;case"b":p[2]="vt"+(g.f?"f":"c"),p[3]="nl",p[4]=g.v?"1":"0",p[5]=s(g.f||(g.v?"TRUE":"FALSE"));break;case"d":var _=pn(ma(g.v));p[2]="vtc",p[3]="nd",p[4]=""+_,p[5]=g.w||io(g.z||Vs[14],_);break;case"e":continue}m.push(p.join(":"))}return m.push("sheet:c:"+(b.e.c-b.s.c+1)+":r:"+(b.e.r-b.s.r+1)+":tvf:1"),m.push("valueformat:1:text-wiki"),m.join(`
`)}function c(h){return[i,l,o,l,u(h),d].join(`
`)}return{to_workbook:n,to_sheet:a,from_sheet:c}})(),Kh=(function(){function t(c,h,m,p,g){g.raw?h[m][p]=c:c===""||(c==="TRUE"?h[m][p]=!0:c==="FALSE"?h[m][p]=!1:isNaN(Vo(c))?isNaN(Gh(c).getDate())?h[m][p]=c:h[m][p]=ma(c):h[m][p]=Vo(c))}function s(c,h){var m=h||{},p=[];if(!c||c.length===0)return p;for(var g=c.split(/[\r\n]/),x=g.length-1;x>=0&&g[x].length===0;)--x;for(var b=10,y=0,j=0;j<=x;++j)y=g[j].indexOf(" "),y==-1?y=g[j].length:y++,b=Math.max(b,y);for(j=0;j<=x;++j){p[j]=[];var N=0;for(t(g[j].slice(0,b).trim(),p,j,N,m),N=1;N<=(g[j].length-b)/10+1;++N)t(g[j].slice(b+(N-1)*10,b+N*10).trim(),p,j,N,m)}return m.sheetRows&&(p=p.slice(0,m.sheetRows)),p}var r={44:",",9:"	",59:";",124:"|"},a={44:3,9:2,59:1,124:0};function n(c){for(var h={},m=!1,p=0,g=0;p<c.length;++p)(g=c.charCodeAt(p))==34?m=!m:!m&&g in r&&(h[g]=(h[g]||0)+1);g=[];for(p in h)Object.prototype.hasOwnProperty.call(h,p)&&g.push([h[p],p]);if(!g.length){h=a;for(p in h)Object.prototype.hasOwnProperty.call(h,p)&&g.push([h[p],p])}return g.sort(function(x,b){return x[0]-b[0]||a[x[1]]-a[b[1]]}),r[g.pop()[1]]||44}function i(c,h){var m=h||{},p="",g=m.dense?[]:{},x={s:{c:0,r:0},e:{c:0,r:0}};c.slice(0,4)=="sep="?c.charCodeAt(5)==13&&c.charCodeAt(6)==10?(p=c.charAt(4),c=c.slice(7)):c.charCodeAt(5)==13||c.charCodeAt(5)==10?(p=c.charAt(4),c=c.slice(6)):p=n(c.slice(0,1024)):m&&m.FS?p=m.FS:p=n(c.slice(0,1024));var b=0,y=0,j=0,N=0,_=0,F=p.charCodeAt(0),I=!1,w=0,E=c.charCodeAt(0);c=c.replace(/\r\n/mg,`
`);var W=m.dateNF!=null?u9(m.dateNF):null;function R(){var U=c.slice(N,_),T={};if(U.charAt(0)=='"'&&U.charAt(U.length-1)=='"'&&(U=U.slice(1,-1).replace(/""/g,'"')),U.length===0)T.t="z";else if(m.raw)T.t="s",T.v=U;else if(U.trim().length===0)T.t="s",T.v=U;else if(U.charCodeAt(0)==61)U.charCodeAt(1)==34&&U.charCodeAt(U.length-1)==34?(T.t="s",T.v=U.slice(2,-1).replace(/""/g,'"')):MG(U)?(T.t="n",T.f=U.slice(1)):(T.t="s",T.v=U);else if(U=="TRUE")T.t="b",T.v=!0;else if(U=="FALSE")T.t="b",T.v=!1;else if(!isNaN(j=Vo(U)))T.t="n",m.cellText!==!1&&(T.w=U),T.v=j;else if(!isNaN(Gh(U).getDate())||W&&U.match(W)){T.z=m.dateNF||Vs[14];var Y=0;W&&U.match(W)&&(U=m9(U,m.dateNF,U.match(W)||[]),Y=1),m.cellDates?(T.t="d",T.v=ma(U,Y)):(T.t="n",T.v=pn(ma(U,Y))),m.cellText!==!1&&(T.w=io(T.z,T.v instanceof Date?pn(T.v):T.v)),m.cellNF||delete T.z}else T.t="s",T.v=U;if(T.t=="z"||(m.dense?(g[b]||(g[b]=[]),g[b][y]=T):g[Ks({c:y,r:b})]=T),N=_+1,E=c.charCodeAt(N),x.e.c<y&&(x.e.c=y),x.e.r<b&&(x.e.r=b),w==F)++y;else if(y=0,++b,m.sheetRows&&m.sheetRows<=b)return!0}e:for(;_<c.length;++_)switch(w=c.charCodeAt(_)){case 34:E===34&&(I=!I);break;case F:case 10:case 13:if(!I&&R())break e;break}return _-N>0&&R(),g["!ref"]=lr(x),g}function l(c,h){return!(h&&h.PRN)||h.FS||c.slice(0,4)=="sep="||c.indexOf("	")>=0||c.indexOf(",")>=0||c.indexOf(";")>=0?i(c,h):lA(s(c,h),h)}function o(c,h){var m="",p=h.type=="string"?[0,0,0,0]:HN(c,h);switch(h.type){case"base64":m=Tl(c);break;case"binary":m=c;break;case"buffer":h.codepage==65001?m=c.toString("utf8"):h.codepage&&typeof Bf<"u"||(m=ur&&Buffer.isBuffer(c)?c.toString("binary"):Iu(c));break;case"array":m=Em(c);break;case"string":m=c;break;default:throw new Error("Unrecognized type "+h.type)}return p[0]==239&&p[1]==187&&p[2]==191?m=Xr(m.slice(3)):h.type!="string"&&h.type!="buffer"&&h.codepage==65001?m=Xr(m):h.type=="binary"&&typeof Bf<"u",m.slice(0,19)=="socialcalc:version:"?mB.to_sheet(h.type=="string"?m:Xr(m),h):l(m,h)}function d(c,h){return Lu(o(c,h),h)}function u(c){for(var h=[],m=Cr(c["!ref"]),p,g=Array.isArray(c),x=m.s.r;x<=m.e.r;++x){for(var b=[],y=m.s.c;y<=m.e.c;++y){var j=Ks({r:x,c:y});if(p=g?(c[x]||[])[y]:c[j],!p||p.v==null){b.push("          ");continue}for(var N=(p.w||(bd(p),p.w)||"").slice(0,10);N.length<10;)N+=" ";b.push(N+(y===0?" ":""))}h.push(b.join(""))}return h.join(`
`)}return{to_workbook:d,to_sheet:o,from_sheet:u}})();function SV(t,s){var r=s||{},a=!!r.WTF;r.WTF=!0;try{var n=dB.to_workbook(t,r);return r.WTF=a,n}catch(i){if(r.WTF=a,!i.message.match(/SYLK bad record ID/)&&a)throw i;return Kh.to_workbook(t,s)}}var wm=(function(){function t(C,k,B){if(C){Gn(C,C.l||0);for(var G=B.Enum||V;C.l<C.length;){var O=C.read_shift(2),K=G[O]||G[65535],J=C.read_shift(2),te=C.l+J,se=K.f&&K.f(C,J,B);if(C.l=te,k(se,K,O))return}}}function s(C,k){switch(k.type){case"base64":return r(Sl(Tl(C)),k);case"binary":return r(Sl(C),k);case"buffer":case"array":return r(C,k)}throw"Unsupported type "+k.type}function r(C,k){if(!C)return C;var B=k||{},G=B.dense?[]:{},O="Sheet1",K="",J=0,te={},se=[],ae=[],ne={s:{r:0,c:0},e:{r:0,c:0}},ue=B.sheetRows||0;if(C[2]==0&&(C[3]==8||C[3]==9)&&C.length>=16&&C[14]==5&&C[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(C[2]==2)B.Enum=V,t(C,function(me,we,Ie){switch(Ie){case 0:B.vers=me,me>=4096&&(B.qpro=!0);break;case 6:ne=me;break;case 204:me&&(K=me);break;case 222:K=me;break;case 15:case 51:B.qpro||(me[1].v=me[1].v.slice(1));case 13:case 14:case 16:Ie==14&&(me[2]&112)==112&&(me[2]&15)>1&&(me[2]&15)<15&&(me[1].z=B.dateNF||Vs[14],B.cellDates&&(me[1].t="d",me[1].v=Ig(me[1].v))),B.qpro&&me[3]>J&&(G["!ref"]=lr(ne),te[O]=G,se.push(O),G=B.dense?[]:{},ne={s:{r:0,c:0},e:{r:0,c:0}},J=me[3],O=K||"Sheet"+(J+1),K="");var _e=B.dense?(G[me[0].r]||[])[me[0].c]:G[Ks(me[0])];if(_e){_e.t=me[1].t,_e.v=me[1].v,me[1].z!=null&&(_e.z=me[1].z),me[1].f!=null&&(_e.f=me[1].f);break}B.dense?(G[me[0].r]||(G[me[0].r]=[]),G[me[0].r][me[0].c]=me[1]):G[Ks(me[0])]=me[1];break}},B);else if(C[2]==26||C[2]==14)B.Enum=P,C[2]==14&&(B.qpro=!0,C.l=0),t(C,function(me,we,Ie){switch(Ie){case 204:O=me;break;case 22:me[1].v=me[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(me[3]>J&&(G["!ref"]=lr(ne),te[O]=G,se.push(O),G=B.dense?[]:{},ne={s:{r:0,c:0},e:{r:0,c:0}},J=me[3],O="Sheet"+(J+1)),ue>0&&me[0].r>=ue)break;B.dense?(G[me[0].r]||(G[me[0].r]=[]),G[me[0].r][me[0].c]=me[1]):G[Ks(me[0])]=me[1],ne.e.c<me[0].c&&(ne.e.c=me[0].c),ne.e.r<me[0].r&&(ne.e.r=me[0].r);break;case 27:me[14e3]&&(ae[me[14e3][0]]=me[14e3][1]);break;case 1537:ae[me[0]]=me[1],me[0]==J&&(O=me[1]);break}},B);else throw new Error("Unrecognized LOTUS BOF "+C[2]);if(G["!ref"]=lr(ne),te[K||O]=G,se.push(K||O),!ae.length)return{SheetNames:se,Sheets:te};for(var oe={},le=[],X=0;X<ae.length;++X)te[se[X]]?(le.push(ae[X]||se[X]),oe[ae[X]]=te[ae[X]]||te[se[X]]):(le.push(ae[X]),oe[ae[X]]={"!ref":"A1"});return{SheetNames:le,Sheets:oe}}function a(C,k){var B=k||{};if(+B.codepage>=0&&qo(+B.codepage),B.type=="string")throw new Error("Cannot write WK1 to JS string");var G=ul(),O=Cr(C["!ref"]),K=Array.isArray(C),J=[];vs(G,0,i(1030)),vs(G,6,d(O));for(var te=Math.min(O.e.r,8191),se=O.s.r;se<=te;++se)for(var ae=za(se),ne=O.s.c;ne<=O.e.c;++ne){se===O.s.r&&(J[ne]=Na(ne));var ue=J[ne]+ae,oe=K?(C[se]||[])[ne]:C[ue];if(!(!oe||oe.t=="z"))if(oe.t=="n")(oe.v|0)==oe.v&&oe.v>=-32768&&oe.v<=32767?vs(G,13,p(se,ne,oe.v)):vs(G,14,x(se,ne,oe.v));else{var le=bd(oe);vs(G,15,h(se,ne,le.slice(0,239)))}}return vs(G,1),G.end()}function n(C,k){var B=k||{};if(+B.codepage>=0&&qo(+B.codepage),B.type=="string")throw new Error("Cannot write WK3 to JS string");var G=ul();vs(G,0,l(C));for(var O=0,K=0;O<C.SheetNames.length;++O)(C.Sheets[C.SheetNames[O]]||{})["!ref"]&&vs(G,27,L(C.SheetNames[O],K++));var J=0;for(O=0;O<C.SheetNames.length;++O){var te=C.Sheets[C.SheetNames[O]];if(!(!te||!te["!ref"])){for(var se=Cr(te["!ref"]),ae=Array.isArray(te),ne=[],ue=Math.min(se.e.r,8191),oe=se.s.r;oe<=ue;++oe)for(var le=za(oe),X=se.s.c;X<=se.e.c;++X){oe===se.s.r&&(ne[X]=Na(X));var me=ne[X]+le,we=ae?(te[oe]||[])[X]:te[me];if(!(!we||we.t=="z"))if(we.t=="n")vs(G,23,R(oe,X,J,we.v));else{var Ie=bd(we);vs(G,22,w(oe,X,J,Ie.slice(0,239)))}}++J}}return vs(G,1),G.end()}function i(C){var k=Zt(2);return k.write_shift(2,C),k}function l(C){var k=Zt(26);k.write_shift(2,4096),k.write_shift(2,4),k.write_shift(4,0);for(var B=0,G=0,O=0,K=0;K<C.SheetNames.length;++K){var J=C.SheetNames[K],te=C.Sheets[J];if(!(!te||!te["!ref"])){++O;var se=ml(te["!ref"]);B<se.e.r&&(B=se.e.r),G<se.e.c&&(G=se.e.c)}}return B>8191&&(B=8191),k.write_shift(2,B),k.write_shift(1,O),k.write_shift(1,G),k.write_shift(2,0),k.write_shift(2,0),k.write_shift(1,1),k.write_shift(1,2),k.write_shift(4,0),k.write_shift(4,0),k}function o(C,k,B){var G={s:{c:0,r:0},e:{c:0,r:0}};return k==8&&B.qpro?(G.s.c=C.read_shift(1),C.l++,G.s.r=C.read_shift(2),G.e.c=C.read_shift(1),C.l++,G.e.r=C.read_shift(2),G):(G.s.c=C.read_shift(2),G.s.r=C.read_shift(2),k==12&&B.qpro&&(C.l+=2),G.e.c=C.read_shift(2),G.e.r=C.read_shift(2),k==12&&B.qpro&&(C.l+=2),G.s.c==65535&&(G.s.c=G.e.c=G.s.r=G.e.r=0),G)}function d(C){var k=Zt(8);return k.write_shift(2,C.s.c),k.write_shift(2,C.s.r),k.write_shift(2,C.e.c),k.write_shift(2,C.e.r),k}function u(C,k,B){var G=[{c:0,r:0},{t:"n",v:0},0,0];return B.qpro&&B.vers!=20768?(G[0].c=C.read_shift(1),G[3]=C.read_shift(1),G[0].r=C.read_shift(2),C.l+=2):(G[2]=C.read_shift(1),G[0].c=C.read_shift(2),G[0].r=C.read_shift(2)),G}function c(C,k,B){var G=C.l+k,O=u(C,k,B);if(O[1].t="s",B.vers==20768){C.l++;var K=C.read_shift(1);return O[1].v=C.read_shift(K,"utf8"),O}return B.qpro&&C.l++,O[1].v=C.read_shift(G-C.l,"cstr"),O}function h(C,k,B){var G=Zt(7+B.length);G.write_shift(1,255),G.write_shift(2,k),G.write_shift(2,C),G.write_shift(1,39);for(var O=0;O<G.length;++O){var K=B.charCodeAt(O);G.write_shift(1,K>=128?95:K)}return G.write_shift(1,0),G}function m(C,k,B){var G=u(C,k,B);return G[1].v=C.read_shift(2,"i"),G}function p(C,k,B){var G=Zt(7);return G.write_shift(1,255),G.write_shift(2,k),G.write_shift(2,C),G.write_shift(2,B,"i"),G}function g(C,k,B){var G=u(C,k,B);return G[1].v=C.read_shift(8,"f"),G}function x(C,k,B){var G=Zt(13);return G.write_shift(1,255),G.write_shift(2,k),G.write_shift(2,C),G.write_shift(8,B,"f"),G}function b(C,k,B){var G=C.l+k,O=u(C,k,B);if(O[1].v=C.read_shift(8,"f"),B.qpro)C.l=G;else{var K=C.read_shift(2);_(C.slice(C.l,C.l+K),O),C.l+=K}return O}function y(C,k,B){var G=k&32768;return k&=-32769,k=(G?C:0)+(k>=8192?k-16384:k),(G?"":"$")+(B?Na(k):za(k))}var j={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},N=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function _(C,k){Gn(C,0);for(var B=[],G=0,O="",K="",J="",te="";C.l<C.length;){var se=C[C.l++];switch(se){case 0:B.push(C.read_shift(8,"f"));break;case 1:K=y(k[0].c,C.read_shift(2),!0),O=y(k[0].r,C.read_shift(2),!1),B.push(K+O);break;case 2:{var ae=y(k[0].c,C.read_shift(2),!0),ne=y(k[0].r,C.read_shift(2),!1);K=y(k[0].c,C.read_shift(2),!0),O=y(k[0].r,C.read_shift(2),!1),B.push(ae+ne+":"+K+O)}break;case 3:if(C.l<C.length){console.error("WK1 premature formula end");return}break;case 4:B.push("("+B.pop()+")");break;case 5:B.push(C.read_shift(2));break;case 6:{for(var ue="";se=C[C.l++];)ue+=String.fromCharCode(se);B.push('"'+ue.replace(/"/g,'""')+'"')}break;case 8:B.push("-"+B.pop());break;case 23:B.push("+"+B.pop());break;case 22:B.push("NOT("+B.pop()+")");break;case 20:case 21:te=B.pop(),J=B.pop(),B.push(["AND","OR"][se-20]+"("+J+","+te+")");break;default:if(se<32&&N[se])te=B.pop(),J=B.pop(),B.push(J+N[se]+te);else if(j[se]){if(G=j[se][1],G==69&&(G=C[C.l++]),G>B.length){console.error("WK1 bad formula parse 0x"+se.toString(16)+":|"+B.join("|")+"|");return}var oe=B.slice(-G);B.length-=G,B.push(j[se][0]+"("+oe.join(",")+")")}else return se<=7?console.error("WK1 invalid opcode "+se.toString(16)):se<=24?console.error("WK1 unsupported op "+se.toString(16)):se<=30?console.error("WK1 invalid opcode "+se.toString(16)):se<=115?console.error("WK1 unsupported function opcode "+se.toString(16)):console.error("WK1 unrecognized opcode "+se.toString(16))}}B.length==1?k[1].f=""+B[0]:console.error("WK1 bad formula parse |"+B.join("|")+"|")}function F(C){var k=[{c:0,r:0},{t:"n",v:0},0];return k[0].r=C.read_shift(2),k[3]=C[C.l++],k[0].c=C[C.l++],k}function I(C,k){var B=F(C);return B[1].t="s",B[1].v=C.read_shift(k-4,"cstr"),B}function w(C,k,B,G){var O=Zt(6+G.length);O.write_shift(2,C),O.write_shift(1,B),O.write_shift(1,k),O.write_shift(1,39);for(var K=0;K<G.length;++K){var J=G.charCodeAt(K);O.write_shift(1,J>=128?95:J)}return O.write_shift(1,0),O}function E(C,k){var B=F(C);B[1].v=C.read_shift(2);var G=B[1].v>>1;if(B[1].v&1)switch(G&7){case 0:G=(G>>3)*5e3;break;case 1:G=(G>>3)*500;break;case 2:G=(G>>3)/20;break;case 3:G=(G>>3)/200;break;case 4:G=(G>>3)/2e3;break;case 5:G=(G>>3)/2e4;break;case 6:G=(G>>3)/16;break;case 7:G=(G>>3)/64;break}return B[1].v=G,B}function W(C,k){var B=F(C),G=C.read_shift(4),O=C.read_shift(4),K=C.read_shift(2);if(K==65535)return G===0&&O===3221225472?(B[1].t="e",B[1].v=15):G===0&&O===3489660928?(B[1].t="e",B[1].v=42):B[1].v=0,B;var J=K&32768;return K=(K&32767)-16446,B[1].v=(1-J*2)*(O*Math.pow(2,K+32)+G*Math.pow(2,K)),B}function R(C,k,B,G){var O=Zt(14);if(O.write_shift(2,C),O.write_shift(1,B),O.write_shift(1,k),G==0)return O.write_shift(4,0),O.write_shift(4,0),O.write_shift(2,65535),O;var K=0,J=0,te=0,se=0;return G<0&&(K=1,G=-G),J=Math.log2(G)|0,G/=Math.pow(2,J-31),se=G>>>0,(se&2147483648)==0&&(G/=2,++J,se=G>>>0),G-=se,se|=2147483648,se>>>=0,G*=Math.pow(2,32),te=G>>>0,O.write_shift(4,te),O.write_shift(4,se),J+=16383+(K?32768:0),O.write_shift(2,J),O}function U(C,k){var B=W(C);return C.l+=k-14,B}function T(C,k){var B=F(C),G=C.read_shift(4);return B[1].v=G>>6,B}function Y(C,k){var B=F(C),G=C.read_shift(8,"f");return B[1].v=G,B}function H(C,k){var B=Y(C);return C.l+=k-10,B}function M(C,k){return C[C.l+k-1]==0?C.read_shift(k,"cstr"):""}function q(C,k){var B=C[C.l++];B>k-1&&(B=k-1);for(var G="";G.length<B;)G+=String.fromCharCode(C[C.l++]);return G}function z(C,k,B){if(!(!B.qpro||k<21)){var G=C.read_shift(1);C.l+=17,C.l+=1,C.l+=2;var O=C.read_shift(k-21,"cstr");return[G,O]}}function Q(C,k){for(var B={},G=C.l+k;C.l<G;){var O=C.read_shift(2);if(O==14e3){for(B[O]=[0,""],B[O][0]=C.read_shift(2);C[C.l];)B[O][1]+=String.fromCharCode(C[C.l]),C.l++;C.l++}}return B}function L(C,k){var B=Zt(5+C.length);B.write_shift(2,14e3),B.write_shift(2,k);for(var G=0;G<C.length;++G){var O=C.charCodeAt(G);B[B.l++]=O>127?95:O}return B[B.l++]=0,B}var V={0:{n:"BOF",f:nn},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:o},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:m},14:{n:"NUMBER",f:g},15:{n:"LABEL",f:c},16:{n:"FORMULA",f:b},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:c},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:M},222:{n:"SHEETNAMELP",f:q},65535:{n:""}},P={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:I},23:{n:"NUMBER17",f:W},24:{n:"NUMBER18",f:E},25:{n:"FORMULA19",f:U},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:Q},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:T},38:{n:"??"},39:{n:"NUMBER27",f:Y},40:{n:"FORMULA28",f:H},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:M},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:z},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:a,book_to_wk3:n,to_workbook:s}})();function CV(t){var s={},r=t.match(Si),a=0,n=!1;if(r)for(;a!=r.length;++a){var i=Ys(r[a]);switch(i[0].replace(/\w*:/g,"")){case"<condense":break;case"<extend":break;case"<shadow":if(!i.val)break;case"<shadow>":case"<shadow/>":s.shadow=1;break;case"</shadow>":break;case"<charset":if(i.val=="1")break;s.cp=nN[parseInt(i.val,10)];break;case"<outline":if(!i.val)break;case"<outline>":case"<outline/>":s.outline=1;break;case"</outline>":break;case"<rFont":s.name=i.val;break;case"<sz":s.sz=i.val;break;case"<strike":if(!i.val)break;case"<strike>":case"<strike/>":s.strike=1;break;case"</strike>":break;case"<u":if(!i.val)break;switch(i.val){case"double":s.uval="double";break;case"singleAccounting":s.uval="single-accounting";break;case"doubleAccounting":s.uval="double-accounting";break}case"<u>":case"<u/>":s.u=1;break;case"</u>":break;case"<b":if(i.val=="0")break;case"<b>":case"<b/>":s.b=1;break;case"</b>":break;case"<i":if(i.val=="0")break;case"<i>":case"<i/>":s.i=1;break;case"</i>":break;case"<color":i.rgb&&(s.color=i.rgb.slice(2,8));break;case"<color>":case"<color/>":case"</color>":break;case"<family":s.family=i.val;break;case"<family>":case"<family/>":case"</family>":break;case"<vertAlign":s.valign=i.val;break;case"<vertAlign>":case"<vertAlign/>":case"</vertAlign>":break;case"<scheme":break;case"<scheme>":case"<scheme/>":case"</scheme>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":n=!0;break;case"</ext>":n=!1;break;default:if(i[0].charCodeAt(1)!==47&&!n)throw new Error("Unrecognized rich format "+i[0])}}return s}var kV=(function(){var t=If("t"),s=If("rPr");function r(i){var l=i.match(t);if(!l)return{t:"s",v:""};var o={t:"s",v:Sr(l[1])},d=i.match(s);return d&&(o.s=CV(d[1])),o}var a=/<(?:\w+:)?r>/g,n=/<\/(?:\w+:)?r>/;return function(l){return l.replace(a,"").split(n).map(r).filter(function(o){return o.v})}})(),EV=(function(){var s=/(\r\n|\n)/g;function r(n,i,l){var o=[];n.u&&o.push("text-decoration: underline;"),n.uval&&o.push("text-underline-style:"+n.uval+";"),n.sz&&o.push("font-size:"+n.sz+"pt;"),n.outline&&o.push("text-effect: outline;"),n.shadow&&o.push("text-shadow: auto;"),i.push('<span style="'+o.join("")+'">'),n.b&&(i.push("<b>"),l.push("</b>")),n.i&&(i.push("<i>"),l.push("</i>")),n.strike&&(i.push("<s>"),l.push("</s>"));var d=n.valign||"";return d=="superscript"||d=="super"?d="sup":d=="subscript"&&(d="sub"),d!=""&&(i.push("<"+d+">"),l.push("</"+d+">")),l.push("</span>"),n}function a(n){var i=[[],n.v,[]];return n.v?(n.s&&r(n.s,i[0],i[2]),i[0].join("")+i[1].replace(s,"<br/>")+i[2].join("")):""}return function(i){return i.map(a).join("")}})(),BV=/<(?:\w+:)?t[^>]*>([^<]*)<\/(?:\w+:)?t>/g,FV=/<(?:\w+:)?r>/,TV=/<(?:\w+:)?rPh.*?>([\s\S]*?)<\/(?:\w+:)?rPh>/g;function EN(t,s){var r=s?s.cellHTML:!0,a={};return t?(t.match(/^\s*<(?:\w+:)?t[^>]*>/)?(a.t=Sr(Xr(t.slice(t.indexOf(">")+1).split(/<\/(?:\w+:)?t>/)[0]||"")),a.r=Xr(t),r&&(a.h=fN(a.t))):t.match(FV)&&(a.r=Xr(t),a.t=Sr(Xr((t.replace(TV,"").match(BV)||[]).join("").replace(Si,""))),r&&(a.h=EV(kV(a.r)))),a):{t:""}}var IV=/<(?:\w+:)?sst([^>]*)>([\s\S]*)<\/(?:\w+:)?sst>/,LV=/<(?:\w+:)?(?:si|sstItem)>/g,DV=/<\/(?:\w+:)?(?:si|sstItem)>/;function PV(t,s){var r=[],a="";if(!t)return r;var n=t.match(IV);if(n){a=n[2].replace(LV,"").split(DV);for(var i=0;i!=a.length;++i){var l=EN(a[i].trim(),s);l!=null&&(r[r.length]=l)}n=Ys(n[1]),r.Count=n.count,r.Unique=n.uniqueCount}return r}var UV=/^\s|\s$|[\t\n\r]/;function hB(t,s){if(!s.bookSST)return"";var r=[Xa];r[r.length]=gs("sst",null,{xmlns:Dm[0],count:t.Count,uniqueCount:t.Unique});for(var a=0;a!=t.length;++a)if(t[a]!=null){var n=t[a],i="<si>";n.r?i+=n.r:(i+="<t",n.t||(n.t=""),n.t.match(UV)&&(i+=' xml:space="preserve"'),i+=">"+Gr(n.t)+"</t>"),i+="</si>",r[r.length]=i}return r.length>2&&(r[r.length]="</sst>",r[1]=r[1].replace("/>",">")),r.join("")}function RV(t){return[t.read_shift(4),t.read_shift(4)]}function OV(t,s){var r=[],a=!1;return wd(t,function(i,l,o){switch(o){case 159:r.Count=i[0],r.Unique=i[1];break;case 19:r.push(i);break;case 160:return!0;case 35:a=!0;break;case 36:a=!1;break;default:if(l.T,!a||s.WTF)throw new Error("Unexpected record 0x"+o.toString(16))}}),r}function MV(t,s){return s||(s=Zt(8)),s.write_shift(4,t.Count),s.write_shift(4,t.Unique),s}var QV=X9;function HV(t){var s=ul();ls(s,159,MV(t));for(var r=0;r<t.length;++r)ls(s,19,QV(t[r]));return ls(s,160),s.end()}function AB(t){for(var s=[],r=t.split(""),a=0;a<r.length;++a)s[a]=r[a].charCodeAt(0);return s}function pd(t,s){var r={};return r.Major=t.read_shift(2),r.Minor=t.read_shift(2),s>=4&&(t.l+=s-4),r}function qV(t){var s={};return s.id=t.read_shift(0,"lpp4"),s.R=pd(t,4),s.U=pd(t,4),s.W=pd(t,4),s}function $V(t){for(var s=t.read_shift(4),r=t.l+s-4,a={},n=t.read_shift(4),i=[];n-- >0;)i.push({t:t.read_shift(4),v:t.read_shift(0,"lpp4")});if(a.name=t.read_shift(0,"lpp4"),a.comps=i,t.l!=r)throw new Error("Bad DataSpaceMapEntry: "+t.l+" != "+r);return a}function VV(t){var s=[];t.l+=4;for(var r=t.read_shift(4);r-- >0;)s.push($V(t));return s}function WV(t){var s=[];t.l+=4;for(var r=t.read_shift(4);r-- >0;)s.push(t.read_shift(0,"lpp4"));return s}function GV(t){var s={};return t.read_shift(4),t.l+=4,s.id=t.read_shift(0,"lpp4"),s.name=t.read_shift(0,"lpp4"),s.R=pd(t,4),s.U=pd(t,4),s.W=pd(t,4),s}function KV(t){var s=GV(t);if(s.ename=t.read_shift(0,"8lpp4"),s.blksz=t.read_shift(4),s.cmode=t.read_shift(4),t.read_shift(4)!=4)throw new Error("Bad !Primary record");return s}function fB(t,s){var r=t.l+s,a={};a.Flags=t.read_shift(4)&63,t.l+=4,a.AlgID=t.read_shift(4);var n=!1;switch(a.AlgID){case 26126:case 26127:case 26128:n=a.Flags==36;break;case 26625:n=a.Flags==4;break;case 0:n=a.Flags==16||a.Flags==4||a.Flags==36;break;default:throw"Unrecognized encryption algorithm: "+a.AlgID}if(!n)throw new Error("Encryption Flags/AlgID mismatch");return a.AlgIDHash=t.read_shift(4),a.KeySize=t.read_shift(4),a.ProviderType=t.read_shift(4),t.l+=8,a.CSPName=t.read_shift(r-t.l>>1,"utf16le"),t.l=r,a}function pB(t,s){var r={},a=t.l+s;return t.l+=4,r.Salt=t.slice(t.l,t.l+16),t.l+=16,r.Verifier=t.slice(t.l,t.l+16),t.l+=16,t.read_shift(4),r.VerifierHash=t.slice(t.l,a),t.l=a,r}function zV(t){var s=pd(t);switch(s.Minor){case 2:return[s.Minor,YV(t)];case 3:return[s.Minor,XV()];case 4:return[s.Minor,JV(t)]}throw new Error("ECMA-376 Encrypted file unrecognized Version: "+s.Minor)}function YV(t){var s=t.read_shift(4);if((s&63)!=36)throw new Error("EncryptionInfo mismatch");var r=t.read_shift(4),a=fB(t,r),n=pB(t,t.length-t.l);return{t:"Std",h:a,v:n}}function XV(){throw new Error("File is password-protected: ECMA-376 Extensible")}function JV(t){var s=["saltSize","blockSize","keyBits","hashSize","cipherAlgorithm","cipherChaining","hashAlgorithm","saltValue"];t.l+=4;var r=t.read_shift(t.length-t.l,"utf8"),a={};return r.replace(Si,function(i){var l=Ys(i);switch(Lc(l[0])){case"<?xml":break;case"<encryption":case"</encryption>":break;case"<keyData":s.forEach(function(o){a[o]=l[o]});break;case"<dataIntegrity":a.encryptedHmacKey=l.encryptedHmacKey,a.encryptedHmacValue=l.encryptedHmacValue;break;case"<keyEncryptors>":case"<keyEncryptors":a.encs=[];break;case"</keyEncryptors>":break;case"<keyEncryptor":a.uri=l.uri;break;case"</keyEncryptor>":break;case"<encryptedKey":a.encs.push(l);break;default:throw l[0]}}),a}function ZV(t,s){var r={},a=r.EncryptionVersionInfo=pd(t,4);if(s-=4,a.Minor!=2)throw new Error("unrecognized minor version code: "+a.Minor);if(a.Major>4||a.Major<2)throw new Error("unrecognized major version code: "+a.Major);r.Flags=t.read_shift(4),s-=4;var n=t.read_shift(4);return s-=4,r.EncryptionHeader=fB(t,n),s-=n,r.EncryptionVerifier=pB(t,s),r}function eW(t){var s={},r=s.EncryptionVersionInfo=pd(t,4);if(r.Major!=1||r.Minor!=1)throw"unrecognized version code "+r.Major+" : "+r.Minor;return s.Salt=t.read_shift(16),s.EncryptedVerifier=t.read_shift(16),s.EncryptedVerifierHash=t.read_shift(16),s}function BN(t){var s=0,r,a=AB(t),n=a.length+1,i,l,o,d,u;for(r=Eu(n),r[0]=a.length,i=1;i!=n;++i)r[i]=a[i-1];for(i=n-1;i>=0;--i)l=r[i],o=(s&16384)===0?0:1,d=s<<1&32767,u=o|d,s=u^l;return s^52811}var xB=(function(){var t=[187,255,255,186,255,255,185,128,0,190,15,0,191,15,0],s=[57840,7439,52380,33984,4364,3600,61902,12606,6258,57657,54287,34041,10252,43370,20163],r=[44796,19929,39858,10053,20106,40212,10761,31585,63170,64933,60267,50935,40399,11199,17763,35526,1453,2906,5812,11624,23248,885,1770,3540,7080,14160,28320,56640,55369,41139,20807,41614,21821,43642,17621,28485,56970,44341,19019,38038,14605,29210,60195,50791,40175,10751,21502,43004,24537,18387,36774,3949,7898,15796,31592,63184,47201,24803,49606,37805,14203,28406,56812,17824,35648,1697,3394,6788,13576,27152,43601,17539,35078,557,1114,2228,4456,30388,60776,51953,34243,7079,14158,28316,14128,28256,56512,43425,17251,34502,7597,13105,26210,52420,35241,883,1766,3532,4129,8258,16516,33032,4657,9314,18628],a=function(l){return(l/2|l*128)&255},n=function(l,o){return a(l^o)},i=function(l){for(var o=s[l.length-1],d=104,u=l.length-1;u>=0;--u)for(var c=l[u],h=0;h!=7;++h)c&64&&(o^=r[d]),c*=2,--d;return o};return function(l){for(var o=AB(l),d=i(o),u=o.length,c=Eu(16),h=0;h!=16;++h)c[h]=0;var m,p,g;for((u&1)===1&&(m=d>>8,c[u]=n(t[0],m),--u,m=d&255,p=o[o.length-1],c[u]=n(p,m));u>0;)--u,m=d>>8,c[u]=n(o[u],m),--u,m=d&255,c[u]=n(o[u],m);for(u=15,g=15-o.length;g>0;)m=d>>8,c[u]=n(t[g],m),--u,--g,m=d&255,c[u]=n(o[u],m),--u,--g;return c}})(),tW=function(t,s,r,a,n){n||(n=s),a||(a=xB(t));var i,l;for(i=0;i!=s.length;++i)l=s[i],l^=a[r],l=(l>>5|l<<3)&255,n[i]=l,++r;return[n,r,a]},sW=function(t){var s=0,r=xB(t);return function(a){var n=tW("",a,s,r);return s=n[1],n[0]}};function rW(t,s,r,a){var n={key:nn(t),verificationBytes:nn(t)};return r.password&&(n.verifier=BN(r.password)),a.valid=n.verificationBytes===n.verifier,a.valid&&(a.insitu=sW(r.password)),n}function aW(t,s,r){var a=r||{};return a.Info=t.read_shift(2),t.l-=2,a.Info===1?a.Data=eW(t):a.Data=ZV(t,s),a}function nW(t,s,r){var a={Type:r.biff>=8?t.read_shift(2):0};return a.Type?aW(t,s-2,a):rW(t,r.biff>=8?s:s-2,r,a),a}var gB=(function(){function t(n,i){switch(i.type){case"base64":return s(Tl(n),i);case"binary":return s(n,i);case"buffer":return s(ur&&Buffer.isBuffer(n)?n.toString("binary"):Iu(n),i);case"array":return s(Em(n),i)}throw new Error("Unrecognized type "+i.type)}function s(n,i){var l=i||{},o=l.dense?[]:{},d=n.match(/\\trowd.*?\\row\b/g);if(!d.length)throw new Error("RTF missing table");var u={s:{c:0,r:0},e:{c:0,r:d.length-1}};return d.forEach(function(c,h){Array.isArray(o)&&(o[h]=[]);for(var m=/\\\w+\b/g,p=0,g,x=-1;g=m.exec(c);){switch(g[0]){case"\\cell":var b=c.slice(p,m.lastIndex-g[0].length);if(b[0]==" "&&(b=b.slice(1)),++x,b.length){var y={v:b,t:"s"};Array.isArray(o)?o[h][x]=y:o[Ks({r:h,c:x})]=y}break}p=m.lastIndex}x>u.e.c&&(u.e.c=x)}),o["!ref"]=lr(u),o}function r(n,i){return Lu(t(n,i),i)}function a(n){for(var i=["{\\rtf1\\ansi"],l=Cr(n["!ref"]),o,d=Array.isArray(n),u=l.s.r;u<=l.e.r;++u){i.push("\\trowd\\trautofit1");for(var c=l.s.c;c<=l.e.c;++c)i.push("\\cellx"+(c+1));for(i.push("\\pard\\intbl"),c=l.s.c;c<=l.e.c;++c){var h=Ks({r:u,c});o=d?(n[u]||[])[c]:n[h],!(!o||o.v==null&&(!o.f||o.F))&&(i.push(" "+(o.w||(bd(o),o.w))),i.push("\\cell"))}i.push("\\pard\\intbl\\row")}return i.join("")+"}"}return{to_workbook:r,to_sheet:t,from_sheet:a}})();function iW(t){var s=t.slice(t[0]==="#"?1:0).slice(0,6);return[parseInt(s.slice(0,2),16),parseInt(s.slice(2,4),16),parseInt(s.slice(4,6),16)]}function Uf(t){for(var s=0,r=1;s!=3;++s)r=r*256+(t[s]>255?255:t[s]<0?0:t[s]);return r.toString(16).toUpperCase().slice(1)}function lW(t){var s=t[0]/255,r=t[1]/255,a=t[2]/255,n=Math.max(s,r,a),i=Math.min(s,r,a),l=n-i;if(l===0)return[0,0,s];var o=0,d=0,u=n+i;switch(d=l/(u>1?2-u:u),n){case s:o=((r-a)/l+6)%6;break;case r:o=(a-s)/l+2;break;case a:o=(s-r)/l+4;break}return[o/6,d,u/2]}function oW(t){var s=t[0],r=t[1],a=t[2],n=r*2*(a<.5?a:1-a),i=a-n/2,l=[i,i,i],o=6*s,d;if(r!==0)switch(o|0){case 0:case 6:d=n*o,l[0]+=n,l[1]+=d;break;case 1:d=n*(2-o),l[0]+=d,l[1]+=n;break;case 2:d=n*(o-2),l[1]+=n,l[2]+=d;break;case 3:d=n*(4-o),l[1]+=d,l[2]+=n;break;case 4:d=n*(o-4),l[2]+=n,l[0]+=d;break;case 5:d=n*(6-o),l[2]+=d,l[0]+=n;break}for(var u=0;u!=3;++u)l[u]=Math.round(l[u]*255);return l}function V0(t,s){if(s===0)return t;var r=lW(iW(t));return s<0?r[2]=r[2]*(1+s):r[2]=1-(1-r[2])*(1-s),Uf(oW(r))}var vB=6,cW=15,dW=1,vi=vB;function Rf(t){return Math.floor((t+Math.round(128/vi)/256)*vi)}function Of(t){return Math.floor((t-5)/vi*100+.5)/100}function W0(t){return Math.round((t*vi+5)/vi*256)/256}function Pb(t){return W0(Of(Rf(t)))}function FN(t){var s=Math.abs(t-Pb(t)),r=vi;if(s>.005)for(vi=dW;vi<cW;++vi)Math.abs(t-Pb(t))<=s&&(s=Math.abs(t-Pb(t)),r=vi);vi=r}function Bu(t){t.width?(t.wpx=Rf(t.width),t.wch=Of(t.wpx),t.MDW=vi):t.wpx?(t.wch=Of(t.wpx),t.width=W0(t.wch),t.MDW=vi):typeof t.wch=="number"&&(t.width=W0(t.wch),t.wpx=Rf(t.width),t.MDW=vi),t.customWidth&&delete t.customWidth}var uW=96,bB=uW;function Mf(t){return t*96/bB}function zh(t){return t*bB/96}var mW={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinHorzCross:"lightGrid"};function hW(t,s,r,a){s.Borders=[];var n={},i=!1;(t[0].match(Si)||[]).forEach(function(l){var o=Ys(l);switch(Lc(o[0])){case"<borders":case"<borders>":case"</borders>":break;case"<border":case"<border>":case"<border/>":n={},o.diagonalUp&&(n.diagonalUp=da(o.diagonalUp)),o.diagonalDown&&(n.diagonalDown=da(o.diagonalDown)),s.Borders.push(n);break;case"</border>":break;case"<left/>":break;case"<left":case"<left>":break;case"</left>":break;case"<right/>":break;case"<right":case"<right>":break;case"</right>":break;case"<top/>":break;case"<top":case"<top>":break;case"</top>":break;case"<bottom/>":break;case"<bottom":case"<bottom>":break;case"</bottom>":break;case"<diagonal":case"<diagonal>":case"<diagonal/>":break;case"</diagonal>":break;case"<horizontal":case"<horizontal>":case"<horizontal/>":break;case"</horizontal>":break;case"<vertical":case"<vertical>":case"<vertical/>":break;case"</vertical>":break;case"<start":case"<start>":case"<start/>":break;case"</start>":break;case"<end":case"<end>":case"<end/>":break;case"</end>":break;case"<color":case"<color>":break;case"<color/>":case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;default:if(a&&a.WTF&&!i)throw new Error("unrecognized "+o[0]+" in borders")}})}function AW(t,s,r,a){s.Fills=[];var n={},i=!1;(t[0].match(Si)||[]).forEach(function(l){var o=Ys(l);switch(Lc(o[0])){case"<fills":case"<fills>":case"</fills>":break;case"<fill>":case"<fill":case"<fill/>":n={},s.Fills.push(n);break;case"</fill>":break;case"<gradientFill>":break;case"<gradientFill":case"</gradientFill>":s.Fills.push(n),n={};break;case"<patternFill":case"<patternFill>":o.patternType&&(n.patternType=o.patternType);break;case"<patternFill/>":case"</patternFill>":break;case"<bgColor":n.bgColor||(n.bgColor={}),o.indexed&&(n.bgColor.indexed=parseInt(o.indexed,10)),o.theme&&(n.bgColor.theme=parseInt(o.theme,10)),o.tint&&(n.bgColor.tint=parseFloat(o.tint)),o.rgb&&(n.bgColor.rgb=o.rgb.slice(-6));break;case"<bgColor/>":case"</bgColor>":break;case"<fgColor":n.fgColor||(n.fgColor={}),o.theme&&(n.fgColor.theme=parseInt(o.theme,10)),o.tint&&(n.fgColor.tint=parseFloat(o.tint)),o.rgb!=null&&(n.fgColor.rgb=o.rgb.slice(-6));break;case"<fgColor/>":case"</fgColor>":break;case"<stop":case"<stop/>":break;case"</stop>":break;case"<color":case"<color/>":break;case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;default:if(a&&a.WTF&&!i)throw new Error("unrecognized "+o[0]+" in fills")}})}function fW(t,s,r,a){s.Fonts=[];var n={},i=!1;(t[0].match(Si)||[]).forEach(function(l){var o=Ys(l);switch(Lc(o[0])){case"<fonts":case"<fonts>":case"</fonts>":break;case"<font":case"<font>":break;case"</font>":case"<font/>":s.Fonts.push(n),n={};break;case"<name":o.val&&(n.name=Xr(o.val));break;case"<name/>":case"</name>":break;case"<b":n.bold=o.val?da(o.val):1;break;case"<b/>":n.bold=1;break;case"<i":n.italic=o.val?da(o.val):1;break;case"<i/>":n.italic=1;break;case"<u":switch(o.val){case"none":n.underline=0;break;case"single":n.underline=1;break;case"double":n.underline=2;break;case"singleAccounting":n.underline=33;break;case"doubleAccounting":n.underline=34;break}break;case"<u/>":n.underline=1;break;case"<strike":n.strike=o.val?da(o.val):1;break;case"<strike/>":n.strike=1;break;case"<outline":n.outline=o.val?da(o.val):1;break;case"<outline/>":n.outline=1;break;case"<shadow":n.shadow=o.val?da(o.val):1;break;case"<shadow/>":n.shadow=1;break;case"<condense":n.condense=o.val?da(o.val):1;break;case"<condense/>":n.condense=1;break;case"<extend":n.extend=o.val?da(o.val):1;break;case"<extend/>":n.extend=1;break;case"<sz":o.val&&(n.sz=+o.val);break;case"<sz/>":case"</sz>":break;case"<vertAlign":o.val&&(n.vertAlign=o.val);break;case"<vertAlign/>":case"</vertAlign>":break;case"<family":o.val&&(n.family=parseInt(o.val,10));break;case"<family/>":case"</family>":break;case"<scheme":o.val&&(n.scheme=o.val);break;case"<scheme/>":case"</scheme>":break;case"<charset":if(o.val=="1")break;o.codepage=nN[parseInt(o.val,10)];break;case"<color":if(n.color||(n.color={}),o.auto&&(n.color.auto=da(o.auto)),o.rgb)n.color.rgb=o.rgb.slice(-6);else if(o.indexed){n.color.index=parseInt(o.indexed,10);var d=jm[n.color.index];n.color.index==81&&(d=jm[1]),d||(d=jm[1]),n.color.rgb=d[0].toString(16)+d[1].toString(16)+d[2].toString(16)}else o.theme&&(n.color.theme=parseInt(o.theme,10),o.tint&&(n.color.tint=parseFloat(o.tint)),o.theme&&r.themeElements&&r.themeElements.clrScheme&&(n.color.rgb=V0(r.themeElements.clrScheme[n.color.theme].rgb,n.color.tint||0)));break;case"<color/>":case"</color>":break;case"<AlternateContent":i=!0;break;case"</AlternateContent>":i=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;default:if(a&&a.WTF&&!i)throw new Error("unrecognized "+o[0]+" in fonts")}})}function pW(t,s,r){s.NumberFmt=[];for(var a=Da(Vs),n=0;n<a.length;++n)s.NumberFmt[a[n]]=Vs[a[n]];var i=t[0].match(Si);if(i)for(n=0;n<i.length;++n){var l=Ys(i[n]);switch(Lc(l[0])){case"<numFmts":case"</numFmts>":case"<numFmts/>":case"<numFmts>":break;case"<numFmt":{var o=Sr(Xr(l.formatCode)),d=parseInt(l.numFmtId,10);if(s.NumberFmt[d]=o,d>0){if(d>392){for(d=392;d>60&&s.NumberFmt[d]!=null;--d);s.NumberFmt[d]=o}fd(o,d)}}break;case"</numFmt>":break;default:if(r.WTF)throw new Error("unrecognized "+l[0]+" in numFmts")}}}function xW(t){var s=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(r){for(var a=r[0];a<=r[1];++a)t[a]!=null&&(s[s.length]=gs("numFmt",null,{numFmtId:a,formatCode:Gr(t[a])}))}),s.length===1?"":(s[s.length]="</numFmts>",s[0]=gs("numFmts",null,{count:s.length-2}).replace("/>",">"),s.join(""))}var Dx=["numFmtId","fillId","fontId","borderId","xfId"],Px=["applyAlignment","applyBorder","applyFill","applyFont","applyNumberFormat","applyProtection","pivotButton","quotePrefix"];function gW(t,s,r){s.CellXf=[];var a,n=!1;(t[0].match(Si)||[]).forEach(function(i){var l=Ys(i),o=0;switch(Lc(l[0])){case"<cellXfs":case"<cellXfs>":case"<cellXfs/>":case"</cellXfs>":break;case"<xf":case"<xf/>":for(a=l,delete a[0],o=0;o<Dx.length;++o)a[Dx[o]]&&(a[Dx[o]]=parseInt(a[Dx[o]],10));for(o=0;o<Px.length;++o)a[Px[o]]&&(a[Px[o]]=da(a[Px[o]]));if(s.NumberFmt&&a.numFmtId>392){for(o=392;o>60;--o)if(s.NumberFmt[a.numFmtId]==s.NumberFmt[o]){a.numFmtId=o;break}}s.CellXf.push(a);break;case"</xf>":break;case"<alignment":case"<alignment/>":var d={};l.vertical&&(d.vertical=l.vertical),l.horizontal&&(d.horizontal=l.horizontal),l.textRotation!=null&&(d.textRotation=l.textRotation),l.indent&&(d.indent=l.indent),l.wrapText&&(d.wrapText=da(l.wrapText)),a.alignment=d;break;case"</alignment>":break;case"<protection":break;case"</protection>":case"<protection/>":break;case"<AlternateContent":n=!0;break;case"</AlternateContent>":n=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":n=!0;break;case"</ext>":n=!1;break;default:if(r&&r.WTF&&!n)throw new Error("unrecognized "+l[0]+" in cellXfs")}})}function vW(t){var s=[];return s[s.length]=gs("cellXfs",null),t.forEach(function(r){s[s.length]=gs("xf",null,r)}),s[s.length]="</cellXfs>",s.length===2?"":(s[0]=gs("cellXfs",null,{count:s.length-2}).replace("/>",">"),s.join(""))}var bW=(function(){var s=/<(?:\w+:)?numFmts([^>]*)>[\S\s]*?<\/(?:\w+:)?numFmts>/,r=/<(?:\w+:)?cellXfs([^>]*)>[\S\s]*?<\/(?:\w+:)?cellXfs>/,a=/<(?:\w+:)?fills([^>]*)>[\S\s]*?<\/(?:\w+:)?fills>/,n=/<(?:\w+:)?fonts([^>]*)>[\S\s]*?<\/(?:\w+:)?fonts>/,i=/<(?:\w+:)?borders([^>]*)>[\S\s]*?<\/(?:\w+:)?borders>/;return function(o,d,u){var c={};if(!o)return c;o=o.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");var h;return(h=o.match(s))&&pW(h,c,u),(h=o.match(n))&&fW(h,c,d,u),(h=o.match(a))&&AW(h,c,d,u),(h=o.match(i))&&hW(h,c,d,u),(h=o.match(r))&&gW(h,c,u),c}})();function yB(t,s){var r=[Xa,gs("styleSheet",null,{xmlns:Dm[0],"xmlns:vt":fn.vt})],a;return t.SSF&&(a=xW(t.SSF))!=null&&(r[r.length]=a),r[r.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',r[r.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',r[r.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',r[r.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(a=vW(s.cellXfs))&&(r[r.length]=a),r[r.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',r[r.length]='<dxfs count="0"/>',r[r.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',r.length>2&&(r[r.length]="</styleSheet>",r[1]=r[1].replace("/>",">")),r.join("")}function yW(t,s){var r=t.read_shift(2),a=Ni(t);return[r,a]}function jW(t,s,r){r||(r=Zt(6+4*s.length)),r.write_shift(2,t),Tn(s,r);var a=r.length>r.l?r.slice(0,r.l):r;return r.l==null&&(r.l=r.length),a}function NW(t,s,r){var a={};a.sz=t.read_shift(2)/20;var n=aq(t);n.fItalic&&(a.italic=1),n.fCondense&&(a.condense=1),n.fExtend&&(a.extend=1),n.fShadow&&(a.shadow=1),n.fOutline&&(a.outline=1),n.fStrikeout&&(a.strike=1);var i=t.read_shift(2);switch(i===700&&(a.bold=1),t.read_shift(2)){case 1:a.vertAlign="superscript";break;case 2:a.vertAlign="subscript";break}var l=t.read_shift(1);l!=0&&(a.underline=l);var o=t.read_shift(1);o>0&&(a.family=o);var d=t.read_shift(1);switch(d>0&&(a.charset=d),t.l++,a.color=rq(t),t.read_shift(1)){case 1:a.scheme="major";break;case 2:a.scheme="minor";break}return a.name=Ni(t),a}function wW(t,s){s||(s=Zt(153)),s.write_shift(2,t.sz*20),nq(t,s),s.write_shift(2,t.bold?700:400);var r=0;t.vertAlign=="superscript"?r=1:t.vertAlign=="subscript"&&(r=2),s.write_shift(2,r),s.write_shift(1,t.underline||0),s.write_shift(1,t.family||0),s.write_shift(1,t.charset||0),s.write_shift(1,0),H0(t.color,s);var a=0;return a=2,s.write_shift(1,a),Tn(t.name,s),s.length>s.l?s.slice(0,s.l):s}var _W=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],Ub,SW=_i;function QS(t,s){s||(s=Zt(84)),Ub||(Ub=Fg(_W));var r=Ub[t.patternType];r==null&&(r=40),s.write_shift(4,r);var a=0;if(r!=40)for(H0({auto:1},s),H0({auto:1},s);a<12;++a)s.write_shift(4,0);else{for(;a<4;++a)s.write_shift(4,0);for(;a<12;++a)s.write_shift(4,0)}return s.length>s.l?s.slice(0,s.l):s}function CW(t,s){var r=t.l+s,a=t.read_shift(2),n=t.read_shift(2);return t.l=r,{ixfe:a,numFmtId:n}}function jB(t,s,r){r||(r=Zt(16)),r.write_shift(2,s||0),r.write_shift(2,t.numFmtId||0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(1,0),r.write_shift(1,0);var a=0;return r.write_shift(1,a),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(1,0),r}function UA(t,s){return s||(s=Zt(10)),s.write_shift(1,0),s.write_shift(1,0),s.write_shift(4,0),s.write_shift(4,0),s}var kW=_i;function EW(t,s){return s||(s=Zt(51)),s.write_shift(1,0),UA(null,s),UA(null,s),UA(null,s),UA(null,s),UA(null,s),s.length>s.l?s.slice(0,s.l):s}function BW(t,s){return s||(s=Zt(52)),s.write_shift(4,t.xfId),s.write_shift(2,1),s.write_shift(1,0),s.write_shift(1,0),Q0(t.name||"",s),s.length>s.l?s.slice(0,s.l):s}function FW(t,s,r){var a=Zt(2052);return a.write_shift(4,t),Q0(s,a),Q0(r,a),a.length>a.l?a.slice(0,a.l):a}function TW(t,s,r){var a={};a.NumberFmt=[];for(var n in Vs)a.NumberFmt[n]=Vs[n];a.CellXf=[],a.Fonts=[];var i=[],l=!1;return wd(t,function(d,u,c){switch(c){case 44:a.NumberFmt[d[0]]=d[1],fd(d[1],d[0]);break;case 43:a.Fonts.push(d),d.color.theme!=null&&s&&s.themeElements&&s.themeElements.clrScheme&&(d.color.rgb=V0(s.themeElements.clrScheme[d.color.theme].rgb,d.color.tint||0));break;case 1025:break;case 45:break;case 46:break;case 47:i[i.length-1]==617&&a.CellXf.push(d);break;case 48:case 507:case 572:case 475:break;case 1171:case 2102:case 1130:case 512:case 2095:case 3072:break;case 35:l=!0;break;case 36:l=!1;break;case 37:i.push(c),l=!0;break;case 38:i.pop(),l=!1;break;default:if(u.T>0)i.push(c);else if(u.T<0)i.pop();else if(!l||r.WTF&&i[i.length-1]!=37)throw new Error("Unexpected record 0x"+c.toString(16))}}),a}function IW(t,s){if(s){var r=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(a){for(var n=a[0];n<=a[1];++n)s[n]!=null&&++r}),r!=0&&(ls(t,615,Wo(r)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(a){for(var n=a[0];n<=a[1];++n)s[n]!=null&&ls(t,44,jW(n,s[n]))}),ls(t,616))}}function LW(t){var s=1;ls(t,611,Wo(s)),ls(t,43,wW({sz:12,color:{theme:1},name:"Calibri",family:2})),ls(t,612)}function DW(t){var s=2;ls(t,603,Wo(s)),ls(t,45,QS({patternType:"none"})),ls(t,45,QS({patternType:"gray125"})),ls(t,604)}function PW(t){var s=1;ls(t,613,Wo(s)),ls(t,46,EW()),ls(t,614)}function UW(t){var s=1;ls(t,626,Wo(s)),ls(t,47,jB({numFmtId:0},65535)),ls(t,627)}function RW(t,s){ls(t,617,Wo(s.length)),s.forEach(function(r){ls(t,47,jB(r,0))}),ls(t,618)}function OW(t){var s=1;ls(t,619,Wo(s)),ls(t,48,BW({xfId:0,name:"Normal"})),ls(t,620)}function MW(t){var s=0;ls(t,505,Wo(s)),ls(t,506)}function QW(t){var s=0;ls(t,508,FW(s,"TableStyleMedium9","PivotStyleMedium4")),ls(t,509)}function HW(t,s){var r=ul();return ls(r,278),IW(r,t.SSF),LW(r),DW(r),PW(r),UW(r),RW(r,s.cellXfs),OW(r),MW(r),QW(r),ls(r,279),r.end()}var qW=["</a:lt1>","</a:dk1>","</a:lt2>","</a:dk2>","</a:accent1>","</a:accent2>","</a:accent3>","</a:accent4>","</a:accent5>","</a:accent6>","</a:hlink>","</a:folHlink>"];function $W(t,s,r){s.themeElements.clrScheme=[];var a={};(t[0].match(Si)||[]).forEach(function(n){var i=Ys(n);switch(i[0]){case"<a:clrScheme":case"</a:clrScheme>":break;case"<a:srgbClr":a.rgb=i.val;break;case"<a:sysClr":a.rgb=i.lastClr;break;case"<a:dk1>":case"</a:dk1>":case"<a:lt1>":case"</a:lt1>":case"<a:dk2>":case"</a:dk2>":case"<a:lt2>":case"</a:lt2>":case"<a:accent1>":case"</a:accent1>":case"<a:accent2>":case"</a:accent2>":case"<a:accent3>":case"</a:accent3>":case"<a:accent4>":case"</a:accent4>":case"<a:accent5>":case"</a:accent5>":case"<a:accent6>":case"</a:accent6>":case"<a:hlink>":case"</a:hlink>":case"<a:folHlink>":case"</a:folHlink>":i[0].charAt(1)==="/"?(s.themeElements.clrScheme[qW.indexOf(i[0])]=a,a={}):a.name=i[0].slice(3,i[0].length-1);break;default:if(r&&r.WTF)throw new Error("Unrecognized "+i[0]+" in clrScheme")}})}function VW(){}function WW(){}var GW=/<a:clrScheme([^>]*)>[\s\S]*<\/a:clrScheme>/,KW=/<a:fontScheme([^>]*)>[\s\S]*<\/a:fontScheme>/,zW=/<a:fmtScheme([^>]*)>[\s\S]*<\/a:fmtScheme>/;function YW(t,s,r){s.themeElements={};var a;[["clrScheme",GW,$W],["fontScheme",KW,VW],["fmtScheme",zW,WW]].forEach(function(n){if(!(a=t.match(n[1])))throw new Error(n[0]+" not found in themeElements");n[2](a,s,r)})}var XW=/<a:themeElements([^>]*)>[\s\S]*<\/a:themeElements>/;function NB(t,s){(!t||t.length===0)&&(t=TN());var r,a={};if(!(r=t.match(XW)))throw new Error("themeElements not found in theme");return YW(r[0],a,s),a.raw=t,a}function TN(t,s){if(s&&s.themeXLSX)return s.themeXLSX;if(t&&typeof t.raw=="string")return t.raw;var r=[Xa];return r[r.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',r[r.length]="<a:themeElements>",r[r.length]='<a:clrScheme name="Office">',r[r.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',r[r.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',r[r.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',r[r.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',r[r.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',r[r.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',r[r.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',r[r.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',r[r.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',r[r.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',r[r.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',r[r.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',r[r.length]="</a:clrScheme>",r[r.length]='<a:fontScheme name="Office">',r[r.length]="<a:majorFont>",r[r.length]='<a:latin typeface="Cambria"/>',r[r.length]='<a:ea typeface=""/>',r[r.length]='<a:cs typeface=""/>',r[r.length]='<a:font script="Jpan" typeface=" "/>',r[r.length]='<a:font script="Hang" typeface=" "/>',r[r.length]='<a:font script="Hans" typeface=""/>',r[r.length]='<a:font script="Hant" typeface=""/>',r[r.length]='<a:font script="Arab" typeface="Times New Roman"/>',r[r.length]='<a:font script="Hebr" typeface="Times New Roman"/>',r[r.length]='<a:font script="Thai" typeface="Tahoma"/>',r[r.length]='<a:font script="Ethi" typeface="Nyala"/>',r[r.length]='<a:font script="Beng" typeface="Vrinda"/>',r[r.length]='<a:font script="Gujr" typeface="Shruti"/>',r[r.length]='<a:font script="Khmr" typeface="MoolBoran"/>',r[r.length]='<a:font script="Knda" typeface="Tunga"/>',r[r.length]='<a:font script="Guru" typeface="Raavi"/>',r[r.length]='<a:font script="Cans" typeface="Euphemia"/>',r[r.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',r[r.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',r[r.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',r[r.length]='<a:font script="Thaa" typeface="MV Boli"/>',r[r.length]='<a:font script="Deva" typeface="Mangal"/>',r[r.length]='<a:font script="Telu" typeface="Gautami"/>',r[r.length]='<a:font script="Taml" typeface="Latha"/>',r[r.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',r[r.length]='<a:font script="Orya" typeface="Kalinga"/>',r[r.length]='<a:font script="Mlym" typeface="Kartika"/>',r[r.length]='<a:font script="Laoo" typeface="DokChampa"/>',r[r.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',r[r.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',r[r.length]='<a:font script="Viet" typeface="Times New Roman"/>',r[r.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',r[r.length]='<a:font script="Geor" typeface="Sylfaen"/>',r[r.length]="</a:majorFont>",r[r.length]="<a:minorFont>",r[r.length]='<a:latin typeface="Calibri"/>',r[r.length]='<a:ea typeface=""/>',r[r.length]='<a:cs typeface=""/>',r[r.length]='<a:font script="Jpan" typeface=" "/>',r[r.length]='<a:font script="Hang" typeface=" "/>',r[r.length]='<a:font script="Hans" typeface=""/>',r[r.length]='<a:font script="Hant" typeface=""/>',r[r.length]='<a:font script="Arab" typeface="Arial"/>',r[r.length]='<a:font script="Hebr" typeface="Arial"/>',r[r.length]='<a:font script="Thai" typeface="Tahoma"/>',r[r.length]='<a:font script="Ethi" typeface="Nyala"/>',r[r.length]='<a:font script="Beng" typeface="Vrinda"/>',r[r.length]='<a:font script="Gujr" typeface="Shruti"/>',r[r.length]='<a:font script="Khmr" typeface="DaunPenh"/>',r[r.length]='<a:font script="Knda" typeface="Tunga"/>',r[r.length]='<a:font script="Guru" typeface="Raavi"/>',r[r.length]='<a:font script="Cans" typeface="Euphemia"/>',r[r.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',r[r.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',r[r.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',r[r.length]='<a:font script="Thaa" typeface="MV Boli"/>',r[r.length]='<a:font script="Deva" typeface="Mangal"/>',r[r.length]='<a:font script="Telu" typeface="Gautami"/>',r[r.length]='<a:font script="Taml" typeface="Latha"/>',r[r.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',r[r.length]='<a:font script="Orya" typeface="Kalinga"/>',r[r.length]='<a:font script="Mlym" typeface="Kartika"/>',r[r.length]='<a:font script="Laoo" typeface="DokChampa"/>',r[r.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',r[r.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',r[r.length]='<a:font script="Viet" typeface="Arial"/>',r[r.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',r[r.length]='<a:font script="Geor" typeface="Sylfaen"/>',r[r.length]="</a:minorFont>",r[r.length]="</a:fontScheme>",r[r.length]='<a:fmtScheme name="Office">',r[r.length]="<a:fillStyleLst>",r[r.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:lin ang="16200000" scaled="1"/>',r[r.length]="</a:gradFill>",r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:lin ang="16200000" scaled="0"/>',r[r.length]="</a:gradFill>",r[r.length]="</a:fillStyleLst>",r[r.length]="<a:lnStyleLst>",r[r.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]="</a:lnStyleLst>",r[r.length]="<a:effectStyleLst>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]="</a:effectStyle>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]="</a:effectStyle>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',r[r.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',r[r.length]="</a:effectStyle>",r[r.length]="</a:effectStyleLst>",r[r.length]="<a:bgFillStyleLst>",r[r.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',r[r.length]="</a:gradFill>",r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',r[r.length]="</a:gradFill>",r[r.length]="</a:bgFillStyleLst>",r[r.length]="</a:fmtScheme>",r[r.length]="</a:themeElements>",r[r.length]="<a:objectDefaults>",r[r.length]="<a:spDef>",r[r.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',r[r.length]="</a:spDef>",r[r.length]="<a:lnDef>",r[r.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',r[r.length]="</a:lnDef>",r[r.length]="</a:objectDefaults>",r[r.length]="<a:extraClrSchemeLst/>",r[r.length]="</a:theme>",r.join("")}function JW(t,s,r){var a=t.l+s,n=t.read_shift(4);if(n!==124226){if(!r.cellStyles){t.l=a;return}var i=t.slice(t.l);t.l=a;var l;try{l=fE(i,{type:"array"})}catch{return}var o=Cl(l,"theme/theme/theme1.xml",!0);if(o)return NB(o,r)}}function ZW(t){return t.read_shift(4)}function eG(t){var s={};switch(s.xclrType=t.read_shift(2),s.nTintShade=t.read_shift(2),s.xclrType){case 0:t.l+=4;break;case 1:s.xclrValue=tG(t,4);break;case 2:s.xclrValue=sB(t);break;case 3:s.xclrValue=ZW(t);break;case 4:t.l+=4;break}return t.l+=8,s}function tG(t,s){return _i(t,s)}function sG(t,s){return _i(t,s)}function rG(t){var s=t.read_shift(2),r=t.read_shift(2)-4,a=[s];switch(s){case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 13:a[1]=eG(t);break;case 6:a[1]=sG(t,r);break;case 14:case 15:a[1]=t.read_shift(r===1?1:2);break;default:throw new Error("Unrecognized ExtProp type: "+s+" "+r)}return a}function aG(t,s){var r=t.l+s;t.l+=2;var a=t.read_shift(2);t.l+=2;for(var n=t.read_shift(2),i=[];n-- >0;)i.push(rG(t,r-t.l));return{ixfe:a,ext:i}}function nG(t,s){s.forEach(function(r){r[0]})}function iG(t,s){return{flags:t.read_shift(4),version:t.read_shift(4),name:Ni(t)}}function lG(t){var s=Zt(12+2*t.name.length);return s.write_shift(4,t.flags),s.write_shift(4,t.version),Tn(t.name,s),s.slice(0,s.l)}function oG(t){for(var s=[],r=t.read_shift(4);r-- >0;)s.push([t.read_shift(4),t.read_shift(4)]);return s}function cG(t){var s=Zt(4+8*t.length);s.write_shift(4,t.length);for(var r=0;r<t.length;++r)s.write_shift(4,t[r][0]),s.write_shift(4,t[r][1]);return s}function dG(t,s){var r=Zt(8+2*s.length);return r.write_shift(4,t),Tn(s,r),r.slice(0,r.l)}function uG(t){return t.l+=4,t.read_shift(4)!=0}function mG(t,s){var r=Zt(8);return r.write_shift(4,t),r.write_shift(4,1),r}function hG(t,s,r){var a={Types:[],Cell:[],Value:[]},n=r||{},i=[],l=!1,o=2;return wd(t,function(d,u,c){switch(c){case 335:a.Types.push({name:d.name});break;case 51:d.forEach(function(h){o==1?a.Cell.push({type:a.Types[h[0]-1].name,index:h[1]}):o==0&&a.Value.push({type:a.Types[h[0]-1].name,index:h[1]})});break;case 337:o=d?1:0;break;case 338:o=2;break;case 35:i.push(c),l=!0;break;case 36:i.pop(),l=!1;break;default:if(!u.T){if(!l||n.WTF&&i[i.length-1]!=35)throw new Error("Unexpected record 0x"+c.toString(16))}}}),a}function AG(){var t=ul();return ls(t,332),ls(t,334,Wo(1)),ls(t,335,lG({name:"XLDAPR",version:12e4,flags:3496657072})),ls(t,336),ls(t,339,dG(1,"XLDAPR")),ls(t,52),ls(t,35,Wo(514)),ls(t,4096,Wo(0)),ls(t,4097,eo(1)),ls(t,36),ls(t,53),ls(t,340),ls(t,337,mG(1)),ls(t,51,cG([[1,0]])),ls(t,338),ls(t,333),t.end()}function fG(t,s,r){var a={Types:[],Cell:[],Value:[]};if(!t)return a;var n=!1,i=2,l;return t.replace(Si,function(o){var d=Ys(o);switch(Lc(d[0])){case"<?xml":break;case"<metadata":case"</metadata>":break;case"<metadataTypes":case"</metadataTypes>":break;case"<metadataType":a.Types.push({name:d.name});break;case"</metadataType>":break;case"<futureMetadata":for(var u=0;u<a.Types.length;++u)a.Types[u].name==d.name&&(l=a.Types[u]);break;case"</futureMetadata>":break;case"<bk>":break;case"</bk>":break;case"<rc":i==1?a.Cell.push({type:a.Types[d.t-1].name,index:+d.v}):i==0&&a.Value.push({type:a.Types[d.t-1].name,index:+d.v});break;case"</rc>":break;case"<cellMetadata":i=1;break;case"</cellMetadata>":i=2;break;case"<valueMetadata":i=0;break;case"</valueMetadata>":i=2;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":n=!0;break;case"</ext>":n=!1;break;case"<rvb":if(!l)break;l.offsets||(l.offsets=[]),l.offsets.push(+d.i);break;default:if(!n&&r.WTF)throw new Error("unrecognized "+d[0]+" in metadata")}return o}),a}function wB(){var t=[Xa];return t.push(`<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">
  <metadataTypes count="1">
    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>
  </metadataTypes>
  <futureMetadata name="XLDAPR" count="1">
    <bk>
      <extLst>
        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">
          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>
        </ext>
      </extLst>
    </bk>
  </futureMetadata>
  <cellMetadata count="1">
    <bk>
      <rc t="1" v="0"/>
    </bk>
  </cellMetadata>
</metadata>`),t.join("")}function pG(t){var s=[];if(!t)return s;var r=1;return(t.match(Si)||[]).forEach(function(a){var n=Ys(a);switch(n[0]){case"<?xml":break;case"<calcChain":case"<calcChain>":case"</calcChain>":break;case"<c":delete n[0],n.i?r=n.i:n.i=r,s.push(n);break}}),s}function xG(t){var s={};s.i=t.read_shift(4);var r={};r.r=t.read_shift(4),r.c=t.read_shift(4),s.r=Ks(r);var a=t.read_shift(1);return a&2&&(s.l="1"),a&8&&(s.a="1"),s}function gG(t,s,r){var a=[];return wd(t,function(i,l,o){switch(o){case 63:a.push(i);break;default:if(!l.T)throw new Error("Unexpected record 0x"+o.toString(16))}}),a}function vG(t,s,r,a){if(!t)return t;var n=a||{},i=!1;wd(t,function(o,d,u){switch(u){case 359:case 363:case 364:case 366:case 367:case 368:case 369:case 370:case 371:case 472:case 577:case 578:case 579:case 580:case 581:case 582:case 583:case 584:case 585:case 586:case 587:break;case 35:i=!0;break;case 36:i=!1;break;default:if(!d.T){if(!i||n.WTF)throw new Error("Unexpected record 0x"+u.toString(16))}}},n)}function bG(t,s){if(!t)return"??";var r=(t.match(/<c:chart [^>]*r:id="([^"]*)"/)||["",""])[1];return s["!id"][r].Target}var Th=1024;function _B(t,s){for(var r=[21600,21600],a=["m0,0l0",r[1],r[0],r[1],r[0],"0xe"].join(","),n=[gs("xml",null,{"xmlns:v":wl.v,"xmlns:o":wl.o,"xmlns:x":wl.x,"xmlns:mv":wl.mv}).replace(/\/>/,">"),gs("o:shapelayout",gs("o:idmap",null,{"v:ext":"edit",data:t}),{"v:ext":"edit"}),gs("v:shapetype",[gs("v:stroke",null,{joinstyle:"miter"}),gs("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:r.join(","),path:a})];Th<t*1e3;)Th+=1e3;return s.forEach(function(i){var l=wa(i[0]),o={color2:"#BEFF82",type:"gradient"};o.type=="gradient"&&(o.angle="-180");var d=o.type=="gradient"?gs("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,u=gs("v:fill",d,o),c={on:"t",obscured:"t"};++Th,n=n.concat(["<v:shape"+Lf({id:"_x0000_s"+Th,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(i[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",u,gs("v:shadow",null,c),gs("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",Kn("x:Anchor",[l.c+1,0,l.r+1,0,l.c+3,20,l.r+5,20].join(",")),Kn("x:AutoFill","False"),Kn("x:Row",String(l.r)),Kn("x:Column",String(l.c)),i[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),n.push("</xml>"),n.join("")}function HS(t,s,r,a){var n=Array.isArray(t),i;s.forEach(function(l){var o=wa(l.ref);if(n?(t[o.r]||(t[o.r]=[]),i=t[o.r][o.c]):i=t[l.ref],!i){i={t:"z"},n?t[o.r][o.c]=i:t[l.ref]=i;var d=Cr(t["!ref"]||"BDWGO1000001:A1");d.s.r>o.r&&(d.s.r=o.r),d.e.r<o.r&&(d.e.r=o.r),d.s.c>o.c&&(d.s.c=o.c),d.e.c<o.c&&(d.e.c=o.c);var u=lr(d);u!==t["!ref"]&&(t["!ref"]=u)}i.c||(i.c=[]);var c={a:l.author,t:l.t,r:l.r,T:r};l.h&&(c.h=l.h);for(var h=i.c.length-1;h>=0;--h){if(!r&&i.c[h].T)return;r&&!i.c[h].T&&i.c.splice(h,1)}if(r&&a){for(h=0;h<a.length;++h)if(c.a==a[h].id){c.a=a[h].name||c.a;break}}i.c.push(c)})}function yG(t,s){if(t.match(/<(?:\w+:)?comments *\/>/))return[];var r=[],a=[],n=t.match(/<(?:\w+:)?authors>([\s\S]*)<\/(?:\w+:)?authors>/);n&&n[1]&&n[1].split(/<\/\w*:?author>/).forEach(function(l){if(!(l===""||l.trim()==="")){var o=l.match(/<(?:\w+:)?author[^>]*>(.*)/);o&&r.push(o[1])}});var i=t.match(/<(?:\w+:)?commentList>([\s\S]*)<\/(?:\w+:)?commentList>/);return i&&i[1]&&i[1].split(/<\/\w*:?comment>/).forEach(function(l){if(!(l===""||l.trim()==="")){var o=l.match(/<(?:\w+:)?comment[^>]*>/);if(o){var d=Ys(o[0]),u={author:d.authorId&&r[d.authorId]||"sheetjsghost",ref:d.ref,guid:d.guid},c=wa(d.ref);if(!(s.sheetRows&&s.sheetRows<=c.r)){var h=l.match(/<(?:\w+:)?text>([\s\S]*)<\/(?:\w+:)?text>/),m=!!h&&!!h[1]&&EN(h[1])||{r:"",t:"",h:""};u.r=m.r,m.r=="<t></t>"&&(m.t=m.h=""),u.t=(m.t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`),s.cellHTML&&(u.h=m.h),a.push(u)}}}}),a}function SB(t){var s=[Xa,gs("comments",null,{xmlns:Dm[0]})],r=[];return s.push("<authors>"),t.forEach(function(a){a[1].forEach(function(n){var i=Gr(n.a);r.indexOf(i)==-1&&(r.push(i),s.push("<author>"+i+"</author>")),n.T&&n.ID&&r.indexOf("tc="+n.ID)==-1&&(r.push("tc="+n.ID),s.push("<author>tc="+n.ID+"</author>"))})}),r.length==0&&(r.push("SheetJ5"),s.push("<author>SheetJ5</author>")),s.push("</authors>"),s.push("<commentList>"),t.forEach(function(a){var n=0,i=[];if(a[1][0]&&a[1][0].T&&a[1][0].ID?n=r.indexOf("tc="+a[1][0].ID):a[1].forEach(function(d){d.a&&(n=r.indexOf(Gr(d.a))),i.push(d.t||"")}),s.push('<comment ref="'+a[0]+'" authorId="'+n+'"><text>'),i.length<=1)s.push(Kn("t",Gr(i[0]||"")));else{for(var l=`Comment:
    `+i[0]+`
`,o=1;o<i.length;++o)l+=`Reply:
    `+i[o]+`
`;s.push(Kn("t",Gr(l)))}s.push("</text></comment>")}),s.push("</commentList>"),s.length>2&&(s[s.length]="</comments>",s[1]=s[1].replace("/>",">")),s.join("")}function jG(t,s){var r=[],a=!1,n={},i=0;return t.replace(Si,function(o,d){var u=Ys(o);switch(Lc(u[0])){case"<?xml":break;case"<ThreadedComments":break;case"</ThreadedComments>":break;case"<threadedComment":n={author:u.personId,guid:u.id,ref:u.ref,T:1};break;case"</threadedComment>":n.t!=null&&r.push(n);break;case"<text>":case"<text":i=d+o.length;break;case"</text>":n.t=t.slice(i,d).replace(/\r\n/g,`
`).replace(/\r/g,`
`);break;case"<mentions":case"<mentions>":a=!0;break;case"</mentions>":a=!1;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":a=!0;break;case"</ext>":a=!1;break;default:if(!a&&s.WTF)throw new Error("unrecognized "+u[0]+" in threaded comments")}return o}),r}function NG(t,s,r){var a=[Xa,gs("ThreadedComments",null,{xmlns:fn.TCMNT}).replace(/[\/]>/,">")];return t.forEach(function(n){var i="";(n[1]||[]).forEach(function(l,o){if(!l.T){delete l.ID;return}l.a&&s.indexOf(l.a)==-1&&s.push(l.a);var d={ref:n[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+r.tcid++).slice(-12)+"}"};o==0?i=d.id:d.parentId=i,l.ID=d.id,l.a&&(d.personId="{54EE7950-7262-4200-6969-"+("000000000000"+s.indexOf(l.a)).slice(-12)+"}"),a.push(gs("threadedComment",Kn("text",l.t||""),d))})}),a.push("</ThreadedComments>"),a.join("")}function wG(t,s){var r=[],a=!1;return t.replace(Si,function(i){var l=Ys(i);switch(Lc(l[0])){case"<?xml":break;case"<personList":break;case"</personList>":break;case"<person":r.push({name:l.displayname,id:l.id});break;case"</person>":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":a=!0;break;case"</ext>":a=!1;break;default:if(!a&&s.WTF)throw new Error("unrecognized "+l[0]+" in threaded comments")}return i}),r}function _G(t){var s=[Xa,gs("personList",null,{xmlns:fn.TCMNT,"xmlns:x":Dm[0]}).replace(/[\/]>/,">")];return t.forEach(function(r,a){s.push(gs("person",null,{displayName:r,id:"{54EE7950-7262-4200-6969-"+("000000000000"+a).slice(-12)+"}",userId:r,providerId:"None"}))}),s.push("</personList>"),s.join("")}function SG(t){var s={};s.iauthor=t.read_shift(4);var r=Om(t);return s.rfx=r.s,s.ref=Ks(r.s),t.l+=16,s}function CG(t,s){return s==null&&(s=Zt(36)),s.write_shift(4,t[1].iauthor),oA(t[0],s),s.write_shift(4,0),s.write_shift(4,0),s.write_shift(4,0),s.write_shift(4,0),s}var kG=Ni;function EG(t){return Tn(t.slice(0,54))}function BG(t,s){var r=[],a=[],n={},i=!1;return wd(t,function(o,d,u){switch(u){case 632:a.push(o);break;case 635:n=o;break;case 637:n.t=o.t,n.h=o.h,n.r=o.r;break;case 636:if(n.author=a[n.iauthor],delete n.iauthor,s.sheetRows&&n.rfx&&s.sheetRows<=n.rfx.r)break;n.t||(n.t=""),delete n.rfx,r.push(n);break;case 3072:break;case 35:i=!0;break;case 36:i=!1;break;case 37:break;case 38:break;default:if(!d.T){if(!i||s.WTF)throw new Error("Unexpected record 0x"+u.toString(16))}}}),r}function FG(t){var s=ul(),r=[];return ls(s,628),ls(s,630),t.forEach(function(a){a[1].forEach(function(n){r.indexOf(n.a)>-1||(r.push(n.a.slice(0,54)),ls(s,632,EG(n.a)))})}),ls(s,631),ls(s,633),t.forEach(function(a){a[1].forEach(function(n){n.iauthor=r.indexOf(n.a);var i={s:wa(a[0]),e:wa(a[0])};ls(s,635,CG([i,n])),n.t&&n.t.length>0&&ls(s,637,Z9(n)),ls(s,636),delete n.iauthor})}),ls(s,634),ls(s,629),s.end()}var TG="application/vnd.ms-office.vbaProject";function IG(t){var s=Qs.utils.cfb_new({root:"R"});return t.FullPaths.forEach(function(r,a){if(!(r.slice(-1)==="/"||!r.match(/_VBA_PROJECT_CUR/))){var n=r.replace(/^[^\/]*/,"R").replace(/\/_VBA_PROJECT_CUR\u0000*/,"");Qs.utils.cfb_add(s,n,t.FileIndex[a].content)}}),Qs.write(s)}function LG(t,s){s.FullPaths.forEach(function(r,a){if(a!=0){var n=r.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");n.slice(-1)!=="/"&&Qs.utils.cfb_add(t,n,s.FileIndex[a].content)}})}var CB=["xlsb","xlsm","xlam","biff8","xla"];function DG(){return{"!type":"dialog"}}function PG(){return{"!type":"dialog"}}function UG(){return{"!type":"macro"}}function RG(){return{"!type":"macro"}}var Mh=(function(){var t=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,s={r:0,c:0};function r(a,n,i,l){var o=!1,d=!1;i.length==0?d=!0:i.charAt(0)=="["&&(d=!0,i=i.slice(1,-1)),l.length==0?o=!0:l.charAt(0)=="["&&(o=!0,l=l.slice(1,-1));var u=i.length>0?parseInt(i,10)|0:0,c=l.length>0?parseInt(l,10)|0:0;return o?c+=s.c:--c,d?u+=s.r:--u,n+(o?"":"$")+Na(c)+(d?"":"$")+za(u)}return function(n,i){return s=i,n.replace(t,r)}})(),IN=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,LN=(function(){return function(s,r){return s.replace(IN,function(a,n,i,l,o,d){var u=bN(l)-(i?0:r.c),c=vN(d)-(o?0:r.r),h=c==0?"":o?c+1:"["+c+"]",m=u==0?"":i?u+1:"["+u+"]";return n+"R"+h+"C"+m})}})();function kB(t,s){return t.replace(IN,function(r,a,n,i,l,o){return a+(n=="$"?n+i:Na(bN(i)+s.c))+(l=="$"?l+o:za(vN(o)+s.r))})}function OG(t,s,r){var a=ml(s),n=a.s,i=wa(r),l={r:i.r-n.r,c:i.c-n.c};return kB(t,l)}function MG(t){return t.length!=1}function qS(t){return t.replace(/_xlfn\./g,"")}function rn(t){t.l+=1}function Fu(t,s){var r=t.read_shift(2);return[r&16383,r>>14&1,r>>15&1]}function EB(t,s,r){var a=2;if(r){if(r.biff>=2&&r.biff<=5)return BB(t);r.biff==12&&(a=4)}var n=t.read_shift(a),i=t.read_shift(a),l=Fu(t),o=Fu(t);return{s:{r:n,c:l[0],cRel:l[1],rRel:l[2]},e:{r:i,c:o[0],cRel:o[1],rRel:o[2]}}}function BB(t){var s=Fu(t),r=Fu(t),a=t.read_shift(1),n=t.read_shift(1);return{s:{r:s[0],c:a,cRel:s[1],rRel:s[2]},e:{r:r[0],c:n,cRel:r[1],rRel:r[2]}}}function QG(t,s,r){if(r.biff<8)return BB(t);var a=t.read_shift(r.biff==12?4:2),n=t.read_shift(r.biff==12?4:2),i=Fu(t),l=Fu(t);return{s:{r:a,c:i[0],cRel:i[1],rRel:i[2]},e:{r:n,c:l[0],cRel:l[1],rRel:l[2]}}}function FB(t,s,r){if(r&&r.biff>=2&&r.biff<=5)return HG(t);var a=t.read_shift(r&&r.biff==12?4:2),n=Fu(t);return{r:a,c:n[0],cRel:n[1],rRel:n[2]}}function HG(t){var s=Fu(t),r=t.read_shift(1);return{r:s[0],c:r,cRel:s[1],rRel:s[2]}}function qG(t){var s=t.read_shift(2),r=t.read_shift(2);return{r:s,c:r&255,fQuoted:!!(r&16384),cRel:r>>15,rRel:r>>15}}function $G(t,s,r){var a=r&&r.biff?r.biff:8;if(a>=2&&a<=5)return VG(t);var n=t.read_shift(a>=12?4:2),i=t.read_shift(2),l=(i&16384)>>14,o=(i&32768)>>15;if(i&=16383,o==1)for(;n>524287;)n-=1048576;if(l==1)for(;i>8191;)i=i-16384;return{r:n,c:i,cRel:l,rRel:o}}function VG(t){var s=t.read_shift(2),r=t.read_shift(1),a=(s&32768)>>15,n=(s&16384)>>14;return s&=16383,a==1&&s>=8192&&(s=s-16384),n==1&&r>=128&&(r=r-256),{r:s,c:r,cRel:n,rRel:a}}function WG(t,s,r){var a=(t[t.l++]&96)>>5,n=EB(t,r.biff>=2&&r.biff<=5?6:8,r);return[a,n]}function GG(t,s,r){var a=(t[t.l++]&96)>>5,n=t.read_shift(2,"i"),i=8;if(r)switch(r.biff){case 5:t.l+=12,i=6;break;case 12:i=12;break}var l=EB(t,i,r);return[a,n,l]}function KG(t,s,r){var a=(t[t.l++]&96)>>5;return t.l+=r&&r.biff>8?12:r.biff<8?6:8,[a]}function zG(t,s,r){var a=(t[t.l++]&96)>>5,n=t.read_shift(2),i=8;if(r)switch(r.biff){case 5:t.l+=12,i=6;break;case 12:i=12;break}return t.l+=i,[a,n]}function YG(t,s,r){var a=(t[t.l++]&96)>>5,n=QG(t,s-1,r);return[a,n]}function XG(t,s,r){var a=(t[t.l++]&96)>>5;return t.l+=r.biff==2?6:r.biff==12?14:7,[a]}function $S(t){var s=t[t.l+1]&1,r=1;return t.l+=4,[s,r]}function JG(t,s,r){t.l+=2;for(var a=t.read_shift(r&&r.biff==2?1:2),n=[],i=0;i<=a;++i)n.push(t.read_shift(r&&r.biff==2?1:2));return n}function ZG(t,s,r){var a=t[t.l+1]&255?1:0;return t.l+=2,[a,t.read_shift(r&&r.biff==2?1:2)]}function eK(t,s,r){var a=t[t.l+1]&255?1:0;return t.l+=2,[a,t.read_shift(r&&r.biff==2?1:2)]}function tK(t){var s=t[t.l+1]&255?1:0;return t.l+=2,[s,t.read_shift(2)]}function sK(t,s,r){var a=t[t.l+1]&255?1:0;return t.l+=r&&r.biff==2?3:4,[a]}function TB(t){var s=t.read_shift(1),r=t.read_shift(1);return[s,r]}function rK(t){return t.read_shift(2),TB(t)}function aK(t){return t.read_shift(2),TB(t)}function nK(t,s,r){var a=(t[t.l]&96)>>5;t.l+=1;var n=FB(t,0,r);return[a,n]}function iK(t,s,r){var a=(t[t.l]&96)>>5;t.l+=1;var n=$G(t,0,r);return[a,n]}function lK(t,s,r){var a=(t[t.l]&96)>>5;t.l+=1;var n=t.read_shift(2);r&&r.biff==5&&(t.l+=12);var i=FB(t,0,r);return[a,n,i]}function oK(t,s,r){var a=(t[t.l]&96)>>5;t.l+=1;var n=t.read_shift(r&&r.biff<=3?1:2);return[uz[n],DB[n],a]}function cK(t,s,r){var a=t[t.l++],n=t.read_shift(1),i=r&&r.biff<=3?[a==88?-1:0,t.read_shift(1)]:dK(t);return[n,(i[0]===0?DB:dz)[i[1]]]}function dK(t){return[t[t.l+1]>>7,t.read_shift(2)&32767]}function uK(t,s,r){t.l+=r&&r.biff==2?3:4}function mK(t,s,r){if(t.l++,r&&r.biff==12)return[t.read_shift(4,"i"),0];var a=t.read_shift(2),n=t.read_shift(r&&r.biff==2?1:2);return[a,n]}function hK(t){return t.l++,_d[t.read_shift(1)]}function AK(t){return t.l++,t.read_shift(2)}function fK(t){return t.l++,t.read_shift(1)!==0}function pK(t){return t.l++,ji(t)}function xK(t,s,r){return t.l++,np(t,s-1,r)}function gK(t,s){var r=[t.read_shift(1)];if(s==12)switch(r[0]){case 2:r[0]=4;break;case 4:r[0]=16;break;case 0:r[0]=1;break;case 1:r[0]=2;break}switch(r[0]){case 4:r[1]=$a(t,1)?"TRUE":"FALSE",s!=12&&(t.l+=7);break;case 37:case 16:r[1]=_d[t[t.l]],t.l+=s==12?4:8;break;case 0:t.l+=8;break;case 1:r[1]=ji(t);break;case 2:r[1]=Mm(t,0,{biff:s>0&&s<8?2:s});break;default:throw new Error("Bad SerAr: "+r[0])}return r}function vK(t,s,r){for(var a=t.read_shift(r.biff==12?4:2),n=[],i=0;i!=a;++i)n.push((r.biff==12?Om:Lg)(t));return n}function bK(t,s,r){var a=0,n=0;r.biff==12?(a=t.read_shift(4),n=t.read_shift(4)):(n=1+t.read_shift(1),a=1+t.read_shift(2)),r.biff>=2&&r.biff<8&&(--a,--n==0&&(n=256));for(var i=0,l=[];i!=a&&(l[i]=[]);++i)for(var o=0;o!=n;++o)l[i][o]=gK(t,r.biff);return l}function yK(t,s,r){var a=t.read_shift(1)>>>5&3,n=!r||r.biff>=8?4:2,i=t.read_shift(n);switch(r.biff){case 2:t.l+=5;break;case 3:case 4:t.l+=8;break;case 5:t.l+=12;break}return[a,0,i]}function jK(t,s,r){if(r.biff==5)return NK(t);var a=t.read_shift(1)>>>5&3,n=t.read_shift(2),i=t.read_shift(4);return[a,n,i]}function NK(t){var s=t.read_shift(1)>>>5&3,r=t.read_shift(2,"i");t.l+=8;var a=t.read_shift(2);return t.l+=12,[s,r,a]}function wK(t,s,r){var a=t.read_shift(1)>>>5&3;t.l+=r&&r.biff==2?3:4;var n=t.read_shift(r&&r.biff==2?1:2);return[a,n]}function _K(t,s,r){var a=t.read_shift(1)>>>5&3,n=t.read_shift(r&&r.biff==2?1:2);return[a,n]}function SK(t,s,r){var a=t.read_shift(1)>>>5&3;return t.l+=4,r.biff<8&&t.l--,r.biff==12&&(t.l+=2),[a]}function CK(t,s,r){var a=(t[t.l++]&96)>>5,n=t.read_shift(2),i=4;if(r)switch(r.biff){case 5:i=15;break;case 12:i=6;break}return t.l+=i,[a,n]}var kK=_i,EK=_i,BK=_i;function lp(t,s,r){return t.l+=2,[qG(t)]}function DN(t){return t.l+=6,[]}var FK=lp,TK=DN,IK=DN,LK=lp;function IB(t){return t.l+=2,[nn(t),t.read_shift(2)&1]}var DK=lp,PK=IB,UK=DN,RK=lp,OK=lp,MK=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function QK(t){t.l+=2;var s=t.read_shift(2),r=t.read_shift(2),a=t.read_shift(4),n=t.read_shift(2),i=t.read_shift(2),l=MK[r>>2&31];return{ixti:s,coltype:r&3,rt:l,idx:a,c:n,C:i}}function HK(t){return t.l+=2,[t.read_shift(4)]}function qK(t,s,r){return t.l+=5,t.l+=2,t.l+=r.biff==2?1:4,["PTGSHEET"]}function $K(t,s,r){return t.l+=r.biff==2?4:5,["PTGENDSHEET"]}function VK(t){var s=t.read_shift(1)>>>5&3,r=t.read_shift(2);return[s,r]}function WK(t){var s=t.read_shift(1)>>>5&3,r=t.read_shift(2);return[s,r]}function GK(t){return t.l+=4,[0,0]}var VS={1:{n:"PtgExp",f:mK},2:{n:"PtgTbl",f:BK},3:{n:"PtgAdd",f:rn},4:{n:"PtgSub",f:rn},5:{n:"PtgMul",f:rn},6:{n:"PtgDiv",f:rn},7:{n:"PtgPower",f:rn},8:{n:"PtgConcat",f:rn},9:{n:"PtgLt",f:rn},10:{n:"PtgLe",f:rn},11:{n:"PtgEq",f:rn},12:{n:"PtgGe",f:rn},13:{n:"PtgGt",f:rn},14:{n:"PtgNe",f:rn},15:{n:"PtgIsect",f:rn},16:{n:"PtgUnion",f:rn},17:{n:"PtgRange",f:rn},18:{n:"PtgUplus",f:rn},19:{n:"PtgUminus",f:rn},20:{n:"PtgPercent",f:rn},21:{n:"PtgParen",f:rn},22:{n:"PtgMissArg",f:rn},23:{n:"PtgStr",f:xK},26:{n:"PtgSheet",f:qK},27:{n:"PtgEndSheet",f:$K},28:{n:"PtgErr",f:hK},29:{n:"PtgBool",f:fK},30:{n:"PtgInt",f:AK},31:{n:"PtgNum",f:pK},32:{n:"PtgArray",f:XG},33:{n:"PtgFunc",f:oK},34:{n:"PtgFuncVar",f:cK},35:{n:"PtgName",f:yK},36:{n:"PtgRef",f:nK},37:{n:"PtgArea",f:WG},38:{n:"PtgMemArea",f:wK},39:{n:"PtgMemErr",f:kK},40:{n:"PtgMemNoMem",f:EK},41:{n:"PtgMemFunc",f:_K},42:{n:"PtgRefErr",f:SK},43:{n:"PtgAreaErr",f:KG},44:{n:"PtgRefN",f:iK},45:{n:"PtgAreaN",f:YG},46:{n:"PtgMemAreaN",f:VK},47:{n:"PtgMemNoMemN",f:WK},57:{n:"PtgNameX",f:jK},58:{n:"PtgRef3d",f:lK},59:{n:"PtgArea3d",f:GG},60:{n:"PtgRefErr3d",f:CK},61:{n:"PtgAreaErr3d",f:zG},255:{}},KK={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},zK={1:{n:"PtgElfLel",f:IB},2:{n:"PtgElfRw",f:RK},3:{n:"PtgElfCol",f:FK},6:{n:"PtgElfRwV",f:OK},7:{n:"PtgElfColV",f:LK},10:{n:"PtgElfRadical",f:DK},11:{n:"PtgElfRadicalS",f:UK},13:{n:"PtgElfColS",f:TK},15:{n:"PtgElfColSV",f:IK},16:{n:"PtgElfRadicalLel",f:PK},25:{n:"PtgList",f:QK},29:{n:"PtgSxName",f:HK},255:{}},YK={0:{n:"PtgAttrNoop",f:GK},1:{n:"PtgAttrSemi",f:sK},2:{n:"PtgAttrIf",f:eK},4:{n:"PtgAttrChoose",f:JG},8:{n:"PtgAttrGoto",f:ZG},16:{n:"PtgAttrSum",f:uK},32:{n:"PtgAttrBaxcel",f:$S},33:{n:"PtgAttrBaxcel",f:$S},64:{n:"PtgAttrSpace",f:rK},65:{n:"PtgAttrSpaceSemi",f:aK},128:{n:"PtgAttrIfError",f:tK},255:{}};function op(t,s,r,a){if(a.biff<8)return _i(t,s);for(var n=t.l+s,i=[],l=0;l!==r.length;++l)switch(r[l][0]){case"PtgArray":r[l][1]=bK(t,0,a),i.push(r[l][1]);break;case"PtgMemArea":r[l][2]=vK(t,r[l][1],a),i.push(r[l][2]);break;case"PtgExp":a&&a.biff==12&&(r[l][1][1]=t.read_shift(4),i.push(r[l][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+r[l][0]}return s=n-t.l,s!==0&&i.push(_i(t,s)),i}function cp(t,s,r){for(var a=t.l+s,n,i,l=[];a!=t.l;)s=a-t.l,i=t[t.l],n=VS[i]||VS[KK[i]],(i===24||i===25)&&(n=(i===24?zK:YK)[t[t.l+1]]),!n||!n.f?_i(t,s):l.push([n.n,n.f(t,s,r)]);return l}function XK(t){for(var s=[],r=0;r<t.length;++r){for(var a=t[r],n=[],i=0;i<a.length;++i){var l=a[i];if(l)switch(l[0]){case 2:n.push('"'+l[1].replace(/"/g,'""')+'"');break;default:n.push(l[1])}else n.push("")}s.push(n.join(","))}return s.join(";")}var JK={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function ZK(t,s){if(!t&&!(s&&s.biff<=5&&s.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(t)?"'"+t+"'":t}function LB(t,s,r){if(!t)return"SH33TJSERR0";if(r.biff>8&&(!t.XTI||!t.XTI[s]))return t.SheetNames[s];if(!t.XTI)return"SH33TJSERR6";var a=t.XTI[s];if(r.biff<8)return s>1e4&&(s-=65536),s<0&&(s=-s),s==0?"":t.XTI[s-1];if(!a)return"SH33TJSERR1";var n="";if(r.biff>8)switch(t[a[0]][0]){case 357:return n=a[1]==-1?"#REF":t.SheetNames[a[1]],a[1]==a[2]?n:n+":"+t.SheetNames[a[2]];case 358:return r.SID!=null?t.SheetNames[r.SID]:"SH33TJSSAME"+t[a[0]][0];case 355:default:return"SH33TJSSRC"+t[a[0]][0]}switch(t[a[0]][0][0]){case 1025:return n=a[1]==-1?"#REF":t.SheetNames[a[1]]||"SH33TJSERR3",a[1]==a[2]?n:n+":"+t.SheetNames[a[2]];case 14849:return t[a[0]].slice(1).map(function(i){return i.Name}).join(";;");default:return t[a[0]][0][3]?(n=a[1]==-1?"#REF":t[a[0]][0][3][a[1]]||"SH33TJSERR4",a[1]==a[2]?n:n+":"+t[a[0]][0][3][a[2]]):"SH33TJSERR2"}}function WS(t,s,r){var a=LB(t,s,r);return a=="#REF"?a:ZK(a,r)}function gi(t,s,r,a,n){var i=n&&n.biff||8,l={s:{c:0,r:0}},o=[],d,u,c,h=0,m=0,p,g="";if(!t[0]||!t[0][0])return"";for(var x=-1,b="",y=0,j=t[0].length;y<j;++y){var N=t[0][y];switch(N[0]){case"PtgUminus":o.push("-"+o.pop());break;case"PtgUplus":o.push("+"+o.pop());break;case"PtgPercent":o.push(o.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(d=o.pop(),u=o.pop(),x>=0){switch(t[0][x][1][0]){case 0:b=Ia(" ",t[0][x][1][1]);break;case 1:b=Ia("\r",t[0][x][1][1]);break;default:if(b="",n.WTF)throw new Error("Unexpected PtgAttrSpaceType "+t[0][x][1][0])}u=u+b,x=-1}o.push(u+JK[N[0]]+d);break;case"PtgIsect":d=o.pop(),u=o.pop(),o.push(u+" "+d);break;case"PtgUnion":d=o.pop(),u=o.pop(),o.push(u+","+d);break;case"PtgRange":d=o.pop(),u=o.pop(),o.push(u+":"+d);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":c=uf(N[1][1],l,n),o.push(mf(c,i));break;case"PtgRefN":c=r?uf(N[1][1],r,n):N[1][1],o.push(mf(c,i));break;case"PtgRef3d":h=N[1][1],c=uf(N[1][2],l,n),g=WS(a,h,n),o.push(g+"!"+mf(c,i));break;case"PtgFunc":case"PtgFuncVar":var _=N[1][0],F=N[1][1];_||(_=0),_&=127;var I=_==0?[]:o.slice(-_);o.length-=_,F==="User"&&(F=I.shift()),o.push(F+"("+I.join(",")+")");break;case"PtgBool":o.push(N[1]?"TRUE":"FALSE");break;case"PtgInt":o.push(N[1]);break;case"PtgNum":o.push(String(N[1]));break;case"PtgStr":o.push('"'+N[1].replace(/"/g,'""')+'"');break;case"PtgErr":o.push(N[1]);break;case"PtgAreaN":p=yS(N[1][1],r?{s:r}:l,n),o.push(Ib(p,n));break;case"PtgArea":p=yS(N[1][1],l,n),o.push(Ib(p,n));break;case"PtgArea3d":h=N[1][1],p=N[1][2],g=WS(a,h,n),o.push(g+"!"+Ib(p,n));break;case"PtgAttrSum":o.push("SUM("+o.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":m=N[1][2];var w=(a.names||[])[m-1]||(a[0]||[])[m],E=w?w.Name:"SH33TJSNAME"+String(m);E&&E.slice(0,6)=="_xlfn."&&!n.xlfn&&(E=E.slice(6)),o.push(E);break;case"PtgNameX":var W=N[1][1];m=N[1][2];var R;if(n.biff<=5)W<0&&(W=-W),a[W]&&(R=a[W][m]);else{var U="";if(((a[W]||[])[0]||[])[0]==14849||(((a[W]||[])[0]||[])[0]==1025?a[W][m]&&a[W][m].itab>0&&(U=a.SheetNames[a[W][m].itab-1]+"!"):U=a.SheetNames[m-1]+"!"),a[W]&&a[W][m])U+=a[W][m].Name;else if(a[0]&&a[0][m])U+=a[0][m].Name;else{var T=(LB(a,W,n)||"").split(";;");T[m-1]?U=T[m-1]:U+="SH33TJSERRX"}o.push(U);break}R||(R={Name:"SH33TJSERRY"}),o.push(R.Name);break;case"PtgParen":var Y="(",H=")";if(x>=0){switch(b="",t[0][x][1][0]){case 2:Y=Ia(" ",t[0][x][1][1])+Y;break;case 3:Y=Ia("\r",t[0][x][1][1])+Y;break;case 4:H=Ia(" ",t[0][x][1][1])+H;break;case 5:H=Ia("\r",t[0][x][1][1])+H;break;default:if(n.WTF)throw new Error("Unexpected PtgAttrSpaceType "+t[0][x][1][0])}x=-1}o.push(Y+o.pop()+H);break;case"PtgRefErr":o.push("#REF!");break;case"PtgRefErr3d":o.push("#REF!");break;case"PtgExp":c={c:N[1][1],r:N[1][0]};var M={c:r.c,r:r.r};if(a.sharedf[Ks(c)]){var q=a.sharedf[Ks(c)];o.push(gi(q,l,M,a,n))}else{var z=!1;for(d=0;d!=a.arrayf.length;++d)if(u=a.arrayf[d],!(c.c<u[0].s.c||c.c>u[0].e.c)&&!(c.r<u[0].s.r||c.r>u[0].e.r)){o.push(gi(u[1],l,M,a,n)),z=!0;break}z||o.push(N[1])}break;case"PtgArray":o.push("{"+XK(N[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":x=y;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":o.push("");break;case"PtgAreaErr":o.push("#REF!");break;case"PtgAreaErr3d":o.push("#REF!");break;case"PtgList":o.push("Table"+N[1].idx+"[#"+N[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(N));default:throw new Error("Unrecognized Formula Token: "+String(N))}var Q=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(n.biff!=3&&x>=0&&Q.indexOf(t[0][y][0])==-1){N=t[0][x];var L=!0;switch(N[1][0]){case 4:L=!1;case 0:b=Ia(" ",N[1][1]);break;case 5:L=!1;case 1:b=Ia("\r",N[1][1]);break;default:if(b="",n.WTF)throw new Error("Unexpected PtgAttrSpaceType "+N[1][0])}o.push((L?b:"")+o.pop()+(L?"":b)),x=-1}}if(o.length>1&&n.WTF)throw new Error("bad formula stack");return o[0]}function ez(t,s,r){var a=t.l+s,n=r.biff==2?1:2,i,l=t.read_shift(n);if(l==65535)return[[],_i(t,s-2)];var o=cp(t,l,r);return s!==l+n&&(i=op(t,s-l-n,o,r)),t.l=a,[o,i]}function tz(t,s,r){var a=t.l+s,n=r.biff==2?1:2,i,l=t.read_shift(n);if(l==65535)return[[],_i(t,s-2)];var o=cp(t,l,r);return s!==l+n&&(i=op(t,s-l-n,o,r)),t.l=a,[o,i]}function sz(t,s,r,a){var n=t.l+s,i=cp(t,a,r),l;return n!==t.l&&(l=op(t,n-t.l,i,r)),[i,l]}function rz(t,s,r){var a=t.l+s,n,i=t.read_shift(2),l=cp(t,i,r);return i==65535?[[],_i(t,s-2)]:(s!==i+2&&(n=op(t,a-i-2,l,r)),[l,n])}function az(t){var s;if(cd(t,t.l+6)!==65535)return[ji(t),"n"];switch(t[t.l]){case 0:return t.l+=8,["String","s"];case 1:return s=t[t.l+2]===1,t.l+=8,[s,"b"];case 2:return s=t[t.l+2],t.l+=8,[s,"e"];case 3:return t.l+=8,["","s"]}return[]}function nz(t){if(t==null){var s=Zt(8);return s.write_shift(1,3),s.write_shift(1,0),s.write_shift(2,0),s.write_shift(2,0),s.write_shift(2,65535),s}else if(typeof t=="number")return Bm(t);return Bm(0)}function Rb(t,s,r){var a=t.l+s,n=Dc(t);r.biff==2&&++t.l;var i=az(t),l=t.read_shift(1);r.biff!=2&&(t.read_shift(1),r.biff>=5&&t.read_shift(4));var o=tz(t,a-t.l,r);return{cell:n,val:i[0],formula:o,shared:l>>3&1,tt:i[1]}}function iz(t,s,r,a,n){var i=Tm(s,r,n),l=nz(t.v),o=Zt(6),d=33;o.write_shift(2,d),o.write_shift(4,0);for(var u=Zt(t.bf.length),c=0;c<t.bf.length;++c)u[c]=t.bf[c];var h=Fn([i,l,o,u]);return h}function Dg(t,s,r){var a=t.read_shift(4),n=cp(t,a,r),i=t.read_shift(4),l=i>0?op(t,i,n,r):null;return[n,l]}var lz=Dg,Pg=Dg,oz=Dg,cz=Dg,dz={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},DB={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},uz={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function GS(t){return t.slice(0,3)=="of:"&&(t=t.slice(3)),t.charCodeAt(0)==61&&(t=t.slice(1),t.charCodeAt(0)==61&&(t=t.slice(1))),t=t.replace(/COM\.MICROSOFT\./g,""),t=t.replace(/\[((?:\.[A-Z]+[0-9]+)(?::\.[A-Z]+[0-9]+)?)\]/g,function(s,r){return r.replace(/\./g,"")}),t=t.replace(/\[.(#[A-Z]*[?!])\]/g,"$1"),t.replace(/[;~]/g,",").replace(/\|/g,";")}function mz(t){var s="of:="+t.replace(IN,"$1[.$2$3$4$5]").replace(/\]:\[/g,":");return s.replace(/;/g,"|").replace(/,/g,";")}function Ob(t){var s=t.split(":"),r=s[0].split(".")[0];return[r,s[0].split(".")[1]+(s.length>1?":"+(s[1].split(".")[1]||s[1].split(".")[0]):"")]}function hz(t){return t.replace(/\./,"!")}var Af={},Qh={},ff=typeof Map<"u";function PN(t,s,r){var a=0,n=t.length;if(r){if(ff?r.has(s):Object.prototype.hasOwnProperty.call(r,s)){for(var i=ff?r.get(s):r[s];a<i.length;++a)if(t[i[a]].t===s)return t.Count++,i[a]}}else for(;a<n;++a)if(t[a].t===s)return t.Count++,a;return t[n]={t:s},t.Count++,t.Unique++,r&&(ff?(r.has(s)||r.set(s,[]),r.get(s).push(n)):(Object.prototype.hasOwnProperty.call(r,s)||(r[s]=[]),r[s].push(n))),n}function Ug(t,s){var r={min:t+1,max:t+1},a=-1;return s.MDW&&(vi=s.MDW),s.width!=null?r.customWidth=1:s.wpx!=null?a=Of(s.wpx):s.wch!=null&&(a=s.wch),a>-1?(r.width=W0(a),r.customWidth=1):s.width!=null&&(r.width=s.width),s.hidden&&(r.hidden=!0),s.level!=null&&(r.outlineLevel=r.level=s.level),r}function _m(t,s){if(t){var r=[.7,.7,.75,.75,.3,.3];s=="xlml"&&(r=[1,1,1,1,.5,.5]),t.left==null&&(t.left=r[0]),t.right==null&&(t.right=r[1]),t.top==null&&(t.top=r[2]),t.bottom==null&&(t.bottom=r[3]),t.header==null&&(t.header=r[4]),t.footer==null&&(t.footer=r[5])}}function Du(t,s,r){var a=r.revssf[s.z!=null?s.z:"General"],n=60,i=t.length;if(a==null&&r.ssf){for(;n<392;++n)if(r.ssf[n]==null){fd(s.z,n),r.ssf[n]=s.z,r.revssf[s.z]=a=n;break}}for(n=0;n!=i;++n)if(t[n].numFmtId===a)return n;return t[i]={numFmtId:a,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},i}function PB(t,s,r,a,n,i){try{a.cellNF&&(t.z=Vs[s])}catch(o){if(a.WTF)throw o}if(!(t.t==="z"&&!a.cellStyles)){if(t.t==="d"&&typeof t.v=="string"&&(t.v=ma(t.v)),(!a||a.cellText!==!1)&&t.t!=="z")try{if(Vs[s]==null&&fd(d9[s]||"General",s),t.t==="e")t.w=t.w||_d[t.v];else if(s===0)if(t.t==="n")(t.v|0)===t.v?t.w=t.v.toString(10):t.w=Tf(t.v);else if(t.t==="d"){var l=pn(t.v);(l|0)===l?t.w=l.toString(10):t.w=Tf(l)}else{if(t.v===void 0)return"";t.w=km(t.v,Qh)}else t.t==="d"?t.w=io(s,pn(t.v),Qh):t.w=io(s,t.v,Qh)}catch(o){if(a.WTF)throw o}if(a.cellStyles&&r!=null)try{t.s=i.Fills[r],t.s.fgColor&&t.s.fgColor.theme&&!t.s.fgColor.rgb&&(t.s.fgColor.rgb=V0(n.themeElements.clrScheme[t.s.fgColor.theme].rgb,t.s.fgColor.tint||0),a.WTF&&(t.s.fgColor.raw_rgb=n.themeElements.clrScheme[t.s.fgColor.theme].rgb)),t.s.bgColor&&t.s.bgColor.theme&&(t.s.bgColor.rgb=V0(n.themeElements.clrScheme[t.s.bgColor.theme].rgb,t.s.bgColor.tint||0),a.WTF&&(t.s.bgColor.raw_rgb=n.themeElements.clrScheme[t.s.bgColor.theme].rgb))}catch(o){if(a.WTF&&i.Fills)throw o}}}function Az(t,s,r){if(t&&t["!ref"]){var a=Cr(t["!ref"]);if(a.e.c<a.s.c||a.e.r<a.s.r)throw new Error("Bad range ("+r+"): "+t["!ref"])}}function fz(t,s){var r=Cr(s);r.s.r<=r.e.r&&r.s.c<=r.e.c&&r.s.r>=0&&r.s.c>=0&&(t["!ref"]=lr(r))}var pz=/<(?:\w:)?mergeCell ref="[A-Z0-9:]+"\s*[\/]?>/g,xz=/<(?:\w+:)?sheetData[^>]*>([\s\S]*)<\/(?:\w+:)?sheetData>/,gz=/<(?:\w:)?hyperlink [^>]*>/mg,vz=/"(\w*:\w*)"/,bz=/<(?:\w:)?col\b[^>]*[\/]?>/g,yz=/<(?:\w:)?autoFilter[^>]*([\/]|>([\s\S]*)<\/(?:\w:)?autoFilter)>/g,jz=/<(?:\w:)?pageMargins[^>]*\/>/g,UB=/<(?:\w:)?sheetPr\b(?:[^>a-z][^>]*)?\/>/,Nz=/<(?:\w:)?sheetPr[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetPr)>/,wz=/<(?:\w:)?sheetViews[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetViews)>/;function _z(t,s,r,a,n,i,l){if(!t)return t;a||(a={"!id":{}});var o=s.dense?[]:{},d={s:{r:2e6,c:2e6},e:{r:0,c:0}},u="",c="",h=t.match(xz);h?(u=t.slice(0,h.index),c=t.slice(h.index+h[0].length)):u=c=t;var m=u.match(UB);m?UN(m[0],o,n,r):(m=u.match(Nz))&&Cz(m[0],m[1]||"",o,n,r);var p=(u.match(/<(?:\w*:)?dimension/)||{index:-1}).index;if(p>0){var g=u.slice(p,p+50).match(vz);g&&fz(o,g[1])}var x=u.match(wz);x&&x[1]&&Mz(x[1],n);var b=[];if(s.cellStyles){var y=u.match(bz);y&&Dz(b,y)}h&&qz(h[1],o,s,d,i,l);var j=c.match(yz);j&&(o["!autofilter"]=Uz(j[0]));var N=[],_=c.match(pz);if(_)for(p=0;p!=_.length;++p)N[p]=Cr(_[p].slice(_[p].indexOf('"')+1));var F=c.match(gz);F&&Tz(o,F,a);var I=c.match(jz);if(I&&(o["!margins"]=Iz(Ys(I[0]))),!o["!ref"]&&d.e.c>=d.s.c&&d.e.r>=d.s.r&&(o["!ref"]=lr(d)),s.sheetRows>0&&o["!ref"]){var w=Cr(o["!ref"]);s.sheetRows<=+w.e.r&&(w.e.r=s.sheetRows-1,w.e.r>d.e.r&&(w.e.r=d.e.r),w.e.r<w.s.r&&(w.s.r=w.e.r),w.e.c>d.e.c&&(w.e.c=d.e.c),w.e.c<w.s.c&&(w.s.c=w.e.c),o["!fullref"]=o["!ref"],o["!ref"]=lr(w))}return b.length>0&&(o["!cols"]=b),N.length>0&&(o["!merges"]=N),o}function Sz(t){if(t.length===0)return"";for(var s='<mergeCells count="'+t.length+'">',r=0;r!=t.length;++r)s+='<mergeCell ref="'+lr(t[r])+'"/>';return s+"</mergeCells>"}function UN(t,s,r,a){var n=Ys(t);r.Sheets[a]||(r.Sheets[a]={}),n.codeName&&(r.Sheets[a].CodeName=Sr(Xr(n.codeName)))}function Cz(t,s,r,a,n){UN(t.slice(0,t.indexOf(">")),r,a,n)}function kz(t,s,r,a,n){var i=!1,l={},o=null;if(a.bookType!=="xlsx"&&s.vbaraw){var d=s.SheetNames[r];try{s.Workbook&&(d=s.Workbook.Sheets[r].CodeName||d)}catch{}i=!0,l.codeName=Nc(Gr(d))}if(t&&t["!outline"]){var u={summaryBelow:1,summaryRight:1};t["!outline"].above&&(u.summaryBelow=0),t["!outline"].left&&(u.summaryRight=0),o=(o||"")+gs("outlinePr",null,u)}!i&&!o||(n[n.length]=gs("sheetPr",o,l))}var Ez=["objects","scenarios","selectLockedCells","selectUnlockedCells"],Bz=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function Fz(t){var s={sheet:1};return Ez.forEach(function(r){t[r]!=null&&t[r]&&(s[r]="1")}),Bz.forEach(function(r){t[r]!=null&&!t[r]&&(s[r]="0")}),t.password&&(s.password=BN(t.password).toString(16).toUpperCase()),gs("sheetProtection",null,s)}function Tz(t,s,r){for(var a=Array.isArray(t),n=0;n!=s.length;++n){var i=Ys(Xr(s[n]),!0);if(!i.ref)return;var l=((r||{})["!id"]||[])[i.id];l?(i.Target=l.Target,i.location&&(i.Target+="#"+Sr(i.location))):(i.Target="#"+Sr(i.location),l={Target:i.Target,TargetMode:"Internal"}),i.Rel=l,i.tooltip&&(i.Tooltip=i.tooltip,delete i.tooltip);for(var o=Cr(i.ref),d=o.s.r;d<=o.e.r;++d)for(var u=o.s.c;u<=o.e.c;++u){var c=Ks({c:u,r:d});a?(t[d]||(t[d]=[]),t[d][u]||(t[d][u]={t:"z",v:void 0}),t[d][u].l=i):(t[c]||(t[c]={t:"z",v:void 0}),t[c].l=i)}}}function Iz(t){var s={};return["left","right","top","bottom","header","footer"].forEach(function(r){t[r]&&(s[r]=parseFloat(t[r]))}),s}function Lz(t){return _m(t),gs("pageMargins",null,t)}function Dz(t,s){for(var r=!1,a=0;a!=s.length;++a){var n=Ys(s[a],!0);n.hidden&&(n.hidden=da(n.hidden));var i=parseInt(n.min,10)-1,l=parseInt(n.max,10)-1;for(n.outlineLevel&&(n.level=+n.outlineLevel||0),delete n.min,delete n.max,n.width=+n.width,!r&&n.width&&(r=!0,FN(n.width)),Bu(n);i<=l;)t[i++]=ha(n)}}function Pz(t,s){for(var r=["<cols>"],a,n=0;n!=s.length;++n)(a=s[n])&&(r[r.length]=gs("col",null,Ug(n,a)));return r[r.length]="</cols>",r.join("")}function Uz(t){var s={ref:(t.match(/ref="([^"]*)"/)||[])[1]};return s}function Rz(t,s,r,a){var n=typeof t.ref=="string"?t.ref:lr(t.ref);r.Workbook||(r.Workbook={Sheets:[]}),r.Workbook.Names||(r.Workbook.Names=[]);var i=r.Workbook.Names,l=ml(n);l.s.r==l.e.r&&(l.e.r=ml(s["!ref"]).e.r,n=lr(l));for(var o=0;o<i.length;++o){var d=i[o];if(d.Name=="_xlnm._FilterDatabase"&&d.Sheet==a){d.Ref="'"+r.SheetNames[a]+"'!"+n;break}}return o==i.length&&i.push({Name:"_xlnm._FilterDatabase",Sheet:a,Ref:"'"+r.SheetNames[a]+"'!"+n}),gs("autoFilter",null,{ref:n})}var Oz=/<(?:\w:)?sheetView(?:[^>a-z][^>]*)?\/?>/;function Mz(t,s){s.Views||(s.Views=[{}]),(t.match(Oz)||[]).forEach(function(r,a){var n=Ys(r);s.Views[a]||(s.Views[a]={}),+n.zoomScale&&(s.Views[a].zoom=+n.zoomScale),da(n.rightToLeft)&&(s.Views[a].RTL=!0)})}function Qz(t,s,r,a){var n={workbookViewId:"0"};return(((a||{}).Workbook||{}).Views||[])[0]&&(n.rightToLeft=a.Workbook.Views[0].RTL?"1":"0"),gs("sheetViews",gs("sheetView",null,n),{})}function Hz(t,s,r,a){if(t.c&&r["!comments"].push([s,t.c]),t.v===void 0&&typeof t.f!="string"||t.t==="z"&&!t.f)return"";var n="",i=t.t,l=t.v;if(t.t!=="z")switch(t.t){case"b":n=t.v?"1":"0";break;case"n":n=""+t.v;break;case"e":n=_d[t.v];break;case"d":a&&a.cellDates?n=ma(t.v,-1).toISOString():(t=ha(t),t.t="n",n=""+(t.v=pn(ma(t.v)))),typeof t.z>"u"&&(t.z=Vs[14]);break;default:n=t.v;break}var o=Kn("v",Gr(n)),d={r:s},u=Du(a.cellXfs,t,a);switch(u!==0&&(d.s=u),t.t){case"n":break;case"d":d.t="d";break;case"b":d.t="b";break;case"e":d.t="e";break;case"z":break;default:if(t.v==null){delete t.t;break}if(t.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(a&&a.bookSST){o=Kn("v",""+PN(a.Strings,t.v,a.revStrings)),d.t="s";break}d.t="str";break}if(t.t!=i&&(t.t=i,t.v=l),typeof t.f=="string"&&t.f){var c=t.F&&t.F.slice(0,s.length)==s?{t:"array",ref:t.F}:null;o=gs("f",Gr(t.f),c)+(t.v!=null?o:"")}return t.l&&r["!links"].push([s,t.l]),t.D&&(d.cm=1),gs("c",o,d)}var qz=(function(){var t=/<(?:\w+:)?c[ \/>]/,s=/<\/(?:\w+:)?row>/,r=/r=["']([^"']*)["']/,a=/<(?:\w+:)?is>([\S\s]*?)<\/(?:\w+:)?is>/,n=/ref=["']([^"']*)["']/,i=If("v"),l=If("f");return function(d,u,c,h,m,p){for(var g=0,x="",b=[],y=[],j=0,N=0,_=0,F="",I,w,E=0,W=0,R,U,T=0,Y=0,H=Array.isArray(p.CellXf),M,q=[],z=[],Q=Array.isArray(u),L=[],V={},P=!1,C=!!c.sheetStubs,k=d.split(s),B=0,G=k.length;B!=G;++B){x=k[B].trim();var O=x.length;if(O!==0){var K=0;e:for(g=0;g<O;++g)switch(x[g]){case">":if(x[g-1]!="/"){++g;break e}if(c&&c.cellStyles){if(w=Ys(x.slice(K,g),!0),E=w.r!=null?parseInt(w.r,10):E+1,W=-1,c.sheetRows&&c.sheetRows<E)continue;V={},P=!1,w.ht&&(P=!0,V.hpt=parseFloat(w.ht),V.hpx=zh(V.hpt)),w.hidden=="1"&&(P=!0,V.hidden=!0),w.outlineLevel!=null&&(P=!0,V.level=+w.outlineLevel),P&&(L[E-1]=V)}break;case"<":K=g;break}if(K>=g)break;if(w=Ys(x.slice(K,g),!0),E=w.r!=null?parseInt(w.r,10):E+1,W=-1,!(c.sheetRows&&c.sheetRows<E)){h.s.r>E-1&&(h.s.r=E-1),h.e.r<E-1&&(h.e.r=E-1),c&&c.cellStyles&&(V={},P=!1,w.ht&&(P=!0,V.hpt=parseFloat(w.ht),V.hpx=zh(V.hpt)),w.hidden=="1"&&(P=!0,V.hidden=!0),w.outlineLevel!=null&&(P=!0,V.level=+w.outlineLevel),P&&(L[E-1]=V)),b=x.slice(g).split(t);for(var J=0;J!=b.length&&b[J].trim().charAt(0)=="<";++J);for(b=b.slice(J),g=0;g!=b.length;++g)if(x=b[g].trim(),x.length!==0){if(y=x.match(r),j=g,N=0,_=0,x="<c "+(x.slice(0,1)=="<"?">":"")+x,y!=null&&y.length===2){for(j=0,F=y[1],N=0;N!=F.length&&!((_=F.charCodeAt(N)-64)<1||_>26);++N)j=26*j+_;--j,W=j}else++W;for(N=0;N!=x.length&&x.charCodeAt(N)!==62;++N);if(++N,w=Ys(x.slice(0,N),!0),w.r||(w.r=Ks({r:E-1,c:W})),F=x.slice(N),I={t:""},(y=F.match(i))!=null&&y[1]!==""&&(I.v=Sr(y[1])),c.cellFormula){if((y=F.match(l))!=null&&y[1]!==""){if(I.f=Sr(Xr(y[1])).replace(/\r\n/g,`
`),c.xlfn||(I.f=qS(I.f)),y[0].indexOf('t="array"')>-1)I.F=(F.match(n)||[])[1],I.F.indexOf(":")>-1&&q.push([Cr(I.F),I.F]);else if(y[0].indexOf('t="shared"')>-1){U=Ys(y[0]);var te=Sr(Xr(y[1]));c.xlfn||(te=qS(te)),z[parseInt(U.si,10)]=[U,te,w.r]}}else(y=F.match(/<f[^>]*\/>/))&&(U=Ys(y[0]),z[U.si]&&(I.f=OG(z[U.si][1],z[U.si][2],w.r)));var se=wa(w.r);for(N=0;N<q.length;++N)se.r>=q[N][0].s.r&&se.r<=q[N][0].e.r&&se.c>=q[N][0].s.c&&se.c<=q[N][0].e.c&&(I.F=q[N][1])}if(w.t==null&&I.v===void 0)if(I.f||I.F)I.v=0,I.t="n";else if(C)I.t="z";else continue;else I.t=w.t||"n";switch(h.s.c>W&&(h.s.c=W),h.e.c<W&&(h.e.c=W),I.t){case"n":if(I.v==""||I.v==null){if(!C)continue;I.t="z"}else I.v=parseFloat(I.v);break;case"s":if(typeof I.v>"u"){if(!C)continue;I.t="z"}else R=Af[parseInt(I.v,10)],I.v=R.t,I.r=R.r,c.cellHTML&&(I.h=R.h);break;case"str":I.t="s",I.v=I.v!=null?Xr(I.v):"",c.cellHTML&&(I.h=fN(I.v));break;case"inlineStr":y=F.match(a),I.t="s",y!=null&&(R=EN(y[1]))?(I.v=R.t,c.cellHTML&&(I.h=R.h)):I.v="";break;case"b":I.v=da(I.v);break;case"d":c.cellDates?I.v=ma(I.v,1):(I.v=pn(ma(I.v,1)),I.t="n");break;case"e":(!c||c.cellText!==!1)&&(I.w=I.v),I.v=OE[I.v];break}if(T=Y=0,M=null,H&&w.s!==void 0&&(M=p.CellXf[w.s],M!=null&&(M.numFmtId!=null&&(T=M.numFmtId),c.cellStyles&&M.fillId!=null&&(Y=M.fillId))),PB(I,T,Y,c,m,p),c.cellDates&&H&&I.t=="n"&&nA(Vs[T])&&(I.t="d",I.v=Ig(I.v)),w.cm&&c.xlmeta){var ae=(c.xlmeta.Cell||[])[+w.cm-1];ae&&ae.type=="XLDAPR"&&(I.D=!0)}if(Q){var ne=wa(w.r);u[ne.r]||(u[ne.r]=[]),u[ne.r][ne.c]=I}else u[w.r]=I}}}}L.length>0&&(u["!rows"]=L)}})();function $z(t,s,r,a){var n=[],i=[],l=Cr(t["!ref"]),o="",d,u="",c=[],h=0,m=0,p=t["!rows"],g=Array.isArray(t),x={r:u},b,y=-1;for(m=l.s.c;m<=l.e.c;++m)c[m]=Na(m);for(h=l.s.r;h<=l.e.r;++h){for(i=[],u=za(h),m=l.s.c;m<=l.e.c;++m){d=c[m]+u;var j=g?(t[h]||[])[m]:t[d];j!==void 0&&(o=Hz(j,d,t,s))!=null&&i.push(o)}(i.length>0||p&&p[h])&&(x={r:u},p&&p[h]&&(b=p[h],b.hidden&&(x.hidden=1),y=-1,b.hpx?y=Mf(b.hpx):b.hpt&&(y=b.hpt),y>-1&&(x.ht=y,x.customHeight=1),b.level&&(x.outlineLevel=b.level)),n[n.length]=gs("row",i.join(""),x))}if(p)for(;h<p.length;++h)p&&p[h]&&(x={r:h+1},b=p[h],b.hidden&&(x.hidden=1),y=-1,b.hpx?y=Mf(b.hpx):b.hpt&&(y=b.hpt),y>-1&&(x.ht=y,x.customHeight=1),b.level&&(x.outlineLevel=b.level),n[n.length]=gs("row","",x));return n.join("")}function RB(t,s,r,a){var n=[Xa,gs("worksheet",null,{xmlns:Dm[0],"xmlns:r":fn.r})],i=r.SheetNames[t],l=0,o="",d=r.Sheets[i];d==null&&(d={});var u=d["!ref"]||"A1",c=Cr(u);if(c.e.c>16383||c.e.r>1048575){if(s.WTF)throw new Error("Range "+u+" exceeds format limit A1:XFD1048576");c.e.c=Math.min(c.e.c,16383),c.e.r=Math.min(c.e.c,1048575),u=lr(c)}a||(a={}),d["!comments"]=[];var h=[];kz(d,r,t,s,n),n[n.length]=gs("dimension",null,{ref:u}),n[n.length]=Qz(d,s,t,r),s.sheetFormat&&(n[n.length]=gs("sheetFormatPr",null,{defaultRowHeight:s.sheetFormat.defaultRowHeight||"16",baseColWidth:s.sheetFormat.baseColWidth||"10",outlineLevelRow:s.sheetFormat.outlineLevelRow||"7"})),d["!cols"]!=null&&d["!cols"].length>0&&(n[n.length]=Pz(d,d["!cols"])),n[l=n.length]="<sheetData/>",d["!links"]=[],d["!ref"]!=null&&(o=$z(d,s),o.length>0&&(n[n.length]=o)),n.length>l+1&&(n[n.length]="</sheetData>",n[l]=n[l].replace("/>",">")),d["!protect"]&&(n[n.length]=Fz(d["!protect"])),d["!autofilter"]!=null&&(n[n.length]=Rz(d["!autofilter"],d,r,t)),d["!merges"]!=null&&d["!merges"].length>0&&(n[n.length]=Sz(d["!merges"]));var m=-1,p,g=-1;return d["!links"].length>0&&(n[n.length]="<hyperlinks>",d["!links"].forEach(function(x){x[1].Target&&(p={ref:x[0]},x[1].Target.charAt(0)!="#"&&(g=Vr(a,-1,Gr(x[1].Target).replace(/#.*$/,""),fr.HLINK),p["r:id"]="rId"+g),(m=x[1].Target.indexOf("#"))>-1&&(p.location=Gr(x[1].Target.slice(m+1))),x[1].Tooltip&&(p.tooltip=Gr(x[1].Tooltip)),n[n.length]=gs("hyperlink",null,p))}),n[n.length]="</hyperlinks>"),delete d["!links"],d["!margins"]!=null&&(n[n.length]=Lz(d["!margins"])),(!s||s.ignoreEC||s.ignoreEC==null)&&(n[n.length]=Kn("ignoredErrors",gs("ignoredError",null,{numberStoredAsText:1,sqref:u}))),h.length>0&&(g=Vr(a,-1,"../drawings/drawing"+(t+1)+".xml",fr.DRAW),n[n.length]=gs("drawing",null,{"r:id":"rId"+g}),d["!drawing"]=h),d["!comments"].length>0&&(g=Vr(a,-1,"../drawings/vmlDrawing"+(t+1)+".vml",fr.VML),n[n.length]=gs("legacyDrawing",null,{"r:id":"rId"+g}),d["!legacy"]=g),n.length>1&&(n[n.length]="</worksheet>",n[1]=n[1].replace("/>",">")),n.join("")}function Vz(t,s){var r={},a=t.l+s;r.r=t.read_shift(4),t.l+=4;var n=t.read_shift(2);t.l+=1;var i=t.read_shift(1);return t.l=a,i&7&&(r.level=i&7),i&16&&(r.hidden=!0),i&32&&(r.hpt=n/20),r}function Wz(t,s,r){var a=Zt(145),n=(r["!rows"]||[])[t]||{};a.write_shift(4,t),a.write_shift(4,0);var i=320;n.hpx?i=Mf(n.hpx)*20:n.hpt&&(i=n.hpt*20),a.write_shift(2,i),a.write_shift(1,0);var l=0;n.level&&(l|=n.level),n.hidden&&(l|=16),(n.hpx||n.hpt)&&(l|=32),a.write_shift(1,l),a.write_shift(1,0);var o=0,d=a.l;a.l+=4;for(var u={r:t,c:0},c=0;c<16;++c)if(!(s.s.c>c+1<<10||s.e.c<c<<10)){for(var h=-1,m=-1,p=c<<10;p<c+1<<10;++p){u.c=p;var g=Array.isArray(r)?(r[u.r]||[])[u.c]:r[Ks(u)];g&&(h<0&&(h=p),m=p)}h<0||(++o,a.write_shift(4,h),a.write_shift(4,m))}var x=a.l;return a.l=d,a.write_shift(4,o),a.l=x,a.length>a.l?a.slice(0,a.l):a}function Gz(t,s,r,a){var n=Wz(a,r,s);(n.length>17||(s["!rows"]||[])[a])&&ls(t,0,n)}var Kz=Om,zz=oA;function Yz(){}function Xz(t,s){var r={},a=t[t.l];return++t.l,r.above=!(a&64),r.left=!(a&128),t.l+=18,r.name=eq(t),r}function Jz(t,s,r){r==null&&(r=Zt(84+4*t.length));var a=192;s&&(s.above&&(a&=-65),s.left&&(a&=-129)),r.write_shift(1,a);for(var n=1;n<3;++n)r.write_shift(1,0);return H0({auto:1},r),r.write_shift(-4,-1),r.write_shift(-4,-1),LE(t,r),r.slice(0,r.l)}function Zz(t){var s=oo(t);return[s]}function eY(t,s,r){return r==null&&(r=Zt(8)),Pm(s,r)}function tY(t){var s=Um(t);return[s]}function sY(t,s,r){return r==null&&(r=Zt(4)),Rm(s,r)}function rY(t){var s=oo(t),r=t.read_shift(1);return[s,r,"b"]}function aY(t,s,r){return r==null&&(r=Zt(9)),Pm(s,r),r.write_shift(1,t.v?1:0),r}function nY(t){var s=Um(t),r=t.read_shift(1);return[s,r,"b"]}function iY(t,s,r){return r==null&&(r=Zt(5)),Rm(s,r),r.write_shift(1,t.v?1:0),r}function lY(t){var s=oo(t),r=t.read_shift(1);return[s,r,"e"]}function oY(t,s,r){return r==null&&(r=Zt(9)),Pm(s,r),r.write_shift(1,t.v),r}function cY(t){var s=Um(t),r=t.read_shift(1);return[s,r,"e"]}function dY(t,s,r){return r==null&&(r=Zt(8)),Rm(s,r),r.write_shift(1,t.v),r.write_shift(2,0),r.write_shift(1,0),r}function uY(t){var s=oo(t),r=t.read_shift(4);return[s,r,"s"]}function mY(t,s,r){return r==null&&(r=Zt(12)),Pm(s,r),r.write_shift(4,s.v),r}function hY(t){var s=Um(t),r=t.read_shift(4);return[s,r,"s"]}function AY(t,s,r){return r==null&&(r=Zt(8)),Rm(s,r),r.write_shift(4,s.v),r}function fY(t){var s=oo(t),r=ji(t);return[s,r,"n"]}function pY(t,s,r){return r==null&&(r=Zt(16)),Pm(s,r),Bm(t.v,r),r}function OB(t){var s=Um(t),r=ji(t);return[s,r,"n"]}function xY(t,s,r){return r==null&&(r=Zt(12)),Rm(s,r),Bm(t.v,r),r}function gY(t){var s=oo(t),r=wN(t);return[s,r,"n"]}function vY(t,s,r){return r==null&&(r=Zt(12)),Pm(s,r),DE(t.v,r),r}function bY(t){var s=Um(t),r=wN(t);return[s,r,"n"]}function yY(t,s,r){return r==null&&(r=Zt(8)),Rm(s,r),DE(t.v,r),r}function jY(t){var s=oo(t),r=yN(t);return[s,r,"is"]}function NY(t){var s=oo(t),r=Ni(t);return[s,r,"str"]}function wY(t,s,r){return r==null&&(r=Zt(12+4*t.v.length)),Pm(s,r),Tn(t.v,r),r.length>r.l?r.slice(0,r.l):r}function _Y(t){var s=Um(t),r=Ni(t);return[s,r,"str"]}function SY(t,s,r){return r==null&&(r=Zt(8+4*t.v.length)),Rm(s,r),Tn(t.v,r),r.length>r.l?r.slice(0,r.l):r}function CY(t,s,r){var a=t.l+s,n=oo(t);n.r=r["!row"];var i=t.read_shift(1),l=[n,i,"b"];if(r.cellFormula){t.l+=2;var o=Pg(t,a-t.l,r);l[3]=gi(o,null,n,r.supbooks,r)}else t.l=a;return l}function kY(t,s,r){var a=t.l+s,n=oo(t);n.r=r["!row"];var i=t.read_shift(1),l=[n,i,"e"];if(r.cellFormula){t.l+=2;var o=Pg(t,a-t.l,r);l[3]=gi(o,null,n,r.supbooks,r)}else t.l=a;return l}function EY(t,s,r){var a=t.l+s,n=oo(t);n.r=r["!row"];var i=ji(t),l=[n,i,"n"];if(r.cellFormula){t.l+=2;var o=Pg(t,a-t.l,r);l[3]=gi(o,null,n,r.supbooks,r)}else t.l=a;return l}function BY(t,s,r){var a=t.l+s,n=oo(t);n.r=r["!row"];var i=Ni(t),l=[n,i,"str"];if(r.cellFormula){t.l+=2;var o=Pg(t,a-t.l,r);l[3]=gi(o,null,n,r.supbooks,r)}else t.l=a;return l}var FY=Om,TY=oA;function IY(t,s){return s==null&&(s=Zt(4)),s.write_shift(4,t),s}function LY(t,s){var r=t.l+s,a=Om(t),n=jN(t),i=Ni(t),l=Ni(t),o=Ni(t);t.l=r;var d={rfx:a,relId:n,loc:i,display:o};return l&&(d.Tooltip=l),d}function DY(t,s){var r=Zt(50+4*(t[1].Target.length+(t[1].Tooltip||"").length));oA({s:wa(t[0]),e:wa(t[0])},r),NN("rId"+s,r);var a=t[1].Target.indexOf("#"),n=a==-1?"":t[1].Target.slice(a+1);return Tn(n||"",r),Tn(t[1].Tooltip||"",r),Tn("",r),r.slice(0,r.l)}function PY(){}function UY(t,s,r){var a=t.l+s,n=PE(t),i=t.read_shift(1),l=[n];if(l[2]=i,r.cellFormula){var o=lz(t,a-t.l,r);l[1]=o}else t.l=a;return l}function RY(t,s,r){var a=t.l+s,n=Om(t),i=[n];if(r.cellFormula){var l=cz(t,a-t.l,r);i[1]=l,t.l=a}else t.l=a;return i}function OY(t,s,r){r==null&&(r=Zt(18));var a=Ug(t,s);r.write_shift(-4,t),r.write_shift(-4,t),r.write_shift(4,(a.width||10)*256),r.write_shift(4,0);var n=0;return s.hidden&&(n|=1),typeof a.width=="number"&&(n|=2),s.level&&(n|=s.level<<8),r.write_shift(2,n),r}var MB=["left","right","top","bottom","header","footer"];function MY(t){var s={};return MB.forEach(function(r){s[r]=ji(t)}),s}function QY(t,s){return s==null&&(s=Zt(48)),_m(t),MB.forEach(function(r){Bm(t[r],s)}),s}function HY(t){var s=t.read_shift(2);return t.l+=28,{RTL:s&32}}function qY(t,s,r){r==null&&(r=Zt(30));var a=924;return(((s||{}).Views||[])[0]||{}).RTL&&(a|=32),r.write_shift(2,a),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(2,0),r.write_shift(2,100),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(4,0),r}function $Y(t){var s=Zt(24);return s.write_shift(4,4),s.write_shift(4,1),oA(t,s),s}function VY(t,s){return s==null&&(s=Zt(66)),s.write_shift(2,t.password?BN(t.password):0),s.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(r){r[1]?s.write_shift(4,t[r[0]]!=null&&!t[r[0]]?1:0):s.write_shift(4,t[r[0]]!=null&&t[r[0]]?0:1)}),s}function WY(){}function GY(){}function KY(t,s,r,a,n,i,l){if(!t)return t;var o=s||{};a||(a={"!id":{}});var d=o.dense?[]:{},u,c={s:{r:2e6,c:2e6},e:{r:0,c:0}},h=!1,m=!1,p,g,x,b,y,j,N,_,F,I=[];o.biff=12,o["!row"]=0;var w=0,E=!1,W=[],R={},U=o.supbooks||n.supbooks||[[]];if(U.sharedf=R,U.arrayf=W,U.SheetNames=n.SheetNames||n.Sheets.map(function(Q){return Q.name}),!o.supbooks&&(o.supbooks=U,n.Names))for(var T=0;T<n.Names.length;++T)U[0][T+1]=n.Names[T];var Y=[],H=[],M=!1;Qf[16]={n:"BrtShortReal",f:OB};var q;if(wd(t,function(L,V,P){if(!m)switch(P){case 148:u=L;break;case 0:p=L,o.sheetRows&&o.sheetRows<=p.r&&(m=!0),_=za(b=p.r),o["!row"]=p.r,(L.hidden||L.hpt||L.level!=null)&&(L.hpt&&(L.hpx=zh(L.hpt)),H[L.r]=L);break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 17:case 18:case 62:switch(g={t:L[2]},L[2]){case"n":g.v=L[1];break;case"s":N=Af[L[1]],g.v=N.t,g.r=N.r;break;case"b":g.v=!!L[1];break;case"e":g.v=L[1],o.cellText!==!1&&(g.w=_d[g.v]);break;case"str":g.t="s",g.v=L[1];break;case"is":g.t="s",g.v=L[1].t;break}if((x=l.CellXf[L[0].iStyleRef])&&PB(g,x.numFmtId,null,o,i,l),y=L[0].c==-1?y+1:L[0].c,o.dense?(d[b]||(d[b]=[]),d[b][y]=g):d[Na(y)+_]=g,o.cellFormula){for(E=!1,w=0;w<W.length;++w){var C=W[w];p.r>=C[0].s.r&&p.r<=C[0].e.r&&y>=C[0].s.c&&y<=C[0].e.c&&(g.F=lr(C[0]),E=!0)}!E&&L.length>3&&(g.f=L[3])}if(c.s.r>p.r&&(c.s.r=p.r),c.s.c>y&&(c.s.c=y),c.e.r<p.r&&(c.e.r=p.r),c.e.c<y&&(c.e.c=y),o.cellDates&&x&&g.t=="n"&&nA(Vs[x.numFmtId])){var k=pm(g.v);k&&(g.t="d",g.v=new Date(k.y,k.m-1,k.d,k.H,k.M,k.S,k.u))}q&&(q.type=="XLDAPR"&&(g.D=!0),q=void 0);break;case 1:case 12:if(!o.sheetStubs||h)break;g={t:"z",v:void 0},y=L[0].c==-1?y+1:L[0].c,o.dense?(d[b]||(d[b]=[]),d[b][y]=g):d[Na(y)+_]=g,c.s.r>p.r&&(c.s.r=p.r),c.s.c>y&&(c.s.c=y),c.e.r<p.r&&(c.e.r=p.r),c.e.c<y&&(c.e.c=y),q&&(q.type=="XLDAPR"&&(g.D=!0),q=void 0);break;case 176:I.push(L);break;case 49:q=((o.xlmeta||{}).Cell||[])[L-1];break;case 494:var B=a["!id"][L.relId];for(B?(L.Target=B.Target,L.loc&&(L.Target+="#"+L.loc),L.Rel=B):L.relId==""&&(L.Target="#"+L.loc),b=L.rfx.s.r;b<=L.rfx.e.r;++b)for(y=L.rfx.s.c;y<=L.rfx.e.c;++y)o.dense?(d[b]||(d[b]=[]),d[b][y]||(d[b][y]={t:"z",v:void 0}),d[b][y].l=L):(j=Ks({c:y,r:b}),d[j]||(d[j]={t:"z",v:void 0}),d[j].l=L);break;case 426:if(!o.cellFormula)break;W.push(L),F=o.dense?d[b][y]:d[Na(y)+_],F.f=gi(L[1],c,{r:p.r,c:y},U,o),F.F=lr(L[0]);break;case 427:if(!o.cellFormula)break;R[Ks(L[0].s)]=L[1],F=o.dense?d[b][y]:d[Na(y)+_],F.f=gi(L[1],c,{r:p.r,c:y},U,o);break;case 60:if(!o.cellStyles)break;for(;L.e>=L.s;)Y[L.e--]={width:L.w/256,hidden:!!(L.flags&1),level:L.level},M||(M=!0,FN(L.w/256)),Bu(Y[L.e+1]);break;case 161:d["!autofilter"]={ref:lr(L)};break;case 476:d["!margins"]=L;break;case 147:n.Sheets[r]||(n.Sheets[r]={}),L.name&&(n.Sheets[r].CodeName=L.name),(L.above||L.left)&&(d["!outline"]={above:L.above,left:L.left});break;case 137:n.Views||(n.Views=[{}]),n.Views[0]||(n.Views[0]={}),L.RTL&&(n.Views[0].RTL=!0);break;case 485:break;case 64:case 1053:break;case 151:break;case 152:case 175:case 644:case 625:case 562:case 396:case 1112:case 1146:case 471:case 1050:case 649:case 1105:case 589:case 607:case 564:case 1055:case 168:case 174:case 1180:case 499:case 507:case 550:case 171:case 167:case 1177:case 169:case 1181:case 551:case 552:case 661:case 639:case 478:case 537:case 477:case 536:case 1103:case 680:case 1104:case 1024:case 663:case 535:case 678:case 504:case 1043:case 428:case 170:case 3072:case 50:case 2070:case 1045:break;case 35:h=!0;break;case 36:h=!1;break;case 37:h=!0;break;case 38:h=!1;break;default:if(!V.T){if(!h||o.WTF)throw new Error("Unexpected record 0x"+P.toString(16))}}},o),delete o.supbooks,delete o["!row"],!d["!ref"]&&(c.s.r<2e6||u&&(u.e.r>0||u.e.c>0||u.s.r>0||u.s.c>0))&&(d["!ref"]=lr(u||c)),o.sheetRows&&d["!ref"]){var z=Cr(d["!ref"]);o.sheetRows<=+z.e.r&&(z.e.r=o.sheetRows-1,z.e.r>c.e.r&&(z.e.r=c.e.r),z.e.r<z.s.r&&(z.s.r=z.e.r),z.e.c>c.e.c&&(z.e.c=c.e.c),z.e.c<z.s.c&&(z.s.c=z.e.c),d["!fullref"]=d["!ref"],d["!ref"]=lr(z))}return I.length>0&&(d["!merges"]=I),Y.length>0&&(d["!cols"]=Y),H.length>0&&(d["!rows"]=H),d}function zY(t,s,r,a,n,i,l){if(s.v===void 0)return!1;var o="";switch(s.t){case"b":o=s.v?"1":"0";break;case"d":s=ha(s),s.z=s.z||Vs[14],s.v=pn(ma(s.v)),s.t="n";break;case"n":case"e":o=""+s.v;break;default:o=s.v;break}var d={r,c:a};switch(d.s=Du(n.cellXfs,s,n),s.l&&i["!links"].push([Ks(d),s.l]),s.c&&i["!comments"].push([Ks(d),s.c]),s.t){case"s":case"str":return n.bookSST?(o=PN(n.Strings,s.v,n.revStrings),d.t="s",d.v=o,l?ls(t,18,AY(s,d)):ls(t,7,mY(s,d))):(d.t="str",l?ls(t,17,SY(s,d)):ls(t,6,wY(s,d))),!0;case"n":return s.v==(s.v|0)&&s.v>-1e3&&s.v<1e3?l?ls(t,13,yY(s,d)):ls(t,2,vY(s,d)):l?ls(t,16,xY(s,d)):ls(t,5,pY(s,d)),!0;case"b":return d.t="b",l?ls(t,15,iY(s,d)):ls(t,4,aY(s,d)),!0;case"e":return d.t="e",l?ls(t,14,dY(s,d)):ls(t,3,oY(s,d)),!0}return l?ls(t,12,sY(s,d)):ls(t,1,eY(s,d)),!0}function YY(t,s,r,a){var n=Cr(s["!ref"]||"A1"),i,l="",o=[];ls(t,145);var d=Array.isArray(s),u=n.e.r;s["!rows"]&&(u=Math.max(n.e.r,s["!rows"].length-1));for(var c=n.s.r;c<=u;++c){l=za(c),Gz(t,s,n,c);var h=!1;if(c<=n.e.r)for(var m=n.s.c;m<=n.e.c;++m){c===n.s.r&&(o[m]=Na(m)),i=o[m]+l;var p=d?(s[c]||[])[m]:s[i];if(!p){h=!1;continue}h=zY(t,p,c,m,a,s,h)}}ls(t,146)}function XY(t,s){!s||!s["!merges"]||(ls(t,177,IY(s["!merges"].length)),s["!merges"].forEach(function(r){ls(t,176,TY(r))}),ls(t,178))}function JY(t,s){!s||!s["!cols"]||(ls(t,390),s["!cols"].forEach(function(r,a){r&&ls(t,60,OY(a,r))}),ls(t,391))}function ZY(t,s){!s||!s["!ref"]||(ls(t,648),ls(t,649,$Y(Cr(s["!ref"]))),ls(t,650))}function eX(t,s,r){s["!links"].forEach(function(a){if(a[1].Target){var n=Vr(r,-1,a[1].Target.replace(/#.*$/,""),fr.HLINK);ls(t,494,DY(a,n))}}),delete s["!links"]}function tX(t,s,r,a){if(s["!comments"].length>0){var n=Vr(a,-1,"../drawings/vmlDrawing"+(r+1)+".vml",fr.VML);ls(t,551,NN("rId"+n)),s["!legacy"]=n}}function sX(t,s,r,a){if(s["!autofilter"]){var n=s["!autofilter"],i=typeof n.ref=="string"?n.ref:lr(n.ref);r.Workbook||(r.Workbook={Sheets:[]}),r.Workbook.Names||(r.Workbook.Names=[]);var l=r.Workbook.Names,o=ml(i);o.s.r==o.e.r&&(o.e.r=ml(s["!ref"]).e.r,i=lr(o));for(var d=0;d<l.length;++d){var u=l[d];if(u.Name=="_xlnm._FilterDatabase"&&u.Sheet==a){u.Ref="'"+r.SheetNames[a]+"'!"+i;break}}d==l.length&&l.push({Name:"_xlnm._FilterDatabase",Sheet:a,Ref:"'"+r.SheetNames[a]+"'!"+i}),ls(t,161,oA(Cr(i))),ls(t,162)}}function rX(t,s,r){ls(t,133),ls(t,137,qY(s,r)),ls(t,138),ls(t,134)}function aX(t,s){s["!protect"]&&ls(t,535,VY(s["!protect"]))}function nX(t,s,r,a){var n=ul(),i=r.SheetNames[t],l=r.Sheets[i]||{},o=i;try{r&&r.Workbook&&(o=r.Workbook.Sheets[t].CodeName||o)}catch{}var d=Cr(l["!ref"]||"A1");if(d.e.c>16383||d.e.r>1048575){if(s.WTF)throw new Error("Range "+(l["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");d.e.c=Math.min(d.e.c,16383),d.e.r=Math.min(d.e.c,1048575)}return l["!links"]=[],l["!comments"]=[],ls(n,129),(r.vbaraw||l["!outline"])&&ls(n,147,Jz(o,l["!outline"])),ls(n,148,zz(d)),rX(n,l,r.Workbook),JY(n,l),YY(n,l,t,s),aX(n,l),sX(n,l,r,t),XY(n,l),eX(n,l,a),l["!margins"]&&ls(n,476,QY(l["!margins"])),(!s||s.ignoreEC||s.ignoreEC==null)&&ZY(n,l),tX(n,l,t,a),ls(n,130),n.end()}function iX(t){var s=[],r=t.match(/^<c:numCache>/),a;(t.match(/<c:pt idx="(\d*)">(.*?)<\/c:pt>/mg)||[]).forEach(function(i){var l=i.match(/<c:pt idx="(\d*?)"><c:v>(.*)<\/c:v><\/c:pt>/);l&&(s[+l[1]]=r?+l[2]:l[2])});var n=Sr((t.match(/<c:formatCode>([\s\S]*?)<\/c:formatCode>/)||["","General"])[1]);return(t.match(/<c:f>(.*?)<\/c:f>/mg)||[]).forEach(function(i){a=i.replace(/<.*?>/g,"")}),[s,n,a]}function lX(t,s,r,a,n,i){var l=i||{"!type":"chart"};if(!t)return i;var o=0,d=0,u="A",c={s:{r:2e6,c:2e6},e:{r:0,c:0}};return(t.match(/<c:numCache>[\s\S]*?<\/c:numCache>/gm)||[]).forEach(function(h){var m=iX(h);c.s.r=c.s.c=0,c.e.c=o,u=Na(o),m[0].forEach(function(p,g){l[u+za(g)]={t:"n",v:p,z:m[1]},d=g}),c.e.r<d&&(c.e.r=d),++o}),o>0&&(l["!ref"]=lr(c)),l}function oX(t,s,r,a,n){if(!t)return t;a||(a={"!id":{}});var i={"!type":"chart","!drawel":null,"!rel":""},l,o=t.match(UB);return o&&UN(o[0],i,n,r),(l=t.match(/drawing r:id="(.*?)"/))&&(i["!rel"]=l[1]),a["!id"][i["!rel"]]&&(i["!drawel"]=a["!id"][i["!rel"]]),i}function cX(t,s){t.l+=10;var r=Ni(t);return{name:r}}function dX(t,s,r,a,n){if(!t)return t;a||(a={"!id":{}});var i={"!type":"chart","!drawel":null,"!rel":""},l=!1;return wd(t,function(d,u,c){switch(c){case 550:i["!rel"]=d;break;case 651:n.Sheets[r]||(n.Sheets[r]={}),d.name&&(n.Sheets[r].CodeName=d.name);break;case 562:case 652:case 669:case 679:case 551:case 552:case 476:case 3072:break;case 35:l=!0;break;case 36:l=!1;break;case 37:break;case 38:break;default:if(!(u.T>0)){if(!(u.T<0)){if(!l||s.WTF)throw new Error("Unexpected record 0x"+c.toString(16))}}}},s),a["!id"][i["!rel"]]&&(i["!drawel"]=a["!id"][i["!rel"]]),i}var RN=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],uX=[["activeTab",0,"int"],["autoFilterDateGrouping",!0,"bool"],["firstSheet",0,"int"],["minimized",!1,"bool"],["showHorizontalScroll",!0,"bool"],["showSheetTabs",!0,"bool"],["showVerticalScroll",!0,"bool"],["tabRatio",600,"int"],["visibility","visible"]],mX=[],hX=[["calcCompleted","true"],["calcMode","auto"],["calcOnSave","true"],["concurrentCalc","true"],["fullCalcOnLoad","false"],["fullPrecision","true"],["iterate","false"],["iterateCount","100"],["iterateDelta","0.001"],["refMode","A1"]];function KS(t,s){for(var r=0;r!=t.length;++r)for(var a=t[r],n=0;n!=s.length;++n){var i=s[n];if(a[i[0]]==null)a[i[0]]=i[1];else switch(i[2]){case"bool":typeof a[i[0]]=="string"&&(a[i[0]]=da(a[i[0]]));break;case"int":typeof a[i[0]]=="string"&&(a[i[0]]=parseInt(a[i[0]],10));break}}}function zS(t,s){for(var r=0;r!=s.length;++r){var a=s[r];if(t[a[0]]==null)t[a[0]]=a[1];else switch(a[2]){case"bool":typeof t[a[0]]=="string"&&(t[a[0]]=da(t[a[0]]));break;case"int":typeof t[a[0]]=="string"&&(t[a[0]]=parseInt(t[a[0]],10));break}}}function QB(t){zS(t.WBProps,RN),zS(t.CalcPr,hX),KS(t.WBView,uX),KS(t.Sheets,mX),Qh.date1904=da(t.WBProps.date1904)}function AX(t){return!t.Workbook||!t.Workbook.WBProps?"false":da(t.Workbook.WBProps.date1904)?"true":"false"}var fX="][*?/\\".split("");function HB(t,s){if(t.length>31)throw new Error("Sheet names cannot exceed 31 chars");var r=!0;return fX.forEach(function(a){if(t.indexOf(a)!=-1)throw new Error("Sheet name cannot contain : \\ / ? * [ ]")}),r}function pX(t,s,r){t.forEach(function(a,n){HB(a);for(var i=0;i<n;++i)if(a==t[i])throw new Error("Duplicate Sheet Name: "+a);if(r){var l=s&&s[n]&&s[n].CodeName||a;if(l.charCodeAt(0)==95&&l.length>22)throw new Error("Bad Code Name: Worksheet"+l)}})}function xX(t){if(!t||!t.SheetNames||!t.Sheets)throw new Error("Invalid Workbook");if(!t.SheetNames.length)throw new Error("Workbook is empty");var s=t.Workbook&&t.Workbook.Sheets||[];pX(t.SheetNames,s,!!t.vbaraw);for(var r=0;r<t.SheetNames.length;++r)Az(t.Sheets[t.SheetNames[r]],t.SheetNames[r],r)}var gX=/<\w+:workbook/;function vX(t,s){if(!t)throw new Error("Could not find file");var r={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},Names:[],xmlns:""},a=!1,n="xmlns",i={},l=0;if(t.replace(Si,function(d,u){var c=Ys(d);switch(Lc(c[0])){case"<?xml":break;case"<workbook":d.match(gX)&&(n="xmlns"+d.match(/<(\w+):/)[1]),r.xmlns=c[n];break;case"</workbook>":break;case"<fileVersion":delete c[0],r.AppVersion=c;break;case"<fileVersion/>":case"</fileVersion>":break;case"<fileSharing":break;case"<fileSharing/>":break;case"<workbookPr":case"<workbookPr/>":RN.forEach(function(h){if(c[h[0]]!=null)switch(h[2]){case"bool":r.WBProps[h[0]]=da(c[h[0]]);break;case"int":r.WBProps[h[0]]=parseInt(c[h[0]],10);break;default:r.WBProps[h[0]]=c[h[0]]}}),c.codeName&&(r.WBProps.CodeName=Xr(c.codeName));break;case"</workbookPr>":break;case"<workbookProtection":break;case"<workbookProtection/>":break;case"<bookViews":case"<bookViews>":case"</bookViews>":break;case"<workbookView":case"<workbookView/>":delete c[0],r.WBView.push(c);break;case"</workbookView>":break;case"<sheets":case"<sheets>":case"</sheets>":break;case"<sheet":switch(c.state){case"hidden":c.Hidden=1;break;case"veryHidden":c.Hidden=2;break;default:c.Hidden=0}delete c.state,c.name=Sr(Xr(c.name)),delete c[0],r.Sheets.push(c);break;case"</sheet>":break;case"<functionGroups":case"<functionGroups/>":break;case"<functionGroup":break;case"<externalReferences":case"</externalReferences>":case"<externalReferences>":break;case"<externalReference":break;case"<definedNames/>":break;case"<definedNames>":case"<definedNames":a=!0;break;case"</definedNames>":a=!1;break;case"<definedName":i={},i.Name=Xr(c.name),c.comment&&(i.Comment=c.comment),c.localSheetId&&(i.Sheet=+c.localSheetId),da(c.hidden||"0")&&(i.Hidden=!0),l=u+d.length;break;case"</definedName>":i.Ref=Sr(Xr(t.slice(l,u))),r.Names.push(i);break;case"<definedName/>":break;case"<calcPr":delete c[0],r.CalcPr=c;break;case"<calcPr/>":delete c[0],r.CalcPr=c;break;case"</calcPr>":break;case"<oleSize":break;case"<customWorkbookViews>":case"</customWorkbookViews>":case"<customWorkbookViews":break;case"<customWorkbookView":case"</customWorkbookView>":break;case"<pivotCaches>":case"</pivotCaches>":case"<pivotCaches":break;case"<pivotCache":break;case"<smartTagPr":case"<smartTagPr/>":break;case"<smartTagTypes":case"<smartTagTypes>":case"</smartTagTypes>":break;case"<smartTagType":break;case"<webPublishing":case"<webPublishing/>":break;case"<fileRecoveryPr":case"<fileRecoveryPr/>":break;case"<webPublishObjects>":case"<webPublishObjects":case"</webPublishObjects>":break;case"<webPublishObject":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":a=!0;break;case"</ext>":a=!1;break;case"<ArchID":break;case"<AlternateContent":case"<AlternateContent>":a=!0;break;case"</AlternateContent>":a=!1;break;case"<revisionPtr":break;default:if(!a&&s.WTF)throw new Error("unrecognized "+c[0]+" in workbook")}return d}),Dm.indexOf(r.xmlns)===-1)throw new Error("Unknown Namespace: "+r.xmlns);return QB(r),r}function qB(t){var s=[Xa];s[s.length]=gs("workbook",null,{xmlns:Dm[0],"xmlns:r":fn.r});var r=t.Workbook&&(t.Workbook.Names||[]).length>0,a={codeName:"ThisWorkbook"};t.Workbook&&t.Workbook.WBProps&&(RN.forEach(function(o){t.Workbook.WBProps[o[0]]!=null&&t.Workbook.WBProps[o[0]]!=o[1]&&(a[o[0]]=t.Workbook.WBProps[o[0]])}),t.Workbook.WBProps.CodeName&&(a.codeName=t.Workbook.WBProps.CodeName,delete a.CodeName)),s[s.length]=gs("workbookPr",null,a);var n=t.Workbook&&t.Workbook.Sheets||[],i=0;if(n&&n[0]&&n[0].Hidden){for(s[s.length]="<bookViews>",i=0;i!=t.SheetNames.length&&!(!n[i]||!n[i].Hidden);++i);i==t.SheetNames.length&&(i=0),s[s.length]='<workbookView firstSheet="'+i+'" activeTab="'+i+'"/>',s[s.length]="</bookViews>"}for(s[s.length]="<sheets>",i=0;i!=t.SheetNames.length;++i){var l={name:Gr(t.SheetNames[i].slice(0,31))};if(l.sheetId=""+(i+1),l["r:id"]="rId"+(i+1),n[i])switch(n[i].Hidden){case 1:l.state="hidden";break;case 2:l.state="veryHidden";break}s[s.length]=gs("sheet",null,l)}return s[s.length]="</sheets>",r&&(s[s.length]="<definedNames>",t.Workbook&&t.Workbook.Names&&t.Workbook.Names.forEach(function(o){var d={name:o.Name};o.Comment&&(d.comment=o.Comment),o.Sheet!=null&&(d.localSheetId=""+o.Sheet),o.Hidden&&(d.hidden="1"),o.Ref&&(s[s.length]=gs("definedName",Gr(o.Ref),d))}),s[s.length]="</definedNames>"),s.length>2&&(s[s.length]="</workbook>",s[1]=s[1].replace("/>",">")),s.join("")}function bX(t,s){var r={};return r.Hidden=t.read_shift(4),r.iTabID=t.read_shift(4),r.strRelID=uj(t),r.name=Ni(t),r}function yX(t,s){return s||(s=Zt(127)),s.write_shift(4,t.Hidden),s.write_shift(4,t.iTabID),NN(t.strRelID,s),Tn(t.name.slice(0,31),s),s.length>s.l?s.slice(0,s.l):s}function jX(t,s){var r={},a=t.read_shift(4);r.defaultThemeVersion=t.read_shift(4);var n=s>8?Ni(t):"";return n.length>0&&(r.CodeName=n),r.autoCompressPictures=!!(a&65536),r.backupFile=!!(a&64),r.checkCompatibility=!!(a&4096),r.date1904=!!(a&1),r.filterPrivacy=!!(a&8),r.hidePivotFieldList=!!(a&1024),r.promptedSolutions=!!(a&16),r.publishItems=!!(a&2048),r.refreshAllConnections=!!(a&262144),r.saveExternalLinkValues=!!(a&128),r.showBorderUnselectedTables=!!(a&4),r.showInkAnnotation=!!(a&32),r.showObjects=["all","placeholders","none"][a>>13&3],r.showPivotChartFilter=!!(a&32768),r.updateLinks=["userSet","never","always"][a>>8&3],r}function NX(t,s){s||(s=Zt(72));var r=0;return t&&t.filterPrivacy&&(r|=8),s.write_shift(4,r),s.write_shift(4,0),LE(t&&t.CodeName||"ThisWorkbook",s),s.slice(0,s.l)}function wX(t,s){var r={};return t.read_shift(4),r.ArchID=t.read_shift(4),t.l+=s-8,r}function _X(t,s,r){var a=t.l+s;t.l+=4,t.l+=1;var n=t.read_shift(4),i=tq(t),l=oz(t,0,r),o=jN(t);t.l=a;var d={Name:i,Ptg:l};return n<268435455&&(d.Sheet=n),o&&(d.Comment=o),d}function SX(t,s){var r={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""},a=[],n=!1;s||(s={}),s.biff=12;var i=[],l=[[]];return l.SheetNames=[],l.XTI=[],Qf[16]={n:"BrtFRTArchID$",f:wX},wd(t,function(d,u,c){switch(c){case 156:l.SheetNames.push(d.name),r.Sheets.push(d);break;case 153:r.WBProps=d;break;case 39:d.Sheet!=null&&(s.SID=d.Sheet),d.Ref=gi(d.Ptg,null,null,l,s),delete s.SID,delete d.Ptg,i.push(d);break;case 1036:break;case 357:case 358:case 355:case 667:l[0].length?l.push([c,d]):l[0]=[c,d],l[l.length-1].XTI=[];break;case 362:l.length===0&&(l[0]=[],l[0].XTI=[]),l[l.length-1].XTI=l[l.length-1].XTI.concat(d),l.XTI=l.XTI.concat(d);break;case 361:break;case 2071:case 158:case 143:case 664:case 353:break;case 3072:case 3073:case 534:case 677:case 157:case 610:case 2050:case 155:case 548:case 676:case 128:case 665:case 2128:case 2125:case 549:case 2053:case 596:case 2076:case 2075:case 2082:case 397:case 154:case 1117:case 553:case 2091:break;case 35:a.push(c),n=!0;break;case 36:a.pop(),n=!1;break;case 37:a.push(c),n=!0;break;case 38:a.pop(),n=!1;break;case 16:break;default:if(!u.T){if(!n||s.WTF&&a[a.length-1]!=37&&a[a.length-1]!=35)throw new Error("Unexpected record 0x"+c.toString(16))}}},s),QB(r),r.Names=i,r.supbooks=l,r}function CX(t,s){ls(t,143);for(var r=0;r!=s.SheetNames.length;++r){var a=s.Workbook&&s.Workbook.Sheets&&s.Workbook.Sheets[r]&&s.Workbook.Sheets[r].Hidden||0,n={Hidden:a,iTabID:r+1,strRelID:"rId"+(r+1),name:s.SheetNames[r]};ls(t,156,yX(n))}ls(t,144)}function kX(t,s){s||(s=Zt(127));for(var r=0;r!=4;++r)s.write_shift(4,0);return Tn("SheetJS",s),Tn(D0.version,s),Tn(D0.version,s),Tn("7262",s),s.length>s.l?s.slice(0,s.l):s}function EX(t,s){s||(s=Zt(29)),s.write_shift(-4,0),s.write_shift(-4,460),s.write_shift(4,28800),s.write_shift(4,17600),s.write_shift(4,500),s.write_shift(4,t),s.write_shift(4,t);var r=120;return s.write_shift(1,r),s.length>s.l?s.slice(0,s.l):s}function BX(t,s){if(!(!s.Workbook||!s.Workbook.Sheets)){for(var r=s.Workbook.Sheets,a=0,n=-1,i=-1;a<r.length;++a)!r[a]||!r[a].Hidden&&n==-1?n=a:r[a].Hidden==1&&i==-1&&(i=a);i>n||(ls(t,135),ls(t,158,EX(n)),ls(t,136))}}function FX(t,s){var r=ul();return ls(r,131),ls(r,128,kX()),ls(r,153,NX(t.Workbook&&t.Workbook.WBProps||null)),BX(r,t),CX(r,t),ls(r,132),r.end()}function TX(t,s,r){return s.slice(-4)===".bin"?SX(t,r):vX(t,r)}function IX(t,s,r,a,n,i,l,o){return s.slice(-4)===".bin"?KY(t,a,r,n,i,l,o):_z(t,a,r,n,i,l,o)}function LX(t,s,r,a,n,i,l,o){return s.slice(-4)===".bin"?dX(t,a,r,n,i):oX(t,a,r,n,i)}function DX(t,s,r,a,n,i,l,o){return s.slice(-4)===".bin"?UG():RG()}function PX(t,s,r,a,n,i,l,o){return s.slice(-4)===".bin"?DG():PG()}function UX(t,s,r,a){return s.slice(-4)===".bin"?TW(t,r,a):bW(t,r,a)}function RX(t,s,r){return NB(t,r)}function OX(t,s,r){return s.slice(-4)===".bin"?OV(t,r):PV(t,r)}function MX(t,s,r){return s.slice(-4)===".bin"?BG(t,r):yG(t,r)}function QX(t,s,r){return s.slice(-4)===".bin"?gG(t):pG(t)}function HX(t,s,r,a){return r.slice(-4)===".bin"?vG(t,s,r,a):void 0}function qX(t,s,r){return s.slice(-4)===".bin"?hG(t,s,r):fG(t,s,r)}function $X(t,s,r){return(s.slice(-4)===".bin"?FX:qB)(t)}function VX(t,s,r,a,n){return(s.slice(-4)===".bin"?nX:RB)(t,r,a,n)}function WX(t,s,r){return(s.slice(-4)===".bin"?HW:yB)(t,r)}function GX(t,s,r){return(s.slice(-4)===".bin"?HV:hB)(t,r)}function KX(t,s,r){return(s.slice(-4)===".bin"?FG:SB)(t)}function zX(t){return(t.slice(-4)===".bin"?AG:wB)()}var $B=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g,VB=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/;function Ro(t,s){var r=t.split(/\s+/),a=[];if(a[0]=r[0],r.length===1)return a;var n=t.match($B),i,l,o,d;if(n)for(d=0;d!=n.length;++d)i=n[d].match(VB),(l=i[1].indexOf(":"))===-1?a[i[1]]=i[2].slice(1,i[2].length-1):(i[1].slice(0,6)==="xmlns:"?o="xmlns"+i[1].slice(6):o=i[1].slice(l+1),a[o]=i[2].slice(1,i[2].length-1));return a}function YX(t){var s=t.split(/\s+/),r={};if(s.length===1)return r;var a=t.match($B),n,i,l,o;if(a)for(o=0;o!=a.length;++o)n=a[o].match(VB),(i=n[1].indexOf(":"))===-1?r[n[1]]=n[2].slice(1,n[2].length-1):(n[1].slice(0,6)==="xmlns:"?l="xmlns"+n[1].slice(6):l=n[1].slice(i+1),r[l]=n[2].slice(1,n[2].length-1));return r}var pf;function XX(t,s){var r=pf[t]||Sr(t);return r==="General"?km(s):io(r,s)}function JX(t,s,r,a){var n=a;switch((r[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":n=da(a);break;case"i2":case"int":n=parseInt(a,10);break;case"r4":case"float":n=parseFloat(a);break;case"date":case"dateTime.tz":n=ma(a);break;case"i8":case"string":case"fixed":case"uuid":case"bin.base64":break;default:throw new Error("bad custprop:"+r[0])}t[Sr(s)]=n}function ZX(t,s,r){if(t.t!=="z"){if(!r||r.cellText!==!1)try{t.t==="e"?t.w=t.w||_d[t.v]:s==="General"?t.t==="n"?(t.v|0)===t.v?t.w=t.v.toString(10):t.w=Tf(t.v):t.w=km(t.v):t.w=XX(s||"General",t.v)}catch(i){if(r.WTF)throw i}try{var a=pf[s]||s||"General";if(r.cellNF&&(t.z=a),r.cellDates&&t.t=="n"&&nA(a)){var n=pm(t.v);n&&(t.t="d",t.v=new Date(n.y,n.m-1,n.d,n.H,n.M,n.S,n.u))}}catch(i){if(r.WTF)throw i}}}function eJ(t,s,r){if(r.cellStyles&&s.Interior){var a=s.Interior;a.Pattern&&(a.patternType=mW[a.Pattern]||a.Pattern)}t[s.ID]=s}function tJ(t,s,r,a,n,i,l,o,d,u){var c="General",h=a.StyleID,m={};u=u||{};var p=[],g=0;for(h===void 0&&o&&(h=o.StyleID),h===void 0&&l&&(h=l.StyleID);i[h]!==void 0&&(i[h].nf&&(c=i[h].nf),i[h].Interior&&p.push(i[h].Interior),!!i[h].Parent);)h=i[h].Parent;switch(r.Type){case"Boolean":a.t="b",a.v=da(t);break;case"String":a.t="s",a.r=mS(Sr(t)),a.v=t.indexOf("<")>-1?Sr(s||t).replace(/<.*?>/g,""):a.r;break;case"DateTime":t.slice(-1)!="Z"&&(t+="Z"),a.v=(ma(t)-new Date(Date.UTC(1899,11,30)))/(1440*60*1e3),a.v!==a.v?a.v=Sr(t):a.v<60&&(a.v=a.v-1),(!c||c=="General")&&(c="yyyy-mm-dd");case"Number":a.v===void 0&&(a.v=+t),a.t||(a.t="n");break;case"Error":a.t="e",a.v=OE[t],u.cellText!==!1&&(a.w=t);break;default:t==""&&s==""?a.t="z":(a.t="s",a.v=mS(s||t));break}if(ZX(a,c,u),u.cellFormula!==!1)if(a.Formula){var x=Sr(a.Formula);x.charCodeAt(0)==61&&(x=x.slice(1)),a.f=Mh(x,n),delete a.Formula,a.ArrayRange=="RC"?a.F=Mh("RC:RC",n):a.ArrayRange&&(a.F=Mh(a.ArrayRange,n),d.push([Cr(a.F),a.F]))}else for(g=0;g<d.length;++g)n.r>=d[g][0].s.r&&n.r<=d[g][0].e.r&&n.c>=d[g][0].s.c&&n.c<=d[g][0].e.c&&(a.F=d[g][1]);u.cellStyles&&(p.forEach(function(b){!m.patternType&&b.patternType&&(m.patternType=b.patternType)}),a.s=m),a.StyleID!==void 0&&(a.ixfe=a.StyleID)}function sJ(t){t.t=t.v||"",t.t=t.t.replace(/\r\n/g,`
`).replace(/\r/g,`
`),t.v=t.w=t.ixfe=void 0}function Mb(t,s){var r=s||{};iA();var a=YA(pN(t));(r.type=="binary"||r.type=="array"||r.type=="base64")&&(a=Xr(a));var n=a.slice(0,1024).toLowerCase(),i=!1;if(n=n.replace(/".*?"/g,""),(n.indexOf(">")&1023)>Math.min(n.indexOf(",")&1023,n.indexOf(";")&1023)){var l=ha(r);return l.type="string",Kh.to_workbook(a,l)}if(n.indexOf("<?xml")==-1&&["html","table","head","meta","script","style","div"].forEach(function(we){n.indexOf("<"+we)>=0&&(i=!0)}),i)return QJ(a,r);pf={"General Number":"General","General Date":Vs[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":Vs[15],"Short Date":Vs[14],"Long Time":Vs[19],"Medium Time":Vs[18],"Short Time":Vs[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:Vs[2],Standard:Vs[4],Percent:Vs[10],Scientific:Vs[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'};var o,d=[],u,c={},h=[],m=r.dense?[]:{},p="",g={},x={},b=Ro('<Data ss:Type="String">'),y=0,j=0,N=0,_={s:{r:2e6,c:2e6},e:{r:0,c:0}},F={},I={},w="",E=0,W=[],R={},U={},T=0,Y=[],H=[],M={},q=[],z,Q=!1,L=[],V=[],P={},C=0,k=0,B={Sheets:[],WBProps:{date1904:!1}},G={};Df.lastIndex=0,a=a.replace(/<!--([\s\S]*?)-->/mg,"");for(var O="";o=Df.exec(a);)switch(o[3]=(O=o[3]).toLowerCase()){case"data":if(O=="data"){if(o[1]==="/"){if((u=d.pop())[0]!==o[3])throw new Error("Bad state: "+u.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&d.push([o[3],!0]);break}if(d[d.length-1][1])break;o[1]==="/"?tJ(a.slice(y,o.index),w,b,d[d.length-1][0]=="comment"?M:g,{c:j,r:N},F,q[j],x,L,r):(w="",b=Ro(o[0]),y=o.index+o[0].length);break;case"cell":if(o[1]==="/")if(H.length>0&&(g.c=H),(!r.sheetRows||r.sheetRows>N)&&g.v!==void 0&&(r.dense?(m[N]||(m[N]=[]),m[N][j]=g):m[Na(j)+za(N)]=g),g.HRef&&(g.l={Target:Sr(g.HRef)},g.HRefScreenTip&&(g.l.Tooltip=g.HRefScreenTip),delete g.HRef,delete g.HRefScreenTip),(g.MergeAcross||g.MergeDown)&&(C=j+(parseInt(g.MergeAcross,10)|0),k=N+(parseInt(g.MergeDown,10)|0),W.push({s:{c:j,r:N},e:{c:C,r:k}})),!r.sheetStubs)g.MergeAcross?j=C+1:++j;else if(g.MergeAcross||g.MergeDown){for(var K=j;K<=C;++K)for(var J=N;J<=k;++J)(K>j||J>N)&&(r.dense?(m[J]||(m[J]=[]),m[J][K]={t:"z"}):m[Na(K)+za(J)]={t:"z"});j=C+1}else++j;else g=YX(o[0]),g.Index&&(j=+g.Index-1),j<_.s.c&&(_.s.c=j),j>_.e.c&&(_.e.c=j),o[0].slice(-2)==="/>"&&++j,H=[];break;case"row":o[1]==="/"||o[0].slice(-2)==="/>"?(N<_.s.r&&(_.s.r=N),N>_.e.r&&(_.e.r=N),o[0].slice(-2)==="/>"&&(x=Ro(o[0]),x.Index&&(N=+x.Index-1)),j=0,++N):(x=Ro(o[0]),x.Index&&(N=+x.Index-1),P={},(x.AutoFitHeight=="0"||x.Height)&&(P.hpx=parseInt(x.Height,10),P.hpt=Mf(P.hpx),V[N]=P),x.Hidden=="1"&&(P.hidden=!0,V[N]=P));break;case"worksheet":if(o[1]==="/"){if((u=d.pop())[0]!==o[3])throw new Error("Bad state: "+u.join("|"));h.push(p),_.s.r<=_.e.r&&_.s.c<=_.e.c&&(m["!ref"]=lr(_),r.sheetRows&&r.sheetRows<=_.e.r&&(m["!fullref"]=m["!ref"],_.e.r=r.sheetRows-1,m["!ref"]=lr(_))),W.length&&(m["!merges"]=W),q.length>0&&(m["!cols"]=q),V.length>0&&(m["!rows"]=V),c[p]=m}else _={s:{r:2e6,c:2e6},e:{r:0,c:0}},N=j=0,d.push([o[3],!1]),u=Ro(o[0]),p=Sr(u.Name),m=r.dense?[]:{},W=[],L=[],V=[],G={name:p,Hidden:0},B.Sheets.push(G);break;case"table":if(o[1]==="/"){if((u=d.pop())[0]!==o[3])throw new Error("Bad state: "+u.join("|"))}else{if(o[0].slice(-2)=="/>")break;d.push([o[3],!1]),q=[],Q=!1}break;case"style":o[1]==="/"?eJ(F,I,r):I=Ro(o[0]);break;case"numberformat":I.nf=Sr(Ro(o[0]).Format||"General"),pf[I.nf]&&(I.nf=pf[I.nf]);for(var te=0;te!=392&&Vs[te]!=I.nf;++te);if(te==392){for(te=57;te!=392;++te)if(Vs[te]==null){fd(I.nf,te);break}}break;case"column":if(d[d.length-1][0]!=="table")break;if(z=Ro(o[0]),z.Hidden&&(z.hidden=!0,delete z.Hidden),z.Width&&(z.wpx=parseInt(z.Width,10)),!Q&&z.wpx>10){Q=!0,vi=vB;for(var se=0;se<q.length;++se)q[se]&&Bu(q[se])}Q&&Bu(z),q[z.Index-1||q.length]=z;for(var ae=0;ae<+z.Span;++ae)q[q.length]=ha(z);break;case"namedrange":if(o[1]==="/")break;B.Names||(B.Names=[]);var ne=Ys(o[0]),ue={Name:ne.Name,Ref:Mh(ne.RefersTo.slice(1),{r:0,c:0})};B.Sheets.length>0&&(ue.Sheet=B.Sheets.length-1),B.Names.push(ue);break;case"namedcell":break;case"b":break;case"i":break;case"u":break;case"s":break;case"em":break;case"h2":break;case"h3":break;case"sub":break;case"sup":break;case"span":break;case"alignment":break;case"borders":break;case"border":break;case"font":if(o[0].slice(-2)==="/>")break;o[1]==="/"?w+=a.slice(E,o.index):E=o.index+o[0].length;break;case"interior":if(!r.cellStyles)break;I.Interior=Ro(o[0]);break;case"protection":break;case"author":case"title":case"description":case"created":case"keywords":case"subject":case"category":case"company":case"lastauthor":case"lastsaved":case"lastprinted":case"version":case"revision":case"totaltime":case"hyperlinkbase":case"manager":case"contentstatus":case"identifier":case"language":case"appname":if(o[0].slice(-2)==="/>")break;o[1]==="/"?Sq(R,O,a.slice(T,o.index)):T=o.index+o[0].length;break;case"paragraphs":break;case"styles":case"workbook":if(o[1]==="/"){if((u=d.pop())[0]!==o[3])throw new Error("Bad state: "+u.join("|"))}else d.push([o[3],!1]);break;case"comment":if(o[1]==="/"){if((u=d.pop())[0]!==o[3])throw new Error("Bad state: "+u.join("|"));sJ(M),H.push(M)}else d.push([o[3],!1]),u=Ro(o[0]),M={a:u.Author};break;case"autofilter":if(o[1]==="/"){if((u=d.pop())[0]!==o[3])throw new Error("Bad state: "+u.join("|"))}else if(o[0].charAt(o[0].length-2)!=="/"){var oe=Ro(o[0]);m["!autofilter"]={ref:Mh(oe.Range).replace(/\$/g,"")},d.push([o[3],!0])}break;case"name":break;case"datavalidation":if(o[1]==="/"){if((u=d.pop())[0]!==o[3])throw new Error("Bad state: "+u.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&d.push([o[3],!0]);break;case"pixelsperinch":break;case"componentoptions":case"documentproperties":case"customdocumentproperties":case"officedocumentsettings":case"pivottable":case"pivotcache":case"names":case"mapinfo":case"pagebreaks":case"querytable":case"sorting":case"schema":case"conditionalformatting":case"smarttagtype":case"smarttags":case"excelworkbook":case"workbookoptions":case"worksheetoptions":if(o[1]==="/"){if((u=d.pop())[0]!==o[3])throw new Error("Bad state: "+u.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&d.push([o[3],!0]);break;case"null":break;default:if(d.length==0&&o[3]=="document"||d.length==0&&o[3]=="uof")return eC(a,r);var le=!0;switch(d[d.length-1][0]){case"officedocumentsettings":switch(o[3]){case"allowpng":break;case"removepersonalinformation":break;case"downloadcomponents":break;case"locationofcomponents":break;case"colors":break;case"color":break;case"index":break;case"rgb":break;case"targetscreensize":break;case"readonlyrecommended":break;default:le=!1}break;case"componentoptions":switch(o[3]){case"toolbar":break;case"hideofficelogo":break;case"spreadsheetautofit":break;case"label":break;case"caption":break;case"maxheight":break;case"maxwidth":break;case"nextsheetnumber":break;default:le=!1}break;case"excelworkbook":switch(o[3]){case"date1904":B.WBProps.date1904=!0;break;case"windowheight":break;case"windowwidth":break;case"windowtopx":break;case"windowtopy":break;case"tabratio":break;case"protectstructure":break;case"protectwindow":break;case"protectwindows":break;case"activesheet":break;case"displayinknotes":break;case"firstvisiblesheet":break;case"supbook":break;case"sheetname":break;case"sheetindex":break;case"sheetindexfirst":break;case"sheetindexlast":break;case"dll":break;case"acceptlabelsinformulas":break;case"donotsavelinkvalues":break;case"iteration":break;case"maxiterations":break;case"maxchange":break;case"path":break;case"xct":break;case"count":break;case"selectedsheets":break;case"calculation":break;case"uncalced":break;case"startupprompt":break;case"crn":break;case"externname":break;case"formula":break;case"colfirst":break;case"collast":break;case"wantadvise":break;case"boolean":break;case"error":break;case"text":break;case"ole":break;case"noautorecover":break;case"publishobjects":break;case"donotcalculatebeforesave":break;case"number":break;case"refmoder1c1":break;case"embedsavesmarttags":break;default:le=!1}break;case"workbookoptions":switch(o[3]){case"owcversion":break;case"height":break;case"width":break;default:le=!1}break;case"worksheetoptions":switch(o[3]){case"visible":if(o[0].slice(-2)!=="/>")if(o[1]==="/")switch(a.slice(T,o.index)){case"SheetHidden":G.Hidden=1;break;case"SheetVeryHidden":G.Hidden=2;break}else T=o.index+o[0].length;break;case"header":m["!margins"]||_m(m["!margins"]={},"xlml"),isNaN(+Ys(o[0]).Margin)||(m["!margins"].header=+Ys(o[0]).Margin);break;case"footer":m["!margins"]||_m(m["!margins"]={},"xlml"),isNaN(+Ys(o[0]).Margin)||(m["!margins"].footer=+Ys(o[0]).Margin);break;case"pagemargins":var X=Ys(o[0]);m["!margins"]||_m(m["!margins"]={},"xlml"),isNaN(+X.Top)||(m["!margins"].top=+X.Top),isNaN(+X.Left)||(m["!margins"].left=+X.Left),isNaN(+X.Right)||(m["!margins"].right=+X.Right),isNaN(+X.Bottom)||(m["!margins"].bottom=+X.Bottom);break;case"displayrighttoleft":B.Views||(B.Views=[]),B.Views[0]||(B.Views[0]={}),B.Views[0].RTL=!0;break;case"freezepanes":break;case"frozennosplit":break;case"splithorizontal":case"splitvertical":break;case"donotdisplaygridlines":break;case"activerow":break;case"activecol":break;case"toprowbottompane":break;case"leftcolumnrightpane":break;case"unsynced":break;case"print":break;case"printerrors":break;case"panes":break;case"scale":break;case"pane":break;case"number":break;case"layout":break;case"pagesetup":break;case"selected":break;case"protectobjects":break;case"enableselection":break;case"protectscenarios":break;case"validprinterinfo":break;case"horizontalresolution":break;case"verticalresolution":break;case"numberofcopies":break;case"activepane":break;case"toprowvisible":break;case"leftcolumnvisible":break;case"fittopage":break;case"rangeselection":break;case"papersizeindex":break;case"pagelayoutzoom":break;case"pagebreakzoom":break;case"filteron":break;case"fitwidth":break;case"fitheight":break;case"commentslayout":break;case"zoom":break;case"lefttoright":break;case"gridlines":break;case"allowsort":break;case"allowfilter":break;case"allowinsertrows":break;case"allowdeleterows":break;case"allowinsertcols":break;case"allowdeletecols":break;case"allowinserthyperlinks":break;case"allowformatcells":break;case"allowsizecols":break;case"allowsizerows":break;case"nosummaryrowsbelowdetail":m["!outline"]||(m["!outline"]={}),m["!outline"].above=!0;break;case"tabcolorindex":break;case"donotdisplayheadings":break;case"showpagelayoutzoom":break;case"nosummarycolumnsrightdetail":m["!outline"]||(m["!outline"]={}),m["!outline"].left=!0;break;case"blackandwhite":break;case"donotdisplayzeros":break;case"displaypagebreak":break;case"rowcolheadings":break;case"donotdisplayoutline":break;case"noorientation":break;case"allowusepivottables":break;case"zeroheight":break;case"viewablerange":break;case"selection":break;case"protectcontents":break;default:le=!1}break;case"pivottable":case"pivotcache":switch(o[3]){case"immediateitemsondrop":break;case"showpagemultipleitemlabel":break;case"compactrowindent":break;case"location":break;case"pivotfield":break;case"orientation":break;case"layoutform":break;case"layoutsubtotallocation":break;case"layoutcompactrow":break;case"position":break;case"pivotitem":break;case"datatype":break;case"datafield":break;case"sourcename":break;case"parentfield":break;case"ptlineitems":break;case"ptlineitem":break;case"countofsameitems":break;case"item":break;case"itemtype":break;case"ptsource":break;case"cacheindex":break;case"consolidationreference":break;case"filename":break;case"reference":break;case"nocolumngrand":break;case"norowgrand":break;case"blanklineafteritems":break;case"hidden":break;case"subtotal":break;case"basefield":break;case"mapchilditems":break;case"function":break;case"refreshonfileopen":break;case"printsettitles":break;case"mergelabels":break;case"defaultversion":break;case"refreshname":break;case"refreshdate":break;case"refreshdatecopy":break;case"versionlastrefresh":break;case"versionlastupdate":break;case"versionupdateablemin":break;case"versionrefreshablemin":break;case"calculation":break;default:le=!1}break;case"pagebreaks":switch(o[3]){case"colbreaks":break;case"colbreak":break;case"rowbreaks":break;case"rowbreak":break;case"colstart":break;case"colend":break;case"rowend":break;default:le=!1}break;case"autofilter":switch(o[3]){case"autofiltercolumn":break;case"autofiltercondition":break;case"autofilterand":break;case"autofilteror":break;default:le=!1}break;case"querytable":switch(o[3]){case"id":break;case"autoformatfont":break;case"autoformatpattern":break;case"querysource":break;case"querytype":break;case"enableredirections":break;case"refreshedinxl9":break;case"urlstring":break;case"htmltables":break;case"connection":break;case"commandtext":break;case"refreshinfo":break;case"notitles":break;case"nextid":break;case"columninfo":break;case"overwritecells":break;case"donotpromptforfile":break;case"textwizardsettings":break;case"source":break;case"number":break;case"decimal":break;case"thousandseparator":break;case"trailingminusnumbers":break;case"formatsettings":break;case"fieldtype":break;case"delimiters":break;case"tab":break;case"comma":break;case"autoformatname":break;case"versionlastedit":break;case"versionlastrefresh":break;default:le=!1}break;case"datavalidation":switch(o[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;case"cellrangelist":break;default:le=!1}break;case"sorting":case"conditionalformatting":switch(o[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"cellrangelist":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;default:le=!1}break;case"mapinfo":case"schema":case"data":switch(o[3]){case"map":break;case"entry":break;case"range":break;case"xpath":break;case"field":break;case"xsdtype":break;case"filteron":break;case"aggregate":break;case"elementtype":break;case"attributetype":break;case"schema":case"element":case"complextype":case"datatype":case"all":case"attribute":case"extends":break;case"row":break;default:le=!1}break;case"smarttags":break;default:le=!1;break}if(le||o[3].match(/!\[CDATA/))break;if(!d[d.length-1][1])throw"Unrecognized tag: "+o[3]+"|"+d.join("|");if(d[d.length-1][0]==="customdocumentproperties"){if(o[0].slice(-2)==="/>")break;o[1]==="/"?JX(U,O,Y,a.slice(T,o.index)):(Y=o,T=o.index+o[0].length);break}if(r.WTF)throw"Unrecognized tag: "+o[3]+"|"+d.join("|")}var me={};return!r.bookSheets&&!r.bookProps&&(me.Sheets=c),me.SheetNames=h,me.Workbook=B,me.SSF=ha(Vs),me.Props=R,me.Custprops=U,me}function gj(t,s){switch(MN(s=s||{}),s.type||"base64"){case"base64":return Mb(Tl(t),s);case"binary":case"buffer":case"file":return Mb(t,s);case"array":return Mb(Iu(t),s)}}function rJ(t,s){var r=[];return t.Props&&r.push(Cq(t.Props,s)),t.Custprops&&r.push(kq(t.Props,t.Custprops)),r.join("")}function aJ(){return""}function nJ(t,s){var r=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return s.cellXfs.forEach(function(a,n){var i=[];i.push(gs("NumberFormat",null,{"ss:Format":Gr(Vs[a.numFmtId])}));var l={"ss:ID":"s"+(21+n)};r.push(gs("Style",i.join(""),l))}),gs("Styles",r.join(""))}function WB(t){return gs("NamedRange",null,{"ss:Name":t.Name,"ss:RefersTo":"="+LN(t.Ref,{r:0,c:0})})}function iJ(t){if(!((t||{}).Workbook||{}).Names)return"";for(var s=t.Workbook.Names,r=[],a=0;a<s.length;++a){var n=s[a];n.Sheet==null&&(n.Name.match(/^_xlfn\./)||r.push(WB(n)))}return gs("Names",r.join(""))}function lJ(t,s,r,a){if(!t||!((a||{}).Workbook||{}).Names)return"";for(var n=a.Workbook.Names,i=[],l=0;l<n.length;++l){var o=n[l];o.Sheet==r&&(o.Name.match(/^_xlfn\./)||i.push(WB(o)))}return i.join("")}function oJ(t,s,r,a){if(!t)return"";var n=[];if(t["!margins"]&&(n.push("<PageSetup>"),t["!margins"].header&&n.push(gs("Header",null,{"x:Margin":t["!margins"].header})),t["!margins"].footer&&n.push(gs("Footer",null,{"x:Margin":t["!margins"].footer})),n.push(gs("PageMargins",null,{"x:Bottom":t["!margins"].bottom||"0.75","x:Left":t["!margins"].left||"0.7","x:Right":t["!margins"].right||"0.7","x:Top":t["!margins"].top||"0.75"})),n.push("</PageSetup>")),a&&a.Workbook&&a.Workbook.Sheets&&a.Workbook.Sheets[r])if(a.Workbook.Sheets[r].Hidden)n.push(gs("Visible",a.Workbook.Sheets[r].Hidden==1?"SheetHidden":"SheetVeryHidden",{}));else{for(var i=0;i<r&&!(a.Workbook.Sheets[i]&&!a.Workbook.Sheets[i].Hidden);++i);i==r&&n.push("<Selected/>")}return((((a||{}).Workbook||{}).Views||[])[0]||{}).RTL&&n.push("<DisplayRightToLeft/>"),t["!protect"]&&(n.push(Kn("ProtectContents","True")),t["!protect"].objects&&n.push(Kn("ProtectObjects","True")),t["!protect"].scenarios&&n.push(Kn("ProtectScenarios","True")),t["!protect"].selectLockedCells!=null&&!t["!protect"].selectLockedCells?n.push(Kn("EnableSelection","NoSelection")):t["!protect"].selectUnlockedCells!=null&&!t["!protect"].selectUnlockedCells&&n.push(Kn("EnableSelection","UnlockedCells")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(l){t["!protect"][l[0]]&&n.push("<"+l[1]+"/>")})),n.length==0?"":gs("WorksheetOptions",n.join(""),{xmlns:wl.x})}function cJ(t){return t.map(function(s){var r=B9(s.t||""),a=gs("ss:Data",r,{xmlns:"http://www.w3.org/TR/REC-html40"});return gs("Comment",a,{"ss:Author":s.a})}).join("")}function dJ(t,s,r,a,n,i,l){if(!t||t.v==null&&t.f==null)return"";var o={};if(t.f&&(o["ss:Formula"]="="+Gr(LN(t.f,l))),t.F&&t.F.slice(0,s.length)==s){var d=wa(t.F.slice(s.length+1));o["ss:ArrayRange"]="RC:R"+(d.r==l.r?"":"["+(d.r-l.r)+"]")+"C"+(d.c==l.c?"":"["+(d.c-l.c)+"]")}if(t.l&&t.l.Target&&(o["ss:HRef"]=Gr(t.l.Target),t.l.Tooltip&&(o["x:HRefScreenTip"]=Gr(t.l.Tooltip))),r["!merges"])for(var u=r["!merges"],c=0;c!=u.length;++c)u[c].s.c!=l.c||u[c].s.r!=l.r||(u[c].e.c>u[c].s.c&&(o["ss:MergeAcross"]=u[c].e.c-u[c].s.c),u[c].e.r>u[c].s.r&&(o["ss:MergeDown"]=u[c].e.r-u[c].s.r));var h="",m="";switch(t.t){case"z":if(!a.sheetStubs)return"";break;case"n":h="Number",m=String(t.v);break;case"b":h="Boolean",m=t.v?"1":"0";break;case"e":h="Error",m=_d[t.v];break;case"d":h="DateTime",m=new Date(t.v).toISOString(),t.z==null&&(t.z=t.z||Vs[14]);break;case"s":h="String",m=E9(t.v||"");break}var p=Du(a.cellXfs,t,a);o["ss:StyleID"]="s"+(21+p),o["ss:Index"]=l.c+1;var g=t.v!=null?m:"",x=t.t=="z"?"":'<Data ss:Type="'+h+'">'+g+"</Data>";return(t.c||[]).length>0&&(x+=cJ(t.c)),gs("Cell",x,o)}function uJ(t,s){var r='<Row ss:Index="'+(t+1)+'"';return s&&(s.hpt&&!s.hpx&&(s.hpx=zh(s.hpt)),s.hpx&&(r+=' ss:AutoFitHeight="0" ss:Height="'+s.hpx+'"'),s.hidden&&(r+=' ss:Hidden="1"')),r+">"}function mJ(t,s,r,a){if(!t["!ref"])return"";var n=Cr(t["!ref"]),i=t["!merges"]||[],l=0,o=[];t["!cols"]&&t["!cols"].forEach(function(b,y){Bu(b);var j=!!b.width,N=Ug(y,b),_={"ss:Index":y+1};j&&(_["ss:Width"]=Rf(N.width)),b.hidden&&(_["ss:Hidden"]="1"),o.push(gs("Column",null,_))});for(var d=Array.isArray(t),u=n.s.r;u<=n.e.r;++u){for(var c=[uJ(u,(t["!rows"]||[])[u])],h=n.s.c;h<=n.e.c;++h){var m=!1;for(l=0;l!=i.length;++l)if(!(i[l].s.c>h)&&!(i[l].s.r>u)&&!(i[l].e.c<h)&&!(i[l].e.r<u)){(i[l].s.c!=h||i[l].s.r!=u)&&(m=!0);break}if(!m){var p={r:u,c:h},g=Ks(p),x=d?(t[u]||[])[h]:t[g];c.push(dJ(x,g,t,s,r,a,p))}}c.push("</Row>"),c.length>2&&o.push(c.join(""))}return o.join("")}function hJ(t,s,r){var a=[],n=r.SheetNames[t],i=r.Sheets[n],l=i?lJ(i,s,t,r):"";return l.length>0&&a.push("<Names>"+l+"</Names>"),l=i?mJ(i,s,t,r):"",l.length>0&&a.push("<Table>"+l+"</Table>"),a.push(oJ(i,s,t,r)),a.join("")}function AJ(t,s){s||(s={}),t.SSF||(t.SSF=ha(Vs)),t.SSF&&(iA(),Bg(t.SSF),s.revssf=Tg(t.SSF),s.revssf[t.SSF[65535]]=0,s.ssf=t.SSF,s.cellXfs=[],Du(s.cellXfs,{},{revssf:{General:0}}));var r=[];r.push(rJ(t,s)),r.push(aJ()),r.push(""),r.push("");for(var a=0;a<t.SheetNames.length;++a)r.push(gs("Worksheet",hJ(a,s,t),{"ss:Name":Gr(t.SheetNames[a])}));return r[2]=nJ(t,s),r[3]=iJ(t),Xa+gs("Workbook",r.join(""),{xmlns:wl.ss,"xmlns:o":wl.o,"xmlns:x":wl.x,"xmlns:ss":wl.ss,"xmlns:dt":wl.dt,"xmlns:html":wl.html})}function fJ(t){var s={},r=t.content;if(r.l=28,s.AnsiUserType=r.read_shift(0,"lpstr-ansi"),s.AnsiClipboardFormat=iq(r),r.length-r.l<=4)return s;var a=r.read_shift(4);if(a==0||a>40||(r.l-=4,s.Reserved1=r.read_shift(0,"lpstr-ansi"),r.length-r.l<=4)||(a=r.read_shift(4),a!==1907505652)||(s.UnicodeClipboardFormat=lq(r),a=r.read_shift(4),a==0||a>40))return s;r.l-=4,s.Reserved2=r.read_shift(0,"lpwstr")}var pJ=[60,1084,2066,2165,2175];function xJ(t,s,r,a,n){var i=a,l=[],o=r.slice(r.l,r.l+i);if(n&&n.enc&&n.enc.insitu&&o.length>0)switch(t){case 9:case 521:case 1033:case 2057:case 47:case 405:case 225:case 406:case 312:case 404:case 10:break;case 133:break;default:n.enc.insitu(o)}l.push(o),r.l+=i;for(var d=cd(r,r.l),u=vj[d],c=0;u!=null&&pJ.indexOf(d)>-1;)i=cd(r,r.l+2),c=r.l+4,d==2066?c+=4:(d==2165||d==2175)&&(c+=12),o=r.slice(c,r.l+4+i),l.push(o),r.l+=4+i,u=vj[d=cd(r,r.l)];var h=Fn(l);Gn(h,0);var m=0;h.lens=[];for(var p=0;p<l.length;++p)h.lens.push(m),m+=l[p].length;if(h.length<a)throw"XLS Record 0x"+t.toString(16)+" Truncated: "+h.length+" < "+a;return s.f(h,h.length,n)}function xc(t,s,r){if(t.t!=="z"&&t.XF){var a=0;try{a=t.z||t.XF.numFmtId||0,s.cellNF&&(t.z=Vs[a])}catch(i){if(s.WTF)throw i}if(!s||s.cellText!==!1)try{t.t==="e"?t.w=t.w||_d[t.v]:a===0||a=="General"?t.t==="n"?(t.v|0)===t.v?t.w=t.v.toString(10):t.w=Tf(t.v):t.w=km(t.v):t.w=io(a,t.v,{date1904:!!r,dateNF:s&&s.dateNF})}catch(i){if(s.WTF)throw i}if(s.cellDates&&a&&t.t=="n"&&nA(Vs[a]||String(a))){var n=pm(t.v);n&&(t.t="d",t.v=new Date(n.y,n.m-1,n.d,n.H,n.M,n.S,n.u))}}}function Ux(t,s,r){return{v:t,ixfe:s,t:r}}function gJ(t,s){var r={opts:{}},a={},n=s.dense?[]:{},i={},l={},o=null,d=[],u="",c={},h,m="",p,g,x,b,y={},j=[],N,_,F=[],I=[],w={Sheets:[],WBProps:{date1904:!1},Views:[{}]},E={},W=function(fe){return fe<8?jm[fe]:fe<64&&I[fe-8]||jm[fe]},R=function(fe,he,Ue){var Ye=he.XF.data;if(!(!Ye||!Ye.patternType||!Ue||!Ue.cellStyles)){he.s={},he.s.patternType=Ye.patternType;var Ke;(Ke=Uf(W(Ye.icvFore)))&&(he.s.fgColor={rgb:Ke}),(Ke=Uf(W(Ye.icvBack)))&&(he.s.bgColor={rgb:Ke})}},U=function(fe,he,Ue){if(!(P>1)&&!(Ue.sheetRows&&fe.r>=Ue.sheetRows)){if(Ue.cellStyles&&he.XF&&he.XF.data&&R(fe,he,Ue),delete he.ixfe,delete he.XF,h=fe,m=Ks(fe),(!l||!l.s||!l.e)&&(l={s:{r:0,c:0},e:{r:0,c:0}}),fe.r<l.s.r&&(l.s.r=fe.r),fe.c<l.s.c&&(l.s.c=fe.c),fe.r+1>l.e.r&&(l.e.r=fe.r+1),fe.c+1>l.e.c&&(l.e.c=fe.c+1),Ue.cellFormula&&he.f){for(var Ye=0;Ye<j.length;++Ye)if(!(j[Ye][0].s.c>fe.c||j[Ye][0].s.r>fe.r)&&!(j[Ye][0].e.c<fe.c||j[Ye][0].e.r<fe.r)){he.F=lr(j[Ye][0]),(j[Ye][0].s.c!=fe.c||j[Ye][0].s.r!=fe.r)&&delete he.f,he.f&&(he.f=""+gi(j[Ye][1],l,fe,L,T));break}}Ue.dense?(n[fe.r]||(n[fe.r]=[]),n[fe.r][fe.c]=he):n[m]=he}},T={enc:!1,sbcch:0,snames:[],sharedf:y,arrayf:j,rrtabid:[],lastuser:"",biff:8,codepage:0,winlocked:0,cellStyles:!!s&&!!s.cellStyles,WTF:!!s&&!!s.wtf};s.password&&(T.password=s.password);var Y,H=[],M=[],q=[],z=[],Q=!1,L=[];L.SheetNames=T.snames,L.sharedf=T.sharedf,L.arrayf=T.arrayf,L.names=[],L.XTI=[];var V=0,P=0,C=0,k=[],B=[],G;T.codepage=1200,qo(1200);for(var O=!1;t.l<t.length-1;){var K=t.l,J=t.read_shift(2);if(J===0&&V===10)break;var te=t.l===t.length?0:t.read_shift(2),se=vj[J];if(se&&se.f){if(s.bookSheets&&V===133&&J!==133)break;if(V=J,se.r===2||se.r==12){var ae=t.read_shift(2);if(te-=2,!T.enc&&ae!==J&&((ae&255)<<8|ae>>8)!==J)throw new Error("rt mismatch: "+ae+"!="+J);se.r==12&&(t.l+=10,te-=10)}var ne={};if(J===10?ne=se.f(t,te,T):ne=xJ(J,se,t,te,T),P==0&&[9,521,1033,2057].indexOf(V)===-1)continue;switch(J){case 34:r.opts.Date1904=w.WBProps.date1904=ne;break;case 134:r.opts.WriteProtect=!0;break;case 47:if(T.enc||(t.l=0),T.enc=ne,!s.password)throw new Error("File is password-protected");if(ne.valid==null)throw new Error("Encryption scheme unsupported");if(!ne.valid)throw new Error("Password is incorrect");break;case 92:T.lastuser=ne;break;case 66:var ue=Number(ne);switch(ue){case 21010:ue=1200;break;case 32768:ue=1e4;break;case 32769:ue=1252;break}qo(T.codepage=ue),O=!0;break;case 317:T.rrtabid=ne;break;case 25:T.winlocked=ne;break;case 439:r.opts.RefreshAll=ne;break;case 12:r.opts.CalcCount=ne;break;case 16:r.opts.CalcDelta=ne;break;case 17:r.opts.CalcIter=ne;break;case 13:r.opts.CalcMode=ne;break;case 14:r.opts.CalcPrecision=ne;break;case 95:r.opts.CalcSaveRecalc=ne;break;case 15:T.CalcRefMode=ne;break;case 2211:r.opts.FullCalc=ne;break;case 129:ne.fDialog&&(n["!type"]="dialog"),ne.fBelow||((n["!outline"]||(n["!outline"]={})).above=!0),ne.fRight||((n["!outline"]||(n["!outline"]={})).left=!0);break;case 224:F.push(ne);break;case 430:L.push([ne]),L[L.length-1].XTI=[];break;case 35:case 547:L[L.length-1].push(ne);break;case 24:case 536:G={Name:ne.Name,Ref:gi(ne.rgce,l,null,L,T)},ne.itab>0&&(G.Sheet=ne.itab-1),L.names.push(G),L[0]||(L[0]=[],L[0].XTI=[]),L[L.length-1].push(ne),ne.Name=="_xlnm._FilterDatabase"&&ne.itab>0&&ne.rgce&&ne.rgce[0]&&ne.rgce[0][0]&&ne.rgce[0][0][0]=="PtgArea3d"&&(B[ne.itab-1]={ref:lr(ne.rgce[0][0][1][2])});break;case 22:T.ExternCount=ne;break;case 23:L.length==0&&(L[0]=[],L[0].XTI=[]),L[L.length-1].XTI=L[L.length-1].XTI.concat(ne),L.XTI=L.XTI.concat(ne);break;case 2196:if(T.biff<8)break;G!=null&&(G.Comment=ne[1]);break;case 18:n["!protect"]=ne;break;case 19:ne!==0&&T.WTF&&console.error("Password verifier: "+ne);break;case 133:i[ne.pos]=ne,T.snames.push(ne.name);break;case 10:{if(--P)break;if(l.e){if(l.e.r>0&&l.e.c>0){if(l.e.r--,l.e.c--,n["!ref"]=lr(l),s.sheetRows&&s.sheetRows<=l.e.r){var oe=l.e.r;l.e.r=s.sheetRows-1,n["!fullref"]=n["!ref"],n["!ref"]=lr(l),l.e.r=oe}l.e.r++,l.e.c++}H.length>0&&(n["!merges"]=H),M.length>0&&(n["!objects"]=M),q.length>0&&(n["!cols"]=q),z.length>0&&(n["!rows"]=z),w.Sheets.push(E)}u===""?c=n:a[u]=n,n=s.dense?[]:{}}break;case 9:case 521:case 1033:case 2057:{if(T.biff===8&&(T.biff={9:2,521:3,1033:4}[J]||{512:2,768:3,1024:4,1280:5,1536:8,2:2,7:2}[ne.BIFFVer]||8),T.biffguess=ne.BIFFVer==0,ne.BIFFVer==0&&ne.dt==4096&&(T.biff=5,O=!0,qo(T.codepage=28591)),T.biff==8&&ne.BIFFVer==0&&ne.dt==16&&(T.biff=2),P++)break;if(n=s.dense?[]:{},T.biff<8&&!O&&(O=!0,qo(T.codepage=s.codepage||1252)),T.biff<5||ne.BIFFVer==0&&ne.dt==4096){u===""&&(u="Sheet1"),l={s:{r:0,c:0},e:{r:0,c:0}};var le={pos:t.l-te,name:u};i[le.pos]=le,T.snames.push(u)}else u=(i[K]||{name:""}).name;ne.dt==32&&(n["!type"]="chart"),ne.dt==64&&(n["!type"]="macro"),H=[],M=[],T.arrayf=j=[],q=[],z=[],Q=!1,E={Hidden:(i[K]||{hs:0}).hs,name:u}}break;case 515:case 3:case 2:n["!type"]=="chart"&&(s.dense?(n[ne.r]||[])[ne.c]:n[Ks({c:ne.c,r:ne.r})])&&++ne.c,N={ixfe:ne.ixfe,XF:F[ne.ixfe]||{},v:ne.val,t:"n"},C>0&&(N.z=k[N.ixfe>>8&63]),xc(N,s,r.opts.Date1904),U({c:ne.c,r:ne.r},N,s);break;case 5:case 517:N={ixfe:ne.ixfe,XF:F[ne.ixfe],v:ne.val,t:ne.t},C>0&&(N.z=k[N.ixfe>>8&63]),xc(N,s,r.opts.Date1904),U({c:ne.c,r:ne.r},N,s);break;case 638:N={ixfe:ne.ixfe,XF:F[ne.ixfe],v:ne.rknum,t:"n"},C>0&&(N.z=k[N.ixfe>>8&63]),xc(N,s,r.opts.Date1904),U({c:ne.c,r:ne.r},N,s);break;case 189:for(var X=ne.c;X<=ne.C;++X){var me=ne.rkrec[X-ne.c][0];N={ixfe:me,XF:F[me],v:ne.rkrec[X-ne.c][1],t:"n"},C>0&&(N.z=k[N.ixfe>>8&63]),xc(N,s,r.opts.Date1904),U({c:X,r:ne.r},N,s)}break;case 6:case 518:case 1030:{if(ne.val=="String"){o=ne;break}if(N=Ux(ne.val,ne.cell.ixfe,ne.tt),N.XF=F[N.ixfe],s.cellFormula){var we=ne.formula;if(we&&we[0]&&we[0][0]&&we[0][0][0]=="PtgExp"){var Ie=we[0][0][1][0],_e=we[0][0][1][1],Fe=Ks({r:Ie,c:_e});y[Fe]?N.f=""+gi(ne.formula,l,ne.cell,L,T):N.F=((s.dense?(n[Ie]||[])[_e]:n[Fe])||{}).F}else N.f=""+gi(ne.formula,l,ne.cell,L,T)}C>0&&(N.z=k[N.ixfe>>8&63]),xc(N,s,r.opts.Date1904),U(ne.cell,N,s),o=ne}break;case 7:case 519:if(o)o.val=ne,N=Ux(ne,o.cell.ixfe,"s"),N.XF=F[N.ixfe],s.cellFormula&&(N.f=""+gi(o.formula,l,o.cell,L,T)),C>0&&(N.z=k[N.ixfe>>8&63]),xc(N,s,r.opts.Date1904),U(o.cell,N,s),o=null;else throw new Error("String record expects Formula");break;case 33:case 545:{j.push(ne);var Le=Ks(ne[0].s);if(p=s.dense?(n[ne[0].s.r]||[])[ne[0].s.c]:n[Le],s.cellFormula&&p){if(!o||!Le||!p)break;p.f=""+gi(ne[1],l,ne[0],L,T),p.F=lr(ne[0])}}break;case 1212:{if(!s.cellFormula)break;if(m){if(!o)break;y[Ks(o.cell)]=ne[0],p=s.dense?(n[o.cell.r]||[])[o.cell.c]:n[Ks(o.cell)],(p||{}).f=""+gi(ne[0],l,h,L,T)}}break;case 253:N=Ux(d[ne.isst].t,ne.ixfe,"s"),d[ne.isst].h&&(N.h=d[ne.isst].h),N.XF=F[N.ixfe],C>0&&(N.z=k[N.ixfe>>8&63]),xc(N,s,r.opts.Date1904),U({c:ne.c,r:ne.r},N,s);break;case 513:s.sheetStubs&&(N={ixfe:ne.ixfe,XF:F[ne.ixfe],t:"z"},C>0&&(N.z=k[N.ixfe>>8&63]),xc(N,s,r.opts.Date1904),U({c:ne.c,r:ne.r},N,s));break;case 190:if(s.sheetStubs)for(var rt=ne.c;rt<=ne.C;++rt){var He=ne.ixfe[rt-ne.c];N={ixfe:He,XF:F[He],t:"z"},C>0&&(N.z=k[N.ixfe>>8&63]),xc(N,s,r.opts.Date1904),U({c:rt,r:ne.r},N,s)}break;case 214:case 516:case 4:N=Ux(ne.val,ne.ixfe,"s"),N.XF=F[N.ixfe],C>0&&(N.z=k[N.ixfe>>8&63]),xc(N,s,r.opts.Date1904),U({c:ne.c,r:ne.r},N,s);break;case 0:case 512:P===1&&(l=ne);break;case 252:d=ne;break;case 1054:if(T.biff==4){k[C++]=ne[1];for(var st=0;st<C+163&&Vs[st]!=ne[1];++st);st>=163&&fd(ne[1],C+163)}else fd(ne[1],ne[0]);break;case 30:{k[C++]=ne;for(var De=0;De<C+163&&Vs[De]!=ne;++De);De>=163&&fd(ne,C+163)}break;case 229:H=H.concat(ne);break;case 93:M[ne.cmo[0]]=T.lastobj=ne;break;case 438:T.lastobj.TxO=ne;break;case 127:T.lastobj.ImData=ne;break;case 440:for(b=ne[0].s.r;b<=ne[0].e.r;++b)for(x=ne[0].s.c;x<=ne[0].e.c;++x)p=s.dense?(n[b]||[])[x]:n[Ks({c:x,r:b})],p&&(p.l=ne[1]);break;case 2048:for(b=ne[0].s.r;b<=ne[0].e.r;++b)for(x=ne[0].s.c;x<=ne[0].e.c;++x)p=s.dense?(n[b]||[])[x]:n[Ks({c:x,r:b})],p&&p.l&&(p.l.Tooltip=ne[1]);break;case 28:{if(T.biff<=5&&T.biff>=2)break;p=s.dense?(n[ne[0].r]||[])[ne[0].c]:n[Ks(ne[0])];var Te=M[ne[2]];p||(s.dense?(n[ne[0].r]||(n[ne[0].r]=[]),p=n[ne[0].r][ne[0].c]={t:"z"}):p=n[Ks(ne[0])]={t:"z"},l.e.r=Math.max(l.e.r,ne[0].r),l.s.r=Math.min(l.s.r,ne[0].r),l.e.c=Math.max(l.e.c,ne[0].c),l.s.c=Math.min(l.s.c,ne[0].c)),p.c||(p.c=[]),g={a:ne[1],t:Te.TxO.t},p.c.push(g)}break;case 2173:nG(F[ne.ixfe],ne.ext);break;case 125:{if(!T.cellStyles)break;for(;ne.e>=ne.s;)q[ne.e--]={width:ne.w/256,level:ne.level||0,hidden:!!(ne.flags&1)},Q||(Q=!0,FN(ne.w/256)),Bu(q[ne.e+1])}break;case 520:{var Ce={};ne.level!=null&&(z[ne.r]=Ce,Ce.level=ne.level),ne.hidden&&(z[ne.r]=Ce,Ce.hidden=!0),ne.hpt&&(z[ne.r]=Ce,Ce.hpt=ne.hpt,Ce.hpx=zh(ne.hpt))}break;case 38:case 39:case 40:case 41:n["!margins"]||_m(n["!margins"]={}),n["!margins"][{38:"left",39:"right",40:"top",41:"bottom"}[J]]=ne;break;case 161:n["!margins"]||_m(n["!margins"]={}),n["!margins"].header=ne.header,n["!margins"].footer=ne.footer;break;case 574:ne.RTL&&(w.Views[0].RTL=!0);break;case 146:I=ne;break;case 2198:Y=ne;break;case 140:_=ne;break;case 442:u?E.CodeName=ne||E.name:w.WBProps.CodeName=ne||"ThisWorkbook";break}}else se||console.error("Missing Info for XLS Record 0x"+J.toString(16)),t.l+=te}return r.SheetNames=Da(i).sort(function(Pe,fe){return Number(Pe)-Number(fe)}).map(function(Pe){return i[Pe].name}),s.bookSheets||(r.Sheets=a),!r.SheetNames.length&&c["!ref"]?(r.SheetNames.push("Sheet1"),r.Sheets&&(r.Sheets.Sheet1=c)):r.Preamble=c,r.Sheets&&B.forEach(function(Pe,fe){r.Sheets[r.SheetNames[fe]]["!autofilter"]=Pe}),r.Strings=d,r.SSF=ha(Vs),T.enc&&(r.Encryption=T.enc),Y&&(r.Themes=Y),r.Metadata={},_!==void 0&&(r.Metadata.Country=_),L.names.length>0&&(w.Names=L.names),r.Workbook=w,r}var xf={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function vJ(t,s,r){var a=Qs.find(t,"/!DocumentSummaryInformation");if(a&&a.size>0)try{var n=BS(a,mj,xf.DSI);for(var i in n)s[i]=n[i]}catch(u){if(r.WTF)throw u}var l=Qs.find(t,"/!SummaryInformation");if(l&&l.size>0)try{var o=BS(l,hj,xf.SI);for(var d in o)s[d]==null&&(s[d]=o[d])}catch(u){if(r.WTF)throw u}s.HeadingPairs&&s.TitlesOfParts&&(VE(s.HeadingPairs,s.TitlesOfParts,s,r),delete s.HeadingPairs,delete s.TitlesOfParts)}function bJ(t,s){var r=[],a=[],n=[],i=0,l,o=iS(mj,"n"),d=iS(hj,"n");if(t.Props)for(l=Da(t.Props),i=0;i<l.length;++i)(Object.prototype.hasOwnProperty.call(o,l[i])?r:Object.prototype.hasOwnProperty.call(d,l[i])?a:n).push([l[i],t.Props[l[i]]]);if(t.Custprops)for(l=Da(t.Custprops),i=0;i<l.length;++i)Object.prototype.hasOwnProperty.call(t.Props||{},l[i])||(Object.prototype.hasOwnProperty.call(o,l[i])?r:Object.prototype.hasOwnProperty.call(d,l[i])?a:n).push([l[i],t.Custprops[l[i]]]);var u=[];for(i=0;i<n.length;++i)JE.indexOf(n[i][0])>-1||$E.indexOf(n[i][0])>-1||n[i][1]!=null&&u.push(n[i]);a.length&&Qs.utils.cfb_add(s,"/SummaryInformation",FS(a,xf.SI,d,hj)),(r.length||u.length)&&Qs.utils.cfb_add(s,"/DocumentSummaryInformation",FS(r,xf.DSI,o,mj,u.length?u:null,xf.UDI))}function GB(t,s){s||(s={}),MN(s),lN(),s.codepage&&iN(s.codepage);var r,a;if(t.FullPaths){if(Qs.find(t,"/encryption"))throw new Error("File is password-protected");r=Qs.find(t,"!CompObj"),a=Qs.find(t,"/Workbook")||Qs.find(t,"/Book")}else{switch(s.type){case"base64":t=Sl(Tl(t));break;case"binary":t=Sl(t);break;case"buffer":break;case"array":Array.isArray(t)||(t=Array.prototype.slice.call(t));break}Gn(t,0),a={content:t}}var n,i;if(r&&fJ(r),s.bookProps&&!s.bookSheets)n={};else{var l=ur?"buffer":"array";if(a&&a.content)n=gJ(a.content,s);else if((i=Qs.find(t,"PerfectOffice_MAIN"))&&i.content)n=wm.to_workbook(i.content,(s.type=l,s));else if((i=Qs.find(t,"NativeContent_MAIN"))&&i.content)n=wm.to_workbook(i.content,(s.type=l,s));else throw(i=Qs.find(t,"MN0"))&&i.content?new Error("Unsupported Works 4 for Mac file"):new Error("Cannot find Workbook stream");s.bookVBA&&t.FullPaths&&Qs.find(t,"/_VBA_PROJECT_CUR/VBA/dir")&&(n.vbaraw=IG(t))}var o={};return t.FullPaths&&vJ(t,o,s),n.Props=n.Custprops=o,s.bookFiles&&(n.cfb=t),n}function yJ(t,s){var r=s||{},a=Qs.utils.cfb_new({root:"R"}),n="/Workbook";switch(r.bookType||"xls"){case"xls":r.bookType="biff8";case"xla":r.bookType||(r.bookType="xla");case"biff8":n="/Workbook",r.biff=8;break;case"biff5":n="/Book",r.biff=5;break;default:throw new Error("invalid type "+r.bookType+" for XLS CFB")}return Qs.utils.cfb_add(a,n,KB(t,r)),r.biff==8&&(t.Props||t.Custprops)&&bJ(t,a),r.biff==8&&t.vbaraw&&LG(a,Qs.read(t.vbaraw,{type:typeof t.vbaraw=="string"?"binary":"buffer"})),a}var Qf={0:{f:Vz},1:{f:Zz},2:{f:gY},3:{f:lY},4:{f:rY},5:{f:fY},6:{f:NY},7:{f:uY},8:{f:BY},9:{f:EY},10:{f:CY},11:{f:kY},12:{f:tY},13:{f:bY},14:{f:cY},15:{f:nY},16:{f:OB},17:{f:_Y},18:{f:hY},19:{f:yN},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:_X},40:{},42:{},43:{f:NW},44:{f:yW},45:{f:SW},46:{f:kW},47:{f:CW},48:{},49:{f:K9},50:{},51:{f:oG},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:cB},62:{f:jY},63:{f:xG},64:{f:WY},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:_i,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:HY},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:Xz},148:{f:Kz,p:16},151:{f:PY},152:{},153:{f:jX},154:{},155:{},156:{f:bX},157:{},158:{},159:{T:1,f:RV},160:{T:-1},161:{T:1,f:Om},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:FY},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:iG},336:{T:-1},337:{f:uG,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:uj},357:{},358:{},359:{},360:{T:1},361:{},362:{f:oB},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:UY},427:{f:RY},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:MY},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:Yz},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:LY},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:uj},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:kG},633:{T:1},634:{T:-1},635:{T:1,f:SG},636:{T:-1},637:{f:J9},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:cX},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:GY},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}},vj={6:{f:Rb},10:{f:lu},12:{f:nn},13:{f:nn},14:{f:$a},15:{f:$a},16:{f:ji},17:{f:$a},18:{f:$a},19:{f:nn},20:{f:US},21:{f:US},23:{f:oB},24:{f:OS},25:{f:$a},26:{},27:{},28:{f:G$},29:{},34:{f:$a},35:{f:RS},38:{f:ji},39:{f:ji},40:{f:ji},41:{f:ji},42:{f:$a},43:{f:$a},47:{f:nW},49:{f:b$},51:{f:nn},60:{},61:{f:f$},64:{f:$a},65:{f:v$},66:{f:nn},77:{},80:{},81:{},82:{},85:{f:nn},89:{},90:{},91:{},92:{f:a$},93:{f:Y$},94:{},95:{f:$a},96:{},97:{},99:{f:$a},125:{f:cB},128:{f:D$},129:{f:i$},130:{f:nn},131:{f:$a},132:{f:$a},133:{f:l$},134:{},140:{f:aV},141:{f:nn},144:{},146:{f:lV},151:{},152:{},153:{},154:{},155:{},156:{f:nn},157:{},158:{},160:{f:AV},161:{f:dV},174:{},175:{},176:{},177:{},178:{},180:{},181:{},182:{},184:{},185:{},189:{f:F$},190:{f:T$},193:{f:lu},197:{},198:{},199:{},200:{},201:{},202:{f:$a},203:{},204:{},205:{},206:{},207:{},208:{},209:{},210:{},211:{},213:{},215:{},216:{},217:{},218:{f:nn},220:{},221:{f:$a},222:{},224:{f:L$},225:{f:r$},226:{f:lu},227:{},229:{f:K$},233:{},235:{},236:{},237:{},239:{},240:{},241:{},242:{},244:{},245:{},246:{},247:{},248:{},249:{},251:{},252:{f:c$},253:{f:j$},255:{f:u$},256:{},259:{},290:{},311:{},312:{},315:{},317:{f:ZE},318:{},319:{},320:{},330:{},331:{},333:{},334:{},335:{},336:{},337:{},338:{},339:{},340:{},351:{},352:{f:$a},353:{f:lu},401:{},402:{},403:{},404:{},405:{},406:{},407:{},408:{},425:{},426:{},427:{},428:{},429:{},430:{f:M$},431:{f:$a},432:{},433:{},434:{},437:{},438:{f:Z$},439:{f:$a},440:{f:eV},441:{},442:{f:ip},443:{},444:{f:nn},445:{},446:{},448:{f:lu},449:{f:A$,r:2},450:{f:lu},512:{f:LS},513:{f:hV},515:{f:R$},516:{f:w$},517:{f:PS},519:{f:fV},520:{f:m$},523:{},545:{f:MS},549:{f:IS},566:{},574:{f:x$},638:{f:B$},659:{},1048:{},1054:{f:S$},1084:{},1212:{f:$$},2048:{f:sV},2049:{},2050:{},2051:{},2052:{},2053:{},2054:{},2055:{},2056:{},2057:{f:Lx},2058:{},2059:{},2060:{},2061:{},2062:{},2063:{},2064:{},2066:{},2067:{},2128:{},2129:{},2130:{},2131:{},2132:{},2133:{},2134:{},2135:{},2136:{},2137:{},2138:{},2146:{},2147:{r:12},2148:{},2149:{},2150:{},2151:{f:lu},2152:{},2154:{},2155:{},2156:{},2161:{},2162:{},2164:{},2165:{},2166:{},2167:{},2168:{},2169:{},2170:{},2171:{},2172:{f:oV,r:12},2173:{f:aG,r:12},2174:{},2175:{},2180:{},2181:{},2182:{},2183:{},2184:{},2185:{},2186:{},2187:{},2188:{f:$a,r:12},2189:{},2190:{r:12},2191:{},2192:{},2194:{},2195:{},2196:{f:q$,r:12},2197:{},2198:{f:JW,r:12},2199:{},2200:{},2201:{},2202:{f:V$,r:12},2203:{f:lu},2204:{},2205:{},2206:{},2207:{},2211:{f:h$},2212:{},2213:{},2214:{},2215:{},4097:{},4098:{},4099:{},4102:{},4103:{},4105:{},4106:{},4107:{},4108:{},4109:{},4116:{},4117:{},4118:{},4119:{},4120:{},4121:{},4122:{},4123:{},4124:{},4125:{},4126:{},4127:{},4128:{},4129:{},4130:{},4132:{},4133:{},4134:{f:nn},4135:{},4146:{},4147:{},4148:{},4149:{},4154:{},4156:{},4157:{},4158:{},4159:{},4160:{},4161:{},4163:{},4164:{f:uV},4165:{},4166:{},4168:{},4170:{},4171:{},4174:{},4175:{},4176:{},4177:{},4187:{},4188:{f:iV},4189:{},4191:{},4192:{},4193:{},4194:{},4195:{},4196:{},4197:{},4198:{},4199:{},4200:{},0:{f:LS},1:{},2:{f:bV},3:{f:gV},4:{f:xV},5:{f:PS},7:{f:jV},8:{},9:{f:Lx},11:{},22:{f:nn},30:{f:k$},31:{},32:{},33:{f:MS},36:{},37:{f:IS},50:{f:NV},62:{},52:{},67:{},68:{f:nn},69:{},86:{},126:{},127:{f:pV},135:{},136:{},137:{},145:{},148:{},149:{},150:{},169:{},171:{},188:{},191:{},192:{},194:{},195:{},214:{f:wV},223:{},234:{},354:{},421:{},518:{f:Rb},521:{f:Lx},536:{f:OS},547:{f:RS},561:{},579:{},1030:{f:Rb},1033:{f:Lx},1091:{},2157:{},2163:{},2177:{},2240:{},2241:{},2242:{},2243:{},2244:{},2245:{},2246:{},2247:{},2248:{},2249:{},2250:{},2251:{},2262:{r:12},29282:{}};function vs(t,s,r,a){var n=s;if(!isNaN(n)){var i=a||(r||[]).length||0,l=t.next(4);l.write_shift(2,n),l.write_shift(2,i),i>0&&gN(r)&&t.push(r)}}function jJ(t,s,r,a){var n=(r||[]).length||0;if(n<=8224)return vs(t,s,r,n);var i=s;if(!isNaN(i)){for(var l=r.parts||[],o=0,d=0,u=0;u+(l[o]||8224)<=8224;)u+=l[o]||8224,o++;var c=t.next(4);for(c.write_shift(2,i),c.write_shift(2,u),t.push(r.slice(d,d+u)),d+=u;d<n;){for(c=t.next(4),c.write_shift(2,60),u=0;u+(l[o]||8224)<=8224;)u+=l[o]||8224,o++;c.write_shift(2,u),t.push(r.slice(d,d+u)),d+=u}}}function dp(t,s,r){return t||(t=Zt(7)),t.write_shift(2,s),t.write_shift(2,r),t.write_shift(2,0),t.write_shift(1,0),t}function NJ(t,s,r,a){var n=Zt(9);return dp(n,t,s),eB(r,a||"b",n),n}function wJ(t,s,r){var a=Zt(8+2*r.length);return dp(a,t,s),a.write_shift(1,r.length),a.write_shift(r.length,r,"sbcs"),a.l<a.length?a.slice(0,a.l):a}function _J(t,s,r,a){if(s.v!=null)switch(s.t){case"d":case"n":var n=s.t=="d"?pn(ma(s.v)):s.v;n==(n|0)&&n>=0&&n<65536?vs(t,2,yV(r,a,n)):vs(t,3,vV(r,a,n));return;case"b":case"e":vs(t,5,NJ(r,a,s.v,s.t));return;case"s":case"str":vs(t,4,wJ(r,a,(s.v||"").slice(0,255)));return}vs(t,1,dp(null,r,a))}function SJ(t,s,r,a){var n=Array.isArray(s),i=Cr(s["!ref"]||"A1"),l,o="",d=[];if(i.e.c>255||i.e.r>16383){if(a.WTF)throw new Error("Range "+(s["!ref"]||"A1")+" exceeds format limit A1:IV16384");i.e.c=Math.min(i.e.c,255),i.e.r=Math.min(i.e.c,16383),l=lr(i)}for(var u=i.s.r;u<=i.e.r;++u){o=za(u);for(var c=i.s.c;c<=i.e.c;++c){u===i.s.r&&(d[c]=Na(c)),l=d[c]+o;var h=n?(s[u]||[])[c]:s[l];h&&_J(t,h,u,c)}}}function CJ(t,s){for(var r=s||{},a=ul(),n=0,i=0;i<t.SheetNames.length;++i)t.SheetNames[i]==r.sheet&&(n=i);if(n==0&&r.sheet&&t.SheetNames[0]!=r.sheet)throw new Error("Sheet not found: "+r.sheet);return vs(a,r.biff==4?1033:r.biff==3?521:9,kN(t,16,r)),SJ(a,t.Sheets[t.SheetNames[n]],n,r),vs(a,10),a.end()}function kJ(t,s,r){vs(t,49,y$({sz:12,name:"Arial"},r))}function EJ(t,s,r){s&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(a){for(var n=a[0];n<=a[1];++n)s[n]!=null&&vs(t,1054,C$(n,s[n],r))})}function BJ(t,s){var r=Zt(19);r.write_shift(4,2151),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(2,3),r.write_shift(1,1),r.write_shift(4,0),vs(t,2151,r),r=Zt(39),r.write_shift(4,2152),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(2,3),r.write_shift(1,0),r.write_shift(4,0),r.write_shift(2,1),r.write_shift(4,4),r.write_shift(2,0),nB(Cr(s["!ref"]||"A1"),r),r.write_shift(4,4),vs(t,2152,r)}function FJ(t,s){for(var r=0;r<16;++r)vs(t,224,DS({numFmtId:0,style:!0},0,s));s.cellXfs.forEach(function(a){vs(t,224,DS(a,0,s))})}function TJ(t,s){for(var r=0;r<s["!links"].length;++r){var a=s["!links"][r];vs(t,440,tV(a)),a[1].Tooltip&&vs(t,2048,rV(a))}delete s["!links"]}function IJ(t,s){if(s){var r=0;s.forEach(function(a,n){++r<=256&&a&&vs(t,125,cV(Ug(n,a),n))})}}function LJ(t,s,r,a,n){var i=16+Du(n.cellXfs,s,n);if(s.v==null&&!s.bf){vs(t,513,Tm(r,a,i));return}if(s.bf)vs(t,6,iz(s,r,a,n,i));else switch(s.t){case"d":case"n":var l=s.t=="d"?pn(ma(s.v)):s.v;vs(t,515,O$(r,a,l,i));break;case"b":case"e":vs(t,517,U$(r,a,s.v,i,n,s.t));break;case"s":case"str":if(n.bookSST){var o=PN(n.Strings,s.v,n.revStrings);vs(t,253,N$(r,a,o,i))}else vs(t,516,_$(r,a,(s.v||"").slice(0,255),i,n));break;default:vs(t,513,Tm(r,a,i))}}function DJ(t,s,r){var a=ul(),n=r.SheetNames[t],i=r.Sheets[n]||{},l=(r||{}).Workbook||{},o=(l.Sheets||[])[t]||{},d=Array.isArray(i),u=s.biff==8,c,h="",m=[],p=Cr(i["!ref"]||"A1"),g=u?65536:16384;if(p.e.c>255||p.e.r>=g){if(s.WTF)throw new Error("Range "+(i["!ref"]||"A1")+" exceeds format limit A1:IV16384");p.e.c=Math.min(p.e.c,255),p.e.r=Math.min(p.e.c,g-1)}vs(a,2057,kN(r,16,s)),vs(a,13,eo(1)),vs(a,12,eo(100)),vs(a,15,Mi(!0)),vs(a,17,Mi(!1)),vs(a,16,Bm(.001)),vs(a,95,Mi(!0)),vs(a,42,Mi(!1)),vs(a,43,Mi(!1)),vs(a,130,eo(1)),vs(a,128,P$()),vs(a,131,Mi(!1)),vs(a,132,Mi(!1)),u&&IJ(a,i["!cols"]),vs(a,512,E$(p,s)),u&&(i["!links"]=[]);for(var x=p.s.r;x<=p.e.r;++x){h=za(x);for(var b=p.s.c;b<=p.e.c;++b){x===p.s.r&&(m[b]=Na(b)),c=m[b]+h;var y=d?(i[x]||[])[b]:i[c];y&&(LJ(a,y,x,b,s),u&&y.l&&i["!links"].push([c,y.l]))}}var j=o.CodeName||o.name||n;return u&&vs(a,574,g$((l.Views||[])[0])),u&&(i["!merges"]||[]).length&&vs(a,229,z$(i["!merges"])),u&&TJ(a,i),vs(a,442,tB(j)),u&&BJ(a,i),vs(a,10),a.end()}function PJ(t,s,r){var a=ul(),n=(t||{}).Workbook||{},i=n.Sheets||[],l=n.WBProps||{},o=r.biff==8,d=r.biff==5;if(vs(a,2057,kN(t,5,r)),r.bookType=="xla"&&vs(a,135),vs(a,225,o?eo(1200):null),vs(a,193,Uq(2)),d&&vs(a,191),d&&vs(a,192),vs(a,226),vs(a,92,n$("SheetJS",r)),vs(a,66,eo(o?1200:1252)),o&&vs(a,353,eo(0)),o&&vs(a,448),vs(a,317,mV(t.SheetNames.length)),o&&t.vbaraw&&vs(a,211),o&&t.vbaraw){var u=l.CodeName||"ThisWorkbook";vs(a,442,tB(u))}vs(a,156,eo(17)),vs(a,25,Mi(!1)),vs(a,18,Mi(!1)),vs(a,19,eo(0)),o&&vs(a,431,Mi(!1)),o&&vs(a,444,eo(0)),vs(a,61,p$()),vs(a,64,Mi(!1)),vs(a,141,eo(0)),vs(a,34,Mi(AX(t)=="true")),vs(a,14,Mi(!0)),o&&vs(a,439,Mi(!1)),vs(a,218,eo(0)),kJ(a,t,r),EJ(a,t.SSF,r),FJ(a,r),o&&vs(a,352,Mi(!1));var c=a.end(),h=ul();o&&vs(h,140,nV()),o&&r.Strings&&jJ(h,252,d$(r.Strings)),vs(h,10);var m=h.end(),p=ul(),g=0,x=0;for(x=0;x<t.SheetNames.length;++x)g+=(o?12:11)+(o?2:1)*t.SheetNames[x].length;var b=c.length+g+m.length;for(x=0;x<t.SheetNames.length;++x){var y=i[x]||{};vs(p,133,o$({pos:b,hs:y.Hidden||0,dt:0,name:t.SheetNames[x]},r)),b+=s[x].length}var j=p.end();if(g!=j.length)throw new Error("BS8 "+g+" != "+j.length);var N=[];return c.length&&N.push(c),j.length&&N.push(j),m.length&&N.push(m),Fn(N)}function UJ(t,s){var r=s||{},a=[];t&&!t.SSF&&(t.SSF=ha(Vs)),t&&t.SSF&&(iA(),Bg(t.SSF),r.revssf=Tg(t.SSF),r.revssf[t.SSF[65535]]=0,r.ssf=t.SSF),r.Strings=[],r.Strings.Count=0,r.Strings.Unique=0,QN(r),r.cellXfs=[],Du(r.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={});for(var n=0;n<t.SheetNames.length;++n)a[a.length]=DJ(n,r,t);return a.unshift(PJ(t,a,r)),Fn(a)}function KB(t,s){for(var r=0;r<=t.SheetNames.length;++r){var a=t.Sheets[t.SheetNames[r]];if(!(!a||!a["!ref"])){var n=ml(a["!ref"]);n.e.c>255&&typeof console<"u"&&console.error&&console.error("Worksheet '"+t.SheetNames[r]+"' extends beyond column IV (255).  Data may be lost.")}}var i=s||{};switch(i.biff||2){case 8:case 5:return UJ(t,s);case 4:case 3:case 2:return CJ(t,s)}throw new Error("invalid type "+i.bookType+" for BIFF")}function YS(t,s){var r=s||{},a=r.dense?[]:{};t=t.replace(/<!--.*?-->/g,"");var n=t.match(/<table/i);if(!n)throw new Error("Invalid HTML: could not find <table>");var i=t.match(/<\/table/i),l=n.index,o=i&&i.index||t.length,d=y9(t.slice(l,o),/(:?<tr[^>]*>)/i,"<tr>"),u=-1,c=0,h=0,m=0,p={s:{r:1e7,c:1e7},e:{r:0,c:0}},g=[];for(l=0;l<d.length;++l){var x=d[l].trim(),b=x.slice(0,3).toLowerCase();if(b=="<tr"){if(++u,r.sheetRows&&r.sheetRows<=u){--u;break}c=0;continue}if(!(b!="<td"&&b!="<th")){var y=x.split(/<\/t[dh]>/i);for(o=0;o<y.length;++o){var j=y[o].trim();if(j.match(/<t[dh]/i)){for(var N=j,_=0;N.charAt(0)=="<"&&(_=N.indexOf(">"))>-1;)N=N.slice(_+1);for(var F=0;F<g.length;++F){var I=g[F];I.s.c==c&&I.s.r<u&&u<=I.e.r&&(c=I.e.c+1,F=-1)}var w=Ys(j.slice(0,j.indexOf(">")));m=w.colspan?+w.colspan:1,((h=+w.rowspan)>1||m>1)&&g.push({s:{r:u,c},e:{r:u+(h||1)-1,c:c+m-1}});var E=w.t||w["data-t"]||"";if(!N.length){c+=m;continue}if(N=gE(N),p.s.r>u&&(p.s.r=u),p.e.r<u&&(p.e.r=u),p.s.c>c&&(p.s.c=c),p.e.c<c&&(p.e.c=c),!N.length){c+=m;continue}var W={t:"s",v:N};r.raw||!N.trim().length||E=="s"||(N==="TRUE"?W={t:"b",v:!0}:N==="FALSE"?W={t:"b",v:!1}:isNaN(Vo(N))?isNaN(Gh(N).getDate())||(W={t:"d",v:ma(N)},r.cellDates||(W={t:"n",v:pn(W.v)}),W.z=r.dateNF||Vs[14]):W={t:"n",v:Vo(N)}),r.dense?(a[u]||(a[u]=[]),a[u][c]=W):a[Ks({r:u,c})]=W,c+=m}}}}return a["!ref"]=lr(p),g.length&&(a["!merges"]=g),a}function RJ(t,s,r,a){for(var n=t["!merges"]||[],i=[],l=s.s.c;l<=s.e.c;++l){for(var o=0,d=0,u=0;u<n.length;++u)if(!(n[u].s.r>r||n[u].s.c>l)&&!(n[u].e.r<r||n[u].e.c<l)){if(n[u].s.r<r||n[u].s.c<l){o=-1;break}o=n[u].e.r-n[u].s.r+1,d=n[u].e.c-n[u].s.c+1;break}if(!(o<0)){var c=Ks({r,c:l}),h=a.dense?(t[r]||[])[l]:t[c],m=h&&h.v!=null&&(h.h||fN(h.w||(bd(h),h.w)||""))||"",p={};o>1&&(p.rowspan=o),d>1&&(p.colspan=d),a.editable?m='<span contenteditable="true">'+m+"</span>":h&&(p["data-t"]=h&&h.t||"z",h.v!=null&&(p["data-v"]=h.v),h.z!=null&&(p["data-z"]=h.z),h.l&&(h.l.Target||"#").charAt(0)!="#"&&(m='<a href="'+h.l.Target+'">'+m+"</a>")),p.id=(a.id||"sjs")+"-"+c,i.push(gs("td",m,p))}}var g="<tr>";return g+i.join("")+"</tr>"}var OJ='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',MJ="</body></html>";function QJ(t,s){var r=t.match(/<table[\s\S]*?>[\s\S]*?<\/table>/gi);if(!r||r.length==0)throw new Error("Invalid HTML: could not find <table>");if(r.length==1)return Lu(YS(r[0],s),s);var a=$N();return r.forEach(function(n,i){VN(a,YS(n,s),"Sheet"+(i+1))}),a}function HJ(t,s,r){var a=[];return a.join("")+"<table"+(r&&r.id?' id="'+r.id+'"':"")+">"}function zB(t,s){var r=s||{},a=r.header!=null?r.header:OJ,n=r.footer!=null?r.footer:MJ,i=[a],l=ml(t["!ref"]);r.dense=Array.isArray(t),i.push(HJ(t,l,r));for(var o=l.s.r;o<=l.e.r;++o)i.push(RJ(t,l,o,r));return i.push("</table>"+n),i.join("")}function YB(t,s,r){var a=r||{},n=0,i=0;if(a.origin!=null)if(typeof a.origin=="number")n=a.origin;else{var l=typeof a.origin=="string"?wa(a.origin):a.origin;n=l.r,i=l.c}var o=s.getElementsByTagName("tr"),d=Math.min(a.sheetRows||1e7,o.length),u={s:{r:0,c:0},e:{r:n,c:i}};if(t["!ref"]){var c=ml(t["!ref"]);u.s.r=Math.min(u.s.r,c.s.r),u.s.c=Math.min(u.s.c,c.s.c),u.e.r=Math.max(u.e.r,c.e.r),u.e.c=Math.max(u.e.c,c.e.c),n==-1&&(u.e.r=n=c.e.r+1)}var h=[],m=0,p=t["!rows"]||(t["!rows"]=[]),g=0,x=0,b=0,y=0,j=0,N=0;for(t["!cols"]||(t["!cols"]=[]);g<o.length&&x<d;++g){var _=o[g];if(XS(_)){if(a.display)continue;p[x]={hidden:!0}}var F=_.children;for(b=y=0;b<F.length;++b){var I=F[b];if(!(a.display&&XS(I))){var w=I.hasAttribute("data-v")?I.getAttribute("data-v"):I.hasAttribute("v")?I.getAttribute("v"):gE(I.innerHTML),E=I.getAttribute("data-z")||I.getAttribute("z");for(m=0;m<h.length;++m){var W=h[m];W.s.c==y+i&&W.s.r<x+n&&x+n<=W.e.r&&(y=W.e.c+1-i,m=-1)}N=+I.getAttribute("colspan")||1,((j=+I.getAttribute("rowspan")||1)>1||N>1)&&h.push({s:{r:x+n,c:y+i},e:{r:x+n+(j||1)-1,c:y+i+(N||1)-1}});var R={t:"s",v:w},U=I.getAttribute("data-t")||I.getAttribute("t")||"";w!=null&&(w.length==0?R.t=U||"z":a.raw||w.trim().length==0||U=="s"||(w==="TRUE"?R={t:"b",v:!0}:w==="FALSE"?R={t:"b",v:!1}:isNaN(Vo(w))?isNaN(Gh(w).getDate())||(R={t:"d",v:ma(w)},a.cellDates||(R={t:"n",v:pn(R.v)}),R.z=a.dateNF||Vs[14]):R={t:"n",v:Vo(w)})),R.z===void 0&&E!=null&&(R.z=E);var T="",Y=I.getElementsByTagName("A");if(Y&&Y.length)for(var H=0;H<Y.length&&!(Y[H].hasAttribute("href")&&(T=Y[H].getAttribute("href"),T.charAt(0)!="#"));++H);T&&T.charAt(0)!="#"&&(R.l={Target:T}),a.dense?(t[x+n]||(t[x+n]=[]),t[x+n][y+i]=R):t[Ks({c:y+i,r:x+n})]=R,u.e.c<y+i&&(u.e.c=y+i),y+=N}}++x}return h.length&&(t["!merges"]=(t["!merges"]||[]).concat(h)),u.e.r=Math.max(u.e.r,x-1+n),t["!ref"]=lr(u),x>=d&&(t["!fullref"]=lr((u.e.r=o.length-g+x-1+n,u))),t}function XB(t,s){var r=s||{},a=r.dense?[]:{};return YB(a,t,s)}function qJ(t,s){return Lu(XB(t,s),s)}function XS(t){var s="",r=$J(t);return r&&(s=r(t).getPropertyValue("display")),s||(s=t.style&&t.style.display),s==="none"}function $J(t){return t.ownerDocument.defaultView&&typeof t.ownerDocument.defaultView.getComputedStyle=="function"?t.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}function VJ(t){var s=t.replace(/[\t\r\n]/g," ").trim().replace(/ +/g," ").replace(/<text:s\/>/g," ").replace(/<text:s text:c="(\d+)"\/>/g,function(a,n){return Array(parseInt(n,10)+1).join(" ")}).replace(/<text:tab[^>]*\/>/g,"	").replace(/<text:line-break\/>/g,`
`),r=Sr(s.replace(/<[^>]*>/g,""));return[r]}var JS={day:["d","dd"],month:["m","mm"],year:["y","yy"],hours:["h","hh"],minutes:["m","mm"],seconds:["s","ss"],"am-pm":["A/P","AM/PM"],"day-of-week":["ddd","dddd"],era:["e","ee"],quarter:["\\Qm",'m\\"th quarter"']};function JB(t,s){var r=s||{},a=pN(t),n=[],i,l,o={name:""},d="",u=0,c,h,m={},p=[],g=r.dense?[]:{},x,b,y={value:""},j="",N=0,_=[],F=-1,I=-1,w={s:{r:1e6,c:1e7},e:{r:0,c:0}},E=0,W={},R=[],U={},T=0,Y=0,H=[],M=1,q=1,z=[],Q={Names:[]},L={},V=["",""],P=[],C={},k="",B=0,G=!1,O=!1,K=0;for(Df.lastIndex=0,a=a.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");x=Df.exec(a);)switch(x[3]=x[3].replace(/_.*$/,"")){case"table":case"":x[1]==="/"?(w.e.c>=w.s.c&&w.e.r>=w.s.r?g["!ref"]=lr(w):g["!ref"]="A1:A1",r.sheetRows>0&&r.sheetRows<=w.e.r&&(g["!fullref"]=g["!ref"],w.e.r=r.sheetRows-1,g["!ref"]=lr(w)),R.length&&(g["!merges"]=R),H.length&&(g["!rows"]=H),c.name=c.||c.name,typeof JSON<"u"&&JSON.stringify(c),p.push(c.name),m[c.name]=g,O=!1):x[0].charAt(x[0].length-2)!=="/"&&(c=Ys(x[0],!1),F=I=-1,w.s.r=w.s.c=1e7,w.e.r=w.e.c=0,g=r.dense?[]:{},R=[],H=[],O=!0);break;case"table-row-group":x[1]==="/"?--E:++E;break;case"table-row":case"":if(x[1]==="/"){F+=M,M=1;break}if(h=Ys(x[0],!1),h.?F=h.-1:F==-1&&(F=0),M=+h["number-rows-repeated"]||1,M<10)for(K=0;K<M;++K)E>0&&(H[F+K]={level:E});I=-1;break;case"covered-table-cell":x[1]!=="/"&&++I,r.sheetStubs&&(r.dense?(g[F]||(g[F]=[]),g[F][I]={t:"z"}):g[Ks({r:F,c:I})]={t:"z"}),j="",_=[];break;case"table-cell":case"":if(x[0].charAt(x[0].length-2)==="/")++I,y=Ys(x[0],!1),q=parseInt(y["number-columns-repeated"]||"1",10),b={t:"z",v:null},y.formula&&r.cellFormula!=!1&&(b.f=GS(Sr(y.formula))),(y.||y["value-type"])=="string"&&(b.t="s",b.v=Sr(y["string-value"]||""),r.dense?(g[F]||(g[F]=[]),g[F][I]=b):g[Ks({r:F,c:I})]=b),I+=q-1;else if(x[1]!=="/"){++I,j="",N=0,_=[],q=1;var J=M?F+M-1:F;if(I>w.e.c&&(w.e.c=I),I<w.s.c&&(w.s.c=I),F<w.s.r&&(w.s.r=F),J>w.e.r&&(w.e.r=J),y=Ys(x[0],!1),P=[],C={},b={t:y.||y["value-type"],v:null},r.cellFormula)if(y.formula&&(y.formula=Sr(y.formula)),y["number-matrix-columns-spanned"]&&y["number-matrix-rows-spanned"]&&(T=parseInt(y["number-matrix-rows-spanned"],10)||0,Y=parseInt(y["number-matrix-columns-spanned"],10)||0,U={s:{r:F,c:I},e:{r:F+T-1,c:I+Y-1}},b.F=lr(U),z.push([U,b.F])),y.formula)b.f=GS(y.formula);else for(K=0;K<z.length;++K)F>=z[K][0].s.r&&F<=z[K][0].e.r&&I>=z[K][0].s.c&&I<=z[K][0].e.c&&(b.F=z[K][1]);switch((y["number-columns-spanned"]||y["number-rows-spanned"])&&(T=parseInt(y["number-rows-spanned"],10)||0,Y=parseInt(y["number-columns-spanned"],10)||0,U={s:{r:F,c:I},e:{r:F+T-1,c:I+Y-1}},R.push(U)),y["number-columns-repeated"]&&(q=parseInt(y["number-columns-repeated"],10)),b.t){case"boolean":b.t="b",b.v=da(y["boolean-value"]);break;case"float":b.t="n",b.v=parseFloat(y.value);break;case"percentage":b.t="n",b.v=parseFloat(y.value);break;case"currency":b.t="n",b.v=parseFloat(y.value);break;case"date":b.t="d",b.v=ma(y["date-value"]),r.cellDates||(b.t="n",b.v=pn(b.v)),b.z="m/d/yy";break;case"time":b.t="n",b.v=g9(y["time-value"])/86400,r.cellDates&&(b.t="d",b.v=Ig(b.v)),b.z="HH:MM:SS";break;case"number":b.t="n",b.v=parseFloat(y.);break;default:if(b.t==="string"||b.t==="text"||!b.t)b.t="s",y["string-value"]!=null&&(j=Sr(y["string-value"]),_=[]);else throw new Error("Unsupported value type "+b.t)}}else{if(G=!1,b.t==="s"&&(b.v=j||"",_.length&&(b.R=_),G=N==0),L.Target&&(b.l=L),P.length>0&&(b.c=P,P=[]),j&&r.cellText!==!1&&(b.w=j),G&&(b.t="z",delete b.v),(!G||r.sheetStubs)&&!(r.sheetRows&&r.sheetRows<=F))for(var te=0;te<M;++te){if(q=parseInt(y["number-columns-repeated"]||"1",10),r.dense)for(g[F+te]||(g[F+te]=[]),g[F+te][I]=te==0?b:ha(b);--q>0;)g[F+te][I+q]=ha(b);else for(g[Ks({r:F+te,c:I})]=b;--q>0;)g[Ks({r:F+te,c:I+q})]=ha(b);w.e.c<=I&&(w.e.c=I)}q=parseInt(y["number-columns-repeated"]||"1",10),I+=q-1,q=0,b={},j="",_=[]}L={};break;case"document":case"document-content":case"":case"spreadsheet":case"":case"scripts":case"styles":case"font-face-decls":case"master-styles":if(x[1]==="/"){if((i=n.pop())[0]!==x[3])throw"Bad state: "+i}else x[0].charAt(x[0].length-2)!=="/"&&n.push([x[3],!0]);break;case"annotation":if(x[1]==="/"){if((i=n.pop())[0]!==x[3])throw"Bad state: "+i;C.t=j,_.length&&(C.R=_),C.a=k,P.push(C)}else x[0].charAt(x[0].length-2)!=="/"&&n.push([x[3],!1]);k="",B=0,j="",N=0,_=[];break;case"creator":x[1]==="/"?k=a.slice(B,x.index):B=x.index+x[0].length;break;case"meta":case"":case"settings":case"config-item-set":case"config-item-map-indexed":case"config-item-map-entry":case"config-item-map-named":case"shapes":case"frame":case"text-box":case"image":case"data-pilot-tables":case"list-style":case"form":case"dde-links":case"event-listeners":case"chart":if(x[1]==="/"){if((i=n.pop())[0]!==x[3])throw"Bad state: "+i}else x[0].charAt(x[0].length-2)!=="/"&&n.push([x[3],!1]);j="",N=0,_=[];break;case"scientific-number":break;case"currency-symbol":break;case"currency-style":break;case"number-style":case"percentage-style":case"date-style":case"time-style":if(x[1]==="/"){if(W[o.name]=d,(i=n.pop())[0]!==x[3])throw"Bad state: "+i}else x[0].charAt(x[0].length-2)!=="/"&&(d="",o=Ys(x[0],!1),n.push([x[3],!0]));break;case"script":break;case"libraries":break;case"automatic-styles":break;case"default-style":case"page-layout":break;case"style":break;case"map":break;case"font-face":break;case"paragraph-properties":break;case"table-properties":break;case"table-column-properties":break;case"table-row-properties":break;case"table-cell-properties":break;case"number":switch(n[n.length-1][0]){case"time-style":case"date-style":l=Ys(x[0],!1),d+=JS[x[3]][l.style==="long"?1:0];break}break;case"fraction":break;case"day":case"month":case"year":case"era":case"day-of-week":case"week-of-year":case"quarter":case"hours":case"minutes":case"seconds":case"am-pm":switch(n[n.length-1][0]){case"time-style":case"date-style":l=Ys(x[0],!1),d+=JS[x[3]][l.style==="long"?1:0];break}break;case"boolean-style":break;case"boolean":break;case"text-style":break;case"text":if(x[0].slice(-2)==="/>")break;if(x[1]==="/")switch(n[n.length-1][0]){case"number-style":case"date-style":case"time-style":d+=a.slice(u,x.index);break}else u=x.index+x[0].length;break;case"named-range":l=Ys(x[0],!1),V=Ob(l["cell-range-address"]);var se={Name:l.name,Ref:V[0]+"!"+V[1]};O&&(se.Sheet=p.length),Q.Names.push(se);break;case"text-content":break;case"text-properties":break;case"embedded-text":break;case"body":case"":break;case"forms":break;case"table-column":break;case"table-header-rows":break;case"table-rows":break;case"table-column-group":break;case"table-header-columns":break;case"table-columns":break;case"null-date":break;case"graphic-properties":break;case"calculation-settings":break;case"named-expressions":break;case"label-range":break;case"label-ranges":break;case"named-expression":break;case"sort":break;case"sort-by":break;case"sort-groups":break;case"tab":break;case"line-break":break;case"span":break;case"p":case"":if(["master-styles"].indexOf(n[n.length-1][0])>-1)break;if(x[1]==="/"&&(!y||!y["string-value"])){var ae=VJ(a.slice(N,x.index));j=(j.length>0?j+`
`:"")+ae[0]}else Ys(x[0],!1),N=x.index+x[0].length;break;case"s":break;case"database-range":if(x[1]==="/")break;try{V=Ob(Ys(x[0])["target-range-address"]),m[V[0]]["!autofilter"]={ref:V[1]}}catch{}break;case"date":break;case"object":break;case"title":case"":break;case"desc":break;case"binary-data":break;case"table-source":break;case"scenario":break;case"iteration":break;case"content-validations":break;case"content-validation":break;case"help-message":break;case"error-message":break;case"database-ranges":break;case"filter":break;case"filter-and":break;case"filter-or":break;case"filter-condition":break;case"list-level-style-bullet":break;case"list-level-style-number":break;case"list-level-properties":break;case"sender-firstname":case"sender-lastname":case"sender-initials":case"sender-title":case"sender-position":case"sender-email":case"sender-phone-private":case"sender-fax":case"sender-company":case"sender-phone-work":case"sender-street":case"sender-city":case"sender-postal-code":case"sender-country":case"sender-state-or-province":case"author-name":case"author-initials":case"chapter":case"file-name":case"template-name":case"sheet-name":break;case"event-listener":break;case"initial-creator":case"creation-date":case"print-date":case"generator":case"document-statistic":case"user-defined":case"editing-duration":case"editing-cycles":break;case"config-item":break;case"page-number":break;case"page-count":break;case"time":break;case"cell-range-source":break;case"detective":break;case"operation":break;case"highlighted-range":break;case"data-pilot-table":case"source-cell-range":case"source-service":case"data-pilot-field":case"data-pilot-level":case"data-pilot-subtotals":case"data-pilot-subtotal":case"data-pilot-members":case"data-pilot-member":case"data-pilot-display-info":case"data-pilot-sort-info":case"data-pilot-layout-info":case"data-pilot-field-reference":case"data-pilot-groups":case"data-pilot-group":case"data-pilot-group-member":break;case"rect":break;case"dde-connection-decls":case"dde-connection-decl":case"dde-link":case"dde-source":break;case"properties":break;case"property":break;case"a":if(x[1]!=="/"){if(L=Ys(x[0],!1),!L.href)break;L.Target=Sr(L.href),delete L.href,L.Target.charAt(0)=="#"&&L.Target.indexOf(".")>-1?(V=Ob(L.Target.slice(1)),L.Target="#"+V[0]+"!"+V[1]):L.Target.match(/^\.\.[\\\/]/)&&(L.Target=L.Target.slice(3))}break;case"table-protection":break;case"data-pilot-grand-total":break;case"office-document-common-attrs":break;default:switch(x[2]){case"dc:":case"calcext:":case"loext:":case"ooo:":case"chartooo:":case"draw:":case"style:":case"chart:":case"form:":case"uof:":case":":case":":break;default:if(r.WTF)throw new Error(x)}}var ne={Sheets:m,SheetNames:p,Workbook:Q};return r.bookSheets&&delete ne.Sheets,ne}function ZS(t,s){s=s||{},Zl(t,"META-INF/manifest.xml")&&gq(an(t,"META-INF/manifest.xml"),s);var r=Cl(t,"content.xml");if(!r)throw new Error("Missing content.xml in ODS / UOF file");var a=JB(Xr(r),s);return Zl(t,"meta.xml")&&(a.Props=HE(an(t,"meta.xml"))),a}function eC(t,s){return JB(t,s)}var WJ=(function(){var t=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),s="<office:document-styles "+Lf({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+t+"</office:document-styles>";return function(){return Xa+s}})(),tC=(function(){var t=function(i){return Gr(i).replace(/  +/g,function(l){return'<text:s text:c="'+l.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},s=`          <table:table-cell />
`,r=`          <table:covered-table-cell/>
`,a=function(i,l,o){var d=[];d.push('      <table:table table:name="'+Gr(l.SheetNames[o])+`" table:style-name="ta1">
`);var u=0,c=0,h=ml(i["!ref"]||"A1"),m=i["!merges"]||[],p=0,g=Array.isArray(i);if(i["!cols"])for(c=0;c<=h.e.c;++c)d.push("        <table:table-column"+(i["!cols"][c]?' table:style-name="co'+i["!cols"][c].ods+'"':"")+`></table:table-column>
`);var x="",b=i["!rows"]||[];for(u=0;u<h.s.r;++u)x=b[u]?' table:style-name="ro'+b[u].ods+'"':"",d.push("        <table:table-row"+x+`></table:table-row>
`);for(;u<=h.e.r;++u){for(x=b[u]?' table:style-name="ro'+b[u].ods+'"':"",d.push("        <table:table-row"+x+`>
`),c=0;c<h.s.c;++c)d.push(s);for(;c<=h.e.c;++c){var y=!1,j={},N="";for(p=0;p!=m.length;++p)if(!(m[p].s.c>c)&&!(m[p].s.r>u)&&!(m[p].e.c<c)&&!(m[p].e.r<u)){(m[p].s.c!=c||m[p].s.r!=u)&&(y=!0),j["table:number-columns-spanned"]=m[p].e.c-m[p].s.c+1,j["table:number-rows-spanned"]=m[p].e.r-m[p].s.r+1;break}if(y){d.push(r);continue}var _=Ks({r:u,c}),F=g?(i[u]||[])[c]:i[_];if(F&&F.f&&(j["table:formula"]=Gr(mz(F.f)),F.F&&F.F.slice(0,_.length)==_)){var I=ml(F.F);j["table:number-matrix-columns-spanned"]=I.e.c-I.s.c+1,j["table:number-matrix-rows-spanned"]=I.e.r-I.s.r+1}if(!F){d.push(s);continue}switch(F.t){case"b":N=F.v?"TRUE":"FALSE",j["office:value-type"]="boolean",j["office:boolean-value"]=F.v?"true":"false";break;case"n":N=F.w||String(F.v||0),j["office:value-type"]="float",j["office:value"]=F.v||0;break;case"s":case"str":N=F.v==null?"":F.v,j["office:value-type"]="string";break;case"d":N=F.w||ma(F.v).toISOString(),j["office:value-type"]="date",j["office:date-value"]=ma(F.v).toISOString(),j["table:style-name"]="ce1";break;default:d.push(s);continue}var w=t(N);if(F.l&&F.l.Target){var E=F.l.Target;E=E.charAt(0)=="#"?"#"+hz(E.slice(1)):E,E.charAt(0)!="#"&&!E.match(/^\w+:/)&&(E="../"+E),w=gs("text:a",w,{"xlink:href":E.replace(/&/g,"&amp;")})}d.push("          "+gs("table:table-cell",gs("text:p",w,{}),j)+`
`)}d.push(`        </table:table-row>
`)}return d.push(`      </table:table>
`),d.join("")},n=function(i,l){i.push(` <office:automatic-styles>
`),i.push(`  <number:date-style style:name="N37" number:automatic-order="true">
`),i.push(`   <number:month number:style="long"/>
`),i.push(`   <number:text>/</number:text>
`),i.push(`   <number:day number:style="long"/>
`),i.push(`   <number:text>/</number:text>
`),i.push(`   <number:year/>
`),i.push(`  </number:date-style>
`);var o=0;l.SheetNames.map(function(u){return l.Sheets[u]}).forEach(function(u){if(u&&u["!cols"]){for(var c=0;c<u["!cols"].length;++c)if(u["!cols"][c]){var h=u["!cols"][c];if(h.width==null&&h.wpx==null&&h.wch==null)continue;Bu(h),h.ods=o;var m=u["!cols"][c].wpx+"px";i.push('  <style:style style:name="co'+o+`" style:family="table-column">
`),i.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+m+`"/>
`),i.push(`  </style:style>
`),++o}}});var d=0;l.SheetNames.map(function(u){return l.Sheets[u]}).forEach(function(u){if(u&&u["!rows"]){for(var c=0;c<u["!rows"].length;++c)if(u["!rows"][c]){u["!rows"][c].ods=d;var h=u["!rows"][c].hpx+"px";i.push('  <style:style style:name="ro'+d+`" style:family="table-row">
`),i.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+h+`"/>
`),i.push(`  </style:style>
`),++d}}}),i.push(`  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">
`),i.push(`   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>
`),i.push(`  </style:style>
`),i.push(`  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>
`),i.push(` </office:automatic-styles>
`)};return function(l,o){var d=[Xa],u=Lf({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),c=Lf({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});o.bookType=="fods"?(d.push("<office:document"+u+c+`>
`),d.push(QE().replace(/office:document-meta/g,"office:meta"))):d.push("<office:document-content"+u+`>
`),n(d,l),d.push(`  <office:body>
`),d.push(`    <office:spreadsheet>
`);for(var h=0;h!=l.SheetNames.length;++h)d.push(a(l.Sheets[l.SheetNames[h]],l,h));return d.push(`    </office:spreadsheet>
`),d.push(`  </office:body>
`),o.bookType=="fods"?d.push("</office:document>"):d.push("</office:document-content>"),d.join("")}})();function ZB(t,s){if(s.bookType=="fods")return tC(t,s);var r=mN(),a="",n=[],i=[];return a="mimetype",cr(r,a,"application/vnd.oasis.opendocument.spreadsheet"),a="content.xml",cr(r,a,tC(t,s)),n.push([a,"text/xml"]),i.push([a,"ContentFile"]),a="styles.xml",cr(r,a,WJ(t,s)),n.push([a,"text/xml"]),i.push([a,"StylesFile"]),a="meta.xml",cr(r,a,Xa+QE()),n.push([a,"text/xml"]),i.push([a,"MetadataFile"]),a="manifest.rdf",cr(r,a,yq(i)),n.push([a,"application/rdf+xml"]),a="META-INF/manifest.xml",cr(r,a,vq(n)),r}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function Im(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function bj(t){return typeof TextDecoder<"u"?new TextDecoder().decode(t):Xr(Iu(t))}function GJ(t){return typeof TextEncoder<"u"?new TextEncoder().encode(t):Sl(Nc(t))}function KJ(t,s){e:for(var r=0;r<=t.length-s.length;++r){for(var a=0;a<s.length;++a)if(t[r+a]!=s[a])continue e;return!0}return!1}function Tu(t){var s=t.reduce(function(n,i){return n+i.length},0),r=new Uint8Array(s),a=0;return t.forEach(function(n){r.set(n,a),a+=n.length}),r}function sC(t){return t-=t>>1&1431655765,t=(t&858993459)+(t>>2&858993459),(t+(t>>4)&252645135)*16843009>>>24}function zJ(t,s){for(var r=(t[s+15]&127)<<7|t[s+14]>>1,a=t[s+14]&1,n=s+13;n>=s;--n)a=a*256+t[n];return(t[s+15]&128?-a:a)*Math.pow(10,r-6176)}function YJ(t,s,r){var a=Math.floor(r==0?0:Math.LOG10E*Math.log(Math.abs(r)))+6176-20,n=r/Math.pow(10,a-6176);t[s+15]|=a>>7,t[s+14]|=(a&127)<<1;for(var i=0;n>=1;++i,n/=256)t[s+i]=n&255;t[s+15]|=r>=0?0:128}function Hf(t,s){var r=s?s[0]:0,a=t[r]&127;e:if(t[r++]>=128&&(a|=(t[r]&127)<<7,t[r++]<128||(a|=(t[r]&127)<<14,t[r++]<128)||(a|=(t[r]&127)<<21,t[r++]<128)||(a+=(t[r]&127)*Math.pow(2,28),++r,t[r++]<128)||(a+=(t[r]&127)*Math.pow(2,35),++r,t[r++]<128)||(a+=(t[r]&127)*Math.pow(2,42),++r,t[r++]<128)))break e;return s&&(s[0]=r),a}function qr(t){var s=new Uint8Array(7);s[0]=t&127;var r=1;e:if(t>127){if(s[r-1]|=128,s[r]=t>>7&127,++r,t<=16383||(s[r-1]|=128,s[r]=t>>14&127,++r,t<=2097151)||(s[r-1]|=128,s[r]=t>>21&127,++r,t<=268435455)||(s[r-1]|=128,s[r]=t/256>>>21&127,++r,t<=34359738367)||(s[r-1]|=128,s[r]=t/65536>>>21&127,++r,t<=4398046511103))break e;s[r-1]|=128,s[r]=t/16777216>>>21&127,++r}return s.slice(0,r)}function La(t){var s=0,r=t[s]&127;e:if(t[s++]>=128){if(r|=(t[s]&127)<<7,t[s++]<128||(r|=(t[s]&127)<<14,t[s++]<128)||(r|=(t[s]&127)<<21,t[s++]<128))break e;r|=(t[s]&127)<<28}return r}function Fr(t){for(var s=[],r=[0];r[0]<t.length;){var a=r[0],n=Hf(t,r),i=n&7;n=Math.floor(n/8);var l=0,o;if(n==0)break;switch(i){case 0:{for(var d=r[0];t[r[0]++]>=128;);o=t.slice(d,r[0])}break;case 5:l=4,o=t.slice(r[0],r[0]+l),r[0]+=l;break;case 1:l=8,o=t.slice(r[0],r[0]+l),r[0]+=l;break;case 2:l=Hf(t,r),o=t.slice(r[0],r[0]+l),r[0]+=l;break;case 3:case 4:default:throw new Error("PB Type ".concat(i," for Field ").concat(n," at offset ").concat(a))}var u={data:o,type:i};s[n]==null?s[n]=[u]:s[n].push(u)}return s}function $n(t){var s=[];return t.forEach(function(r,a){r.forEach(function(n){n.data&&(s.push(qr(a*8+n.type)),n.type==2&&s.push(qr(n.data.length)),s.push(n.data))})}),Tu(s)}function ON(t,s){return(t==null?void 0:t.map(function(r){return s(r.data)}))||[]}function Yl(t){for(var s,r=[],a=[0];a[0]<t.length;){var n=Hf(t,a),i=Fr(t.slice(a[0],a[0]+n));a[0]+=n;var l={id:La(i[1][0].data),messages:[]};i[2].forEach(function(o){var d=Fr(o.data),u=La(d[3][0].data);l.messages.push({meta:d,data:t.slice(a[0],a[0]+u)}),a[0]+=u}),(s=i[3])!=null&&s[0]&&(l.merge=La(i[3][0].data)>>>0>0),r.push(l)}return r}function bh(t){var s=[];return t.forEach(function(r){var a=[];a[1]=[{data:qr(r.id),type:0}],a[2]=[],r.merge!=null&&(a[3]=[{data:qr(+!!r.merge),type:0}]);var n=[];r.messages.forEach(function(l){n.push(l.data),l.meta[3]=[{type:0,data:qr(l.data.length)}],a[2].push({data:$n(l.meta),type:2})});var i=$n(a);s.push(qr(i.length)),s.push(i),n.forEach(function(l){return s.push(l)})}),Tu(s)}function XJ(t,s){if(t!=0)throw new Error("Unexpected Snappy chunk type ".concat(t));for(var r=[0],a=Hf(s,r),n=[];r[0]<s.length;){var i=s[r[0]]&3;if(i==0){var l=s[r[0]++]>>2;if(l<60)++l;else{var o=l-59;l=s[r[0]],o>1&&(l|=s[r[0]+1]<<8),o>2&&(l|=s[r[0]+2]<<16),o>3&&(l|=s[r[0]+3]<<24),l>>>=0,l++,r[0]+=o}n.push(s.slice(r[0],r[0]+l)),r[0]+=l;continue}else{var d=0,u=0;if(i==1?(u=(s[r[0]]>>2&7)+4,d=(s[r[0]++]&224)<<3,d|=s[r[0]++]):(u=(s[r[0]++]>>2)+1,i==2?(d=s[r[0]]|s[r[0]+1]<<8,r[0]+=2):(d=(s[r[0]]|s[r[0]+1]<<8|s[r[0]+2]<<16|s[r[0]+3]<<24)>>>0,r[0]+=4)),n=[Tu(n)],d==0)throw new Error("Invalid offset 0");if(d>n[0].length)throw new Error("Invalid offset beyond length");if(u>=d)for(n.push(n[0].slice(-d)),u-=d;u>=n[n.length-1].length;)n.push(n[n.length-1]),u-=n[n.length-1].length;n.push(n[0].slice(-d,-d+u))}}var c=Tu(n);if(c.length!=a)throw new Error("Unexpected length: ".concat(c.length," != ").concat(a));return c}function Xl(t){for(var s=[],r=0;r<t.length;){var a=t[r++],n=t[r]|t[r+1]<<8|t[r+2]<<16;r+=3,s.push(XJ(a,t.slice(r,r+n))),r+=n}if(r!==t.length)throw new Error("data is not a valid framed stream!");return Tu(s)}function yh(t){for(var s=[],r=0;r<t.length;){var a=Math.min(t.length-r,268435455),n=new Uint8Array(4);s.push(n);var i=qr(a),l=i.length;s.push(i),a<=60?(l++,s.push(new Uint8Array([a-1<<2]))):a<=256?(l+=2,s.push(new Uint8Array([240,a-1&255]))):a<=65536?(l+=3,s.push(new Uint8Array([244,a-1&255,a-1>>8&255]))):a<=16777216?(l+=4,s.push(new Uint8Array([248,a-1&255,a-1>>8&255,a-1>>16&255]))):a<=4294967296&&(l+=5,s.push(new Uint8Array([252,a-1&255,a-1>>8&255,a-1>>16&255,a-1>>>24&255]))),s.push(t.slice(r,r+a)),l+=a,n[0]=0,n[1]=l&255,n[2]=l>>8&255,n[3]=l>>16&255,r+=a}return Tu(s)}function JJ(t,s,r,a){var n=Im(t),i=n.getUint32(4,!0),l=(a>1?12:8)+sC(i&(a>1?3470:398))*4,o=-1,d=-1,u=NaN,c=new Date(2001,0,1);i&512&&(o=n.getUint32(l,!0),l+=4),l+=sC(i&(a>1?12288:4096))*4,i&16&&(d=n.getUint32(l,!0),l+=4),i&32&&(u=n.getFloat64(l,!0),l+=8),i&64&&(c.setTime(c.getTime()+n.getFloat64(l,!0)*1e3),l+=8);var h;switch(t[2]){case 0:break;case 2:h={t:"n",v:u};break;case 3:h={t:"s",v:s[d]};break;case 5:h={t:"d",v:c};break;case 6:h={t:"b",v:u>0};break;case 7:h={t:"n",v:u/86400};break;case 8:h={t:"e",v:0};break;case 9:if(o>-1)h={t:"s",v:r[o]};else if(d>-1)h={t:"s",v:s[d]};else if(!isNaN(u))h={t:"n",v:u};else throw new Error("Unsupported cell type ".concat(t.slice(0,4)));break;default:throw new Error("Unsupported cell type ".concat(t.slice(0,4)))}return h}function ZJ(t,s,r){var a=Im(t),n=a.getUint32(8,!0),i=12,l=-1,o=-1,d=NaN,u=NaN,c=new Date(2001,0,1);n&1&&(d=zJ(t,i),i+=16),n&2&&(u=a.getFloat64(i,!0),i+=8),n&4&&(c.setTime(c.getTime()+a.getFloat64(i,!0)*1e3),i+=8),n&8&&(o=a.getUint32(i,!0),i+=4),n&16&&(l=a.getUint32(i,!0),i+=4);var h;switch(t[1]){case 0:break;case 2:h={t:"n",v:d};break;case 3:h={t:"s",v:s[o]};break;case 5:h={t:"d",v:c};break;case 6:h={t:"b",v:u>0};break;case 7:h={t:"n",v:u/86400};break;case 8:h={t:"e",v:0};break;case 9:if(l>-1)h={t:"s",v:r[l]};else throw new Error("Unsupported cell type ".concat(t[1]," : ").concat(n&31," : ").concat(t.slice(0,4)));break;case 10:h={t:"n",v:d};break;default:throw new Error("Unsupported cell type ".concat(t[1]," : ").concat(n&31," : ").concat(t.slice(0,4)))}return h}function Qb(t,s){var r=new Uint8Array(32),a=Im(r),n=12,i=0;switch(r[0]=5,t.t){case"n":r[1]=2,YJ(r,n,t.v),i|=1,n+=16;break;case"b":r[1]=6,a.setFloat64(n,t.v?1:0,!0),i|=2,n+=8;break;case"s":if(s.indexOf(t.v)==-1)throw new Error("Value ".concat(t.v," missing from SST!"));r[1]=3,a.setUint32(n,s.indexOf(t.v),!0),i|=8,n+=4;break;default:throw"unsupported cell type "+t.t}return a.setUint32(8,i,!0),r.slice(0,n)}function Hb(t,s){var r=new Uint8Array(32),a=Im(r),n=12,i=0;switch(r[0]=3,t.t){case"n":r[2]=2,a.setFloat64(n,t.v,!0),i|=32,n+=8;break;case"b":r[2]=6,a.setFloat64(n,t.v?1:0,!0),i|=32,n+=8;break;case"s":if(s.indexOf(t.v)==-1)throw new Error("Value ".concat(t.v," missing from SST!"));r[2]=3,a.setUint32(n,s.indexOf(t.v),!0),i|=16,n+=4;break;default:throw"unsupported cell type "+t.t}return a.setUint32(4,i,!0),r.slice(0,n)}function eZ(t,s,r){switch(t[0]){case 0:case 1:case 2:case 3:return JJ(t,s,r,t[0]);case 5:return ZJ(t,s,r);default:throw new Error("Unsupported payload version ".concat(t[0]))}}function pi(t){var s=Fr(t);return Hf(s[1][0].data)}function rC(t,s){var r=Fr(s.data),a=La(r[1][0].data),n=r[3],i=[];return(n||[]).forEach(function(l){var o=Fr(l.data),d=La(o[1][0].data)>>>0;switch(a){case 1:i[d]=bj(o[3][0].data);break;case 8:{var u=t[pi(o[9][0].data)][0],c=Fr(u.data),h=t[pi(c[1][0].data)][0],m=La(h.meta[1][0].data);if(m!=2001)throw new Error("2000 unexpected reference to ".concat(m));var p=Fr(h.data);i[d]=p[3].map(function(g){return bj(g.data)}).join("")}break}}),i}function tZ(t,s){var r,a,n,i,l,o,d,u,c,h,m,p,g,x,b=Fr(t),y=La(b[1][0].data)>>>0,j=La(b[2][0].data)>>>0,N=((a=(r=b[8])==null?void 0:r[0])==null?void 0:a.data)&&La(b[8][0].data)>0||!1,_,F;if((i=(n=b[7])==null?void 0:n[0])!=null&&i.data&&s!=0)_=(o=(l=b[7])==null?void 0:l[0])==null?void 0:o.data,F=(u=(d=b[6])==null?void 0:d[0])==null?void 0:u.data;else if((h=(c=b[4])==null?void 0:c[0])!=null&&h.data&&s!=1)_=(p=(m=b[4])==null?void 0:m[0])==null?void 0:p.data,F=(x=(g=b[3])==null?void 0:g[0])==null?void 0:x.data;else throw"NUMBERS Tile missing ".concat(s," cell storage");for(var I=N?4:1,w=Im(_),E=[],W=0;W<_.length/2;++W){var R=w.getUint16(W*2,!0);R<65535&&E.push([W,R])}if(E.length!=j)throw"Expected ".concat(j," cells, found ").concat(E.length);var U=[];for(W=0;W<E.length-1;++W)U[E[W][0]]=F.subarray(E[W][1]*I,E[W+1][1]*I);return E.length>=1&&(U[E[E.length-1][0]]=F.subarray(E[E.length-1][1]*I)),{R:y,cells:U}}function sZ(t,s){var r,a=Fr(s.data),n=(r=a==null?void 0:a[7])!=null&&r[0]?La(a[7][0].data)>>>0>0?1:0:-1,i=ON(a[5],function(l){return tZ(l,n)});return{nrows:La(a[4][0].data)>>>0,data:i.reduce(function(l,o){return l[o.R]||(l[o.R]=[]),o.cells.forEach(function(d,u){if(l[o.R][u])throw new Error("Duplicate cell r=".concat(o.R," c=").concat(u));l[o.R][u]=d}),l},[])}}function rZ(t,s,r){var a,n=Fr(s.data),i={s:{r:0,c:0},e:{r:0,c:0}};if(i.e.r=(La(n[6][0].data)>>>0)-1,i.e.r<0)throw new Error("Invalid row varint ".concat(n[6][0].data));if(i.e.c=(La(n[7][0].data)>>>0)-1,i.e.c<0)throw new Error("Invalid col varint ".concat(n[7][0].data));r["!ref"]=lr(i);var l=Fr(n[4][0].data),o=rC(t,t[pi(l[4][0].data)][0]),d=(a=l[17])!=null&&a[0]?rC(t,t[pi(l[17][0].data)][0]):[],u=Fr(l[3][0].data),c=0;u[1].forEach(function(h){var m=Fr(h.data),p=t[pi(m[2][0].data)][0],g=La(p.meta[1][0].data);if(g!=6002)throw new Error("6001 unexpected reference to ".concat(g));var x=sZ(t,p);x.data.forEach(function(b,y){b.forEach(function(j,N){var _=Ks({r:c+y,c:N}),F=eZ(j,o,d);F&&(r[_]=F)})}),c+=x.nrows})}function aZ(t,s){var r=Fr(s.data),a={"!ref":"A1"},n=t[pi(r[2][0].data)],i=La(n[0].meta[1][0].data);if(i!=6001)throw new Error("6000 unexpected reference to ".concat(i));return rZ(t,n[0],a),a}function nZ(t,s){var r,a=Fr(s.data),n={name:(r=a[1])!=null&&r[0]?bj(a[1][0].data):"",sheets:[]},i=ON(a[2],pi);return i.forEach(function(l){t[l].forEach(function(o){var d=La(o.meta[1][0].data);d==6e3&&n.sheets.push(aZ(t,o))})}),n}function iZ(t,s){var r=$N(),a=Fr(s.data),n=ON(a[1],pi);if(n.forEach(function(i){t[i].forEach(function(l){var o=La(l.meta[1][0].data);if(o==2){var d=nZ(t,l);d.sheets.forEach(function(u,c){VN(r,u,c==0?d.name:d.name+"_"+c,!0)})}})}),r.SheetNames.length==0)throw new Error("Empty NUMBERS file");return r}function qb(t){var s,r,a,n,i={},l=[];if(t.FullPaths.forEach(function(d){if(d.match(/\.iwpv2/))throw new Error("Unsupported password protection")}),t.FileIndex.forEach(function(d){if(d.name.match(/\.iwa$/)){var u;try{u=Xl(d.content)}catch(h){return console.log("?? "+d.content.length+" "+(h.message||h))}var c;try{c=Yl(u)}catch(h){return console.log("## "+(h.message||h))}c.forEach(function(h){i[h.id]=h.messages,l.push(h.id)})}}),!l.length)throw new Error("File has no messages");var o=((n=(a=(r=(s=i==null?void 0:i[1])==null?void 0:s[0])==null?void 0:r.meta)==null?void 0:a[1])==null?void 0:n[0].data)&&La(i[1][0].meta[1][0].data)==1&&i[1][0];if(o||l.forEach(function(d){i[d].forEach(function(u){var c=La(u.meta[1][0].data)>>>0;if(c==1)if(!o)o=u;else throw new Error("Document has multiple roots")})}),!o)throw new Error("Cannot find Document root");return iZ(i,o)}function lZ(t,s,r){var a,n,i,l;if(!((a=t[6])!=null&&a[0])||!((n=t[7])!=null&&n[0]))throw"Mutation only works on post-BNC storages!";var o=((l=(i=t[8])==null?void 0:i[0])==null?void 0:l.data)&&La(t[8][0].data)>0||!1;if(o)throw"Math only works with normal offsets";for(var d=0,u=Im(t[7][0].data),c=0,h=[],m=Im(t[4][0].data),p=0,g=[],x=0;x<s.length;++x){if(s[x]==null){u.setUint16(x*2,65535,!0),m.setUint16(x*2,65535);continue}u.setUint16(x*2,c,!0),m.setUint16(x*2,p,!0);var b,y;switch(typeof s[x]){case"string":b=Qb({t:"s",v:s[x]},r),y=Hb({t:"s",v:s[x]},r);break;case"number":b=Qb({t:"n",v:s[x]},r),y=Hb({t:"n",v:s[x]},r);break;case"boolean":b=Qb({t:"b",v:s[x]},r),y=Hb({t:"b",v:s[x]},r);break;default:throw new Error("Unsupported value "+s[x])}h.push(b),c+=b.length,g.push(y),p+=y.length,++d}for(t[2][0].data=qr(d);x<t[7][0].data.length/2;++x)u.setUint16(x*2,65535,!0),m.setUint16(x*2,65535,!0);return t[6][0].data=Tu(h),t[3][0].data=Tu(g),d}function oZ(t,s){if(!s||!s.numbers)throw new Error("Must pass a `numbers` option -- check the README");var r=t.Sheets[t.SheetNames[0]];t.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var a=ml(r["!ref"]);a.s.r=a.s.c=0;var n=!1;a.e.c>9&&(n=!0,a.e.c=9),a.e.r>49&&(n=!0,a.e.r=49),n&&console.error("The Numbers writer is currently limited to ".concat(lr(a)));var i=G0(r,{range:a,header:1}),l=["~Sh33tJ5~"];i.forEach(function(k){return k.forEach(function(B){typeof B=="string"&&l.push(B)})});var o={},d=[],u=Qs.read(s.numbers,{type:"base64"});u.FileIndex.map(function(k,B){return[k,u.FullPaths[B]]}).forEach(function(k){var B=k[0],G=k[1];if(B.type==2&&B.name.match(/\.iwa/)){var O=B.content,K=Xl(O),J=Yl(K);J.forEach(function(te){d.push(te.id),o[te.id]={deps:[],location:G,type:La(te.messages[0].meta[1][0].data)}})}}),d.sort(function(k,B){return k-B});var c=d.filter(function(k){return k>1}).map(function(k){return[k,qr(k)]});u.FileIndex.map(function(k,B){return[k,u.FullPaths[B]]}).forEach(function(k){var B=k[0];if(k[1],!!B.name.match(/\.iwa/)){var G=Yl(Xl(B.content));G.forEach(function(O){O.messages.forEach(function(K){c.forEach(function(J){O.messages.some(function(te){return La(te.meta[1][0].data)!=11006&&KJ(te.data,J[1])})&&o[J[0]].deps.push(O.id)})})})}});for(var h=Qs.find(u,o[1].location),m=Yl(Xl(h.content)),p,g=0;g<m.length;++g){var x=m[g];x.id==1&&(p=x)}var b=pi(Fr(p.messages[0].data)[1][0].data);for(h=Qs.find(u,o[b].location),m=Yl(Xl(h.content)),g=0;g<m.length;++g)x=m[g],x.id==b&&(p=x);for(b=pi(Fr(p.messages[0].data)[2][0].data),h=Qs.find(u,o[b].location),m=Yl(Xl(h.content)),g=0;g<m.length;++g)x=m[g],x.id==b&&(p=x);for(b=pi(Fr(p.messages[0].data)[2][0].data),h=Qs.find(u,o[b].location),m=Yl(Xl(h.content)),g=0;g<m.length;++g)x=m[g],x.id==b&&(p=x);var y=Fr(p.messages[0].data);{y[6][0].data=qr(a.e.r+1),y[7][0].data=qr(a.e.c+1);var j=pi(y[46][0].data),N=Qs.find(u,o[j].location),_=Yl(Xl(N.content));{for(var F=0;F<_.length&&_[F].id!=j;++F);if(_[F].id!=j)throw"Bad ColumnRowUIDMapArchive";var I=Fr(_[F].messages[0].data);I[1]=[],I[2]=[],I[3]=[];for(var w=0;w<=a.e.c;++w){var E=[];E[1]=E[2]=[{type:0,data:qr(w+420690)}],I[1].push({type:2,data:$n(E)}),I[2].push({type:0,data:qr(w)}),I[3].push({type:0,data:qr(w)})}I[4]=[],I[5]=[],I[6]=[];for(var W=0;W<=a.e.r;++W)E=[],E[1]=E[2]=[{type:0,data:qr(W+726270)}],I[4].push({type:2,data:$n(E)}),I[5].push({type:0,data:qr(W)}),I[6].push({type:0,data:qr(W)});_[F].messages[0].data=$n(I)}N.content=yh(bh(_)),N.size=N.content.length,delete y[46];var R=Fr(y[4][0].data);{R[7][0].data=qr(a.e.r+1);var U=Fr(R[1][0].data),T=pi(U[2][0].data);N=Qs.find(u,o[T].location),_=Yl(Xl(N.content));{if(_[0].id!=T)throw"Bad HeaderStorageBucket";var Y=Fr(_[0].messages[0].data);for(W=0;W<i.length;++W){var H=Fr(Y[2][0].data);H[1][0].data=qr(W),H[4][0].data=qr(i[W].length),Y[2][W]={type:Y[2][0].type,data:$n(H)}}_[0].messages[0].data=$n(Y)}N.content=yh(bh(_)),N.size=N.content.length;var M=pi(R[2][0].data);N=Qs.find(u,o[M].location),_=Yl(Xl(N.content));{if(_[0].id!=M)throw"Bad HeaderStorageBucket";for(Y=Fr(_[0].messages[0].data),w=0;w<=a.e.c;++w)H=Fr(Y[2][0].data),H[1][0].data=qr(w),H[4][0].data=qr(a.e.r+1),Y[2][w]={type:Y[2][0].type,data:$n(H)};_[0].messages[0].data=$n(Y)}N.content=yh(bh(_)),N.size=N.content.length;var q=pi(R[4][0].data);(function(){for(var k=Qs.find(u,o[q].location),B=Yl(Xl(k.content)),G,O=0;O<B.length;++O){var K=B[O];K.id==q&&(G=K)}var J=Fr(G.messages[0].data);{J[3]=[];var te=[];l.forEach(function(ne,ue){te[1]=[{type:0,data:qr(ue)}],te[2]=[{type:0,data:qr(1)}],te[3]=[{type:2,data:GJ(ne)}],J[3].push({type:2,data:$n(te)})})}G.messages[0].data=$n(J);var se=bh(B),ae=yh(se);k.content=ae,k.size=k.content.length})();var z=Fr(R[3][0].data);{var Q=z[1][0];delete z[2];var L=Fr(Q.data);{var V=pi(L[2][0].data);(function(){for(var k=Qs.find(u,o[V].location),B=Yl(Xl(k.content)),G,O=0;O<B.length;++O){var K=B[O];K.id==V&&(G=K)}var J=Fr(G.messages[0].data);{delete J[6],delete z[7];var te=new Uint8Array(J[5][0].data);J[5]=[];for(var se=0,ae=0;ae<=a.e.r;++ae){var ne=Fr(te);se+=lZ(ne,i[ae],l),ne[1][0].data=qr(ae),J[5].push({data:$n(ne),type:2})}J[1]=[{type:0,data:qr(a.e.c+1)}],J[2]=[{type:0,data:qr(a.e.r+1)}],J[3]=[{type:0,data:qr(se)}],J[4]=[{type:0,data:qr(a.e.r+1)}]}G.messages[0].data=$n(J);var ue=bh(B),oe=yh(ue);k.content=oe,k.size=k.content.length})()}Q.data=$n(L)}R[3][0].data=$n(z)}y[4][0].data=$n(R)}p.messages[0].data=$n(y);var P=bh(m),C=yh(P);return h.content=C,h.size=h.content.length,u}function eF(t){return function(r){for(var a=0;a!=t.length;++a){var n=t[a];r[n[0]]===void 0&&(r[n[0]]=n[1]),n[2]==="n"&&(r[n[0]]=Number(r[n[0]]))}}}function MN(t){eF([["cellNF",!1],["cellHTML",!0],["cellFormula",!0],["cellStyles",!1],["cellText",!0],["cellDates",!1],["sheetStubs",!1],["sheetRows",0,"n"],["bookDeps",!1],["bookSheets",!1],["bookProps",!1],["bookFiles",!1],["bookVBA",!1],["password",""],["WTF",!1]])(t)}function QN(t){eF([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(t)}function cZ(t){return fr.WS.indexOf(t)>-1?"sheet":t==fr.CS?"chart":t==fr.DS?"dialog":t==fr.MS?"macro":t&&t.length?t:"sheet"}function dZ(t,s){if(!t)return 0;try{t=s.map(function(a){return a.id||(a.id=a.strRelID),[a.name,t["!id"][a.id].Target,cZ(t["!id"][a.id].Type)]})}catch{return null}return!t||t.length===0?null:t}function uZ(t,s,r,a,n,i,l,o,d,u,c,h){try{i[a]=hf(Cl(t,r,!0),s);var m=an(t,s),p;switch(o){case"sheet":p=IX(m,s,n,d,i[a],u,c,h);break;case"chart":if(p=LX(m,s,n,d,i[a],u,c,h),!p||!p["!drawel"])break;var g=JA(p["!drawel"].Target,s),x=Pf(g),b=bG(Cl(t,g,!0),hf(Cl(t,x,!0),g)),y=JA(b,g),j=Pf(y);p=lX(Cl(t,y,!0),y,d,hf(Cl(t,j,!0),y),u,p);break;case"macro":p=DX(m,s,n,d,i[a],u,c,h);break;case"dialog":p=PX(m,s,n,d,i[a],u,c,h);break;default:throw new Error("Unrecognized sheet type "+o)}l[a]=p;var N=[];i&&i[a]&&Da(i[a]).forEach(function(_){var F="";if(i[a][_].Type==fr.CMNT){F=JA(i[a][_].Target,s);var I=MX(an(t,F,!0),F,d);if(!I||!I.length)return;HS(p,I,!1)}i[a][_].Type==fr.TCMNT&&(F=JA(i[a][_].Target,s),N=N.concat(jG(an(t,F,!0),d)))}),N&&N.length&&HS(p,N,!0,d.people||[])}catch(_){if(d.WTF)throw _}}function Kl(t){return t.charAt(0)=="/"?t.slice(1):t}function mZ(t,s){if(iA(),s=s||{},MN(s),Zl(t,"META-INF/manifest.xml")||Zl(t,"objectdata.xml"))return ZS(t,s);if(Zl(t,"Index/Document.iwa")){if(typeof Uint8Array>"u")throw new Error("NUMBERS file parsing requires Uint8Array support");if(typeof qb<"u"){if(t.FileIndex)return qb(t);var r=Qs.utils.cfb_new();return cS(t).forEach(function(H){cr(r,H,N9(t,H))}),qb(r)}throw new Error("Unsupported NUMBERS file")}if(!Zl(t,"[Content_Types].xml"))throw Zl(t,"index.xml.gz")?new Error("Unsupported NUMBERS 08 file"):Zl(t,"index.xml")?new Error("Unsupported NUMBERS 09 file"):new Error("Unsupported ZIP file");var a=cS(t),n=pq(Cl(t,"[Content_Types].xml")),i=!1,l,o;if(n.workbooks.length===0&&(o="xl/workbook.xml",an(t,o,!0)&&n.workbooks.push(o)),n.workbooks.length===0){if(o="xl/workbook.bin",!an(t,o,!0))throw new Error("Could not find workbook");n.workbooks.push(o),i=!0}n.workbooks[0].slice(-3)=="bin"&&(i=!0);var d={},u={};if(!s.bookSheets&&!s.bookProps){if(Af=[],n.sst)try{Af=OX(an(t,Kl(n.sst)),n.sst,s)}catch(H){if(s.WTF)throw H}s.cellStyles&&n.themes.length&&(d=RX(Cl(t,n.themes[0].replace(/^\//,""),!0)||"",n.themes[0],s)),n.style&&(u=UX(an(t,Kl(n.style)),n.style,d,s))}n.links.map(function(H){try{var M=hf(Cl(t,Pf(Kl(H))),H);return HX(an(t,Kl(H)),M,H,s)}catch{}});var c=TX(an(t,Kl(n.workbooks[0])),n.workbooks[0],s),h={},m="";n.coreprops.length&&(m=an(t,Kl(n.coreprops[0]),!0),m&&(h=HE(m)),n.extprops.length!==0&&(m=an(t,Kl(n.extprops[0]),!0),m&&Nq(m,h,s)));var p={};(!s.bookSheets||s.bookProps)&&n.custprops.length!==0&&(m=Cl(t,Kl(n.custprops[0]),!0),m&&(p=_q(m,s)));var g={};if((s.bookSheets||s.bookProps)&&(c.Sheets?l=c.Sheets.map(function(M){return M.name}):h.Worksheets&&h.SheetNames.length>0&&(l=h.SheetNames),s.bookProps&&(g.Props=h,g.Custprops=p),s.bookSheets&&typeof l<"u"&&(g.SheetNames=l),s.bookSheets?g.SheetNames:s.bookProps))return g;l={};var x={};s.bookDeps&&n.calcchain&&(x=QX(an(t,Kl(n.calcchain)),n.calcchain));var b=0,y={},j,N;{var _=c.Sheets;h.Worksheets=_.length,h.SheetNames=[];for(var F=0;F!=_.length;++F)h.SheetNames[F]=_[F].name}var I=i?"bin":"xml",w=n.workbooks[0].lastIndexOf("/"),E=(n.workbooks[0].slice(0,w+1)+"_rels/"+n.workbooks[0].slice(w+1)+".rels").replace(/^\//,"");Zl(t,E)||(E="xl/_rels/workbook."+I+".rels");var W=hf(Cl(t,E,!0),E.replace(/_rels.*/,"s5s"));(n.metadata||[]).length>=1&&(s.xlmeta=qX(an(t,Kl(n.metadata[0])),n.metadata[0],s)),(n.people||[]).length>=1&&(s.people=wG(an(t,Kl(n.people[0])),s)),W&&(W=dZ(W,c.Sheets));var R=an(t,"xl/worksheets/sheet.xml",!0)?1:0;e:for(b=0;b!=h.Worksheets;++b){var U="sheet";if(W&&W[b]?(j="xl/"+W[b][1].replace(/[\/]?xl\//,""),Zl(t,j)||(j=W[b][1]),Zl(t,j)||(j=E.replace(/_rels\/.*$/,"")+W[b][1]),U=W[b][2]):(j="xl/worksheets/sheet"+(b+1-R)+"."+I,j=j.replace(/sheet0\./,"sheet.")),N=j.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels"),s&&s.sheets!=null)switch(typeof s.sheets){case"number":if(b!=s.sheets)continue e;break;case"string":if(h.SheetNames[b].toLowerCase()!=s.sheets.toLowerCase())continue e;break;default:if(Array.isArray&&Array.isArray(s.sheets)){for(var T=!1,Y=0;Y!=s.sheets.length;++Y)typeof s.sheets[Y]=="number"&&s.sheets[Y]==b&&(T=1),typeof s.sheets[Y]=="string"&&s.sheets[Y].toLowerCase()==h.SheetNames[b].toLowerCase()&&(T=1);if(!T)continue e}}uZ(t,j,N,h.SheetNames[b],b,y,l,U,s,c,d,u)}return g={Directory:n,Workbook:c,Props:h,Custprops:p,Deps:x,Sheets:l,SheetNames:h.SheetNames,Strings:Af,Styles:u,Themes:d,SSF:ha(Vs)},s&&s.bookFiles&&(t.files?(g.keys=a,g.files=t.files):(g.keys=[],g.files={},t.FullPaths.forEach(function(H,M){H=H.replace(/^Root Entry[\/]/,""),g.keys.push(H),g.files[H]=t.FileIndex[M]}))),s&&s.bookVBA&&(n.vba.length>0?g.vbaraw=an(t,Kl(n.vba[0]),!0):n.defaults&&n.defaults.bin===TG&&(g.vbaraw=an(t,"xl/vbaProject.bin",!0))),g}function hZ(t,s){var r=s||{},a="Workbook",n=Qs.find(t,a);try{if(a="/!DataSpaces/Version",n=Qs.find(t,a),!n||!n.content)throw new Error("ECMA-376 Encrypted file missing "+a);if(qV(n.content),a="/!DataSpaces/DataSpaceMap",n=Qs.find(t,a),!n||!n.content)throw new Error("ECMA-376 Encrypted file missing "+a);var i=VV(n.content);if(i.length!==1||i[0].comps.length!==1||i[0].comps[0].t!==0||i[0].name!=="StrongEncryptionDataSpace"||i[0].comps[0].v!=="EncryptedPackage")throw new Error("ECMA-376 Encrypted file bad "+a);if(a="/!DataSpaces/DataSpaceInfo/StrongEncryptionDataSpace",n=Qs.find(t,a),!n||!n.content)throw new Error("ECMA-376 Encrypted file missing "+a);var l=WV(n.content);if(l.length!=1||l[0]!="StrongEncryptionTransform")throw new Error("ECMA-376 Encrypted file bad "+a);if(a="/!DataSpaces/TransformInfo/StrongEncryptionTransform/!Primary",n=Qs.find(t,a),!n||!n.content)throw new Error("ECMA-376 Encrypted file missing "+a);KV(n.content)}catch{}if(a="/EncryptionInfo",n=Qs.find(t,a),!n||!n.content)throw new Error("ECMA-376 Encrypted file missing "+a);var o=zV(n.content);if(a="/EncryptedPackage",n=Qs.find(t,a),!n||!n.content)throw new Error("ECMA-376 Encrypted file missing "+a);if(o[0]==4&&typeof decrypt_agile<"u")return decrypt_agile(o[1],n.content,r.password||"",r);if(o[0]==2&&typeof decrypt_std76<"u")return decrypt_std76(o[1],n.content,r.password||"",r);throw new Error("File is password-protected")}function AZ(t,s){return s.bookType=="ods"?ZB(t,s):s.bookType=="numbers"?oZ(t,s):s.bookType=="xlsb"?fZ(t,s):pZ(t,s)}function fZ(t,s){Th=1024,t&&!t.SSF&&(t.SSF=ha(Vs)),t&&t.SSF&&(iA(),Bg(t.SSF),s.revssf=Tg(t.SSF),s.revssf[t.SSF[65535]]=0,s.ssf=t.SSF),s.rels={},s.wbrels={},s.Strings=[],s.Strings.Count=0,s.Strings.Unique=0,ff?s.revStrings=new Map:(s.revStrings={},s.revStrings.foo=[],delete s.revStrings.foo);var r=s.bookType=="xlsb"?"bin":"xml",a=CB.indexOf(s.bookType)>-1,n=SN();QN(s=s||{});var i=mN(),l="",o=0;if(s.cellXfs=[],Du(s.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={}),l="docProps/core.xml",cr(i,l,qE(t.Props,s)),n.coreprops.push(l),Vr(s.rels,2,l,fr.CORE_PROPS),l="docProps/app.xml",!(t.Props&&t.Props.SheetNames))if(!t.Workbook||!t.Workbook.Sheets)t.Props.SheetNames=t.SheetNames;else{for(var d=[],u=0;u<t.SheetNames.length;++u)(t.Workbook.Sheets[u]||{}).Hidden!=2&&d.push(t.SheetNames[u]);t.Props.SheetNames=d}for(t.Props.Worksheets=t.Props.SheetNames.length,cr(i,l,WE(t.Props)),n.extprops.push(l),Vr(s.rels,3,l,fr.EXT_PROPS),t.Custprops!==t.Props&&Da(t.Custprops||{}).length>0&&(l="docProps/custom.xml",cr(i,l,GE(t.Custprops)),n.custprops.push(l),Vr(s.rels,4,l,fr.CUST_PROPS)),o=1;o<=t.SheetNames.length;++o){var c={"!id":{}},h=t.Sheets[t.SheetNames[o-1]],m=(h||{})["!type"]||"sheet";switch(m){case"chart":default:l="xl/worksheets/sheet"+o+"."+r,cr(i,l,VX(o-1,l,s,t,c)),n.sheets.push(l),Vr(s.wbrels,-1,"worksheets/sheet"+o+"."+r,fr.WS[0])}if(h){var p=h["!comments"],g=!1,x="";p&&p.length>0&&(x="xl/comments"+o+"."+r,cr(i,x,KX(p,x)),n.comments.push(x),Vr(c,-1,"../comments"+o+"."+r,fr.CMNT),g=!0),h["!legacy"]&&g&&cr(i,"xl/drawings/vmlDrawing"+o+".vml",_B(o,h["!comments"])),delete h["!comments"],delete h["!legacy"]}c["!id"].rId1&&cr(i,Pf(l),Oh(c))}return s.Strings!=null&&s.Strings.length>0&&(l="xl/sharedStrings."+r,cr(i,l,GX(s.Strings,l,s)),n.strs.push(l),Vr(s.wbrels,-1,"sharedStrings."+r,fr.SST)),l="xl/workbook."+r,cr(i,l,$X(t,l)),n.workbooks.push(l),Vr(s.rels,1,l,fr.WB),l="xl/theme/theme1.xml",cr(i,l,TN(t.Themes,s)),n.themes.push(l),Vr(s.wbrels,-1,"theme/theme1.xml",fr.THEME),l="xl/styles."+r,cr(i,l,WX(t,l,s)),n.styles.push(l),Vr(s.wbrels,-1,"styles."+r,fr.STY),t.vbaraw&&a&&(l="xl/vbaProject.bin",cr(i,l,t.vbaraw),n.vba.push(l),Vr(s.wbrels,-1,"vbaProject.bin",fr.VBA)),l="xl/metadata."+r,cr(i,l,zX(l)),n.metadata.push(l),Vr(s.wbrels,-1,"metadata."+r,fr.XLMETA),cr(i,"[Content_Types].xml",ME(n,s)),cr(i,"_rels/.rels",Oh(s.rels)),cr(i,"xl/_rels/workbook."+r+".rels",Oh(s.wbrels)),delete s.revssf,delete s.ssf,i}function pZ(t,s){Th=1024,t&&!t.SSF&&(t.SSF=ha(Vs)),t&&t.SSF&&(iA(),Bg(t.SSF),s.revssf=Tg(t.SSF),s.revssf[t.SSF[65535]]=0,s.ssf=t.SSF),s.rels={},s.wbrels={},s.Strings=[],s.Strings.Count=0,s.Strings.Unique=0,ff?s.revStrings=new Map:(s.revStrings={},s.revStrings.foo=[],delete s.revStrings.foo);var r="xml",a=CB.indexOf(s.bookType)>-1,n=SN();QN(s=s||{});var i=mN(),l="",o=0;if(s.cellXfs=[],Du(s.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={}),l="docProps/core.xml",cr(i,l,qE(t.Props,s)),n.coreprops.push(l),Vr(s.rels,2,l,fr.CORE_PROPS),l="docProps/app.xml",!(t.Props&&t.Props.SheetNames))if(!t.Workbook||!t.Workbook.Sheets)t.Props.SheetNames=t.SheetNames;else{for(var d=[],u=0;u<t.SheetNames.length;++u)(t.Workbook.Sheets[u]||{}).Hidden!=2&&d.push(t.SheetNames[u]);t.Props.SheetNames=d}t.Props.Worksheets=t.Props.SheetNames.length,cr(i,l,WE(t.Props)),n.extprops.push(l),Vr(s.rels,3,l,fr.EXT_PROPS),t.Custprops!==t.Props&&Da(t.Custprops||{}).length>0&&(l="docProps/custom.xml",cr(i,l,GE(t.Custprops)),n.custprops.push(l),Vr(s.rels,4,l,fr.CUST_PROPS));var c=["SheetJ5"];for(s.tcid=0,o=1;o<=t.SheetNames.length;++o){var h={"!id":{}},m=t.Sheets[t.SheetNames[o-1]],p=(m||{})["!type"]||"sheet";switch(p){case"chart":default:l="xl/worksheets/sheet"+o+"."+r,cr(i,l,RB(o-1,s,t,h)),n.sheets.push(l),Vr(s.wbrels,-1,"worksheets/sheet"+o+"."+r,fr.WS[0])}if(m){var g=m["!comments"],x=!1,b="";if(g&&g.length>0){var y=!1;g.forEach(function(j){j[1].forEach(function(N){N.T==!0&&(y=!0)})}),y&&(b="xl/threadedComments/threadedComment"+o+"."+r,cr(i,b,NG(g,c,s)),n.threadedcomments.push(b),Vr(h,-1,"../threadedComments/threadedComment"+o+"."+r,fr.TCMNT)),b="xl/comments"+o+"."+r,cr(i,b,SB(g)),n.comments.push(b),Vr(h,-1,"../comments"+o+"."+r,fr.CMNT),x=!0}m["!legacy"]&&x&&cr(i,"xl/drawings/vmlDrawing"+o+".vml",_B(o,m["!comments"])),delete m["!comments"],delete m["!legacy"]}h["!id"].rId1&&cr(i,Pf(l),Oh(h))}return s.Strings!=null&&s.Strings.length>0&&(l="xl/sharedStrings."+r,cr(i,l,hB(s.Strings,s)),n.strs.push(l),Vr(s.wbrels,-1,"sharedStrings."+r,fr.SST)),l="xl/workbook."+r,cr(i,l,qB(t)),n.workbooks.push(l),Vr(s.rels,1,l,fr.WB),l="xl/theme/theme1.xml",cr(i,l,TN(t.Themes,s)),n.themes.push(l),Vr(s.wbrels,-1,"theme/theme1.xml",fr.THEME),l="xl/styles."+r,cr(i,l,yB(t,s)),n.styles.push(l),Vr(s.wbrels,-1,"styles."+r,fr.STY),t.vbaraw&&a&&(l="xl/vbaProject.bin",cr(i,l,t.vbaraw),n.vba.push(l),Vr(s.wbrels,-1,"vbaProject.bin",fr.VBA)),l="xl/metadata."+r,cr(i,l,wB()),n.metadata.push(l),Vr(s.wbrels,-1,"metadata."+r,fr.XLMETA),c.length>1&&(l="xl/persons/person.xml",cr(i,l,_G(c)),n.people.push(l),Vr(s.wbrels,-1,"persons/person.xml",fr.PEOPLE)),cr(i,"[Content_Types].xml",ME(n,s)),cr(i,"_rels/.rels",Oh(s.rels)),cr(i,"xl/_rels/workbook."+r+".rels",Oh(s.wbrels)),delete s.revssf,delete s.ssf,i}function HN(t,s){var r="";switch((s||{}).type||"base64"){case"buffer":return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]];case"base64":r=Tl(t.slice(0,12));break;case"binary":r=t;break;case"array":return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]];default:throw new Error("Unrecognized type "+(s&&s.type||"undefined"))}return[r.charCodeAt(0),r.charCodeAt(1),r.charCodeAt(2),r.charCodeAt(3),r.charCodeAt(4),r.charCodeAt(5),r.charCodeAt(6),r.charCodeAt(7)]}function xZ(t,s){return Qs.find(t,"EncryptedPackage")?hZ(t,s):GB(t,s)}function gZ(t,s){var r,a=t,n=s||{};return n.type||(n.type=ur&&Buffer.isBuffer(t)?"buffer":"base64"),r=fE(a,n),mZ(r,n)}function tF(t,s){var r=0;e:for(;r<t.length;)switch(t.charCodeAt(r)){case 10:case 13:case 32:++r;break;case 60:return gj(t.slice(r),s);default:break e}return Kh.to_workbook(t,s)}function vZ(t,s){var r="",a=HN(t,s);switch(s.type){case"base64":r=Tl(t);break;case"binary":r=t;break;case"buffer":r=t.toString("binary");break;case"array":r=Em(t);break;default:throw new Error("Unrecognized type "+s.type)}return a[0]==239&&a[1]==187&&a[2]==191&&(r=Xr(r)),s.type="binary",tF(r,s)}function bZ(t,s){var r=t;return s.type=="base64"&&(r=Tl(r)),r=Bf.utils.decode(1200,r.slice(2),"str"),s.type="binary",tF(r,s)}function yZ(t){return t.match(/[^\x00-\x7F]/)?Nc(t):t}function $b(t,s,r,a){return a?(r.type="string",Kh.to_workbook(t,r)):Kh.to_workbook(s,r)}function qf(t,s){lN();var r=s||{};if(typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer)return qf(new Uint8Array(t),(r=ha(r),r.type="array",r));typeof Uint8Array<"u"&&t instanceof Uint8Array&&!r.type&&(r.type=typeof Deno<"u"?"buffer":"array");var a=t,n=[0,0,0,0],i=!1;if(r.cellStyles&&(r.cellNF=!0,r.sheetStubs=!0),Qh={},r.dateNF&&(Qh.dateNF=r.dateNF),r.type||(r.type=ur&&Buffer.isBuffer(t)?"buffer":"base64"),r.type=="file"&&(r.type=ur?"buffer":"binary",a=f9(t),typeof Uint8Array<"u"&&!ur&&(r.type="array")),r.type=="string"&&(i=!0,r.type="binary",r.codepage=65001,a=yZ(t)),r.type=="array"&&typeof Uint8Array<"u"&&t instanceof Uint8Array&&typeof ArrayBuffer<"u"){var l=new ArrayBuffer(3),o=new Uint8Array(l);if(o.foo="bar",!o.foo)return r=ha(r),r.type="array",qf(oN(a),r)}switch((n=HN(a,r))[0]){case 208:if(n[1]===207&&n[2]===17&&n[3]===224&&n[4]===161&&n[5]===177&&n[6]===26&&n[7]===225)return xZ(Qs.read(a,r),r);break;case 9:if(n[1]<=8)return GB(a,r);break;case 60:return gj(a,r);case 73:if(n[1]===73&&n[2]===42&&n[3]===0)throw new Error("TIFF Image File is not a spreadsheet");if(n[1]===68)return SV(a,r);break;case 84:if(n[1]===65&&n[2]===66&&n[3]===76)return uB.to_workbook(a,r);break;case 80:return n[1]===75&&n[2]<9&&n[3]<9?gZ(a,r):$b(t,a,r,i);case 239:return n[3]===60?gj(a,r):$b(t,a,r,i);case 255:if(n[1]===254)return bZ(a,r);if(n[1]===0&&n[2]===2&&n[3]===0)return wm.to_workbook(a,r);break;case 0:if(n[1]===0&&(n[2]>=2&&n[3]===0||n[2]===0&&(n[3]===8||n[3]===9)))return wm.to_workbook(a,r);break;case 3:case 131:case 139:case 140:return xj.to_workbook(a,r);case 123:if(n[1]===92&&n[2]===114&&n[3]===116)return gB.to_workbook(a,r);break;case 10:case 13:case 32:return vZ(a,r);case 137:if(n[1]===80&&n[2]===78&&n[3]===71)throw new Error("PNG Image File is not a spreadsheet");break}return _V.indexOf(n[0])>-1&&n[2]<=12&&n[3]<=31?xj.to_workbook(a,r):$b(t,a,r,i)}function sF(t,s){switch(s.type){case"base64":case"binary":break;case"buffer":case"array":s.type="";break;case"file":return rp(s.file,Qs.write(t,{type:ur?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+s.bookType+"' files");default:throw new Error("Unrecognized type "+s.type)}return Qs.write(t,s)}function jZ(t,s){var r=ha(s||{}),a=AZ(t,r);return NZ(a,r)}function NZ(t,s){var r={},a=ur?"nodebuffer":typeof Uint8Array<"u"?"array":"string";if(s.compression&&(r.compression="DEFLATE"),s.password)r.type=a;else switch(s.type){case"base64":r.type="base64";break;case"binary":r.type="string";break;case"string":throw new Error("'string' output type invalid for '"+s.bookType+"' files");case"buffer":case"file":r.type=a;break;default:throw new Error("Unrecognized type "+s.type)}var n=t.FullPaths?Qs.write(t,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[r.type]||r.type,compression:!!s.compression}):t.generate(r);if(typeof Deno<"u"&&typeof n=="string"){if(s.type=="binary"||s.type=="base64")return n;n=new Uint8Array(Eg(n))}return s.password&&typeof encrypt_agile<"u"?sF(encrypt_agile(n,s.password),s):s.type==="file"?rp(s.file,n):s.type=="string"?Xr(n):n}function wZ(t,s){var r=s||{},a=yJ(t,r);return sF(a,r)}function yc(t,s,r){r||(r="");var a=r+t;switch(s.type){case"base64":return Ff(Nc(a));case"binary":return Nc(a);case"string":return t;case"file":return rp(s.file,a,"utf8");case"buffer":return ur?Nd(a,"utf8"):typeof TextEncoder<"u"?new TextEncoder().encode(a):yc(a,{type:"binary"}).split("").map(function(n){return n.charCodeAt(0)})}throw new Error("Unrecognized type "+s.type)}function _Z(t,s){switch(s.type){case"base64":return Ff(t);case"binary":return t;case"string":return t;case"file":return rp(s.file,t,"binary");case"buffer":return ur?Nd(t,"binary"):t.split("").map(function(r){return r.charCodeAt(0)})}throw new Error("Unrecognized type "+s.type)}function Rx(t,s){switch(s.type){case"string":case"base64":case"binary":for(var r="",a=0;a<t.length;++a)r+=String.fromCharCode(t[a]);return s.type=="base64"?Ff(r):s.type=="string"?Xr(r):r;case"file":return rp(s.file,t);case"buffer":return t;default:throw new Error("Unrecognized type "+s.type)}}function rF(t,s){lN(),xX(t);var r=ha(s||{});if(r.cellStyles&&(r.cellNF=!0,r.sheetStubs=!0),r.type=="array"){r.type="binary";var a=rF(t,r);return r.type="array",Eg(a)}var n=0;if(r.sheet&&(typeof r.sheet=="number"?n=r.sheet:n=t.SheetNames.indexOf(r.sheet),!t.SheetNames[n]))throw new Error("Sheet not found: "+r.sheet+" : "+typeof r.sheet);switch(r.bookType||"xlsb"){case"xml":case"xlml":return yc(AJ(t,r),r);case"slk":case"sylk":return yc(dB.from_sheet(t.Sheets[t.SheetNames[n]],r),r);case"htm":case"html":return yc(zB(t.Sheets[t.SheetNames[n]],r),r);case"txt":return _Z(aF(t.Sheets[t.SheetNames[n]],r),r);case"csv":return yc(qN(t.Sheets[t.SheetNames[n]],r),r,"\uFEFF");case"dif":return yc(uB.from_sheet(t.Sheets[t.SheetNames[n]],r),r);case"dbf":return Rx(xj.from_sheet(t.Sheets[t.SheetNames[n]],r),r);case"prn":return yc(Kh.from_sheet(t.Sheets[t.SheetNames[n]],r),r);case"rtf":return yc(gB.from_sheet(t.Sheets[t.SheetNames[n]],r),r);case"eth":return yc(mB.from_sheet(t.Sheets[t.SheetNames[n]],r),r);case"fods":return yc(ZB(t,r),r);case"wk1":return Rx(wm.sheet_to_wk1(t.Sheets[t.SheetNames[n]],r),r);case"wk3":return Rx(wm.book_to_wk3(t,r),r);case"biff2":r.biff||(r.biff=2);case"biff3":r.biff||(r.biff=3);case"biff4":return r.biff||(r.biff=4),Rx(KB(t,r),r);case"biff5":r.biff||(r.biff=5);case"biff8":case"xla":case"xls":return r.biff||(r.biff=8),wZ(t,r);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return jZ(t,r);default:throw new Error("Unrecognized bookType |"+r.bookType+"|")}}function SZ(t){if(!t.bookType){var s={xls:"biff8",htm:"html",slk:"sylk",socialcalc:"eth",Sh33tJS:"WTF"},r=t.file.slice(t.file.lastIndexOf(".")).toLowerCase();r.match(/^\.[a-z]+$/)&&(t.bookType=r.slice(1)),t.bookType=s[t.bookType]||t.bookType}}function yr(t,s,r){var a={};return a.type="file",a.file=s,SZ(a),rF(t,a)}function CZ(t,s,r,a,n,i,l,o){var d=za(r),u=o.defval,c=o.raw||!Object.prototype.hasOwnProperty.call(o,"raw"),h=!0,m=n===1?[]:{};if(n!==1)if(Object.defineProperty)try{Object.defineProperty(m,"__rowNum__",{value:r,enumerable:!1})}catch{m.__rowNum__=r}else m.__rowNum__=r;if(!l||t[r])for(var p=s.s.c;p<=s.e.c;++p){var g=l?t[r][p]:t[a[p]+d];if(g===void 0||g.t===void 0){if(u===void 0)continue;i[p]!=null&&(m[i[p]]=u);continue}var x=g.v;switch(g.t){case"z":if(x==null)break;continue;case"e":x=x==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+g.t)}if(i[p]!=null){if(x==null)if(g.t=="e"&&x===null)m[i[p]]=null;else if(u!==void 0)m[i[p]]=u;else if(c&&x===null)m[i[p]]=null;else continue;else m[i[p]]=c&&(g.t!=="n"||g.t==="n"&&o.rawNumbers!==!1)?x:bd(g,x,o);x!=null&&(h=!1)}}return{row:m,isempty:h}}function G0(t,s){if(t==null||t["!ref"]==null)return[];var r={t:"n",v:0},a=0,n=1,i=[],l=0,o="",d={s:{r:0,c:0},e:{r:0,c:0}},u=s||{},c=u.range!=null?u.range:t["!ref"];switch(u.header===1?a=1:u.header==="A"?a=2:Array.isArray(u.header)?a=3:u.header==null&&(a=0),typeof c){case"string":d=Cr(c);break;case"number":d=Cr(t["!ref"]),d.s.r=c;break;default:d=c}a>0&&(n=0);var h=za(d.s.r),m=[],p=[],g=0,x=0,b=Array.isArray(t),y=d.s.r,j=0,N={};b&&!t[y]&&(t[y]=[]);var _=u.skipHidden&&t["!cols"]||[],F=u.skipHidden&&t["!rows"]||[];for(j=d.s.c;j<=d.e.c;++j)if(!(_[j]||{}).hidden)switch(m[j]=Na(j),r=b?t[y][j]:t[m[j]+h],a){case 1:i[j]=j-d.s.c;break;case 2:i[j]=m[j];break;case 3:i[j]=u.header[j-d.s.c];break;default:if(r==null&&(r={w:"__EMPTY",t:"s"}),o=l=bd(r,null,u),x=N[l]||0,!x)N[l]=1;else{do o=l+"_"+x++;while(N[o]);N[l]=x,N[o]=1}i[j]=o}for(y=d.s.r+n;y<=d.e.r;++y)if(!(F[y]||{}).hidden){var I=CZ(t,d,y,m,a,i,b,u);(I.isempty===!1||(a===1?u.blankrows!==!1:u.blankrows))&&(p[g++]=I.row)}return p.length=g,p}var aC=/"/g;function kZ(t,s,r,a,n,i,l,o){for(var d=!0,u=[],c="",h=za(r),m=s.s.c;m<=s.e.c;++m)if(a[m]){var p=o.dense?(t[r]||[])[m]:t[a[m]+h];if(p==null)c="";else if(p.v!=null){d=!1,c=""+(o.rawNumbers&&p.t=="n"?p.v:bd(p,null,o));for(var g=0,x=0;g!==c.length;++g)if((x=c.charCodeAt(g))===n||x===i||x===34||o.forceQuotes){c='"'+c.replace(aC,'""')+'"';break}c=="ID"&&(c='"ID"')}else p.f!=null&&!p.F?(d=!1,c="="+p.f,c.indexOf(",")>=0&&(c='"'+c.replace(aC,'""')+'"')):c="";u.push(c)}return o.blankrows===!1&&d?null:u.join(l)}function qN(t,s){var r=[],a=s??{};if(t==null||t["!ref"]==null)return"";var n=Cr(t["!ref"]),i=a.FS!==void 0?a.FS:",",l=i.charCodeAt(0),o=a.RS!==void 0?a.RS:`
`,d=o.charCodeAt(0),u=new RegExp((i=="|"?"\\|":i)+"+$"),c="",h=[];a.dense=Array.isArray(t);for(var m=a.skipHidden&&t["!cols"]||[],p=a.skipHidden&&t["!rows"]||[],g=n.s.c;g<=n.e.c;++g)(m[g]||{}).hidden||(h[g]=Na(g));for(var x=0,b=n.s.r;b<=n.e.r;++b)(p[b]||{}).hidden||(c=kZ(t,n,b,h,l,d,i,a),c!=null&&(a.strip&&(c=c.replace(u,"")),(c||a.blankrows!==!1)&&r.push((x++?o:"")+c)));return delete a.dense,r.join("")}function aF(t,s){s||(s={}),s.FS="	",s.RS=`
`;var r=qN(t,s);return r}function EZ(t){var s="",r,a="";if(t==null||t["!ref"]==null)return[];var n=Cr(t["!ref"]),i="",l=[],o,d=[],u=Array.isArray(t);for(o=n.s.c;o<=n.e.c;++o)l[o]=Na(o);for(var c=n.s.r;c<=n.e.r;++c)for(i=za(c),o=n.s.c;o<=n.e.c;++o)if(s=l[o]+i,r=u?(t[c]||[])[o]:t[s],a="",r!==void 0){if(r.F!=null){if(s=r.F,!r.f)continue;a=r.f,s.indexOf(":")==-1&&(s=s+":"+s)}if(r.f!=null)a=r.f;else{if(r.t=="z")continue;if(r.t=="n"&&r.v!=null)a=""+r.v;else if(r.t=="b")a=r.v?"TRUE":"FALSE";else if(r.w!==void 0)a="'"+r.w;else{if(r.v===void 0)continue;r.t=="s"?a="'"+r.v:a=""+r.v}}d[d.length]=s+"="+a}return d}function nF(t,s,r){var a=r||{},n=+!a.skipHeader,i=t||{},l=0,o=0;if(i&&a.origin!=null)if(typeof a.origin=="number")l=a.origin;else{var d=typeof a.origin=="string"?wa(a.origin):a.origin;l=d.r,o=d.c}var u,c={s:{c:0,r:0},e:{c:o,r:l+s.length-1+n}};if(i["!ref"]){var h=Cr(i["!ref"]);c.e.c=Math.max(c.e.c,h.e.c),c.e.r=Math.max(c.e.r,h.e.r),l==-1&&(l=h.e.r+1,c.e.r=l+s.length-1+n)}else l==-1&&(l=0,c.e.r=s.length-1+n);var m=a.header||[],p=0;s.forEach(function(x,b){Da(x).forEach(function(y){(p=m.indexOf(y))==-1&&(m[p=m.length]=y);var j=x[y],N="z",_="",F=Ks({c:o+p,r:l+b+n});u=$f(i,F),j&&typeof j=="object"&&!(j instanceof Date)?i[F]=j:(typeof j=="number"?N="n":typeof j=="boolean"?N="b":typeof j=="string"?N="s":j instanceof Date?(N="d",a.cellDates||(N="n",j=pn(j)),_=a.dateNF||Vs[14]):j===null&&a.nullError&&(N="e",j=0),u?(u.t=N,u.v=j,delete u.w,delete u.R,_&&(u.z=_)):i[F]=u={t:N,v:j},_&&(u.z=_))})}),c.e.c=Math.max(c.e.c,o+m.length-1);var g=za(l);if(n)for(p=0;p<m.length;++p)i[Na(p+o)+g]={t:"s",v:m[p]};return i["!ref"]=lr(c),i}function BZ(t,s){return nF(null,t,s)}function $f(t,s,r){if(typeof s=="string"){if(Array.isArray(t)){var a=wa(s);return t[a.r]||(t[a.r]=[]),t[a.r][a.c]||(t[a.r][a.c]={t:"z"})}return t[s]||(t[s]={t:"z"})}return typeof s!="number"?$f(t,Ks(s)):$f(t,Ks({r:s,c:r||0}))}function FZ(t,s){if(typeof s=="number"){if(s>=0&&t.SheetNames.length>s)return s;throw new Error("Cannot find sheet # "+s)}else if(typeof s=="string"){var r=t.SheetNames.indexOf(s);if(r>-1)return r;throw new Error("Cannot find sheet name |"+s+"|")}else throw new Error("Cannot find sheet |"+s+"|")}function $N(){return{SheetNames:[],Sheets:{}}}function VN(t,s,r,a){var n=1;if(!r)for(;n<=65535&&t.SheetNames.indexOf(r="Sheet"+n)!=-1;++n,r=void 0);if(!r||t.SheetNames.length>=65535)throw new Error("Too many worksheets");if(a&&t.SheetNames.indexOf(r)>=0){var i=r.match(/(^.*?)(\d+)$/);n=i&&+i[2]||0;var l=i&&i[1]||r;for(++n;n<=65535&&t.SheetNames.indexOf(r=l+n)!=-1;++n);}if(HB(r),t.SheetNames.indexOf(r)>=0)throw new Error("Worksheet with name |"+r+"| already exists!");return t.SheetNames.push(r),t.Sheets[r]=s,r}function TZ(t,s,r){t.Workbook||(t.Workbook={}),t.Workbook.Sheets||(t.Workbook.Sheets=[]);var a=FZ(t,s);switch(t.Workbook.Sheets[a]||(t.Workbook.Sheets[a]={}),r){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+r)}t.Workbook.Sheets[a].Hidden=r}function IZ(t,s){return t.z=s,t}function iF(t,s,r){return s?(t.l={Target:s},r&&(t.l.Tooltip=r)):delete t.l,t}function LZ(t,s,r){return iF(t,"#"+s,r)}function DZ(t,s,r){t.c||(t.c=[]),t.c.push({t:s,a:r||"SheetJS"})}function PZ(t,s,r,a){for(var n=typeof s!="string"?s:Cr(s),i=typeof s=="string"?s:lr(s),l=n.s.r;l<=n.e.r;++l)for(var o=n.s.c;o<=n.e.c;++o){var d=$f(t,l,o);d.t="n",d.F=i,delete d.v,l==n.s.r&&o==n.s.c&&(d.f=r,a&&(d.D=!0))}return t}var is={encode_col:Na,encode_row:za,encode_cell:Ks,encode_range:lr,decode_col:bN,decode_row:vN,split_cell:G9,decode_cell:wa,decode_range:ml,format_cell:bd,sheet_add_aoa:IE,sheet_add_json:nF,sheet_add_dom:YB,aoa_to_sheet:lA,json_to_sheet:BZ,table_to_sheet:XB,table_to_book:qJ,sheet_to_csv:qN,sheet_to_txt:aF,sheet_to_json:G0,sheet_to_html:zB,sheet_to_formulae:EZ,sheet_to_row_object_array:G0,sheet_get_cell:$f,book_new:$N,book_append_sheet:VN,book_set_sheet_visibility:TZ,cell_set_number_format:IZ,cell_set_hyperlink:iF,cell_set_internal_link:LZ,cell_add_comment:DZ,sheet_set_array_formula:PZ,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};function UZ(){const[t,s]=f.useState("standard"),[r,a]=f.useState(!1),[n,i]=f.useState([]),[l,o]=f.useState([]),[d,u]=f.useState([]),[c,h]=f.useState([]),[m,p]=f.useState([]),[g,x]=f.useState(!1),[b,y]=f.useState(""),[j,N]=f.useState(null),_=Is.useRef(null),[F,I]=f.useState({product:"",customer:"",category:""}),[w,E]=f.useState({});f.useEffect(()=>{W()},[]),f.useEffect(()=>{R()},[t,F]);const W=async()=>{try{console.log("Loading initial data...");const[P,C,k,B]=await Promise.all([Z.get("/inventory/items"),Z.get("/sales/customers"),Z.get("/sales/price-types"),Z.get("/finance/currencies")]);console.log("Products loaded:",P.data),console.log("Customers loaded:",C.data),console.log("Price Types loaded:",k.data),console.log("Currencies loaded:",B.data),o(P.data.items||[]),u(C.data.items||[]),h(k.data.items||[]),p(B.data.items||[])}catch(P){console.error("Error loading initial data:",P)}},R=async()=>{a(!0);try{let P="",C={};switch(t){case"standard":P="/sales/prices/standard";break;case"customer":P="/sales/prices/customer",F.customer&&(C.customer_id=F.customer);break;default:return}console.log(`Fetching tab data from ${P}`,C);const k=await Z.get(P,{params:C});console.log("Tab data response:",k.data);const B=Array.isArray(k.data)?k.data:k.data.items||[];i(B)}catch(P){console.error("Error loading tab data:",P)}finally{a(!1)}},U=()=>{let P=[],C="",k=[];t==="standard"?(P=["Item Code","Cost Price","Selling Price","Margin %","Effective Date (YYYY-MM-DD)","Price Type","UOM","Currency Name"],C="standard_prices_template.xlsx",k=n.map(O=>{const K=l.find(se=>se.id===O.product_id),J=c.find(se=>se.id===O.price_type_id),te=m.find(se=>se.id===O.currency_id);return[K?K.item_code:"",O.cost_price,O.selling_price,O.margin_percent,O.effective_date?O.effective_date.split("T")[0]:"",J?J.name:"",O.uom,te?te.name:""]})):(P=["Customer Name","Item Code","Standard Price","Customer Price","Discount %","Min Quantity","Effective From (YYYY-MM-DD)","Effective To (YYYY-MM-DD)","Price Type","UOM","Currency Name"],C="customer_prices_template.xlsx",k=n.map(O=>{const K=l.find(ae=>ae.id===O.product_id),J=d.find(ae=>ae.id===O.customer_id),te=c.find(ae=>ae.id===O.price_type_id),se=m.find(ae=>ae.id===O.currency_id);return[J?J.customer_name:"",K?K.item_code:"",O.standard_price,O.customer_price,O.discount_percent,O.min_quantity,O.effective_from?O.effective_from.split("T")[0]:"",O.effective_to?O.effective_to.split("T")[0]:"",te?te.name:"",O.uom,se?se.name:""]}));const B=is.aoa_to_sheet([P,...k]),G=is.book_new();is.book_append_sheet(G,B,"Prices"),yr(G,C)},T=()=>{_.current.click()},Y=async P=>{const C=P.target.files[0];if(!C)return;const k=new FileReader;k.onload=async B=>{var G,O;try{const K=new Uint8Array(B.target.result),J=qf(K,{type:"array"}),te=J.SheetNames[0],se=J.Sheets[te],ae=is.sheet_to_json(se);if(ae.length===0){alert("File is empty or invalid format");return}const ne=t==="standard"?"/sales/prices/bulk/standard":"/sales/prices/bulk/customer";await Z.post(ne,{items:ae}),alert("Uploaded successfully"),R()}catch(K){console.error("Upload failed",K),alert("Upload failed: "+(((O=(G=K.response)==null?void 0:G.data)==null?void 0:O.message)||K.message))}},k.readAsArrayBuffer(C),P.target.value=""},H=(P,C=null)=>{y(P),N(C),E(C||{}),x(!0)},M=()=>{x(!1),N(null),E({})},q=async()=>{var P,C;try{let k="";const B={...w};switch(["product_id","customer_id","cost_price","selling_price","margin_percent","standard_price","customer_price","discount_percent","min_quantity","max_quantity","unit_price","price_type_id","currency_id"].forEach(K=>{B[K]!==void 0&&B[K]!==null&&B[K]!==""?B[K]=Number(B[K]):["cost_price","selling_price","customer_price","unit_price"].includes(K)?(B[K]===""||B[K]===void 0)&&(B[K]=0):B[K]===""&&(B[K]=null)}),["effective_date","effective_from","effective_to"].forEach(K=>{B[K]===""&&(B[K]=null)}),b){case"standard":k="/sales/prices/standard";break;case"customer":k="/sales/prices/customer";break;default:return}await Z.post(k,B),M(),R()}catch(k){console.error("Error saving data:",k),alert("Failed to save data: "+(((C=(P=k.response)==null?void 0:P.data)==null?void 0:C.message)||k.message))}},z=()=>e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Cost Price"}),e.jsx("th",{children:"Selling Price"}),e.jsx("th",{children:"Margin %"}),e.jsx("th",{children:"Effective Date"}),e.jsx("th",{children:"Price Type"}),e.jsx("th",{children:"UOM"}),e.jsx("th",{children:"Currency"})]})}),e.jsx("tbody",{children:n.map((P,C)=>{const k=l.find(O=>O.id===P.product_id),B=c.find(O=>O.id===P.price_type_id),G=m.find(O=>O.id===P.currency_id);return e.jsxs("tr",{children:[e.jsx("td",{children:k?`${k.item_name} (${k.item_code})`:P.product_id}),e.jsx("td",{children:Number(P.cost_price).toFixed(2)}),e.jsx("td",{children:Number(P.selling_price).toFixed(2)}),e.jsxs("td",{children:[Number(P.margin_percent).toFixed(2),"%"]}),e.jsx("td",{children:new Date(P.effective_date).toLocaleDateString()}),e.jsx("td",{children:B?B.name:"-"}),e.jsx("td",{children:P.uom||"-"}),e.jsx("td",{children:G?`${G.code} - ${G.name}`:P.currency_id||"-"})]},C)})})]})}),Q=()=>e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Standard Price"}),e.jsx("th",{children:"Customer Price"}),e.jsx("th",{children:"Discount %"}),e.jsx("th",{children:"Min Qty"}),e.jsx("th",{children:"Effective"}),e.jsx("th",{children:"Price Type"}),e.jsx("th",{children:"UOM"}),e.jsx("th",{children:"Currency"})]})}),e.jsx("tbody",{children:n.map((P,C)=>{const k=d.find(K=>K.id===P.customer_id),B=l.find(K=>K.id===P.product_id),G=c.find(K=>K.id===P.price_type_id),O=m.find(K=>K.id===P.currency_id);return e.jsxs("tr",{children:[e.jsx("td",{children:k?k.customer_name:P.customer_id}),e.jsx("td",{children:B?B.item_name:P.product_id}),e.jsx("td",{children:Number(P.standard_price).toFixed(2)}),e.jsx("td",{children:Number(P.customer_price).toFixed(2)}),e.jsxs("td",{children:[Number(P.discount_percent).toFixed(2),"%"]}),e.jsx("td",{children:P.min_quantity}),e.jsx("td",{children:P.effective_from?new Date(P.effective_from).toLocaleDateString():"-"}),e.jsx("td",{children:G?G.name:"-"}),e.jsx("td",{children:P.uom||"-"}),e.jsx("td",{children:O?`${O.code} - ${O.name}`:P.currency_id||"-"})]},C)})})]})}),L=P=>{const C=l.find(k=>k.id==P);E(C?k=>({...k,product_id:P,uom:C.uom,cost_price:C.cost_price,currency_id:C.currency_id,price_type_id:C.price_type_id}):k=>({...k,product_id:P}))},V=()=>{if(b==="standard")return e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"required",children:"Product"}),e.jsxs("select",{value:w.product_id||"",onChange:P=>L(P.target.value),children:[e.jsx("option",{value:"",children:"Select Product"}),l.map(P=>e.jsxs("option",{value:P.id,children:[P.item_name," (",P.item_code,")"]},P.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Price Type"}),e.jsxs("select",{value:w.price_type_id||"",onChange:P=>E({...w,price_type_id:P.target.value}),children:[e.jsx("option",{value:"",children:"Select Price Type"}),c.map(P=>e.jsx("option",{value:P.id,children:P.name},P.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"UOM"}),e.jsx("input",{type:"text",value:w.uom||"",onChange:P=>E({...w,uom:P.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Currency"}),e.jsxs("select",{value:w.currency_id||"",onChange:P=>E({...w,currency_id:P.target.value}),children:[e.jsx("option",{value:"",children:"Select Currency"}),m.map(P=>e.jsxs("option",{value:P.id,children:[P.code," - ",P.name]},P.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"required",children:"Cost Price"}),e.jsx("input",{type:"number",value:w.cost_price||"",onChange:P=>{const C=Number(P.target.value||0),k=Number(w.margin_percent||0),B=Number((C+C*k/100).toFixed(2));E({...w,cost_price:P.target.value,selling_price:B})}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"required",children:"Selling Price"}),e.jsx("input",{type:"number",value:w.selling_price||"",onChange:P=>{const C=Number(P.target.value||0),k=Number(w.cost_price||0),B=k>0?Number((C-k)/k*100):0;E({...w,selling_price:P.target.value,margin_percent:Number(B.toFixed(2))})}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Margin %"}),e.jsx("input",{type:"number",value:w.margin_percent||"",onChange:P=>{const C=Number(P.target.value||0),k=Number(w.cost_price||0),B=Number((k+k*C/100).toFixed(2));E({...w,margin_percent:P.target.value,selling_price:B})}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"required",children:"Effective Date"}),e.jsx("input",{type:"date",value:w.effective_date?w.effective_date.split("T")[0]:"",onChange:P=>E({...w,effective_date:P.target.value})})]})]});if(b==="customer")return e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"required",children:"Customer"}),e.jsxs("select",{value:w.customer_id||"",onChange:P=>E({...w,customer_id:P.target.value}),children:[e.jsx("option",{value:"",children:"Select Customer"}),d.map(P=>e.jsx("option",{value:P.id,children:P.customer_name},P.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"required",children:"Product"}),e.jsxs("select",{value:w.product_id||"",onChange:P=>L(P.target.value),children:[e.jsx("option",{value:"",children:"Select Product"}),l.map(P=>e.jsxs("option",{value:P.id,children:[P.item_name," (",P.item_code,")"]},P.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Price Type"}),e.jsxs("select",{value:w.price_type_id||"",onChange:P=>E({...w,price_type_id:P.target.value}),children:[e.jsx("option",{value:"",children:"Select Price Type"}),c.map(P=>e.jsx("option",{value:P.id,children:P.name},P.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"UOM"}),e.jsx("input",{type:"text",value:w.uom||"",onChange:P=>E({...w,uom:P.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Currency"}),e.jsxs("select",{value:w.currency_id||"",onChange:P=>E({...w,currency_id:P.target.value}),children:[e.jsx("option",{value:"",children:"Select Currency"}),m.map(P=>e.jsxs("option",{value:P.id,children:[P.code," - ",P.name]},P.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Standard Price"}),e.jsx("input",{type:"number",value:w.standard_price||"",onChange:P=>E({...w,standard_price:P.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"required",children:"Customer Price"}),e.jsx("input",{type:"number",value:w.customer_price||"",onChange:P=>E({...w,customer_price:P.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Discount %"}),e.jsx("input",{type:"number",value:w.discount_percent||"",onChange:P=>E({...w,discount_percent:P.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Min Quantity"}),e.jsx("input",{type:"number",value:w.min_quantity||"",onChange:P=>E({...w,min_quantity:P.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Effective From"}),e.jsx("input",{type:"date",value:w.effective_from?w.effective_from.split("T")[0]:"",onChange:P=>E({...w,effective_from:P.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Effective To"}),e.jsx("input",{type:"date",value:w.effective_to?w.effective_to.split("T")[0]:"",onChange:P=>E({...w,effective_to:P.target.value})})]})]})};return e.jsxs("div",{className:"price-setup-container",children:[e.jsx("input",{type:"file",ref:_,style:{display:"none"},accept:".csv",onChange:Y}),e.jsxs("div",{className:"price-setup-header",children:[e.jsxs("h1",{children:[e.jsx("span",{children:""}),"Price Setup"]}),e.jsxs("div",{className:"header-actions",children:[e.jsx(Re,{to:"/sales",className:"btn btn-secondary",children:" Return to Menu"}),e.jsx("button",{className:"btn btn-secondary",onClick:U,children:" Download Template"}),e.jsx("button",{className:"btn btn-secondary",onClick:T,children:" Upload Prices"}),e.jsx("button",{className:"btn btn-secondary",onClick:R,children:" Refresh"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>H(t),children:" New Price"})]})]}),e.jsxs("div",{className:"content",children:[e.jsxs("div",{className:"tabs",children:[e.jsx("button",{className:`tab ${t==="standard"?"active":""}`,onClick:()=>s("standard"),children:" Standard Prices"}),e.jsx("button",{className:`tab ${t==="customer"?"active":""}`,onClick:()=>s("customer"),children:" Customer Specific Prices"})]}),t==="standard"&&e.jsxs("div",{className:"tab-content active",children:[e.jsx("div",{className:"filter-section",children:e.jsxs("div",{className:"filter-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Search Product"}),e.jsx("input",{type:"text",placeholder:"Search by code or name"})]}),e.jsx("div",{className:"form-group",children:e.jsx("button",{className:"btn btn-primary",children:" Search"})})]})}),r?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading..."}):n.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:'No standard prices found. Click "New Price" to add one.'}):z()]}),t==="customer"&&e.jsxs("div",{className:"tab-content active",children:[e.jsx("div",{className:"filter-section",children:e.jsx("div",{className:"filter-grid",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Customer"}),e.jsxs("select",{value:F.customer,onChange:P=>I({...F,customer:P.target.value}),children:[e.jsx("option",{value:"",children:"All Customers"}),d.map(P=>e.jsx("option",{value:P.id,children:P.customer_name},P.id))]})]})})}),r?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading..."}):n.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:'No customer prices found. Click "New Price" to add one.'}):Q()]})]}),g&&e.jsx("div",{className:"price-modal-overlay",children:e.jsxs("div",{className:"price-modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[b==="standard"&&" Standard Price Setup",b==="customer"&&" Customer Price Setup"]}),e.jsx("button",{className:"close-btn",onClick:M,children:""})]}),e.jsx("div",{className:"modal-body",children:V()}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:M,children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:q,children:"Save"})]})]})})]})}const Vb={scheme_code:"",scheme_name:"",discount_type:"",discount_value:"",effective_from:"",effective_to:"",min_quantity:"",min_purchase_amount:"",max_discount_amount:"",description:"",status:"ACTIVE",itemIds:[]};function RZ(){const[t,s]=f.useState([]),[r,a]=f.useState([]),[n,i]=f.useState(!0),[l,o]=f.useState(!1),[d,u]=f.useState(null),[c,h]=f.useState(Vb),[m,p]=f.useState(""),[g,x]=f.useState(""),[b,y]=f.useState(""),[j,N]=f.useState("");f.useEffect(()=>{_()},[]);async function _(){var H;try{i(!0);const[M,q]=await Promise.all([Z.get("/sales/discount-schemes"),Z.get("/inventory/items")]);s(Array.isArray((H=M.data)==null?void 0:H.items)?M.data.items:[]),a(q.data.items||[])}catch(M){console.error(M),ct.error("Failed to load data")}finally{i(!1)}}const F=f.useMemo(()=>t.filter(H=>{const M=m?m==="ACTIVE"?H.is_active:!H.is_active:!0,q=g?H.discount_type===g:!0,z=b.toLowerCase(),Q=!b||H.scheme_code.toLowerCase().includes(z)||H.scheme_name.toLowerCase().includes(z)||H.description&&H.description.toLowerCase().includes(z);return M&&q&&Q}),[t,m,g,b]),I=f.useMemo(()=>{const H=t.length,M=t.filter(V=>V.is_active).length,q=t.filter(V=>V.discount_type==="PERCENTAGE"),z=q.length>0?(q.reduce((V,P)=>V+Number(P.discount_value),0)/q.length).toFixed(1):0,Q=new Date,L=t.filter(V=>{const P=new Date(V.effective_from);return P.getMonth()===Q.getMonth()&&P.getFullYear()===Q.getFullYear()}).length;return{total:H,active:M,avgDiscount:z,thisMonth:L}},[t]),w=async(H=null)=>{if(H){u(H);try{const q=(await Z.get(`/sales/discount-schemes/${H}`)).data;h({scheme_code:q.scheme_code,scheme_name:q.scheme_name,discount_type:q.discount_type,discount_value:q.discount_value,effective_from:q.effective_from?q.effective_from.split("T")[0]:"",effective_to:q.effective_to?q.effective_to.split("T")[0]:"",min_quantity:q.min_quantity||"",min_purchase_amount:q.min_purchase_amount||"",max_discount_amount:q.max_discount_amount||"",description:q.description||"",status:q.is_active?"ACTIVE":"INACTIVE",itemIds:q.items?q.items.map(z=>z.id):[]})}catch{ct.error("Failed to load details");return}}else u(null),h(Vb);o(!0)},E=()=>{o(!1),h(Vb),u(null)},W=H=>{const{name:M,value:q}=H.target;h(z=>({...z,[M]:q}))},R=H=>{h(M=>{const q=M.itemIds||[];return q.includes(H)?{...M,itemIds:q.filter(z=>z!==H)}:{...M,itemIds:[...q,H]}})},U=async H=>{var M,q;H.preventDefault();try{const z={...c,is_active:c.status==="ACTIVE"?1:0};d?(await Z.put(`/sales/discount-schemes/${d}`,z),ct.success("Discount scheme updated")):(await Z.post("/sales/discount-schemes",z),ct.success("Discount scheme created")),E(),_()}catch(z){console.error(z),ct.error(((q=(M=z.response)==null?void 0:M.data)==null?void 0:q.message)||"Operation failed")}},T=async H=>{if(window.confirm("Are you sure you want to delete this scheme?"))try{await Z.delete(`/sales/discount-schemes/${H}`),ct.success("Deleted successfully"),_()}catch{ct.error("Delete failed")}},Y=f.useMemo(()=>{if(!j)return r;const H=j.toLowerCase();return r.filter(M=>M.item_code.toLowerCase().includes(H)||M.item_name.toLowerCase().includes(H))},[r,j]);return n&&!t.length?e.jsx("div",{className:"p-8 text-center",children:"Loading..."}):e.jsxs("div",{className:"discount-scheme-container",children:[e.jsx("header",{className:"ds-header",children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h1",{children:" Discount Scheme Management"}),e.jsx("p",{children:"Manage and configure discount schemes for sales operations"})]}),e.jsx(Re,{to:"/sales",className:"ds-btn ds-btn-secondary",children:"Return to Menu"})]})}),e.jsxs("div",{className:"ds-stats-grid",children:[e.jsxs("div",{className:"ds-stat-card",children:[e.jsx("h3",{children:"Total Schemes"}),e.jsx("div",{className:"value",children:I.total})]}),e.jsxs("div",{className:"ds-stat-card",children:[e.jsx("h3",{children:"Active Schemes"}),e.jsx("div",{className:"value",children:I.active})]}),e.jsxs("div",{className:"ds-stat-card",children:[e.jsx("h3",{children:"Avg Discount %"}),e.jsxs("div",{className:"value",children:[I.avgDiscount,"%"]})]}),e.jsxs("div",{className:"ds-stat-card",children:[e.jsx("h3",{children:"This Month"}),e.jsx("div",{className:"value",children:I.thisMonth})]})]}),e.jsxs("div",{className:"ds-card",children:[e.jsxs("div",{className:"ds-action-bar",children:[e.jsx("div",{className:"ds-search-box",children:e.jsx("input",{type:"text",placeholder:"Search by code, name, or description...",value:b,onChange:H=>y(H.target.value)})}),e.jsx("button",{className:"ds-btn ds-btn-primary",onClick:()=>w(),children:" New Discount Scheme"})]}),e.jsxs("div",{className:"ds-filter-section",children:[e.jsxs("select",{value:m,onChange:H=>p(H.target.value),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"ACTIVE",children:"Active"}),e.jsx("option",{value:"INACTIVE",children:"Inactive"})]}),e.jsxs("select",{value:g,onChange:H=>x(H.target.value),children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"PERCENTAGE",children:"Percentage"}),e.jsx("option",{value:"FIXED",children:"Fixed Amount"})]})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{className:"ds-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Scheme Name"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Value"}),e.jsx("th",{children:"Valid From"}),e.jsx("th",{children:"Valid To"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:F.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"ds-empty-state",children:"No discount schemes found"})}):F.map(H=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:H.scheme_code})}),e.jsx("td",{children:H.scheme_name}),e.jsx("td",{children:e.jsx("span",{className:`ds-badge ds-badge-${H.discount_type==="PERCENTAGE"?"percentage":"fixed"}`,children:H.discount_type})}),e.jsx("td",{children:e.jsx("strong",{children:H.discount_type==="PERCENTAGE"?Number(H.discount_value)+"%":"$"+Number(H.discount_value).toFixed(2)})}),e.jsx("td",{children:new Date(H.effective_from).toLocaleDateString()}),e.jsx("td",{children:H.effective_to?new Date(H.effective_to).toLocaleDateString():"No expiry"}),e.jsx("td",{children:e.jsx("span",{className:`ds-badge ds-badge-${H.is_active?"active":"inactive"}`,children:H.is_active?"ACTIVE":"INACTIVE"})}),e.jsx("td",{children:e.jsx("div",{className:"ds-action-buttons",children:e.jsx("button",{className:"ds-icon-btn",onClick:()=>T(H.id),title:"Delete",children:"Delete"})})})]},H.id))})]})})]}),l&&e.jsx("div",{className:"ds-modal-overlay",children:e.jsxs("div",{className:"ds-modal-content",children:[e.jsx("div",{className:"ds-modal-header",children:e.jsx("h2",{children:d?"Edit Discount Scheme":"New Discount Scheme"})}),e.jsxs("form",{onSubmit:U,children:[e.jsxs("div",{className:"ds-form-row",children:[e.jsxs("div",{className:"ds-form-group",children:[e.jsx("label",{children:"Scheme Code *"}),e.jsx("input",{name:"scheme_code",value:c.scheme_code,onChange:W,required:!0,disabled:!!d})]}),e.jsxs("div",{className:"ds-form-group",children:[e.jsx("label",{children:"Scheme Name *"}),e.jsx("input",{name:"scheme_name",value:c.scheme_name,onChange:W,required:!0})]})]}),e.jsxs("div",{className:"ds-form-row",children:[e.jsxs("div",{className:"ds-form-group",children:[e.jsx("label",{children:"Discount Type *"}),e.jsxs("select",{name:"discount_type",value:c.discount_type,onChange:W,required:!0,children:[e.jsx("option",{value:"",children:"Select Type"}),e.jsx("option",{value:"PERCENTAGE",children:"Percentage"}),e.jsx("option",{value:"FIXED",children:"Fixed Amount"})]})]}),e.jsxs("div",{className:"ds-form-group",children:[e.jsx("label",{children:"Discount Value *"}),e.jsx("input",{type:"number",name:"discount_value",value:c.discount_value,onChange:W,step:"0.01",min:"0",required:!0})]})]}),e.jsxs("div",{className:"ds-form-row",children:[e.jsxs("div",{className:"ds-form-group",children:[e.jsx("label",{children:"Valid From *"}),e.jsx("input",{type:"date",name:"effective_from",value:c.effective_from,onChange:W,required:!0})]}),e.jsxs("div",{className:"ds-form-group",children:[e.jsx("label",{children:"Valid To"}),e.jsx("input",{type:"date",name:"effective_to",value:c.effective_to,onChange:W})]})]}),e.jsxs("div",{className:"ds-form-row",children:[e.jsxs("div",{className:"ds-form-group",children:[e.jsx("label",{children:"Min Quantity"}),e.jsx("input",{type:"number",name:"min_quantity",value:c.min_quantity,onChange:W,step:"0.01",min:"0"})]}),e.jsxs("div",{className:"ds-form-group",children:[e.jsx("label",{children:"Min Purchase Amount"}),e.jsx("input",{type:"number",name:"min_purchase_amount",value:c.min_purchase_amount,onChange:W,step:"0.01",min:"0"})]})]}),e.jsx("div",{className:"ds-form-row",children:e.jsxs("div",{className:"ds-form-group",children:[e.jsx("label",{children:"Max Discount Amount"}),e.jsx("input",{type:"number",name:"max_discount_amount",value:c.max_discount_amount,onChange:W,step:"0.01",min:"0"})]})}),e.jsxs("div",{className:"ds-form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{name:"description",value:c.description,onChange:W,rows:"3"})]}),e.jsxs("div",{className:"ds-form-group",children:[e.jsx("label",{children:"Status *"}),e.jsxs("select",{name:"status",value:c.status,onChange:W,required:!0,children:[e.jsx("option",{value:"ACTIVE",children:"Active"}),e.jsx("option",{value:"INACTIVE",children:"Inactive"})]})]}),e.jsxs("div",{className:"ds-form-group",children:[e.jsx("label",{children:"Linked Items (Search to filter)"}),e.jsx("input",{type:"text",placeholder:"Search items...",value:j,onChange:H=>N(H.target.value),className:"mb-2"}),e.jsxs("div",{className:"ds-item-selection",children:[Y.slice(0,100).map(H=>e.jsxs("div",{className:"ds-item-checkbox",children:[e.jsx("input",{type:"checkbox",checked:c.itemIds.includes(H.id),onChange:()=>R(H.id)}),e.jsxs("span",{children:[H.item_code," - ",H.item_name]})]},H.id)),Y.length>100&&e.jsx("div",{className:"p-2 text-gray-500 italic",children:"Showing first 100 matches..."})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Selected: ",c.itemIds.length," items"]})]}),e.jsxs("div",{className:"ds-action-buttons",children:[e.jsx("button",{type:"submit",className:"ds-btn ds-btn-success",children:" Save Scheme"}),e.jsx("button",{type:"button",className:"ds-btn ds-btn-secondary",onClick:E,children:" Cancel"})]})]})]})})]})}function OZ(){const t=[{id:1,customer:"ABC Corporation",creditLimit:5e4,currency:"GHS"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Customer Credit Limits"}),e.jsx("p",{className:"text-sm mt-1",children:"Credit limit setup (placeholder)"})]}),e.jsx(Re,{to:"/sales",className:"btn btn-secondary",children:"Return to Menu"})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Customer"}),e.jsx("th",{className:"text-right",children:"Credit Limit"}),e.jsx("th",{children:"Currency"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:t.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:s.customer}),e.jsx("td",{className:"text-right",children:Number(s.creditLimit).toFixed(2)}),e.jsx("td",{children:s.currency}),e.jsx("td",{children:e.jsx(Re,{to:`/sales/customer-credit/${s.id}`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"Edit"})})]},s.id))})]})})})]})}function MZ(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState(""),[o,d]=f.useState({customer:"",creditLimit:0,currency:"GHS"});f.useEffect(()=>{r&&u()},[s]);async function u(){var m,p,g;try{n(!0),l("");const x=await Z.get(`/sales/customer-credit/${s}`);(m=x.data)!=null&&m.item&&d(x.data.item)}catch(x){l(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Error fetching customer credit")}finally{n(!1)}}function c(m,p){d(g=>({...g,[m]:p}))}async function h(m){var p,g;m.preventDefault(),n(!0),l("");try{r?await Z.put(`/sales/customer-credit/${s}`,o):await Z.post("/sales/customer-credit",o),t("/sales/customer-credit")}catch(x){l(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Error saving customer credit")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"Edit Credit Limit":"New Credit Limit"})}),e.jsx(Re,{to:"/sales/customer-credit",className:"btn-success",children:"Back"})]})}),e.jsx("form",{onSubmit:h,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[i&&e.jsx("div",{className:"alert alert-error mb-4",children:i}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Customer *"}),e.jsx("input",{className:"input",value:o.customer,onChange:m=>c("customer",m.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Credit Limit"}),e.jsx("input",{className:"input",type:"number",step:"0.01",min:"0",value:o.creditLimit,onChange:m=>c("creditLimit",Number(m.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsx("input",{className:"input",value:o.currency,onChange:m=>c("currency",m.target.value)})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/sales/customer-credit",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",disabled:a,children:a?"Saving...":"Save"})]})]})})})]})}function QZ(){const t=ps(),s=Is.useRef(null),[r,a]=f.useState([]),[n,i]=f.useState(!0),[l,o]=f.useState(""),[d,u]=f.useState(""),[c,h]=f.useState(!1),[m,p]=f.useState(""),[g,x]=f.useState(!1),[b,y]=f.useState(!1),[j,N]=f.useState(!1),[_,F]=f.useState(!1),{hasAccess:I,scope:w}=Kr(),{canPerformAction:E}=Ls(),[W,R]=f.useState(!1);f.useEffect(()=>{U()},[]);const U=async()=>{var M,q,z;try{i(!0),o("");const Q=await Z.get("/sales/customers",{params:{active:!0}}),L=Q.data&&Q.data.data&&Q.data.data.items||((M=Q.data)==null?void 0:M.items)||[];a(Array.isArray(L)?L:[])}catch(Q){o(((z=(q=Q==null?void 0:Q.response)==null?void 0:q.data)==null?void 0:z.message)||"Error fetching customers"),console.error("Error fetching customers:",Q)}finally{i(!1)}},T=async()=>{try{const M=await Z.get("/sales/customers/template",{responseType:"blob"}),q=window.URL.createObjectURL(new Blob([M.data])),z=document.createElement("a");z.href=q,z.setAttribute("download","CustomerTemplate.xlsx"),document.body.appendChild(z),z.click(),z.remove()}catch(M){console.error("Error downloading template",M),alert("Error downloading template")}},Y=async M=>{var Q,L;const q=M.target.files[0];if(!q)return;const z=new FormData;z.append("file",q);try{i(!0),await Z.post("/sales/customers/import",z,{headers:{"Content-Type":"multipart/form-data"}}),alert("Customers imported successfully!"),U()}catch(V){console.error("Error importing customers",V),alert(((L=(Q=V==null?void 0:V.response)==null?void 0:Q.data)==null?void 0:L.message)||"Error importing customers")}finally{i(!1),s.current&&(s.current.value="")}},H=r.filter(M=>M&&(String(M.customer_code||"").toLowerCase().includes(d.toLowerCase())||String(M.customer_name||"").toLowerCase().includes(d.toLowerCase())||String(M.email||"").toLowerCase().includes(d.toLowerCase())));return n?e.jsx("div",{className:"text-center py-8",children:"Loading customers..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Customer Setup"}),e.jsx("p",{className:"text-sm mt-1",children:"Manage customers and their information"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:T,className:"btn btn-secondary",children:"Template"}),e.jsx("button",{onClick:()=>s.current.click(),className:"btn btn-primary",children:"Import"}),e.jsx("input",{type:"file",ref:s,className:"hidden",accept:".xlsx, .xls",onChange:Y}),e.jsx(Re,{to:"/sales",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/sales/customers/new",className:"btn-success",children:"+ New Customer"})]})]})}),l&&e.jsx("div",{className:"alert alert-error",children:e.jsx("span",{children:l})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("input",{type:"text",placeholder:"Search customers...",className:"input",value:d,onChange:M=>u(M.target.value)}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"checkbox",checked:W,onChange:M=>R(M.target.checked)}),e.jsx("span",{children:"Show current branch only"})]}),e.jsx("button",{className:"btn btn-outline",onClick:U,children:"Refresh"})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Price Type"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Email/Phone"}),e.jsx("th",{children:"Credit Limit"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:(W?H.filter(M=>String(M.branch_id||"")===String((w==null?void 0:w.branchId)||"")):H).map(M=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:M.customer_code}),e.jsxs("td",{children:[e.jsx("div",{className:"font-bold",children:M.customer_name}),M.address&&e.jsx("div",{className:"text-xs text-slate-500 truncate max-w-[200px]",children:M.address})]}),e.jsx("td",{children:M.customer_type||"-"}),e.jsx("td",{children:M.price_type_name||"-"}),e.jsx("td",{children:M.contact_person||"-"}),e.jsxs("td",{children:[e.jsx("div",{className:"text-sm",children:M.email}),e.jsx("div",{className:"text-xs text-slate-500",children:M.phone})]}),e.jsx("td",{children:M.credit_limit?`${Number(M.credit_limit).toFixed(2)}`:"-"}),e.jsx("td",{children:M.is_active?e.jsx("span",{className:"badge badge-success",children:"Active"}):e.jsx("span",{className:"badge badge-error",children:"Inactive"})}),e.jsx("td",{children:E("sales:customers","edit")&&e.jsx("button",{className:"text-brand hover:text-brand-600 text-sm font-medium",onClick:()=>t(`/sales/customers/${M.id}`),children:"Edit"})})]},M.id))})]}),H.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-600",children:"No customers found"})]})]})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-erp w-full max-w-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-red-600 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Bulk Delete Customers"}),e.jsx("button",{onClick:()=>{h(!1),p("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"text-sm text-slate-700",children:"Paste names and/or codes. Raw blobs accepted; codes like C00003 will be detected."}),e.jsx("textarea",{className:"input w-full h-40",placeholder:"Enter customer names/codes/raw data...",value:m,onChange:M=>p(M.target.value)}),e.jsx("div",{className:"text-xs text-slate-600",children:"This action deletes matching customers for the current company."}),e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-2",children:[e.jsx("input",{type:"checkbox",className:"checkbox",checked:b,onChange:M=>y(M.target.checked)}),e.jsx("span",{children:"Force delete (temporarily disable constraints)"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"checkbox",checked:j,onChange:M=>N(M.target.checked)}),e.jsx("span",{children:"Cascade delete (remove dependent sales rows)"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"checkbox",checked:_,onChange:M=>F(M.target.checked)}),e.jsx("span",{children:"Also cleanup finance accounts"})]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{h(!1),p("")},disabled:g,children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-danger",onClick:async()=>{var M,q,z,Q,L,V;if(!m.trim()){alert("Enter names or codes to delete.");return}if(window.confirm("Are you sure you want to delete the provided customers?"))try{x(!0);const P=await Z.post("/sales/customers/bulk-delete",{raw:m,force:b,cascade:j,cleanup_finance:_}),C=Number(((M=P==null?void 0:P.data)==null?void 0:M.deletedByName)||0),k=Number(((q=P==null?void 0:P.data)==null?void 0:q.deletedByCode)||0),B=Number(((z=P==null?void 0:P.data)==null?void 0:z.matched)||0),G=Number(((Q=P==null?void 0:P.data)==null?void 0:Q.deleted)||C+k),O=C||k?`Deleted by name: ${C}
Deleted by code: ${k}
Total: ${C+k}`:`Matched: ${B}
Deleted: ${G}`;alert(O),h(!1),p(""),await U()}catch(P){alert(((V=(L=P==null?void 0:P.response)==null?void 0:L.data)==null?void 0:V.message)||"Bulk delete failed. Ensure you have delete rights.")}finally{x(!1)}},disabled:g,children:g?"Deleting...":"Delete"})]})]})})]})}function nC(){var N;const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState(""),[o,d]=f.useState([]),[u,c]=f.useState([]),[h,m]=f.useState({customer_code:"",customer_name:"",email:"",phone:"",is_active:!0,address:"",city:"",state:"",zone:"",country:"",price_type_id:"",currency_id:""});f.useEffect(()=>{g(),x(),r?b():p()},[s]);async function p(){var _;try{const F=await Z.get("/sales/customers/next-code");(_=F.data)!=null&&_.code&&y("customer_code",F.data.code)}catch(F){console.error("Error fetching next customer code",F)}}async function g(){var _;try{const F=await Z.get("/sales/price-types");d(Array.isArray((_=F.data)==null?void 0:_.items)?F.data.items:[])}catch(F){console.error("Error fetching price types",F)}}async function x(){var _;try{const F=await Z.get("/finance/currencies"),I=Array.isArray((_=F.data)==null?void 0:_.items)?F.data.items:[];c(I);const w=I.find(E=>Number(E.is_base)===1);!r&&w&&y("currency_id",String(w.id))}catch(F){console.error("Error fetching currencies",F)}}async function b(){var _,F,I;try{n(!0),l("");const w=await Z.get(`/sales/customers/${s}`);(_=w.data)!=null&&_.item&&m(w.data.item)}catch(w){l(((I=(F=w==null?void 0:w.response)==null?void 0:F.data)==null?void 0:I.message)||"Error fetching customer")}finally{n(!1)}}function y(_,F){m(I=>({...I,[_]:F}))}async function j(_){var F,I;_.preventDefault(),n(!0),l("");try{r?await Z.put(`/sales/customers/${s}`,h):await Z.post("/sales/customers",h),t("/sales/customers")}catch(w){l(((I=(F=w==null?void 0:w.response)==null?void 0:F.data)==null?void 0:I.message)||"Error saving customer")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"Edit Customer":"New Customer"})}),e.jsx(Re,{to:"/sales/customers",className:"btn-success",children:"Back"})]})}),e.jsx("form",{onSubmit:j,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[i&&e.jsx("div",{className:"alert alert-error",children:i}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Customer Code"}),e.jsx("input",{className:"input",value:h.customer_code||"",onChange:_=>y("customer_code",_.target.value),placeholder:"Auto-generated if empty"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Customer Name *"}),e.jsx("input",{className:"input",value:h.customer_name||"",onChange:_=>y("customer_name",_.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Customer Type"}),e.jsxs("select",{className:"input",value:h.customer_type||"Individual",onChange:_=>y("customer_type",_.target.value),children:[e.jsx("option",{value:"Individual",children:"Individual"}),e.jsx("option",{value:"Business",children:"Business"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Contact Person"}),e.jsx("input",{className:"input",value:h.contact_person||"",onChange:_=>y("contact_person",_.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Email"}),e.jsx("input",{className:"input",type:"email",value:h.email||"",onChange:_=>y("email",_.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Phone"}),e.jsx("input",{className:"input",value:h.phone||"",onChange:_=>y("phone",_.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Mobile"}),e.jsx("input",{className:"input",value:h.mobile||"",onChange:_=>y("mobile",_.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Credit Limit"}),e.jsx("input",{className:"input",type:"number",value:h.credit_limit||"",onChange:_=>y("credit_limit",_.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Payment Terms"}),e.jsxs("select",{className:"input",value:h.payment_terms||"Net 30",onChange:_=>y("payment_terms",_.target.value),children:[e.jsx("option",{value:"Immediate",children:"Immediate"}),e.jsx("option",{value:"Net 15",children:"Net 15"}),e.jsx("option",{value:"Net 30",children:"Net 30"}),e.jsx("option",{value:"Net 45",children:"Net 45"}),e.jsx("option",{value:"Net 60",children:"Net 60"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:h.is_active?"1":"0",onChange:_=>y("is_active",_.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Address"}),e.jsx("textarea",{className:"input",rows:"3",value:h.address||"",onChange:_=>y("address",_.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"City"}),e.jsx("input",{className:"input",value:h.city||"",onChange:_=>y("city",_.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"State"}),e.jsx("input",{className:"input",value:h.state||"",onChange:_=>y("state",_.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Zone"}),e.jsx("input",{className:"input",value:h.zone||"",onChange:_=>y("zone",_.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Country"}),e.jsx("input",{className:"input",value:h.country||"",onChange:_=>y("country",_.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Price Type"}),e.jsxs("select",{className:"input",value:h.price_type_id||"",onChange:_=>y("price_type_id",_.target.value),children:[e.jsx("option",{value:"",children:"-- Select Price Type --"}),o.map(_=>e.jsx("option",{value:_.id,children:_.name},_.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsxs("select",{className:"input",value:h.currency_id||"",onChange:_=>y("currency_id",_.target.value),children:[e.jsx("option",{value:"",children:"-- Select Currency --"}),u.map(_=>e.jsx("option",{value:_.id,children:(_.code||_.currency_code)+" - "+(_.name||_.currency_name||"")},_.id))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(Re,{to:"/sales/customers",className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{className:"btn-success",disabled:a,children:a?"Saving...":"Save Customer"})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900 rounded-lg p-6 border border-slate-200 dark:border-slate-700 sticky top-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 border-b border-slate-200 dark:border-slate-700 pb-2",children:"Customer Preview"}),!h.customer_code&&!h.customer_name?e.jsxs("div",{className:"text-center py-10 text-slate-400",children:[e.jsx("div",{className:"text-5xl mb-3",children:""}),e.jsx("p",{children:"Fill in the form to preview customer details"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider block",children:"Customer Code"}),e.jsx("div",{className:"font-mono text-brand-600 font-medium",children:h.customer_code||"(Auto-generated)"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider block",children:"Customer Name"}),e.jsx("div",{className:"text-lg font-bold",children:h.customer_name}),h.customer_type&&e.jsx("span",{className:"inline-block bg-slate-200 dark:bg-slate-700 text-xs px-2 py-0.5 rounded mt-1",children:h.customer_type})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider block",children:"Contact"}),e.jsx("div",{className:"text-sm",children:h.contact_person||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider block",children:"Phone"}),e.jsx("div",{className:"text-sm",children:h.phone||"-"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider block",children:"Email"}),e.jsx("div",{className:"text-sm break-all text-brand-500",children:h.email||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider block",children:"Credit Limit"}),e.jsx("div",{className:"font-medium text-green-600",children:h.credit_limit?`${Number(h.credit_limit).toLocaleString()}`:"0.00"})]}),h.address&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider block",children:"Address"}),e.jsx("div",{className:"text-sm whitespace-pre-wrap",children:h.address})]}),(h.city||h.state||h.country||h.zone)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider block",children:"Location"}),e.jsxs("div",{className:"text-sm",children:[[h.city,h.state,h.country].filter(Boolean).join(", "),h.zone&&e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Zone: ",h.zone]})]})]}),h.price_type_id&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider block",children:"Price Type"}),e.jsx("div",{className:"text-sm",children:((N=o.find(_=>String(_.id)===String(h.price_type_id)))==null?void 0:N.name)||h.price_type_id})]})]})]})})]})]})})})]})}function HZ(){const[t,s]=f.useState("");return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg",children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Bulk Customer Upload"}),e.jsx("p",{className:"text-sm mt-1",children:"Upload customers in bulk (placeholder)"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"CSV File"}),e.jsx("input",{className:"input",type:"file",accept:".csv",onChange:r=>{var a,n;return s(((n=(a=r.target.files)==null?void 0:a[0])==null?void 0:n.name)||"")}}),t?e.jsxs("div",{className:"text-sm mt-2",children:["Selected: ",t]}):null]}),e.jsx("div",{className:"text-sm",children:"Expected columns: customer_code, customer_name, email, phone, address"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>window.alert("Upload processing will be implemented in Sales module backend."),children:"Upload"})]})})]})}function qZ(){const t=[{title:"Sales by Customer",description:"Sales totals grouped by customer (placeholder)"},{title:"Invoice Aging",description:"Outstanding invoices aging buckets (placeholder)"},{title:"Discount Analysis",description:"Discount usage summary (placeholder)"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg",children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Sales Reports"}),e.jsx("p",{className:"text-sm mt-1",children:"Analytics and reports"})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map((s,r)=>e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:[e.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100",children:s.title}),e.jsx("div",{className:"text-sm mt-1",children:s.description})]},r))})})})]})}function lF(){const[t,s]=f.useState(""),[r,a]=f.useState(!1),[n,i]=f.useState(""),[l,o]=f.useState([]),[d,u]=f.useState(!1),[c,h]=f.useState(!1),[m,p]=f.useState(null),[g,x]=f.useState(null),[b,y]=f.useState(null),[j,N]=f.useState([]),[_,F]=f.useState(null),[I,w]=f.useState(null),[E,W]=f.useState(!1),[R,U]=f.useState(""),[T,Y]=f.useState(!1);f.useEffect(()=>{let V=!0;return a(!0),i(""),Z.get("/sales/returns").then(P=>{var C;V&&o(Array.isArray((C=P.data)==null?void 0:C.items)?P.data.items:[])}).catch(P=>{var C,k;V&&i(((k=(C=P==null?void 0:P.response)==null?void 0:C.data)==null?void 0:k.message)||"Failed to load sales returns")}).finally(()=>{V&&a(!1)}),()=>{V=!1}},[]);const H=f.useMemo(()=>{const V=t.toLowerCase();return l.filter(P=>{const C=String(P.return_no||"").toLowerCase(),k=String(P.customer_name||"").toLowerCase(),B=String(P.invoice_id||"").toLowerCase();return C.includes(V)||k.includes(V)||B.includes(V)})},[l,t]),M=f.useMemo(()=>{const V=l.length,P=l.filter(B=>B.status==="PENDING"||B.status==="PENDING_APPROVAL").length,C=l.filter(B=>B.status==="APPROVED"||B.status==="POSTED").length,k=l.filter(B=>B.status==="DRAFT").length;return{total:V,pending:P,approved:C,draft:k}},[l]),q=async V=>{var P,C,k;if(p(V),h(!0),U(""),g)await z();else try{W(!0);const B=await Z.get("/workflows"),G=Array.isArray((P=B.data)==null?void 0:P.items)?B.data.items:[];x(G),await Q(G)}catch(B){U(((k=(C=B==null?void 0:B.response)==null?void 0:C.data)==null?void 0:k.message)||"Failed to load workflows")}finally{W(!1)}},z=async()=>{var G,O,K;if(!g||!g.length){y(null),F(null),U(""),Y(!1);return}const V="/inventory/sales-returns",P=J=>String(J||"").trim().toUpperCase().replace(/\s+/g,"_"),k=g.filter(J=>String(J.document_route)===V||P(J.document_type)==="SALES_RETURN").some(J=>Number(J.is_active)===0),B=g.find(J=>Number(J.is_active)===1&&String(J.document_route)===V)||g.find(J=>Number(J.is_active)===1&&P(J.document_type)==="SALES_RETURN")||null;if(y(B||null),Y(!B&&k),F(null),!!B)try{W(!0);const te=(G=(await Z.get(`/workflows/${B.id}`)).data)==null?void 0:G.item,se=Array.isArray(te==null?void 0:te.steps)?te.steps:[];N(se);const ae=se[0]||null;if(F(ae?{userId:ae.approver_user_id,name:ae.approver_name,stepName:ae.step_name,stepOrder:ae.step_order,approvalLimit:ae.approval_limit}:null),ae){const ne=(Array.isArray(ae.approvers)&&ae.approvers.length?ae.approvers[0].id:ae.approver_user_id)||null;w(ne)}else w(null)}catch(J){U(((K=(O=J==null?void 0:J.response)==null?void 0:O.data)==null?void 0:K.message)||"Failed to load workflow details")}finally{W(!1)}},Q=async V=>{var O,K,J;if(!V||!V.length){y(null),F(null),U(""),Y(!1);return}const P="/inventory/sales-returns",C=te=>String(te||"").trim().toUpperCase().replace(/\s+/g,"_"),B=V.filter(te=>String(te.document_route)===P||C(te.document_type)==="SALES_RETURN").some(te=>Number(te.is_active)===0),G=V.find(te=>Number(te.is_active)===1&&String(te.document_route)===P)||V.find(te=>Number(te.is_active)===1&&C(te.document_type)==="SALES_RETURN")||null;if(y(G||null),Y(!G&&B),F(null),!!G)try{W(!0);const se=(O=(await Z.get(`/workflows/${G.id}`)).data)==null?void 0:O.item,ae=Array.isArray(se==null?void 0:se.steps)?se.steps:[];N(ae);const ne=ae[0]||null;F(ne?{userId:ne.approver_user_id,name:ne.approver_name,stepName:ne.step_name,stepOrder:ne.step_order,approvalLimit:ne.approval_limit}:null)}catch(te){U(((J=(K=te==null?void 0:te.response)==null?void 0:K.data)==null?void 0:J.message)||"Failed to load workflow details")}finally{W(!1)}},L=async()=>{var V,P,C;if(m){u(!0),U("");try{const k=await Z.post(`/sales/returns/${m.id}/submit`,{amount:Number(m.total_amount||0)||null,workflow_id:b?b.id:null,target_user_id:I||null}),B=((V=k==null?void 0:k.data)==null?void 0:V.status)||"PENDING";o(G=>G.map(O=>O.id===m.id?{...O,status:B}:O)),h(!1),p(null)}catch(k){U(((C=(P=k==null?void 0:k.response)==null?void 0:P.data)==null?void 0:C.message)||"Failed to forward for approval")}finally{u(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx("span",{children:""})," Sales Returns"]}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Process customer returns and track status"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/inventory/sales-returns/new",className:"btn btn-primary",children:"New Sales Return"}),e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"})]})]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 rounded-lg border bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Total Returns"}),e.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:M.total})]}),e.jsxs("div",{className:"p-4 rounded-lg border bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Draft"}),e.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:M.draft})]}),e.jsxs("div",{className:"p-4 rounded-lg border bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Pending"}),e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:M.pending})]}),e.jsxs("div",{className:"p-4 rounded-lg border bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Approved"}),e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:M.approved})]})]}),e.jsx("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",className:"input pl-10",placeholder:"Search by return no, customer, or invoice",value:t,onChange:V=>s(V.target.value)}),e.jsx(Jf,{className:"w-5 h-5 text-slate-400 absolute left-3 top-1/2 -translate-y-1/2"})]})})}),n&&e.jsx("div",{className:"alert alert-error mb-4",children:n}),r?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-brand"}),e.jsx("p",{className:"mt-2",children:"Loading sales returns..."})]}):H.length===0?e.jsx("div",{className:"text-center py-12 text-slate-600",children:"No sales returns found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Return No"}),e.jsx("th",{children:"Return Date"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{className:"text-right",children:"Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"text-right",children:"Actions"})]})}),e.jsx("tbody",{children:H.map(V=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:V.return_no}),e.jsx("td",{children:V.return_date?new Date(V.return_date).toLocaleDateString():"-"}),e.jsx("td",{children:V.customer_name||"-"}),e.jsx("td",{className:"text-right",children:Number(V.total_amount||0).toFixed(2)}),e.jsx("td",{children:e.jsx("span",{className:`badge ${V.status==="APPROVED"||V.status==="POSTED"?"badge-success":V.status==="PENDING"||V.status==="PENDING_APPROVAL"||V.status==="SUBMITTED"?"badge-warning":V.status==="CANCELLED"?"badge-error":"badge-info"}`,children:V.status||"DRAFT"})}),e.jsx("td",{className:"text-right",children:V.status==="APPROVED"||V.status==="POSTED"?e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded bg-green-500 text-white",children:"Approved"}):e.jsx("button",{type:"button",onClick:()=>q(V),className:"text-sm font-medium px-2 py-1 rounded bg-brand text-white hover:bg-brand-700",disabled:d||V.status==="PENDING"||V.status==="PENDING_APPROVAL"||V.status==="SUBMITTED"||V.status==="CANCELLED"||T,children:d?"Forwarding...":"Forward for Approval"})})]},V.id))})]})})]})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-erp w/full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-brand text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Forward for Approval"}),e.jsx("button",{onClick:()=>{h(!1),p(null),y(null),F(null),U("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Sales Return:"," ",e.jsx("span",{className:"font-semibold",children:(m==null?void 0:m.return_no)||`#${m==null?void 0:m.id}`})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:b?`${b.workflow_name} (${b.workflow_code})`:"None (inactive)"})]}),e.jsxs("div",{children:[E?e.jsx("div",{className:"text-sm",children:"Loading workflow..."}):null,R?e.jsx("div",{className:"text-sm text-red-600",children:R}):null]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Target Approver"}),(()=>{const P=Array.isArray(j)&&j.length>0?j[0]:null,C=P?Array.isArray(P.approvers)&&P.approvers.length?P.approvers.map(k=>({id:k.id,name:k.username})):P.approver_user_id?[{id:P.approver_user_id,name:P.approver_name||String(P.approver_user_id)}]:[]:[];return C.length>0?e.jsxs("div",{className:"mt-1",children:[e.jsxs("select",{className:"input w-full",value:I||"",onChange:k=>w(k.target.value?Number(k.target.value):null),children:[e.jsx("option",{value:"",children:"Select target approver"}),C.map(k=>e.jsx("option",{value:k.id,children:k.name},k.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:_?`Step ${_.stepOrder}  ${_.stepName}${_.approvalLimit!=null?`  Limit: ${Number(_.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:b?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})()]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{h(!1),p(null),y(null),F(null),U("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:L,disabled:d,children:d?"Forwarding...":"Forward"})]})]})})]})}function $Z(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var m,p,g;try{o(!0);const x=await Z.get("/sales/reports/sales-return",{params:{from:t||null,to:r||null}});i(((m=x.data)==null?void 0:m.items)||[])}catch(x){ct.error(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Failed to load report")}finally{o(!1)}}function u(){const m=["Date","Return No","Customer","Item","Quantity","Amount"],p=(Array.isArray(n)?n:[]).map(j=>[j.return_date?new Date(j.return_date).toLocaleDateString():"-",j.return_no||"-",j.customer_name||"-",j.item_name||j.item_code||"-",Number(j.qty||0).toFixed(2),Number(j.amount||0).toFixed(2)]),g=[m.join(","),...p.map(j=>j.join(","))].join(`
`),x=new Blob([g],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(x),y=document.createElement("a");y.href=b,y.download="sales_return.csv",y.click(),URL.revokeObjectURL(b)}function c(){const m=(Array.isArray(n)?n:[]).map(x=>({date:x.return_date?new Date(x.return_date).toLocaleDateString():"-",return_no:x.return_no||"-",customer:x.customer_name||"-",item:x.item_name||x.item_code||"-",quantity:Number(x.qty||0),amount:Number(x.amount||0)})),p=is.json_to_sheet(m),g=is.book_new();is.book_append_sheet(g,p,"SalesReturn"),yr(g,"sales-return.xlsx")}function h(){const m=new hs("p","mm","a4");let p=15;m.setFontSize(14),m.text("Sales Return Report",10,p),p+=8,m.setFontSize(10);const g=["Date","Return No","Customer","Item","Qty","Amount"];m.text(g[0],10,p),m.text(g[1],35,p),m.text(g[2],70,p),m.text(g[3],120,p),m.text(g[4],160,p),m.text(g[5],190,p,{align:"right"}),p+=4,m.line(10,p,200,p),p+=5,(Array.isArray(n)?n:[]).forEach(x=>{p>270&&(m.addPage(),p=15);const b=x.return_date?new Date(x.return_date).toLocaleDateString():"-",y=String(x.return_no||"-"),j=String(x.customer_name||"-"),N=String(x.item_name||x.item_code||"-"),_=Number(x.qty||0).toFixed(2),F=Number(x.amount||0).toFixed(2);m.text(b,10,p),m.text(y,35,p),m.text(j.slice(0,40),70,p),m.text(N.slice(0,35),120,p),m.text(_,160,p),m.text(F,190,p,{align:"right"}),p+=5}),m.save("sales-return.pdf")}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Sales Return Report"}),e.jsx("p",{className:"text-sm mt-1",children:"Returned items and amounts within period"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/sales",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("button",{type:"button",className:"btn-success",onClick:u,disabled:l||n.length===0,children:"Export CSV"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:c,disabled:l||n.length===0,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:h,disabled:l||n.length===0,children:"Export PDF"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:m=>s(m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:m=>a(m.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Return No"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Item"}),e.jsx("th",{className:"text-right",children:"Quantity"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:n.map((m,p)=>e.jsxs("tr",{children:[e.jsx("td",{children:m.return_date?new Date(m.return_date).toLocaleDateString():"-"}),e.jsx("td",{className:"font-medium",children:m.return_no||"-"}),e.jsx("td",{children:m.customer_name||"-"}),e.jsx("td",{children:m.item_name||m.item_code}),e.jsx("td",{className:"text-right",children:Number(m.qty||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(m.amount||0).toLocaleString()})]},m.id||p))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function VZ(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var m,p,g;try{o(!0);const x=await Z.get("/sales/reports/sales-register",{params:{from:t||null,to:r||null}});i(((m=x.data)==null?void 0:m.items)||[])}catch(x){ct.error(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Failed to load report")}finally{o(!1)}}function u(){const m=["Date","Invoice No","Customer","Items","Amount","Status"],p=(Array.isArray(n)?n:[]).map(j=>[j.invoice_date?new Date(j.invoice_date).toLocaleDateString():"-",j.invoice_no||"-",j.customer_name||"-",Number(j.items_count||0).toString(),Number(j.total_amount||0).toFixed(2),j.status||"-"]),g=[m.join(","),...p.map(j=>j.join(","))].join(`
`),x=new Blob([g],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(x),y=document.createElement("a");y.href=b,y.download="sales_register.csv",y.click(),URL.revokeObjectURL(b)}function c(){const m=(Array.isArray(n)?n:[]).map(x=>({date:x.invoice_date?new Date(x.invoice_date).toLocaleDateString():"-",invoice_no:x.invoice_no||"-",customer:x.customer_name||"-",items:Number(x.items_count||0),amount:Number(x.total_amount||0),status:x.status||"-"})),p=is.json_to_sheet(m),g=is.book_new();is.book_append_sheet(g,p,"SalesRegister"),yr(g,"sales-register.xlsx")}function h(){const m=new hs("p","mm","a4");let p=15;m.setFontSize(14),m.text("Sales Register",10,p),p+=8,m.setFontSize(10);const g=["Date","Invoice No","Customer","Items","Amount","Status"];m.text(g[0],10,p),m.text(g[1],35,p),m.text(g[2],75,p),m.text(g[3],130,p),m.text(g[4],160,p),m.text(g[5],190,p,{align:"right"}),p+=4,m.line(10,p,200,p),p+=5,(Array.isArray(n)?n:[]).forEach(x=>{p>270&&(m.addPage(),p=15);const b=x.invoice_date?new Date(x.invoice_date).toLocaleDateString():"-",y=String(x.invoice_no||"-"),j=String(x.customer_name||"-"),N=String(Number(x.items_count||0)),_=Number(x.total_amount||0).toFixed(2),F=String(x.status||"-");m.text(b,10,p),m.text(y,35,p),m.text(j.slice(0,45),75,p),m.text(N,130,p),m.text(_,160,p),m.text(F,190,p,{align:"right"}),p+=5}),m.save("sales-register.pdf")}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Sales Register"}),e.jsx("p",{className:"text-sm mt-1",children:"Invoices and totals within the period"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/sales",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("button",{type:"button",className:"btn-success",onClick:u,disabled:l||n.length===0,children:"Export CSV"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:c,disabled:l||n.length===0,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:h,disabled:l||n.length===0,children:"Export PDF"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:m=>s(m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:m=>a(m.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Invoice No"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{className:"text-right",children:"Items"}),e.jsx("th",{className:"text-right",children:"Amount"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:n.map(m=>e.jsxs("tr",{children:[e.jsx("td",{children:m.invoice_date?new Date(m.invoice_date).toLocaleDateString():"-"}),e.jsx("td",{className:"font-medium",children:m.invoice_no||"-"}),e.jsx("td",{children:m.customer_name||"-"}),e.jsx("td",{className:"text-right",children:Number(m.items_count||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(m.total_amount||0).toLocaleString()}),e.jsx("td",{children:m.status||"-"})]},m.id))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function WZ(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var m,p,g;try{o(!0);const x=await Z.get("/sales/reports/delivery-register",{params:{from:t||null,to:r||null}});i(((m=x.data)==null?void 0:m.items)||[])}catch(x){ct.error(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Failed to load report")}finally{o(!1)}}function u(){const m=["Date","Delivery No","Customer","Item","Quantity"],p=(Array.isArray(n)?n:[]).map(j=>[j.delivery_date?new Date(j.delivery_date).toLocaleDateString():"-",j.delivery_no||"-",j.customer_name||"-",j.item_name||j.item_code||"-",Number(j.qty||0).toFixed(2)]),g=[m.join(","),...p.map(j=>j.join(","))].join(`
`),x=new Blob([g],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(x),y=document.createElement("a");y.href=b,y.download="delivery_register.csv",y.click(),URL.revokeObjectURL(b)}function c(){const m=(Array.isArray(n)?n:[]).map(x=>({date:x.delivery_date?new Date(x.delivery_date).toLocaleDateString():"-",delivery_no:x.delivery_no||"-",customer:x.customer_name||"-",item:x.item_name||x.item_code||"-",quantity:Number(x.qty||0)})),p=is.json_to_sheet(m),g=is.book_new();is.book_append_sheet(g,p,"DeliveryRegister"),yr(g,"delivery-register.xlsx")}function h(){const m=new hs("p","mm","a4");let p=15;m.setFontSize(14),m.text("Delivery Register",10,p),p+=8,m.setFontSize(10);const g=["Date","Delivery No","Customer","Item","Qty"];m.text(g[0],10,p),m.text(g[1],40,p),m.text(g[2],80,p),m.text(g[3],130,p),m.text(g[4],190,p,{align:"right"}),p+=4,m.line(10,p,200,p),p+=5,(Array.isArray(n)?n:[]).forEach(x=>{p>270&&(m.addPage(),p=15);const b=x.delivery_date?new Date(x.delivery_date).toLocaleDateString():"-",y=String(x.delivery_no||"-"),j=String(x.customer_name||"-"),N=String(x.item_name||x.item_code||"-"),_=Number(x.qty||0).toFixed(2);m.text(b,10,p),m.text(y,40,p),m.text(j.slice(0,45),80,p),m.text(N.slice(0,40),130,p),m.text(_,190,p,{align:"right"}),p+=5}),m.save("delivery-register.pdf")}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Delivery Register"}),e.jsx("p",{className:"text-sm mt-1",children:"Deliveries and quantities within the period"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/sales",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("button",{type:"button",className:"btn-success",onClick:u,disabled:l||n.length===0,children:"Export CSV"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:c,disabled:l||n.length===0,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:h,disabled:l||n.length===0,children:"Export PDF"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:m=>s(m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:m=>a(m.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Delivery No"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Item"}),e.jsx("th",{className:"text-right",children:"Quantity"})]})}),e.jsx("tbody",{children:n.map(m=>e.jsxs("tr",{children:[e.jsx("td",{children:m.delivery_date?new Date(m.delivery_date).toLocaleDateString():"-"}),e.jsx("td",{className:"font-medium",children:m.delivery_no||"-"}),e.jsx("td",{children:m.customer_name||"-"}),e.jsx("td",{children:m.item_name||m.item_code}),e.jsx("td",{className:"text-right",children:Number(m.qty||0).toLocaleString()})]},m.id))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function GZ(){const[t,s]=f.useState(""),[r,a]=f.useState([]),[n,i]=f.useState(!1),l=f.useMemo(()=>{const h=r.reduce((x,b)=>x+Number(b.opening||0),0),m=r.reduce((x,b)=>x+Number(b.invoiced||0),0),p=r.reduce((x,b)=>x+Number(b.received||0),0),g=r.reduce((x,b)=>x+Number(b.outstanding||0),0);return{opening:h,invoiced:m,received:p,outstanding:g}},[r]);async function o(){var h,m,p;try{i(!0);const g=await Z.get("/sales/reports/debtors-balance",{params:{asOf:t||null}});a(((h=g.data)==null?void 0:h.items)||[])}catch(g){ct.error(((p=(m=g==null?void 0:g.response)==null?void 0:m.data)==null?void 0:p.message)||"Failed to load report")}finally{i(!1)}}function d(){const h=["Customer","Opening","Invoiced","Received","Outstanding"],m=(Array.isArray(r)?r:[]).map(y=>[y.customer_name||"-",Number(y.opening||0).toFixed(2),Number(y.invoiced||0).toFixed(2),Number(y.received||0).toFixed(2),Number(y.outstanding||0).toFixed(2)]),p=[h.join(","),...m.map(y=>y.join(","))].join(`
`),g=new Blob([p],{type:"text/csv;charset=utf-8;"}),x=URL.createObjectURL(g),b=document.createElement("a");b.href=x,b.download="debtors_balance.csv",b.click(),URL.revokeObjectURL(x)}function u(){const h=(Array.isArray(r)?r:[]).map(g=>({customer:g.customer_name||"-",opening:Number(g.opening||0),invoiced:Number(g.invoiced||0),received:Number(g.received||0),outstanding:Number(g.outstanding||0)})),m=is.json_to_sheet(h),p=is.book_new();is.book_append_sheet(p,m,"DebtorsBalance"),yr(p,"debtors-balance.xlsx")}function c(){const h=new hs("p","mm","a4");let m=15;h.setFontSize(14),h.text("Debtors Balance",10,m),m+=8,h.setFontSize(10);const p=["Customer","Opening","Invoiced","Received","Outstanding"];h.text(p[0],10,m),h.text(p[1],80,m),h.text(p[2],110,m),h.text(p[3],140,m),h.text(p[4],190,m,{align:"right"}),m+=4,h.line(10,m,200,m),m+=5,(Array.isArray(r)?r:[]).forEach(g=>{m>270&&(h.addPage(),m=15);const x=String(g.customer_name||"-"),b=Number(g.opening||0).toFixed(2),y=Number(g.invoiced||0).toFixed(2),j=Number(g.received||0).toFixed(2),N=Number(g.outstanding||0).toFixed(2);h.text(x.slice(0,60),10,m),h.text(b,80,m),h.text(y,110,m),h.text(j,140,m),h.text(N,190,m,{align:"right"}),m+=5}),h.save("debtors-balance.pdf")}return f.useEffect(()=>{o()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Debtors Balance"}),e.jsx("p",{className:"text-sm mt-1",children:"Customer balances as of a date"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/sales",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:n||r.length===0,children:"Export CSV"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:u,disabled:n||r.length===0,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:c,disabled:n||r.length===0,children:"Export PDF"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"As of Date"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:h=>s(h.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:o,disabled:n,children:n?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s("")},disabled:n,children:"Clear"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Customer"}),e.jsx("th",{className:"text-right",children:"Opening"}),e.jsx("th",{className:"text-right",children:"Invoiced"}),e.jsx("th",{className:"text-right",children:"Received"}),e.jsx("th",{className:"text-right",children:"Outstanding"})]})}),e.jsx("tbody",{children:r.map((h,m)=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:h.customer_name||"-"}),e.jsx("td",{className:"text-right",children:Number(h.opening||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(h.invoiced||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(h.received||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(h.outstanding||0).toLocaleString()})]},h.id||m))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-right font-medium",children:"Totals"}),e.jsx("td",{className:"text-right font-medium",children:l.opening.toLocaleString()}),e.jsx("td",{className:"text-right font-medium",children:l.invoiced.toLocaleString()}),e.jsx("td",{className:"text-right font-medium",children:l.received.toLocaleString()}),e.jsx("td",{className:"text-right font-medium",children:l.outstanding.toLocaleString()})]})})]})}),r.length===0&&!n?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function KZ(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var m,p,g;try{o(!0);const x=await Z.get("/sales/reports/sales-profitability",{params:{from:t||null,to:r||null}});i(((m=x.data)==null?void 0:m.items)||[])}catch(x){ct.error(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Failed to load report")}finally{o(!1)}}function u(){const m=["Date","Invoice No","Customer","Net Sales","Cost","Gross Margin","Margin %"],p=(Array.isArray(n)?n:[]).map(j=>{const N=Number(j.net_sales||0)-Number(j.cost||0),_=Number(j.net_sales||0)?N/Number(j.net_sales||0)*100:0;return[j.invoice_date?new Date(j.invoice_date).toLocaleDateString():"-",j.invoice_no||"-",j.customer_name||"-",Number(j.net_sales||0).toFixed(2),Number(j.cost||0).toFixed(2),Number(N||0).toFixed(2),_.toFixed(2)]}),g=[m.join(","),...p.map(j=>j.join(","))].join(`
`),x=new Blob([g],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(x),y=document.createElement("a");y.href=b,y.download="sales_profitability.csv",y.click(),URL.revokeObjectURL(b)}function c(){const m=(Array.isArray(n)?n:[]).map(x=>{const b=Number(x.net_sales||0)-Number(x.cost||0),y=Number(x.net_sales||0)?b/Number(x.net_sales||0)*100:0;return{date:x.invoice_date?new Date(x.invoice_date).toLocaleDateString():"-",invoice_no:x.invoice_no||"-",customer:x.customer_name||"-",net_sales:Number(x.net_sales||0),cost:Number(x.cost||0),gross_margin:Number(b||0),margin_pct:Number(y.toFixed(2))}}),p=is.json_to_sheet(m),g=is.book_new();is.book_append_sheet(g,p,"SalesProfitability"),yr(g,"sales-profitability.xlsx")}function h(){const m=new hs("p","mm","a4");let p=15;m.setFontSize(14),m.text("Sales Profitability",10,p),p+=8,m.setFontSize(10);const g=["Date","Invoice No","Customer","Net Sales","Cost","Gross Margin","Margin %"];m.text(g[0],10,p),m.text(g[1],35,p),m.text(g[2],75,p),m.text(g[3],120,p),m.text(g[4],145,p),m.text(g[5],165,p),m.text(g[6],190,p,{align:"right"}),p+=4,m.line(10,p,200,p),p+=5,(Array.isArray(n)?n:[]).forEach(x=>{p>270&&(m.addPage(),p=15);const b=Number(x.net_sales||0)-Number(x.cost||0),y=Number(x.net_sales||0)?b/Number(x.net_sales||0)*100:0,j=x.invoice_date?new Date(x.invoice_date).toLocaleDateString():"-",N=String(x.invoice_no||"-"),_=String(x.customer_name||"-"),F=Number(x.net_sales||0).toFixed(2),I=Number(x.cost||0).toFixed(2),w=Number(b||0).toFixed(2),E=y.toFixed(2);m.text(j,10,p),m.text(N,35,p),m.text(_.slice(0,40),75,p),m.text(F,120,p),m.text(I,145,p),m.text(w,165,p),m.text(E,190,p,{align:"right"}),p+=5}),m.save("sales-profitability.pdf")}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Sales Profitability"}),e.jsx("p",{className:"text-sm mt-1",children:"Net sales vs cost with margins"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/sales",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("button",{type:"button",className:"btn-success",onClick:u,disabled:l||n.length===0,children:"Export CSV"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:c,disabled:l||n.length===0,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:h,disabled:l||n.length===0,children:"Export PDF"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:m=>s(m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:m=>a(m.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Invoice No"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{className:"text-right",children:"Net Sales"}),e.jsx("th",{className:"text-right",children:"Cost"}),e.jsx("th",{className:"text-right",children:"Gross Margin"}),e.jsx("th",{className:"text-right",children:"Margin %"})]})}),e.jsx("tbody",{children:n.map(m=>{const p=Number(m.net_sales||0)-Number(m.cost||0),g=Number(m.net_sales||0)?p/Number(m.net_sales||0)*100:0;return e.jsxs("tr",{children:[e.jsx("td",{children:m.invoice_date?new Date(m.invoice_date).toLocaleDateString():"-"}),e.jsx("td",{className:"font-medium",children:m.invoice_no||"-"}),e.jsx("td",{children:m.customer_name||"-"}),e.jsx("td",{className:"text-right",children:Number(m.net_sales||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(m.cost||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(p||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:g.toFixed(2)})]},m.id)})})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function zZ(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var m,p,g;try{o(!0);const x=await Z.get("/sales/reports/sales-tracking",{params:{from:t||null,to:r||null}});i(((m=x.data)==null?void 0:m.items)||[])}catch(x){ct.error(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Failed to load report")}finally{o(!1)}}function u(){const m=["Stage","Reference","Customer","Date","Status","Value"],p=(Array.isArray(n)?n:[]).map(j=>[j.stage||"-",j.ref_no||"-",j.customer_name||"-",j.txn_date?new Date(j.txn_date).toLocaleDateString():"-",j.status||"-",Number(j.total_value||0).toFixed(2)]),g=[m.join(","),...p.map(j=>j.join(","))].join(`
`),x=new Blob([g],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(x),y=document.createElement("a");y.href=b,y.download="sales_tracking.csv",y.click(),URL.revokeObjectURL(b)}function c(){const m=(Array.isArray(n)?n:[]).map(x=>({stage:x.stage||"-",reference:x.ref_no||"-",customer:x.customer_name||"-",date:x.txn_date?new Date(x.txn_date).toLocaleDateString():"-",status:x.status||"-",value:Number(x.total_value||0)})),p=is.json_to_sheet(m),g=is.book_new();is.book_append_sheet(g,p,"SalesTracking"),yr(g,"sales-tracking.xlsx")}function h(){const m=new hs("p","mm","a4");let p=15;m.setFontSize(14),m.text("Sales Tracking",10,p),p+=8,m.setFontSize(10);const g=["Stage","Reference","Customer","Date","Status","Value"];m.text(g[0],10,p),m.text(g[1],45,p),m.text(g[2],90,p),m.text(g[3],130,p),m.text(g[4],160,p),m.text(g[5],190,p,{align:"right"}),p+=4,m.line(10,p,200,p),p+=5,(Array.isArray(n)?n:[]).forEach(x=>{p>270&&(m.addPage(),p=15);const b=String(x.stage||"-"),y=String(x.ref_no||"-"),j=String(x.customer_name||"-"),N=x.txn_date?new Date(x.txn_date).toLocaleDateString():"-",_=String(x.status||"-"),F=Number(x.total_value||0).toFixed(2);m.text(b.slice(0,25),10,p),m.text(y.slice(0,30),45,p),m.text(j.slice(0,35),90,p),m.text(N,130,p),m.text(_,160,p),m.text(F,190,p,{align:"right"}),p+=5}),m.save("sales-tracking.pdf")}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Sales Tracking"}),e.jsx("p",{className:"text-sm mt-1",children:"Tracking across quotations, orders, deliveries, invoices"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/sales",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("button",{type:"button",className:"btn-success",onClick:u,disabled:l||n.length===0,children:"Export CSV"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:c,disabled:l||n.length===0,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:h,disabled:l||n.length===0,children:"Export PDF"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:m=>s(m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:m=>a(m.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Stage"}),e.jsx("th",{children:"Reference"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"text-right",children:"Value"})]})}),e.jsx("tbody",{children:n.map((m,p)=>e.jsxs("tr",{children:[e.jsx("td",{children:m.stage||"-"}),e.jsx("td",{className:"font-medium",children:m.ref_no||"-"}),e.jsx("td",{children:m.customer_name||"-"}),e.jsx("td",{children:m.txn_date?new Date(m.txn_date).toLocaleDateString():"-"}),e.jsx("td",{children:m.status||"-"}),e.jsx("td",{className:"text-right",children:Number(m.total_value||0).toLocaleString()})]},m.id||p))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}const gc=({label:t,path:s,type:r,featureKey:a,action:n})=>{const{canPerformAction:i}=Ls();if(!i(a,n))return null;const o=r==="primary"?"btn btn-primary btn-sm":"btn btn-outline btn-sm";return e.jsx(Re,{to:s,className:o,children:t})},YZ=()=>{const[t,s]=Is.useState([{rbac_key:"total-sales",icon:"",value:"GHS 5.2M",label:"Total Sales (YTD)",change:" 21.5% from last year",changeType:"positive",path:"/sales/reports"},{rbac_key:"open-orders",icon:"",value:"45",label:"Open Orders",change:"5 new today",changeType:"positive",path:"/sales/sales-orders"},{rbac_key:"pending-deliveries",icon:"",value:"12",label:"Pending Deliveries",change:"2 delayed",changeType:"negative",path:"/sales/delivery"}]);Is.useEffect(()=>{let a=!0;async function n(){var i,l,o,d,u,c,h,m,p;try{const g=await Z.get("/bi/dashboards"),x=Number(((o=(l=(i=g==null?void 0:g.data)==null?void 0:i.summary)==null?void 0:l.sales)==null?void 0:o.total)||0),b=Number(((c=(u=(d=g==null?void 0:g.data)==null?void 0:d.summary)==null?void 0:u.sales)==null?void 0:c.open_orders)||0),y=Number(((p=(m=(h=g==null?void 0:g.data)==null?void 0:h.summary)==null?void 0:m.sales)==null?void 0:p.pending_deliveries)||0);a&&s(j=>{const N=[...j];return N[0]={...N[0],value:`GHS ${Number(x).toLocaleString()}`,label:"Total Sales (Last 30 Days)"},N[1]={...N[1],value:String(b)},N[2]={...N[2],value:String(y)},N})}catch{}}return n(),()=>{a=!1}},[]);const r=[{title:"Sales Transactions",badge:"Operations",items:[{title:"Quotations",path:"/sales/quotations",description:"Create and manage customer quotations",icon:"",actions:[e.jsx(gc,{label:"View",path:"/sales/quotations",type:"outline",featureKey:"sales:quotations",action:"view"},"view"),e.jsx(gc,{label:"New",path:"/sales/quotations/new",type:"primary",featureKey:"sales:quotations",action:"create"},"new")]},{title:"Sales Orders",path:"/sales/sales-orders",description:"Process customer orders and track fulfillment",icon:"",actions:[e.jsx(gc,{label:"View",path:"/sales/sales-orders",type:"outline",featureKey:"sales:sales-orders",action:"view"},"view"),e.jsx(gc,{label:"New",path:"/sales/sales-orders/new",type:"primary",featureKey:"sales:sales-orders",action:"create"},"new")]},{title:"Invoices",path:"/sales/invoices",description:"Generate and manage sales invoices",icon:"",actions:[e.jsx(gc,{label:"View",path:"/sales/invoices",type:"outline",featureKey:"sales:invoices",action:"view"},"view"),e.jsx(gc,{label:"New",path:"/sales/invoices/new",type:"primary",featureKey:"sales:invoices",action:"create"},"new")]},{title:"Delivery Notes",path:"/sales/delivery",description:"Track product deliveries to customers",icon:"",actions:[e.jsx(gc,{label:"View",path:"/sales/delivery",type:"outline",featureKey:"sales:delivery",action:"view"},"view"),e.jsx(gc,{label:"New",path:"/sales/delivery/new",type:"primary",featureKey:"sales:delivery",action:"create"},"new")]}]},{title:"Pricing & Discounts",badge:"Configuration",items:[{title:"Price Setup",path:"/sales/price-setup",description:"Manage standard and customer pricing",icon:"",actions:[{label:"Manage",path:"/sales/price-setup",type:"primary"}]},{title:"Discount Schemes",path:"/sales/discount-schemes",description:"Configure discount rules and promotions",icon:"",actions:[{label:"Manage",path:"/sales/discount-schemes",type:"primary"}]}]},{title:"Customer Management",items:[{title:"Customers",path:"/sales/customers",description:"Manage customer information and credit limits",icon:"",actions:[e.jsx(gc,{label:"View",path:"/sales/customers",type:"outline",featureKey:"sales:customers",action:"view"},"view"),e.jsx(gc,{label:"Add",path:"/sales/customers/new",type:"primary",featureKey:"sales:customers",action:"create"},"add")]},{title:"Bulk Upload",path:"/sales/bulk-upload",description:"Import customers in bulk",icon:"",actions:[{label:"Upload",path:"/sales/bulk-upload",type:"primary"}]}]},{title:"Analytics & Reports",items:[{title:"Sales Reports",path:"/sales/reports",description:"View sales analytics and reports",icon:"",actions:[{label:"View Reports",path:"/sales/reports",type:"primary"}]},{title:"Sales Register",path:"/sales/reports/sales-register",description:"Invoices within the selected period",icon:""},{title:"Delivery Register",path:"/sales/reports/delivery-register",description:"Deliveries made to customers",icon:""},{title:"Sales Return Report",path:"/sales/reports/sales-return",description:"Items returned by customers",icon:""},{title:"Debtors Balance",path:"/sales/reports/debtors-balance",description:"Customer balances and outstanding",icon:""},{title:"Sales Profitability",path:"/sales/reports/sales-profitability",description:"Margins and profitability by invoice",icon:""},{title:"Sales Tracking",path:"/sales/reports/sales-tracking",description:"Track quotations  orders  deliveries  invoices",icon:""}]}];return e.jsx(lo,{title:"Sales Module",description:"Customer orders, quotations, invoicing, and sales analytics",stats:t,sections:r,features:JZ})};function XZ(){return e.jsxs(hl,{children:[e.jsx(tt,{path:"/",element:e.jsx(YZ,{})}),e.jsx(tt,{path:"/quotations",element:e.jsx(FH,{})}),e.jsx(tt,{path:"/quotations/new",element:e.jsx(V2,{})}),e.jsx(tt,{path:"/quotations/:id",element:e.jsx(V2,{})}),e.jsx(tt,{path:"/sales-orders",element:e.jsx(TH,{})}),e.jsx(tt,{path:"/sales-orders/new",element:e.jsx(W2,{})}),e.jsx(tt,{path:"/sales-orders/:id",element:e.jsx(W2,{})}),e.jsx(tt,{path:"/invoices",element:e.jsx(IH,{})}),e.jsx(tt,{path:"/invoices/new",element:e.jsx(G2,{})}),e.jsx(tt,{path:"/invoices/:id",element:e.jsx(G2,{})}),e.jsx(tt,{path:"delivery",element:e.jsx(PH,{})}),e.jsx(tt,{path:"delivery/new",element:e.jsx(z2,{})}),e.jsx(tt,{path:"delivery/:id",element:e.jsx(z2,{})}),e.jsx(tt,{path:"/price-setup",element:e.jsx(UZ,{})}),e.jsx(tt,{path:"/discount-schemes",element:e.jsx(RZ,{})}),e.jsx(tt,{path:"/customer-credit",element:e.jsx(OZ,{})}),e.jsx(tt,{path:"/customer-credit/:id",element:e.jsx(MZ,{})}),e.jsx(tt,{path:"/customers",element:e.jsx(QZ,{})}),e.jsx(tt,{path:"/customers/new",element:e.jsx(nC,{})}),e.jsx(tt,{path:"/customers/:id",element:e.jsx(nC,{})}),e.jsx(tt,{path:"/bulk-upload",element:e.jsx(HZ,{})}),e.jsx(tt,{path:"/reports",element:e.jsx(qZ,{})}),e.jsx(tt,{path:"/reports/sales-return",element:e.jsx($Z,{})}),e.jsx(tt,{path:"/reports/sales-register",element:e.jsx(VZ,{})}),e.jsx(tt,{path:"/reports/delivery-register",element:e.jsx(WZ,{})}),e.jsx(tt,{path:"/reports/debtors-balance",element:e.jsx(GZ,{})}),e.jsx(tt,{path:"/reports/sales-profitability",element:e.jsx(KZ,{})}),e.jsx(tt,{path:"/reports/sales-tracking",element:e.jsx(zZ,{})}),e.jsx(tt,{path:"/returns",element:e.jsx(lF,{})})]})}const JZ=[{module_key:"sales",label:"Quotations",path:"/sales/quotations",type:"feature"},{module_key:"sales",label:"Sales Orders",path:"/sales/sales-orders",type:"feature"},{module_key:"sales",label:"Invoices",path:"/sales/invoices",type:"feature"},{module_key:"sales",label:"Delivery Notes",path:"/sales/delivery",type:"feature"},{module_key:"sales",label:"Price Setup",path:"/sales/price-setup",type:"feature"},{module_key:"sales",label:"Discount Schemes",path:"/sales/discount-schemes",type:"feature"},{module_key:"sales",label:"Customer Setup",path:"/sales/customers",type:"feature"},{module_key:"sales",label:"Bulk Upload",path:"/sales/bulk-upload",type:"feature"},{module_key:"sales",label:"Sales Reports",path:"/sales/reports",type:"dashboard"},{module_key:"sales",label:"Sales Register",path:"/sales/reports/sales-register",type:"dashboard"},{module_key:"sales",label:"Delivery Register",path:"/sales/reports/delivery-register",type:"dashboard"},{module_key:"sales",label:"Sales Return Report",path:"/sales/reports/sales-return",type:"dashboard"},{module_key:"sales",label:"Debtors Balance",path:"/sales/reports/debtors-balance",type:"dashboard"},{module_key:"sales",label:"Sales Profitability",path:"/sales/reports/sales-profitability",type:"dashboard"},{module_key:"sales",label:"Sales Tracking",path:"/sales/reports/sales-tracking",type:"dashboard"},{module_key:"sales",label:"Sales Returns",path:"/sales/returns",type:"feature"}];function ZZ(){const{canPerformAction:t}=Ls(),[s,r]=f.useState(""),[a,n]=f.useState([]),[i,l]=f.useState(!1),[o,d]=f.useState(""),[u,c]=f.useState(!1),[h,m]=f.useState(null),[p,g]=f.useState(!1),[x,b]=f.useState(""),[y,j]=f.useState(null),[N,_]=f.useState(null),[F,I]=f.useState([]),[w,E]=f.useState(!1),[W,R]=f.useState(null),[U,T]=f.useState(null),[Y,H]=f.useState(!1);f.useEffect(()=>{let C=!0;return l(!0),d(""),Z.get("/inventory/stock-adjustments").then(k=>{var B;C&&n(Array.isArray((B=k.data)==null?void 0:B.items)?k.data.items:[])}).catch(k=>{var B,G;C&&d(((G=(B=k==null?void 0:k.response)==null?void 0:B.data)==null?void 0:G.message)||"Failed to load stock adjustments")}).finally(()=>{C&&l(!1)}),()=>{C=!1}},[]);const M=C=>({DRAFT:"badge-info",PENDING_APPROVAL:"badge-warning",APPROVED:"badge-success",POSTED:"badge-success",REJECTED:"badge-error",CANCELLED:"badge-error",RETURNED:"badge-error"})[C]||"badge-info",q=f.useMemo(()=>a.filter(C=>String(C.adjustment_no||"").toLowerCase().includes(s.toLowerCase())),[a,s]),z=C=>{if(!C)return"";let k=new Date(C);return isNaN(k.getTime())&&(isNaN(Number(C))||(k=new Date(Number(C)))),isNaN(k.getTime())?String(C):k.toLocaleDateString()},Q=async C=>{var k,B,G;if(m(C),c(!0),b(""),W)await L();else try{g(!0);const O=await Z.get("/workflows"),K=Array.isArray((k=O.data)==null?void 0:k.items)?O.data.items:[];R(K),await V(K)}catch(O){b(((G=(B=O==null?void 0:O.response)==null?void 0:B.data)==null?void 0:G.message)||"Failed to load workflows")}finally{g(!1)}},L=async()=>{var K,J,te;if(!W||!W.length){j(null),_(null),b(""),H(!1);return}const C="/inventory/stock-adjustments",k=se=>String(se||"").trim().toUpperCase().replace(/\s+/g,"_"),G=W.filter(se=>String(se.document_route)===C||k(se.document_type)==="STOCK_ADJUSTMENT").some(se=>Number(se.is_active)===0),O=W.find(se=>Number(se.is_active)===1&&String(se.document_route)===C)||W.find(se=>Number(se.is_active)===1&&k(se.document_type)==="STOCK_ADJUSTMENT")||null;if(j(O||null),H(!O&&G),_(null),!!O)try{g(!0);const ae=(K=(await Z.get(`/workflows/${O.id}`)).data)==null?void 0:K.item,ne=Array.isArray(ae==null?void 0:ae.steps)?ae.steps:[];I(ne);const ue=ne[0]||null;if(_(ue?{userId:ue.approver_user_id,name:ue.approver_name,stepName:ue.step_name,stepOrder:ue.step_order,approvalLimit:ue.approval_limit}:null),ue){const oe=(Array.isArray(ue.approvers)&&ue.approvers.length?ue.approvers[0].id:ue.approver_user_id)||null;T(oe)}else T(null)}catch(se){b(((te=(J=se==null?void 0:se.response)==null?void 0:J.data)==null?void 0:te.message)||"Failed to load workflow details")}finally{g(!1)}},V=async C=>{var J,te,se;if(!C||!C.length){j(null),_(null),b(""),H(!1);return}const k="/inventory/stock-adjustments",B=ae=>String(ae||"").trim().toUpperCase().replace(/\s+/g,"_"),O=C.filter(ae=>String(ae.document_route)===k||B(ae.document_type)==="STOCK_ADJUSTMENT").some(ae=>Number(ae.is_active)===0),K=C.find(ae=>Number(ae.is_active)===1&&String(ae.document_route)===k)||C.find(ae=>Number(ae.is_active)===1&&B(ae.document_type)==="STOCK_ADJUSTMENT")||null;if(j(K||null),H(!K&&O),_(null),!!K)try{g(!0);const ne=(J=(await Z.get(`/workflows/${K.id}`)).data)==null?void 0:J.item,ue=Array.isArray(ne==null?void 0:ne.steps)?ne.steps:[];I(ue);const oe=ue[0]||null;_(oe?{userId:oe.approver_user_id,name:oe.approver_name,stepName:oe.step_name,stepOrder:oe.step_order,approvalLimit:oe.approval_limit}:null)}catch(ae){b(((se=(te=ae==null?void 0:ae.response)==null?void 0:te.data)==null?void 0:se.message)||"Failed to load workflow details")}finally{g(!1)}},P=async()=>{var C,k,B;if(h){E(!0),b("");try{const G=await Z.post(`/inventory/stock-adjustments/${h.id}/submit`,{amount:null,workflow_id:y?y.id:null,target_user_id:U||null}),O=((C=G==null?void 0:G.data)==null?void 0:C.status)||"PENDING_APPROVAL";n(K=>K.map(J=>J.id===h.id?{...J,status:O}:J)),c(!1),m(null)}catch(G){b(((B=(k=G==null?void 0:G.response)==null?void 0:k.data)==null?void 0:B.message)||"Failed to forward for approval")}finally{E(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Stock Adjustments"}),e.jsx("p",{className:"text-sm mt-1",children:"Adjust stock quantities for corrections and reconciliation"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/inventory/stock-adjustments/new",className:"btn-success",children:"+ New Adjustment"})]})]})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by adjustment number...",className:"input max-w-md",value:s,onChange:C=>r(C.target.value)})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Adjustment No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Warehouse"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[i?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):o?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-red-600",children:o})}):null,q.map(C=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:C.adjustment_no}),e.jsx("td",{children:z(C.adjustment_date)}),e.jsx("td",{children:e.jsx("span",{className:`badge ${C.adjustment_type==="INCREASE"?"badge-success":"badge-warning"}`,children:C.adjustment_type})}),e.jsx("td",{children:C.warehouse_name||"-"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${M(C.status)} `,children:C.status})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2 items-center",children:[t("inventory:stock-adjustment","view")&&e.jsx(Re,{to:`/inventory/stock-adjustments/${C.id}?mode=view`,className:"text-brand hover:text-brand-700 text-sm font-medium",children:"View"}),t("inventory:stock-adjustment","edit")&&e.jsx(Re,{to:`/inventory/stock-adjustments/${C.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Edit"}),C.status==="APPROVED"?e.jsx("span",{className:"text-sm font-medium px-2 py-1 rounded bg-green-500 text-white",children:"Approved"}):C.status==="DRAFT"||C.status==="RETURNED"?e.jsx("button",{type:"button",onClick:()=>Q(C),className:"text-sm font-medium px-2 py-1 rounded bg-blue-600 text-white hover:bg-blue-700 transition-colors",disabled:Y,children:"Forward"}):null]})})]},C.id))]})]})})]})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-erp w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-brand text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Forward for Approval"}),e.jsx("button",{onClick:()=>{c(!1),m(null),j(null),_(null),b("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Document No:"," ",e.jsx("span",{className:"font-semibold",children:h==null?void 0:h.adjustment_no})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:y?`${y.workflow_name} (${y.workflow_code})`:"None (inactive)"})]}),e.jsxs("div",{children:[p?e.jsx("div",{className:"text-sm",children:"Loading workflow..."}):null,x?e.jsx("div",{className:"text-sm text-red-600",children:x}):null]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Target Approver"}),(()=>{const k=Array.isArray(F)&&F.length>0?F[0]:null,B=k?Array.isArray(k.approvers)&&k.approvers.length?k.approvers.map(G=>({id:G.id,name:G.username})):k.approver_user_id?[{id:k.approver_user_id,name:k.approver_name||String(k.approver_user_id)}]:[]:[];return B.length>0?e.jsxs("div",{className:"mt-1",children:[e.jsxs("select",{className:"input w-full",value:U||"",onChange:G=>T(G.target.value?Number(G.target.value):null),children:[e.jsx("option",{value:"",children:"Select target approver"}),B.map(G=>e.jsx("option",{value:G.id,children:G.name},G.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:N?`Step ${N.stepOrder}  ${N.stepName}${N.approvalLimit!=null?`  Limit: ${Number(N.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:y?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})()]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{c(!1),m(null),j(null),_(null),b("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:P,disabled:w,children:w?"Forwarding...":"Forward"})]})]})})]})}function iC(){const{uoms:t,loading:s}=$i(),{id:r}=Ps(),a=ps(),n=!r||r==="new",[i]=Vf(),l=(i.get("mode")||"").toLowerCase(),o=!n&&l==="view",[d,u]=f.useState(!1),[c,h]=f.useState(!1),[m,p]=f.useState(""),[g,x]=f.useState([]),[b,y]=f.useState([]),[j,N]=f.useState({adjustmentNo:"",adjustmentDate:new Date().toISOString().split("T")[0],warehouseId:"",adjustmentType:"PHYSICAL_COUNT",referenceDoc:"",reason:"",status:"DRAFT"}),[_,F]=f.useState([]),[I,w]=f.useState([]),[E,W]=f.useState({open:!1,itemId:null,defaultUom:"",currentUom:"",rowId:null}),R=f.useMemo(()=>{const Q=Array.isArray(t)?t:[],L=Q.find(V=>String(V.uom_code||"").toUpperCase()==="PCS")||Q[0];return L&&L.uom_code?L.uom_code:"PCS"},[t]);f.useMemo(()=>{const Q=new Map;for(const L of Array.isArray(I)?I:[]){if(!Number(L.is_active))continue;const V=`${L.item_id}|${L.from_uom}|${L.to_uom}`,P=Number(L.conversion_factor||0);Number.isFinite(P)&&P>0&&Q.set(V,P)}return Q},[I]),f.useEffect(()=>{let Q=!0;return Promise.all([Z.get("/inventory/items"),Z.get("/inventory/warehouses"),Z.get("/inventory/unit-conversions")]).then(([L,V,P])=>{var C,k,B;Q&&(x(Array.isArray((C=L.data)==null?void 0:C.items)?L.data.items:[]),y(Array.isArray((k=V.data)==null?void 0:k.items)?V.data.items:[]),w(Array.isArray((B=P.data)==null?void 0:B.items)?P.data.items:[]))}).catch(L=>{var V,P;Q&&p(((P=(V=L==null?void 0:L.response)==null?void 0:V.data)==null?void 0:P.message)||"Failed to load lookups")}),()=>{Q=!1}},[]),f.useEffect(()=>{n&&Z.get("/inventory/stock-adjustments/next-no").then(Q=>{var L;(L=Q.data)!=null&&L.next_no&&N(V=>({...V,adjustmentNo:Q.data.next_no}))}).catch(()=>{})},[n]),f.useEffect(()=>{if(n){F([{id:Date.now(),item_id:"",itemCode:"",itemName:"",currentStock:0,adjustedStock:0,uom:"",unitCost:0,remarks:""}]);return}let Q=!0;return u(!0),p(""),Z.get(`/inventory/stock-adjustments/${r}`).then(L=>{var C,k;if(!Q)return;const V=(C=L.data)==null?void 0:C.item,P=Array.isArray((k=L.data)==null?void 0:k.details)?L.data.details:[];V&&(N({adjustmentNo:V.adjustment_no||"",adjustmentDate:V.adjustment_date?new Date(V.adjustment_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],warehouseId:V.warehouse_id?String(V.warehouse_id):"",adjustmentType:V.adjustment_type||"PHYSICAL_COUNT",referenceDoc:V.reference_doc||"",reason:V.reason||"",status:V.status||"DRAFT"}),F(P.length?P.map(B=>({id:B.id||Date.now()+Math.random(),item_id:B.item_id?String(B.item_id):"",itemCode:B.item_code||"",itemName:B.item_name||"",currentStock:Number(B.current_stock)||0,adjustedStock:Number(B.adjusted_stock)||0,uom:"PCS",unitCost:Number(B.unit_cost)||0,remarks:B.remarks||""})):[]))}).catch(L=>{var V,P;Q&&p(((P=(V=L==null?void 0:L.response)==null?void 0:V.data)==null?void 0:P.message)||"Failed to load stock adjustment")}).finally(()=>{Q&&u(!1)}),()=>{Q=!1}},[r,n]);const U=f.useMemo(()=>_.filter(Q=>Q.item_id).map(Q=>({item_id:Number(Q.item_id),current_stock:Number(Q.currentStock)||0,adjusted_stock:Number(Q.adjustedStock)||0,qty:Number(Q.adjustedStock)-Number(Q.currentStock),unit_cost:Number(Q.unitCost)||0,remarks:Q.remarks})),[_]),T=async Q=>{var L,V;Q.preventDefault(),h(!0),p("");try{const P={adjustment_no:j.adjustmentNo||void 0,adjustment_date:j.adjustmentDate,warehouse_id:j.warehouseId?Number(j.warehouseId):null,adjustment_type:j.adjustmentType,reference_doc:j.referenceDoc,reason:j.reason,status:j.status,details:U};n?await Z.post("/inventory/stock-adjustments",P):await Z.put(`/inventory/stock-adjustments/${r}`,P),a("/inventory/stock-adjustments")}catch(P){p(((V=(L=P==null?void 0:P.response)==null?void 0:L.data)==null?void 0:V.message)||"Failed to save stock adjustment")}finally{h(!1)}},Y=()=>{F([..._,{id:Date.now(),item_id:"",itemCode:"",itemName:"",currentStock:0,adjustedStock:0,uom:"",unitCost:0,remarks:""}])},H=Q=>{F(_.filter(L=>L.id!==Q))},M=(Q,L,V)=>{F(_.map(P=>{if(P.id===Q){const C={...P,[L]:V};if(L==="item_id"){const k=g.find(B=>String(B.id)===String(V));C.itemCode=(k==null?void 0:k.item_code)||"",C.itemName=(k==null?void 0:k.item_name)||"",C.unitCost=(k==null?void 0:k.cost_price)||0}return C}return P}))},q=Q=>{N(L=>({...L,reason:Q}))},z=Q=>{const L="border-2 rounded-lg p-4 cursor-pointer transition-all text-center hover:shadow-md",V=j.adjustmentType===Q?" ring-2 ring-brand-500 bg-brand-50 border-brand-500":" border-slate-200 bg-white";return Q==="INCREASE"?`${L} ${V} ${j.adjustmentType===Q?"border-green-500 ring-green-500 bg-green-50":"hover:border-green-200"}`:Q==="DECREASE"?`${L} ${V} ${j.adjustmentType===Q?"border-red-500 ring-red-500 bg-red-50":"hover:border-red-200"}`:`${L} ${V}`};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:n?"New Stock Adjustment":o?"View Stock Adjustment":"Edit Stock Adjustment"}),e.jsx("p",{className:"text-sm mt-1",children:"Adjust stock quantities for corrections"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(Re,{to:"/inventory/stock-adjustments",className:"btn-success bg-green-600 text-white hover:bg-green-700 px-6 py-2 rounded shadow-sm font-medium",children:" Back to List"})})]})}),e.jsx("div",{className:"card-body p-6",children:e.jsxs("form",{onSubmit:T,className:"space-y-8",children:[d&&e.jsx("div",{className:"text-sm",children:"Loading..."}),m&&e.jsx("div",{className:"p-4 bg-red-50 text-red-600 rounded-md border border-red-200",children:m}),e.jsxs("fieldset",{disabled:o,className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4 border-b pb-2",children:" Select Adjustment Type"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:z("PHYSICAL_COUNT"),onClick:()=>N({...j,adjustmentType:"PHYSICAL_COUNT"}),children:[e.jsx("div",{className:"text-3xl mb-2",children:""}),e.jsx("div",{className:"font-bold text-slate-700",children:"Physical Count"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Based on actual inventory count"})]}),e.jsxs("div",{className:z("INCREASE"),onClick:()=>N({...j,adjustmentType:"INCREASE"}),children:[e.jsx("div",{className:"text-3xl mb-2",children:""}),e.jsx("div",{className:"font-bold text-slate-700",children:"Stock Increase"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Add stock (found, corrections)"})]}),e.jsxs("div",{className:z("DECREASE"),onClick:()=>N({...j,adjustmentType:"DECREASE"}),children:[e.jsx("div",{className:"text-3xl mb-2",children:""}),e.jsx("div",{className:"font-bold text-slate-700",children:"Stock Decrease"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Reduce stock (damage, theft)"})]}),e.jsxs("div",{className:z("OTHER"),onClick:()=>N({...j,adjustmentType:"OTHER"}),children:[e.jsx("div",{className:"text-3xl mb-2",children:""}),e.jsx("div",{className:"font-bold text-slate-700",children:"Other Adjustment"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Miscellaneous adjustments"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4 border-b pb-2",children:" Adjustment Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Adjustment No"}),e.jsx("input",{type:"text",className:"input bg-slate-100",value:j.adjustmentNo,disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Adjustment Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",className:"input",value:j.adjustmentDate,onChange:Q=>N({...j,adjustmentDate:Q.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Warehouse"}),e.jsxs("select",{className:"input",value:j.warehouseId,onChange:Q=>N({...j,warehouseId:Q.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Warehouse --"}),b.map(Q=>e.jsx("option",{value:Q.id,children:Q.warehouse_name},Q.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Adjustment Type"}),e.jsx("input",{type:"text",className:"input bg-slate-100",value:j.adjustmentType,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Reference Document"}),e.jsx("input",{type:"text",className:"input",placeholder:"e.g., PC-2024-001",value:j.referenceDoc,onChange:Q=>N({...j,referenceDoc:Q.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${j.status==="DRAFT"?"bg-slate-200 text-slate-700":"bg-green-100 text-green-700"}`,children:j.status})})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Adjustment Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{className:"input",rows:"2",placeholder:"Provide detailed reason for this adjustment...",value:j.reason,onChange:Q=>N({...j,reason:Q.target.value}),required:!0}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:["Physical count variance","Damaged goods","Expired items","Theft/Loss","Found items","System error correction","Other"].map(Q=>e.jsx("button",{type:"button",onClick:()=>q(Q),className:`px-3 py-1 rounded-full text-xs border ${j.reason===Q?"bg-brand-500 text-white border-brand-500":"bg-white text-slate-600 border-slate-300 hover:bg-slate-50"}`,children:Q},Q))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 border-b pb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800",children:" Adjustment Items"}),e.jsx("button",{type:"button",onClick:Y,className:"btn-primary text-sm px-3 py-1 rounded bg-brand-600 text-white hover:bg-brand-700",children:"+ Add Item"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-100 text-slate-700 uppercase font-bold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Item"}),e.jsx("th",{className:"p-3 w-24",children:"Current Stock"}),e.jsx("th",{className:"p-3 w-40",children:"Adjusted Stock"}),e.jsx("th",{className:"p-3 w-24",children:"Diff"}),e.jsx("th",{className:"p-3 w-20",children:"UOM"}),e.jsx("th",{className:"p-3 w-24",children:"Unit Cost"}),e.jsx("th",{className:"p-3 w-28",children:"Impact"}),e.jsx("th",{className:"p-3",children:"Remarks"}),e.jsx("th",{className:"p-3 w-16"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-200",children:[_.map(Q=>{const L=Number(Q.adjustedStock)-Number(Q.currentStock),V=L*Number(Q.unitCost);return e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"p-2",children:e.jsxs("select",{className:"input text-sm py-1",value:Q.item_id,onChange:P=>M(Q.id,"item_id",P.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Item"}),g.map(P=>e.jsxs("option",{value:P.id,children:[P.item_code," - ",P.item_name]},P.id))]})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"input text-sm py-1 bg-slate-50",value:Q.currentStock,onChange:P=>M(Q.id,"currentStock",P.target.value)})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"number",className:"input text-sm py-1 font-bold w-36",value:Q.adjustedStock,onChange:P=>M(Q.id,"adjustedStock",P.target.value)}),(()=>{const P=g.find(O=>String(O.id)===String(Q.item_id)),C=(P==null?void 0:P.uom)&&String(P.uom)||Q.uom&&String(Q.uom)||(R?String(R):""),k=(Array.isArray(I)?I:[]).filter(O=>Number(O.is_active)&&Number(O.item_id)===Number(Q.item_id)&&String(O.to_uom)===C).map(O=>String(O.from_uom)),B=Q.uom&&String(Q.uom)!==C?String(Q.uom):k[0]||"";return k.length>0&&B&&B!==C?e.jsx("button",{type:"button",className:"px-2 py-1 text-xs border border-brand text-brand rounded hover:bg-brand hover:text-white transition-colors",onClick:()=>W({open:!0,itemId:Q.item_id,defaultUom:C,currentUom:B,rowId:Q.id}),children:`number of ${B}`}):null})()]})}),e.jsx("td",{className:"p-2 font-bold",children:e.jsxs("span",{className:L>0?"text-green-600":L<0?"text-red-600":"text-slate-400",children:[L>0?"+":"",L]})}),e.jsx("td",{className:"p-2",children:e.jsx("select",{className:"input text-sm py-1",value:Q.uom,onChange:P=>M(Q.id,"uom",P.target.value),children:s?e.jsx("option",{children:"Loading..."}):t.map(P=>e.jsx("option",{value:P.uom_code,children:P.uom_code},P.id))})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"input text-sm py-1",value:Q.unitCost,onChange:P=>M(Q.id,"unitCost",P.target.value)})}),e.jsx("td",{className:"p-2 font-medium",children:V.toFixed(2)}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"text",className:"input text-sm py-1",placeholder:"Optional",value:Q.remarks,onChange:P=>M(Q.id,"remarks",P.target.value)})}),e.jsx("td",{className:"p-2 text-center",children:e.jsx("button",{type:"button",onClick:()=>H(Q.id),className:"text-red-500 hover:text-red-700",children:""})})]},Q.id)}),_.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"p-8 text-center text-slate-500",children:'No items added. Click "Add Item" to begin.'})})]})]})})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200",children:[e.jsx("h4",{className:"font-bold text-slate-700 mb-2",children:" Adjustment Impact Summary"}),e.jsxs("div",{className:"flex gap-8 text-sm",children:[e.jsxs("div",{children:["Total Items Adjusted:"," ",e.jsx("span",{className:"font-bold text-brand-700",children:_.length})]}),e.jsxs("div",{children:["Net Qty Change:"," ",e.jsx("span",{className:"font-bold text-brand-700",children:_.reduce((Q,L)=>Q+(Number(L.adjustedStock)-Number(L.currentStock)),0)})]}),e.jsxs("div",{children:["Total Value Impact:"," ",e.jsx("span",{className:"font-bold text-brand-700",children:_.reduce((Q,L)=>Q+(Number(L.adjustedStock)-Number(L.currentStock))*Number(L.unitCost),0).toFixed(2)})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-200",children:[e.jsx(Re,{to:"/inventory/stock-adjustments",className:"btn-light bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded",children:"Cancel"}),o?null:e.jsx("button",{type:"submit",className:"btn-success bg-green-600 text-white hover:bg-green-700 px-6 py-2 rounded shadow-sm font-medium",children:c?"Saving...":"Save Adjustment"})]})]})})]}),e.jsx(Ic,{open:E.open,onClose:()=>W({open:!1,itemId:null,defaultUom:"",currentUom:"",rowId:null}),itemId:E.itemId?Number(E.itemId):null,defaultUom:String(E.defaultUom||""),currentUom:String(E.currentUom||""),conversions:I,onApply:({converted_qty:Q})=>{const L=E.rowId;L!=null&&M(L,"adjustedStock",Q)}})]})}function eee(){const{canPerformAction:t}=Ls(),[s,r]=f.useState(""),[a,n]=f.useState([]),[i,l]=f.useState(!1),[o,d]=f.useState("");f.useEffect(()=>{let h=!0;return l(!0),d(""),Z.get("/inventory/stock-transfers").then(m=>{var p;h&&n(Array.isArray((p=m.data)==null?void 0:p.items)?m.data.items:[])}).catch(m=>{var p,g;h&&d(((g=(p=m==null?void 0:m.response)==null?void 0:p.data)==null?void 0:g.message)||"Failed to load stock transfers")}).finally(()=>{h&&l(!1)}),()=>{h=!1}},[]);const u=h=>({DRAFT:"badge-info",IN_TRANSIT:"badge-warning",RECEIVED:"badge-success",CANCELLED:"badge-error"})[h]||"badge-info",c=f.useMemo(()=>a.filter(h=>`${h.transfer_no||""} ${h.from_branch||""} ${h.to_branch||""}`.toLowerCase().includes(s.toLowerCase())),[a,s]);return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Stock Transfers"}),e.jsx("p",{className:"text-sm mt-1",children:"Transfer stock between warehouses and branches"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/inventory/stock-transfers/new",className:"btn-success",children:"+ New Transfer"})]})]})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by transfer number, from or to branch...",className:"input max-w-md",value:s,onChange:h=>r(h.target.value)})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Transfer No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"From Branch"}),e.jsx("th",{children:"To Branch"}),e.jsx("th",{children:"Items"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[i?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):o?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-8 text-red-600",children:o})}):null,c.map(h=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:h.transfer_no}),e.jsx("td",{children:h.transfer_date}),e.jsx("td",{children:h.from_branch}),e.jsx("td",{children:h.to_branch}),e.jsx("td",{children:h.item_count}),e.jsx("td",{children:e.jsx("span",{className:`badge ${u(h.status)}`,children:h.status})}),e.jsxs("td",{children:[t("inventory:stock-transfers","view")&&e.jsx(Re,{to:`/inventory/stock-transfers/${h.id}?mode=view`,className:"text-brand hover:text-brand-700 text-sm font-medium",children:"View"}),t("inventory:stock-transfers","edit")&&e.jsx(Re,{to:`/inventory/stock-transfers/${h.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"})]})]},h.id))]})]})})]})]})})}function tee(){const{uoms:t,loading:s}=$i(),{id:r}=Ps(),a=ps(),n=r==="new",[i,l]=f.useState(!1),[o,d]=f.useState(!1),[u,c]=f.useState(""),[h,m]=f.useState([]),[p,g]=f.useState([]),[x,b]=f.useState([]),[y,j]=f.useState([]),[N,_]=f.useState([]),[F,I]=f.useState({transferNo:n?"Auto-generated":"ST-2024-001",transferDate:new Date().toISOString().split("T")[0],transferType:"INTER_WAREHOUSE",deliveryDate:"",driverName:"",vehicleNo:"",fromBranchId:"",toBranchId:"",fromWarehouseId:"",toWarehouseId:"",remarks:"",status:"DRAFT"}),[w,E]=f.useState([{id:1,item_id:"",itemCode:"",itemName:"",qty:0,uom:"PCS",batchNumber:"",remarks:""}]);f.useEffect(()=>{let H=!0;return(async()=>{var q,z,Q,L,V;try{const[P,C,k]=await Promise.all([Z.get("/inventory/items"),Z.get("/admin/branches"),Z.get("/inventory/warehouses")]);H&&(m(Array.isArray((q=P.data)==null?void 0:q.items)?P.data.items:[]),g(Array.isArray((z=C.data)==null?void 0:z.items)?C.data.items:[]),b(Array.isArray((Q=k.data)==null?void 0:Q.items)?k.data.items:[]))}catch(P){H&&c(((V=(L=P==null?void 0:P.response)==null?void 0:L.data)==null?void 0:V.message)||"Failed to load initial data")}})(),()=>{H=!1}},[]),f.useEffect(()=>{if(!n)return;let H=!0;return Z.get("/inventory/stock-transfers/next-no").then(M=>{var z;if(!H)return;const q=(z=M.data)==null?void 0:z.next_no;q&&I(Q=>({...Q,transferNo:q}))}).catch(()=>{}),()=>{H=!1}},[n]),f.useEffect(()=>{if(n)return;let H=!0;return l(!0),c(""),Z.get(`/inventory/stock-transfers/${r}`).then(M=>{var Q,L;if(!H)return;const q=(Q=M.data)==null?void 0:Q.item,z=Array.isArray((L=M.data)==null?void 0:L.details)?M.data.details:[];q&&(I({transferNo:q.transfer_no||"",transferDate:q.transfer_date?typeof q.transfer_date=="string"?q.transfer_date.split("T")[0]:new Date(q.transfer_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],transferType:q.transfer_type||"INTER_WAREHOUSE",deliveryDate:q.delivery_date?q.delivery_date.split("T")[0]:"",driverName:q.driver_name||"",vehicleNo:q.vehicle_no||"",fromBranchId:q.from_branch_id?String(q.from_branch_id):"",toBranchId:q.to_branch_id?String(q.to_branch_id):"",remarks:q.remarks||"",status:q.status||"DRAFT"}),E(z.length?z.map(V=>({id:V.id||Date.now()+Math.random(),item_id:V.item_id?String(V.item_id):"",itemCode:V.item_code||"",itemName:V.item_name||"",qty:Number(V.qty)||0,uom:V.uom||"PCS",batchNumber:V.batch_number||"",remarks:V.remarks||""})):[{id:1,item_id:"",itemCode:"",itemName:"",qty:0,uom:"PCS",batchNumber:"",remarks:""}]))}).catch(M=>{var q,z;H&&c(((z=(q=M==null?void 0:M.response)==null?void 0:q.data)==null?void 0:z.message)||"Failed to load stock transfer")}).finally(()=>{H&&l(!1)}),()=>{H=!1}},[r,n]),f.useEffect(()=>{if(F.transferType!=="INTER_BRANCH"){j([]);return}const H=Number(F.fromBranchId);if(!H){j([]);return}const M=p.find(z=>String(z.id)===String(H)),q=M?Number(M.company_id):void 0;Z.get("/inventory/warehouses",{headers:{"x-branch-id":String(H),...q?{"x-company-id":String(q)}:{}}}).then(z=>{var L;const Q=Array.isArray((L=z.data)==null?void 0:L.items)?z.data.items:[];j(Q)}).catch(()=>{j([])})},[F.transferType,F.fromBranchId,p]),f.useEffect(()=>{if(F.transferType!=="INTER_BRANCH"){_([]);return}const H=Number(F.toBranchId);if(!H){_([]);return}const M=p.find(z=>String(z.id)===String(H)),q=M?Number(M.company_id):void 0;Z.get("/inventory/warehouses",{headers:{"x-branch-id":String(H),...q?{"x-company-id":String(q)}:{}}}).then(z=>{var L;const Q=Array.isArray((L=z.data)==null?void 0:L.items)?z.data.items:[];_(Q)}).catch(()=>{_([])})},[F.transferType,F.toBranchId,p]),f.useEffect(()=>{I(H=>String(H.fromBranchId)?H:{...H,fromWarehouseId:""})},[F.fromBranchId]),f.useEffect(()=>{I(H=>String(H.toBranchId)?H:{...H,toWarehouseId:""})},[F.toBranchId]);const W=f.useMemo(()=>w.filter(H=>H.item_id).map(H=>({item_id:Number(H.item_id),qty:Number(H.qty)||0,batch_number:H.batchNumber,remarks:H.remarks})),[w]),R=async H=>{var M,q;H.preventDefault(),d(!0),c("");try{const z=F.transferType==="INTER_BRANCH",Q=F.transferType==="INTER_WAREHOUSE",L=Q?Number(F.fromBranchId)||null:Number(F.fromWarehouseId)||null,V=Q?Number(F.toBranchId)||null:Number(F.toWarehouseId)||null;let P=Number(F.fromBranchId)||null,C=Number(F.toBranchId)||null;if(Q){const B=x.find(O=>String(O.id)===String(L)),G=x.find(O=>String(O.id)===String(V));P=B&&B.branch_id?Number(B.branch_id):P,C=G&&G.branch_id?Number(G.branch_id):C}const k={transfer_no:n?void 0:F.transferNo,transfer_date:F.transferDate,transfer_type:F.transferType,delivery_date:F.deliveryDate,driver_name:F.driverName||null,vehicle_no:F.vehicleNo||null,from_branch_id:P,to_branch_id:C,from_warehouse_id:L,to_warehouse_id:V,status:F.status,remarks:F.remarks,details:W};n?await Z.post("/inventory/stock-transfers",k):await Z.put(`/inventory/stock-transfers/${r}`,k),a("/inventory/stock-transfers")}catch(z){c(((q=(M=z==null?void 0:z.response)==null?void 0:M.data)==null?void 0:q.message)||"Failed to save stock transfer")}finally{d(!1)}},U=()=>{E([...w,{id:Date.now(),item_id:"",itemCode:"",itemName:"",qty:0,uom:"PCS",batchNumber:"",remarks:""}])},T=H=>{E(w.filter(M=>M.id!==H))},Y=H=>{if(!H)return"";if(F.transferType==="INTER_WAREHOUSE"){const q=x.find(z=>String(z.id)===String(H));return q?q.warehouse_name:""}const M=p.find(q=>String(q.id)===String(H));return M?M.name:""};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:n?"New Stock Transfer":"Edit Stock Transfer"}),e.jsx("p",{className:"text-sm mt-1",children:"Transfer stock between warehouses and branches"})]}),e.jsx(Re,{to:"/inventory/stock-transfers",className:"btn-success",children:"Back to List"})]})}),e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[i?e.jsx("div",{className:"text-sm",children:"Loading..."}):null,u?e.jsx("div",{className:"text-sm text-red-600",children:u}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Transfer No"}),e.jsx("input",{type:"text",className:"input bg-slate-100 dark:bg-slate-700",value:F.transferNo,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Transfer Date *"}),e.jsx("input",{type:"date",className:"input",value:F.transferDate,onChange:H=>I({...F,transferDate:H.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Transfer Type *"}),e.jsxs("select",{className:"input",value:F.transferType,onChange:H=>I({...F,transferType:H.target.value,fromBranchId:"",toBranchId:"",fromWarehouseId:"",toWarehouseId:""}),required:!0,children:[e.jsx("option",{value:"INTER_WAREHOUSE",children:"Inter-Warehouse"}),e.jsx("option",{value:"INTER_BRANCH",children:"Inter-Branch"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:F.status,onChange:H=>I({...F,status:H.target.value}),children:[e.jsx("option",{value:"DRAFT",children:"DRAFT"}),e.jsx("option",{value:"IN_TRANSIT",children:"IN TRANSIT"}),e.jsx("option",{value:"RECEIVED",children:"RECEIVED"}),e.jsx("option",{value:"CANCELLED",children:"CANCELLED"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["From"," ",F.transferType==="INTER_WAREHOUSE"?"Warehouse":"Branch"," ","*"]}),e.jsxs("select",{className:"input",value:F.fromBranchId,onChange:H=>I({...F,fromBranchId:H.target.value}),required:!0,children:[e.jsxs("option",{value:"",children:["Select"," ",F.transferType==="INTER_WAREHOUSE"?"Warehouse":"Branch"]}),(F.transferType==="INTER_WAREHOUSE"?x:p).map(H=>e.jsx("option",{value:H.id,children:F.transferType==="INTER_WAREHOUSE"?H.warehouse_name:H.name},H.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["To"," ",F.transferType==="INTER_WAREHOUSE"?"Warehouse":"Branch"," ","*"]}),e.jsxs("select",{className:"input",value:F.toBranchId,onChange:H=>I({...F,toBranchId:H.target.value}),required:!0,children:[e.jsxs("option",{value:"",children:["Select"," ",F.transferType==="INTER_WAREHOUSE"?"Warehouse":"Branch"]}),(F.transferType==="INTER_WAREHOUSE"?x:p).map(H=>e.jsx("option",{value:H.id,children:F.transferType==="INTER_WAREHOUSE"?H.warehouse_name:H.name},H.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Delivery Date"}),e.jsx("input",{type:"date",className:"input",value:F.deliveryDate,onChange:H=>I({...F,deliveryDate:H.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Driver Name"}),e.jsx("input",{type:"text",className:"input",value:F.driverName,onChange:H=>I({...F,driverName:H.target.value}),placeholder:"Optional"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Vehicle Number"}),e.jsx("input",{type:"text",className:"input",value:F.vehicleNo,onChange:H=>I({...F,vehicleNo:H.target.value}),placeholder:"Optional"})]})]}),F.transferType==="INTER_BRANCH"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From Warehouse (in selected From Branch)"}),e.jsxs("select",{className:"input",value:F.fromWarehouseId,onChange:H=>I({...F,fromWarehouseId:H.target.value}),disabled:!F.fromBranchId,required:!0,children:[e.jsx("option",{value:"",children:F.fromBranchId?"Select Warehouse":"Select From Branch first"}),y.map(H=>e.jsx("option",{value:String(H.id),children:H.warehouse_name},H.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To Warehouse (in selected To Branch)"}),e.jsxs("select",{className:"input",value:F.toWarehouseId,onChange:H=>I({...F,toWarehouseId:H.target.value}),disabled:!F.toBranchId,required:!0,children:[e.jsx("option",{value:"",children:F.toBranchId?"Select Warehouse":"Select To Branch first"}),N.map(H=>e.jsx("option",{value:String(H.id),children:H.warehouse_name},H.id))]})]})]}):null,e.jsxs("div",{className:"flex items-center justify-center py-6 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-wider mb-1",children:"Origin"}),e.jsx("div",{className:"font-bold text-lg text-slate-800 dark:text-slate-200",children:Y(F.fromBranchId)||"Select Source"}),F.transferType==="INTER_BRANCH"&&F.fromWarehouseId?e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:(y.find(H=>String(H.id)===String(F.fromWarehouseId))||{warehouse_name:""}).warehouse_name}):null]}),e.jsxs("div",{className:"mx-8 flex flex-col items-center text-brand-500",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 8l4 4m0 0l-4 4m4-4H3"})}),e.jsx("span",{className:"text-xs font-medium mt-1",children:F.transferType.replace("_"," ")})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-wider mb-1",children:"Destination"}),e.jsx("div",{className:"font-bold text-lg text-slate-800 dark:text-slate-200",children:Y(F.toBranchId)||"Select Destination"}),F.transferType==="INTER_BRANCH"&&F.toWarehouseId?e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:(N.find(H=>String(H.id)===String(F.toWarehouseId))||{warehouse_name:""}).warehouse_name}):null]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Remarks"}),e.jsx("textarea",{className:"input",rows:"3",value:F.remarks,onChange:H=>I({...F,remarks:H.target.value}),placeholder:"Enter any additional notes..."})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Items to Transfer"}),e.jsx("button",{type:"button",onClick:U,className:"btn-success text-sm",children:"+ Add Item"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-1/4 min-w-[200px]",children:"Item Code"}),e.jsx("th",{className:"w-1/4 min-w-[200px]",children:"Item Name"}),e.jsx("th",{className:"w-32 min-w-[120px]",children:"Qty"}),e.jsx("th",{className:"w-32 min-w-[120px]",children:"UOM"}),e.jsx("th",{className:"w-48 min-w-[180px]",children:"Batch No"}),e.jsx("th",{className:"w-64 min-w-[250px]",children:"Remarks"}),e.jsx("th",{className:"w-16"})]})}),e.jsx("tbody",{children:w.map(H=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("select",{className:"input",value:H.item_id,onChange:M=>{const q=M.target.value,z=h.find(L=>String(L.id)===String(q)),Q=w.map(L=>L.id===H.id?{...L,item_id:q,itemCode:(z==null?void 0:z.item_code)||"",itemName:(z==null?void 0:z.item_name)||""}:L);E(Q)},required:!0,children:[e.jsx("option",{value:"",children:"Select Item"}),h.map(M=>e.jsx("option",{value:M.id,children:(M.item_code||M.id)+" - "+(M.item_name||"")},M.id))]})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input",value:H.itemName,disabled:!0})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"input",value:H.qty,onChange:M=>{const q=w.map(z=>z.id===H.id?{...z,qty:parseFloat(M.target.value)||0}:z);E(q)},min:"0",step:"1"})}),e.jsx("td",{children:e.jsx("select",{className:"input",value:H.uom,onChange:M=>{const q=w.map(z=>z.id===H.id?{...z,uom:M.target.value}:z);E(q)},children:s?e.jsx("option",{children:"Loading..."}):t.map(M=>e.jsx("option",{value:M.uom_code,children:M.uom_code},M.id))})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input",value:H.batchNumber,onChange:M=>{const q=w.map(z=>z.id===H.id?{...z,batchNumber:M.target.value}:z);E(q)},placeholder:"Optional"})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input",value:H.remarks,onChange:M=>{const q=w.map(z=>z.id===H.id?{...z,remarks:M.target.value}:z);E(q)},placeholder:"Optional"})}),e.jsx("td",{children:e.jsx("button",{type:"button",onClick:()=>T(H.id),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Remove"})})]},H.id))})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx(Re,{to:"/inventory/stock-transfers",className:"btn-success",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-success",children:o?"Saving...":"Save Transfer"})]})]})})]})})}function see(){const[t,s]=f.useState(""),[r,a]=f.useState(!1),[n,i]=f.useState(""),[l,o]=f.useState([]),[d,u]=f.useState(!1),[c,h]=f.useState(null),[m,p]=f.useState(!1),[g,x]=f.useState(""),[b,y]=f.useState(null),[j,N]=f.useState(!1),[_,F]=f.useState(null),[I,w]=f.useState([]),[E,W]=f.useState(!1),[R,U]=f.useState(null),{canPerformAction:T}=Ls(),[Y,H]=f.useState(null);f.useEffect(()=>{let P=!0;return a(!0),i(""),Z.get("/inventory/material-requisitions").then(C=>{var k;P&&o(Array.isArray((k=C.data)==null?void 0:k.items)?C.data.items:[])}).catch(C=>{var k,B;P&&i(((B=(k=C==null?void 0:C.response)==null?void 0:k.data)==null?void 0:B.message)||"Failed to load material requisitions")}).finally(()=>{P&&a(!1)}),()=>{P=!1}},[]);const M=P=>({DRAFT:"badge-info",PENDING:"badge-warning",PENDING_APPROVAL:"badge-warning",SUBMITTED:"badge-warning",APPROVED:"badge-success",ISSUED:"badge-success",REJECTED:"badge-error"})[P]||"badge-info",q=f.useMemo(()=>l.filter(P=>{const C=String(P.requisition_no||"").toLowerCase(),k=String(P.requested_by||"").toLowerCase(),B=t.toLowerCase();return C.includes(B)||k.includes(B)}),[l,t]),z=async P=>{var C,k,B,G;if(h(P),u(!0),x(""),R)await Q();else try{p(!0);const O=await Z.get("/workflows");U(Array.isArray((C=O.data)==null?void 0:C.items)?O.data.items:[]),await L(Array.isArray((k=O.data)==null?void 0:k.items)?O.data.items:[])}catch(O){x(((G=(B=O==null?void 0:O.response)==null?void 0:B.data)==null?void 0:G.message)||"Failed to load workflows")}finally{p(!1)}},Q=async()=>{var O,K,J;if(!R||!R.length){y(null),F(null),x(""),N(!1);return}const P="/inventory/material-requisitions",C=te=>String(te||"").trim().toUpperCase().replace(/\s+/g,"_"),B=R.filter(te=>String(te.document_route)===P||C(te.document_type)==="MATERIAL_REQUISITION").some(te=>Number(te.is_active)===0),G=R.find(te=>Number(te.is_active)===1&&String(te.document_route)===P)||R.find(te=>Number(te.is_active)===1&&C(te.document_type)==="MATERIAL_REQUISITION")||null;if(y(G||null),N(!G&&B),F(null),!!G&&G)try{p(!0);const se=(O=(await Z.get(`/workflows/${G.id}`)).data)==null?void 0:O.item,ae=Array.isArray(se==null?void 0:se.steps)?se.steps:[];w(ae);const ne=ae[0]||null;if(F(ne?{userId:ne.approver_user_id,name:ne.approver_name,stepName:ne.step_name,stepOrder:ne.step_order,approvalLimit:ne.approval_limit}:null),ne){const ue=(Array.isArray(ne.approvers)&&ne.approvers.length?ne.approvers[0].id:ne.approver_user_id)||null;H(ue)}else H(null)}catch(te){x(((J=(K=te==null?void 0:te.response)==null?void 0:K.data)==null?void 0:J.message)||"Failed to load workflow details")}finally{p(!1)}},L=async P=>{var K,J,te;if(!P||!P.length){y(null),F(null),x(""),N(!1);return}const C="/inventory/material-requisitions",k=se=>String(se||"").trim().toUpperCase().replace(/\s+/g,"_"),G=P.filter(se=>String(se.document_route)===C||k(se.document_type)==="MATERIAL_REQUISITION").some(se=>Number(se.is_active)===0),O=P.find(se=>Number(se.is_active)===1&&String(se.document_route)===C)||P.find(se=>Number(se.is_active)===1&&k(se.document_type)==="MATERIAL_REQUISITION")||null;if(y(O||null),N(!O&&G),F(null),!!O)try{p(!0);const ae=(K=(await Z.get(`/workflows/${O.id}`)).data)==null?void 0:K.item,ne=Array.isArray(ae==null?void 0:ae.steps)?ae.steps:[];w(ne);const ue=ne[0]||null;F(ue?{userId:ue.approver_user_id,name:ue.approver_name,stepName:ue.step_name,stepOrder:ue.step_order,approvalLimit:ue.approval_limit}:null)}catch(se){x(((te=(J=se==null?void 0:se.response)==null?void 0:J.data)==null?void 0:te.message)||"Failed to load workflow details")}finally{p(!1)}},V=async()=>{var P,C,k;if(c){W(!0),x("");try{const B=await Z.post(`/inventory/material-requisitions/${c.id}/submit`,{amount:null,workflow_id:b?b.id:null,target_user_id:Y||null}),G=((P=B==null?void 0:B.data)==null?void 0:P.status)||"PENDING_APPROVAL";o(O=>O.map(K=>K.id===c.id?{...K,status:G}:K)),u(!1),h(null)}catch(B){x(((k=(C=B==null?void 0:B.response)==null?void 0:C.data)==null?void 0:k.message)||"Failed to forward for approval")}finally{W(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Material Requisitions"}),e.jsx("p",{className:"text-sm mt-1",children:"Request materials from warehouse inventory"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/inventory/material-requisitions/new",className:"btn-success",children:"+ New Requisition"})]})]})}),e.jsxs("div",{className:"card-body",children:[r?e.jsx("div",{className:"text-sm mb-4",children:"Loading..."}):null,n?e.jsx("div",{className:"text-sm text-red-600 mb-4",children:n}):null,e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by requisition number or requested by...",className:"input max-w-md",value:t,onChange:P=>s(P.target.value)})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Requisition No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Requested By"}),e.jsx("th",{children:"Department"}),e.jsx("th",{children:"Warehouse"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:q.map(P=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:P.requisition_no}),e.jsx("td",{children:P.requisition_date}),e.jsx("td",{children:P.requested_by||"-"}),e.jsx("td",{children:P.department_name||"-"}),e.jsx("td",{children:P.warehouse_name||"-"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${M(P.status)}`,children:P.status})}),e.jsxs("td",{children:[T("inventory:material-requisitions","view")&&e.jsx(Re,{to:`/inventory/material-requisitions/${P.id}?mode=view`,className:"text-brand hover:text-brand-700 text-sm font-medium",children:"View"}),T("inventory:material-requisitions","edit")&&e.jsx(Re,{to:`/inventory/material-requisitions/${P.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"}),P.status==="APPROVED"?e.jsx("span",{className:"ml-3 text-sm font-medium px-2 py-1 rounded bg-green-500 text-white",children:"Approved"}):e.jsx("button",{type:"button",onClick:()=>z(P),className:"ml-3 text-sm font-medium px-2 py-1 rounded bg-brand text-white hover:bg-brand-700 transition-colors",disabled:E||P.status==="ISSUED"||P.status==="PENDING_APPROVAL"||j,children:"Forward for Approval"})]})]},P.id))})]})})]})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-erp w/full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-brand text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Forward for Approval"}),e.jsx("button",{onClick:()=>{u(!1),h(null),y(null),F(null),x("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Requisition:"," ",e.jsx("span",{className:"font-semibold",children:c==null?void 0:c.requisition_no})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:b?`${b.workflow_name} (${b.workflow_code})`:"None (inactive)"})]}),e.jsxs("div",{children:[m?e.jsx("div",{className:"text-sm",children:"Loading workflow..."}):null,g?e.jsx("div",{className:"text-sm text-red-600",children:g}):null]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Target Approver"}),(()=>{const C=Array.isArray(I)&&I.length>0?I[0]:null,k=C?Array.isArray(C.approvers)&&C.approvers.length?C.approvers.map(B=>({id:B.id,name:B.username})):C.approver_user_id?[{id:C.approver_user_id,name:C.approver_name||String(C.approver_user_id)}]:[]:[];return k.length>0?e.jsxs("div",{className:"mt-1",children:[e.jsxs("select",{className:"input w-full",value:Y||"",onChange:B=>H(B.target.value?Number(B.target.value):null),children:[e.jsx("option",{value:"",children:"Select target approver"}),k.map(B=>e.jsx("option",{value:B.id,children:B.name},B.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:_?`Step ${_.stepOrder}  ${_.stepName}${_.approvalLimit!=null?`  Limit: ${Number(_.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:b?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})()]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{u(!1),h(null),y(null),F(null),H(null),x("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:V,disabled:E,children:E?"Forwarding...":"Forward"})]})]})})]})}function lC(t){if(!t)return new Date().toISOString().split("T")[0];const s=String(t);return s.includes("T")?s.split("T")[0]:s}function ree(){$i();const{id:t}=Ps(),s=ps(),r=t==="new",[a,n]=f.useState(!1),[i,l]=f.useState(!1),[o,d]=f.useState(""),[u,c]=f.useState([]),[h,m]=f.useState([]),[p,g]=f.useState([]),[x,b]=f.useState([]),[y,j]=f.useState(!1),[N,_]=f.useState(""),[F,I]=f.useState({requisitionNo:r?"Auto-generated":"",requisitionDate:new Date().toISOString().split("T")[0],warehouseId:"",departmentId:"",requisitionType:"INTERNAL",priority:"MEDIUM",requestedBy:"",remarks:"",status:"DRAFT"}),[w,E]=f.useState([{id:1,item_id:"",itemCode:"",itemName:"",qtyRequested:0,qtyIssued:0,uom:"PCS"}]);f.useEffect(()=>{let q=!0;return Z.get("/admin/users").then(z=>{var Q;q&&m(Array.isArray((Q=z.data)==null?void 0:Q.items)?z.data.items:[])}).catch(z=>console.error("Failed to load users",z)),Z.get("/inventory/warehouses").then(z=>{var Q;q&&g(Array.isArray((Q=z.data)==null?void 0:Q.items)?z.data.items:[])}).catch(z=>console.error("Failed to load warehouses",z)),Z.get("/admin/departments").then(z=>{var Q;q&&b(Array.isArray((Q=z.data)==null?void 0:Q.items)?z.data.items:[])}).catch(z=>console.error("Failed to load departments",z)),Z.get("/inventory/items").then(z=>{var Q;q&&c(Array.isArray((Q=z.data)==null?void 0:Q.items)?z.data.items:[])}).catch(z=>{var Q,L;q&&d(((L=(Q=z==null?void 0:z.response)==null?void 0:Q.data)==null?void 0:L.message)||"Failed to load items")}),()=>{q=!1}},[]),f.useEffect(()=>{if(r)return;let q=!0;return n(!0),d(""),Z.get(`/inventory/material-requisitions/${t}`).then(z=>{var V,P;if(!q)return;const Q=(V=z.data)==null?void 0:V.item,L=Array.isArray((P=z.data)==null?void 0:P.details)?z.data.details:[];Q&&(I({requisitionNo:Q.requisition_no||"",requisitionDate:lC(Q.requisition_date),warehouseId:Q.warehouse_id||"",departmentId:Q.department_id||"",requisitionType:Q.requisition_type||"INTERNAL",priority:Q.priority||"MEDIUM",requestedBy:Q.requested_by||"",remarks:Q.remarks||"",status:Q.status||"DRAFT"}),E(L.length?L.map(C=>({id:C.id||Date.now()+Math.random(),item_id:C.item_id?String(C.item_id):"",itemCode:C.item_code||"",itemName:C.item_name||"",qtyRequested:Number(C.qty_requested)||0,qtyIssued:Number(C.qty_issued)||0,uom:C.uom||"PCS"})):[{id:1,item_id:"",itemCode:"",itemName:"",qtyRequested:0,qtyIssued:0,uom:"PCS"}]))}).catch(z=>{var Q,L;q&&d(((L=(Q=z==null?void 0:z.response)==null?void 0:Q.data)==null?void 0:L.message)||"Failed to load material requisition")}).finally(()=>{q&&n(!1)}),()=>{q=!1}},[t,r]);const W=f.useMemo(()=>w.filter(q=>q.item_id).map(q=>({item_id:Number(q.item_id),qty_requested:Math.max(0,parseInt(q.qtyRequested,10)||0),qty_issued:Number(q.qtyIssued)||0})),[w]),R={DRAFT:"bg-gray-500 text-white",PENDING:"bg-yellow-400 text-black",PENDING_APPROVAL:"bg-yellow-400 text-black",SUBMITTED:"bg-yellow-300 text-black",APPROVED:"bg-green-500 text-white",ISSUED:"bg-blue-500 text-white",REJECTED:"bg-red-500 text-white"},U=async(q,z)=>{var Q,L;q&&q.preventDefault(),l(!0),d("");try{const V={requisition_no:r?void 0:F.requisitionNo,requisition_date:lC(F.requisitionDate),warehouse_id:F.warehouseId||null,department_id:F.departmentId||null,requisition_type:F.requisitionType,priority:F.priority,requested_by:F.requestedBy||null,remarks:F.remarks||null,status:z||F.status,details:W};r?await Z.post("/inventory/material-requisitions",V):await Z.put(`/inventory/material-requisitions/${t}`,V),s("/inventory/material-requisitions")}catch(V){d(((L=(Q=V==null?void 0:V.response)==null?void 0:Q.data)==null?void 0:L.message)||"Failed to save material requisition")}finally{l(!1)}},T=()=>{j(!0),_("")},Y=q=>{E([...w,{id:Date.now(),item_id:String(q.id),itemCode:q.item_code||"",itemName:q.item_name||"",qtyRequested:0,qtyIssued:0,uom:q.uom||"PCS"}]),j(!1)},H=f.useMemo(()=>{if(!N)return u;const q=N.toLowerCase();return u.filter(z=>z.item_code&&z.item_code.toLowerCase().includes(q)||z.item_name&&z.item_name.toLowerCase().includes(q))},[u,N]),M=q=>{E(w.filter(z=>z.id!==q))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"New Material Requisition":"Edit Material Requisition"}),e.jsx("p",{className:"text-sm mt-1",children:"Request materials from warehouse inventory"})]}),e.jsx(Re,{to:"/inventory/material-requisitions",className:"btn-success",children:"Back to List"})]})}),e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[a?e.jsx("div",{className:"text-sm",children:"Loading..."}):null,o?e.jsx("div",{className:"text-sm text-red-600",children:o}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Requisition No"}),e.jsx("input",{type:"text",className:"input bg-slate-100 dark:bg-slate-700",value:F.requisitionNo,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Requisition Date *"}),e.jsx("input",{type:"date",className:"input",value:F.requisitionDate,onChange:q=>I({...F,requisitionDate:q.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Priority"}),e.jsxs("select",{className:"input",value:F.priority,onChange:q=>I({...F,priority:q.target.value}),children:[e.jsx("option",{value:"LOW",children:"Low"}),e.jsx("option",{value:"MEDIUM",children:"Medium"}),e.jsx("option",{value:"HIGH",children:"High"}),e.jsx("option",{value:"CRITICAL",children:"Critical"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsx("div",{className:"pt-2",children:e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-medium ${R[F.status]||"bg-gray-500 text-white"}`,children:F.status})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Source Warehouse"}),e.jsxs("select",{className:"input",value:F.warehouseId,onChange:q=>I({...F,warehouseId:q.target.value}),children:[e.jsx("option",{value:"",children:"Select Warehouse"}),p.map(q=>e.jsx("option",{value:q.id,children:q.warehouse_name},q.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Destination Department"}),e.jsxs("select",{className:"input",value:F.departmentId,onChange:q=>I({...F,departmentId:q.target.value}),children:[e.jsx("option",{value:"",children:"Select Department"}),x.map(q=>e.jsx("option",{value:q.id,children:q.name},q.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Requisition Type"}),e.jsxs("select",{className:"input",value:F.requisitionType,onChange:q=>I({...F,requisitionType:q.target.value}),children:[e.jsx("option",{value:"INTERNAL",children:"Internal Use"}),e.jsx("option",{value:"PROJECT",children:"Project"}),e.jsx("option",{value:"SALES",children:"Sales Order"}),e.jsx("option",{value:"PRODUCTION",children:"Production"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Requested By *"}),e.jsxs("select",{className:"input",value:F.requestedBy,onChange:q=>I({...F,requestedBy:q.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select User"}),h.map(q=>e.jsx("option",{value:q.username,children:q.username},q.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Remarks"}),e.jsx("textarea",{className:"input",rows:"3",value:F.remarks,onChange:q=>I({...F,remarks:q.target.value}),placeholder:"Enter any additional notes..."})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Items"}),e.jsx("button",{type:"button",onClick:T,className:"btn-success text-sm",children:"+ Add Item"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item Code"}),e.jsx("th",{children:"Item Name"}),e.jsx("th",{children:"Qty Requested"}),e.jsx("th",{children:"Qty Issued"}),e.jsx("th",{children:"UOM"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:w.map(q=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("select",{className:"input",value:q.item_id,onChange:z=>{const Q=z.target.value,L=u.find(P=>String(P.id)===String(Q)),V=w.map(P=>P.id===q.id?{...P,item_id:Q,itemCode:(L==null?void 0:L.item_code)||"",itemName:(L==null?void 0:L.item_name)||""}:P);E(V)},required:!0,children:[e.jsx("option",{value:"",children:"Select Item"}),!u.some(z=>String(z.id)===String(q.item_id))&&q.item_id&&e.jsx("option",{value:q.item_id,children:q.itemCode||q.item_id}),u.map(z=>e.jsx("option",{value:z.id,children:z.item_code||z.id},z.id))]})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input",value:q.itemName,disabled:!0})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"input",value:q.qtyRequested,onChange:z=>{const Q=w.map(L=>L.id===q.id?{...L,qtyRequested:Math.max(0,parseInt(z.target.value,10)||0)}:L);E(Q)},min:"0",step:"1",inputMode:"numeric",pattern:"[0-9]*"})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"input bg-slate-100 dark:bg-slate-700",value:q.qtyIssued,disabled:!0})}),e.jsx("td",{children:e.jsxs("select",{className:"input",value:q.uom,onChange:z=>{const Q=w.map(L=>L.id===q.id?{...L,uom:z.target.value}:L);E(Q)},children:[e.jsx("option",{value:"EA",children:"EA"}),e.jsx("option",{value:"PCS",children:"PCS"}),e.jsx("option",{value:"KG",children:"KG"}),e.jsx("option",{value:"LTR",children:"LTR"}),e.jsx("option",{value:"MTR",children:"MTR"})]})}),e.jsx("td",{children:e.jsx("button",{type:"button",onClick:()=>M(q.id),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Remove"})})]},q.id))})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx(Re,{to:"/inventory/material-requisitions",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",onClick:q=>U(q,"DRAFT"),className:"btn-success",disabled:i,children:i?"Saving...":" Save Draft"}),e.jsx("button",{type:"button",onClick:q=>U(q,"PENDING"),className:"px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition-colors",disabled:i,children:i?"Saving...":" Save as Pending"})]})]})})]}),y&&e.jsx("div",{className:"custom-modal-overlay",onClick:()=>j(!1),children:e.jsxs("div",{className:"custom-modal-content",onClick:q=>q.stopPropagation(),children:[e.jsxs("div",{className:"p-4 bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Select Item"}),e.jsx("button",{onClick:()=>j(!1),className:"text-white hover:text-gray-200 text-2xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 flex-1 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"label",children:"Search Items"}),e.jsx("input",{type:"text",className:"input",placeholder:"Search by item code or name...",value:N,onChange:q=>_(q.target.value),autoFocus:!0})]}),e.jsx("div",{className:"item-list-container flex-1 overflow-y-auto",children:H.length===0?e.jsx("div",{className:"text-center p-4 text-gray-500",children:"No items found"}):H.map(q=>e.jsxs("div",{className:"item-card cursor-pointer hover:bg-slate-100 mb-2 p-3 border rounded",onClick:()=>Y(q),children:[e.jsx("div",{className:"font-bold text-brand",children:q.item_code||"N/A"}),e.jsx("div",{className:"text-gray-800",children:q.item_name||"Unnamed Item"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["UOM: ",q.uom||"N/A"]})]},q.id))})]}),e.jsx("div",{className:"p-4 border-t flex justify-end bg-gray-50 rounded-b-lg",children:e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>j(!1),children:"Close"})})]})})]})}function aee(){const{canPerformAction:t}=Ls(),[s,r]=f.useState([]),[a,n]=f.useState(!1),[i,l]=f.useState(""),[o,d]=f.useState(""),[u,c]=f.useState(""),[h,m]=f.useState(""),[p,g]=f.useState(""),[x,b]=f.useState(25),[y,j]=f.useState(1),[N,_]=f.useState({key:"item_code",asc:!0}),F=f.useRef(null),[I,w]=f.useState(!1),[E,W]=f.useState([]),[R,U]=f.useState([]),[T,Y]=f.useState(!1),H=O=>{if(O==null)return"";const K=String(O).trim();if(!K)return"";const J=/^([+-]?)(\d+(?:\.\d+)?)[eE]([+-]?\d+)$/.exec(K);if(!J)return K;const te=J[1]||"";let se=J[2];const ae=parseInt(J[3],10);if(!Number.isFinite(ae))return K;if(se.includes(".")){const ne=se.split("."),ue=ne[0],oe=ne[1];if(ae>=0){const le=Math.min(ae,oe.length),X=ue+oe.slice(0,le),me=oe.slice(le),we=ae>oe.length?"0".repeat(ae-oe.length):"";se=X+me+we}else{const le=-ae,X="0".repeat(le-ue.length),me=ue.length>le?ue.slice(0,ue.length-le):"",we=(ue.length>le?ue.slice(ue.length-le):X+ue)+oe;se=me+""+we}}else if(ae>=0)se=se+"0".repeat(ae);else{const ne=-ae;se="0."+"0".repeat(ne)+se}return se=se.replace(/^0+(?=\d)/,""),(te==="-"?"-":"")+se};f.useEffect(()=>{let O=!0;return n(!0),l(""),Z.get("/inventory/items").then(K=>{var J;O&&r(Array.isArray((J=K.data)==null?void 0:J.items)?K.data.items:[])}).catch(K=>{var J,te;O&&l(((te=(J=K==null?void 0:K.response)==null?void 0:J.data)==null?void 0:te.message)||"Failed to load items")}).finally(()=>{O&&n(!1)}),()=>{O=!1}},[]);const M=f.useMemo(()=>{const O=s.length,K=s.filter(se=>!!se.is_active).length,J=O-K,te=s.filter(se=>Number(se.stock_level||0)<=Number(se.reorder_level||-1)&&se.reorder_level!=null).length;return{total:O,active:K,inactive:J,lowStock:te}},[s]),q=f.useMemo(()=>{const O=o.toLowerCase();return s.filter(K=>u&&String(K.item_type||"")!==u||h&&(h==="Y"?!K.is_active:K.is_active)||p==="Y"&&!K.barcode||p==="N"&&K.barcode?!1:String(K.item_code||"").toLowerCase().includes(O)||String(K.item_name||"").toLowerCase().includes(O)||String(K.barcode||"").toLowerCase().includes(O)).sort((K,J)=>{const te=K[N.key],se=J[N.key];if(te==null&&se==null)return 0;if(te==null)return N.asc?-1:1;if(se==null)return N.asc?1:-1;if(typeof te=="number"&&typeof se=="number")return N.asc?te-se:se-te;const ae=String(te).toLowerCase(),ne=String(se).toLowerCase();return ae<ne?N.asc?-1:1:ae>ne?N.asc?1:-1:0})},[s,o,u,h,p,N]),z=Math.max(1,Math.ceil(q.length/x)),Q=f.useMemo(()=>{const O=(y-1)*x;return q.slice(O,O+x)},[q,y,x]),L=O=>{_(K=>K.key===O?{key:O,asc:!K.asc}:{key:O,asc:!0})},V=()=>{F.current&&F.current.click()};function P(O){const K=[];let J=0,te="",se=!1,ae=[];const ne=()=>{ae.push(te),te=""},ue=()=>{ae.length&&K.push(ae.map(oe=>oe.replace(/\r$/,""))),ae=[]};for(O.charCodeAt(0)===65279&&(O=O.slice(1));J<O.length;){const oe=O[J];if(se)if(oe==='"')if(O[J+1]==='"'){te+='"',J+=2;continue}else{se=!1,J+=1;continue}else{te+=oe,J+=1;continue}else{if(oe==='"'){se=!0,J+=1;continue}if(oe===","){ne(),J+=1;continue}if(oe===`
`){ne(),ue(),J+=1;continue}if(oe==="\r"){O[J+1]===`
`?J+=2:J+=1,ne(),ue();continue}te+=oe,J+=1}}for(ne(),ue();K.length&&K[K.length-1].every(oe=>oe.trim()==="");)K.pop();return K}const C=async O=>{const K=O.target.files[0];if(!K)return;const J=new FileReader;J.onload=async te=>{var Ce,Pe,fe,he,Ue,Ye,Ke;const se=te.target.result||"",ae=P(se);if(!ae.length){ct.error("Empty CSV file");return}const ne=ae[0].map(Je=>String(Je||"").trim()),oe=["ITEM_NAME*","ITEM_TYPE*","BASE_UOM*"].filter(Je=>!ne.includes(Je));if(oe.length>0){ct.error(`Invalid CSV format: Missing required header(s): ${oe.join(", ")}`);return}let le=new Map,X=new Map,me=new Map,we=new Map,Ie=new Map,_e=new Map,Fe=new Map,Le=new Map,rt=new Set,He=new Map,st=new Map;try{const[Je,xe,ye,Ae,be,Ee,dt]=await Promise.all([Z.get("/inventory/item-categories"),Z.get("/inventory/item-groups"),Z.get("/finance/currencies"),Z.get("/finance/tax-codes"),Z.get("/finance/accounts"),Z.get("/inventory/item-types"),Z.get("/sales/price-types?active=true")]),mt=Array.isArray((Ce=Je==null?void 0:Je.data)==null?void 0:Ce.items)?Je.data.items:[],it=Array.isArray((Pe=xe==null?void 0:xe.data)==null?void 0:Pe.items)?xe.data.items:[],ht=Array.isArray((fe=ye==null?void 0:ye.data)==null?void 0:fe.items)?ye.data.items:[],ft=Array.isArray((he=Ae==null?void 0:Ae.data)==null?void 0:he.items)?Ae.data.items:[],Rt=Array.isArray((Ue=be==null?void 0:be.data)==null?void 0:Ue.items)?be.data.items:[],Ge=Array.isArray((Ye=Ee==null?void 0:Ee.data)==null?void 0:Ye.items)?Ee.data.items:[];mt.forEach(je=>{const Se=Number(je.id),nt=String(je.category_code||"").toUpperCase(),Ze=String(je.category_name||"").toUpperCase();Se>0&&(nt&&le.set(nt,Se),Ze&&le.set(Ze,Se),X.set(Se,String(je.category_name||"")))}),it.forEach(je=>{const Se=Number(je.id),nt=String(je.group_code||"").toUpperCase(),Ze=String(je.group_name||"").toUpperCase();Se>0&&(nt&&me.set(nt,Se),Ze&&me.set(Ze,Se),we.set(Se,String(je.group_name||"")))}),ht.forEach(je=>{const Se=Number(je.id),nt=String(je.code||"").toUpperCase(),Ze=String(je.name||"").toUpperCase();Se>0&&(nt&&Ie.set(nt,Se),Ze&&Ie.set(Ze,Se))}),ft.forEach(je=>{const Se=Number(je.id),nt=String(je.code||"").toUpperCase(),Ze=String(je.name||"").toUpperCase();Se>0&&(nt&&_e.set(nt,Se),Ze&&_e.set(Ze,Se))}),Rt.forEach(je=>{const Se=Number(je.id),nt=String(je.code||"").toUpperCase(),Ze=String(je.name||"").toUpperCase();Se>0&&(nt&&Fe.set(nt,Se),Ze&&Fe.set(Ze,Se))}),(Array.isArray((Ke=dt==null?void 0:dt.data)==null?void 0:Ke.items)?dt.data.items:[]).forEach(je=>{const Se=Number(je.id),nt=String(je.name||"").toUpperCase();Se>0&&nt&&Le.set(nt,Se)}),Ge.forEach(je=>{const Se=String(je.type_code||je.code||je.key||"").toUpperCase(),nt=String(je.type_name||je.name||"").toUpperCase();Se&&(rt.add(Se),He.set(Se,Se)),nt&&(rt.add(nt),Se&&st.set(nt,Se))})}catch{}const De=[],Te=new Set;for(let Je=1;Je<ae.length;Je++){const xe=ae[Je].map(Se=>String(Se||"").trim());if(xe.length<ne.length)for(let Se=xe.length;Se<ne.length;Se++)xe.push("");const ye={};ne.forEach((Se,nt)=>{const Ze=Se.replace("*","");ye[Ze]=xe[nt]??""});let Ae=ye.ITEM_CODE||"";const be=String(ye.ITEM_TYPE||"").toUpperCase(),Ee=He.get(be)||st.get(be)||(rt.has(be)?be:null);rt.size;const dt=H(ye.BARCODE||""),mt=ye.ITEM_CATEGORY&&le.get(String(ye.ITEM_CATEGORY).toUpperCase())||ye.ITEM_CATEGORY_CODE&&le.get(String(ye.ITEM_CATEGORY_CODE).toUpperCase())||ye.ITEM_CATEGORY_ID||null,it=ye.ITEM_GROUP&&me.get(String(ye.ITEM_GROUP).toUpperCase())||ye.ITEM_GROUP_CODE&&me.get(String(ye.ITEM_GROUP_CODE).toUpperCase())||ye.ITEM_GROUP_ID||null;let ht="";if(ye.ITEM_CATEGORY_ID){const Se=Number(ye.ITEM_CATEGORY_ID);ht=X.get(Se)||ye.ITEM_CATEGORY||ye.ITEM_CATEGORY_CODE||String(ye.ITEM_CATEGORY_ID)}else ht=ye.ITEM_CATEGORY||ye.ITEM_CATEGORY_CODE||mt&&X.get(Number(mt))||"";let ft="";if(ye.ITEM_GROUP_ID){const Se=Number(ye.ITEM_GROUP_ID);ft=we.get(Se)||ye.ITEM_GROUP||ye.ITEM_GROUP_CODE||String(ye.ITEM_GROUP_ID)}else ft=ye.ITEM_GROUP||ye.ITEM_GROUP_CODE||it&&we.get(Number(it))||"";const Rt=mt&&X.get(Number(mt))||"",Ge=it&&we.get(Number(it))||"",at=[],je=String(ye.ITEM_NAME||"").toUpperCase();je||at.push("Missing ITEM_NAME"),je&&(Te.has(je)&&at.push("Duplicate in CSV"),Te.add(je)),De.push({index:Je+1,raw:ye,preview:{item_code:Ae,item_name:ye.ITEM_NAME,item_type:Ee||be||"",category_id:mt,item_group_id:it,category_label:String(ht),group_label:String(ft),category_name:Rt,group_name:Ge,uom:ye.BASE_UOM||"PCS",barcode:dt},valid:at.length===0,errors:at})}W(["Row","Item Code","Name","Type","Uploaded Category","Category Name","Uploaded Group","Group Name","UOM","Barcode","Status"]),U(De),w(!0),O.target.value=null},J.readAsText(K)},k=async()=>{var O,K,J,te,se,ae,ne,ue,oe,le,X,me,we,Ie,_e,Fe,Le,rt,He,st,De,Te,Ce,Pe;try{Y(!0);const fe=R.filter(Je=>Je&&Je.valid).map(Je=>{const xe=Je.raw||{};return{item_code:xe.ITEM_CODE||Je.preview.item_code||"",item_name:xe.ITEM_NAME||"",item_type:Je.preview.item_type||xe.ITEM_TYPE||"",category_id:Je.preview.category_id||null,item_group_id:Je.preview.item_group_id||null,category_label:Je.preview.category_label||"",category_name:Je.preview.category_name||"",category_code:xe.ITEM_CATEGORY_CODE||"",group_label:Je.preview.group_label||"",group_name:Je.preview.group_name||"",group_code:xe.ITEM_GROUP_CODE||"",uom:xe.BASE_UOM||"PCS",barcode:Je.preview.barcode||"",cost_price:Number(xe.STANDARD_COST)||0,selling_price:Number(xe.SELLING_PRICE)||0,currency_code:xe.CURRENCY_CODE||xe.CURRENCY||"",price_type:xe.PRICE_TYPE||"",price_type_name:xe.PRICE_TYPE_NAME||"",image_url:xe.IMAGE_URL||xe.IMAGE||"",vat_on_purchase_code:xe.VAT_ON_PURCHASE||xe.VAT_PURCHASE_CODE||"",purchase_account_id:Number(xe.PURCHASE_ACCOUNT_ID||0)||accountCodeToId.get(String(xe.PURCHASE_ACCOUNT_CODE||xe.PURCHASE_ACCOUNT||"").toUpperCase())||null,sales_account_id:Number(xe.SALES_ACCOUNT_ID||0)||accountCodeToId.get(String(xe.SALES_ACCOUNT_CODE||xe.SALES_ACCOUNT||"").toUpperCase())||null,vat_on_sales_code:xe.VAT_ON_SALES||xe.VAT_SALES_CODE||"",purchase_account_code:xe.PURCHASE_ACCOUNT_CODE||xe.PURCHASE_ACCOUNT||"",is_sellable:xe.IS_SELLABLE==="Y",is_purchasable:xe.IS_PURCHASABLE==="Y",min_stock_level:Number(xe.MIN_STOCK_LEVEL)||0,max_stock_level:Number(xe.MAX_STOCK_LEVEL)||0,reorder_level:Number(xe.REORDER_LEVEL)||0}});if(fe.length){const Je=await Z.post("/inventory/items/bulk",{rows:fe,auto_create_missing:!0},{__skipOfflineQueue:!0}),xe=Number(((O=Je==null?void 0:Je.data)==null?void 0:O.inserted)||0),ye=Number(((K=Je==null?void 0:Je.data)==null?void 0:K.updated)||0),Ae=Number(((J=Je==null?void 0:Je.data)==null?void 0:J.failed)||0);if(xe||ye){ct.success(`Uploaded ${xe} new, updated ${ye}`);const be=await Z.get("/inventory/items");r(Array.isArray((te=be.data)==null?void 0:te.items)?be.data.items:[])}if(Ae){ct.error(`Skipped ${Ae} rows`);const be=Array.isArray((se=Je==null?void 0:Je.data)==null?void 0:se.errors)?Je.data.errors:[];be.length&&alert(`Some rows failed:
`+be.slice(0,10).map(Ee=>`Row ${Ee.index} (${Ee.item_name||"-"}) - ${Ee.message}`).join(`
`)+(be.length>10?`
...`:""))}return}let he=0,Ue=0;const Ye=[],Ke=new Map((Array.isArray(s)?s:[]).filter(Je=>Je&&Je.id&&Je.item_name).map(Je=>[String(Je.item_name||"").toUpperCase(),Number(Je.id)]));for(const Je of R){if(!Je.valid){Ue++;continue}const xe=Je.raw;let ye=xe.ITEM_CODE;if(!ye)try{const Ee=await Z.get("/inventory/items/next-code");(ae=Ee==null?void 0:Ee.data)!=null&&ae.nextCode&&(ye=Ee.data.nextCode)}catch{}const be={item_code:ye,item_name:xe.ITEM_NAME,item_type:Je.preview.item_type||xe.ITEM_TYPE,category_id:Je.preview.category_id||null,item_group_id:Je.preview.item_group_id||null,group_id:Je.preview.item_group_id||null,category_label:Je.preview.category_label,category_name:Je.preview.category_name,group_label:Je.preview.group_label,group_name:Je.preview.group_name,category_code:xe.ITEM_CATEGORY_CODE||null,group_code:xe.ITEM_GROUP_CODE||null,currency_code:xe.CURRENCY_CODE||xe.CURRENCY||null,vat_on_purchase_code:xe.VAT_ON_PURCHASE||xe.VAT_PURCHASE_CODE||null,vat_on_sales_code:xe.VAT_ON_SALES||xe.VAT_SALES_CODE||null,purchase_account_code:xe.PURCHASE_ACCOUNT_CODE||xe.PURCHASE_ACCOUNT||null,sales_account_code:xe.SALES_ACCOUNT_CODE||xe.SALES_ACCOUNT||null,uom:xe.BASE_UOM,barcode:Je.preview.barcode||null,cost_price:Number(xe.STANDARD_COST)||0,selling_price:Number(xe.SELLING_PRICE)||0,currency_id:currencyCodeToId.get(String(xe.CURRENCY_ID||xe.CURRENCY_CODE||xe.CURRENCY||"").toUpperCase())||null,price_type_id:priceTypeNameToId.get(String(xe.PRICE_TYPE||xe.PRICE_TYPE_NAME||"").toUpperCase())||Number(xe.PRICE_TYPE_ID||0)||null,image_url:xe.IMAGE_URL||xe.IMAGE||null,vat_on_purchase_id:taxCodeToId.get(String(xe.VAT_ON_PURCHASE_ID||xe.VAT_ON_PURCHASE||xe.VAT_PURCHASE||xe.VAT_PURCHASE_CODE||"").toUpperCase())||null,vat_on_sales_id:taxCodeToId.get(String(xe.VAT_ON_SALES_ID||xe.VAT_ON_SALES||xe.VAT_SALES||xe.VAT_SALES_CODE||"").toUpperCase())||null,purchase_account_id:accountCodeToId.get(String(xe.PURCHASE_ACCOUNT_ID||xe.PURCHASE_ACCOUNT_CODE||xe.PURCHASE_ACCOUNT||"").toUpperCase())||null,sales_account_id:accountCodeToId.get(String(xe.SALES_ACCOUNT_ID||xe.SALES_ACCOUNT_CODE||xe.SALES_ACCOUNT||"").toUpperCase())||null,description:xe.DESCRIPTION,is_stockable:xe.IS_STOCKABLE==="Y",is_sellable:xe.IS_SELLABLE==="Y",is_purchasable:xe.IS_PURCHASABLE==="Y",min_stock_level:Number(xe.MIN_STOCK_LEVEL)||0,max_stock_level:Number(xe.MAX_STOCK_LEVEL)||0,reorder_level:Number(xe.REORDER_LEVEL)||0,safety_stock:Number(xe.SAFETY_STOCK)||0,bulk_import:!0,auto_create_missing:!0};try{const Ee=await Z.post("/inventory/items",be,{__skipOfflineQueue:!0});if((ne=Ee==null?void 0:Ee.data)!=null&&ne.offline)throw new Error("Offline queued");he++}catch(Ee){const dt=((oe=(ue=Ee==null?void 0:Ee.response)==null?void 0:ue.data)==null?void 0:oe.code)||"",mt=((le=Ee==null?void 0:Ee.response)==null?void 0:le.status)||0;if(mt===409&&String(dt).toUpperCase()==="DUPLICATE_ITEM_NAME"){const it=String(be.item_name||"").toUpperCase();let ht=Ke.get(it);if(!ht)try{const ft=await Z.get("/inventory/items"),Rt=Array.isArray((X=ft.data)==null?void 0:X.items)?ft.data.items:[];for(const Ge of Rt){const at=String(Ge.item_name||"").toUpperCase();Ke.has(at)||Ke.set(at,Number(Ge.id))}ht=Ke.get(it)}catch{}if(ht)try{await Z.put(`/inventory/items/${ht}`,be),he++;continue}catch(ft){Ue++,Ye.push(`Row ${Je.index} (${be.item_code||be.item_name}): UPDATE FAILED - ${((we=(me=ft==null?void 0:ft.response)==null?void 0:me.data)==null?void 0:we.message)||(ft==null?void 0:ft.message)}`);continue}}else if(mt===400&&/item_code.*required/i.test(String(((_e=(Ie=Ee==null?void 0:Ee.response)==null?void 0:Ie.data)==null?void 0:_e.message)||"")))try{const it=await Z.get("/inventory/items/next-code",{__skipOfflineQueue:!0});if((Fe=it==null?void 0:it.data)!=null&&Fe.nextCode){be.item_code=it.data.nextCode;const ht=await Z.post("/inventory/items",be,{__skipOfflineQueue:!0});if((Le=ht==null?void 0:ht.data)!=null&&Le.offline)throw new Error("Offline queued");he++;continue}}catch{}else{const it=String(((He=(rt=Ee==null?void 0:Ee.response)==null?void 0:rt.data)==null?void 0:He.message)||(Ee==null?void 0:Ee.message)||"");if(/duplicate entry/i.test(it))try{const ht=await Z.get("/inventory/items/next-code",{__skipOfflineQueue:!0});if((st=ht==null?void 0:ht.data)!=null&&st.nextCode){be.item_code=ht.data.nextCode;const ft=await Z.post("/inventory/items",be,{__skipOfflineQueue:!0});if((De=ft==null?void 0:ft.data)!=null&&De.offline)throw new Error("Offline queued");he++;continue}}catch{}}Ue++,Ye.push(`Row ${Je.index} (${be.item_code||be.item_name}): ${((Ce=(Te=Ee==null?void 0:Ee.response)==null?void 0:Te.data)==null?void 0:Ce.message)||(Ee==null?void 0:Ee.message)}`)}}if(he>0){ct.success(`Uploaded ${he} items`);const Je=await Z.get("/inventory/items");r(Array.isArray((Pe=Je.data)==null?void 0:Pe.items)?Je.data.items:[])}Ue>0&&(ct.error(`Skipped ${Ue} invalid rows`),Ye.length&&alert(`Some rows failed:
`+Ye.slice(0,10).join(`
`)+(Ye.length>10?`
...`:"")))}finally{Y(!1),w(!1),U([]),W([])}},B=async()=>{var _e,Fe;let O=[],K=[];try{const[Le,rt]=await Promise.all([Z.get("/finance/tax-codes"),Z.get("/finance/accounts")]);O=(Array.isArray((_e=Le==null?void 0:Le.data)==null?void 0:_e.items)?Le.data.items:[]).map(He=>String(He.code||"").trim()).filter(Boolean),K=(Array.isArray((Fe=rt==null?void 0:rt.data)==null?void 0:Fe.items)?rt.data.items:[]).map(He=>String(He.code||"").trim()).filter(Boolean)}catch{}const J=(Le,rt=0,He="")=>String((Le==null?void 0:Le[rt])||He),te=(Le,rt)=>String((Le==null?void 0:Le.find(He=>String(He).toUpperCase().includes(rt)))||""),se=J(O,0,"VAT"),ae=J(O,1,se);let ne=te(K,"PURCHASE")||J(K,0,"PURCHASE"),ue=te(K,"SALES")||J(K,1,J(K,0,"SALES"));const oe=["ITEM_NAME*","ITEM_TYPE*","ITEM_CATEGORY","ITEM_GROUP","BASE_UOM*","BARCODE","STANDARD_COST","SELLING_PRICE","CURRENCY_CODE","VAT_PURCHASE_CODE","VAT_SALES_CODE","PURCHASE_ACCOUNT_CODE","SALES_ACCOUNT_CODE","DESCRIPTION","IS_STOCKABLE","IS_SELLABLE","IS_PURCHASABLE","MIN_STOCK_LEVEL","MAX_STOCK_LEVEL","REORDER_LEVEL"],le=[["Raw Material 1","RAW_MATERIAL","","","PCS","","100.00","120.00","GHS",se,ae,ne,ue,"Sample raw material","Y","Y","Y","10","100","20"],["Finished Good 1","FINISHED_GOOD","","","PCS","5060072082361","150.00","180.00","GHS",se,ae,ne,ue,"Sample finished product","Y","Y","Y","5","50","10"]],X=[oe.join(","),...le.map(Le=>Le.join(","))].join(`
`),me=new Blob([X],{type:"text/csv;charset=utf-8;"}),we=URL.createObjectURL(me),Ie=document.createElement("a");Ie.href=we,Ie.download="items_bulk_upload_template.csv",document.body.appendChild(Ie),Ie.click(),document.body.removeChild(Ie),setTimeout(()=>URL.revokeObjectURL(we),100)},G=()=>{const K=[["item_code","item_name","item_type","category_name","uom","barcode","stock_level","cost_price","selling_price","is_active"].join(","),...q.map(ae=>[ae.item_code??"",ae.item_name??"",ae.item_type??"",ae.category_name??"",ae.uom??"",ae.barcode??"",ae.stock_level??"",ae.cost_price??"",ae.selling_price??"",ae.is_active?"Y":"N"].map(ne=>{const ue=String(ne);return ue.includes(",")||ue.includes('"')||ue.includes(`
`)?`"${ue.replace(/"/g,'""')}"`:ue}).join(","))].join(`
`),J=new Blob([K],{type:"text/csv;charset=utf-8;"}),te=URL.createObjectURL(J),se=document.createElement("a");se.href=te,se.download="items_export.csv",document.body.appendChild(se),se.click(),document.body.removeChild(se),setTimeout(()=>URL.revokeObjectURL(te),100)};return f.useEffect(()=>{j(1)},[o,u,h,p,x]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Items Master"}),e.jsx("p",{className:"text-sm mt-1 text-slate-500 dark:text-slate-400",children:"Configure items, UOM, pricing and barcodes"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap w-full md:w-auto justify-start md:justify-end",children:[e.jsx(Re,{to:"/inventory",className:"btn-secondary",children:"Return to Menu"}),e.jsx("input",{type:"file",ref:F,onChange:C,className:"hidden",accept:".csv"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:V,children:"Bulk Upload"}),e.jsx("button",{type:"button",className:"btn-outline",onClick:B,children:"Download Template"}),e.jsx("button",{type:"button",className:"btn-outline",onClick:G,children:"Export Items"}),e.jsx(Re,{to:"/inventory/items/new",className:"btn-primary",children:"+ New Item"})]})]})}),e.jsxs("div",{className:"card-body",children:[i?e.jsx("div",{className:"text-sm text-red-600 mb-4",children:i}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3 mb-4",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"text",placeholder:"Search by code, name, barcode...",className:"input w-full",value:o,onChange:O=>d(O.target.value)})}),e.jsx("div",{children:e.jsxs("select",{className:"input w-full",value:u,onChange:O=>c(O.target.value),children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"RAW_MATERIAL",children:"Raw Material"}),e.jsx("option",{value:"FINISHED_GOOD",children:"Finished Good"}),e.jsx("option",{value:"SEMI_FINISHED",children:"Semi-Finished"}),e.jsx("option",{value:"CONSUMABLE",children:"Consumable"}),e.jsx("option",{value:"SERVICE",children:"Service"})]})}),e.jsx("div",{children:e.jsxs("select",{className:"input w-full",value:h,onChange:O=>m(O.target.value),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"Y",children:"Active"}),e.jsx("option",{value:"N",children:"Inactive"})]})}),e.jsx("div",{children:e.jsxs("select",{className:"input w-full",value:p,onChange:O=>g(O.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Y",children:"With Barcode"}),e.jsx("option",{value:"N",children:"Without Barcode"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"p-3 bg-white rounded border",children:[e.jsx("div",{className:"text-2xl font-bold",children:M.total}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total Items"})]}),e.jsxs("div",{className:"p-3 bg-white rounded border",children:[e.jsx("div",{className:"text-2xl font-bold",children:M.active}),e.jsx("div",{className:"text-sm text-slate-500",children:"Active Items"})]}),e.jsxs("div",{className:"p-3 bg-white rounded border",children:[e.jsx("div",{className:"text-2xl font-bold",children:M.lowStock}),e.jsx("div",{className:"text-sm text-slate-500",children:"Low Stock"})]}),e.jsxs("div",{className:"p-3 bg-white rounded border",children:[e.jsx("div",{className:"text-2xl font-bold",children:M.inactive}),e.jsx("div",{className:"text-sm text-slate-500",children:"Inactive Items"})]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"text-sm text-slate-600",children:["Showing ",Math.min(Q.length,q.length)," of"," ",q.length," items"]}),e.jsx("div",{children:e.jsxs("select",{className:"input",value:x,onChange:O=>b(Number(O.target.value)),children:[e.jsx("option",{value:10,children:"10 per page"}),e.jsx("option",{value:25,children:"25 per page"}),e.jsx("option",{value:50,children:"50 per page"}),e.jsx("option",{value:100,children:"100 per page"})]})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{onClick:()=>L("item_code"),children:"Item Code"}),e.jsx("th",{onClick:()=>L("item_name"),children:"Item Name"}),e.jsx("th",{onClick:()=>L("item_type"),children:"Type"}),e.jsx("th",{onClick:()=>L("category_name"),children:"Category"}),e.jsx("th",{onClick:()=>L("group_name"),children:"Group"}),e.jsx("th",{onClick:()=>L("uom"),children:"UOM"}),e.jsx("th",{children:"Barcode"}),e.jsx("th",{onClick:()=>L("stock_level"),children:"Stock Level"}),e.jsx("th",{className:"text-right",onClick:()=>L("cost_price"),children:"Std Cost"}),e.jsx("th",{className:"text-right",onClick:()=>L("selling_price"),children:"Sell Price"}),e.jsx("th",{onClick:()=>L("is_active"),children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[a?e.jsx("tr",{children:e.jsx("td",{colSpan:"11",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):null,!a&&!Q.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"11",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No items found"})}):null,Q.map(O=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:O.item_code}),e.jsx("td",{children:O.item_name}),e.jsx("td",{children:O.item_type_name||O.item_type||"-"}),e.jsx("td",{children:O.category_name||"-"}),e.jsx("td",{children:O.group_name||"-"}),e.jsx("td",{children:O.uom}),e.jsx("td",{children:O.barcode||"-"}),e.jsx("td",{children:O.stock_level??"-"}),e.jsx("td",{className:"text-right",children:Number(O.cost_price||0).toFixed(2)}),e.jsx("td",{className:"text-right",children:Number(O.selling_price||0).toFixed(2)}),e.jsx("td",{children:e.jsx("span",{className:`badge ${O.is_active?"badge-success":"badge-error"}`,children:O.is_active?"ACTIVE":"INACTIVE"})}),e.jsxs("td",{children:[t("inventory:items","view")&&e.jsx(Re,{to:`/inventory/items/${O.id}?mode=view`,className:"text-brand hover:text-brand-700 text-sm font-medium",children:"View"}),t("inventory:items","edit")&&e.jsx(Re,{to:`/inventory/items/${O.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"})]})]},O.id))]})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center py-3 border-t gap-4",children:[e.jsxs("div",{className:"text-sm text-slate-600 order-2 md:order-1",children:["Page ",y," of ",z]}),e.jsxs("div",{className:"flex gap-2 items-center order-1 md:order-2",children:[e.jsx("button",{className:"btn-success",disabled:y===1,onClick:()=>j(1),children:""}),e.jsx("button",{className:"btn-success",disabled:y===1,onClick:()=>j(O=>Math.max(1,O-1)),children:""}),e.jsxs("span",{className:"text-sm",children:[(y-1)*x+1,"-",Math.min(y*x,q.length)," of"," ",q.length]}),e.jsx("button",{className:"btn-success",disabled:y===z,onClick:()=>j(O=>Math.min(z,O+1)),children:""}),e.jsx("button",{className:"btn-success",disabled:y===z,onClick:()=>j(z),children:""})]})]})]})]}),I&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"w-[96vw] max-w-[1100px] max-h-[85vh] bg-white rounded-xl shadow-erp-lg overflow-hidden border border-slate-200",children:[e.jsxs("div",{className:"px-4 py-3 bg-brand text-white flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold",children:"Bulk Upload Preview"}),e.jsx("div",{className:"text-xs opacity-90",children:"Review parsed rows. Only valid rows will be uploaded."})]}),e.jsx("button",{type:"button",className:"text-white hover:text-slate-100 text-xl",onClick:()=>{w(!1),U([]),W([])},"aria-label":"Close",children:""})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"overflow-auto",style:{maxHeight:"55vh"},children:e.jsx("div",{className:"min-w-[960px]",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsx("tr",{children:E.map(O=>e.jsx("th",{children:O},O))})}),e.jsx("tbody",{children:R.map(O=>e.jsxs("tr",{className:O.valid?"":"bg-red-50",children:[e.jsx("td",{children:O.index}),e.jsx("td",{children:O.preview.item_code||"-"}),e.jsx("td",{children:O.preview.item_name||"-"}),e.jsx("td",{children:O.preview.item_type||"-"}),e.jsx("td",{children:O.preview.category_label||"-"}),e.jsx("td",{children:O.preview.category_name||"-"}),e.jsx("td",{children:O.preview.group_label||"-"}),e.jsx("td",{children:O.preview.group_name||"-"}),e.jsx("td",{children:O.preview.uom||"-"}),e.jsx("td",{children:O.preview.barcode||"-"}),e.jsx("td",{children:O.valid?e.jsx("span",{className:"text-green-700 font-medium",children:"OK"}):e.jsx("span",{className:"text-red-700 text-sm",children:O.errors.join("; ")})})]},O.index))})]})})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"btn",onClick:()=>{w(!1),U([]),W([])},children:"Cancel"}),e.jsx("button",{type:"button",className:"btn-success",onClick:k,disabled:T,children:T?"Uploading...":"Upload Valid Rows"})]})]})]})})]})}function oF(){const t=Rj(),s=ud(i=>i.inventoryRef.categories),r=ud(i=>i.inventoryRef.status.categories),a=ud(i=>i.inventoryRef.error.categories),n=f.useCallback(()=>{t(sf())},[t]);return f.useEffect(()=>{(r==="idle"||r==="failed"&&(!Array.isArray(s)||s.length===0))&&t(sf())},[s,t,r]),{categories:s,loading:r==="loading",error:a,refresh:n}}function cF(){const t=Rj(),s=ud(i=>i.inventoryRef.itemTypes),r=ud(i=>{var l;return(l=i.inventoryRef.status)==null?void 0:l.itemTypes}),a=ud(i=>{var l;return(l=i.inventoryRef.error)==null?void 0:l.itemTypes}),n=f.useCallback(()=>{t(Am())},[t]);return f.useEffect(()=>{const i=Array.isArray(s)&&s.length>0;if(r==null){t(Am());return}if(r==="idle"){t(Am());return}r==="failed"&&!i&&t(Am())},[t,s,r]),{itemTypes:s,loading:r==="loading",error:a,refresh:n}}function nee(){const{uoms:t,loading:s}=$i(),{categories:r,loading:a}=oF(),{itemTypes:n,loading:i}=cF();console.log("ItemForm mounting");const{id:l}=Ps(),o=ps(),d=l==="new",[u,c]=f.useState(!1),[h,m]=f.useState(!1),[p,g]=f.useState(!1),[x,b]=f.useState(""),[y,j]=f.useState([]),[N,_]=f.useState([]),[F,I]=f.useState([]),[w,E]=f.useState([]),[W,R]=f.useState({item_code:"",item_name:"",uom:"PCS",barcode:"",cost_price:0,selling_price:0,currency_id:"",image_url:"",is_active:!0,item_type:"",category_id:"",item_group_id:"",description:"",min_stock_level:0,max_stock_level:0,reorder_level:0,safety_stock:0,vat_on_purchase_id:"",vat_on_sales_id:"",purchase_account_id:"",sales_account_id:"",service_item:!1,is_stockable:!0,is_sellable:!0,is_purchasable:!0});f.useEffect(()=>{if(Promise.all([Z.get("/inventory/item-groups"),Z.get("/finance/accounts").catch(()=>({data:{items:[]}})),Z.get("/finance/tax-codes").catch(()=>({data:{items:[]}})),Z.get("/finance/currencies").catch(()=>({data:{items:[]}}))]).then(([H,M,q,z])=>{var Q,L,V,P;j(Array.isArray((Q=H.data)==null?void 0:Q.items)?H.data.items:[]),_(Array.isArray((L=M.data)==null?void 0:L.items)?M.data.items:[]),I(Array.isArray((V=q.data)==null?void 0:V.items)?q.data.items:[]),E(Array.isArray((P=z.data)==null?void 0:P.items)?z.data.items:[])}).catch(()=>{}),d){Z.get("/inventory/items/next-code").then(H=>{var M;(M=H.data)!=null&&M.nextCode&&R(q=>({...q,item_code:H.data.nextCode}))}).catch(()=>{});return}let Y=!0;return c(!0),b(""),Z.get(`/inventory/items/${l}`).then(H=>{var q;if(!Y)return;const M=(q=H.data)==null?void 0:q.item;M&&R({item_code:M.item_code||"",item_name:M.item_name||"",uom:M.uom||"PCS",barcode:M.barcode||"",cost_price:Number(M.cost_price||0),selling_price:Number(M.selling_price||0),currency_id:M.currency_id||"",image_url:M.image_url||"",is_active:!!M.is_active,item_type:M.item_type||"",category_id:M.category_id||"",item_group_id:M.item_group_id||"",description:M.description||"",min_stock_level:Number(M.min_stock_level||0),max_stock_level:Number(M.max_stock_level||0),reorder_level:Number(M.reorder_level||0),safety_stock:Number(M.safety_stock||0),vat_on_purchase_id:M.vat_on_purchase_id||"",vat_on_sales_id:M.vat_on_sales_id||"",purchase_account_id:M.purchase_account_id||"",sales_account_id:M.sales_account_id||"",service_item:String(M.service_item||"").toUpperCase()==="Y",is_stockable:String(M.is_stockable??"Y").toUpperCase()==="Y",is_sellable:String(M.is_sellable??"Y").toUpperCase()==="Y",is_purchasable:String(M.is_purchasable??"Y").toUpperCase()==="Y"})}).catch(H=>{var M,q;Y&&b(((q=(M=H==null?void 0:H.response)==null?void 0:M.data)==null?void 0:q.message)||"Failed to load item")}).finally(()=>{Y&&c(!1)}),()=>{Y=!1}},[l,d]);const U=async Y=>{const H=Y.target.files[0];if(!H)return;const M=new FormData;M.append("file",H),g(!0);try{const q=await Z.post("/upload",M);R(z=>({...z,image_url:q.data.url})),ct.success("Image uploaded successfully")}catch(q){console.error(q),ct.error("Failed to upload image")}finally{g(!1)}},T=async Y=>{var H,M;Y.preventDefault(),m(!0),b("");try{const q={item_code:W.item_code,item_name:W.item_name,uom:W.uom,barcode:W.barcode||null,cost_price:Number(W.cost_price)||0,selling_price:Number(W.selling_price)||0,currency_id:W.currency_id||null,is_active:!!W.is_active,item_type:W.item_type||null,category_id:W.category_id||null,item_group_id:W.item_group_id||null,description:W.description||null,min_stock_level:Number(W.min_stock_level)||0,max_stock_level:Number(W.max_stock_level)||0,reorder_level:Number(W.reorder_level)||0,safety_stock:Number(W.safety_stock)||0,vat_on_purchase_id:W.vat_on_purchase_id||null,vat_on_sales_id:W.vat_on_sales_id||null,purchase_account_id:W.purchase_account_id||null,sales_account_id:W.sales_account_id||null,service_item:W.service_item?"Y":"N",is_stockable:W.is_stockable?"Y":"N",is_sellable:W.is_sellable?"Y":"N",is_purchasable:W.is_purchasable?"Y":"N"};d?await Z.post("/inventory/items",q):await Z.put(`/inventory/items/${l}`,q),o("/inventory/items")}catch(q){b(((M=(H=q==null?void 0:q.response)==null?void 0:H.data)==null?void 0:M.message)||"Failed to save item")}finally{m(!1)}};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center text-white gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:d?"New Item":"Edit Item"}),e.jsx("p",{className:"text-sm mt-1",children:"Define item attributes, pricing and stock rules"})]}),e.jsx(Re,{to:"/inventory/items",className:"btn-success w-full md:w-auto text-center",children:"Back to List"})]})}),e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[u?e.jsx("div",{className:"text-sm",children:"Loading..."}):null,x?e.jsx("div",{className:"text-sm text-red-600",children:x}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Item Code * (System Generated)"}),e.jsx("input",{type:"text",className:"input bg-gray-100 cursor-not-allowed",value:W.item_code,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Item Name *"}),e.jsx("input",{type:"text",className:"input",value:W.item_name,onChange:Y=>R({...W,item_name:Y.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Barcode"}),e.jsx("input",{type:"text",className:"input",value:W.barcode,onChange:Y=>R({...W,barcode:Y.target.value}),placeholder:"Scan or enter barcode"})]})]})}),e.jsxs("div",{className:"flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-lg p-4 bg-gray-50",children:[W.image_url?e.jsxs("div",{className:"relative w-full h-40 mb-2",children:[e.jsx("img",{src:W.image_url,alt:"Item",className:"w-full h-full object-contain"}),e.jsx("button",{type:"button",className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs",onClick:()=>R({...W,image_url:""}),children:""})]}):e.jsxs("div",{className:"text-gray-400 mb-2 flex flex-col items-center",children:[e.jsx("svg",{className:"w-12 h-12 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:"No Image"})]}),e.jsxs("label",{className:`btn-secondary cursor-pointer ${p?"opacity-50 cursor-not-allowed":""}`,children:[p?"Uploading...":"Upload Image",e.jsx("input",{type:"file",className:"hidden",onChange:U,accept:"image/*",disabled:p})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Item Type *"}),e.jsxs("select",{className:"input",value:W.item_type,onChange:Y=>R({...W,item_type:Y.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Type --"}),i?e.jsx("option",{children:"Loading..."}):(Array.isArray(n)?n:[]).map(Y=>Y?e.jsx("option",{value:Y.type_code,children:Y.type_name},Y.id):null)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Category"}),e.jsxs("select",{className:"input",value:W.category_id,onChange:Y=>R({...W,category_id:Y.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Category --"}),a?e.jsx("option",{children:"Loading..."}):r.map(Y=>Y?e.jsx("option",{value:Y.id,children:Y.category_name},Y.id):null)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Base UOM"}),e.jsxs("select",{className:"input",value:W.uom,onChange:Y=>R({...W,uom:Y.target.value}),children:[e.jsx("option",{value:"",children:"-- Select UOM --"}),s?e.jsx("option",{children:"Loading..."}):t.map(Y=>e.jsx("option",{value:Y.uom_code,children:Y.uom_code},Y.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Item Group"}),e.jsxs("select",{className:"input",value:W.item_group_id,onChange:Y=>R({...W,item_group_id:Y.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Group --"}),y.map(Y=>Y?e.jsx("option",{value:Y.id,children:Y.group_name},Y.id):null)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:W.is_active?"ACTIVE":"INACTIVE",onChange:Y=>R({...W,is_active:Y.target.value==="ACTIVE"}),children:[e.jsx("option",{value:"ACTIVE",children:"ACTIVE"}),e.jsx("option",{value:"INACTIVE",children:"INACTIVE"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Cost Price"}),e.jsx("input",{type:"number",className:"input",value:W.cost_price,onChange:Y=>R({...W,cost_price:Y.target.value}),min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Selling Price"}),e.jsx("input",{type:"number",className:"input",value:W.selling_price,onChange:Y=>R({...W,selling_price:Y.target.value}),min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsxs("select",{className:"input",value:W.currency_id,onChange:Y=>R({...W,currency_id:Y.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Currency --"}),w.map(Y=>e.jsxs("option",{value:Y.id,children:[Y.code," - ",Y.name]},Y.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 border-t pt-4",children:[e.jsx("h3",{className:"col-span-full font-semibold text-gray-700",children:"Financial Details"}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"TAX on Purchase"}),e.jsxs("select",{className:"input",value:W.vat_on_purchase_id,onChange:Y=>R({...W,vat_on_purchase_id:Y.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Tax Code --"}),F.map(Y=>e.jsxs("option",{value:Y.id,children:[Y.code," (",Number(Y.rate_percent),"%)"]},Y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"TAX on Sales"}),e.jsxs("select",{className:"input",value:W.vat_on_sales_id,onChange:Y=>R({...W,vat_on_sales_id:Y.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Tax Code --"}),F.map(Y=>e.jsxs("option",{value:Y.id,children:[Y.code," (",Number(Y.rate_percent),"%)"]},Y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Purchase Account"}),e.jsxs("select",{className:"input",value:W.purchase_account_id,onChange:Y=>R({...W,purchase_account_id:Y.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Account --"}),N.filter(Y=>!Y.nature||["EXPENSE","COST_OF_SALES"].includes(Y.nature)).map(Y=>e.jsxs("option",{value:Y.id,children:[Y.code," - ",Y.name]},Y.id)),e.jsx("option",{disabled:!0,children:""}),N.map(Y=>e.jsxs("option",{value:Y.id,children:[Y.code," - ",Y.name]},`all-${Y.id}`))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Sales Account"}),e.jsxs("select",{className:"input",value:W.sales_account_id,onChange:Y=>R({...W,sales_account_id:Y.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Account --"}),N.filter(Y=>!Y.group_name||Y.group_name.toUpperCase().includes("INCOME")||Y.group_name.toUpperCase().includes("REVENUE")||Y.group_name.toUpperCase().includes("SALES")).map(Y=>e.jsxs("option",{value:Y.id,children:[Y.code," - ",Y.name]},Y.id)),e.jsx("option",{disabled:!0,children:""}),N.map(Y=>e.jsxs("option",{value:Y.id,children:[Y.code," - ",Y.name]},`all-${Y.id}`))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("textarea",{className:"input",value:W.description,onChange:Y=>R({...W,description:Y.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Min Stock Level"}),e.jsx("input",{type:"number",className:"input",value:W.min_stock_level,onChange:Y=>R({...W,min_stock_level:Y.target.value}),min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Max Stock Level"}),e.jsx("input",{type:"number",className:"input",value:W.max_stock_level,onChange:Y=>R({...W,max_stock_level:Y.target.value}),min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Reorder Level"}),e.jsx("input",{type:"number",className:"input",value:W.reorder_level,onChange:Y=>R({...W,reorder_level:Y.target.value}),min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Safety Stock"}),e.jsx("input",{type:"number",className:"input",value:W.safety_stock,onChange:Y=>R({...W,safety_stock:Y.target.value}),min:"0"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[e.jsx("input",{type:"checkbox",checked:W.service_item,onChange:Y=>R({...W,service_item:Y.target.checked})}),e.jsx("span",{children:"Service Item"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[e.jsx("input",{type:"checkbox",checked:W.is_stockable,onChange:Y=>R({...W,is_stockable:Y.target.checked})}),e.jsx("span",{children:"Is Stockable"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[e.jsx("input",{type:"checkbox",checked:W.is_sellable,onChange:Y=>R({...W,is_sellable:Y.target.checked})}),e.jsx("span",{children:"Is Sellable"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[e.jsx("input",{type:"checkbox",checked:W.is_purchasable,onChange:Y=>R({...W,is_purchasable:Y.target.checked})}),e.jsx("span",{children:"Is Purchasable"})]})]}),e.jsxs("div",{className:"flex flex-col-reverse md:flex-row justify-end gap-3 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx(Re,{to:"/inventory/items",className:"btn-secondary w-full md:w-auto text-center",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary w-full md:w-auto",disabled:h,children:h?"Saving...":"Save Item"})]})]})})]})})}function iee(){const{canPerformAction:t}=Ls(),[s,r]=f.useState(""),[a,n]=f.useState([]),[i,l]=f.useState(!1),[o,d]=f.useState("");f.useEffect(()=>{let c=!0;return l(!0),d(""),Z.get("/inventory/warehouses").then(h=>{var m;c&&n(Array.isArray((m=h.data)==null?void 0:m.items)?h.data.items:[])}).catch(h=>{var m,p;c&&d(((p=(m=h==null?void 0:h.response)==null?void 0:m.data)==null?void 0:p.message)||"Failed to load warehouses")}).finally(()=>{c&&l(!1)}),()=>{c=!1}},[]);const u=f.useMemo(()=>{const c=s.toLowerCase();return a.filter(h=>String(h.warehouse_code||"").toLowerCase().includes(c)||String(h.warehouse_name||"").toLowerCase().includes(c)||String(h.location||"").toLowerCase().includes(c))},[a,s]);return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Warehouse Setup"}),e.jsx("p",{className:"text-sm mt-1",children:"Configure warehouses for stock operations"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/inventory/warehouses/new",className:"btn-success",children:"+ New Warehouse"})]})]})}),e.jsxs("div",{className:"card-body",children:[o?e.jsx("div",{className:"text-sm text-red-600 mb-4",children:o}):null,e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by code, name, location...",className:"input max-w-md",value:s,onChange:c=>r(c.target.value)})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Location"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[i?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):null,!i&&!u.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No warehouses found"})}):null,u.map(c=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:c.warehouse_code}),e.jsx("td",{children:c.warehouse_name}),e.jsx("td",{children:c.location||"-"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${c.is_active?"badge-success":"badge-error"}`,children:c.is_active?"ACTIVE":"INACTIVE"})}),e.jsxs("td",{children:[t("inventory:warehouses","view")&&e.jsx(Re,{to:`/inventory/warehouses/${c.id}?mode=view`,className:"text-brand hover:text-brand-700 text-sm font-medium",children:"View"}),t("inventory:warehouses","edit")&&e.jsx(Re,{to:`/inventory/warehouses/${c.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"})]})]},c.id))]})]})})]})]})})}function lee(){const{id:t}=Ps(),s=ps(),r=t==="new",{scope:a}=Kr(),[n,i]=f.useState(!1),[l,o]=f.useState(!1),[d,u]=f.useState(""),[c,h]=f.useState({warehouse_code:"",warehouse_name:"",location:"",is_active:!0}),[m,p]=f.useState([]),[g,x]=f.useState(""),[b,y]=f.useState("");f.useEffect(()=>{let N=!0;return u(""),Z.get("/admin/branches").then(_=>{var w;if(!N)return;const F=Array.isArray((w=_.data)==null?void 0:w.items)?_.data.items:[];p(F);const I=String((a==null?void 0:a.branchId)||"")||(F.length?String(F[0].id):"");x(I)}).catch(()=>{}),()=>{N=!1}},[a==null?void 0:a.branchId]),f.useEffect(()=>{if(r)return;let N=!0;return i(!0),u(""),Z.get(`/inventory/warehouses/${t}`).then(_=>{var I;if(!N)return;const F=(I=_.data)==null?void 0:I.item;F&&(h({warehouse_code:F.warehouse_code||"",warehouse_name:F.warehouse_name||"",location:F.location||"",is_active:!!F.is_active}),F.branch_id&&(x(String(F.branch_id)),y(String(F.branch_id))))}).catch(_=>{var F,I;N&&u(((I=(F=_==null?void 0:_.response)==null?void 0:F.data)==null?void 0:I.message)||"Failed to load warehouse")}).finally(()=>{N&&i(!1)}),()=>{N=!1}},[t,r]);const j=async N=>{var _,F;N.preventDefault(),o(!0),u("");try{if(!g)throw new Error("Select a branch for this warehouse");const I=m.find(W=>String(W.id)===String(g)),w=I?Number(I.company_id):void 0,E={warehouse_code:c.warehouse_code,warehouse_name:c.warehouse_name,location:c.location||null,is_active:!!c.is_active};r?await Z.post("/inventory/warehouses",E,{headers:{"x-branch-id":String(g),...w?{"x-company-id":String(w)}:{}}}):(b&&String(b)!==String(g)&&await Z.put(`/inventory/warehouses/${t}/link-branch`,{branch_id:Number(g)},{headers:{...w?{"x-company-id":String(w)}:{}}}),await Z.put(`/inventory/warehouses/${t}`,E,{headers:{"x-branch-id":String(g),...w?{"x-company-id":String(w)}:{}}})),s("/inventory/warehouses")}catch(I){u(((F=(_=I==null?void 0:I.response)==null?void 0:_.data)==null?void 0:F.message)||"Failed to save warehouse")}finally{o(!1)}};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"New Warehouse":"Edit Warehouse"}),e.jsx("p",{className:"text-sm mt-1",children:"Maintain warehouse master data"})]}),e.jsx(Re,{to:"/inventory/warehouses",className:"btn-success",children:"Back to List"})]})}),e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[n?e.jsx("div",{className:"text-sm",children:"Loading..."}):null,d?e.jsx("div",{className:"text-sm text-red-600",children:d}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Branch *"}),e.jsxs("select",{className:"input",value:g,onChange:N=>x(N.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select a branch"}),m.map(N=>e.jsxs("option",{value:String(N.id),children:[N.name," (",N.company_name||`Company #${N.company_id}`,")"]},N.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Warehouse Code *"}),e.jsx("input",{type:"text",className:"input",value:c.warehouse_code,onChange:N=>h({...c,warehouse_code:N.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Warehouse Name *"}),e.jsx("input",{type:"text",className:"input",value:c.warehouse_name,onChange:N=>h({...c,warehouse_name:N.target.value}),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Location"}),e.jsx("input",{type:"text",className:"input",value:c.location,onChange:N=>h({...c,location:N.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:c.is_active?"ACTIVE":"INACTIVE",onChange:N=>h({...c,is_active:N.target.value==="ACTIVE"}),children:[e.jsx("option",{value:"ACTIVE",children:"ACTIVE"}),e.jsx("option",{value:"INACTIVE",children:"INACTIVE"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx(Re,{to:"/inventory/warehouses",className:"btn-success",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-success",disabled:l,children:l?"Saving...":"Save Warehouse"})]})]})})]})})}function oee(){const{canPerformAction:t}=Ls(),[s,r]=f.useState(""),[a,n]=f.useState([]),[i,l]=f.useState(!1),[o,d]=f.useState(""),[u,c]=f.useState(!1),[h,m]=f.useState(!1),[p,g]=f.useState(""),[x,b]=f.useState(null),[y,j]=f.useState(null),[N,_]=f.useState([]),[F,I]=f.useState(null),[w,E]=f.useState(null),[W,R]=f.useState(null),[U,T]=f.useState(null),[Y,H]=f.useState(!1),[M,q]=f.useState(!1),[z,Q]=f.useState(""),[L,V]=f.useState(null),[P,C]=f.useState([]),[k,B]=f.useState(""),[G,O]=f.useState(!1);f.useEffect(()=>{let oe=!0;return l(!0),d(""),Z.get("/inventory/grn",{params:{grn_type:"LOCAL"}}).then(le=>{var X;oe&&n(Array.isArray((X=le.data)==null?void 0:X.items)?le.data.items:[])}).catch(le=>{var X,me;oe&&d(((me=(X=le==null?void 0:le.response)==null?void 0:X.data)==null?void 0:me.message)||"Failed to load GRNs")}).finally(()=>{oe&&l(!1)}),()=>{oe=!1}},[]);const K=f.useMemo(()=>{const oe=s.toLowerCase();return a.filter(le=>String(le.grn_no||"").toLowerCase().includes(oe)||String(le.supplier_name||"").toLowerCase().includes(oe)||String(le.status||"").toLowerCase().includes(oe))},[a,s]),J=oe=>{const le=String(oe||"").toUpperCase();return le!=="PENDING_APPROVAL"&&le!=="APPROVED"&&le!=="CANCELLED"},te=async oe=>{var le,X,me,we,Ie,_e;E(null),c(!0),g("");try{const Fe=await Z.get(`/inventory/grn/${oe.id}`),Le=((le=Fe==null?void 0:Fe.data)==null?void 0:le.item)||{},rt=Le==null?void 0:Le.invoice_amount,He=rt===""||rt==null?null:Number(rt||0);E({id:oe.id,grn_no:oe.grn_no,invoice_amount:He,status:oe.status})}catch(Fe){g(((me=(X=Fe==null?void 0:Fe.response)==null?void 0:X.data)==null?void 0:me.message)||"Failed to load GRN")}if(x)await se();else try{m(!0);const Fe=await Z.get("/workflows"),Le=Array.isArray((we=Fe.data)==null?void 0:we.items)?Fe.data.items:[];b(Le),await ae(Le)}catch(Fe){g(((_e=(Ie=Fe==null?void 0:Fe.response)==null?void 0:Ie.data)==null?void 0:_e.message)||"Failed to load workflows")}finally{m(!1)}},se=async()=>{var Ie,_e,Fe;if(!x||!x.length){j(null),I(null),g(""),O(!1);return}const oe="/inventory/grn-local",le=Le=>String(Le||"").trim().toUpperCase().replace(/\s+/g,"_"),me=x.filter(Le=>String(Le.document_route)===oe||["GOODS_RECEIPT","GRN","GOODS_RECEIPT_NOTE"].includes(le(Le.document_type))).some(Le=>Number(Le.is_active)===0),we=x.find(Le=>Number(Le.is_active)===1&&String(Le.document_route)===oe)||x.find(Le=>Number(Le.is_active)===1&&["GOODS_RECEIPT","GRN","GOODS_RECEIPT_NOTE"].includes(le(Le.document_type)))||null;if(j(we||null),O(!we&&me),I(null),!!we)try{m(!0);const rt=(Ie=(await Z.get(`/workflows/${we.id}`)).data)==null?void 0:Ie.item,He=Array.isArray(rt==null?void 0:rt.steps)?rt.steps:[];_(He);const st=He[0]||null;if(I(st?{userId:st.approver_user_id,name:st.approver_name,stepName:st.step_name,stepOrder:st.step_order,approvalLimit:st.approval_limit}:null),st){const De=(Array.isArray(st.approvers)&&st.approvers.length?st.approvers[0].id:st.approver_user_id)||null;R(De)}else R(null)}catch(Le){g(((Fe=(_e=Le==null?void 0:Le.response)==null?void 0:_e.data)==null?void 0:Fe.message)||"Failed to load workflow details")}finally{m(!1)}},ae=async oe=>{var _e,Fe,Le;if(!oe||!oe.length){j(null),I(null),g(""),O(!1);return}const le="/inventory/grn-local",X=rt=>String(rt||"").trim().toUpperCase().replace(/\s+/g,"_"),we=oe.filter(rt=>String(rt.document_route)===le||["GOODS_RECEIPT","GRN","GOODS_RECEIPT_NOTE"].includes(X(rt.document_type))).some(rt=>Number(rt.is_active)===0),Ie=oe.find(rt=>Number(rt.is_active)===1&&String(rt.document_route)===le)||oe.find(rt=>Number(rt.is_active)===1&&["GOODS_RECEIPT","GRN","GOODS_RECEIPT_NOTE"].includes(X(rt.document_type)))||null;if(j(Ie||null),O(!Ie&&we),I(null),!!Ie)try{m(!0);const He=(_e=(await Z.get(`/workflows/${Ie.id}`)).data)==null?void 0:_e.item,st=Array.isArray(He==null?void 0:He.steps)?He.steps:[];_(st);const De=st[0]||null;if(I(De?{userId:De.approver_user_id,name:De.approver_name,stepName:De.step_name,stepOrder:De.step_order,approvalLimit:De.approval_limit}:null),De){const Te=(Array.isArray(De.approvers)&&De.approvers.length?De.approvers[0].id:De.approver_user_id)||null;R(Te)}else R(null)}catch(rt){g(((Le=(Fe=rt==null?void 0:rt.response)==null?void 0:Fe.data)==null?void 0:Le.message)||"Failed to load workflow details")}finally{m(!1)}},ne=async()=>{var oe,le;if(w){T(w.id),g("");try{await Z.post(`/inventory/grn/${w.id}/submit`,{amount:w.invoice_amount,workflow_id:y?y.id:null,target_user_id:W||null}),n(X=>X.map(me=>me.id===w.id?{...me,status:"PENDING_APPROVAL"}:me)),c(!1)}catch(X){g(((le=(oe=X==null?void 0:X.response)==null?void 0:oe.data)==null?void 0:le.message)||"Failed to forward for approval")}finally{T(null)}}},ue=async oe=>{var le,X,me,we;H(!0),q(!0),Q(""),V(null),C([]),B("");try{const Ie=await Z.get(`/inventory/grn/${oe.id}`),_e=((le=Ie==null?void 0:Ie.data)==null?void 0:le.item)||{},Fe=Array.isArray(_e==null?void 0:_e.details)?_e.details:[];V(_e),C(Fe);const Le=Number((_e==null?void 0:_e.po_id)||0)||0;if(Le)try{const rt=await Z.get("/purchase/orders"),st=(Array.isArray((X=rt==null?void 0:rt.data)==null?void 0:X.items)?rt.data.items:[]).find(De=>Number(De.id)===Le);B(st?st.po_no||String(st.id):String(Le))}catch{B(String(Le))}}catch(Ie){Q(((we=(me=Ie==null?void 0:Ie.response)==null?void 0:me.data)==null?void 0:we.message)||"Failed to load GRN details")}finally{q(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Material Receipt (GRN) - Local"}),e.jsx("p",{className:"text-sm mt-1",children:"Receive local purchase deliveries"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/inventory/grn-local/new",className:"btn-success",children:"+ New GRN"})]})]})}),e.jsxs("div",{className:"card-body",children:[o?e.jsx("div",{className:"text-sm text-red-600 mb-4",children:o}):null,e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by GRN no, supplier, status...",className:"input max-w-md",value:s,onChange:oe=>r(oe.target.value)})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"GRN No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{children:"Warehouse"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[i?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):null,!i&&!K.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No GRNs found"})}):null,K.map(oe=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:oe.grn_no}),e.jsx("td",{children:oe.grn_date?String(oe.grn_date).slice(0,10):"-"}),e.jsx("td",{children:oe.supplier_name||"-"}),e.jsx("td",{children:oe.warehouse_name||"-"}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-info",children:oe.status||"DRAFT"})}),e.jsxs("td",{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:`/inventory/grn-local/${oe.id}?mode=view`,className:"text-brand hover:text-brand-700 text-sm font-medium",children:"View"}),e.jsx("button",{type:"button",className:"text-brand hover:text-brand-700 text-sm font-medium",onClick:()=>ue(oe),children:"Details"}),String(oe.status||"").toUpperCase()!=="APPROVED"&&t("inventory:stock-updation","edit")&&e.jsx(Re,{to:`/inventory/grn-local/${oe.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Edit"})]}),String(oe.status||"").toUpperCase()==="APPROVED"?e.jsx("span",{className:"ml-2 text-sm font-medium px-2 py-1 rounded bg-green-500 text-white",children:"Approved"}):e.jsx("button",{type:"button",className:"btn-success ml-2",onClick:()=>te(oe),disabled:U===oe.id||!J(oe.status)||G,children:U===oe.id?"Forwarding...":"Forward for Approval"})]})]},oe.id))]})]})})]})]}),u?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-[640px] max-w-[95%]",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-brand text-white rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Forward GRN for Approval"}),e.jsx("button",{type:"button",onClick:()=>{c(!1),j(null),I(null),g("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Document No:"," ",e.jsx("span",{className:"font-semibold",children:w==null?void 0:w.grn_no})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:y?`${y.workflow_name} (${y.workflow_code})`:"None (inactive)"})]}),e.jsx("div",{children:h?e.jsx("div",{className:"text-sm",children:"Loading workflow..."}):null}),e.jsx("div",{children:p?e.jsx("div",{className:"text-sm text-red-600",children:p}):null}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Target Approver"}),(()=>{const le=Array.isArray(N)&&N.length>0?N[0]:null,X=le?Array.isArray(le.approvers)&&le.approvers.length?le.approvers.map(me=>({id:me.id,name:me.username})):le.approver_user_id?[{id:le.approver_user_id,name:le.approver_name||String(le.approver_user_id)}]:[]:[];return X.length>0?e.jsxs("div",{className:"mt-1",children:[e.jsxs("select",{className:"input w-full",value:W||"",onChange:me=>R(me.target.value?Number(me.target.value):null),children:[e.jsx("option",{value:"",children:"Select target approver"}),X.map(me=>e.jsx("option",{value:me.id,children:me.name},me.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:F?`Step ${F.stepOrder}  ${F.stepName}${F.approvalLimit!=null?`  Limit: ${Number(F.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:y?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})()]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{c(!1),j(null),I(null),g("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:ne,disabled:U!=null,children:U!=null?"Forwarding...":"Forward"})]})]})}):null,Y?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-[900px] max-w-[95%]",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-brand text-white rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"View GRN Details"}),e.jsx("button",{type:"button",onClick:()=>{H(!1),V(null),C([]),Q("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[M?e.jsx("div",{className:"text-sm",children:"Loading..."}):null,z?e.jsx("div",{className:"text-sm text-red-600",children:z}):null,L?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"GRN No"}),e.jsx("div",{className:"font-semibold",children:L.grn_no})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Date"}),e.jsx("div",{className:"font-semibold",children:L.grn_date?String(L.grn_date).slice(0,10):"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Supplier"}),e.jsx("div",{className:"font-semibold",children:L.supplier_name||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Warehouse"}),e.jsx("div",{className:"font-semibold",children:L.warehouse_name||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Status"}),e.jsx("div",{className:"font-semibold",children:L.status||"DRAFT"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Purchase Order"}),e.jsx("div",{className:"font-semibold",children:k||(L.po_id?String(L.po_id):"-")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Delivery No"}),e.jsx("div",{className:"font-semibold",children:L.delivery_number||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Delivery Date"}),e.jsx("div",{className:"font-semibold",children:L.delivery_date?String(L.delivery_date).slice(0,10):"-"})]})]}):null,e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item Code"}),e.jsx("th",{children:"Item Name"}),e.jsx("th",{children:"Ordered Qty"}),e.jsx("th",{children:"Received Qty"}),e.jsx("th",{children:"Accepted Qty"}),e.jsx("th",{children:"UOM"}),e.jsx("th",{children:"Unit Price"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Batch/Serial"}),e.jsx("th",{children:"Remarks"})]})}),e.jsxs("tbody",{children:[P.length?null:e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center py-6 text-slate-500 dark:text-slate-400",children:"No item details"})}),P.map((oe,le)=>{const X=oe.line_amount==null||oe.line_amount===""?Number(oe.qty_accepted||0)*Number(oe.unit_price||0):Number(oe.line_amount||0);return e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:oe.item_code||""}),e.jsx("td",{children:oe.item_name||""}),e.jsx("td",{children:oe.qty_ordered??""}),e.jsx("td",{children:oe.qty_received??""}),e.jsx("td",{children:oe.qty_accepted??""}),e.jsx("td",{children:oe.uom||""}),e.jsx("td",{children:Number(oe.unit_price||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{children:Number(X||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{children:oe.batch_serial||oe.batch_number||""}),e.jsx("td",{children:oe.remarks||""})]},le)})]})]})})]}),e.jsx("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{H(!1),V(null),C([]),Q("")},children:"Close"})})]})}):null]})}function im(t){if(!t)return"";try{return new Date(t).toISOString().slice(0,10)}catch{return""}}function cee(){const{id:t}=Ps(),s=ps(),r=Ur(),a=t==="new",n=!!t&&t!=="new"&&(r.pathname.includes("/edit")||(()=>{try{const Te=new URLSearchParams(r.search||""),Ce=String(Te.get("mode")||"").toLowerCase(),Pe=String(Te.get("edit")||"").toLowerCase();return Ce==="edit"||Pe==="1"||Pe==="true"}catch{return!1}})()),i=!!t&&t!=="new"&&!n,[l,o]=f.useState(!1),[d,u]=f.useState(!1),[c,h]=f.useState(""),[m,p]=f.useState(!1),[g,x]=f.useState(!1),[b,y]=f.useState(""),[j,N]=f.useState(null),[_,F]=f.useState(null),[I,w]=f.useState([]),[E,W]=f.useState(!1),[R,U]=f.useState(null),[T,Y]=f.useState(null),[H,M]=f.useState([]),[q,z]=f.useState([]),[Q,L]=f.useState([]),[V,P]=f.useState([]),{uoms:C}=$i(),[k,B]=f.useState([]),[G,O]=f.useState([]),[K,J]=f.useState({open:!1,itemId:null,defaultUom:"",currentUom:"",lineIdx:null}),[te,se]=f.useState({grn_no:"",grn_date:im(new Date),supplier_id:"",warehouse_id:"",po_id:"",invoice_no:"",invoice_date:"",invoice_amount:"",invoice_due_date:"",delivery_number:"",delivery_date:"",status:"DRAFT",remarks:"",details:[]}),ae=String(te.status||"").toUpperCase()==="APPROVED",ne=i&&ae,ue=f.useRef(a);f.useEffect(()=>{let Te=!0;return h(""),Promise.all([Z.get("/inventory/items"),Z.get("/purchase/suppliers"),Z.get("/inventory/warehouses"),Z.get("/purchase/orders",{params:{status:"APPROVED"}}),Z.get("/sales/prices/standard"),Z.get("/inventory/unit-conversions")]).then(([Ce,Pe,fe,he,Ue,Ye])=>{var xe,ye,Ae,be,Ee,dt;if(!Te)return;M(Array.isArray((xe=Ce.data)==null?void 0:xe.items)?Ce.data.items:[]),z(Array.isArray((ye=Pe.data)==null?void 0:ye.items)?Pe.data.items.filter(mt=>String(mt.supplier_type||"").toUpperCase()==="LOCAL"):[]),L(Array.isArray((Ae=fe.data)==null?void 0:Ae.items)?fe.data.items:[]);const Je=(Array.isArray((be=he.data)==null?void 0:be.items)?he.data.items:[]).filter(mt=>String(mt.po_type||"").toUpperCase()==="LOCAL"&&String(mt.status||"").toUpperCase()==="APPROVED");P(Je),B(Array.isArray((Ee=Ue.data)==null?void 0:Ee.items)?Ue.data.items:[]),O(Array.isArray((dt=Ye.data)==null?void 0:dt.items)?Ye.data.items:[]),a&&Z.get("/inventory/grn",{params:{grn_type:"LOCAL"}}).then(mt=>{var ft;const it=Array.isArray((ft=mt.data)==null?void 0:ft.items)?mt.data.items:[],ht=new Set(it.map(Rt=>Rt.po_id||Rt.poId).filter(Rt=>Rt!=null).map(Rt=>String(Rt)));P(Rt=>Rt.filter(Ge=>!ht.has(String(Ge.id))))}).catch(()=>{})}).catch(Ce=>{var Pe,fe;Te&&h(((fe=(Pe=Ce==null?void 0:Ce.response)==null?void 0:Pe.data)==null?void 0:fe.message)||"Failed to load lookups")}),()=>{Te=!1}},[]);const oe=f.useMemo(()=>{const Te=Array.isArray(C)?C:[],Ce=Te.find(Pe=>String(Pe.uom_code||"").toUpperCase()==="PCS")||Te[0];return Ce&&Ce.uom_code?Ce.uom_code:"PCS"},[C]);f.useCallback((Te,Ce)=>{const Pe=Array.isArray(k)?k:[],fe=String(Te||""),he=Ce?String(Ce):"",Ue=Pe.filter(Je=>String(Je.product_id)===fe&&(he?String(Je.uom||"")===he:!0)).sort((Je,xe)=>{const ye=Je.effective_date?new Date(Je.effective_date).getTime():0;return(xe.effective_date?new Date(xe.effective_date).getTime():0)-ye||new Date(xe.created_at).getTime()-new Date(Je.created_at).getTime()});if(Ue.length>0&&Ue[0].cost_price!=null)return String(Ue[0].cost_price);const Ye=Pe.filter(Je=>String(Je.product_id)===fe).sort((Je,xe)=>{const ye=Je.effective_date?new Date(Je.effective_date).getTime():0;return(xe.effective_date?new Date(xe.effective_date).getTime():0)-ye||new Date(xe.created_at).getTime()-new Date(Je.created_at).getTime()});if(Ye.length>0&&Ye[0].cost_price!=null)return String(Ye[0].cost_price);const Ke=(Array.isArray(H)?H:[]).find(Je=>String(Je.id)===fe);return Ke&&Ke.cost_price!=null?String(Ke.cost_price):""},[k,H]),f.useMemo(()=>{const Te=new Map;for(const Ce of Array.isArray(k)?k:[]){const Pe=String(Ce.product_id);Te.has(Pe)||Te.set(Pe,Ce)}return Te},[k]),f.useEffect(()=>{a&&Z.get("/inventory/grn/next-no?type=LOCAL").then(Te=>{var Ce;(Ce=Te.data)!=null&&Ce.nextNo&&se(Pe=>({...Pe,grn_no:Te.data.nextNo}))}).catch(console.error)},[a]),f.useEffect(()=>{if(a)return;let Te=!0;return o(!0),h(""),Z.get(`/inventory/grn/${t}`).then(Ce=>{var he;if(!Te)return;const Pe=(he=Ce.data)==null?void 0:he.item,fe=Array.isArray(Pe==null?void 0:Pe.details)?Pe.details:[];Pe&&(se({grn_no:Pe.grn_no||"",grn_date:im(Pe.grn_date),supplier_id:Pe.supplier_id?String(Pe.supplier_id):"",warehouse_id:Pe.warehouse_id?String(Pe.warehouse_id):"",po_id:Pe.po_id?String(Pe.po_id):"",invoice_no:Pe.invoice_no||"",invoice_date:im(Pe.invoice_date),invoice_amount:Pe.invoice_amount!=null?String(Pe.invoice_amount):"",invoice_due_date:im(Pe.invoice_due_date),delivery_number:Pe.delivery_number||"",delivery_date:im(Pe.delivery_date),status:Pe.status||"DRAFT",remarks:Pe.remarks||"",details:fe.map(Ue=>({item_id:Ue.item_id?String(Ue.item_id):"",qty_ordered:Ue.qty_ordered??"",input_qty:Ue.input_qty??Ue.qty_received??"",input_uom:Ue.input_uom||Ue.uom||"",qty_received:Ue.qty_received??"",qty_accepted:Ue.qty_accepted??"",qty_rejected:Ue.qty_rejected??"",uom:Ue.uom||"",unit_price:Ue.unit_price!=null?String(Ue.unit_price):"",amount:Ue.line_amount!=null?String(Ue.line_amount):(()=>{const Ye=Ue.unit_price!=null?Number(Ue.unit_price):0,Ke=Ue.qty_accepted!=null?Number(Ue.qty_accepted):Ue.qty_received!=null?Number(Ue.qty_received):Ue.qty_ordered!=null?Number(Ue.qty_ordered):0;return String(Number(Ke||0)*Number(Ye||0))})(),batch_serial:Ue.batch_serial||Ue.batch_number||"",mfg_date:im(Ue.mfg_date),expiry_date:im(Ue.expiry_date),inspection_status:Ue.inspection_status||"PENDING",line_remarks:Ue.remarks||""}))}),ue.current=!1,Pe.po_id&&Z.get(`/purchase/orders/${Pe.po_id}`).then(Ue=>{var Ke;const Ye=(Ke=Ue.data)==null?void 0:Ke.item;Ye&&P(Je=>Je.some(ye=>String(ye.id)===String(Ye.id))?Je:[...Je,Ye])}).catch(()=>{}))}).catch(Ce=>{var Pe,fe;Te&&h(((fe=(Pe=Ce==null?void 0:Ce.response)==null?void 0:Pe.data)==null?void 0:fe.message)||"Failed to load GRN")}).finally(()=>{Te&&o(!1)}),()=>{Te=!1}},[t,a]);const le=f.useMemo(()=>{const Te=new Map;for(const Ce of H)Te.set(String(Ce.id),Ce);return Te},[H]),X=f.useMemo(()=>{const Te=new Map;for(const Ce of Array.isArray(G)?G:[]){if(!Number(Ce.is_active))continue;const Pe=`${Ce.item_id}|${Ce.from_uom}|${Ce.to_uom}`,fe=Number(Ce.conversion_factor||0);Number.isFinite(fe)&&fe>0&&Te.set(Pe,fe)}return Te},[G]),me=f.useMemo(()=>{const Te=te.supplier_id?String(te.supplier_id):"";return Te?V.filter(Ce=>String(Ce.supplier_id)===Te):V},[V,te.supplier_id]);f.useEffect(()=>{if(!te.po_id||!a)return;me.some(Ce=>String(Ce.id)===String(te.po_id))||se(Ce=>({...Ce,po_id:""}))},[me,te.po_id]);const we=()=>{se(Te=>{var Ce,Pe,fe,he;return{...Te,details:[...Te.details,{item_id:(Ce=H[0])!=null&&Ce.id?String(H[0].id):"",qty_ordered:"",input_qty:"",input_uom:((Pe=H[0])==null?void 0:Pe.uom)&&String(H[0].uom)||(oe?String(oe):""),qty_received:"",uom:((fe=H[0])==null?void 0:fe.uom)&&String(H[0].uom)||(oe?String(oe):""),unit_price:String(((he=H[0])==null?void 0:he.cost_price)??"")}]}})},Ie=Te=>{se(Ce=>({...Ce,details:Ce.details.filter((Pe,fe)=>fe!==Te)}))},_e=(Te,Ce)=>{se(Pe=>{const fe=Pe.details.map((ft,Rt)=>Rt===Te?{...ft,...Ce}:ft);let he=fe[Te];Object.prototype.hasOwnProperty.call(Ce,"qty_ordered")&&(he.qty_received===""||he.qty_received==null)&&(he={...he,qty_received:Ce.qty_ordered},fe[Te]=he);const Ue=Object.prototype.hasOwnProperty.call(Ce,"qty_received_direct")&&Ce.qty_received_direct!=null&&Number.isFinite(Number(Ce.qty_received_direct))?Number(Ce.qty_received_direct):null;if(Object.prototype.hasOwnProperty.call(Ce,"item_id")){const ft=le.get(String(Ce.item_id)),Rt=(ft==null?void 0:ft.uom)&&String(ft.uom)||he.uom&&String(he.uom)||(oe?String(oe):""),Ge=String((ft==null?void 0:ft.cost_price)??"");he={...he,uom:Rt,input_uom:Rt,input_qty:"",qty_received:"",qty_accepted:"",unit_price:Ge},fe[Te]=he}const Ye=he.uom&&String(he.uom)||(oe?String(oe):""),Ke=he.input_uom&&String(he.input_uom)?String(he.input_uom):Ye,Je=!(he.input_qty===""||he.input_qty==null),xe=Je?Number(he.input_qty):null,ye=!Je&&Number.isFinite(Number(he.qty_received))?Number(he.qty_received):null;let Ae=xe!=null&&Number.isFinite(xe)?xe:ye;if(Ue!=null&&(Ae=Ue),Ue==null&&Ae!=null&&Ke&&Ye&&Ke!==Ye){const ft=`${he.item_id}|${Ke}|${Ye}`,Rt=X.get(ft);Number.isFinite(Rt)&&Rt>0&&(Ae=Ae*Rt)}const be=Ae!=null&&Number.isFinite(Ae)?Ae:"",Ee=he.unit_price===""?0:Number(he.unit_price||0),dt=he.qty_accepted===""||he.qty_accepted==null?null:Number(he.qty_accepted||0),mt=be===""||be==null?null:Number(be||0),it=he.qty_ordered===""||he.qty_ordered==null?null:Number(he.qty_ordered||0),ht=dt??null??mt??null??it??0;return fe[Te]={...he,uom:Ye,input_uom:Ke,qty_received:be,qty_accepted:he.qty_accepted===""||he.qty_accepted==null?be:he.qty_accepted,amount:String(Number(ht||0)*Ee)},{...Pe,details:fe}})},Fe=(Te,Ce)=>{const Pe=Ce?le.get(String(Ce)):null,fe=(Pe==null?void 0:Pe.uom)&&String(Pe.uom)||(oe?String(oe):""),he=String((Pe==null?void 0:Pe.cost_price)??"");_e(Te,{item_id:Ce,uom:fe,input_uom:fe,input_qty:"",unit_price:he})};f.useEffect(()=>{if(!te.po_id||!ue.current)return;let Te=!0;return o(!0),Z.get(`/purchase/orders/${te.po_id}`).then(Ce=>{var he,Ue,Ye;if(!Te)return;const Pe=(he=Ce.data)==null?void 0:he.item,fe=Array.isArray((Ye=(Ue=Ce.data)==null?void 0:Ue.item)==null?void 0:Ye.details)?Ce.data.item.details:[];Pe&&se(Ke=>({...Ke,supplier_id:Pe.supplier_id?String(Pe.supplier_id):Ke.supplier_id,warehouse_id:Pe.warehouse_id?String(Pe.warehouse_id):Ke.warehouse_id,details:fe.map(Je=>{const xe=H.find(Ae=>String(Ae.id)===String(Je.item_id)),ye=(xe==null?void 0:xe.uom)&&String(xe.uom)||(oe?String(oe):"");return{item_id:Je.item_id?String(Je.item_id):"",qty_ordered:Je.qty??"",input_qty:"",input_uom:ye,qty_received:Je.qty??"",qty_accepted:"",qty_rejected:"",uom:ye,unit_price:String((xe==null?void 0:xe.cost_price)??""),amount:"",batch_serial:"",mfg_date:"",expiry_date:"",inspection_status:"PENDING",line_remarks:""}})}))}).catch(Ce=>{var Pe,fe;h(((fe=(Pe=Ce==null?void 0:Ce.response)==null?void 0:Pe.data)==null?void 0:fe.message)||"Failed to load PO details")}).finally(()=>{Te&&o(!1)}),()=>{Te=!1}},[te.po_id]);const Le=async Te=>{var Ce,Pe;Te.preventDefault(),u(!0),h("");try{const fe={grn_no:te.grn_no||null,grn_date:te.grn_date,grn_type:"LOCAL",supplier_id:te.supplier_id?Number(te.supplier_id):null,warehouse_id:te.warehouse_id?Number(te.warehouse_id):null,po_id:te.po_id?Number(te.po_id):null,invoice_no:te.invoice_no||null,invoice_date:te.invoice_date||null,invoice_amount:te.invoice_amount===""||te.invoice_amount==null?null:Number(te.invoice_amount),invoice_due_date:te.invoice_due_date||null,delivery_number:te.delivery_number||null,delivery_date:te.delivery_date||null,remarks:te.remarks||null,details:(te.details||[]).map(he=>({item_id:he.item_id?Number(he.item_id):null,qty_ordered:he.qty_ordered===""?null:Number(he.qty_ordered),qty_received:he.qty_received===""?null:Number(he.qty_received),qty_accepted:he.qty_accepted===""?null:Number(he.qty_accepted),input_qty:he.input_qty===""?null:Number(he.input_qty),input_uom:he.input_uom||null,uom:he.uom||null,unit_price:he.unit_price===""?null:Number(he.unit_price),line_amount:he.amount===""?null:Number(he.amount),batch_serial:he.batch_serial||null,mfg_date:he.mfg_date||null,expiry_date:he.expiry_date||null,inspection_status:he.inspection_status||"PENDING",remarks:he.line_remarks||null}))};if(!fe.grn_date||!fe.supplier_id)throw new Error("GRN date and supplier are required");if(!fe.po_id)throw new Error("Purchase order is required");if(!fe.invoice_no||!fe.invoice_date)throw new Error("Invoice number and date are required");a?await Z.post("/inventory/grn",fe):await Z.put(`/inventory/grn/${t}`,fe),s("/inventory/grn-local")}catch(fe){h(((Pe=(Ce=fe==null?void 0:fe.response)==null?void 0:Ce.data)==null?void 0:Pe.message)||(fe==null?void 0:fe.message)||"Failed to save GRN")}finally{u(!1)}},rt=async()=>{var Te,Ce,Pe;if(!a){W(!0),y("");try{const fe=await Z.post(`/inventory/grn/${t}/submit`,{amount:te.invoice_amount===""||te.invoice_amount==null?null:Number(te.invoice_amount||0),workflow_id:j?j.id:null,target_user_id:T||null}),he=((Te=fe==null?void 0:fe.data)==null?void 0:Te.status)||"PENDING_APPROVAL";se(Ue=>({...Ue,status:he})),p(!1)}catch(fe){y(((Pe=(Ce=fe==null?void 0:fe.response)==null?void 0:Ce.data)==null?void 0:Pe.message)||"Failed to forward for approval")}finally{W(!1)}}},He=async()=>{var Te,Ce,Pe;if(!a)if(p(!0),y(""),R)await st();else try{x(!0);const fe=await Z.get("/workflows"),he=Array.isArray((Te=fe.data)==null?void 0:Te.items)?fe.data.items:[];U(he),await De(he)}catch(fe){y(((Pe=(Ce=fe==null?void 0:fe.response)==null?void 0:Ce.data)==null?void 0:Pe.message)||"Failed to load workflows")}finally{x(!1)}},st=async()=>{var fe,he,Ue;if(!R||!R.length){N(null),F(null),y("");return}const Te="/inventory/grn-local",Ce=Ye=>String(Ye||"").trim().toUpperCase().replace(/\s+/g,"_"),Pe=R.find(Ye=>Number(Ye.is_active)===1&&String(Ye.document_route)===Te)||R.find(Ye=>Number(Ye.is_active)===1&&["GOODS_RECEIPT","GRN","GOODS_RECEIPT_NOTE"].includes(Ce(Ye.document_type)))||null;if(N(Pe||null),F(null),!!Pe)try{x(!0);const Ke=(fe=(await Z.get(`/workflows/${Pe.id}`)).data)==null?void 0:fe.item,Je=Array.isArray(Ke==null?void 0:Ke.steps)?Ke.steps:[];w(Je);const xe=Je[0]||null;if(F(xe?{userId:xe.approver_user_id,name:xe.approver_name,stepName:xe.step_name,stepOrder:xe.step_order,approvalLimit:xe.approval_limit}:null),xe){const ye=(Array.isArray(xe.approvers)&&xe.approvers.length?xe.approvers[0].id:xe.approver_user_id)||null;Y(ye)}else Y(null)}catch(Ye){y(((Ue=(he=Ye==null?void 0:Ye.response)==null?void 0:he.data)==null?void 0:Ue.message)||"Failed to load workflow details")}finally{x(!1)}},De=async Te=>{var he,Ue,Ye;if(!Te||!Te.length){N(null),F(null),y("");return}const Ce="/inventory/grn-local",Pe=Ke=>String(Ke||"").trim().toUpperCase().replace(/\s+/g,"_"),fe=Te.find(Ke=>Number(Ke.is_active)===1&&String(Ke.document_route)===Ce)||Te.find(Ke=>Number(Ke.is_active)===1&&["GOODS_RECEIPT","GRN","GOODS_RECEIPT_NOTE"].includes(Pe(Ke.document_type)))||null;if(N(fe||null),F(null),!!fe)try{x(!0);const Je=(he=(await Z.get(`/workflows/${fe.id}`)).data)==null?void 0:he.item,xe=Array.isArray(Je==null?void 0:Je.steps)?Je.steps:[];w(xe);const ye=xe[0]||null;if(F(ye?{userId:ye.approver_user_id,name:ye.approver_name,stepName:ye.step_name,stepOrder:ye.step_order,approvalLimit:ye.approval_limit}:null),ye){const Ae=(Array.isArray(ye.approvers)&&ye.approvers.length?ye.approvers[0].id:ye.approver_user_id)||null;Y(Ae)}else Y(null)}catch(Ke){y(((Ye=(Ue=Ke==null?void 0:Ke.response)==null?void 0:Ue.data)==null?void 0:Ye.message)||"Failed to load workflow details")}finally{x(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:a?"New GRN (Local)":i?"View GRN (Local)":"Edit GRN (Local)"}),e.jsx("p",{className:"text-sm mt-1",children:"Goods receipt note for local purchases"})]}),e.jsx(Re,{to:"/inventory/grn-local",className:"btn-success",children:"Back to List"})]})}),e.jsx("div",{className:"card-body",children:e.jsx("form",{onSubmit:Le,className:"space-y-6",children:e.jsxs("fieldset",{disabled:i,className:i?"disabled-light-blue":"",children:[l?e.jsx("div",{className:"text-sm",children:"Loading..."}):null,c?e.jsx("div",{className:"text-sm text-red-600",children:c}):null,e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"GRN No"}),e.jsx("input",{type:"text",className:"input w-full",value:te.grn_no,onChange:Te=>se({...te,grn_no:Te.target.value}),placeholder:"Auto-generated if blank"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"GRN Date *"}),e.jsx("input",{type:"date",className:"input w-full",value:te.grn_date,onChange:Te=>se({...te,grn_date:Te.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Warehouse"}),e.jsxs("select",{className:"input w-full",value:te.warehouse_id,onChange:Te=>se({...te,warehouse_id:Te.target.value}),children:[e.jsx("option",{value:"",children:"Select warehouse..."}),Q.map(Te=>e.jsx("option",{value:String(Te.id),children:(Te.warehouse_code?`${Te.warehouse_code} - `:"")+Te.warehouse_name},Te.id))]})]})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Supplier *"}),e.jsxs("select",{className:"input w-full",value:te.supplier_id,onChange:Te=>se({...te,supplier_id:Te.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select supplier..."}),q.map(Te=>e.jsx("option",{value:String(Te.id),children:Te.supplier_name},Te.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Purchase Order *"}),e.jsxs("select",{className:"input w-full",value:te.po_id,onChange:Te=>se({...te,po_id:Te.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select purchase order..."}),me.map(Te=>e.jsx("option",{value:String(Te.id),children:Te.po_no},Te.id))]})]})]})})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Invoice & Delivery Details"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Supplier's Invoice Number *"}),e.jsx("input",{type:"text",className:"input w-full",value:te.invoice_no,onChange:Te=>se({...te,invoice_no:Te.target.value}),placeholder:"Enter number",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Invoice Date *"}),e.jsx("input",{type:"date",className:"input w-full",value:te.invoice_date,onChange:Te=>se({...te,invoice_date:Te.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Due Date"}),e.jsx("input",{type:"date",className:"input w-full",value:te.invoice_due_date,onChange:Te=>se({...te,invoice_due_date:Te.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Delivery Number"}),e.jsx("input",{type:"text",className:"input w-full",value:te.delivery_number,onChange:Te=>se({...te,delivery_number:Te.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Delivery Date"}),e.jsx("input",{type:"date",className:"input w-full",value:te.delivery_date,onChange:Te=>se({...te,delivery_date:Te.target.value})})]})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Remarks"}),e.jsx("textarea",{className:"input",rows:"3",value:te.remarks,onChange:Te=>se({...te,remarks:Te.target.value})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Items"}),e.jsx("button",{type:"button",className:"btn-success",onClick:we,children:"+ Add Item"})]})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Ordered Qty"}),e.jsx("th",{children:"Input UOM"}),e.jsx("th",{children:"Received Qty"}),e.jsx("th",{}),e.jsx("th",{children:"Accepted Qty"}),e.jsx("th",{children:"Unit Price"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Batch/Serial"}),e.jsx("th",{children:"Mfg Date"}),e.jsx("th",{children:"Expiry Date"}),e.jsx("th",{children:"Inspection"}),e.jsx("th",{children:"Remarks"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[te.details.length?null:e.jsx("tr",{children:e.jsx("td",{colSpan:"14",className:"text-center py-6 text-slate-500 dark:text-slate-400",children:'No items. Click "Add Item" to begin.'})}),te.details.map((Te,Ce)=>{const Pe=Te.item_id?le.get(String(Te.item_id)):null,fe=Pe?`${Pe.item_code} - ${Pe.item_name}`:"Select item...";return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("select",{className:"input min-w-[320px] w-[480px]",value:Te.item_id,onChange:he=>Fe(Ce,he.target.value),children:[e.jsx("option",{value:"",children:"Select item..."}),H.map(he=>e.jsxs("option",{value:String(he.id),children:[he.item_code," - ",he.item_name]},he.id))]}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:fe})]}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"1",className:"input min-w-[140px]",value:Te.qty_ordered,onChange:he=>_e(Ce,{qty_ordered:he.target.value})})}),e.jsxs("td",{className:"pr-6 pl-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{className:"input w-auto min-w-[160px] flex-none",value:Te.input_uom||oe||"",onChange:he=>_e(Ce,{input_uom:he.target.value}),children:[e.jsx("option",{value:"",children:"Select UOM"}),(Array.isArray(C)?C:[]).map(he=>e.jsx("option",{value:he.uom_code,children:he.uom_name?`${he.uom_name} (${he.uom_code})`:he.uom_code},he.id))]})}),e.jsx("div",{className:"text-[11px] text-slate-500 mt-1",children:(()=>{const he=String(Te.input_uom||""),Ue=String(Te.uom||oe||""),Ye=`${Te.item_id}|${he}|${Ue}`,Ke=X.get(Ye);return Number(Ke)>0?`Conversion: 1 ${he} = ${Number(Ke).toFixed(6)} ${Ue}`:he&&Ue&&he===Ue?"":e.jsxs(e.Fragment,{children:["No conversion defined for ",he,"  ",Ue,"."," ",e.jsx(Re,{to:"/inventory/unit-conversions",className:"text-brand font-medium underline",children:"Define conversion"})]})})()})]}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"1",className:"input min-w-[140px]",value:Te.qty_received,onChange:he=>_e(Ce,{qty_received_direct:he.target.value})})}),e.jsx("td",{children:(()=>{const he=String(Te.uom||oe||""),Ue=(Array.isArray(G)?G:[]).filter(xe=>Number(xe.is_active)&&Number(xe.item_id)===Number(Te.item_id)&&String(xe.to_uom)===he).map(xe=>String(xe.from_uom)),Ye=String(Te.input_uom||""),Ke=Ye&&Ye!==he?Ye:Ue[0]||"";return Ue.length>0&&Ke&&Ke!==he?e.jsx("button",{type:"button",className:"px-2 py-1 text-xs border border-brand text-brand rounded hover:bg-brand hover:text-white transition-colors flex-none",onClick:()=>J({open:!0,itemId:Te.item_id,defaultUom:he,currentUom:Ke,lineIdx:Ce}),children:`number of ${Ke}`}):null})()}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"1",className:"input min-w-[140px]",value:Te.qty_accepted,onChange:he=>_e(Ce,{qty_accepted:he.target.value})})}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"1",className:"input min-w-[140px]",value:Te.unit_price,onChange:he=>_e(Ce,{unit_price:he.target.value})})}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"1",className:"input min-w-[160px]",value:Te.amount,onChange:he=>_e(Ce,{amount:he.target.value}),readOnly:!0})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input min-w-[160px]",value:Te.batch_serial,onChange:he=>_e(Ce,{batch_serial:he.target.value})})}),e.jsx("td",{children:e.jsx("input",{type:"date",className:"input min-w-[160px]",value:Te.mfg_date,onChange:he=>_e(Ce,{mfg_date:he.target.value})})}),e.jsx("td",{children:e.jsx("input",{type:"date",className:"input min-w-[160px]",value:Te.expiry_date,onChange:he=>_e(Ce,{expiry_date:he.target.value})})}),e.jsx("td",{children:e.jsxs("select",{className:"input min-w-[140px]",value:Te.inspection_status||"PENDING",onChange:he=>_e(Ce,{inspection_status:he.target.value}),children:[e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"PASSED",children:"Passed"}),e.jsx("option",{value:"FAILED",children:"Failed"})]})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input min-w-[200px]",value:Te.line_remarks,onChange:he=>_e(Ce,{line_remarks:he.target.value})})}),e.jsx("td",{className:"text-right",children:e.jsx("button",{type:"button",className:"btn-success",onClick:()=>Ie(Ce),children:"Remove"})})]},Ce)})]})]})})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx(Re,{to:"/inventory/grn-local",className:"btn-success",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-success",disabled:d||i,children:d?"Saving...":"Save GRN"}),e.jsx("button",{type:"button",className:"btn-success ml-2",onClick:He,disabled:d||a||ne,children:String(te.status||"").toUpperCase()==="APPROVED"?e.jsx("span",{className:"px-2 py-1 rounded bg-green-500 text-white text-sm font-medium",children:"Approved"}):"Forward for Approval"})]})]})})})]}),m?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-[640px] max-w-[95%]",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-brand text-white rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Forward GRN for Approval"}),e.jsx("button",{type:"button",onClick:()=>{p(!1),N(null),F(null),y("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Document No:"," ",e.jsx("span",{className:"font-semibold",children:te.grn_no})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:j?`${j.workflow_name} (${j.workflow_code})`:"None (inactive)"})]}),e.jsx("div",{children:g?e.jsx("div",{className:"text-sm",children:"Loading workflow..."}):null}),e.jsx("div",{children:b?e.jsx("div",{className:"text-sm text-red-600",children:b}):null}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Target Approver"}),(()=>{const Ce=Array.isArray(I)&&I.length>0?I[0]:null,Pe=Ce?Array.isArray(Ce.approvers)&&Ce.approvers.length?Ce.approvers.map(fe=>({id:fe.id,name:fe.username})):Ce.approver_user_id?[{id:Ce.approver_user_id,name:Ce.approver_name||String(Ce.approver_user_id)}]:[]:[];return Pe.length>0?e.jsxs("div",{className:"mt-1",children:[e.jsxs("select",{className:"input w-full",value:T||"",onChange:fe=>Y(fe.target.value?Number(fe.target.value):null),children:[e.jsx("option",{value:"",children:"Select target approver"}),Pe.map(fe=>e.jsx("option",{value:fe.id,children:fe.name},fe.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:_?`Step ${_.stepOrder}  ${_.stepName}${_.approvalLimit!=null?`  Limit: ${Number(_.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:j?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})()]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{p(!1),N(null),F(null),y("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:rt,disabled:E||a,children:E?"Forwarding...":"Forward"})]})]})}):null,e.jsx(Ic,{open:K.open,onClose:()=>J({open:!1,itemId:null,defaultUom:"",currentUom:"",lineIdx:null}),itemId:K.itemId?Number(K.itemId):null,defaultUom:String(K.defaultUom||""),currentUom:String(K.currentUom||""),conversions:G,onApply:({converted_qty:Te})=>{const Ce=K.lineIdx;Ce!=null&&_e(Ce,{qty_received_direct:Te})}})]})}function dee(){const{canPerformAction:t}=Ls();useNavigate();const[s,r]=f.useState(""),[a,n]=f.useState([]),[i,l]=f.useState(!1),[o,d]=f.useState(""),[u,c]=f.useState(null),[h,m]=f.useState(!1),[p,g]=f.useState(!1),[x,b]=f.useState(""),[y,j]=f.useState(null),[N,_]=f.useState(null),[F,I]=f.useState([]),[w,E]=f.useState(!1),[W,R]=f.useState(null),[U,T]=f.useState(null),[Y,H]=f.useState(null),[M,q]=f.useState(!1),[z,Q]=f.useState(!1),[L,V]=f.useState(""),[P,C]=f.useState(null),[k,B]=f.useState([]),[G,O]=f.useState(""),[K,J]=f.useState(!1);f.useEffect(()=>{let X=!0;return l(!0),d(""),Z.get("/inventory/grn",{params:{grn_type:"IMPORT"}}).then(me=>{var we;X&&n(Array.isArray((we=me.data)==null?void 0:we.items)?me.data.items:[])}).catch(me=>{var we,Ie;X&&d(((Ie=(we=me==null?void 0:me.response)==null?void 0:we.data)==null?void 0:Ie.message)||"Failed to load GRNs")}).finally(()=>{X&&l(!1)}),()=>{X=!1}},[]);const te=f.useMemo(()=>{const X=s.toLowerCase();return a.filter(me=>String(me.grn_no||"").toLowerCase().includes(X)||String(me.supplier_name||"").toLowerCase().includes(X)||String(me.status||"").toLowerCase().includes(X))},[a,s]),se=X=>{const me=String(X||"").toUpperCase();return me!=="PENDING_APPROVAL"&&me!=="APPROVED"&&me!=="CANCELLED"},ae=async X=>{var me,we,Ie,_e,Fe,Le;H(null),m(!0),b("");try{const rt=await Z.get(`/inventory/grn/${X.id}`),He=((me=rt==null?void 0:rt.data)==null?void 0:me.item)||{},st=He==null?void 0:He.invoice_amount,De=st===""||st==null?null:Number(st||0);H({id:X.id,grn_no:X.grn_no,invoice_amount:De,status:X.status})}catch(rt){b(((Ie=(we=rt==null?void 0:rt.response)==null?void 0:we.data)==null?void 0:Ie.message)||"Failed to load GRN")}if(W)await ne();else try{g(!0);const rt=await Z.get("/workflows"),He=Array.isArray((_e=rt.data)==null?void 0:_e.items)?rt.data.items:[];R(He),await ue(He)}catch(rt){b(((Le=(Fe=rt==null?void 0:rt.response)==null?void 0:Fe.data)==null?void 0:Le.message)||"Failed to load workflows")}finally{g(!1)}},ne=async()=>{var Fe,Le,rt;if(!W||!W.length){j(null),_(null),b(""),J(!1);return}const X="/inventory/grn-import",me=He=>String(He||"").trim().toUpperCase().replace(/\s+/g,"_"),Ie=W.filter(He=>String(He.document_route)===X||["GOODS_RECEIPT","GRN","GOODS_RECEIPT_NOTE"].includes(me(He.document_type))).some(He=>Number(He.is_active)===0),_e=W.find(He=>Number(He.is_active)===1&&String(He.document_route)===X)||W.find(He=>Number(He.is_active)===1&&["GOODS_RECEIPT","GRN","GOODS_RECEIPT_NOTE"].includes(me(He.document_type)))||null;if(j(_e||null),J(!_e&&Ie),_(null),!!_e)try{g(!0);const st=(Fe=(await Z.get(`/workflows/${_e.id}`)).data)==null?void 0:Fe.item,De=Array.isArray(st==null?void 0:st.steps)?st.steps:[];I(De);const Te=De[0]||null;if(_(Te?{userId:Te.approver_user_id,name:Te.approver_name,stepName:Te.step_name,stepOrder:Te.step_order,approvalLimit:Te.approval_limit}:null),Te){const Ce=(Array.isArray(Te.approvers)&&Te.approvers.length?Te.approvers[0].id:Te.approver_user_id)||null;T(Ce)}else T(null)}catch(He){b(((rt=(Le=He==null?void 0:He.response)==null?void 0:Le.data)==null?void 0:rt.message)||"Failed to load workflow details")}finally{g(!1)}},ue=async X=>{var Le,rt,He;if(!X||!X.length){j(null),_(null),b(""),J(!1);return}const me="/inventory/grn-import",we=st=>String(st||"").trim().toUpperCase().replace(/\s+/g,"_"),_e=X.filter(st=>String(st.document_route)===me||["GOODS_RECEIPT","GRN","GOODS_RECEIPT_NOTE"].includes(we(st.document_type))).some(st=>Number(st.is_active)===0),Fe=X.find(st=>Number(st.is_active)===1&&String(st.document_route)===me)||X.find(st=>Number(st.is_active)===1&&["GOODS_RECEIPT","GRN","GOODS_RECEIPT_NOTE"].includes(we(st.document_type)))||null;if(j(Fe||null),J(!Fe&&_e),_(null),!!Fe)try{g(!0);const De=(Le=(await Z.get(`/workflows/${Fe.id}`)).data)==null?void 0:Le.item,Te=Array.isArray(De==null?void 0:De.steps)?De.steps:[];I(Te);const Ce=Te[0]||null;if(_(Ce?{userId:Ce.approver_user_id,name:Ce.approver_name,stepName:Ce.step_name,stepOrder:Ce.step_order,approvalLimit:Ce.approval_limit}:null),Ce){const Pe=(Array.isArray(Ce.approvers)&&Ce.approvers.length?Ce.approvers[0].id:Ce.approver_user_id)||null;T(Pe)}else T(null)}catch(st){b(((He=(rt=st==null?void 0:st.response)==null?void 0:rt.data)==null?void 0:He.message)||"Failed to load workflow details")}finally{g(!1)}},oe=async()=>{var X,me,we;if(Y){E(!0),b("");try{const Ie=await Z.post(`/inventory/grn/${Y.id}/submit`,{amount:Y.invoice_amount??null,workflow_id:y?y.id:null,target_user_id:U||null}),_e=((X=Ie==null?void 0:Ie.data)==null?void 0:X.status)||"PENDING_APPROVAL";n(Fe=>Fe.map(Le=>Le.id===Y.id?{...Le,status:_e}:Le)),m(!1),H(null)}catch(Ie){b(((we=(me=Ie==null?void 0:Ie.response)==null?void 0:me.data)==null?void 0:we.message)||"Failed to forward for approval")}finally{E(!1)}}},le=async X=>{var me,we,Ie,_e;q(!0),Q(!0),V(""),C(null),B([]),O("");try{const Fe=await Z.get(`/inventory/grn/${X.id}`),Le=((me=Fe==null?void 0:Fe.data)==null?void 0:me.item)||{},rt=Array.isArray(Le==null?void 0:Le.details)?Le.details:[];C(Le),B(rt);const He=Number((Le==null?void 0:Le.po_id)||0)||0;if(He)try{const st=await Z.get("/purchase/orders"),Te=(Array.isArray((we=st==null?void 0:st.data)==null?void 0:we.items)?st.data.items:[]).find(Ce=>Number(Ce.id)===He);O(Te?Te.po_no||String(Te.id):String(He))}catch{O(String(He))}}catch(Fe){V(((_e=(Ie=Fe==null?void 0:Fe.response)==null?void 0:Ie.data)==null?void 0:_e.message)||"Failed to load GRN details")}finally{Q(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Material Receipt (GRN) - Import"}),e.jsx("p",{className:"text-sm mt-1",children:"Receive import purchase deliveries"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/inventory/grn-import/new",className:"btn-success",children:"+ New GRN"})]})]})}),e.jsxs("div",{className:"card-body",children:[o?e.jsx("div",{className:"text-sm text-red-600 mb-4",children:o}):null,e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by GRN no, supplier, status...",className:"input max-w-md",value:s,onChange:X=>r(X.target.value)})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"GRN No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{children:"Warehouse"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[i?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):null,!i&&!te.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No GRNs found"})}):null,te.map(X=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:X.grn_no}),e.jsx("td",{children:X.grn_date?String(X.grn_date).slice(0,10):"-"}),e.jsx("td",{children:X.supplier_name||"-"}),e.jsx("td",{children:X.warehouse_name||"-"}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-info",children:X.status||"DRAFT"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{to:`/inventory/grn-import/${X.id}?mode=view`,className:"text-brand hover:text-brand-700 text-sm font-medium",children:"View"}),e.jsx("button",{type:"button",className:"text-brand hover:text-brand-700 text-sm font-medium",onClick:()=>le(X),children:"Details"}),String(X.status||"").toUpperCase()!=="APPROVED"&&t("inventory:stock-updation","edit")&&e.jsx(Re,{to:`/inventory/grn-import/${X.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Edit"}),String(X.status||"").toUpperCase()==="APPROVED"?e.jsx("span",{className:"ml-2 text-sm font-medium px-2 py-1 rounded bg-green-500 text-white",children:"Approved"}):e.jsx("button",{type:"button",className:"btn-success ml-2",onClick:()=>ae(X),disabled:u===X.id||!se(X.status)||K,children:u===X.id?"Forwarding...":"Forward for Approval"})]})})]},X.id))]})]})})]})]}),h?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-[640px] max-w-[95%]",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-brand text-white rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Forward GRN for Approval"}),e.jsx("button",{type:"button",onClick:()=>{m(!1),H(null),j(null),_(null),b("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Document No:"," ",e.jsx("span",{className:"font-semibold",children:Y==null?void 0:Y.grn_no})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:y?`${y.workflow_name} (${y.workflow_code})`:"None (inactive)"})]}),e.jsx("div",{children:p?e.jsx("div",{className:"text-sm",children:"Loading workflow..."}):null}),e.jsx("div",{children:x?e.jsx("div",{className:"text-sm text-red-600",children:x}):null}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Target Approver"}),(()=>{const me=Array.isArray(F)&&F.length>0?F[0]:null,we=me?Array.isArray(me.approvers)&&me.approvers.length?me.approvers.map(Ie=>({id:Ie.id,name:Ie.username})):me.approver_user_id?[{id:me.approver_user_id,name:me.approver_name||String(me.approver_user_id)}]:[]:[];return we.length>0?e.jsxs("div",{className:"mt-1",children:[e.jsxs("select",{className:"input w-full",value:U||"",onChange:Ie=>T(Ie.target.value?Number(Ie.target.value):null),children:[e.jsx("option",{value:"",children:"Select target approver"}),we.map(Ie=>e.jsx("option",{value:Ie.id,children:Ie.name},Ie.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:N?`Step ${N.stepOrder}  ${N.stepName}${N.approvalLimit!=null?`  Limit: ${Number(N.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:y?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})()]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{m(!1),H(null),j(null),_(null),b("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:oe,disabled:w||!Y,children:w?"Forwarding...":"Forward"})]})]})}):null,M?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-[900px] max-w-[95%]",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-brand text-white rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"View GRN Details"}),e.jsx("button",{type:"button",onClick:()=>{q(!1),C(null),B([]),V("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[z?e.jsx("div",{className:"text-sm",children:"Loading..."}):null,L?e.jsx("div",{className:"text-sm text-red-600",children:L}):null,P?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"GRN No"}),e.jsx("div",{className:"font-semibold",children:P.grn_no})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Date"}),e.jsx("div",{className:"font-semibold",children:P.grn_date?String(P.grn_date).slice(0,10):"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Supplier"}),e.jsx("div",{className:"font-semibold",children:P.supplier_name||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Warehouse"}),e.jsx("div",{className:"font-semibold",children:P.warehouse_name||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Status"}),e.jsx("div",{className:"font-semibold",children:P.status||"DRAFT"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Purchase Order"}),e.jsx("div",{className:"font-semibold",children:G||(P.po_id?String(P.po_id):"-")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Delivery No"}),e.jsx("div",{className:"font-semibold",children:P.delivery_number||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Delivery Date"}),e.jsx("div",{className:"font-semibold",children:P.delivery_date?String(P.delivery_date).slice(0,10):"-"})]})]}):null,e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item Code"}),e.jsx("th",{children:"Item Name"}),e.jsx("th",{children:"Ordered Qty"}),e.jsx("th",{children:"Received Qty"}),e.jsx("th",{children:"Accepted Qty"}),e.jsx("th",{children:"UOM"}),e.jsx("th",{children:"Unit Price"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Batch/Serial"}),e.jsx("th",{children:"Remarks"})]})}),e.jsxs("tbody",{children:[k.length?null:e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center py-6 text-slate-500 dark:text-slate-400",children:"No item details"})}),k.map((X,me)=>{const we=X.line_amount==null||X.line_amount===""?Number(X.qty_accepted||0)*Number(X.unit_price||0):Number(X.line_amount||0);return e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:X.item_code||""}),e.jsx("td",{children:X.item_name||""}),e.jsx("td",{children:X.qty_ordered??""}),e.jsx("td",{children:X.qty_received??""}),e.jsx("td",{children:X.qty_accepted??""}),e.jsx("td",{children:X.uom||""}),e.jsx("td",{children:Number(X.unit_price||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{children:Number(we||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{children:X.batch_serial||X.batch_number||""}),e.jsx("td",{children:X.remarks||""})]},me)})]})]})})]}),e.jsx("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{q(!1),C(null),B([]),V("")},children:"Close"})})]})}):null]})}function lm(t){if(!t)return"";try{return new Date(t).toISOString().slice(0,10)}catch{return""}}function uee(){const{id:t}=Ps(),s=ps(),r=t==="new",[a]=Vf(),n=(a.get("mode")||"").toLowerCase(),i=!r&&n==="view",[l,o]=f.useState(!1),[d,u]=f.useState(!1),[c,h]=f.useState(""),[m,p]=f.useState(!1),[g,x]=f.useState(!1),[b,y]=f.useState(""),[j,N]=f.useState(null),[_,F]=f.useState(null),[I,w]=f.useState([]),[E,W]=f.useState(!1),[R,U]=f.useState(null),[T,Y]=f.useState(null),[H,M]=f.useState([]),[q,z]=f.useState([]),[Q,L]=f.useState([]),[V,P]=f.useState([]),[C,k]=f.useState([]),{uoms:B,loading:G}=$i(),[O,K]=f.useState([]),[J,te]=f.useState([]),[se,ae]=f.useState([]),ne=f.useMemo(()=>{const fe=new Map;for(const he of Array.isArray(se)?se:[])fe.set(String(he.id),he);return fe},[se]),[ue,oe]=f.useState({open:!1,itemId:null,defaultUom:"",currentUom:"",lineIdx:null}),le=f.useRef(r),[X,me]=f.useState({grn_no:"",grn_date:lm(new Date),supplier_id:"",warehouse_id:"",po_id:"",port_clearance_id:"",invoice_no:"",invoice_date:"",invoice_amount:"",invoice_due_date:"",delivery_number:"",delivery_date:"",bill_of_lading:"",customs_entry_no:"",shipping_company:"",port_of_entry:"",status:"DRAFT",remarks:"",details:[]}),we=f.useMemo(()=>{const fe=String(X.po_id||""),he=Array.isArray(C)?C:[];return fe?he.filter(Ue=>{const Ye=ne.get(String(Ue.advice_id||Ue.adviceId||""));return Ye&&String(Ye.po_id||"")===fe}):he},[C,X.po_id,ne]),Ie=f.useMemo(()=>{const fe=Array.isArray(B)?B:[],he=fe.find(Ue=>String(Ue.uom_code||"").toUpperCase()==="PCS")||fe[0];return he&&he.uom_code?he.uom_code:"PCS"},[B]);f.useCallback((fe,he)=>{const Ue=Array.isArray(O)?O:[],Ye=String(fe||""),Ke=he?String(he):"",Je=Ue.filter(ye=>String(ye.product_id)===Ye&&(Ke?String(ye.uom||"")===Ke:!0)).sort((ye,Ae)=>{const be=ye.effective_date?new Date(ye.effective_date).getTime():0;return(Ae.effective_date?new Date(Ae.effective_date).getTime():0)-be||new Date(Ae.created_at).getTime()-new Date(ye.created_at).getTime()});if(Je.length>0&&Je[0].cost_price!=null)return String(Je[0].cost_price);const xe=Ue.filter(ye=>String(ye.product_id)===Ye).sort((ye,Ae)=>{const be=ye.effective_date?new Date(ye.effective_date).getTime():0;return(Ae.effective_date?new Date(Ae.effective_date).getTime():0)-be||new Date(Ae.created_at).getTime()-new Date(ye.created_at).getTime()});return xe.length>0&&xe[0].cost_price!=null?String(xe[0].cost_price):(()=>{const ye=(Array.isArray(H)?H:[]).find(Ae=>String(Ae.id)===Ye);return ye&&ye.cost_price!=null?String(ye.cost_price):""})()},[O,H]),f.useEffect(()=>{let fe=!0;return h(""),Promise.all([Z.get("/inventory/items"),Z.get("/purchase/suppliers"),Z.get("/inventory/warehouses"),Z.get("/purchase/orders"),Z.get("/purchase/port-clearances"),Z.get("/purchase/shipping-advices"),Z.get("/sales/prices/standard"),Z.get("/inventory/unit-conversions")]).then(([he,Ue,Ye,Ke,Je,xe,ye,Ae])=>{var Rt,Ge,at,je,Se,nt,Ze,gt;if(!fe)return;M(Array.isArray((Rt=he.data)==null?void 0:Rt.items)?he.data.items:[]),z(Array.isArray((Ge=Ue.data)==null?void 0:Ge.items)?Ue.data.items:[]),L(Array.isArray((at=Ye.data)==null?void 0:at.items)?Ye.data.items:[]);const Ee=(Array.isArray((je=Ke.data)==null?void 0:je.items)?Ke.data.items:[]).filter(jt=>String(jt.po_type||"").toUpperCase()==="IMPORT"),dt=Array.isArray((Se=Je.data)==null?void 0:Se.items)?Je.data.items:[],mt=Array.isArray((nt=xe.data)==null?void 0:nt.items)?xe.data.items:[];ae(mt);const it=dt.filter(jt=>String(jt.status||"").toUpperCase()==="CLEARED"),ht=new Set(it.map(jt=>{const Mt=jt.advice_id||jt.adviceId,Ne=Mt!=null?mt.find(ke=>String(ke.id)===String(Mt)):null;return Ne&&Ne.po_id!=null?String(Ne.po_id):null}).filter(jt=>jt!=null)),ft=Ee.filter(jt=>ht.has(String(jt.id)));P(ft),k(it),K(Array.isArray((Ze=ye.data)==null?void 0:Ze.items)?ye.data.items:[]),te(Array.isArray((gt=Ae.data)==null?void 0:gt.items)?Ae.data.items:[]),r&&Z.get("/inventory/grn",{params:{grn_type:"IMPORT"}}).then(jt=>{var qe;const Mt=Array.isArray((qe=jt.data)==null?void 0:qe.items)?jt.data.items:[],Ne=new Set(Mt.map(ge=>ge.po_id||ge.poId).filter(ge=>ge!=null).map(ge=>String(ge))),ke=new Set(Mt.map(ge=>ge.port_clearance_id||ge.port_clearanceId).filter(ge=>ge!=null).map(ge=>String(ge)));P(ge=>ge.filter(Me=>!Ne.has(String(Me.id))).filter(Me=>ht.has(String(Me.id)))),k(ge=>ge.filter(Me=>!ke.has(String(Me.id))).filter(Me=>String(Me.status||"").toUpperCase()==="CLEARED"))}).catch(()=>{})}).catch(he=>{var Ue,Ye;fe&&h(((Ye=(Ue=he==null?void 0:he.response)==null?void 0:Ue.data)==null?void 0:Ye.message)||"Failed to load lookups")}),()=>{fe=!1}},[]),f.useEffect(()=>{r&&Z.get("/purchase/grns/next-no?type=IMPORT").then(fe=>{var he;(he=fe.data)!=null&&he.nextNo&&me(Ue=>({...Ue,grn_no:fe.data.nextNo}))}).catch(console.error)},[r]),f.useEffect(()=>{X.port_clearance_id&&Z.get(`/purchase/port-clearances/${X.port_clearance_id}`).then(fe=>{var Ue;const he=(Ue=fe.data)==null?void 0:Ue.item;he&&(me(Ye=>({...Ye,customs_entry_no:he.customs_entry_no||Ye.customs_entry_no})),he.advice_id&&Z.get(`/purchase/shipping-advices/${he.advice_id}`).then(Ye=>{var Je;const Ke=(Je=Ye.data)==null?void 0:Je.item;Ke&&(me(xe=>({...xe,po_id:Ke.po_id?String(Ke.po_id):xe.po_id,bill_of_lading:Ke.bill_of_lading||xe.bill_of_lading,shipping_company:Ke.vessel_name||xe.shipping_company})),Ke.po_id&&Z.get(`/purchase/orders/${Ke.po_id}`).then(xe=>{var Ae;const ye=(Ae=xe.data)==null?void 0:Ae.item;ye&&me(be=>({...be,supplier_id:ye.supplier_id?String(ye.supplier_id):be.supplier_id,warehouse_id:ye.warehouse_id?String(ye.warehouse_id):be.warehouse_id}))}).catch(console.error))}).catch(console.error))}).catch(console.error)},[X.port_clearance_id]),f.useEffect(()=>{const fe=String(X.po_id||"");if(!fe)return;const Ue=(Array.isArray(C)?C:[]).filter(Ye=>{const Ke=ne.get(String(Ye.advice_id||Ye.adviceId||""));return String(Ye.status||"").toUpperCase()==="CLEARED"&&Ke&&String(Ke.po_id||"")===fe});if(Ue.length>0){const Ye=[...Ue].sort((Ke,Je)=>{const xe=Ke.clearance_date?new Date(Ke.clearance_date).getTime():0;return(Je.clearance_date?new Date(Je.clearance_date).getTime():0)-xe})[0];me(Ke=>({...Ke,port_clearance_id:String(Ye.id)}))}else me(Ye=>({...Ye,port_clearance_id:""}))},[X.po_id,C,ne]),f.useEffect(()=>{if(r)return;let fe=!0;return o(!0),h(""),Z.get(`/inventory/grn/${t}`).then(he=>{var Ke;if(!fe)return;const Ue=(Ke=he.data)==null?void 0:Ke.item,Ye=Array.isArray(Ue==null?void 0:Ue.details)?Ue.details:[];Ue&&(me({grn_no:Ue.grn_no||"",grn_date:lm(Ue.grn_date),supplier_id:Ue.supplier_id?String(Ue.supplier_id):"",warehouse_id:Ue.warehouse_id?String(Ue.warehouse_id):"",po_id:Ue.po_id?String(Ue.po_id):"",port_clearance_id:Ue.port_clearance_id?String(Ue.port_clearance_id):"",invoice_no:Ue.invoice_no||"",invoice_date:lm(Ue.invoice_date),invoice_amount:Ue.invoice_amount!=null?String(Ue.invoice_amount):"",invoice_due_date:lm(Ue.invoice_due_date),delivery_number:Ue.delivery_number||"",delivery_date:lm(Ue.delivery_date),bill_of_lading:Ue.bill_of_lading||"",customs_entry_no:Ue.customs_entry_no||"",shipping_company:Ue.shipping_company||"",port_of_entry:Ue.port_of_entry||"",status:Ue.status||"DRAFT",remarks:Ue.remarks||"",details:Ye.map(Je=>({item_id:Je.item_id?String(Je.item_id):"",qty_ordered:Je.qty_ordered??"",input_qty:Je.input_qty??Je.qty_received??"",input_uom:Je.input_uom||Je.uom||"",qty_received:Je.qty_received??"",qty_accepted:Je.qty_accepted??"",qty_rejected:Je.qty_rejected??"",uom:Je.uom||"",unit_price:Je.unit_price!=null?String(Je.unit_price):"",amount:Je.line_amount!=null?String(Je.line_amount):(()=>{const xe=Je.unit_price!=null?Number(Je.unit_price):0,ye=Je.qty_accepted!=null?Number(Je.qty_accepted):Je.qty_received!=null?Number(Je.qty_received):Je.qty_ordered!=null?Number(Je.qty_ordered):0;return String(Number(ye||0)*Number(xe||0))})(),batch_serial:Je.batch_serial||Je.batch_number||"",mfg_date:lm(Je.mfg_date),expiry_date:lm(Je.expiry_date),inspection_status:Je.inspection_status||"PENDING",line_remarks:Je.remarks||""}))}),le.current=!1,Ue.po_id&&Z.get(`/purchase/orders/${Ue.po_id}`).then(Je=>{var ye;const xe=(ye=Je.data)==null?void 0:ye.item;xe&&P(Ae=>Ae.some(Ee=>String(Ee.id)===String(xe.id))?Ae:[...Ae,xe])}).catch(()=>{}))}).catch(he=>{var Ue,Ye;fe&&h(((Ye=(Ue=he==null?void 0:he.response)==null?void 0:Ue.data)==null?void 0:Ye.message)||"Failed to load GRN")}).finally(()=>{fe&&o(!1)}),()=>{fe=!1}},[t,r]);const _e=f.useMemo(()=>{const fe=new Map;for(const he of H)fe.set(String(he.id),he);return fe},[H]),Fe=f.useMemo(()=>{const fe=new Map;for(const he of Array.isArray(J)?J:[]){if(!Number(he.is_active))continue;const Ue=`${he.item_id}|${he.from_uom}|${he.to_uom}`,Ye=Number(he.conversion_factor||0);Number.isFinite(Ye)&&Ye>0&&fe.set(Ue,Ye)}return fe},[J]);f.useMemo(()=>{const fe=new Map;for(const he of Array.isArray(O)?O:[]){const Ue=String(he.product_id);fe.has(Ue)||fe.set(Ue,he)}return fe},[O]);const Le=()=>{me(fe=>{var he,Ue,Ye,Ke;return{...fe,details:[...fe.details,{item_id:(he=H[0])!=null&&he.id?String(H[0].id):"",qty_ordered:"",input_qty:"",input_uom:((Ue=H[0])==null?void 0:Ue.uom)&&String(H[0].uom)||(Ie?String(Ie):""),qty_received:"",uom:((Ye=H[0])==null?void 0:Ye.uom)&&String(H[0].uom)||(Ie?String(Ie):""),unit_price:String(((Ke=H[0])==null?void 0:Ke.cost_price)??"")}]}})},rt=fe=>{me(he=>({...he,details:he.details.filter((Ue,Ye)=>Ye!==fe)}))},He=(fe,he)=>{me(Ue=>{const Ye=Ue.details.map((at,je)=>je===fe?{...at,...he}:at);let Ke=Ye[fe];Object.prototype.hasOwnProperty.call(he,"qty_ordered")&&(Ke.qty_received===""||Ke.qty_received==null)&&(Ke={...Ke,qty_received:he.qty_ordered},Ye[fe]=Ke);const Je=Object.prototype.hasOwnProperty.call(he,"qty_received_direct")&&he.qty_received_direct!=null&&Number.isFinite(Number(he.qty_received_direct))?Number(he.qty_received_direct):null;if(Object.prototype.hasOwnProperty.call(he,"item_id")){const at=_e.get(String(he.item_id)),je=(at==null?void 0:at.uom)&&String(at.uom)||Ke.uom&&String(Ke.uom)||(Ie?String(Ie):""),Se=String((at==null?void 0:at.cost_price)??"");Ke={...Ke,uom:je,input_uom:je,input_qty:"",qty_received:"",qty_accepted:"",unit_price:Se},Ye[fe]=Ke}const xe=Ke.uom&&String(Ke.uom)||(Ie?String(Ie):""),ye=Ke.input_uom&&String(Ke.input_uom)?String(Ke.input_uom):xe,Ae=!(Ke.input_qty===""||Ke.input_qty==null),be=Ae?Number(Ke.input_qty):null,Ee=!Ae&&Number.isFinite(Number(Ke.qty_received))?Number(Ke.qty_received):null;let dt=be!=null&&Number.isFinite(be)?be:Ee;if(Je!=null&&(dt=Je),Je==null&&dt!=null&&ye&&xe&&ye!==xe){const at=`${Ke.item_id}|${ye}|${xe}`,je=Fe.get(at);Number.isFinite(je)&&je>0&&(dt=dt*je)}const mt=dt!=null&&Number.isFinite(dt)?dt:"",it=Ke.unit_price===""?0:Number(Ke.unit_price||0),ht=Ke.qty_accepted===""||Ke.qty_accepted==null?null:Number(Ke.qty_accepted||0),ft=mt===""||mt==null?null:Number(mt||0),Rt=Ke.qty_ordered===""||Ke.qty_ordered==null?null:Number(Ke.qty_ordered||0),Ge=ht??null??ft??null??Rt??0;return Ye[fe]={...Ke,uom:xe,input_uom:ye,qty_received:mt,qty_accepted:Ke.qty_accepted===""||Ke.qty_accepted==null?mt:Ke.qty_accepted,amount:String(Number(Ge||0)*it)},{...Ue,details:Ye}})};f.useEffect(()=>{if(!X.po_id||!le.current)return;let fe=!0;return o(!0),Z.get(`/purchase/orders/${X.po_id}`).then(he=>{var Ke,Je,xe;if(!fe)return;const Ue=(Ke=he.data)==null?void 0:Ke.item,Ye=Array.isArray((xe=(Je=he.data)==null?void 0:Je.item)==null?void 0:xe.details)?he.data.item.details:[];Ue&&me(ye=>({...ye,supplier_id:Ue.supplier_id?String(Ue.supplier_id):ye.supplier_id,details:Ye.map(Ae=>{const be=H.find(dt=>String(dt.id)===String(Ae.item_id)),Ee=(be==null?void 0:be.uom)&&String(be.uom)||(Ie?String(Ie):"");return{item_id:Ae.item_id?String(Ae.item_id):"",qty_ordered:Ae.qty??"",input_qty:"",input_uom:Ee,qty_received:Ae.qty??"",qty_accepted:"",qty_rejected:"",uom:Ee,unit_price:String((be==null?void 0:be.cost_price)??""),amount:"",batch_serial:"",mfg_date:"",expiry_date:"",inspection_status:"PENDING",line_remarks:""}})}))}).catch(he=>{var Ue,Ye;h(((Ye=(Ue=he==null?void 0:he.response)==null?void 0:Ue.data)==null?void 0:Ye.message)||"Failed to load PO details")}).finally(()=>{fe&&o(!1)}),()=>{fe=!1}},[X.po_id]);const st=async fe=>{var he,Ue;fe.preventDefault(),u(!0),h("");try{const Ye={grn_no:X.grn_no||null,grn_date:X.grn_date,grn_type:"IMPORT",supplier_id:X.supplier_id?Number(X.supplier_id):null,warehouse_id:X.warehouse_id?Number(X.warehouse_id):null,po_id:X.po_id?Number(X.po_id):null,invoice_no:X.invoice_no||null,invoice_date:X.invoice_date||null,invoice_amount:X.invoice_amount===""||X.invoice_amount==null?null:Number(X.invoice_amount),invoice_due_date:X.invoice_due_date||null,delivery_number:X.delivery_number||null,delivery_date:X.delivery_date||null,bill_of_lading:X.bill_of_lading||null,customs_entry_no:X.customs_entry_no||null,shipping_company:X.shipping_company||null,port_of_entry:X.port_of_entry||null,remarks:X.remarks||null,details:(X.details||[]).map(Ke=>({item_id:Ke.item_id?Number(Ke.item_id):null,qty_ordered:Ke.qty_ordered===""?null:Number(Ke.qty_ordered),qty_received:Ke.qty_received===""?null:Number(Ke.qty_received),qty_accepted:Ke.qty_accepted===""?null:Number(Ke.qty_accepted),input_qty:Ke.input_qty===""?null:Number(Ke.input_qty),input_uom:Ke.input_uom||null,uom:Ke.uom||null,unit_price:Ke.unit_price===""?null:Number(Ke.unit_price),line_amount:Ke.amount===""?null:Number(Ke.amount),batch_serial:Ke.batch_serial||null,mfg_date:Ke.mfg_date||null,expiry_date:Ke.expiry_date||null,inspection_status:Ke.inspection_status||"PENDING",remarks:Ke.line_remarks||null}))};if(!Ye.grn_date||!Ye.supplier_id)throw new Error("GRN date and supplier are required");if(!Ye.po_id)throw new Error("Purchase order is required");if(!Ye.invoice_no||!Ye.invoice_date)throw new Error("Invoice number and date are required");r?await Z.post("/inventory/grn",{...Ye,port_clearance_id:X.port_clearance_id?Number(X.port_clearance_id):null}):await Z.put(`/inventory/grn/${t}`,{...Ye,port_clearance_id:X.port_clearance_id?Number(X.port_clearance_id):null}),s("/inventory/grn-import")}catch(Ye){h(((Ue=(he=Ye==null?void 0:Ye.response)==null?void 0:he.data)==null?void 0:Ue.message)||(Ye==null?void 0:Ye.message)||"Failed to save GRN")}finally{u(!1)}},De=async()=>{var fe,he,Ue;if(!r){W(!0),y("");try{const Ye=await Z.post(`/inventory/grn/${t}/submit`,{amount:X.invoice_amount===""||X.invoice_amount==null?null:Number(X.invoice_amount||0),workflow_id:j?j.id:null,target_user_id:T||null}),Ke=((fe=Ye==null?void 0:Ye.data)==null?void 0:fe.status)||"PENDING_APPROVAL";me(Je=>({...Je,status:Ke})),p(!1)}catch(Ye){y(((Ue=(he=Ye==null?void 0:Ye.response)==null?void 0:he.data)==null?void 0:Ue.message)||"Failed to forward for approval")}finally{W(!1)}}},Te=async()=>{var fe,he,Ue;if(!r)if(p(!0),y(""),R)await Ce();else try{x(!0);const Ye=await Z.get("/workflows"),Ke=Array.isArray((fe=Ye.data)==null?void 0:fe.items)?Ye.data.items:[];U(Ke),await Pe(Ke)}catch(Ye){y(((Ue=(he=Ye==null?void 0:Ye.response)==null?void 0:he.data)==null?void 0:Ue.message)||"Failed to load workflows")}finally{x(!1)}},Ce=async()=>{var Ye,Ke,Je;if(!R||!R.length){N(null),F(null),y("");return}const fe="/inventory/grn-import",he=xe=>String(xe||"").trim().toUpperCase().replace(/\s+/g,"_"),Ue=R.find(xe=>Number(xe.is_active)===1&&String(xe.document_route)===fe)||R.find(xe=>Number(xe.is_active)===1&&["GOODS_RECEIPT","GRN","GOODS_RECEIPT_NOTE"].includes(he(xe.document_type)))||null;if(N(Ue||null),F(null),!!Ue)try{x(!0);const ye=(Ye=(await Z.get(`/workflows/${Ue.id}`)).data)==null?void 0:Ye.item,Ae=Array.isArray(ye==null?void 0:ye.steps)?ye.steps:[];w(Ae);const be=Ae[0]||null;if(F(be?{userId:be.approver_user_id,name:be.approver_name,stepName:be.step_name,stepOrder:be.step_order,approvalLimit:be.approval_limit}:null),be){const Ee=(Array.isArray(be.approvers)&&be.approvers.length?be.approvers[0].id:be.approver_user_id)||null;Y(Ee)}else Y(null)}catch(xe){y(((Je=(Ke=xe==null?void 0:xe.response)==null?void 0:Ke.data)==null?void 0:Je.message)||"Failed to load workflow details")}finally{x(!1)}},Pe=async fe=>{var Ke,Je,xe;if(!fe||!fe.length){N(null),F(null),y("");return}const he="/inventory/grn-import",Ue=ye=>String(ye||"").trim().toUpperCase().replace(/\s+/g,"_"),Ye=fe.find(ye=>Number(ye.is_active)===1&&String(ye.document_route)===he)||fe.find(ye=>Number(ye.is_active)===1&&["GOODS_RECEIPT","GRN","GOODS_RECEIPT_NOTE"].includes(Ue(ye.document_type)))||null;if(N(Ye||null),F(null),!!Ye)try{x(!0);const Ae=(Ke=(await Z.get(`/workflows/${Ye.id}`)).data)==null?void 0:Ke.item,be=Array.isArray(Ae==null?void 0:Ae.steps)?Ae.steps:[];w(be);const Ee=be[0]||null;if(F(Ee?{userId:Ee.approver_user_id,name:Ee.approver_name,stepName:Ee.step_name,stepOrder:Ee.step_order,approvalLimit:Ee.approval_limit}:null),Ee){const dt=(Array.isArray(Ee.approvers)&&Ee.approvers.length?Ee.approvers[0].id:Ee.approver_user_id)||null;Y(dt)}else Y(null)}catch(ye){y(((xe=(Je=ye==null?void 0:ye.response)==null?void 0:Je.data)==null?void 0:xe.message)||"Failed to load workflow details")}finally{x(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:r?"New GRN (Import)":i?"View GRN (Import)":"Edit GRN (Import)"}),e.jsx("p",{className:"text-sm mt-1",children:"Goods receipt note for import purchases"})]}),e.jsx(Re,{to:"/inventory/grn-import",className:"btn-success",children:"Back to List"})]})}),e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:st,className:"space-y-6",children:[l?e.jsx("div",{className:"text-sm",children:"Loading..."}):null,c?e.jsx("div",{className:"text-sm text-red-600",children:c}):null,e.jsxs("fieldset",{disabled:i,className:`space-y-6 ${i?"disabled-light-blue":""}`,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"GRN No"}),e.jsx("input",{type:"text",className:"input",value:X.grn_no,onChange:fe=>me({...X,grn_no:fe.target.value}),placeholder:"Auto-generated if blank"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"GRN Date *"}),e.jsx("input",{type:"date",className:"input",value:X.grn_date,onChange:fe=>me({...X,grn_date:fe.target.value}),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Supplier *"}),e.jsxs("select",{className:"input",value:X.supplier_id,onChange:fe=>me({...X,supplier_id:fe.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select supplier..."}),q.map(fe=>e.jsx("option",{value:String(fe.id),children:fe.supplier_name},fe.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Port Clearance (Optional)"}),e.jsxs("select",{className:"input",value:X.port_clearance_id,onChange:fe=>me({...X,port_clearance_id:fe.target.value}),children:[e.jsx("option",{value:"",children:"Select port clearance..."}),we.map(fe=>e.jsx("option",{value:String(fe.id),children:fe.clearance_no},fe.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Warehouse"}),e.jsxs("select",{className:"input",value:X.warehouse_id,onChange:fe=>me({...X,warehouse_id:fe.target.value}),children:[e.jsx("option",{value:"",children:"Select warehouse..."}),Q.map(fe=>e.jsx("option",{value:String(fe.id),children:fe.warehouse_name||fe.name||"Unknown Warehouse"},fe.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Purchase Order *"}),e.jsxs("select",{className:"input",value:X.po_id,onChange:fe=>me({...X,po_id:fe.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select purchase order..."}),V.map(fe=>e.jsx("option",{value:String(fe.id),children:fe.po_no},fe.id))]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Supplier Invoice Details"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Supplier's Invoice Number *"}),e.jsx("input",{type:"text",className:"input",value:X.invoice_no,onChange:fe=>me({...X,invoice_no:fe.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Invoice Date *"}),e.jsx("input",{type:"date",className:"input",value:X.invoice_date,onChange:fe=>me({...X,invoice_date:fe.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Due Date"}),e.jsx("input",{type:"date",className:"input",value:X.invoice_due_date,onChange:fe=>me({...X,invoice_due_date:fe.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Delivery Number"}),e.jsx("input",{type:"text",className:"input",value:X.delivery_number,onChange:fe=>me({...X,delivery_number:fe.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Delivery Date"}),e.jsx("input",{type:"date",className:"input",value:X.delivery_date,onChange:fe=>me({...X,delivery_date:fe.target.value})})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Import Documentation"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Bill of Lading *"}),e.jsx("input",{type:"text",className:"input",value:X.bill_of_lading,onChange:fe=>me({...X,bill_of_lading:fe.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Customs Entry No *"}),e.jsx("input",{type:"text",className:"input",value:X.customs_entry_no,onChange:fe=>me({...X,customs_entry_no:fe.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Shipping Company"}),e.jsx("input",{type:"text",className:"input",value:X.shipping_company,onChange:fe=>me({...X,shipping_company:fe.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Port of Entry"}),e.jsx("input",{type:"text",className:"input",value:X.port_of_entry,onChange:fe=>me({...X,port_of_entry:fe.target.value})})]})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Remarks"}),e.jsx("textarea",{className:"input",rows:"3",value:X.remarks,onChange:fe=>me({...X,remarks:fe.target.value})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Items"}),e.jsx("button",{type:"button",className:"btn-success",onClick:Le,children:"+ Add Item"})]})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Ordered Qty"}),e.jsx("th",{children:"Input UOM"}),e.jsx("th",{children:"Received Qty"}),e.jsx("th",{}),e.jsx("th",{children:"Accepted Qty"}),e.jsx("th",{children:"Unit Price"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Batch/Serial"}),e.jsx("th",{children:"Mfg Date"}),e.jsx("th",{children:"Expiry Date"}),e.jsx("th",{children:"Inspection"}),e.jsx("th",{children:"Remarks"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[X.details.length?null:e.jsx("tr",{children:e.jsx("td",{colSpan:"14",className:"text-center py-6 text-slate-500 dark:text-slate-400",children:'No items. Click "Add Item" to begin.'})}),X.details.map((fe,he)=>{const Ue=fe.item_id?_e.get(String(fe.item_id)):null,Ye=Ue?`${Ue.item_code} - ${Ue.item_name}`:"Select item...";return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("select",{className:"input min-w-[320px]",value:fe.item_id,onChange:Ke=>He(he,{item_id:Ke.target.value}),children:[e.jsx("option",{value:"",children:"Select item..."}),H.map(Ke=>e.jsx("option",{value:String(Ke.id),children:Ke.item_name},Ke.id))]}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:Ye})]}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"1",className:"input min-w-[140px]",value:fe.qty_ordered,onChange:Ke=>He(he,{qty_ordered:Ke.target.value})})}),e.jsxs("td",{className:"pr-6 pl-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{className:"input w-auto min-w-[160px] flex-none",value:fe.input_uom||Ie||"",onChange:Ke=>He(he,{input_uom:Ke.target.value}),children:[e.jsx("option",{value:"",children:"Select UOM"}),G?e.jsx("option",{children:"Loading..."}):Array.isArray(B)&&B.map(Ke=>Ke&&e.jsx("option",{value:Ke.uom_code,children:Ke.uom_code},Ke.id))]})}),e.jsx("div",{className:"text-[11px] text-slate-500 mt-1",children:(()=>{const Ke=String(fe.input_uom||""),Je=String(fe.uom||Ie||""),xe=`${fe.item_id}|${Ke}|${Je}`,ye=Fe.get(xe);return Number(ye)>0?`Conversion: 1 ${Ke} = ${Number(ye).toFixed(6)} ${Je}`:Ke&&Je&&Ke===Je?"":e.jsxs(e.Fragment,{children:["No conversion defined for ",Ke,"  ",Je,"."," ",e.jsx(Re,{to:"/inventory/unit-conversions",className:"text-brand font-medium underline",children:"Define conversion"})]})})()})]}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"1",className:"input min-w-[140px]",value:fe.qty_received,onChange:Ke=>He(he,{qty_received_direct:Ke.target.value})})}),e.jsx("td",{children:(()=>{const Ke=String(fe.uom||Ie||""),Je=(Array.isArray(J)?J:[]).filter(be=>Number(be.is_active)&&Number(be.item_id)===Number(fe.item_id)&&String(be.to_uom)===Ke).map(be=>String(be.from_uom)),xe=String(fe.input_uom||""),ye=xe&&xe!==Ke?xe:Je[0]||"";return Je.length>0&&ye&&ye!==Ke?e.jsx("button",{type:"button",className:"px-2 py-1 text-xs border border-brand text-brand rounded hover:bg-brand hover:text-white transition-colors flex-none",onClick:()=>oe({open:!0,itemId:fe.item_id,defaultUom:Ke,currentUom:ye,lineIdx:he}),children:`number of ${ye}`}):null})()}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"1",className:"input min-w-[140px]",value:fe.qty_accepted,onChange:Ke=>He(he,{qty_accepted:Ke.target.value})})}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"1",className:"input min-w-[140px]",value:fe.unit_price,onChange:Ke=>He(he,{unit_price:Ke.target.value})})}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"1",className:"input min-w-[160px]",value:fe.amount,onChange:Ke=>He(he,{amount:Ke.target.value}),readOnly:!0})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input min-w-[160px]",value:fe.batch_serial,onChange:Ke=>He(he,{batch_serial:Ke.target.value})})}),e.jsx("td",{children:e.jsx("input",{type:"date",className:"input min-w-[160px]",value:fe.mfg_date,onChange:Ke=>He(he,{mfg_date:Ke.target.value})})}),e.jsx("td",{children:e.jsx("input",{type:"date",className:"input min-w-[160px]",value:fe.expiry_date,onChange:Ke=>He(he,{expiry_date:Ke.target.value})})}),e.jsx("td",{children:e.jsxs("select",{className:"input min-w-[140px]",value:fe.inspection_status||"PENDING",onChange:Ke=>He(he,{inspection_status:Ke.target.value}),children:[e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"PASSED",children:"Passed"}),e.jsx("option",{value:"FAILED",children:"Failed"})]})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input min-w-[200px]",value:fe.line_remarks,onChange:Ke=>He(he,{line_remarks:Ke.target.value})})}),e.jsx("td",{className:"text-right",children:e.jsx("button",{type:"button",className:"btn-success",onClick:()=>rt(he),children:"Remove"})})]},he)})]})]})})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx(Re,{to:"/inventory/grn-import",className:"btn-success",children:"Cancel"}),i?null:e.jsx("button",{type:"submit",className:"btn-success",disabled:d,children:d?"Saving...":"Save GRN"}),e.jsx("button",{type:"button",className:"btn-success ml-2",onClick:Te,disabled:d||r,children:String(X.status||"").toUpperCase()==="APPROVED"?"Approved":"Forward for Approval"})]})]})})]}),m?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-[640px] max-w-[95%]",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-brand text-white rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Forward GRN for Approval"}),e.jsx("button",{type:"button",onClick:()=>{p(!1),N(null),F(null),y("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Document No:"," ",e.jsx("span",{className:"font-semibold",children:X.grn_no})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:j?`${j.workflow_name} (${j.workflow_code})`:"None (inactive)"})]}),e.jsx("div",{children:g?e.jsx("div",{className:"text-sm",children:"Loading workflow..."}):null}),e.jsx("div",{children:b?e.jsx("div",{className:"text-sm text-red-600",children:b}):null}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Target Approver"}),(()=>{const he=Array.isArray(I)&&I.length>0?I[0]:null,Ue=he?Array.isArray(he.approvers)&&he.approvers.length?he.approvers.map(Ye=>({id:Ye.id,name:Ye.username})):he.approver_user_id?[{id:he.approver_user_id,name:he.approver_name||String(he.approver_user_id)}]:[]:[];return Ue.length>0?e.jsxs("div",{className:"mt-1",children:[e.jsxs("select",{className:"input w-full",value:T||"",onChange:Ye=>Y(Ye.target.value?Number(Ye.target.value):null),children:[e.jsx("option",{value:"",children:"Select target approver"}),Ue.map(Ye=>e.jsx("option",{value:Ye.id,children:Ye.name},Ye.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:_?`Step ${_.stepOrder}  ${_.stepName}${_.approvalLimit!=null?`  Limit: ${Number(_.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:j?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})()]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{p(!1),N(null),F(null),y("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:De,disabled:E||r,children:E?"Forwarding...":"Forward"})]})]})}):null,e.jsx(Ic,{open:ue.open,onClose:()=>oe({open:!1,itemId:null,defaultUom:"",currentUom:"",lineIdx:null}),itemId:ue.itemId?Number(ue.itemId):null,defaultUom:String(ue.defaultUom||""),currentUom:String(ue.currentUom||""),conversions:J,onApply:({converted_qty:fe})=>{const he=ue.lineIdx;he!=null&&He(he,{qty_received_direct:fe})}})]})}function mee(){const[t,s]=f.useState(""),[r,a]=f.useState([]),[n,i]=f.useState(!1),[l,o]=f.useState("");f.useEffect(()=>{let u=!0;return i(!0),o(""),Z.get("/inventory/transfer-acceptance").then(c=>{var h;u&&a(Array.isArray((h=c.data)==null?void 0:h.items)?c.data.items:[])}).catch(c=>{var h,m;u&&o(((m=(h=c==null?void 0:c.response)==null?void 0:h.data)==null?void 0:m.message)||"Failed to load transfers")}).finally(()=>{u&&i(!1)}),()=>{u=!1}},[]);const d=f.useMemo(()=>{const u=t.toLowerCase();return r.filter(c=>String(c.transfer_no||"").toLowerCase().includes(u)||String(c.from_warehouse_name||c.from_warehouse_id||"").toLowerCase().includes(u)||String(c.to_warehouse_name||c.to_warehouse_id||"").toLowerCase().includes(u)||String(c.status||"").toLowerCase().includes(u))},[r,t]);return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Transfer Acceptance"}),e.jsx("p",{className:"text-sm mt-1",children:"Receive transferred stock"})]}),e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"})]})}),e.jsxs("div",{className:"card-body",children:[l?e.jsx("div",{className:"text-sm text-red-600 mb-4",children:l}):null,e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by transfer no, from warehouse, status...",className:"input max-w-md",value:t,onChange:u=>s(u.target.value)})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Transfer No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"From Warehouse"}),e.jsx("th",{children:"To Warehouse"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[n?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):null,!n&&!d.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No transfers available for acceptance"})}):null,d.map(u=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:u.transfer_no}),e.jsx("td",{children:u.transfer_date?String(u.transfer_date).slice(0,10):"-"}),e.jsx("td",{children:u.from_warehouse_name||u.from_warehouse_id||"-"}),e.jsx("td",{children:u.to_warehouse_name||u.to_warehouse_id||"-"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${u.status==="IN_TRANSIT"?"badge-warning":"badge-info"}`,children:u.status})}),e.jsx("td",{children:e.jsx(Re,{to:`/inventory/transfer-acceptance/${u.id}`,className:"text-brand hover:text-brand-700 text-sm font-medium",children:"Open"})})]},u.id))]})]})})]})]})})}function hee(){const{id:t}=Ps(),s=ps(),[r,a]=f.useState(!1),[n,i]=f.useState(!1),[l,o]=f.useState(""),[d,u]=f.useState(null),[c,h]=f.useState([]);f.useEffect(()=>{let b=!0;return a(!0),o(""),Z.get(`/inventory/transfer-acceptance/${t}`).then(y=>{var N,_;if(!b)return;u(((N=y.data)==null?void 0:N.item)||null);const j=Array.isArray((_=y.data)==null?void 0:_.details)?y.data.details:[];h(j.map(F=>({...F,received_qty:Number(F.remaining_qty??F.qty??0),variance:0,rejected_now:0,remarks:""})))}).catch(y=>{var j,N;b&&o(((N=(j=y==null?void 0:y.response)==null?void 0:j.data)==null?void 0:N.message)||"Failed to load transfer")}).finally(()=>{b&&a(!1)}),()=>{b=!1}},[t]);const m=(b,y)=>{const j=parseFloat(y)||0;h(N=>N.map(_=>{if(_.id===b){const F=Number(_.remaining_qty??_.qty??0),I=Number(_.rejected_now||0),w=j+I-F;return{..._,received_qty:j,variance:w}}return _}))},p=(b,y)=>{const j=parseFloat(y)||0;h(N=>N.map(_=>{if(_.id===b){const F=Number(_.remaining_qty??_.qty??0),w=Number(_.received_qty||0)+j-F;return{..._,rejected_now:j,variance:w}}return _}))},g=(b,y)=>{h(j=>j.map(N=>N.id===b?{...N,remarks:y}:N))},x=async()=>{var b,y;i(!0),o("");try{const j={details:c.map(N=>{const _=Math.max(0,Number(N.remaining_qty??0)),F=Math.max(0,Math.min(Number(N.received_qty)||0,_)),I=Math.max(0,Number(N.rejected_now)||0),w=Math.max(0,Math.min(I,Math.max(0,_-F)));return{id:N.id,item_id:N.item_id,qty:Number(N.qty)||0,received_qty:F,accepted_qty:F,rejected_qty:w,acceptance_remarks:N.remarks}})};await Z.put(`/inventory/transfer-acceptance/${t}`,j),s("/inventory/transfer-acceptance")}catch(j){o(((y=(b=j==null?void 0:j.response)==null?void 0:b.data)==null?void 0:y.message)||"Failed to accept transfer")}finally{i(!1)}};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Transfer Acceptance"}),e.jsx("p",{className:"text-sm mt-1",children:"Review items and accept inbound transfer"})]}),e.jsx(Re,{to:"/inventory/transfer-acceptance",className:"btn-success",children:"Back to List"})]})}),e.jsxs("div",{className:"card-body space-y-6",children:[r?e.jsx("div",{className:"text-sm",children:"Loading..."}):null,l?e.jsx("div",{className:"text-sm text-red-600",children:l}):null,d?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Transfer No"}),e.jsx("div",{className:"font-semibold",children:d.transfer_no})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Date"}),e.jsx("div",{className:"font-semibold",children:d.transfer_date?String(d.transfer_date).slice(0,10):"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"From Warehouse"}),e.jsx("div",{className:"font-semibold",children:d.from_warehouse_name||d.from_warehouse_id||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"To Warehouse"}),e.jsx("div",{className:"font-semibold",children:d.to_warehouse_name||d.to_warehouse_id||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Status"}),e.jsx("div",{children:e.jsx("span",{className:`badge ${d.status==="IN_TRANSIT"?"badge-warning":"badge-info"}`,children:d.status})})]})]}):null,e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("h2",{className:"text-lg font-semibold text-slate-100 dark:text-slate-100",children:"Items Verification"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item Code"}),e.jsx("th",{children:"Item Name"}),e.jsx("th",{className:"w-24",children:"Transferred"}),e.jsx("th",{className:"w-24",children:"Remaining"}),e.jsx("th",{className:"w-28",children:"Receive Now"}),e.jsx("th",{className:"w-28",children:"Reject Now"}),e.jsx("th",{className:"w-24",children:"Variance"}),e.jsx("th",{children:"Remarks"})]})}),e.jsxs("tbody",{children:[c.length?null:e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-6 text-slate-500 dark:text-slate-400",children:"No items"})}),c.map(b=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:b.item_code}),e.jsx("td",{children:b.item_name}),e.jsx("td",{children:b.qty}),e.jsx("td",{children:Number(b.remaining_qty??0)}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"input h-8",value:b.received_qty,onChange:y=>m(b.id,y.target.value),min:"0",step:"0.001",max:Math.max(0,Number(b.remaining_qty??0)-Number(b.rejected_now||0)),disabled:(d==null?void 0:d.status)==="RECEIVED"})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"input h-8",value:b.rejected_now,onChange:y=>p(b.id,y.target.value),min:"0",step:"0.001",max:Math.max(0,Number(b.remaining_qty??0)-Number(b.received_qty||0)),disabled:(d==null?void 0:d.status)==="RECEIVED"})}),e.jsx("td",{children:e.jsxs("span",{className:`font-semibold ${b.variance<0?"text-red-600":b.variance>0?"text-blue-600":"text-green-600"}`,children:[b.variance>0?"+":"",b.variance]})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input h-8",value:b.remarks,onChange:y=>g(b.id,y.target.value),placeholder:"Variance reason...",disabled:(d==null?void 0:d.status)==="RECEIVED"})})]},b.id))]})]})})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx(Re,{to:"/inventory/transfer-acceptance",className:"btn-success",children:"Close"}),e.jsx("button",{type:"button",className:"btn-success",onClick:x,disabled:n||!d||d.status==="RECEIVED",children:n?"Accepting...":"Accept Transfer"})]})]})]})})}function Aee(){const{canPerformAction:t}=Ls(),[s,r]=f.useState(""),[a,n]=f.useState([]),[i,l]=f.useState(!1),[o,d]=f.useState("");f.useEffect(()=>{let c=!0;return l(!0),d(""),Z.get("/inventory/stock-takes").then(h=>{var m;c&&n(Array.isArray((m=h.data)==null?void 0:m.items)?h.data.items:[])}).catch(h=>{var m,p;c&&d(((p=(m=h==null?void 0:h.response)==null?void 0:m.data)==null?void 0:p.message)||"Failed to load stock takes")}).finally(()=>{c&&l(!1)}),()=>{c=!1}},[]);const u=f.useMemo(()=>{const c=s.toLowerCase();return a.filter(h=>String(h.stock_take_no||"").toLowerCase().includes(c)||String(h.status||"").toLowerCase().includes(c))},[a,s]);return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Daily Stock Take"}),e.jsx("p",{className:"text-sm mt-1",children:"Perform physical stock counts"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/inventory/stock-take/new",className:"btn-success",children:"+ New Stock Take"})]})]})}),e.jsxs("div",{className:"card-body",children:[o?e.jsx("div",{className:"text-sm text-red-600 mb-4",children:o}):null,e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by stock take no or status...",className:"input max-w-md",value:s,onChange:c=>r(c.target.value)})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Warehouse"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[i?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):null,!i&&!u.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No stock takes found"})}):null,u.map(c=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:c.stock_take_no}),e.jsx("td",{children:c.stock_take_date?String(c.stock_take_date).slice(0,10):"-"}),e.jsx("td",{children:c.warehouse_name||"-"}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-info",children:c.status||"DRAFT"})}),e.jsxs("td",{children:[t("inventory:stock-take","view")&&e.jsx(Re,{to:`/inventory/stock-take/${c.id}?mode=view`,className:"text-brand hover:text-brand-700 text-sm font-medium",children:"View"}),t("inventory:stock-take","edit")&&e.jsx(Re,{to:`/inventory/stock-take/${c.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"})]})]},c.id))]})]})})]})]})})}function oC(t){if(!t)return"";try{return new Date(t).toISOString().slice(0,10)}catch{return""}}function fee(){const{id:t}=Ps(),s=ps(),r=t==="new",[a,n]=f.useState(!1),[i,l]=f.useState(!1),[o,d]=f.useState(""),[u,c]=f.useState([]),[h,m]=f.useState([]),[p,g]=f.useState({stock_take_no:"",stock_take_date:oC(new Date),warehouse_id:"",status:"DRAFT",details:[]});f.useEffect(()=>{let _=!0;return d(""),Promise.all([Z.get("/inventory/items"),Z.get("/inventory/warehouses")]).then(([F,I])=>{var w,E;_&&(c(Array.isArray((w=F.data)==null?void 0:w.items)?F.data.items:[]),m(Array.isArray((E=I.data)==null?void 0:E.items)?I.data.items:[]))}).catch(F=>{var I,w;_&&d(((w=(I=F==null?void 0:F.response)==null?void 0:I.data)==null?void 0:w.message)||"Failed to load lookups")}),()=>{_=!1}},[]),f.useEffect(()=>{if(r)return;let _=!0;return n(!0),d(""),Z.get(`/inventory/stock-takes/${t}`).then(F=>{var E,W;if(!_)return;const I=(E=F.data)==null?void 0:E.item,w=Array.isArray((W=F.data)==null?void 0:W.details)?F.data.details:[];I&&g({stock_take_no:I.stock_take_no||"",stock_take_date:oC(I.stock_take_date),warehouse_id:I.warehouse_id?String(I.warehouse_id):"",status:I.status||"DRAFT",details:w.map(R=>({item_id:R.item_id?String(R.item_id):"",physical_qty:R.physical_qty??""}))})}).catch(F=>{var I,w;_&&d(((w=(I=F==null?void 0:F.response)==null?void 0:I.data)==null?void 0:w.message)||"Failed to load stock take")}).finally(()=>{_&&n(!1)}),()=>{_=!1}},[t,r]);const x=f.useMemo(()=>{const _=new Map;for(const F of u)_.set(String(F.id),F);return _},[u]),b=()=>{g(_=>{var F;return{..._,details:[..._.details,{item_id:(F=u[0])!=null&&F.id?String(u[0].id):"",physical_qty:""}]}})},y=_=>{g(F=>({...F,details:F.details.filter((I,w)=>w!==_)}))},j=(_,F)=>{g(I=>({...I,details:I.details.map((w,E)=>E===_?{...w,...F}:w)}))},N=async _=>{var F,I;_.preventDefault(),l(!0),d("");try{const w={stock_take_no:p.stock_take_no||null,stock_take_date:p.stock_take_date,warehouse_id:p.warehouse_id?Number(p.warehouse_id):null,status:p.status||"DRAFT",details:(p.details||[]).map(E=>({item_id:E.item_id?Number(E.item_id):null,physical_qty:E.physical_qty===""?null:Number(E.physical_qty)}))};if(!w.stock_take_date)throw new Error("Date is required");r?await Z.post("/inventory/stock-takes",w):await Z.put(`/inventory/stock-takes/${t}`,w),s("/inventory/stock-take")}catch(w){d(((I=(F=w==null?void 0:w.response)==null?void 0:F.data)==null?void 0:I.message)||(w==null?void 0:w.message)||"Failed to save stock take")}finally{l(!1)}};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"New Stock Take":"Edit Stock Take"}),e.jsx("p",{className:"text-sm mt-1",children:"Record physical stock quantities"})]}),e.jsx(Re,{to:"/inventory/stock-take",className:"btn-success",children:"Back to List"})]})}),e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[a?e.jsx("div",{className:"text-sm",children:"Loading..."}):null,o?e.jsx("div",{className:"text-sm text-red-600",children:o}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"No"}),e.jsx("input",{type:"text",className:"input",value:p.stock_take_no,onChange:_=>g({...p,stock_take_no:_.target.value}),placeholder:"Auto-generated if blank"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Date *"}),e.jsx("input",{type:"date",className:"input",value:p.stock_take_date,onChange:_=>g({...p,stock_take_date:_.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:p.status,onChange:_=>g({...p,status:_.target.value}),children:[e.jsx("option",{value:"DRAFT",children:"DRAFT"}),e.jsx("option",{value:"COMPLETED",children:"COMPLETED"}),e.jsx("option",{value:"CANCELLED",children:"CANCELLED"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Warehouse"}),e.jsxs("select",{className:"input",value:p.warehouse_id,onChange:_=>g({...p,warehouse_id:_.target.value}),children:[e.jsx("option",{value:"",children:"All / Not specified"}),h.map(_=>e.jsx("option",{value:String(_.id),children:(_.warehouse_code?`${_.warehouse_code} - `:"")+_.warehouse_name},_.id))]})]})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Count Lines"}),e.jsx("button",{type:"button",className:"btn-success",onClick:b,children:"+ Add Item"})]})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Physical Qty"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[p.details.length?null:e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"text-center py-6 text-slate-500 dark:text-slate-400",children:'No lines. Click "Add Item" to begin.'})}),p.details.map((_,F)=>{const I=_.item_id?x.get(String(_.item_id)):null,w=I?`${I.item_code} - ${I.item_name}`:"Select item...";return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("select",{className:"input",value:_.item_id,onChange:E=>j(F,{item_id:E.target.value}),children:[e.jsx("option",{value:"",children:"Select item..."}),u.map(E=>e.jsxs("option",{value:String(E.id),children:[E.item_code," - ",E.item_name]},E.id))]}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:w})]}),e.jsx("td",{children:e.jsx("input",{type:"number",step:"0.001",className:"input",value:_.physical_qty,onChange:E=>j(F,{physical_qty:E.target.value})})}),e.jsx("td",{className:"text-right",children:e.jsx("button",{type:"button",className:"btn-success",onClick:()=>y(F),children:"Remove"})})]},F)})]})]})})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx(Re,{to:"/inventory/stock-take",className:"btn-success",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-success",disabled:i,children:i?"Saving...":"Save"})]})]})})]})})}function pee(){const{canPerformAction:t}=Ls(),[s,r]=f.useState(""),[a,n]=f.useState([]),[i,l]=f.useState([]),[o,d]=f.useState(!1),[u,c]=f.useState(!1),[h,m]=f.useState(""),[p,g]=f.useState("");f.useEffect(()=>{let y=!0;return d(!0),m(""),c(!0),g(""),Z.get("/inventory/item-groups").then(j=>{var N;y&&n(Array.isArray((N=j.data)==null?void 0:N.items)?j.data.items:[])}).catch(j=>{var N,_;y&&m(((_=(N=j==null?void 0:j.response)==null?void 0:N.data)==null?void 0:_.message)||"Failed to load item groups")}).finally(()=>{y&&d(!1)}),Z.get("/inventory/item-categories").then(j=>{var N;y&&l(Array.isArray((N=j.data)==null?void 0:N.items)?j.data.items:[])}).catch(j=>{var N,_;y&&g(((_=(N=j==null?void 0:j.response)==null?void 0:N.data)==null?void 0:_.message)||"Failed to load item categories")}).finally(()=>{y&&c(!1)}),()=>{y=!1}},[]);const x=f.useMemo(()=>{const y=s.toLowerCase();return a.filter(j=>String(j.group_code||"").toLowerCase().includes(y)||String(j.group_name||"").toLowerCase().includes(y)||String(j.parent_group_name||"").toLowerCase().includes(y))},[a,s]),b=f.useMemo(()=>{const y=s.toLowerCase();return i.filter(j=>String(j.category_code||"").toLowerCase().includes(y)||String(j.category_name||"").toLowerCase().includes(y)||String(j.parent_category_name||"").toLowerCase().includes(y))},[i,s]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Item Groups & Sub Groups"}),e.jsx("p",{className:"text-sm mt-1",children:"Organize items by categories"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/inventory/item-groups/new",className:"btn-success","data-rbac-exempt":"true",children:"+ New Group"})]})]})}),e.jsxs("div",{className:"card-body",children:[h?e.jsx("div",{className:"text-sm text-red-600 mb-4",children:h}):null,e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by code, name, or parent...",className:"input max-w-md",value:s,onChange:y=>r(y.target.value)})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Parent"}),e.jsx("th",{children:"Active"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[o?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):null,!o&&!x.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No item groups found"})}):null,x.map(y=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:y.group_code}),e.jsx("td",{children:y.group_name}),e.jsx("td",{children:y.parent_group_name||"-"}),e.jsx("td",{children:y.is_active?"Yes":"No"}),e.jsxs("td",{children:[e.jsx(Re,{to:`/inventory/item-groups/${y.id}?mode=view`,className:"text-brand hover:text-brand-700 text-sm font-medium","data-rbac-exempt":"true",children:"View"}),e.jsx(Re,{to:`/inventory/item-groups/${y.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2","data-rbac-exempt":"true",children:"Edit"})]})]},y.id))]})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"flex justify-between items-center text-white",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold dark:text-brand-300",children:"Item Categories"}),e.jsx("p",{className:"text-sm mt-1",children:"Organize items by category"})]})})}),e.jsxs("div",{className:"card-body",children:[p?e.jsx("div",{className:"text-sm text-red-600 mb-4",children:p}):null,e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Parent"}),e.jsx("th",{children:"Active"})]})}),e.jsxs("tbody",{children:[u?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):null,!u&&!b.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No item categories found"})}):null,b.map(y=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:y.category_code}),e.jsx("td",{children:y.category_name}),e.jsx("td",{children:y.parent_category_name||"-"}),e.jsx("td",{children:y.is_active?"Yes":"No"})]},y.id))]})]})})]})]})]})}const xee=()=>{const[t,s]=f.useState("groups"),[r,a]=f.useState([]),{uoms:n,refresh:i}=$i(),{categories:l,refresh:o}=oF(),{itemTypes:d,refresh:u}=cF(),[c,h]=f.useState(!1),[m,p]=f.useState("create"),[g,x]=f.useState("group"),[b,y]=f.useState(""),[j,N]=f.useState(null),[_,F]=f.useState(!1),[I,w]=f.useState({code:"",name:"",type:"COUNT",parent:"",active:"Y"}),E=[{value:"COUNT",label:"Count"},{value:"WEIGHT",label:"Weight"},{value:"VOLUME",label:"Volume"},{value:"LENGTH",label:"Length"}],W=(Array.isArray(l)?l:[]).map(k=>({...k,category_id:k.category_id??k.id,is_active:k.is_active===1||k.is_active===!0||k.is_active==="Y"?"Y":"N"})),R=(Array.isArray(d)?d:[]).map(k=>({...k,type_id:k.type_id??k.id,is_active:k.is_active===1||k.is_active===!0||k.is_active==="Y"?"Y":"N"}));f.useEffect(()=>{U()},[]);const U=async()=>{var k;try{F(!0);const B=await Z.get("/inventory/item-groups"),O=(Array.isArray((k=B.data)==null?void 0:k.items)?B.data.items:[]).map(K=>({group_id:K.id,group_code:K.group_code,group_name:K.group_name,is_active:K.is_active?"Y":"N"}));a(O)}catch(B){console.error("Failed to fetch item groups",B)}finally{F(!1)}},T=(k,B)=>{const G=B.reduce((O,K)=>{const J=K.group_code||K.category_code||K.uom_code||K.type_code,te=parseInt(J.replace(/\D/g,""))||0;return Math.max(O,te)},0);return`${k}${(G+1).toString().padStart(3,"0")}`},Y=(k,B,G=null)=>{if(x(k),p(B),B==="create"){const O=k==="group"?"GRP":k==="category"?"CAT":k==="type"?"TYP":"";w({code:O?T(O,k==="group"?r:k==="category"?W:k==="type"?R:n):"",name:"",type:"COUNT",parent:"",active:"Y"})}else B==="edit"&&G&&(w({code:G.group_code||G.category_code||G.uom_code||G.type_code,name:G.group_name||G.category_name||G.uom_name||G.type_name,type:G.uom_type||"COUNT",parent:G.parent_category_id||"",active:G.is_active===1||G.is_active==="Y"?"Y":"N"}),N(G));h(!0)},H=async()=>{var k,B;if(!I.name){alert("Please fill in all required fields");return}try{if(g==="group"){const G={group_code:I.code,group_name:I.name,is_active:I.active==="Y"?1:0};m==="create"?await Z.post("/inventory/item-groups",G):await Z.put(`/inventory/item-groups/${j.group_id}`,G),await U()}else if(g==="category"){const G={category_code:I.code,category_name:I.name,parent_category_id:I.parent||null,is_active:I.active==="Y"?1:0};m==="create"?await Z.post("/inventory/item-categories",G):await Z.put(`/inventory/item-categories/${j.id}`,G),await o()}else if(g==="uom"){const G={uom_code:I.code,uom_name:I.name,uom_type:I.type,is_active:I.active==="Y"?1:0};m==="create"?await Z.post("/inventory/uoms",G):await Z.put(`/inventory/uoms/${j.id}`,G),await i()}else if(g==="type"){const G={type_code:I.code,type_name:I.name,is_active:I.active==="Y"?1:0};m==="create"?await Z.post("/inventory/item-types",G):await Z.put(`/inventory/item-types/${j.type_id}`,G),await u()}h(!1),N(null)}catch(G){alert("Failed to save item: "+(((B=(k=G.response)==null?void 0:k.data)==null?void 0:B.message)||G.message))}},M=async(k,B)=>{var G,O,K,J,te,se;if(window.confirm("Are you sure you want to delete this item?")){if(k==="group")alert("Delete is not currently supported for Item Groups.");else if(k==="category")try{await Z.delete(`/inventory/item-categories/${B}`),await o()}catch(ae){alert("Failed to delete category: "+(((O=(G=ae.response)==null?void 0:G.data)==null?void 0:O.message)||ae.message))}else if(k==="uom")try{await Z.delete(`/inventory/uoms/${B}`),await i()}catch(ae){alert("Failed to delete UOM: "+(((J=(K=ae.response)==null?void 0:K.data)==null?void 0:J.message)||ae.message))}else if(k==="type")try{await Z.delete(`/inventory/item-types/${B}`),await u()}catch(ae){alert("Failed to delete item type: "+(((se=(te=ae.response)==null?void 0:te.data)==null?void 0:se.message)||ae.message))}}},q=k=>{if(!k)return"Root";const B=W.find(G=>G.category_id===k);return B?B.category_name:"Root"},z=k=>{var B;return((B=E.find(G=>G.value===k))==null?void 0:B.label)||k},Q=(k,B)=>k.filter(G=>[G.group_code||"",G.group_name||"",G.category_code||"",G.category_name||"",G.uom_code||"",G.uom_name||"",G.type_code||"",G.type_name||""].some(K=>K.toLowerCase().includes(B.toLowerCase()))),L=Q(r,b),V=Q(W,b),P=Q(n,b),C=Q(R,b);return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"mb-2",children:e.jsx(Re,{to:"/inventory/item-groups",className:"inline-flex items-center gap-2 text-sm text-brand hover:text-brand-700","data-rbac-exempt":"true",children:" Back to Item Groups"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Item Setup Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage item groups, categories, and units of measure"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Item Groups"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.length})]}),e.jsx(Au,{className:"w-10 h-10 text-blue-500"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Categories"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:W.length})]}),e.jsx(Uw,{className:"w-10 h-10 text-green-500"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Item Types"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:R.length})]}),e.jsx(Au,{className:"w-10 h-10 text-amber-500"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Units of Measure"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.length})]}),e.jsx(Rw,{className:"w-10 h-10 text-purple-500"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px",children:[e.jsx("button",{onClick:()=>s("groups"),className:`py-4 px-6 font-medium text-sm border-b-2 transition-colors ${t==="groups"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Au,{className:"w-5 h-5"}),"Item Groups"]})}),e.jsx("button",{onClick:()=>s("categories"),className:`py-4 px-6 font-medium text-sm border-b-2 transition-colors ${t==="categories"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Uw,{className:"w-5 h-5"}),"Categories"]})}),e.jsx("button",{onClick:()=>s("types"),className:`py-4 px-6 font-medium text-sm border-b-2 transition-colors ${t==="types"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Au,{className:"w-5 h-5"}),"Item Types"]})}),e.jsx("button",{onClick:()=>s("uom"),className:`py-4 px-6 font-medium text-sm border-b-2 transition-colors ${t==="uom"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Rw,{className:"w-5 h-5"}),"Units of Measure"]})})]})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsx("div",{className:"flex-1 w-full md:w-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx(Jf,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:b,onChange:k=>y(k.target.value)})]})}),e.jsxs("button",{onClick:()=>Y(t==="groups"?"group":t==="categories"?"category":t==="types"?"type":"uom","create"),className:"flex items-center gap-2 px-4 py-2 text-white rounded-lg hover:opacity-90",style:{backgroundColor:"#0E3646"},"data-rbac-exempt":"true",children:[e.jsx(Ec,{className:"w-5 h-5"}),"Add New"]})]})}),e.jsxs("div",{className:"overflow-x-auto",children:[t==="groups"&&e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{style:{backgroundColor:"#0E3646"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"Code"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"Group Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"Actions"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[_&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center py-4",children:"Loading..."})}),!_&&L.map(k=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:k.group_code}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:k.group_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${k.is_active==="Y"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:k.is_active==="Y"?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Y("group","edit",k),className:"text-blue-600 hover:text-blue-900",children:e.jsx(kh,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>M("group",k.group_id),className:"text-red-600 hover:text-red-900",children:e.jsx(ol,{className:"w-5 h-5"})})]})})]},k.group_id))]})]}),t==="categories"&&e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{style:{backgroundColor:"#0E3646"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"Code"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"Category Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"Parent"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:V.map(k=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:k.category_code}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:k.category_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:q(k.parent_category_id)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${k.is_active==="Y"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:k.is_active==="Y"?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Y("category","edit",k),className:"text-blue-600 hover:text-blue-900",children:e.jsx(kh,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>M("category",k.category_id),className:"text-red-600 hover:text-red-900",children:e.jsx(ol,{className:"w-5 h-5"})})]})})]},k.category_id))})]}),t==="types"&&e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{style:{backgroundColor:"#0E3646"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"Code"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"Type Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:C.map(k=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:k.type_code}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:k.type_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${k.is_active==="Y"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:k.is_active==="Y"?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Y("type","edit",k),className:"text-blue-600 hover:text-blue-900",children:e.jsx(kh,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>M("type",k.type_id),className:"text-red-600 hover:text-red-900",children:e.jsx(ol,{className:"w-5 h-5"})})]})})]},k.type_id))})]}),t==="uom"&&e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{style:{backgroundColor:"#0E3646"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"Code"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"UOM Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:P.map(k=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:k.uom_code}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:k.uom_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:z(k.uom_type)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${k.is_active==="Y"||k.is_active===1||k.is_active===!0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:k.is_active==="Y"||k.is_active===1||k.is_active===!0?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Y("uom","edit",k),className:"text-blue-600 hover:text-blue-900",children:e.jsx(kh,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>M("uom",k.uom_id),className:"text-red-600 hover:text-red-900",children:e.jsx(ol,{className:"w-5 h-5"})})]})})]},k.uom_id))})]})]})]})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-lg w-full",children:[e.jsx("div",{className:"p-6 border-b",style:{backgroundColor:"#0E3646"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-bold text-white",children:[m==="create"?"Add":"Edit"," ",g==="group"?"Group":g==="category"?"Category":g==="type"?"Item Type":"UOM"]}),e.jsx("button",{onClick:()=>h(!1),className:"text-white hover:text-gray-200",children:e.jsx(Hk,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Code *"}),e.jsx("input",{type:"text",value:I.code,onChange:k=>w({...I,code:k.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",readOnly:g!=="uom"&&m==="create"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),e.jsx("input",{type:"text",value:I.name,onChange:k=>w({...I,name:k.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter name"})]}),g==="category"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Parent Category"}),e.jsxs("select",{value:I.parent,onChange:k=>w({...I,parent:k.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Root (No Parent)"}),W.filter(k=>k.category_id!==(j==null?void 0:j.category_id)).map(k=>e.jsx("option",{value:k.category_id,children:k.category_name},k.category_id))]})]}),g==="uom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),e.jsx("select",{value:I.type,onChange:k=>w({...I,type:k.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:E.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:I.active,onChange:k=>w({...I,active:k.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"Y",children:"Active"}),e.jsx("option",{value:"N",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"p-6 border-t bg-gray-50 flex justify-end gap-3 rounded-b-lg",children:[e.jsx("button",{onClick:()=>h(!1),className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:H,className:"px-4 py-2 text-white rounded-lg hover:opacity-90",style:{backgroundColor:"#0E3646"},"data-rbac-exempt":"true",children:m==="create"?"Create":"Save Changes"})]})]})})]})};function gee(){const{canPerformAction:t}=Ls(),[s,r]=f.useState(""),[a,n]=f.useState([]),[i,l]=f.useState(!1),[o,d]=f.useState("");f.useEffect(()=>{let c=!0;return l(!0),d(""),Z.get("/inventory/unit-conversions").then(h=>{var m;c&&n(Array.isArray((m=h.data)==null?void 0:m.items)?h.data.items:[])}).catch(h=>{var m,p;c&&d(((p=(m=h==null?void 0:h.response)==null?void 0:m.data)==null?void 0:p.message)||"Failed to load unit conversions")}).finally(()=>{c&&l(!1)}),()=>{c=!1}},[]);const u=f.useMemo(()=>{const c=s.toLowerCase();return a.filter(h=>String(h.item_code||"").toLowerCase().includes(c)||String(h.item_name||"").toLowerCase().includes(c)||String(h.from_uom||"").toLowerCase().includes(c)||String(h.to_uom||"").toLowerCase().includes(c))},[a,s]);return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Unit Conversion"}),e.jsx("p",{className:"text-sm mt-1",children:"Define unit conversions per item"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/inventory/unit-conversions/new",className:"btn-success",children:"+ New Conversion"})]})]})}),e.jsxs("div",{className:"card-body",children:[o?e.jsx("div",{className:"text-sm text-red-600 mb-4",children:o}):null,e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by item, from/to UOM...",className:"input max-w-md",value:s,onChange:c=>r(c.target.value)})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"From"}),e.jsx("th",{children:"To"}),e.jsx("th",{children:"Factor"}),e.jsx("th",{children:"Active"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[i?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):null,!i&&!u.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No unit conversions found"})}):null,u.map(c=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"font-medium text-slate-900 dark:text-slate-100",children:[c.item_code," - ",c.item_name]})}),e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:c.from_uom}),e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:c.to_uom}),e.jsx("td",{children:c.conversion_factor}),e.jsx("td",{children:c.is_active?"Yes":"No"}),e.jsxs("td",{children:[t("inventory:unit-conversions","view")&&e.jsx(Re,{to:`/inventory/unit-conversions/${c.id}?mode=view`,className:"text-brand hover:text-brand-700 text-sm font-medium",children:"View"}),t("inventory:unit-conversions","edit")&&e.jsx(Re,{to:`/inventory/unit-conversions/${c.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"})]})]},c.id))]})]})})]})]})})}function vee(){const[t,s]=f.useState("conversions"),[r,a]=f.useState(!1),[n,i]=f.useState(""),{uoms:l,loading:o}=$i(),[d,u]=f.useState([]),[c,h]=f.useState([]),[m,p]=f.useState(""),[g,x]=f.useState(""),[b,y]=f.useState(""),[j,N]=f.useState(!1),[_,F]=f.useState("create"),[I,w]=f.useState({item_id:"",from_uom:"",to_uom:"",conversion_factor:"1",is_active:!0}),[E,W]=f.useState(""),[R,U]=f.useState(""),[T,Y]=f.useState(""),[H,M]=f.useState(""),[q,z]=f.useState(null);f.useEffect(()=>{let O=!0;return a(!0),i(""),Promise.all([Z.get("/inventory/items"),Z.get("/inventory/unit-conversions")]).then(([K,J])=>{var te,se;O&&(u(Array.isArray((te=K.data)==null?void 0:te.items)?K.data.items:[]),h(Array.isArray((se=J.data)==null?void 0:se.items)?J.data.items:[]))}).catch(K=>{var J,te;O&&i(((te=(J=K==null?void 0:K.response)==null?void 0:J.data)==null?void 0:te.message)||"Failed to load data")}).finally(()=>{O&&a(!1)}),()=>{O=!1}},[]),f.useMemo(()=>{const O=new Map;for(const K of d)O.set(String(K.id),K);return O},[d]);const Q=async()=>{var O,K,J,te;a(!0),i("");try{const[se,ae]=await Promise.all([Z.get("/inventory/items"),Z.get("/inventory/unit-conversions")]);u(Array.isArray((O=se.data)==null?void 0:O.items)?se.data.items:[]),h(Array.isArray((K=ae.data)==null?void 0:K.items)?ae.data.items:[])}catch(se){i(((te=(J=se==null?void 0:se.response)==null?void 0:J.data)==null?void 0:te.message)||"Failed to refresh data")}finally{a(!1)}},L=f.useMemo(()=>{const O=m.toLowerCase();return c.filter(K=>{const J=String(K.item_code||"").toLowerCase().includes(O)||String(K.item_name||"").toLowerCase().includes(O),te=g?String(K.from_uom||"")===g:!0,se=b===""?!0:b==="Y"?!!K.is_active:!K.is_active;return J&&te&&se}).sort((K,J)=>String(K.item_name||"").localeCompare(String(J.item_name||"")))},[c,m,g,b]),V=(O,K=null)=>{F(O),O==="create"?w({item_id:"",from_uom:"",to_uom:"",conversion_factor:"1",is_active:!0}):K&&w({item_id:K.item_id?String(K.item_id):"",from_uom:K.from_uom||"",to_uom:K.to_uom||"",conversion_factor:K.conversion_factor!=null?String(K.conversion_factor):"1",is_active:!!K.is_active,id:K.id}),N(!0)},P=async()=>{var K,J;const O={item_id:I.item_id?Number(I.item_id):null,from_uom:String(I.from_uom||"").trim(),to_uom:String(I.to_uom||"").trim(),conversion_factor:Number(I.conversion_factor),is_active:I.is_active?1:0};if(!O.item_id)return alert("Item is required");if(!O.from_uom)return alert("From UOM is required");if(!O.to_uom)return alert("To UOM is required");if(!Number.isFinite(O.conversion_factor)||O.conversion_factor<=0)return alert("Conversion factor must be a positive number");try{_==="create"?await Z.post("/inventory/unit-conversions",O):await Z.put(`/inventory/unit-conversions/${I.id}`,O),N(!1),await Q()}catch(te){alert(((J=(K=te==null?void 0:te.response)==null?void 0:K.data)==null?void 0:J.message)||"Failed to save unit conversion")}},C=async O=>{alert("Delete is not currently supported for Unit Conversions.")},k=f.useMemo(()=>{const O=E?Number(E):null;return O?c.filter(K=>Number(K.item_id)===O):[]},[c,E]),B=f.useMemo(()=>{const O=new Set;for(const K of k)O.add(K.from_uom);return Array.from(O)},[k]),G=f.useMemo(()=>{const O=new Set;for(const K of k)O.add(K.to_uom);return Array.from(O)},[k]);return f.useEffect(()=>{if(!E||!T||!H||!R){z(null);return}const O=k.find(J=>String(J.from_uom)===String(T)&&String(J.to_uom)===String(H));if(!O){z(null);return}const K=Number(R);if(!Number.isFinite(K)){z(null);return}z(K*Number(O.conversion_factor||0))},[E,T,H,R,k]),e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-1",children:"Unit Conversion Management"}),e.jsx("p",{className:"text-gray-600",children:"Define and calculate item unit conversions"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Back to Menu"}),e.jsx("button",{className:"btn-success",onClick:Q,children:"Refresh"}),e.jsx("button",{className:"btn-success",onClick:()=>V("create"),children:"+ New Conversion"})]})]})}),n?e.jsx("div",{className:"text-sm text-red-600 mb-4",children:n}):null,e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px",children:[e.jsx("button",{onClick:()=>s("conversions"),className:`py-4 px-6 font-medium text-sm border-b-2 transition-colors ${t==="conversions"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Unit Conversions"}),e.jsx("button",{onClick:()=>s("uom"),className:`py-4 px-6 font-medium text-sm border-b-2 transition-colors ${t==="uom"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Units of Measure"}),e.jsx("button",{onClick:()=>s("calculator"),className:`py-4 px-6 font-medium text-sm border-b-2 transition-colors ${t==="calculator"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Quick Calculator"})]})}),e.jsxs("div",{className:"p-4",children:[t==="conversions"&&e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[e.jsx("input",{className:"input",placeholder:"Search by item name or code",value:m,onChange:O=>p(O.target.value)}),e.jsxs("select",{className:"input",value:g,onChange:O=>x(O.target.value),children:[e.jsx("option",{value:"",children:"All Units"}),Array.from(new Set(c.map(O=>O.from_uom))).map(O=>O?e.jsx("option",{value:O,children:O},O):null)]}),e.jsxs("select",{className:"input",value:b,onChange:O=>y(O.target.value),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"Y",children:"Active"}),e.jsx("option",{value:"N",children:"Inactive"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-success",onClick:()=>{},children:"Search"}),e.jsx("button",{className:"btn-outline",onClick:()=>{p(""),x(""),y("")},children:"Clear"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item Code"}),e.jsx("th",{children:"Item Name"}),e.jsx("th",{children:"From UOM"}),e.jsx("th",{children:"To UOM"}),e.jsx("th",{children:"Conversion Factor"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[r?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-8 text-slate-500",children:"Loading..."})}):null,!r&&!L.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-8 text-slate-500",children:"No conversions found"})}):null,L.map(O=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:O.item_code}),e.jsx("td",{children:O.item_name}),e.jsx("td",{children:O.from_uom}),e.jsx("td",{children:O.to_uom}),e.jsx("td",{children:Number(O.conversion_factor||0).toString()}),e.jsx("td",{children:e.jsx("span",{className:`badge ${O.is_active?"badge-success":"badge-error"}`,children:O.is_active?"ACTIVE":"INACTIVE"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-outline",onClick:()=>V("edit",O),children:"Edit"}),e.jsx("button",{className:"btn-outline",onClick:()=>C(O.id),children:"Delete"})]})})]},O.id))]})]})})]}),t==="uom"&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"UOM Code"}),e.jsx("th",{children:"UOM Name"}),e.jsx("th",{children:"UOM Type"}),e.jsx("th",{children:"Status"})]})}),e.jsxs("tbody",{children:[o?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center py-8 text-slate-500",children:"Loading..."})}):null,!o&&!l.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center py-8 text-slate-500",children:"No UOMs found"})}):null,l.map(O=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:O.uom_code}),e.jsx("td",{children:O.uom_name}),e.jsx("td",{children:O.uom_type}),e.jsx("td",{children:O.is_active?"Active":"Inactive"})]},O.id))]})]})}),t==="calculator"&&e.jsxs("div",{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Select Item"}),e.jsxs("select",{className:"input",value:E,onChange:O=>{W(O.target.value),Y(""),M(""),z(null)},children:[e.jsx("option",{value:"",children:"Choose an item..."}),d.map(O=>e.jsx("option",{value:String(O.id),children:(O.item_code||"")+" - "+(O.item_name||"")},O.id))]})]})}),e.jsxs("div",{className:"bg-slate-50 border rounded p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"label",children:"Value to Convert"}),e.jsx("input",{type:"number",step:"0.000001",className:"input",value:R,onChange:O=>U(O.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From Unit"}),e.jsxs("select",{className:"input",value:T,onChange:O=>Y(O.target.value),children:[e.jsx("option",{value:"",children:"Select unit"}),B.map(O=>e.jsx("option",{value:O,children:O},O))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To Unit"}),e.jsxs("select",{className:"input",value:H,onChange:O=>M(O.target.value),children:[e.jsx("option",{value:"",children:"Select unit"}),G.map(O=>e.jsx("option",{value:O,children:O},O))]})]}),e.jsx("div",{children:e.jsx("button",{className:"btn-success w-full",onClick:()=>{},children:"Calculate"})})]}),e.jsx("div",{className:"mt-4",children:q!=null?e.jsxs("div",{className:"p-3 border-2 rounded text-center text-lg font-semibold",children:[R||0," ",T||""," = ",q," ",H||""]}):e.jsx("div",{className:"text-sm text-slate-500",children:"Select item and units to calculate"})})]})]})]})]}),j?e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow max-w-xl w-full",children:[e.jsxs("div",{className:"px-5 py-4 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:_==="create"?"New Conversion":"Edit Conversion"}),e.jsx("button",{className:"btn-outline",onClick:()=>N(!1),children:""})]}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Item *"}),e.jsxs("select",{className:"input",value:I.item_id,onChange:O=>w({...I,item_id:O.target.value}),children:[e.jsx("option",{value:"",children:"Select item..."}),d.map(O=>e.jsx("option",{value:String(O.id),children:(O.item_code||"")+" - "+(O.item_name||"")},O.id))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:I.is_active,onChange:O=>w({...I,is_active:O.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From UOM *"}),e.jsxs("select",{className:"input",value:I.from_uom,onChange:O=>w({...I,from_uom:O.target.value}),children:[e.jsx("option",{value:"",children:"Select unit"}),o?e.jsx("option",{children:"Loading..."}):l.map(O=>e.jsx("option",{value:O.uom_code,children:O.uom_code},O.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To UOM *"}),e.jsxs("select",{className:"input",value:I.to_uom,onChange:O=>w({...I,to_uom:O.target.value}),children:[e.jsx("option",{value:"",children:"Select unit"}),o?e.jsx("option",{children:"Loading..."}):l.map(O=>e.jsx("option",{value:O.uom_code,children:O.uom_code},O.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Factor *"}),e.jsx("input",{type:"number",step:"0.000001",className:"input",value:I.conversion_factor,onChange:O=>w({...I,conversion_factor:O.target.value})})]})]})]}),e.jsxs("div",{className:"px-5 py-4 border-t flex justify-end gap-2",children:[e.jsx("button",{className:"btn-outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx("button",{className:"btn-success",onClick:P,children:"Save"})]})]})}):null]})})}function bee(){const{canPerformAction:t}=Ls(),[s,r]=f.useState(""),[a,n]=f.useState([]),[i,l]=f.useState(!1),[o,d]=f.useState(""),[u,c]=f.useState(!1),[h,m]=f.useState(null),[p,g]=f.useState(!1),[x,b]=f.useState(""),[y,j]=f.useState(null),[N,_]=f.useState(null),[F,I]=f.useState([]),[w,E]=f.useState(!1),[W,R]=f.useState(null),[U,T]=f.useState(null);f.useEffect(()=>{let V=!0;return l(!0),d(""),Z.get("/inventory/stock-adjustments").then(P=>{var C;V&&n(Array.isArray((C=P.data)==null?void 0:C.items)?P.data.items:[])}).catch(P=>{var C,k;V&&d(((k=(C=P==null?void 0:P.response)==null?void 0:C.data)==null?void 0:k.message)||"Failed to load stock updations")}).finally(()=>{V&&l(!1)}),()=>{V=!1}},[]);const Y=V=>({DRAFT:"badge-info",PENDING_APPROVAL:"badge-warning",APPROVED:"badge-success",POSTED:"badge-success",REJECTED:"badge-error",CANCELLED:"badge-error",RETURNED:"badge-error"})[V]||"badge-info",H=f.useMemo(()=>a.filter(V=>String(V.adjustment_no||"").toLowerCase().includes(s.toLowerCase())),[a,s]),M=V=>{if(!V)return"";let P=new Date(V);return isNaN(P.getTime())&&(isNaN(Number(V))||(P=new Date(Number(V)))),isNaN(P.getTime())?String(V):P.toLocaleDateString()},q=async V=>{var P,C,k;if(m(V),c(!0),b(""),W)await z();else try{g(!0);const B=await Z.get("/workflows"),G=Array.isArray((P=B.data)==null?void 0:P.items)?B.data.items:[];R(G),await Q(G)}catch(B){b(((k=(C=B==null?void 0:B.response)==null?void 0:C.data)==null?void 0:k.message)||"Failed to load workflows")}finally{g(!1)}},z=async()=>{var k,B,G;if(!W||!W.length){j(null),_(null),b("");return}const V="/inventory/stock-adjustments",P=O=>String(O||"").trim().toUpperCase().replace(/\s+/g,"_"),C=W.find(O=>Number(O.is_active)===1&&String(O.document_route)===V)||W.find(O=>Number(O.is_active)===1&&P(O.document_type)==="STOCK_ADJUSTMENT")||null;if(j(C||null),_(null),!!C)try{g(!0);const K=(k=(await Z.get(`/workflows/${C.id}`)).data)==null?void 0:k.item,J=Array.isArray(K==null?void 0:K.steps)?K.steps:[];I(J);const te=J[0]||null;if(_(te?{userId:te.approver_user_id,name:te.approver_name,stepName:te.step_name,stepOrder:te.step_order,approvalLimit:te.approval_limit}:null),te){const se=(Array.isArray(te.approvers)&&te.approvers.length?te.approvers[0].id:te.approver_user_id)||null;T(se)}else T(null)}catch(O){b(((G=(B=O==null?void 0:O.response)==null?void 0:B.data)==null?void 0:G.message)||"Failed to load workflow details")}finally{g(!1)}},Q=async V=>{var B,G,O;if(!V||!V.length){j(null),_(null),b("");return}const P="/inventory/stock-adjustments",C=K=>String(K||"").trim().toUpperCase().replace(/\s+/g,"_"),k=V.find(K=>Number(K.is_active)===1&&String(K.document_route)===P)||V.find(K=>Number(K.is_active)===1&&C(K.document_type)==="STOCK_ADJUSTMENT")||null;if(j(k||null),_(null),!!k)try{g(!0);const J=(B=(await Z.get(`/workflows/${k.id}`)).data)==null?void 0:B.item,te=Array.isArray(J==null?void 0:J.steps)?J.steps:[];I(te);const se=te[0]||null;_(se?{userId:se.approver_user_id,name:se.approver_name,stepName:se.step_name,stepOrder:se.step_order,approvalLimit:se.approval_limit}:null)}catch(K){b(((O=(G=K==null?void 0:K.response)==null?void 0:G.data)==null?void 0:O.message)||"Failed to load workflow details")}finally{g(!1)}},L=async()=>{var V,P,C;if(h){E(!0),b("");try{const k=await Z.post(`/inventory/stock-adjustments/${h.id}/submit`,{amount:null,workflow_id:y?y.id:null,target_user_id:U||null}),B=((V=k==null?void 0:k.data)==null?void 0:V.status)||"PENDING_APPROVAL";n(G=>G.map(O=>O.id===h.id?{...O,status:B}:O)),c(!1),m(null)}catch(k){b(((C=(P=k==null?void 0:k.response)==null?void 0:P.data)==null?void 0:C.message)||"Failed to forward for approval")}finally{E(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Stock Updation"}),e.jsx("p",{className:"text-sm mt-1",children:"Update stock levels (uses Stock Adjustments)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/inventory/stock-updation/new",className:"btn-success",children:"+ New Updation"})]})]})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by document number...",className:"input max-w-md",value:s,onChange:V=>r(V.target.value)})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Document No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Items"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[i?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):o?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-red-600",children:o})}):null,H.map(V=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:V.adjustment_no}),e.jsx("td",{children:M(V.adjustment_date)}),e.jsx("td",{children:e.jsx("span",{className:`badge ${V.adjustment_type==="INCREASE"?"badge-success":"badge-warning"}`,children:V.adjustment_type})}),e.jsx("td",{children:V.item_count}),e.jsx("td",{children:e.jsx("span",{className:`badge ${Y(V.status)} `,children:V.status})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2 items-center",children:[t("inventory:stock-updation","view")&&e.jsx(Re,{to:`/inventory/stock-updation/${V.id}?mode=view`,className:"text-brand hover:text-brand-700 text-sm font-medium",children:"View"}),t("inventory:stock-updation","edit")&&e.jsx(Re,{to:`/inventory/stock-updation/${V.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Edit"}),V.status==="APPROVED"?e.jsx("span",{className:"text-sm font-medium px-2 py-1 rounded bg-green-500 text-white",children:"Approved"}):V.status==="DRAFT"||V.status==="RETURNED"?e.jsx("button",{type:"button",onClick:()=>q(V),className:"text-sm font-medium px-2 py-1 rounded bg-blue-600 text-white hover:bg-blue-700 transition-colors",children:"Forward"}):null]})})]},V.id))]})]})})]})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-erp w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-brand text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Forward for Approval"}),e.jsx("button",{onClick:()=>{c(!1),m(null),j(null),_(null),b("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Document No:"," ",e.jsx("span",{className:"font-semibold",children:h==null?void 0:h.adjustment_no})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:y?`${y.workflow_name} (${y.workflow_code})`:"None (inactive)"})]}),e.jsxs("div",{children:[p?e.jsx("div",{className:"text-sm",children:"Loading workflow..."}):null,x?e.jsx("div",{className:"text-sm text-red-600",children:x}):null]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Target Approver"}),(()=>{const P=Array.isArray(F)&&F.length>0?F[0]:null,C=P?Array.isArray(P.approvers)&&P.approvers.length?P.approvers.map(k=>({id:k.id,name:k.username})):P.approver_user_id?[{id:P.approver_user_id,name:P.approver_name||String(P.approver_user_id)}]:[]:[];return C.length>0?e.jsxs("div",{className:"mt-1",children:[e.jsxs("select",{className:"input w-full",value:U||"",onChange:k=>T(k.target.value?Number(k.target.value):null),children:[e.jsx("option",{value:"",children:"Select target approver"}),C.map(k=>e.jsx("option",{value:k.id,children:k.name},k.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:N?`Step ${N.stepOrder}  ${N.stepName}${N.approvalLimit!=null?`  Limit: ${Number(N.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:y?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})()]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{c(!1),m(null),j(null),_(null),b("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:L,disabled:w,children:w?"Forwarding...":"Forward"})]})]})})]})}function yee(){const{uoms:t,loading:s}=$i(),{id:r}=Ps(),a=ps(),n=r==="new",[i]=Vf(),l=(i.get("mode")||"").toLowerCase(),o=!n&&l==="view",[d,u]=f.useState(!1),[c,h]=f.useState(!1),[m,p]=f.useState(""),[g,x]=f.useState([]),[b,y]=f.useState([]),[j,N]=f.useState([]),[_,F]=f.useState({open:!1,itemId:null,defaultUom:"",currentUom:"",rowId:null}),I=f.useMemo(()=>{const Q=Array.isArray(t)?t:[],L=Q.find(V=>String(V.uom_code||"").toUpperCase()==="PCS")||Q[0];return L&&L.uom_code?L.uom_code:"PCS"},[t]),[w,E]=f.useState({adjustmentNo:"",adjustmentDate:new Date().toISOString().split("T")[0],warehouseId:"",adjustmentType:"PHYSICAL_COUNT",referenceDoc:"",reason:"",status:"DRAFT"}),[W,R]=f.useState([]);f.useEffect(()=>{let Q=!0;return Promise.all([Z.get("/inventory/items"),Z.get("/inventory/warehouses"),Z.get("/inventory/unit-conversions")]).then(([L,V,P])=>{var C,k,B;Q&&(x(Array.isArray((C=L.data)==null?void 0:C.items)?L.data.items:[]),y(Array.isArray((k=V.data)==null?void 0:k.items)?V.data.items:[]),N(Array.isArray((B=P.data)==null?void 0:B.items)?P.data.items:[]))}).catch(L=>{var V,P;Q&&p(((P=(V=L==null?void 0:L.response)==null?void 0:V.data)==null?void 0:P.message)||"Failed to load lookups")}),()=>{Q=!1}},[]),f.useEffect(()=>{if(n){R([{id:Date.now(),item_id:"",itemCode:"",itemName:"",currentStock:0,adjustedStock:0,uom:"",unitCost:0,remarks:""}]);return}let Q=!0;return u(!0),p(""),Z.get(`/inventory/stock-adjustments/${r}`).then(L=>{var C,k;if(!Q)return;const V=(C=L.data)==null?void 0:C.item,P=Array.isArray((k=L.data)==null?void 0:k.details)?L.data.details:[];V&&(E({adjustmentNo:V.adjustment_no||"",adjustmentDate:V.adjustment_date?new Date(V.adjustment_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],warehouseId:V.warehouse_id?String(V.warehouse_id):"",adjustmentType:V.adjustment_type||"PHYSICAL_COUNT",referenceDoc:V.reference_doc||"",reason:V.reason||"",status:V.status||"DRAFT"}),R(P.length?P.map(B=>({id:B.id||Date.now()+Math.random(),item_id:B.item_id?String(B.item_id):"",itemCode:B.item_code||"",itemName:B.item_name||"",currentStock:Number(B.current_stock)||0,adjustedStock:Number(B.adjusted_stock)||0,uom:B.uom||"",unitCost:Number(B.unit_cost)||0,remarks:B.remarks||""})):[]))}).catch(L=>{var V,P;Q&&p(((P=(V=L==null?void 0:L.response)==null?void 0:V.data)==null?void 0:P.message)||"Failed to load stock adjustment")}).finally(()=>{Q&&u(!1)}),()=>{Q=!1}},[r,n]);const U=f.useMemo(()=>W.filter(Q=>Q.item_id).map(Q=>({item_id:Number(Q.item_id),current_stock:Number(Q.currentStock)||0,adjusted_stock:Number(Q.adjustedStock)||0,qty:Number(Q.adjustedStock)-Number(Q.currentStock),unit_cost:Number(Q.unitCost)||0,remarks:Q.remarks})),[W]),T=async Q=>{var L,V;Q.preventDefault(),h(!0),p("");try{const P={adjustment_no:n?void 0:w.adjustmentNo,adjustment_date:w.adjustmentDate,warehouse_id:w.warehouseId?Number(w.warehouseId):null,adjustment_type:w.adjustmentType,reference_doc:w.referenceDoc,reason:w.reason,status:w.status,details:U};n?await Z.post("/inventory/stock-adjustments",P):await Z.put(`/inventory/stock-adjustments/${r}`,P),a("/inventory/stock-updation")}catch(P){p(((V=(L=P==null?void 0:P.response)==null?void 0:L.data)==null?void 0:V.message)||"Failed to save stock updation")}finally{h(!1)}},Y=()=>{R([...W,{id:Date.now(),item_id:"",itemCode:"",itemName:"",currentStock:0,adjustedStock:0,uom:"",unitCost:0,remarks:""}])},H=Q=>{R(W.filter(L=>L.id!==Q))},M=(Q,L,V)=>{R(W.map(P=>{if(P.id===Q){const C={...P,[L]:V};if(L==="item_id"){const k=g.find(B=>String(B.id)===String(V));C.itemCode=(k==null?void 0:k.item_code)||"",C.itemName=(k==null?void 0:k.item_name)||"",C.unitCost=(k==null?void 0:k.cost_price)||0,C.uom=(k==null?void 0:k.uom)&&String(k.uom)||String(I)}return C}return P}))},q=Q=>{E(L=>({...L,reason:Q}))},z=Q=>{const L="border-2 rounded-lg p-4 cursor-pointer transition-all text-center hover:shadow-md",V=w.adjustmentType===Q?" ring-2 ring-brand-500 bg-brand-50 border-brand-500":" border-slate-200 bg-white";return Q==="INCREASE"?`${L} ${V} ${w.adjustmentType===Q?"border-green-500 ring-green-500 bg-green-50":"hover:border-green-200"}`:Q==="DECREASE"?`${L} ${V} ${w.adjustmentType===Q?"border-red-500 ring-red-500 bg-red-50":"hover:border-red-200"}`:`${L} ${V}`};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:n?"New Stock Updation":o?"View Stock Updation":"Edit Stock Updation"}),e.jsx("p",{className:"text-sm mt-1",children:"Update stock levels"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(Re,{to:"/inventory/stock-updation",className:"btn-success bg-green-600 text-white hover:bg-green-700 px-6 py-2 rounded shadow-sm font-medium",children:" Back to List"})})]})}),e.jsx("div",{className:"card-body p-6",children:e.jsxs("form",{onSubmit:T,className:"space-y-8",children:[d&&e.jsx("div",{className:"text-sm",children:"Loading..."}),m&&e.jsx("div",{className:"p-4 bg-red-50 text-red-600 rounded-md border border-red-200",children:m}),e.jsxs("fieldset",{disabled:o,className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4 border-b pb-2",children:" Select Updation Type"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:z("PHYSICAL_COUNT"),onClick:()=>E({...w,adjustmentType:"PHYSICAL_COUNT"}),children:[e.jsx("div",{className:"text-3xl mb-2",children:""}),e.jsx("div",{className:"font-bold text-slate-700",children:"Physical Count"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Based on actual inventory count"})]}),e.jsxs("div",{className:z("INCREASE"),onClick:()=>E({...w,adjustmentType:"INCREASE"}),children:[e.jsx("div",{className:"text-3xl mb-2",children:""}),e.jsx("div",{className:"font-bold text-slate-700",children:"Stock Increase"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Add stock (found, corrections)"})]}),e.jsxs("div",{className:z("DECREASE"),onClick:()=>E({...w,adjustmentType:"DECREASE"}),children:[e.jsx("div",{className:"text-3xl mb-2",children:""}),e.jsx("div",{className:"font-bold text-slate-700",children:"Stock Decrease"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Reduce stock (damage, theft)"})]}),e.jsxs("div",{className:z("OTHER"),onClick:()=>E({...w,adjustmentType:"OTHER"}),children:[e.jsx("div",{className:"text-3xl mb-2",children:""}),e.jsx("div",{className:"font-bold text-slate-700",children:"Other Adjustment"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Miscellaneous adjustments"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4 border-b pb-2",children:" Updation Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Document No"}),e.jsx("input",{type:"text",className:"input bg-slate-100",value:w.adjustmentNo,disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",className:"input",value:w.adjustmentDate,onChange:Q=>E({...w,adjustmentDate:Q.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Warehouse"}),e.jsxs("select",{className:"input",value:w.warehouseId,onChange:Q=>E({...w,warehouseId:Q.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Warehouse --"}),b.map(Q=>e.jsx("option",{value:Q.id,children:Q.warehouse_name},Q.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Type"}),e.jsx("input",{type:"text",className:"input bg-slate-100",value:w.adjustmentType,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Reference Document"}),e.jsx("input",{type:"text",className:"input",placeholder:"e.g., PC-2024-001",value:w.referenceDoc,onChange:Q=>E({...w,referenceDoc:Q.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${w.status==="DRAFT"?"bg-slate-200 text-slate-700":"bg-green-100 text-green-700"}`,children:w.status})})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{className:"input",rows:"2",placeholder:"Provide detailed reason for this stock updation...",value:w.reason,onChange:Q=>E({...w,reason:Q.target.value}),required:!0}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:["Physical count variance","Damaged goods","Expired items","Theft/Loss","Found items","System error correction","Other"].map(Q=>e.jsx("button",{type:"button",onClick:()=>q(Q),className:`px-3 py-1 rounded-full text-xs border ${w.reason===Q?"bg-brand-500 text-white border-brand-500":"bg-white text-slate-600 border-slate-300 hover:bg-slate-50"}`,children:Q},Q))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 border-b pb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800",children:" Items"}),e.jsx("button",{type:"button",onClick:Y,className:"btn-primary text-sm px-3 py-1 rounded bg-brand-600 text-white hover:bg-brand-700",children:"+ Add Item"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-100 text-slate-700 uppercase font-bold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Item"}),e.jsx("th",{className:"p-3 w-24",children:"Current Stock"}),e.jsx("th",{className:"p-3 w-24",children:"Adjusted Stock"}),e.jsx("th",{className:"p-3 w-24",children:"Diff"}),e.jsx("th",{className:"p-3 w-20",children:"UOM"}),e.jsx("th",{className:"p-3 w-24",children:"Unit Cost"}),e.jsx("th",{className:"p-3 w-28",children:"Impact"}),e.jsx("th",{className:"p-3",children:"Remarks"}),e.jsx("th",{className:"p-3 w-16"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-200",children:[W.map(Q=>{const L=Number(Q.adjustedStock)-Number(Q.currentStock),V=L*Number(Q.unitCost);return e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"p-2",children:e.jsxs("select",{className:"input text-sm py-1",value:Q.item_id,onChange:P=>M(Q.id,"item_id",P.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Item"}),g.map(P=>e.jsxs("option",{value:P.id,children:[P.item_code," - ",P.item_name]},P.id))]})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"input text-sm py-1 bg-slate-50",value:Q.currentStock,onChange:P=>M(Q.id,"currentStock",P.target.value)})}),e.jsxs("td",{className:"p-2",children:[e.jsx("input",{type:"number",className:"input text-sm py-1 font-bold",value:Q.adjustedStock,onChange:P=>M(Q.id,"adjustedStock",P.target.value)}),(()=>{const P=g.find(O=>String(O.id)===String(Q.item_id)),C=(P==null?void 0:P.uom)&&String(P.uom)||Q.uom&&String(Q.uom)||(I?String(I):""),k=(Array.isArray(j)?j:[]).filter(O=>Number(O.is_active)&&Number(O.item_id)===Number(Q.item_id)&&String(O.to_uom)===C).map(O=>String(O.from_uom)),B=Q.uom&&String(Q.uom)!==C?String(Q.uom):k[0]||"";return k.length>0&&B&&B!==C?e.jsx("button",{type:"button",className:"ml-2 px-2 py-1 text-xs border border-brand text-brand rounded hover:bg-brand hover:text-white transition-colors",onClick:()=>F({open:!0,itemId:Q.item_id,defaultUom:C,currentUom:B,rowId:Q.id}),children:`number of ${B}`}):null})()]}),e.jsx("td",{className:"p-2 font-bold",children:e.jsxs("span",{className:L>0?"text-green-600":L<0?"text-red-600":"text-slate-400",children:[L>0?"+":"",L]})}),e.jsx("td",{className:"p-2",children:e.jsx("select",{className:"input text-sm py-1",value:Q.uom,onChange:P=>M(Q.id,"uom",P.target.value),children:s?e.jsx("option",{children:"Loading..."}):t.map(P=>e.jsx("option",{value:P.uom_code,children:P.uom_code},P.id))})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"input text-sm py-1",value:Q.unitCost,onChange:P=>M(Q.id,"unitCost",P.target.value)})}),e.jsx("td",{className:"p-2 font-medium",children:V.toFixed(2)}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"text",className:"input text-sm py-1",placeholder:"Optional",value:Q.remarks,onChange:P=>M(Q.id,"remarks",P.target.value)})}),e.jsx("td",{className:"p-2 text-center",children:e.jsx("button",{type:"button",onClick:()=>H(Q.id),className:"text-red-500 hover:text-red-700",children:""})})]},Q.id)}),W.length===0&&e.jsx("tr",{children:e.jsx("td",{colspan:"9",className:"p-8 text-center text-slate-500",children:'No items added. Click "Add Item" to begin.'})})]})]})})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200",children:[e.jsx("h4",{className:"font-bold text-slate-700 mb-2",children:" Impact Summary"}),e.jsxs("div",{className:"flex gap-8 text-sm",children:[e.jsxs("div",{children:["Total Items:"," ",e.jsx("span",{className:"font-bold text-brand-700",children:W.length})]}),e.jsxs("div",{children:["Net Qty Change:"," ",e.jsx("span",{className:"font-bold text-brand-700",children:W.reduce((Q,L)=>Q+(Number(L.adjustedStock)-Number(L.currentStock)),0)})]}),e.jsxs("div",{children:["Total Value Impact:"," ",e.jsx("span",{className:"font-bold text-brand-700",children:W.reduce((Q,L)=>Q+(Number(L.adjustedStock)-Number(L.currentStock))*Number(L.unitCost),0).toFixed(2)})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-200",children:[e.jsx(Re,{to:"/inventory/stock-updation",className:"btn-light bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded",children:"Cancel"}),o?null:e.jsx("button",{type:"submit",className:"btn-success bg-green-600 text-white hover:bg-green-700 px-6 py-2 rounded shadow-sm font-medium",children:c?"Saving...":"Save Updation"})]})]})})]}),e.jsx(Ic,{open:_.open,onClose:()=>F({open:!1,itemId:null,defaultUom:"",currentUom:"",rowId:null}),itemId:_.itemId?Number(_.itemId):null,defaultUom:String(_.defaultUom||""),currentUom:String(_.currentUom||""),conversions:j,onApply:({converted_qty:Q})=>{const L=_.rowId;L!=null&&M(L,"adjustedStock",Q)}})]})}function jee(){const{canPerformAction:t}=Ls(),[s,r]=f.useState(""),[a,n]=f.useState([]),[i,l]=f.useState([]),[o,d]=f.useState(!1),[u,c]=f.useState(""),[h,m]=f.useState("ALL");f.useEffect(()=>{let _=!0;return d(!0),Promise.all([Z.get("/inventory/stock-adjustments"),Z.get("/inventory/warehouses")]).then(([F,I])=>{var w,E;_&&(n(Array.isArray((w=F.data)==null?void 0:w.items)?F.data.items:[]),l(Array.isArray((E=I.data)==null?void 0:E.items)?I.data.items:[]))}).catch(F=>{var I,w;_&&c(((w=(I=F==null?void 0:F.response)==null?void 0:I.data)==null?void 0:w.message)||"Failed to load stock verifications")}).finally(()=>{_&&d(!1)}),()=>{_=!1}},[]);const p=_=>{const F=i.find(I=>I.id===_);return F?F.name:"Unknown Warehouse"},g=[{value:"DRAFT",label:"Draft",color:"bg-gray-100 text-gray-800"},{value:"IN_PROGRESS",label:"In Progress",color:"bg-blue-100 text-blue-800"},{value:"COMPLETED",label:"Completed",color:"bg-green-100 text-green-800"},{value:"ADJUSTED",label:"Adjusted",color:"bg-purple-100 text-purple-800"}],x=_=>{const F=g.find(I=>I.value===_);if(!F){if(_==="POSTED")return e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Posted"});if(_==="CANCELLED")return e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"Cancelled"})}return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${(F==null?void 0:F.color)||"bg-gray-100 text-gray-800"}`,children:(F==null?void 0:F.label)||_})},b=[{value:"PHYSICAL_COUNT",label:"Physical Count"},{value:"CYCLE_COUNT",label:"Cycle Count"},{value:"SPOT_CHECK",label:"Spot Check"}],y=_=>{var F;return((F=b.find(I=>I.value===_))==null?void 0:F.label)||_},j=f.useMemo(()=>a.filter(_=>{const F=String(_.adjustment_no||"").toLowerCase().includes(s.toLowerCase())||!1,I=h==="ALL"||_.status===h;return F&&I}),[a,s,h]),N={total:a.length,inProgress:a.filter(_=>_.status==="IN_PROGRESS"||_.status==="DRAFT").length,completed:a.filter(_=>_.status==="COMPLETED"||_.status==="POSTED").length,variance:0};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Stock Verification"}),e.jsx("p",{className:"text-gray-600",children:"Manage and track warehouse stock verification activities"})]}),e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Verifications"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:N.total})]}),e.jsx(Pj,{className:"w-10 h-10 text-blue-500"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"In Progress"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:N.inProgress})]}),e.jsx(Au,{className:"w-10 h-10 text-blue-500"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:N.completed})]}),e.jsx(bL,{className:"w-10 h-10 text-green-500"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Variance"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:["$",N.variance.toFixed(2)]})]}),e.jsx(jL,{className:"w-10 h-10 text-orange-500"})]})})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsx("div",{className:"flex-1 w-full md:w-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx(Jf,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search by verification number...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:s,onChange:_=>r(_.target.value)})]})}),e.jsxs("div",{className:"flex gap-3 w-full md:w-auto",children:[e.jsxs("select",{className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:h,onChange:_=>m(_.target.value),children:[e.jsx("option",{value:"ALL",children:"All Status"}),g.map(_=>e.jsx("option",{value:_.value,children:_.label},_.value))]}),e.jsxs(Re,{to:"/inventory/stock-verification/new",className:"flex items-center gap-2 px-4 py-2 text-white rounded-lg hover:opacity-90 transition-opacity",style:{backgroundColor:"#0E3646"},children:[e.jsx(Ec,{className:"w-5 h-5"}),"New Verification"]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{style:{backgroundColor:"#0E3646"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Verification #"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Warehouse"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Variance"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-4 text-center text-gray-500",children:"Loading..."})}):j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-4 text-center text-gray-500",children:"No verifications found"})}):j.map(_=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:_.adjustment_no})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"date",value:(()=>{const F=_.adjustment_date,I=new Date(F);if(!isNaN(I))return I.toISOString().split("T")[0];const w=String(F||"");return w.includes("T")?w.split("T")[0]:w})(),readOnly:!0,className:"text-sm text-gray-900 bg-transparent border-0 p-0"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:p(_.warehouse_id)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:y(_.adjustment_type)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:x(_.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-600",children:"N/A"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex gap-2",children:[t("inventory:stock-verification","view")&&e.jsx(Re,{to:`/inventory/stock-verification/${_.id}?mode=view`,className:"text-blue-600 hover:text-blue-900",title:"View Details",children:"View"}),t("inventory:stock-verification","edit")&&e.jsx(Re,{to:`/inventory/stock-verification/${_.id}?mode=edit`,className:"text-green-600 hover:text-green-900",title:"Edit",children:"Edit"})]})})]},_.id))})]})})})]})})}function Nee(){const{id:t}=Ps(),s=ps(),r=t==="new",[a,n]=f.useState(!1),[i,l]=f.useState(!1),[o,d]=f.useState(""),[u,c]=f.useState([]),[h,m]=f.useState([]),{uoms:p}=$i(),[g,x]=f.useState([]),[b,y]=f.useState({open:!1,itemId:null,defaultUom:"",currentUom:"",rowId:null}),j=f.useMemo(()=>{const H=Array.isArray(p)?p:[],M=H.find(q=>String(q.uom_code||"").toUpperCase()==="PCS")||H[0];return M&&M.uom_code?M.uom_code:"PCS"},[p]),[N,_]=f.useState({verification_number:"",verification_date:new Date().toISOString().split("T")[0],warehouse_id:"",verification_type:"PHYSICAL_COUNT",start_date:new Date().toISOString().split("T")[0],end_date:"",status:"DRAFT",remarks:""}),[F,I]=f.useState([]),w=[{value:"PHYSICAL_COUNT",label:"Physical Count"},{value:"CYCLE_COUNT",label:"Cycle Count"},{value:"SPOT_CHECK",label:"Spot Check"}],E=[{value:"DRAFT",label:"Draft"},{value:"IN_PROGRESS",label:"In Progress"},{value:"COMPLETED",label:"Completed"},{value:"ADJUSTED",label:"Adjusted"}];f.useEffect(()=>{let H=!0;return(async()=>{var q,z,Q;try{const[L,V,P]=await Promise.all([Z.get("/inventory/items"),Z.get("/inventory/warehouses"),Z.get("/inventory/unit-conversions")]);H&&(c(Array.isArray((q=L.data)==null?void 0:q.items)?L.data.items:[]),m(Array.isArray((z=V.data)==null?void 0:z.items)?V.data.items:[]),x(Array.isArray((Q=P.data)==null?void 0:Q.items)?P.data.items:[]))}catch{H&&d("Failed to load initial data")}})(),()=>{H=!1}},[]),f.useEffect(()=>{if(r)return;let H=!0;return n(!0),Z.get(`/inventory/stock-adjustments/${t}`).then(M=>{var Q,L;if(!H)return;const q=(Q=M.data)==null?void 0:Q.item,z=Array.isArray((L=M.data)==null?void 0:L.details)?M.data.details:[];q&&(_({verification_number:q.adjustment_no,verification_date:q.adjustment_date?q.adjustment_date.split("T")[0]:"",warehouse_id:q.warehouse_id||"",verification_type:q.adjustment_type||"PHYSICAL_COUNT",start_date:new Date().toISOString().split("T")[0],end_date:"",status:q.status||"DRAFT",remarks:q.reason||""}),I(z.map(V=>({id:V.id||Date.now()+Math.random(),item_id:V.item_id,qty:Number(V.qty)||0,uom:""}))))}).catch(M=>{var q,z;H&&d(((z=(q=M==null?void 0:M.response)==null?void 0:q.data)==null?void 0:z.message)||"Failed to load verification")}).finally(()=>{H&&n(!1)}),()=>{H=!1}},[t,r]);const W=H=>{const{name:M,value:q}=H.target;_(z=>({...z,[M]:q}))},R=()=>{I([...F,{id:Date.now(),item_id:"",qty:0,uom:"PCS"}])},U=H=>{I(F.filter(M=>M.id!==H))},T=(H,M,q)=>{I(F.map(z=>{if(z.id===H){const Q={...z,[M]:q};if(M==="item_id"){const L=u.find(V=>String(V.id)===String(q));L&&(Q.uom=L.uom||"")}return Q}return z}))},Y=async H=>{var M,q;if(H.preventDefault(),!N.warehouse_id||!N.verification_date){alert("Please fill in all required fields");return}l(!0),d("");try{const z={adjustment_no:r?void 0:N.verification_number,adjustment_date:N.verification_date,warehouse_id:Number(N.warehouse_id),adjustment_type:N.verification_type,start_date:N.start_date||null,end_date:N.end_date||null,status:N.status,reason:N.remarks,details:F.filter(Q=>Q.item_id).map(Q=>({item_id:Number(Q.item_id),qty:Number(Q.qty)}))};r?await Z.post("/inventory/stock-adjustments",z):await Z.put(`/inventory/stock-adjustments/${t}`,z),s("/inventory/stock-verification")}catch(z){d(((q=(M=z==null?void 0:z.response)==null?void 0:M.data)==null?void 0:q.message)||"Failed to save verification")}finally{l(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Re,{to:"/inventory/stock-verification",className:"p-2 bg-white rounded-full shadow-sm hover:bg-gray-100 transition-colors",children:e.jsx(Xf,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:r?"New Stock Verification":"Edit Stock Verification"}),e.jsx("p",{className:"text-sm text-gray-600",children:r?"Create a new stock verification record":`Editing ${N.verification_number}`})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Re,{to:"/inventory/stock-verification",className:"px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:Y,disabled:i,className:"flex items-center gap-2 px-4 py-2 text-white rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50",style:{backgroundColor:"#0E3646"},children:[e.jsx(sA,{className:"w-5 h-5"}),i?"Saving...":"Save Verification"]})]})]}),o&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:o}),a?e.jsx("div",{className:"text-center py-12",children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4 pb-2 border-b",children:"Verification Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Verification Number"}),e.jsx("input",{type:"text",name:"verification_number",value:N.verification_number,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Verification Date *"}),e.jsx("input",{type:"date",name:"verification_date",value:N.verification_date,onChange:W,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Warehouse *"}),e.jsxs("select",{name:"warehouse_id",value:N.warehouse_id,onChange:W,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Select Warehouse"}),h.map(H=>e.jsx("option",{value:H.id,children:H.warehouse_name},H.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Verification Type *"}),e.jsx("select",{name:"verification_type",value:N.verification_type,onChange:W,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:w.map(H=>e.jsx("option",{value:H.value,children:H.label},H.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",name:"start_date",value:N.start_date,onChange:W,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",name:"end_date",value:N.end_date,onChange:W,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status *"}),e.jsx("select",{name:"status",value:N.status,onChange:W,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:E.map(H=>e.jsx("option",{value:H.value,children:H.label},H.value))})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Remarks"}),e.jsx("textarea",{name:"remarks",value:N.remarks,onChange:W,rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter any additional remarks..."})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center bg-gray-50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Items"}),e.jsxs("button",{onClick:R,className:"flex items-center gap-2 px-3 py-1.5 text-white text-sm font-medium rounded-md hover:opacity-90 transition-opacity",style:{backgroundColor:"#0E3646"},children:[e.jsx(Ec,{className:"w-4 h-4"}),"Add Item"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-48",children:"Variance Qty"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32",children:"UOM"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"Action"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:F.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"px-6 py-8 text-center text-gray-500",children:'No items added yet. Click "Add Item" to start.'})}):F.map(H=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("select",{value:H.item_id,onChange:M=>T(H.id,"item_id",M.target.value),className:"w-1/2 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select Item"}),u.map(M=>e.jsxs("option",{value:M.id,children:[M.item_code," - ",M.item_name]},M.id))]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"number",value:H.qty,onChange:M=>T(H.id,"qty",parseFloat(M.target.value)||0),className:`${(()=>{const M=u.find(V=>String(V.id)===String(H.item_id)),q=(M==null?void 0:M.uom)&&String(M.uom)||H.uom&&String(H.uom)||(j?String(j):""),z=(Array.isArray(g)?g:[]).filter(V=>Number(V.is_active)&&Number(V.item_id)===Number(H.item_id)&&String(V.to_uom)===q).map(V=>String(V.from_uom)),Q=z[0]||"";return z.length>0&&Q&&Q!==q?"w-3/4":"w-full"})()} px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent`,step:"1"}),(()=>{const M=u.find(V=>String(V.id)===String(H.item_id)),q=(M==null?void 0:M.uom)&&String(M.uom)||H.uom&&String(H.uom)||(j?String(j):""),z=(Array.isArray(g)?g:[]).filter(V=>Number(V.is_active)&&Number(V.item_id)===Number(H.item_id)&&String(V.to_uom)===q).map(V=>String(V.from_uom)),Q=z[0]||"";return z.length>0&&Q&&Q!==q?e.jsx("button",{type:"button",className:"px-2 py-1 text-xs border border-brand text-brand rounded hover:bg-brand hover:text-white transition-colors",onClick:()=>y({open:!0,itemId:H.item_id,defaultUom:q,currentUom:Q,rowId:H.id}),children:`number of ${Q}`}):null})()]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("input",{type:"text",value:H.uom||(()=>{const M=u.find(q=>String(q.id)===String(H.item_id));return(M==null?void 0:M.uom)&&String(M.uom)||String(j)})(),readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500"})})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>U(H.id),className:"text-red-600 hover:text-red-900 p-2 hover:bg-red-50 rounded-full transition-colors",children:e.jsx(ol,{className:"w-5 h-5"})})})]},H.id))})]})})]})]})]}),e.jsx(Ic,{open:b.open,onClose:()=>y({open:!1,itemId:null,defaultUom:"",currentUom:"",rowId:null}),itemId:b.itemId?Number(b.itemId):null,defaultUom:String(b.defaultUom||""),currentUom:String(b.currentUom||""),conversions:g,onApply:({converted_qty:H})=>{const M=b.rowId;M!=null&&T(M,"qty",H)}})]})}function wee(){const[t,s]=f.useState(""),[r,a]=f.useState(!1),[n,i]=f.useState(""),[l,o]=f.useState([]),[d,u]=f.useState(!1),[c,h]=f.useState(null),[m,p]=f.useState(!1),[g,x]=f.useState(""),[b,y]=f.useState(null),[j,N]=f.useState(null),[_,F]=f.useState([]),[I,w]=f.useState(!1),[E,W]=f.useState(null),[R,U]=f.useState(null);f.useEffect(()=>{let L=!0;return a(!0),i(""),Z.get("/inventory/return-to-stores").then(V=>{var P;L&&o(Array.isArray((P=V.data)==null?void 0:P.items)?V.data.items:[])}).catch(V=>{var P,C;L&&i(((C=(P=V==null?void 0:V.response)==null?void 0:P.data)==null?void 0:C.message)||"Failed to load return to stores")}).finally(()=>{L&&a(!1)}),()=>{L=!1}},[]);const T=L=>({DRAFT:"bg-slate-100 text-slate-700",PENDING:"bg-yellow-100 text-yellow-800",PENDING_APPROVAL:"bg-yellow-100 text-yellow-800",SUBMITTED:"bg-yellow-100 text-yellow-800",APPROVED:"bg-green-100 text-green-800",POSTED:"bg-blue-100 text-blue-800",REJECTED:"bg-red-100 text-red-800"})[L]||"bg-slate-100 text-slate-700",Y=f.useMemo(()=>{const L=l.length,V=l.filter(k=>k.status==="PENDING").length,P=l.filter(k=>k.status==="APPROVED"||k.status==="POSTED").length,C=l.filter(k=>k.status==="REJECTED").length;return{total:L,pending:V,approved:P,rejected:C}},[l]),H=f.useMemo(()=>{const L=t.toLowerCase();return l.filter(V=>{const P=String(V.rts_no||"").toLowerCase(),C=String(V.warehouse_name||"").toLowerCase();return P.includes(L)||C.includes(L)})},[l,t]),M=async L=>{var V,P,C;if(h(L),u(!0),x(""),E)await q();else try{p(!0);const k=await Z.get("/workflows"),B=Array.isArray((V=k.data)==null?void 0:V.items)?k.data.items:[];W(B),await z(B)}catch(k){x(((C=(P=k==null?void 0:k.response)==null?void 0:P.data)==null?void 0:C.message)||"Failed to load workflows")}finally{p(!1)}},q=async()=>{var C,k,B;if(!E||!E.length){y(null),N(null),x("");return}const L="/inventory/return-to-stores",V=G=>String(G||"").trim().toUpperCase().replace(/\s+/g,"_"),P=E.find(G=>Number(G.is_active)===1&&String(G.document_route)===L)||E.find(G=>Number(G.is_active)===1&&V(G.document_type)==="RETURN_TO_STORES")||null;if(y(P||null),N(null),!!P)try{p(!0);const O=(C=(await Z.get(`/workflows/${P.id}`)).data)==null?void 0:C.item,K=Array.isArray(O==null?void 0:O.steps)?O.steps:[];F(K);const J=K[0]||null;if(N(J?{userId:J.approver_user_id,name:J.approver_name,stepName:J.step_name,stepOrder:J.step_order,approvalLimit:J.approval_limit}:null),J){const te=(Array.isArray(J.approvers)&&J.approvers.length?J.approvers[0].id:J.approver_user_id)||null;U(te)}else U(null)}catch(G){x(((B=(k=G==null?void 0:G.response)==null?void 0:k.data)==null?void 0:B.message)||"Failed to load workflow details")}finally{p(!1)}},z=async L=>{var k,B,G;if(!L||!L.length){y(null),N(null),x("");return}const V="/inventory/return-to-stores",P=O=>String(O||"").trim().toUpperCase().replace(/\s+/g,"_"),C=L.find(O=>Number(O.is_active)===1&&String(O.document_route)===V)||L.find(O=>Number(O.is_active)===1&&P(O.document_type)==="RETURN_TO_STORES")||null;if(y(C||null),N(null),!!C)try{p(!0);const K=(k=(await Z.get(`/workflows/${C.id}`)).data)==null?void 0:k.item,J=Array.isArray(K==null?void 0:K.steps)?K.steps:[];F(J);const te=J[0]||null;N(te?{userId:te.approver_user_id,name:te.approver_name,stepName:te.step_name,stepOrder:te.step_order,approvalLimit:te.approval_limit}:null)}catch(O){x(((G=(B=O==null?void 0:O.response)==null?void 0:B.data)==null?void 0:G.message)||"Failed to load workflow details")}finally{p(!1)}},Q=async()=>{var L,V,P;if(c){w(!0),x("");try{const C=await Z.post(`/inventory/return-to-stores/${c.id}/submit`,{amount:null,workflow_id:b?b.id:null,target_user_id:R||null}),k=((L=C==null?void 0:C.data)==null?void 0:L.status)||"PENDING_APPROVAL";o(B=>B.map(G=>G.id===c.id?{...G,status:k}:G)),u(!1),h(null)}catch(C){x(((P=(V=C==null?void 0:C.response)==null?void 0:V.data)==null?void 0:P.message)||"Failed to forward for approval")}finally{w(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"card p-4 flex items-center justify-between bg-white dark:bg-slate-800",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 font-medium",children:"Total Returns"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white mt-1",children:Y.total})]}),e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})]}),e.jsxs("div",{className:"card p-4 flex items-center justify-between bg-white dark:bg-slate-800",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 font-medium",children:"Pending Approval"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400 mt-1",children:Y.pending})]}),e.jsx("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg",children:e.jsx("svg",{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),e.jsxs("div",{className:"card p-4 flex items-center justify-between bg-white dark:bg-slate-800",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 font-medium",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400 mt-1",children:Y.approved})]}),e.jsx("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:e.jsx("svg",{className:"w-6 h-6 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),e.jsxs("div",{className:"card p-4 flex items-center justify-between bg-white dark:bg-slate-800",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 font-medium",children:"Rejected"}),e.jsx("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400 mt-1",children:Y.rejected})]}),e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg",children:e.jsx("svg",{className:"w-6 h-6 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx("span",{children:""})," Return to Stores"]}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Manage material returns and approvals"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"}),e.jsxs(Re,{to:"/inventory/return-to-stores/new",className:"btn btn-primary bg-[#2E7D9F] hover:bg-[#24637e] text-white px-4 py-2 rounded-lg flex items-center gap-2",children:[e.jsx("span",{children:"+"})," New Return"]})]})]})}),e.jsxs("div",{className:"card-body p-0",children:[r?e.jsxs("div",{className:"p-8 text-center text-slate-500",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-[#2E7D9F] border-t-transparent rounded-full mx-auto mb-4"}),"Loading returns..."]}):null,n?e.jsxs("div",{className:"p-4 m-4 bg-red-50 text-red-600 rounded-lg border border-red-100 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),n]}):null,e.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx("input",{type:"text",placeholder:"Search by advice number or warehouse...",className:"w-full pl-10 pr-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2E7D9F] focus:border-transparent dark:bg-slate-700 dark:text-white",value:t,onChange:L=>s(L.target.value)}),e.jsx("svg",{className:"w-5 h-5 text-slate-400 absolute left-3 top-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 text-xs uppercase font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Advice No"}),e.jsx("th",{className:"px-6 py-4",children:"Date"}),e.jsx("th",{className:"px-6 py-4",children:"Type"}),e.jsx("th",{className:"px-6 py-4",children:"Department"}),e.jsx("th",{className:"px-6 py-4",children:"Warehouse"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Items"}),e.jsx("th",{className:"px-6 py-4",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:[H.map(L=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-[#2E7D9F] dark:text-[#5fb8e3]",children:e.jsx(Re,{to:`/inventory/return-to-stores/${L.id}`,children:L.rts_no})}),e.jsx("td",{className:"px-6 py-4 text-slate-600 dark:text-slate-300",children:L.rts_date}),e.jsx("td",{className:"px-6 py-4 text-slate-600 dark:text-slate-300",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-100 text-slate-800",children:L.return_type||"-"})}),e.jsx("td",{className:"px-6 py-4 text-slate-600 dark:text-slate-300",children:L.department_name||"-"}),e.jsx("td",{className:"px-6 py-4 text-slate-600 dark:text-slate-300",children:L.warehouse_name||"-"}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs font-bold",children:L.item_count})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${T(L.status)}`,children:L.status})}),e.jsxs("td",{className:"px-6 py-4 text-right",children:[e.jsx(Re,{to:`/inventory/return-to-stores/${L.id}`,className:"text-slate-400 hover:text-[#2E7D9F] transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),L.status==="APPROVED"?e.jsx("span",{className:"ml-3 text-sm font-medium px-2 py-1 rounded bg-green-500 text-white",children:"Approved"}):e.jsx("button",{type:"button",onClick:()=>M(L),className:"ml-3 text-sm font-medium px-2 py-1 rounded bg-[#2E7D9F] text-white hover:bg-[#24637e] transition-colors",disabled:I||L.status==="POSTED"||L.status==="REJECTED"||L.status==="PENDING_APPROVAL"||L.status==="SUBMITTED",children:I?"Forwarding...":"Forward for Approval"})]})]},L.id)),H.length===0&&!r&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-12 text-center text-slate-400",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("svg",{className:"w-12 h-12 text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{children:"No return records found"})]})})})]})]})})]})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-erp w/full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-brand text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Forward for Approval"}),e.jsx("button",{onClick:()=>{u(!1),h(null),y(null),N(null),x("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Return Advice:"," ",e.jsx("span",{className:"font-semibold",children:c==null?void 0:c.rts_no})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:b?`${b.workflow_name} (${b.workflow_code})`:"None (inactive)"})]}),e.jsxs("div",{children:[m?e.jsx("div",{className:"text-sm",children:"Loading workflow..."}):null,g?e.jsx("div",{className:"text-sm text-red-600",children:g}):null]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Target Approver"}),(()=>{const V=Array.isArray(_)&&_.length>0?_[0]:null,P=V?Array.isArray(V.approvers)&&V.approvers.length?V.approvers.map(C=>({id:C.id,name:C.username})):V.approver_user_id?[{id:V.approver_user_id,name:V.approver_name||String(V.approver_user_id)}]:[]:[];return P.length>0?e.jsxs("div",{className:"mt-1",children:[e.jsxs("select",{className:"input w-full",value:R||"",onChange:C=>U(C.target.value?Number(C.target.value):null),children:[e.jsx("option",{value:"",children:"Select target approver"}),P.map(C=>e.jsx("option",{value:C.id,children:C.name},C.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:j?`Step ${j.stepOrder}  ${j.stepName}${j.approvalLimit!=null?`  Limit: ${Number(j.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:b?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})()]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{u(!1),h(null),y(null),N(null),x("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:Q,disabled:I,children:I?"Forwarding...":"Forward"})]})]})})]})}function cC(){const{id:t}=Ps(),s=ps(),r=!t||t==="new",[a,n]=f.useState(!1),[i,l]=f.useState(!1),[o,d]=f.useState(""),[u,c]=f.useState([]),[h,m]=f.useState([]),[p,g]=f.useState([]),[x,b]=f.useState([]),[y,j]=f.useState({rtsNo:r?"Auto-generated":"RT-000000",rtsDate:new Date().toISOString().split("T")[0],warehouseId:"",departmentId:"",returnType:"EXCESS",requisitionId:"",status:"DRAFT",remarks:""}),[N,_]=f.useState([{id:1,item_id:"",itemCode:"",itemName:"",uom:"",qtyReturned:0,reason:"",condition:"GOOD",batchSerial:"",location:"",remarks:""}]),[F,I]=f.useState(null);f.useEffect(()=>{let Q=!0;return(async()=>{var V,P,C,k,B,G;try{const[O,K,J,te]=await Promise.all([Z.get("/inventory/items"),Z.get("/inventory/warehouses"),Z.get("/admin/departments"),r?Z.get("/inventory/return-to-stores/next-no"):Promise.resolve({data:null})]);Q&&(c(Array.isArray((V=O.data)==null?void 0:V.items)?O.data.items:[]),m(Array.isArray((P=K.data)==null?void 0:P.items)?K.data.items:[]),g(Array.isArray((C=J.data)==null?void 0:C.items)?J.data.items:[]),r&&((k=te==null?void 0:te.data)!=null&&k.next_no)&&j(se=>({...se,rtsNo:te.data.next_no})))}catch(O){Q&&d(((G=(B=O==null?void 0:O.response)==null?void 0:B.data)==null?void 0:G.message)||"Failed to load initial data")}})(),()=>{Q=!1}},[]),f.useEffect(()=>{if(r)return;let Q=!0;return n(!0),d(""),Z.get(`/inventory/return-to-stores/${t}`).then(L=>{var C,k;if(!Q)return;const V=(C=L.data)==null?void 0:C.item,P=Array.isArray((k=L.data)==null?void 0:k.details)?L.data.details:[];V&&(j({rtsNo:V.rts_no||"",rtsDate:V.rts_date||new Date().toISOString().split("T")[0],warehouseId:V.warehouse_id?String(V.warehouse_id):"",departmentId:V.department_id?String(V.department_id):"",returnType:V.return_type||"EXCESS",requisitionId:V.requisition_id?String(V.requisition_id):"",status:V.status||"DRAFT",remarks:V.remarks||""}),V.requisition_id&&Z.get(`/inventory/material-requisitions/${V.requisition_id}`).then(B=>{var G;Q&&((G=B.data)!=null&&G.item)&&I(B.data.item)}).catch(()=>{}),_(P.length?P.map(B=>({id:B.id||Date.now()+Math.random(),item_id:B.item_id?String(B.item_id):"",itemCode:B.item_code||"",itemName:B.item_name||"",uom:B.uom||"PCS",qtyReturned:Number(B.qty_returned)||0,reason:B.reason||"",condition:B.condition||"GOOD",batchSerial:B.batch_serial||"",location:B.location||"",remarks:B.remarks||""})):[]),P.length===0&&W())}).catch(L=>{var V,P;Q&&d(((P=(V=L==null?void 0:L.response)==null?void 0:V.data)==null?void 0:P.message)||"Failed to load return to stores")}).finally(()=>{Q&&n(!1)}),()=>{Q=!1}},[t,r]);const w=f.useMemo(()=>N.filter(Q=>Q.item_id).map(Q=>({item_id:Number(Q.item_id),qty_returned:Number(Q.qtyReturned)||0,reason:Q.reason||null,condition:Q.condition||null,batch_serial:Q.batchSerial||null,location:Q.location||null,remarks:Q.remarks||null})),[N]),E=f.useMemo(()=>{const Q=N.filter(C=>C.item_id).length,L=N.reduce((C,k)=>C+(Number(k.qtyReturned)||0),0),V=N.filter(C=>C.condition==="GOOD").reduce((C,k)=>C+(Number(k.qtyReturned)||0),0),P=N.filter(C=>C.condition==="DAMAGED").reduce((C,k)=>C+(Number(k.qtyReturned)||0),0);return{totalItems:Q,totalQty:L,goodCondition:V,damagedQty:P}},[N]),W=()=>{_([...N,{id:Date.now(),item_id:"",itemCode:"",itemName:"",uom:"",qtyReturned:0,reason:"",condition:"GOOD",batchSerial:"",location:"",remarks:""}])},R=Q=>{_(N.filter(L=>L.id!==Q))},U=(Q,L)=>{const V=u.find(P=>String(P.id)===String(L));_(N.map(P=>P.id!==Q?P:{...P,item_id:L,itemCode:(V==null?void 0:V.item_code)||"",itemName:(V==null?void 0:V.item_name)||"",uom:(V==null?void 0:V.uom)||"PCS"}))},T=(Q,L,V)=>{_(N.map(P=>P.id!==Q?P:{...P,[L]:V}))},Y=async()=>{var Q;try{const L=await Z.get("/inventory/material-requisitions");(Q=L.data)!=null&&Q.items&&b(L.data.items)}catch(L){console.error(L)}};f.useEffect(()=>{y.returnType==="UNUSED"&&Y()},[y.returnType]);const H=Q=>{j({...y,requisitionId:Q});const L=x.find(V=>String(V.id)===String(Q));I(L||null),Q&&Z.get(`/inventory/material-requisitions/${Q}`).then(V=>{var k,B;const P=(k=V.data)==null?void 0:k.item,C=Array.isArray((B=V.data)==null?void 0:B.details)?V.data.details:[];if(P&&j(G=>({...G,returnType:"UNUSED",warehouseId:P.warehouse_id?String(P.warehouse_id):G.warehouseId,departmentId:P.department_id?String(P.department_id):G.departmentId,requisitionId:String(Q),remarks:G.remarks||""})),C.length){const G=C.filter(O=>O.item_id).map(O=>{const K=u.find(J=>String(J.id)===String(O.item_id));return{id:O.id||Date.now()+Math.random(),item_id:O.item_id?String(O.item_id):"",itemCode:O.item_code||"",itemName:O.item_name||"",uom:O.uom||(K==null?void 0:K.uom)||"PCS",qtyReturned:Number(O.qty_issued)||0,reason:"UNUSED",condition:"GOOD",batchSerial:"",location:"",remarks:""}});_(G.length?G:N)}}).catch(()=>{})},M=()=>{j({...y,requisitionId:""}),I(null)},q=async Q=>{var L,V;Q.preventDefault(),l(!0),d("");try{const P={rts_no:r?void 0:y.rtsNo,rts_date:y.rtsDate,warehouse_id:y.warehouseId?Number(y.warehouseId):null,department_id:y.departmentId?Number(y.departmentId):null,return_type:y.returnType,requisition_id:y.requisitionId?Number(y.requisitionId):null,status:y.status,remarks:y.remarks||null,details:w};r?await Z.post("/inventory/return-to-stores",P):await Z.put(`/inventory/return-to-stores/${t}`,P),s("/inventory/return-to-stores")}catch(P){d(((V=(L=P==null?void 0:P.response)==null?void 0:L.data)==null?void 0:V.message)||"Failed to save return to stores")}finally{l(!1)}},z=[{id:"EXCESS",icon:"",title:"Excess Material"},{id:"UNUSED",icon:"",title:"Unused"},{id:"DAMAGED",icon:"",title:"Damaged"},{id:"WRONG_ITEM",icon:"",title:"Wrong Item"},{id:"QUALITY_ISSUE",icon:"",title:"Quality Issue"}];return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"New Return to Stores Advice":"Edit Return to Stores Advice"}),e.jsx("p",{className:"text-sm mt-1",children:"Record materials being returned to stores"})]}),e.jsx(Re,{to:"/inventory/return-to-stores",className:"btn-success",children:"Back to List"})]})}),e.jsx("div",{className:"card-body p-6",children:e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[a?e.jsx("div",{className:"text-sm",children:"Loading..."}):null,o?e.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded",children:o}):null,e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-500 uppercase mb-3",children:"Return Reason"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:z.map(Q=>e.jsxs("div",{onClick:()=>j({...y,returnType:Q.id}),className:`cursor-pointer border rounded-lg p-4 text-center transition-all ${y.returnType===Q.id?"bg-blue-50 border-blue-500 ring-2 ring-blue-200":"bg-white hover:bg-slate-50 border-slate-200"}`,children:[e.jsx("div",{className:"text-2xl mb-2",children:Q.icon}),e.jsx("div",{className:"text-sm font-medium",children:Q.title})]},Q.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-500 uppercase mb-3",children:"Return Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Return Number"}),e.jsx("input",{type:"text",className:"input bg-slate-100 dark:bg-slate-700",value:y.rtsNo,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Return Date *"}),e.jsx("input",{type:"date",className:"input",value:y.rtsDate,onChange:Q=>j({...y,rtsDate:Q.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${y.status==="DRAFT"?"bg-slate-100 text-slate-800":y.status==="PENDING"?"bg-yellow-100 text-yellow-800":y.status==="APPROVED"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:y.status})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Department"}),e.jsxs("select",{className:"input",value:y.departmentId,onChange:Q=>j({...y,departmentId:Q.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Department --"}),p.map(Q=>e.jsx("option",{value:Q.id,children:Q.name},Q.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Warehouse"}),e.jsxs("select",{className:"input",value:y.warehouseId,onChange:Q=>j({...y,warehouseId:Q.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Warehouse --"}),h.map(Q=>e.jsx("option",{value:Q.id,children:Q.warehouse_name},Q.id))]})]}),y.returnType==="UNUSED"&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Reference Requisition"}),e.jsxs("select",{className:"input",value:y.requisitionId,onChange:Q=>H(Q.target.value),children:[e.jsx("option",{value:"",children:"-- Select Requisition --"}),x.map(Q=>e.jsxs("option",{value:Q.id,children:[Q.requisition_no," - ",Q.department_name]},Q.id))]})]})]})]}),y.returnType==="UNUSED"&&F&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"text-blue-600 dark:text-blue-400 font-semibold flex items-center",children:" Requisition Reference"}),e.jsx("button",{type:"button",onClick:M,className:"text-xs bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 px-2 py-1 rounded hover:bg-slate-50",children:"Clear"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Requisition No"}),e.jsx("div",{className:"font-medium",children:F.requisition_no})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Department"}),e.jsx("div",{className:"font-medium",children:F.department_name||"--"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Issued Date"}),e.jsx("div",{className:"font-medium",children:F.requisition_date})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Type"}),e.jsx("div",{className:"font-medium",children:F.requisition_type})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:" Return Items"}),e.jsx("button",{type:"button",onClick:W,className:"btn-primary text-sm",children:" Add Item"})]}),e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800 text-slate-500 uppercase font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 w-10",children:"#"}),e.jsx("th",{className:"px-4 py-3 w-64",children:"Item"}),e.jsx("th",{className:"px-4 py-3 w-32",children:"Return Qty"}),e.jsx("th",{className:"px-4 py-3 w-24",children:"UOM"}),e.jsx("th",{className:"px-4 py-3 w-32",children:"Condition"}),e.jsx("th",{className:"px-4 py-3 w-32",children:"Batch/Serial"}),e.jsx("th",{className:"px-4 py-3 w-32",children:"Location"}),e.jsx("th",{className:"px-4 py-3",children:"Remarks"}),e.jsx("th",{className:"px-4 py-3 w-16"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-slate-900",children:N.map((Q,L)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 text-center text-slate-500",children:L+1}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("select",{className:"input text-sm py-1",value:Q.item_id,onChange:V=>U(Q.id,V.target.value),children:[e.jsx("option",{value:"",children:"Select Item"}),u.map(V=>e.jsxs("option",{value:V.id,children:[V.item_code," - ",V.item_name]},V.id))]})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",className:"input text-sm py-1",value:Q.qtyReturned,onChange:V=>T(Q.id,"qtyReturned",V.target.value),min:"0"})}),e.jsx("td",{className:"px-4 py-2 text-slate-500",children:Q.uom}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("select",{className:"input text-sm py-1",value:Q.condition,onChange:V=>T(Q.id,"condition",V.target.value),children:[e.jsx("option",{value:"GOOD",children:"Good"}),e.jsx("option",{value:"DAMAGED",children:"Damaged"})]})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"text",className:"input text-sm py-1",value:Q.batchSerial,onChange:V=>T(Q.id,"batchSerial",V.target.value),placeholder:"Optional"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"text",className:"input text-sm py-1",value:Q.location,onChange:V=>T(Q.id,"location",V.target.value),placeholder:"Optional"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"text",className:"input text-sm py-1",value:Q.remarks,onChange:V=>T(Q.id,"remarks",V.target.value),placeholder:"Optional"})}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("button",{type:"button",onClick:()=>R(Q.id),className:"text-red-500 hover:text-red-700",children:""})})]},Q.id))})]})})]}),e.jsx("div",{className:"bg-slate-50 dark:bg-slate-800 rounded-lg p-6 mt-6",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-500 uppercase mb-1",children:"Total Items"}),e.jsx("div",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:E.totalItems})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-500 uppercase mb-1",children:"Total Quantity"}),e.jsx("div",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:E.totalQty})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-500 uppercase mb-1",children:"Good Condition"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:E.goodCondition})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-500 uppercase mb-1",children:"Damaged"}),e.jsx("div",{className:"text-2xl font-bold text-red-500",children:E.damagedQty})]})]})}),e.jsxs("div",{className:"pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("label",{className:"label mb-2",children:"General Remarks"}),e.jsx("textarea",{className:"input h-24",value:y.remarks,onChange:Q=>j({...y,remarks:Q.target.value}),placeholder:"Enter any additional notes about this return..."})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsx("button",{type:"button",onClick:()=>s("/inventory/return-to-stores"),className:"btn-secondary",children:"Cancel"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{j({...y,status:"DRAFT"}),q({preventDefault:()=>{}})},disabled:i,className:"btn-success",children:i&&y.status==="DRAFT"?"Saving...":" Save Draft"}),e.jsx("button",{type:"submit",disabled:i,onClick:()=>j({...y,status:"PENDING"}),className:"btn-primary",children:i&&y.status==="PENDING"?"Saving...":" Submit Return"})]})]})]})})]})})}function _ee(){const{canPerformAction:t}=Ls(),[s,r]=f.useState(""),[a,n]=f.useState(!1),[i,l]=f.useState(""),[o,d]=f.useState([]);f.useEffect(()=>{let h=!0;return n(!0),l(""),Z.get("/inventory/issue-to-requirement").then(m=>{var p;h&&d(Array.isArray((p=m.data)==null?void 0:p.items)?m.data.items:[])}).catch(m=>{var p,g;h&&l(((g=(p=m==null?void 0:m.response)==null?void 0:p.data)==null?void 0:g.message)||"Failed to load issues")}).finally(()=>{h&&n(!1)}),()=>{h=!1}},[]);const u=h=>({DRAFT:"badge-info",ISSUED:"badge-warning",POSTED:"badge-success",CANCELLED:"badge-error"})[h]||"badge-info",c=f.useMemo(()=>{const h=s.toLowerCase();return o.filter(m=>{const p=String(m.issue_no||"").toLowerCase(),g=String(m.department_name||"").toLowerCase();return p.includes(h)||g.includes(h)})},[o,s]);return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Issue to Requirement Area"}),e.jsx("p",{className:"text-sm mt-1",children:"Issue materials to departments / requirement areas"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/inventory/issue-to-requirement/new",className:"btn-success",children:"+ New Issue"})]})]})}),e.jsxs("div",{className:"card-body",children:[a?e.jsx("div",{className:"text-sm mb-4",children:"Loading..."}):null,i?e.jsx("div",{className:"text-sm text-red-600 mb-4",children:i}):null,e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by issue number or department...",className:"input max-w-md",value:s,onChange:h=>r(h.target.value)})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Issue No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Warehouse"}),e.jsx("th",{children:"Department"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:c.map(h=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:h.issue_no}),e.jsx("td",{children:h.issue_date}),e.jsx("td",{children:h.issue_type||"-"}),e.jsx("td",{children:h.warehouse_name||"-"}),e.jsx("td",{children:h.department_name||"-"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${u(h.status)}`,children:h.status})}),e.jsxs("td",{children:[t("inventory:issue-to-requirement","view")&&e.jsx(Re,{to:`/inventory/issue-to-requirement/${h.id}?mode=view`,className:"text-brand hover:text-brand-700 text-sm font-medium",children:"View"}),t("inventory:issue-to-requirement","edit")&&e.jsx(Re,{to:`/inventory/issue-to-requirement/${h.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"})]})]},h.id))})]})})]})]})})}function dC(){const{id:t}=Ps(),s=ps(),r=!t||t==="new",a=T=>{if(!T)return"";const Y=String(T);return Y.includes("T")?Y.split("T")[0]:Y},[n,i]=f.useState(!1),[l,o]=f.useState(!1),[d,u]=f.useState(""),[c,h]=f.useState([]),[m,p]=f.useState([]),[g,x]=f.useState([]),[b,y]=f.useState([]),[j,N]=f.useState({issueNo:r?"Auto-generated":"ISS-000",issueDate:new Date().toISOString().split("T")[0],warehouseId:"",issuedTo:"",departmentId:"",issueType:"GENERAL",requisitionId:"",status:"DRAFT",remarks:""}),[_,F]=f.useState([{id:1,item_id:"",itemCode:"",itemName:"",qtyIssued:0,uom:"",batchNumber:"",serialNumber:""}]),I=T=>{const Y=String(T||"").toUpperCase();return Y==="PRODUCTION"?"PRODUCTION":Y==="MAINTENANCE"?"MAINTENANCE":"GENERAL"},w=async T=>{var Y,H,M,q;if(T)try{const z=await Z.get(`/inventory/material-requisitions/${T}`),Q=((Y=z.data)==null?void 0:Y.item)||null,L=Array.isArray((H=z.data)==null?void 0:H.details)?z.data.details:[];if(Q&&N(V=>({...V,requisitionId:String(T),warehouseId:Q.warehouse_id?String(Q.warehouse_id):V.warehouseId,departmentId:Q.department_id?String(Q.department_id):V.departmentId,issueType:I(Q.requisition_type),issuedTo:Q.requested_by||V.issuedTo,remarks:V.remarks||""})),L.length){const V=L.map(P=>{const C=Number(P.qty_requested||0)-Number(P.qty_issued||0);return{id:P.id||Date.now()+Math.random(),item_id:P.item_id?String(P.item_id):"",itemCode:P.item_code||"",itemName:P.item_name||"",qtyIssued:C>0?C:Number(P.qty_requested||0),uom:P.uom||"",batchNumber:"",serialNumber:""}});F(V)}}catch(z){u(((q=(M=z==null?void 0:z.response)==null?void 0:M.data)==null?void 0:q.message)||"Failed to populate from requisition")}};f.useEffect(()=>{let T=!0;return(async()=>{var H,M,q,z,Q,L;try{const[V,P,C,k]=await Promise.all([Z.get("/inventory/items"),Z.get("/inventory/warehouses"),Z.get("/admin/departments"),Z.get("/inventory/material-requisitions")]);T&&(h(Array.isArray((H=V.data)==null?void 0:H.items)?V.data.items:[]),p(Array.isArray((M=P.data)==null?void 0:M.items)?P.data.items:[]),x(Array.isArray((q=C.data)==null?void 0:q.items)?C.data.items:[]),y(Array.isArray((z=k.data)==null?void 0:z.items)?k.data.items.filter(B=>String(B.status||"").toUpperCase()==="APPROVED"):[]))}catch(V){T&&u(((L=(Q=V==null?void 0:V.response)==null?void 0:Q.data)==null?void 0:L.message)||"Failed to load initial data")}})(),()=>{T=!1}},[]),f.useEffect(()=>{if(r)return;let T=!0;return i(!0),u(""),Z.get(`/inventory/issue-to-requirement/${t}`).then(Y=>{var q,z;if(!T)return;const H=(q=Y.data)==null?void 0:q.item,M=Array.isArray((z=Y.data)==null?void 0:z.details)?Y.data.details:[];H&&(N({issueNo:H.issue_no||"",issueDate:a(H.issue_date)||new Date().toISOString().split("T")[0],warehouseId:H.warehouse_id?String(H.warehouse_id):"",issuedTo:H.issued_to||"",departmentId:H.department_id?String(H.department_id):"",issueType:H.issue_type||"GENERAL",requisitionId:H.requisition_id?String(H.requisition_id):"",status:H.status||"DRAFT",remarks:H.remarks||""}),F(M.length?M.map(Q=>({id:Q.id||Date.now()+Math.random(),item_id:Q.item_id?String(Q.item_id):"",itemCode:Q.item_code||"",itemName:Q.item_name||"",qtyIssued:Number(Q.qty_issued)||0,uom:Q.uom||"",batchNumber:Q.batch_number||"",serialNumber:Q.serial_number||""})):[{id:1,item_id:"",itemCode:"",itemName:"",qtyIssued:0,uom:"",batchNumber:"",serialNumber:""}]))}).catch(Y=>{var H,M;T&&u(((M=(H=Y==null?void 0:Y.response)==null?void 0:H.data)==null?void 0:M.message)||"Failed to load issue to requirement")}).finally(()=>{T&&i(!1)}),()=>{T=!1}},[t,r]);const E=f.useMemo(()=>_.filter(T=>T.item_id).map(T=>({item_id:Number(T.item_id),qty_issued:Number(T.qtyIssued)||0,uom:T.uom||"",batch_number:T.batchNumber||null,serial_number:T.serialNumber||null})),[_]),W=()=>{F([..._,{id:Date.now(),item_id:"",itemCode:"",itemName:"",qtyIssued:0,uom:"",batchNumber:"",serialNumber:""}])},R=T=>{F(_.filter(Y=>Y.id!==T))},U=async(T,Y)=>{var M,q;T&&T.preventDefault(),o(!0),u("");const H=Y||j.status;try{const z={issue_no:r?void 0:j.issueNo,issue_date:j.issueDate,warehouse_id:j.warehouseId?Number(j.warehouseId):null,issued_to:j.issuedTo||null,department_id:j.departmentId?Number(j.departmentId):null,issue_type:j.issueType,requisition_id:j.requisitionId?Number(j.requisitionId):null,status:H,remarks:j.remarks||null,details:E};r?await Z.post("/inventory/issue-to-requirement",z):await Z.put(`/inventory/issue-to-requirement/${t}`,z),s("/inventory/issue-to-requirement")}catch(z){u(((q=(M=z==null?void 0:z.response)==null?void 0:M.data)==null?void 0:q.message)||"Failed to save issue to requirement")}finally{o(!1)}};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"New Issue to Requirement Area":"Edit Issue to Requirement Area"}),e.jsx("p",{className:"text-sm mt-1",children:"Issue materials to departments / requirement areas"})]}),e.jsx(Re,{to:"/inventory/issue-to-requirement",className:"btn-success",children:"Back to List"})]})}),e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[n?e.jsx("div",{className:"text-sm",children:"Loading..."}):null,d?e.jsx("div",{className:"text-sm text-red-600",children:d}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Issue No"}),e.jsx("input",{type:"text",className:"input bg-slate-100 dark:bg-slate-700",value:j.issueNo,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Issue Date *"}),e.jsx("input",{type:"date",className:"input",value:j.issueDate,onChange:T=>N({...j,issueDate:T.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Issue Type"}),e.jsxs("select",{className:"input",value:j.issueType,onChange:T=>N({...j,issueType:T.target.value}),children:[e.jsx("option",{value:"GENERAL",children:"General"}),e.jsx("option",{value:"PRODUCTION",children:"Production"}),e.jsx("option",{value:"MAINTENANCE",children:"Maintenance"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Department"}),e.jsxs("select",{className:"input",value:j.departmentId,onChange:T=>N({...j,departmentId:T.target.value}),children:[e.jsx("option",{value:"",children:"Select Department"}),g.map(T=>e.jsx("option",{value:T.id,children:T.name||T.department_name},T.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Warehouse"}),e.jsxs("select",{className:"input",value:j.warehouseId,onChange:T=>N({...j,warehouseId:T.target.value}),children:[e.jsx("option",{value:"",children:"Select Warehouse"}),m.map(T=>e.jsx("option",{value:T.id,children:T.warehouse_name||T.warehouse_code||T.id},T.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Requisition Reference"}),e.jsxs("select",{className:"input",value:j.requisitionId,onChange:async T=>{const Y=T.target.value;N({...j,requisitionId:Y}),Y&&await w(Y)},children:[e.jsx("option",{value:"",children:"Select Requisition (Optional)"}),b.map(T=>e.jsx("option",{value:T.id,children:T.requisition_no},T.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:j.status,onChange:T=>N({...j,status:T.target.value}),children:[e.jsx("option",{value:"DRAFT",children:"DRAFT"}),e.jsx("option",{value:"ISSUED",children:"ISSUED"}),e.jsx("option",{value:"POSTED",children:"POSTED"}),e.jsx("option",{value:"CANCELLED",children:"CANCELLED"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label",children:"Remarks"}),e.jsx("input",{type:"text",className:"input",value:j.remarks,onChange:T=>N({...j,remarks:T.target.value}),placeholder:"Enter any additional notes or remarks"})]})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Items"}),e.jsx("button",{type:"button",onClick:W,className:"btn-success text-sm",children:"+ Add Item"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-12",children:"#"}),e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Qty Issued"}),e.jsx("th",{children:"UOM"}),e.jsx("th",{children:"Batch No"}),e.jsx("th",{children:"Serial No"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:_.map((T,Y)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center text-slate-500",children:Y+1}),e.jsx("td",{className:"w-1/3",children:e.jsxs("select",{className:"input",value:T.item_id,onChange:H=>{const M=H.target.value,q=c.find(z=>String(z.id)===String(M));F(_.map(z=>z.id===T.id?{...z,item_id:M,itemCode:(q==null?void 0:q.item_code)||"",itemName:(q==null?void 0:q.item_name)||"",uom:(q==null?void 0:q.uom)||""}:z))},required:!0,children:[e.jsx("option",{value:"",children:"Select Item"}),c.map(H=>e.jsx("option",{value:H.id,children:(H.item_code||H.id)+" - "+(H.item_name||"")},H.id))]})}),e.jsx("td",{className:"w-24",children:e.jsx("input",{type:"number",className:"input",value:T.qtyIssued,onChange:H=>{const M=parseFloat(H.target.value);F(_.map(q=>q.id===T.id?{...q,qtyIssued:Number.isFinite(M)?M:0}:q))},min:"0",step:"0.001"})}),e.jsx("td",{className:"w-24",children:e.jsx("input",{type:"text",className:"input bg-slate-100 dark:bg-slate-700",value:T.uom||"",readOnly:!0})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input",value:T.batchNumber,onChange:H=>F(_.map(M=>M.id===T.id?{...M,batchNumber:H.target.value}:M)),placeholder:"Batch No"})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input",value:T.serialNumber,onChange:H=>F(_.map(M=>M.id===T.id?{...M,serialNumber:H.target.value}:M)),placeholder:"Serial No"})}),e.jsx("td",{children:e.jsx("button",{type:"button",onClick:()=>R(T.id),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Remove"})})]},T.id))})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx(Re,{to:"/inventory/issue-to-requirement",className:"px-4 py-2 border border-slate-300 rounded text-slate-700 hover:bg-slate-50 dark:border-slate-600 dark:text-slate-300 dark:hover:bg-slate-800",children:"Cancel"}),e.jsx("button",{type:"button",onClick:T=>U(T,"DRAFT"),className:"px-4 py-2 bg-slate-500 text-white rounded hover:bg-slate-600",disabled:l,children:"Save as Draft"}),e.jsx("button",{type:"button",onClick:T=>U(T,"POSTED"),className:"btn-success",disabled:l,children:l?"Saving...":"Save & Post"})]})]})})]})})}function See(){const t=ps(),[s,r]=f.useState(!1),[a,n]=f.useState(""),[i,l]=f.useState([]),[o,d]=f.useState([]),[u,c]=f.useState([]),[h,m]=f.useState([]),[p,g]=f.useState({}),[x,b]=f.useState({returnNo:"Auto-generated",returnDate:new Date().toISOString().split("T")[0],customerId:"",invoiceId:"",warehouseId:"",returnType:"DAMAGED",status:"DRAFT",remarks:""}),[y,j]=f.useState([{id:Date.now(),item_id:"",itemCode:"",itemName:"",qtyReturned:1,unitPrice:0,reasonCode:"DAMAGED",remarks:"",taxAmount:0}]),N=async(U,T)=>{var Y;if(!U||!T)return 0;try{const H=await Z.get(`/inventory/stock/available?warehouse_id=${U}&item_id=${T}`);return Number(((Y=H.data)==null?void 0:Y.qty)||0)}catch{return 0}};f.useEffect(()=>{let U=!0;async function T(){var Y,H,M,q,z,Q,L;try{const[V,P,C,k,B]=await Promise.all([Z.get("/sales/customers?active=true"),Z.get("/inventory/warehouses"),Z.get("/inventory/items"),Z.get("/finance/tax-codes"),Z.get("/sales/returns/next-no")]);if(!U)return;l(Array.isArray((Y=V.data)==null?void 0:Y.items)?V.data.items:[]),c(Array.isArray((H=P.data)==null?void 0:H.items)?P.data.items:[]),m(Array.isArray((M=C.data)==null?void 0:M.items)?C.data.items:[]);const G={},O=Array.isArray((q=k.data)==null?void 0:q.items)?k.data.items:[];for(const J of O)G[Number(J.id)]=Number(J.rate_percent||0);g(G);const K=String(((z=B.data)==null?void 0:z.nextNo)||"").trim();K&&b(J=>({...J,returnNo:K}))}catch(V){if(!U)return;n(((L=(Q=V==null?void 0:V.response)==null?void 0:Q.data)==null?void 0:L.message)||"Failed to load data")}}return T(),()=>{U=!1}},[]),f.useEffect(()=>{b(T=>({...T,invoiceId:""})),d([]);const U=x.customerId;U&&Z.get(`/sales/invoices?customer_id=${U}`).then(T=>{var H;const Y=Array.isArray((H=T.data)==null?void 0:H.items)?T.data.items:[];d(Y),Y.length>0&&b(M=>({...M,invoiceId:String(Y[0].id)}))}).catch(()=>{d([])})},[x.customerId]),f.useEffect(()=>{const U=x.invoiceId;U&&Z.get(`/sales/invoices/${U}`).then(async T=>{var z,Q;const Y=((z=T.data)==null?void 0:z.item)||{},H=Array.isArray((Q=T.data)==null?void 0:Q.details)?T.data.details:[];Y!=null&&Y.warehouse_id&&b(L=>({...L,warehouseId:String(Y.warehouse_id)}));let M=H.map((L,V)=>{const P=h.find(O=>Number(O.id)===Number(L.item_id)),C=Number(p[Number((P==null?void 0:P.vat_on_sales_id)||0)]||0),k=Math.round(Number(L.quantity||0)*100)/100,B=Math.round(Number(L.unit_price||0)*100)/100,G=Math.round(k*B*C/100*100)/100;return{id:Date.now()+V,item_id:L.item_id,itemCode:L.item_code||"",itemName:L.item_name||"",qtyReturned:k,unitPrice:B,reasonCode:x.returnType||"DAMAGED",remarks:"",taxAmount:G,uom:L.uom||""}});const q=(Y==null?void 0:Y.warehouse_id)||x.warehouseId||"";M.length&&q&&(M=await Promise.all(M.map(async V=>({...V,availableQty:await N(q,V.item_id)})))),M.length&&j(M)}).catch(()=>{})},[x.invoiceId,h,p]),f.useEffect(()=>{const U=x.warehouseId;if(!U){j(Y=>Y.map(H=>({...H,availableQty:void 0})));return}(async()=>{const Y=await Promise.all(y.map(async H=>{if(!H.item_id)return{...H,availableQty:void 0};const M=await N(U,H.item_id);return{...H,availableQty:M}}));j(Y)})()},[x.warehouseId]);const _=()=>{j([...y,{id:Date.now(),item_id:"",itemCode:"",itemName:"",qtyReturned:1,unitPrice:0,reasonCode:x.returnType||"DAMAGED",remarks:""}])},F=U=>{j(y.filter(T=>T.id!==U))},I=(U,T)=>{const Y=h.find(M=>String(M.id)===String(T));j(y.map(M=>M.id!==U?M:{...M,item_id:T,itemCode:(Y==null?void 0:Y.item_code)||"",itemName:(Y==null?void 0:Y.item_name)||"",unitPrice:Number((Y==null?void 0:Y.selling_price)||0)||Number((Y==null?void 0:Y.standard_price)||0)||0,reasonCode:x.returnType||"DAMAGED",taxAmount:(Number(M.qtyReturned)||0)*(Number(Number((Y==null?void 0:Y.selling_price)||0)||Number((Y==null?void 0:Y.standard_price)||0)||0)||0)*Number(p[Number((Y==null?void 0:Y.vat_on_sales_id)||0)]||0)/100}));const H=x.warehouseId;H&&T?N(H,Number(T)).then(M=>{j(q=>q.map(z=>z.id!==U?z:{...z,availableQty:M}))}).catch(()=>{j(M=>M.map(q=>q.id!==U?q:{...q,availableQty:0}))}):j(M=>M.map(q=>q.id!==U?q:{...q,availableQty:void 0}))},w=(U,T,Y)=>{j(y.map(H=>{if(H.id!==U)return H;const M={...H,[T]:Y},q=h.find(V=>Number(V.id)===Number(M.item_id)),z=Number(p[Number((q==null?void 0:q.vat_on_sales_id)||0)]||0),Q=Number(T==="qtyReturned"?Y:M.qtyReturned)||0,L=Number(T==="unitPrice"?Y:M.unitPrice)||0;return M.taxAmount=Math.round(Q*L*z/100*100)/100,M}))},E=f.useMemo(()=>y.filter(U=>U.item_id&&Number(U.qtyReturned)>0).map(U=>({item_id:Number(U.item_id),qty_returned:Number(U.qtyReturned)||0,unit_price:Number(U.unitPrice)||0,reason_code:U.reasonCode||null,remarks:U.remarks||null,tax_amount:Number(U.taxAmount)||0})),[y]),W=f.useMemo(()=>{const U=y.reduce((H,M)=>H+(Number(M.qtyReturned)||0)*(Number(M.unitPrice)||0),0),T=y.reduce((H,M)=>H+(Number(M.taxAmount)||0),0),Y=U+T;return{subTotal:Math.round(U*100)/100,taxTotal:Math.round(T*100)/100,grandTotal:Math.round(Y*100)/100}},[y]),R=async U=>{var T,Y;U.preventDefault(),r(!0),n("");try{const H={return_date:x.returnDate,customer_id:x.customerId?Number(x.customerId):null,invoice_id:x.invoiceId?Number(x.invoiceId):null,warehouse_id:x.warehouseId?Number(x.warehouseId):null,return_type:x.returnType,status:x.status,remarks:x.remarks||null,items:E};await Z.post("/sales/returns",H),t("/inventory/sales-returns")}catch(H){n(((Y=(T=H==null?void 0:H.response)==null?void 0:T.data)==null?void 0:Y.message)||"Failed to save sales return")}finally{r(!1)}};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"New Sales Return"}),e.jsx("p",{className:"text-sm mt-1",children:"Record returned goods and auto-create a Credit Note"})]}),e.jsx(Re,{to:"/inventory/sales-returns",className:"btn-success",children:"Back to List"})]})}),e.jsx("div",{className:"card-body p-6",children:e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[a?e.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded",children:a}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Return No"}),e.jsx("input",{className:"input",value:x.returnNo,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Return Date"}),e.jsx("input",{type:"date",className:"input",value:x.returnDate,onChange:U=>b(T=>({...T,returnDate:U.target.value}))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Customer"}),e.jsxs("select",{className:"input",value:x.customerId,onChange:U=>b(T=>({...T,customerId:U.target.value})),children:[e.jsx("option",{value:"",children:"Select customer"}),i.map(U=>e.jsx("option",{value:U.id,children:U.customer_name},U.id))]})]}),x.customerId?e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Related Invoice"}),e.jsx("select",{className:"input",value:x.invoiceId,onChange:U=>b(T=>({...T,invoiceId:U.target.value})),children:o.map(U=>e.jsx("option",{value:U.id,children:U.invoice_no},U.id))})]}):e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Related Invoice"}),e.jsx("input",{className:"input",value:"",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Warehouse"}),e.jsxs("select",{className:"input",value:x.warehouseId,onChange:U=>b(T=>({...T,warehouseId:U.target.value})),children:[e.jsx("option",{value:"",children:"Select warehouse"}),u.map(U=>e.jsx("option",{value:U.id,children:U.warehouse_name},U.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Reason for Return"}),e.jsxs("select",{className:"input w-full md:w-1/3",value:x.returnType,onChange:U=>b(T=>({...T,returnType:U.target.value})),children:[e.jsx("option",{value:"DAMAGED",children:"Damaged"}),e.jsx("option",{value:"WRONG_ITEM",children:"Wrong Item"}),e.jsx("option",{value:"QUALITY_ISSUE",children:"Quality Issue"}),e.jsx("option",{value:"EXCESS",children:"Excess"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Reason / Remarks"}),e.jsx("textarea",{className:"textarea w-full",rows:3,placeholder:"Reason for rejection or return details",value:x.remarks,onChange:U=>b(T=>({...T,remarks:U.target.value}))})]}),e.jsxs("div",{className:"rounded-lg border bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsx("div",{className:"font-medium",children:"Return Items"}),e.jsxs("button",{type:"button",className:"btn btn-primary btn-sm",onClick:_,children:[e.jsx(Ec,{className:"w-4 h-4 mr-1"})," Add Line"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-80",children:"Item"}),e.jsx("th",{className:"w-32",children:"Code"}),e.jsx("th",{className:"w-24",children:"UOM"}),e.jsx("th",{className:"text-right w-28",children:"Qty"}),e.jsx("th",{className:"w-32",children:"Convert"}),e.jsx("th",{className:"text-right w-32",children:"Available"}),e.jsx("th",{className:"text-right w-32",children:"Unit Price"}),e.jsx("th",{className:"text-right w-24",children:"Disc%"}),e.jsx("th",{className:"text-right w-28",children:"Tax"}),e.jsx("th",{className:"text-right w-32",children:"Total"}),e.jsx("th",{className:"w-40",children:"Reason"}),e.jsx("th",{className:"w-64",children:"Remarks"}),e.jsx("th",{className:"w-16"})]})}),e.jsx("tbody",{children:y.map(U=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("select",{className:"input w-full min-w-[18rem]",value:U.item_id,onChange:T=>I(U.id,T.target.value),children:[e.jsx("option",{value:"",children:"Select item"}),h.map(T=>e.jsx("option",{value:T.id,children:T.item_name},T.id))]})}),e.jsx("td",{children:U.itemCode||""}),e.jsx("td",{children:e.jsx("input",{className:"input w-full min-w-[5rem]",value:U.uom||"",readOnly:!0})}),e.jsx("td",{className:"text-right",children:e.jsx("input",{type:"number",min:0,className:"input text-right w-full min-w-[5rem]",value:U.qtyReturned,onChange:T=>w(U.id,"qtyReturned",T.target.value)})}),e.jsx("td",{}),e.jsx("td",{className:"text-right",children:x.warehouseId?Number(U.availableQty||0).toFixed(2):""}),e.jsx("td",{className:"text-right",children:e.jsx("input",{type:"number",min:0,step:"0.01",className:"input text-right w-full min-w-[6rem]",value:U.unitPrice,onChange:T=>w(U.id,"unitPrice",T.target.value)})}),e.jsx("td",{className:"text-right",children:0 .toFixed(2)}),e.jsx("td",{className:"text-right",children:e.jsx("input",{type:"number",min:0,step:"0.01",className:"input text-right w-full min-w-[6rem]",value:Number(U.taxAmount||0).toFixed(2),readOnly:!0})}),e.jsx("td",{className:"text-right",children:((Number(U.qtyReturned)||0)*(Number(U.unitPrice)||0)+Number(U.taxAmount||0)).toFixed(2)}),e.jsx("td",{children:e.jsxs("select",{className:"input w-full min-w-[8rem]",value:U.reasonCode,onChange:T=>w(U.id,"reasonCode",T.target.value),children:[e.jsx("option",{value:"DAMAGED",children:"Damaged"}),e.jsx("option",{value:"WRONG_ITEM",children:"Wrong Item"}),e.jsx("option",{value:"QUALITY_ISSUE",children:"Quality Issue"}),e.jsx("option",{value:"EXCESS",children:"Excess"})]})}),e.jsx("td",{children:e.jsx("input",{className:"input w-full min-w-[10rem]",value:U.remarks,onChange:T=>w(U.id,"remarks",T.target.value)})}),e.jsx("td",{className:"text-center",children:e.jsx("button",{type:"button",className:"btn btn-ghost btn-sm text-red-600",onClick:()=>F(U.id),children:e.jsx(ol,{className:"w-4 h-4"})})})]},U.id))})]})}),e.jsxs("div",{className:"p-4 flex justify-end gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Sub Total"}),e.jsx("div",{className:"text-lg font-bold",children:W.subTotal.toFixed(2)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Tax"}),e.jsx("div",{className:"text-lg font-bold",children:W.taxTotal.toFixed(2)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Total"}),e.jsx("div",{className:"text-lg font-bold",children:W.grandTotal.toFixed(2)})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/inventory/sales-returns",className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:s,children:s?"Saving...":"Save Sales Return"})]})]})})]})})}function Cee(){const[t,s]=f.useState([]),[r,a]=f.useState([]),[n,i]=f.useState([]),[l,o]=f.useState([]),[d,u]=f.useState(!0),[c,h]=f.useState(""),[m,p]=f.useState(""),[g,x]=f.useState(""),[b,y]=f.useState({item_id:"",warehouse_id:"",min_stock:"",max_stock:"",reorder_qty:"",lead_time:"0",supplier_id:""}),[j,N]=f.useState(null),_=f.useMemo(()=>{let T=0,Y=0;return t.forEach(H=>{const M=Number(H.current_stock||0),q=Number(H.min_stock||0);M<q?T++:M<q*1.2&&Y++}),{total:t.length,critical:T,low:Y,activeWarehouses:new Set(t.map(H=>H.warehouse_id)).size}},[t]);f.useEffect(()=>{F()},[]);const F=async()=>{u(!0);try{const[T,Y,H,M]=await Promise.all([Z.get("/inventory/reorder-points"),Z.get("/inventory/items"),Z.get("/inventory/warehouses"),Z.get("/purchase/suppliers")]);s(T.data.items||[]),a(Y.data.items||[]),i(H.data.items||[]),o(M.data.items||[])}catch(T){console.error(T),ct.error("Failed to load data")}finally{u(!1)}},I=async()=>{u(!0);try{const T={};c&&(T.warehouseId=c),m&&(T.search=m),g&&(T.status=g);const Y=await Z.get("/inventory/reorder-points",{params:T});s(Y.data.items||[])}catch(T){console.error(T),ct.error("Failed to apply filters")}finally{u(!1)}},w=async T=>{if(window.confirm("Are you sure you want to delete this reorder point?"))try{await Z.delete(`/inventory/reorder-points/${T}`),ct.success("Reorder point deleted"),F()}catch(Y){console.error(Y),ct.error("Failed to delete reorder point")}},E=T=>{var Y;N(T.id),y({item_id:T.item_id,warehouse_id:T.warehouse_id,min_stock:T.min_stock,max_stock:T.max_stock,reorder_qty:T.reorder_qty,lead_time:T.lead_time,supplier_id:T.supplier_id||""}),(Y=document.getElementById("reorderFormCard"))==null||Y.scrollIntoView({behavior:"smooth"})},W=()=>{N(null),y({item_id:"",warehouse_id:"",min_stock:"",max_stock:"",reorder_qty:"",lead_time:"0",supplier_id:""})},R=async T=>{var Y,H;T.preventDefault();try{await Z.post("/inventory/reorder-points",b),ct.success("Reorder point saved"),W(),F()}catch(M){console.error(M),ct.error(((H=(Y=M.response)==null?void 0:Y.data)==null?void 0:H.message)||"Failed to save reorder point")}},U=(T,Y,H)=>(T=Number(T),Y=Number(Y),T<Y?{className:"bg-red-100 text-red-700 border-red-200",text:"Critical"}:T<Y*1.2?{className:"bg-yellow-100 text-yellow-700 border-yellow-200",text:"Low Stock"}:{className:"bg-green-100 text-green-700 border-green-200",text:"Normal"});return e.jsxs("div",{className:"max-w-7xl mx-auto p-4 space-y-6",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx("span",{className:"text-3xl",children:""})," Stock Reorder Management System"]}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Manage inventory reorder points and maintain optimal stock levels"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg shadow-sm border-l-4 border-cyan-800",children:[e.jsxs("h3",{className:"text-slate-500 text-xs font-bold uppercase mb-2 flex items-center gap-2",children:[e.jsx(Au,{})," Total Items"]}),e.jsx("div",{className:"text-3xl font-bold text-cyan-900 dark:text-cyan-100",children:_.total})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg shadow-sm border-l-4 border-red-500",children:[e.jsxs("h3",{className:"text-slate-500 text-xs font-bold uppercase mb-2 flex items-center gap-2",children:[e.jsx(Ay,{className:"text-red-500"})," Critical Stock"]}),e.jsx("div",{className:"text-3xl font-bold text-slate-800 dark:text-white",children:_.critical})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg shadow-sm border-l-4 border-yellow-500",children:[e.jsxs("h3",{className:"text-slate-500 text-xs font-bold uppercase mb-2 flex items-center gap-2",children:[e.jsx(xL,{className:"text-yellow-500"})," Low Stock"]}),e.jsx("div",{className:"text-3xl font-bold text-slate-800 dark:text-white",children:_.low})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg shadow-sm border-l-4 border-blue-500",children:[e.jsxs("h3",{className:"text-slate-500 text-xs font-bold uppercase mb-2 flex items-center gap-2",children:[e.jsx(KL,{className:"text-blue-500"})," Active Warehouses"]}),e.jsx("div",{className:"text-3xl font-bold text-slate-800 dark:text-white",children:_.activeWarehouses})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-white mb-4 pb-2 border-b border-slate-100 dark:border-slate-700",children:"Stock Reorder List"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"form-control w-full",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Warehouse"})}),e.jsxs("select",{className:"select select-bordered w-full select-sm",value:c,onChange:T=>h(T.target.value),children:[e.jsx("option",{value:"",children:"All Warehouses"}),n.map(T=>e.jsx("option",{value:T.id,children:T.warehouse_name},T.id))]})]}),e.jsxs("div",{className:"form-control w-full",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Item Search"})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search by item name...",className:"input input-bordered w-full input-sm pr-8",value:m,onChange:T=>p(T.target.value)}),e.jsx(Jf,{className:"absolute right-3 top-2 text-slate-400",size:16})]})]}),e.jsxs("div",{className:"form-control w-full",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Status"})}),e.jsxs("select",{className:"select select-bordered w-full select-sm",value:g,onChange:T=>x(T.target.value),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"low",children:"Low Stock"}),e.jsx("option",{value:"normal",children:"Normal"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{className:"btn btn-primary btn-sm w-full",onClick:I,disabled:d,children:[e.jsx(FL,{})," Filter"]})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Warehouse"}),e.jsx("th",{children:"Current Stock"}),e.jsx("th",{children:"Levels (Min/Max)"}),e.jsx("th",{children:"Reorder Qty"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:d?e.jsx("tr",{children:e.jsx("td",{colspan:"7",className:"text-center py-4",children:"Loading..."})}):t.length===0?e.jsx("tr",{children:e.jsx("td",{colspan:"7",className:"text-center py-8 text-slate-500",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Au,{className:"text-4xl mb-2 opacity-20"}),"No reorder points found"]})})}):t.map(T=>{const Y=U(T.current_stock||0,T.min_stock,T.max_stock);return e.jsxs("tr",{className:"hover",children:[e.jsxs("td",{children:[e.jsx("div",{className:"font-bold",children:T.item_code}),e.jsx("div",{className:"text-xs text-slate-500",children:T.item_name})]}),e.jsx("td",{children:T.warehouse_name}),e.jsxs("td",{className:"font-mono",children:[Number(T.current_stock||0)," ",T.uom]}),e.jsxs("td",{className:"text-xs",children:[e.jsxs("div",{children:["Min: ",Number(T.min_stock)]}),e.jsxs("div",{children:["Max: ",Number(T.max_stock)]})]}),e.jsx("td",{children:Number(T.reorder_qty)}),e.jsx("td",{children:e.jsx("span",{className:`badge ${Y.className} font-semibold`,children:Y.text})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-ghost btn-xs text-blue-600",onClick:()=>E(T),title:"Edit",children:e.jsx(kh,{})}),e.jsx("button",{className:"btn btn-ghost btn-xs text-red-600",onClick:()=>w(T.id),title:"Delete",children:e.jsx(ol,{})})]})})]},T.id)})})]})})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{id:"reorderFormCard",className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 p-6 sticky top-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-white mb-4 pb-2 border-b border-slate-100 dark:border-slate-700",children:j?"Edit Reorder Point":"Add Reorder Point"}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{className:"form-control w-full",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-semibold",children:"Item *"})}),e.jsxs("select",{className:"select select-bordered w-full select-sm",required:!0,value:b.item_id,onChange:T=>y({...b,item_id:T.target.value}),disabled:!!j,children:[e.jsx("option",{value:"",children:"Select Item"}),r.map(T=>e.jsxs("option",{value:T.id,children:[T.item_code," - ",T.item_name]},T.id))]})]}),e.jsxs("div",{className:"form-control w-full",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-semibold",children:"Warehouse *"})}),e.jsxs("select",{className:"select select-bordered w-full select-sm",required:!0,value:b.warehouse_id,onChange:T=>y({...b,warehouse_id:T.target.value}),disabled:!!j,children:[e.jsx("option",{value:"",children:"Select Warehouse"}),n.map(T=>e.jsx("option",{value:T.id,children:T.warehouse_name},T.id))]})]}),e.jsx("div",{className:"divider text-xs text-slate-400",children:"Stock Levels"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-control w-full",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Min Stock *"})}),e.jsx("input",{type:"number",min:"0",step:"1",required:!0,className:"input input-bordered w-full input-sm",value:b.min_stock,onChange:T=>y({...b,min_stock:T.target.value})})]}),e.jsxs("div",{className:"form-control w-full",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Max Stock *"})}),e.jsx("input",{type:"number",min:"0",step:"1",required:!0,className:"input input-bordered w-full input-sm",value:b.max_stock,onChange:T=>y({...b,max_stock:T.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-control w-full",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Reorder Qty *"})}),e.jsx("input",{type:"number",min:"0",step:"1",required:!0,className:"input input-bordered w-full input-sm",value:b.reorder_qty,onChange:T=>y({...b,reorder_qty:T.target.value})})]}),e.jsxs("div",{className:"form-control w-full",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Lead Time (Days)"})}),e.jsx("input",{type:"number",min:"0",step:"1",className:"input input-bordered w-full input-sm",value:b.lead_time,onChange:T=>y({...b,lead_time:T.target.value})})]})]}),e.jsx("div",{className:"divider text-xs text-slate-400",children:"Supplier"}),e.jsxs("div",{className:"form-control w-full",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Preferred Supplier"})}),e.jsxs("select",{className:"select select-bordered w-full select-sm",value:b.supplier_id,onChange:T=>y({...b,supplier_id:T.target.value}),children:[e.jsx("option",{value:"",children:"Select Supplier"}),l.map(T=>e.jsx("option",{value:T.id,children:T.supplier_name},T.id))]})]}),e.jsxs("div",{className:"flex gap-2 mt-6 pt-4 border-t border-slate-100 dark:border-slate-700",children:[e.jsxs("button",{type:"submit",className:"btn btn-success btn-sm flex-1",children:[e.jsx(sA,{})," ",j?"Update":"Save"]}),e.jsxs("button",{type:"button",className:"btn btn-warning btn-sm",onClick:W,children:[j?e.jsx(Hk,{}):e.jsx(RL,{})," Reset"]})]})]})]})})]})]})}function kee(){const[t,s]=f.useState([]),[r,a]=f.useState([]),[n,i]=f.useState(""),[l,o]=f.useState(!1),d=f.useRef(null);f.useEffect(()=>{let m=!0;async function p(){var g,x,b,y;try{const[j,N]=await Promise.all([Z.get("/inventory/items"),Z.get("/inventory/warehouses")]);if(!m)return;s(Array.isArray((g=j.data)==null?void 0:g.items)?j.data.items:[]),a(Array.isArray((x=N.data)==null?void 0:x.items)?N.data.items:[])}catch(j){ct.error(((y=(b=j==null?void 0:j.response)==null?void 0:b.data)==null?void 0:y.message)||"Failed to load data")}}return p(),()=>{m=!1}},[]);const u=()=>{try{const m=["ITEM_CODE","ITEM_NAME","NEW_QTY"],p=t.map(b=>({ITEM_CODE:String(b.item_code||""),ITEM_NAME:String(b.item_name||""),NEW_QTY:""})),g=is.json_to_sheet(p,{header:m}),x=is.book_new();is.book_append_sheet(x,g,"StockUpload"),yr(x,"stock_upload_template.xlsx")}catch{ct.error("Failed to generate template")}},c=()=>{var m;(m=d.current)==null||m.click()},h=async m=>{var g,x,b,y,j;const p=(g=m.target.files)==null?void 0:g[0];if(p){o(!0);try{const N=await p.arrayBuffer(),_=qf(N,{type:"array"}),F=_.SheetNames[0],I=_.Sheets[F],E=is.sheet_to_json(I,{defval:""}).map(T=>({item_code:String(T.ITEM_CODE||T.item_code||"").trim(),qty:Number(T.NEW_QTY??T.qty??T.QTY??0)})).filter(T=>T.item_code&&Number.isFinite(T.qty));if(!E.length){ct.error("No valid rows found in the Excel file");return}const W=await Z.post("/inventory/stock-balances/bulk-upload",{rows:E,warehouseId:n||null}),R=Number(((x=W==null?void 0:W.data)==null?void 0:x.updated)||0),U=Number(((b=W==null?void 0:W.data)==null?void 0:b.failed)||0);ct.success(`Upload complete: ${R} updated${U?`, ${U} failed`:""}`)}catch(N){ct.error(((j=(y=N==null?void 0:N.response)==null?void 0:y.data)==null?void 0:j.message)||"Upload failed")}finally{o(!1),m.target.value=""}}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/inventory",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Inventory"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Stock Upload"}),e.jsx("p",{className:"text-sm mt-1",children:"Download template, fill quantities, and upload to update stock balances"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Warehouse"}),e.jsxs("select",{className:"input",value:n,onChange:m=>i(m.target.value),children:[e.jsx("option",{value:"",children:"None / Branch-level"}),r.map(m=>e.jsx("option",{value:m.id,children:m.warehouse_name||m.warehouse_code},m.id))]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{type:"button",className:"btn",onClick:u,children:[e.jsx(Cc,{className:"w-4 h-4 mr-2"}),"Download Template (Excel)"]})}),e.jsxs("div",{className:"flex items-end",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:c,disabled:l,children:"Upload Filled Excel"}),e.jsx("input",{ref:d,type:"file",accept:".xlsx,.xls",className:"hidden",onChange:h})]})]}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Template columns: ITEM_CODE, ITEM_NAME, NEW_QTY. Only ITEM_CODE and NEW_QTY are required."})]})})]})}function Eee(){const[t,s]=f.useState(""),[r,a]=f.useState(30),[n,i]=f.useState([]),[l,o]=f.useState([]),[d,u]=f.useState(!1);async function c(){var m;try{const p=await Z.get("/inventory/warehouses");o(((m=p.data)==null?void 0:m.items)||[])}catch{}}async function h(){var m,p,g;try{u(!0);const x=await Z.get("/inventory/reports/health-monitor",{params:{warehouseId:t||null,thresholdDays:r||null}});i(((m=x.data)==null?void 0:m.items)||[])}catch(x){ct.error(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Failed to load report")}finally{u(!1)}}return f.useEffect(()=>{c(),h()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/inventory",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Inventory"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Inventory Health Monitor"}),e.jsx("p",{className:"text-sm mt-1",children:"Coverage days, low stock, and reorder risks"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Warehouse"}),e.jsxs("select",{className:"input",value:t,onChange:m=>s(m.target.value),children:[e.jsx("option",{value:"",children:"All"}),l.map(m=>e.jsx("option",{value:m.id,children:m.name||m.code},m.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Threshold Days"}),e.jsx("input",{className:"input",type:"number",min:1,value:r,onChange:m=>a(m.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:h,disabled:d,children:d?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a(30)},disabled:d,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const m=Array.isArray(n)?n:[];if(!m.length)return;const p=is.json_to_sheet(m),g=is.book_new();is.book_append_sheet(g,p,"InventoryHealth"),yr(g,"inventory-health-monitor.xlsx")},disabled:!n.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const m=Array.isArray(n)?n:[];if(!m.length)return;const p=new hs("p","mm","a4");let g=15;p.setFontSize(14),p.text("Inventory Health Monitor",10,g),g+=8,p.setFontSize(10),p.text("Item",10,g),p.text("Available",95,g),p.text("Reorder",130,g),p.text("Days Cover",160,g),p.text("Status",190,g,{align:"right"}),g+=4,p.line(10,g,200,g),g+=5,m.forEach(x=>{g>270&&(p.addPage(),g=15),p.text(String(x.item_name||x.item_code||"-").slice(0,60),10,g),p.text(String(Number(x.available_qty||0).toLocaleString()),95,g),p.text(String(Number(x.reorder_level||0).toLocaleString()),130,g),p.text(String(Number(x.days_of_cover||0).toLocaleString()),160,g),p.text(String(x.status||"-"),190,g,{align:"right"}),g+=5}),p.save("inventory-health-monitor.pdf")},disabled:!n.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{className:"text-right",children:"Available"}),e.jsx("th",{className:"text-right",children:"Reorder Level"}),e.jsx("th",{className:"text-right",children:"Days of Cover"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:n.map(m=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:m.item_name||m.item_code}),e.jsx("td",{className:"text-right",children:Number(m.available_qty||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(m.reorder_level||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(m.days_of_cover||0).toLocaleString()}),e.jsx("td",{children:m.status||"-"})]},m.item_id))})]})}),n.length===0&&!d?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function Bee(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var u,c,h;try{o(!0);const m=await Z.get("/inventory/reports/periodical-stock-summary",{params:{from:t||null,to:r||null}});i(((u=m.data)==null?void 0:u.items)||[])}catch(m){ct.error(((h=(c=m==null?void 0:m.response)==null?void 0:c.data)==null?void 0:h.message)||"Failed to load report")}finally{o(!1)}}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/inventory",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Inventory"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Periodical Stock Summary"}),e.jsx("p",{className:"text-sm mt-1",children:"Opening, receipts, issues, closing per period"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:u=>s(u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:u=>a(u.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=is.json_to_sheet(u),h=is.book_new();is.book_append_sheet(h,c,"PeriodicalStockSummary"),yr(h,"periodical-stock-summary.xlsx")},disabled:!n.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=new hs("p","mm","a4");let h=15;c.setFontSize(14),c.text("Periodical Stock Summary",10,h),h+=8,c.setFontSize(10),c.text("Item",10,h),c.text("Opening",95,h),c.text("Receipts",130,h),c.text("Issues",160,h),c.text("Closing",190,h,{align:"right"}),h+=4,c.line(10,h,200,h),h+=5,u.forEach(m=>{h>270&&(c.addPage(),h=15),c.text(String(m.item_name||m.item_code||"-").slice(0,60),10,h),c.text(String(Number(m.opening_qty||0).toLocaleString()),95,h),c.text(String(Number(m.receipts_qty||0).toLocaleString()),130,h),c.text(String(Number(m.issues_qty||0).toLocaleString()),160,h),c.text(String(Number(m.closing_qty||0).toLocaleString()),190,h,{align:"right"}),h+=5}),c.save("periodical-stock-summary.pdf")},disabled:!n.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{className:"text-right",children:"Opening"}),e.jsx("th",{className:"text-right",children:"Receipts"}),e.jsx("th",{className:"text-right",children:"Issues"}),e.jsx("th",{className:"text-right",children:"Closing"})]})}),e.jsx("tbody",{children:n.map(u=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:u.item_name||u.item_code}),e.jsx("td",{className:"text-right",children:Number(u.opening_qty||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(u.receipts_qty||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(u.issues_qty||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(u.closing_qty||0).toLocaleString()})]},u.item_id))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function Fee(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var u,c,h;try{o(!0);const m=await Z.get("/inventory/reports/periodical-stock-statement",{params:{from:t||null,to:r||null}});i(((u=m.data)==null?void 0:u.items)||[])}catch(m){ct.error(((h=(c=m==null?void 0:m.response)==null?void 0:c.data)==null?void 0:h.message)||"Failed to load report")}finally{o(!1)}}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/inventory",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Inventory"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Periodical Stock Statement"}),e.jsx("p",{className:"text-sm mt-1",children:"Detailed stock movements within the period"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:u=>s(u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:u=>a(u.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=is.json_to_sheet(u),h=is.book_new();is.book_append_sheet(h,c,"PeriodicalStockStatement"),yr(h,"periodical-stock-statement.xlsx")},disabled:!n.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=new hs("p","mm","a4");let h=15;c.setFontSize(14),c.text("Periodical Stock Statement",10,h),h+=8,c.setFontSize(10),c.text("Date",10,h),c.text("Document",45,h),c.text("Item",95,h),c.text("In",140,h),c.text("Out",165,h),c.text("Balance",190,h,{align:"right"}),h+=4,c.line(10,h,200,h),h+=5,u.forEach(m=>{h>270&&(c.addPage(),h=15);const p=m.txn_date?new Date(m.txn_date).toLocaleDateString():"-",g=String(m.doc_no||"-"),x=String(m.item_name||m.item_code||"-").slice(0,40),b=String(Number(m.qty_in||0).toLocaleString()),y=String(Number(m.qty_out||0).toLocaleString()),j=String(Number(m.balance_qty||0).toLocaleString());c.text(p,10,h),c.text(g,45,h),c.text(x,95,h),c.text(b,140,h),c.text(y,165,h),c.text(j,190,h,{align:"right"}),h+=5}),c.save("periodical-stock-statement.pdf")},disabled:!n.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Document"}),e.jsx("th",{children:"Item"}),e.jsx("th",{className:"text-right",children:"In"}),e.jsx("th",{className:"text-right",children:"Out"}),e.jsx("th",{className:"text-right",children:"Balance"})]})}),e.jsx("tbody",{children:n.map((u,c)=>e.jsxs("tr",{children:[e.jsx("td",{children:u.txn_date?new Date(u.txn_date).toLocaleDateString():"-"}),e.jsx("td",{className:"font-medium",children:u.doc_no||"-"}),e.jsx("td",{children:u.item_name||u.item_code}),e.jsx("td",{className:"text-right",children:Number(u.qty_in||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(u.qty_out||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(u.balance_qty||0).toLocaleString()})]},u.id||c))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function Tee(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var u,c,h;try{o(!0);const m=await Z.get("/inventory/reports/issue-register",{params:{from:t||null,to:r||null}});i(((u=m.data)==null?void 0:u.items)||[])}catch(m){ct.error(((h=(c=m==null?void 0:m.response)==null?void 0:c.data)==null?void 0:h.message)||"Failed to load report")}finally{o(!1)}}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/inventory",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Inventory"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Issue Register"}),e.jsx("p",{className:"text-sm mt-1",children:"Items issued to departments or projects"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:u=>s(u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:u=>a(u.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=is.json_to_sheet(u),h=is.book_new();is.book_append_sheet(h,c,"IssueRegister"),yr(h,"issue-register.xlsx")},disabled:!n.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=new hs("p","mm","a4");let h=15;c.setFontSize(14),c.text("Issue Register",10,h),h+=8,c.setFontSize(10),c.text("Date",10,h),c.text("Issue No",45,h),c.text("Department",85,h),c.text("Item",130,h),c.text("Qty",190,h,{align:"right"}),h+=4,c.line(10,h,200,h),h+=5,u.forEach(m=>{h>270&&(c.addPage(),h=15);const p=m.issue_date?new Date(m.issue_date).toLocaleDateString():"-",g=String(m.issue_no||"-"),x=String(m.department_name||"-").slice(0,35),b=String(m.item_name||m.item_code||"-").slice(0,35),y=String(Number(m.qty||0).toLocaleString());c.text(p,10,h),c.text(g,45,h),c.text(x,85,h),c.text(b,130,h),c.text(y,190,h,{align:"right"}),h+=5}),c.save("issue-register.pdf")},disabled:!n.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Issue No"}),e.jsx("th",{children:"Department"}),e.jsx("th",{children:"Item"}),e.jsx("th",{className:"text-right",children:"Quantity"})]})}),e.jsx("tbody",{children:n.map(u=>e.jsxs("tr",{children:[e.jsx("td",{children:u.issue_date?new Date(u.issue_date).toLocaleDateString():"-"}),e.jsx("td",{className:"font-medium",children:u.issue_no||"-"}),e.jsx("td",{children:u.department_name||"-"}),e.jsx("td",{children:u.item_name||u.item_code}),e.jsx("td",{className:"text-right",children:Number(u.qty||0).toLocaleString()})]},u.id))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function Iee(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var u,c,h;try{o(!0);const m=await Z.get("/inventory/reports/stock-transfer-register",{params:{from:t||null,to:r||null}});i(((u=m.data)==null?void 0:u.items)||[])}catch(m){ct.error(((h=(c=m==null?void 0:m.response)==null?void 0:c.data)==null?void 0:h.message)||"Failed to load report")}finally{o(!1)}}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/inventory",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Inventory"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Stock Transfer Register"}),e.jsx("p",{className:"text-sm mt-1",children:"Transfers between warehouses with quantities"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:u=>s(u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:u=>a(u.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=is.json_to_sheet(u),h=is.book_new();is.book_append_sheet(h,c,"StockTransferRegister"),yr(h,"stock-transfer-register.xlsx")},disabled:!n.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=new hs("p","mm","a4");let h=15;c.setFontSize(14),c.text("Stock Transfer Register",10,h),h+=8,c.setFontSize(10),c.text("Date",10,h),c.text("Transfer No",45,h),c.text("From",90,h),c.text("To",125,h),c.text("Item",155,h),c.text("Qty",190,h,{align:"right"}),h+=4,c.line(10,h,200,h),h+=5,u.forEach(m=>{h>270&&(c.addPage(),h=15);const p=m.transfer_date?new Date(m.transfer_date).toLocaleDateString():"-",g=String(m.transfer_no||"-"),x=String(m.from_warehouse_name||"-").slice(0,25),b=String(m.to_warehouse_name||"-").slice(0,25),y=String(m.item_name||m.item_code||"-").slice(0,25),j=String(Number(m.qty||0).toLocaleString());c.text(p,10,h),c.text(g,45,h),c.text(x,90,h),c.text(b,125,h),c.text(y,155,h),c.text(j,190,h,{align:"right"}),h+=5}),c.save("stock-transfer-register.pdf")},disabled:!n.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Transfer No"}),e.jsx("th",{children:"From"}),e.jsx("th",{children:"To"}),e.jsx("th",{children:"Item"}),e.jsx("th",{className:"text-right",children:"Quantity"})]})}),e.jsx("tbody",{children:n.map(u=>e.jsxs("tr",{children:[e.jsx("td",{children:u.transfer_date?new Date(u.transfer_date).toLocaleDateString():"-"}),e.jsx("td",{className:"font-medium",children:u.transfer_no||"-"}),e.jsx("td",{children:u.from_warehouse_name||"-"}),e.jsx("td",{children:u.to_warehouse_name||"-"}),e.jsx("td",{children:u.item_name||u.item_code}),e.jsx("td",{className:"text-right",children:Number(u.qty||0).toLocaleString()})]},u.id))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function Lee(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var u,c,h;try{o(!0);const m=await Z.get("/inventory/reports/stock-verification",{params:{from:t||null,to:r||null}});i(((u=m.data)==null?void 0:u.items)||[])}catch(m){ct.error(((h=(c=m==null?void 0:m.response)==null?void 0:c.data)==null?void 0:h.message)||"Failed to load report")}finally{o(!1)}}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/inventory",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Inventory"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Stock Verification Report"}),e.jsx("p",{className:"text-sm mt-1",children:"Variances identified during stock verification"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:u=>s(u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:u=>a(u.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=is.json_to_sheet(u),h=is.book_new();is.book_append_sheet(h,c,"StockVerification"),yr(h,"stock-verification.xlsx")},disabled:!n.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=new hs("p","mm","a4");let h=15;c.setFontSize(14),c.text("Stock Verification Report",10,h),h+=8,c.setFontSize(10),c.text("Date",10,h),c.text("Verify No",30,h),c.text("Warehouse",55,h),c.text("Status",85,h),c.text("Item",110,h),c.text("System",150,h),c.text("Physical",170,h),c.text("Variance",200,h,{align:"right"}),h+=4,c.line(10,h,200,h),h+=5,u.forEach(m=>{h>270&&(c.addPage(),h=15);const p=m.verify_date?new Date(m.verify_date).toLocaleDateString():"-",g=String(m.verify_no||"-"),x=String(m.warehouse_name||"-").slice(0,14),b=String(m.status||"-").slice(0,10),y=String(m.item_name||m.item_code||"-").slice(0,26),j=String(Number(m.system_qty||0).toLocaleString()),N=String(Number(m.physical_qty||0).toLocaleString()),_=String(Number((m.physical_qty||0)-(m.system_qty||0)).toLocaleString());c.text(p,10,h),c.text(g,30,h),c.text(x,55,h),c.text(b,85,h),c.text(y,110,h),c.text(j,150,h),c.text(N,170,h),c.text(_,200,h,{align:"right"}),h+=5}),c.save("stock-verification.pdf")},disabled:!n.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Verification No"}),e.jsx("th",{children:"Warehouse"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Item"}),e.jsx("th",{className:"text-right",children:"System Qty"}),e.jsx("th",{className:"text-right",children:"Physical Qty"}),e.jsx("th",{className:"text-right",children:"Variance"})]})}),e.jsx("tbody",{children:n.map(u=>e.jsxs("tr",{children:[e.jsx("td",{children:u.verify_date?new Date(u.verify_date).toLocaleDateString():"-"}),e.jsx("td",{className:"font-medium",children:u.verify_no||"-"}),e.jsx("td",{children:u.warehouse_name||"-"}),e.jsx("td",{children:u.status||"-"}),e.jsx("td",{children:u.item_name||u.item_code}),e.jsx("td",{className:"text-right",children:Number(u.system_qty||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(u.physical_qty||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number((u.physical_qty||0)-(u.system_qty||0)).toLocaleString()})]},u.id))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function Dee(){const[t,s]=f.useState(""),[r,a]=f.useState([]),[n,i]=f.useState(!1);async function l(){var o,d,u;try{i(!0);const c=await Z.get("/inventory/reports/stock-aging-analysis",{params:{asOf:t||null}});a(((o=c.data)==null?void 0:o.items)||[])}catch(c){ct.error(((u=(d=c==null?void 0:c.response)==null?void 0:d.data)==null?void 0:u.message)||"Failed to load report")}finally{i(!1)}}return f.useEffect(()=>{l()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/inventory",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Inventory"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Stock Aging Analysis"}),e.jsx("p",{className:"text-sm mt-1",children:"Age buckets for inventory holding"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"As of Date"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:o=>s(o.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:l,disabled:n,children:n?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s("")},disabled:n,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const o=Array.isArray(r)?r:[];if(!o.length)return;const d=is.json_to_sheet(o),u=is.book_new();is.book_append_sheet(u,d,"StockAging"),yr(u,"stock-aging-analysis.xlsx")},disabled:!r.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const o=Array.isArray(r)?r:[];if(!o.length)return;const d=new hs("p","mm","a4");let u=15;d.setFontSize(14),d.text("Stock Aging Analysis",10,u),u+=8,d.setFontSize(10),d.text("Item",10,u),d.text("0-30",95,u),d.text("31-60",120,u),d.text("61-90",145,u),d.text("90+",190,u,{align:"right"}),u+=4,d.line(10,u,200,u),u+=5,o.forEach(c=>{u>270&&(d.addPage(),u=15),d.text(String(c.item_name||c.item_code||"-").slice(0,70),10,u),d.text(String(Number(c.bucket_0_30||0).toLocaleString()),95,u),d.text(String(Number(c.bucket_31_60||0).toLocaleString()),120,u),d.text(String(Number(c.bucket_61_90||0).toLocaleString()),145,u),d.text(String(Number(c.bucket_90_plus||0).toLocaleString()),190,u,{align:"right"}),u+=5}),d.save("stock-aging-analysis.pdf")},disabled:!r.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{className:"text-right",children:"030"}),e.jsx("th",{className:"text-right",children:"3160"}),e.jsx("th",{className:"text-right",children:"6190"}),e.jsx("th",{className:"text-right",children:"90+"})]})}),e.jsx("tbody",{children:r.map(o=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:o.item_name||o.item_code}),e.jsx("td",{className:"text-right",children:Number(o.bucket_0_30||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(o.bucket_31_60||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(o.bucket_61_90||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(o.bucket_90_plus||0).toLocaleString()})]},o.item_id))})]})}),r.length===0&&!n?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function Pee(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var u,c,h;try{o(!0);const m=await Z.get("/inventory/reports/slow-moving",{params:{from:t||null,to:r||null}});i(((u=m.data)==null?void 0:u.items)||[])}catch(m){ct.error(((h=(c=m==null?void 0:m.response)==null?void 0:c.data)==null?void 0:h.message)||"Failed to load report")}finally{o(!1)}}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/inventory",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Inventory"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Slow Moving Items"}),e.jsx("p",{className:"text-sm mt-1",children:"Items with low turnover in the period"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:u=>s(u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:u=>a(u.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=is.json_to_sheet(u),h=is.book_new();is.book_append_sheet(h,c,"SlowMoving"),yr(h,"slow-moving.xlsx")},disabled:!n.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=new hs("p","mm","a4");let h=15;c.setFontSize(14),c.text("Slow Moving Items",10,h),h+=8,c.setFontSize(10),c.text("Item",10,h),c.text("Issued Qty",130,h),c.text("Turnover",190,h,{align:"right"}),h+=4,c.line(10,h,200,h),h+=5,u.forEach(m=>{h>270&&(c.addPage(),h=15),c.text(String(m.item_name||m.item_code||"-").slice(0,80),10,h),c.text(String(Number(m.issued_qty||0).toLocaleString()),130,h),c.text(String(Number(m.turnover||0).toLocaleString()),190,h,{align:"right"}),h+=5}),c.save("slow-moving.pdf")},disabled:!n.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{className:"text-right",children:"Issued Qty"}),e.jsx("th",{className:"text-right",children:"Turnover"})]})}),e.jsx("tbody",{children:n.map(u=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:u.item_name||u.item_code}),e.jsx("td",{className:"text-right",children:Number(u.issued_qty||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(u.turnover||0).toLocaleString()})]},u.item_id))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function Uee(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var u,c,h;try{o(!0);const m=await Z.get("/inventory/reports/fast-moving",{params:{from:t||null,to:r||null}});i(((u=m.data)==null?void 0:u.items)||[])}catch(m){ct.error(((h=(c=m==null?void 0:m.response)==null?void 0:c.data)==null?void 0:h.message)||"Failed to load report")}finally{o(!1)}}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/inventory",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Inventory"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Fast Moving Items"}),e.jsx("p",{className:"text-sm mt-1",children:"Items with high turnover in the period"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:u=>s(u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:u=>a(u.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=is.json_to_sheet(u),h=is.book_new();is.book_append_sheet(h,c,"FastMoving"),yr(h,"fast-moving.xlsx")},disabled:!n.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=new hs("p","mm","a4");let h=15;c.setFontSize(14),c.text("Fast Moving Items",10,h),h+=8,c.setFontSize(10),c.text("Item",10,h),c.text("Issued Qty",130,h),c.text("Turnover",190,h,{align:"right"}),h+=4,c.line(10,h,200,h),h+=5,u.forEach(m=>{h>270&&(c.addPage(),h=15),c.text(String(m.item_name||m.item_code||"-").slice(0,80),10,h),c.text(String(Number(m.issued_qty||0).toLocaleString()),130,h),c.text(String(Number(m.turnover||0).toLocaleString()),190,h,{align:"right"}),h+=5}),c.save("fast-moving.pdf")},disabled:!n.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{className:"text-right",children:"Issued Qty"}),e.jsx("th",{className:"text-right",children:"Turnover"})]})}),e.jsx("tbody",{children:n.map(u=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:u.item_name||u.item_code}),e.jsx("td",{className:"text-right",children:Number(u.issued_qty||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(u.turnover||0).toLocaleString()})]},u.item_id))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function Ree(){const[t,s]=f.useState(""),[r,a]=f.useState([]),[n,i]=f.useState(!1);async function l(){var o,d,u;try{i(!0);const c=await Z.get("/inventory/reports/non-moving",{params:{asOf:t||null}});a(((o=c.data)==null?void 0:o.items)||[])}catch(c){ct.error(((u=(d=c==null?void 0:c.response)==null?void 0:d.data)==null?void 0:u.message)||"Failed to load report")}finally{i(!1)}}return f.useEffect(()=>{l()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/inventory",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Inventory"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Non Moving Items"}),e.jsx("p",{className:"text-sm mt-1",children:"Items with no movement within the period"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"As of Date"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:o=>s(o.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:l,disabled:n,children:n?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s("")},disabled:n,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const o=Array.isArray(r)?r:[];if(!o.length)return;const d=is.json_to_sheet(o),u=is.book_new();is.book_append_sheet(u,d,"NonMoving"),yr(u,"non-moving.xlsx")},disabled:!r.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const o=Array.isArray(r)?r:[];if(!o.length)return;const d=new hs("p","mm","a4");let u=15;d.setFontSize(14),d.text("Non Moving Items",10,u),u+=8,d.setFontSize(10),d.text("Item",10,u),d.text("Available",130,u),d.text("Days Since Last",190,u,{align:"right"}),u+=4,d.line(10,u,200,u),u+=5,o.forEach(c=>{u>270&&(d.addPage(),u=15),d.text(String(c.item_name||c.item_code||"-").slice(0,80),10,u),d.text(String(Number(c.available_qty||0).toLocaleString()),130,u),d.text(String(Number(c.days_since_last||0).toLocaleString()),190,u,{align:"right"}),u+=5}),d.save("non-moving.pdf")},disabled:!r.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{className:"text-right",children:"Available"}),e.jsx("th",{className:"text-right",children:"Days Since Last Movement"})]})}),e.jsx("tbody",{children:r.map(o=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:o.item_name||o.item_code}),e.jsx("td",{className:"text-right",children:Number(o.available_qty||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(o.days_since_last||0).toLocaleString()})]},o.item_id))})]})}),r.length===0&&!n?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function Oee(){const[t,s]=f.useState([]),[r,a]=f.useState(!0),[n,i]=f.useState(!1),l=f.useMemo(()=>{const u=t.filter(c=>Number(c.qty||0)<=Number(c.reorder_level||0)).length;return{total:t.length,critical:u}},[t]);async function o(){var u,c,h;a(!0);try{const m=await Z.get("/inventory/alerts/low-stock");s(Array.isArray((u=m.data)==null?void 0:u.items)?m.data.items:[])}catch(m){ct.error(((h=(c=m==null?void 0:m.response)==null?void 0:c.data)==null?void 0:h.message)||"Failed to load alerts")}finally{a(!1)}}f.useEffect(()=>{o()},[]);async function d(){var u,c,h;i(!0);try{const m=await Z.post("/inventory/alerts/low-stock/notify-email");ct.success(((u=m.data)==null?void 0:u.message)||"Email notification sent")}catch(m){ct.error(((h=(c=m==null?void 0:m.response)==null?void 0:c.data)==null?void 0:h.message)||"Failed to send email")}finally{i(!1)}}return e.jsxs("div",{className:"max-w-7xl mx-auto p-4 space-y-6",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(Ay,{className:"text-red-600"})," Low Stock Alerts"]}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Items at or below their reorder levels"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"}),e.jsxs("button",{className:"btn btn-primary",onClick:d,disabled:n||r||t.length===0,title:"Send email notification",children:[e.jsx(IL,{})," Send Email"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg shadow-sm border-l-4 border-red-500",children:[e.jsxs("h3",{className:"text-slate-500 text-xs font-bold uppercase mb-2 flex items-center gap-2",children:[e.jsx(Au,{})," Total Items"]}),e.jsx("div",{className:"text-3xl font-bold text-slate-800 dark:text-white",children:l.total})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg shadow-sm border-l-4 border-red-600",children:[e.jsxs("h3",{className:"text-slate-500 text-xs font-bold uppercase mb-2 flex items-center gap-2",children:[e.jsx(Ay,{className:"text-red-600"})," At/Below Reorder"]}),e.jsx("div",{className:"text-3xl font-bold text-slate-800 dark:text-white",children:l.critical})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg shadow-sm border-l-4 border-blue-500",children:[e.jsx("h3",{className:"text-slate-500 text-xs font-bold uppercase mb-2",children:"Actions"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(Re,{to:"/inventory/stock-reorder",className:"btn btn-info btn-sm",children:"Manage Reorder Points"})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-white mb-4 pb-2 border-b border-slate-100 dark:border-slate-700",children:"Items"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"UoM"}),e.jsx("th",{className:"text-right",children:"Available Qty"}),e.jsx("th",{className:"text-right",children:"Reorder Level"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:r?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-4",children:"Loading..."})}):t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-8 text-slate-500",children:"No low stock items found"})}):t.map(u=>e.jsxs("tr",{className:"hover",children:[e.jsxs("td",{children:[e.jsx("div",{className:"font-bold",children:u.item_code}),e.jsx("div",{className:"text-xs text-slate-500",children:u.item_name})]}),e.jsx("td",{children:u.uom}),e.jsx("td",{className:"text-right",children:Number(u.qty||0)}),e.jsx("td",{className:"text-right",children:Number(u.reorder_level||0)}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:`/inventory/items/${u.id}`,className:"btn btn-ghost btn-xs text-blue-600",title:"View Item",children:"View Item"}),e.jsx(Re,{to:"/inventory/stock-reorder",className:"btn btn-ghost btn-xs text-cyan-600",title:"Manage Reorder",children:"Reorder Settings"})]})})]},u.id))})]})})]})]})}function Mee(){const[t,s]=f.useState([]),[r,a]=f.useState(!1),[n,i]=f.useState(""),[l,o]=f.useState("");f.useEffect(()=>{let c=!0;async function h(){var m;a(!0),i("");try{const p=await Z.get("/purchase/returns");if(!c)return;s(Array.isArray((m=p.data)==null?void 0:m.items)?p.data.items:[])}catch{if(!c)return;i("Failed to load purchase returns")}finally{if(!c)return;a(!1)}}return h(),()=>{c=!1}},[]);const d=f.useMemo(()=>({total:t.length}),[t]),u=f.useMemo(()=>{const c=l.trim().toLowerCase();return c?t.filter(h=>String(h.return_no||"").toLowerCase().includes(c)||String(h.supplier_name||"").toLowerCase().includes(c)):t},[t,l]);return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx("span",{children:""})," Purchase Returns"]}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Process supplier returns"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/inventory/purchase-returns/new",className:"btn btn-primary",children:"New Purchase Return"}),e.jsx(Re,{to:"/inventory",className:"btn btn-secondary",children:"Return to Menu"})]})]})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:e.jsxs("div",{className:"p-4 rounded-lg border bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Total Returns"}),e.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:d.total})]})}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",className:"input pl-10",placeholder:"Search by return no or supplier",value:l,onChange:c=>o(c.target.value)}),e.jsx(Jf,{className:"w-5 h-5 text-slate-400 absolute left-3 top-1/2 -translate-y-1/2"})]})}),n&&e.jsx("div",{className:"alert alert-error mb-4",children:n}),r?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-brand"}),e.jsx("p",{className:"mt-2",children:"Loading purchase returns..."})]}):u.length===0?e.jsx("div",{className:"text-center py-12 text-slate-600",children:"No purchase returns found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Return No"}),e.jsx("th",{children:"Return Date"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:u.map(c=>e.jsxs("tr",{children:[e.jsx("td",{children:c.return_no}),e.jsx("td",{children:String(c.return_date||"").slice(0,10)}),e.jsx("td",{children:c.supplier_name}),e.jsx("td",{className:"text-right",children:Number(c.total_amount||0).toFixed(2)})]},c.id))})]})})]})]})})}function Qee(){const t=ps(),[s,r]=f.useState(!1),[a,n]=f.useState(""),[i,l]=f.useState([]),[o,d]=f.useState([]),[u,c]=f.useState([]),[h,m]=f.useState({}),[p,g]=f.useState([]),[x,b]=f.useState({returnNo:"Auto-generated",returnDate:new Date().toISOString().split("T")[0],supplierId:"",warehouseId:"",returnType:"DAMAGED",remarks:""}),[y,j]=f.useState([{id:Date.now(),item_id:"",itemCode:"",itemName:"",qtyReturned:1,unitPrice:0,reasonCode:"DAMAGED",remarks:"",taxAmount:0}]);f.useEffect(()=>{let E=!0;async function W(){var R,U,T,Y,H;try{const[M,q,z,Q,L]=await Promise.all([Z.get("/purchase/suppliers?active=true"),Z.get("/inventory/warehouses"),Z.get("/inventory/items"),Z.get("/finance/tax-codes"),Z.get("/purchase/returns/next-no")]);if(!E)return;l(Array.isArray((R=M.data)==null?void 0:R.items)?M.data.items:[]),d(Array.isArray((U=q.data)==null?void 0:U.items)?q.data.items:[]),c(Array.isArray((T=z.data)==null?void 0:T.items)?z.data.items:[]);const V={},P=Array.isArray((Y=Q.data)==null?void 0:Y.items)?Q.data.items:[];for(const k of P)V[Number(k.id)]=Number(k.rate_percent||0);m(V);const C=String(((H=L.data)==null?void 0:H.nextNo)||"").trim();C&&b(k=>({...k,returnNo:C}))}catch{if(!E)return;n("Failed to load master data")}}return W(),()=>{E=!1}},[]),f.useEffect(()=>{const E=Number(x.supplierId||0);g([]),b(W=>({...W,purchaseBillId:""})),E&&Z.get("/purchase/bills",{params:{supplier_id:E}}).then(W=>{var U;const R=Array.isArray((U=W.data)==null?void 0:U.items)?W.data.items:[];g(R),R.length>0&&b(T=>({...T,purchaseBillId:String(R[0].id)}))}).catch(()=>{g([])})},[x.supplierId]),f.useEffect(()=>{const E=Number(x.purchaseBillId||0);E&&Z.get(`/purchase/bills/${E}`).then(async W=>{var Y,H,M;const R=((Y=W.data)==null?void 0:Y.item)||{},U=Array.isArray((H=W.data)==null?void 0:H.details)?W.data.details:[];if(R!=null&&R.warehouse_id)b(q=>({...q,warehouseId:String(R.warehouse_id)}));else if(R!=null&&R.grn_id)try{const q=await Z.get("/purchase/grns",{params:{status:"APPROVED"}}),Q=(Array.isArray((M=q.data)==null?void 0:M.items)?q.data.items:[]).find(L=>Number(L.id)===Number(R.grn_id));Q!=null&&Q.warehouse_id&&b(L=>({...L,warehouseId:String(Q.warehouse_id)}))}catch{}const T=U.map((q,z)=>{const Q=u.find(k=>Number(k.id)===Number(q.item_id)),L=Number(h[Number((Q==null?void 0:Q.vat_on_purchase_id)||0)]||0),V=Math.round(Number(q.qty||0)*1e3)/1e3,P=Math.round(Number(q.unit_price||0)*100)/100,C=Math.round(V*P*L/100*100)/100;return{id:Date.now()+z,item_id:q.item_id?String(q.item_id):"",itemCode:(Q==null?void 0:Q.item_code)||"",itemName:(Q==null?void 0:Q.item_name)||"",qtyReturned:V,unitPrice:P,reasonCode:x.returnType||"DAMAGED",remarks:"",taxAmount:C}});T.length&&j(T)}).catch(()=>{})},[x.purchaseBillId,u,h]);const N=f.useMemo(()=>{let E=0;for(const W of y){const R=Number(W.qtyReturned||0),U=Number(W.unitPrice||0);E+=R*U}return{subTotal:E}},[y]),_=()=>{j(E=>[...E,{id:Date.now()+Math.random(),item_id:"",itemCode:"",itemName:"",qtyReturned:1,unitPrice:0,reasonCode:x.returnType||"DAMAGED",remarks:"",taxAmount:0}])},F=E=>{j(W=>W.filter(R=>R.id!==E))},I=(E,W)=>{j(R=>R.map(U=>{if(U.id!==E)return U;const T={...U,...W},Y=u.find(z=>Number(z.id)===Number(T.item_id)),H=Number(h[Number((Y==null?void 0:Y.vat_on_purchase_id)||0)]||0),M=Number(T.qtyReturned||0),q=Number(T.unitPrice||0);return T.taxAmount=Math.round(M*q*H)/100,T}))},w=async E=>{var W,R,U;E.preventDefault(),r(!0),n("");try{const T={supplier_id:Number(x.supplierId||0),warehouse_id:x.warehouseId?Number(x.warehouseId):null,return_type:x.returnType||"DAMAGED",remarks:x.remarks||null,return_date:String(x.returnDate||"").slice(0,10),items:y.filter(M=>Number(M.qtyReturned||0)>0&&Number(M.item_id||0)>0).map(M=>({item_id:Number(M.item_id),qty_returned:Number(M.qtyReturned),unit_price:Number(M.unitPrice||0),reason_code:M.reasonCode||null,remarks:M.remarks||null,tax_amount:Number(M.taxAmount)||0}))},Y=await Z.post("/purchase/returns",T);if(Number(((W=Y.data)==null?void 0:W.id)||0)){t("/inventory/purchase-returns");return}throw new Error("Save failed")}catch(T){n(((U=(R=T==null?void 0:T.response)==null?void 0:R.data)==null?void 0:U.message)||(T==null?void 0:T.message)||"Failed to save purchase return")}finally{r(!1)}};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"New Purchase Return"}),e.jsx("p",{className:"text-sm mt-1",children:"Record goods returned to supplier and auto-create a Debit Note"})]}),e.jsx(Re,{to:"/inventory/purchase-returns",className:"btn-success",children:"Back to List"})]})}),e.jsx("div",{className:"card-body p-6",children:e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[a?e.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded",children:a}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Return No"}),e.jsx("input",{className:"input",value:x.returnNo,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Return Date"}),e.jsx("input",{type:"date",className:"input",value:x.returnDate,onChange:E=>b(W=>({...W,returnDate:E.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Reason for Return"}),e.jsxs("select",{className:"input",value:x.returnType,onChange:E=>b(W=>({...W,returnType:E.target.value})),children:[e.jsx("option",{value:"DAMAGED",children:"Damaged"}),e.jsx("option",{value:"INCORRECT",children:"Incorrect Supply"}),e.jsx("option",{value:"EXCESS",children:"Excess Supply"}),e.jsx("option",{value:"OTHER",children:"Other"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Supplier"}),e.jsxs("select",{className:"input",value:x.supplierId,onChange:E=>b(W=>({...W,supplierId:E.target.value})),children:[e.jsx("option",{value:"",children:"Select supplier"}),i.map(E=>e.jsx("option",{value:E.id,children:E.supplier_name},E.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Related Purchase Bill"}),e.jsx("select",{className:"input",value:x.purchaseBillId||"",onChange:E=>b(W=>({...W,purchaseBillId:E.target.value})),children:p.map(E=>e.jsx("option",{value:E.id,children:E.bill_no},E.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Warehouse"}),e.jsxs("select",{className:"input",value:x.warehouseId,onChange:E=>b(W=>({...W,warehouseId:E.target.value})),children:[e.jsx("option",{value:"",children:"None / Branch-level"}),o.map(E=>e.jsx("option",{value:E.id,children:E.warehouse_name||E.warehouse_code},E.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Remarks"}),e.jsx("input",{type:"text",className:"input",placeholder:"Reason for rejection / notes",value:x.remarks,onChange:E=>b(W=>({...W,remarks:E.target.value}))})]})]}),e.jsxs("div",{className:"rounded-lg border bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsx("div",{className:"font-medium",children:"Return Items"}),e.jsxs("button",{type:"button",className:"btn btn-primary btn-sm",onClick:_,children:[e.jsx(Ec,{className:"w-4 h-4 mr-1"})," Add Line"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:280},children:"Item"}),e.jsx("th",{className:"text-right",style:{width:130},children:"Qty"}),e.jsx("th",{className:"text-right",style:{width:150},children:"Unit Price"}),e.jsx("th",{className:"text-right",style:{width:150},children:"Tax"}),e.jsx("th",{style:{width:180},children:"Reason"}),e.jsx("th",{children:"Remarks"}),e.jsx("th",{style:{width:60}})]})}),e.jsx("tbody",{children:y.map(E=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("select",{className:"input",value:E.item_id,onChange:W=>{const R=Number(W.target.value||0),U=u.find(T=>Number(T.id)===R);I(E.id,{item_id:R,itemCode:(U==null?void 0:U.item_code)||"",itemName:(U==null?void 0:U.item_name)||"",unitPrice:(U==null?void 0:U.cost_price)!=null?Number(U.cost_price):E.unitPrice})},children:[e.jsx("option",{value:"",children:"Select item"}),u.map(W=>e.jsxs("option",{value:W.id,children:[W.item_name," (",W.item_code,")"]},W.id))]})}),e.jsx("td",{className:"text-right",children:e.jsx("input",{type:"number",className:"input text-right",value:E.qtyReturned,min:"0",step:"1",onChange:W=>I(E.id,{qtyReturned:Number(W.target.value||0)})})}),e.jsx("td",{className:"text-right",children:e.jsx("input",{type:"number",className:"input text-right",value:E.unitPrice,min:"0",step:"0.01",onChange:W=>I(E.id,{unitPrice:Number(W.target.value||0)})})}),e.jsx("td",{className:"text-right",children:e.jsx("input",{type:"number",className:"input text-right",value:Number(E.taxAmount||0).toFixed(2),min:"0",step:"0.01",readOnly:!0})}),e.jsx("td",{children:e.jsxs("select",{className:"input",value:E.reasonCode,onChange:W=>I(E.id,{reasonCode:W.target.value}),children:[e.jsx("option",{value:"DAMAGED",children:"Damaged"}),e.jsx("option",{value:"INCORRECT",children:"Incorrect Supply"}),e.jsx("option",{value:"EXCESS",children:"Excess Supply"}),e.jsx("option",{value:"OTHER",children:"Other"})]})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input",value:E.remarks,onChange:W=>I(E.id,{remarks:W.target.value})})}),e.jsx("td",{className:"text-center",children:e.jsx("button",{type:"button",className:"btn btn-danger btn-sm",onClick:()=>F(E.id),children:e.jsx(ol,{className:"w-4 h-4"})})})]},E.id))})]})}),e.jsx("div",{className:"p-4 flex justify-end gap-6",children:e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Sub Total"}),e.jsx("div",{className:"text-lg font-bold",children:N.subTotal.toFixed(2)})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/inventory/purchase-returns",className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:s,children:s?"Saving...":"Save Purchase Return"})]})]})})]})})}function Hee({title:t,description:s}){return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg",children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:t}),s?e.jsx("p",{className:"text-sm mt-1",children:s}):null]}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"text-sm",children:"This page is ready to be implemented."})})]})}function qee(){const[t,s]=Is.useState([{rbac_key:"items-tracked",value:"45",label:"Items Tracked",change:"5 critical",changeType:"negative",path:"/inventory/reports"},{rbac_key:"pending-requisitions",value:"12",label:"Pending Requisitions",change:"3 urgent",changeType:"neutral",path:"/inventory/material-requisitions"},{rbac_key:"incoming-transfers",value:"8",label:"Incoming Transfers",change:"Expected today",changeType:"positive",path:"/inventory/transfer-acceptance"}]);Is.useEffect(()=>{let a=!0;async function n(){var i,l,o,d,u,c,h,m,p;try{const g=await Z.get("/bi/dashboards"),x=Number(((o=(l=(i=g==null?void 0:g.data)==null?void 0:i.summary)==null?void 0:l.inventory)==null?void 0:o.items)||0),b=Number(((c=(u=(d=g==null?void 0:g.data)==null?void 0:d.summary)==null?void 0:u.inventory)==null?void 0:c.pending_requisitions)||0),y=Number(((p=(m=(h=g==null?void 0:g.data)==null?void 0:h.summary)==null?void 0:m.inventory)==null?void 0:p.incoming_transfers)||0);a&&s(j=>{const N=[...j];return N[0]={...N[0],value:String(x)},N[1]={...N[1],value:String(b)},N[2]={...N[2],value:String(y)},N})}catch{}}return n(),()=>{a=!1}},[]);const r=[{title:"Stock Operations",features:[{name:"Material Requisition",path:"/inventory/material-requisitions",description:"Request materials from warehouse",icon:""},{name:"Stock Upload",path:"/inventory/stock-upload",description:"Bulk update stock via Excel",icon:""},{name:"Stock Updation",path:"/inventory/stock-updation",description:"Update stock levels",icon:""},{name:"Stock Verification",path:"/inventory/stock-verification",description:"Verify stock balances",icon:""},{name:"Return to Stores Advice",path:"/inventory/return-to-stores",description:"Return unused materials",icon:""},{name:"Stock Adjustment",path:"/inventory/stock-adjustments",description:"Adjust stock quantities",icon:""},{name:"Issue to Requirement Area",path:"/inventory/issue-to-requirement",description:"Issue materials to departments",icon:""}]},{title:"Stock Movements",features:[{name:"Warehouse Stock Transfer",path:"/inventory/stock-transfers",description:"Transfer stock between warehouses/branches",icon:""},{name:"Transfer Acceptance",path:"/inventory/transfer-acceptance",description:"Receive transferred stock",icon:""},{name:"Stock Reorder",path:"/inventory/stock-reorder",description:"Manage reorder points",icon:""}]},{title:"Stock Count",features:[{name:"Daily Stock Take",path:"/inventory/stock-take",description:"Perform physical stock counts",icon:""}]},{title:"Goods Receipt",features:[{name:"Material Receipt (GRN) - Local",path:"/inventory/grn-local",description:"Receive local purchases",icon:""},{name:"Material Receipt (GRN) - Import",path:"/inventory/grn-import",description:"Receive import purchases",icon:""}]},{title:"Returns",features:[{name:"Sales Return",path:"/inventory/sales-returns",description:"Process customer returns",icon:""},{name:"Purchase Return",path:"/inventory/purchase-returns",description:"Return goods to suppliers",icon:""}]},{title:"Master Data Setup",features:[{name:"Items Setup",path:"/inventory/items",description:"Configure items with barcodes",icon:""},{name:"Item Groups & Sub Groups",path:"/inventory/item-groups",description:"Organize items by categories",icon:""},{name:"Unit Conversion",path:"/inventory/unit-conversions",description:"Define unit conversions",icon:""},{name:"Warehouse Setup",path:"/inventory/warehouses",description:"Configure warehouses",icon:""}]},{title:"Reports",features:[{name:"Inventory Reports",path:"/inventory/reports",description:"Stock reports and analytics",icon:""},{name:"Health Monitor",path:"/inventory/reports/health-monitor",description:"Low stock and coverage analysis",icon:""},{name:"Periodical Stock Summary",path:"/inventory/reports/periodical-stock-summary",description:"Summary of movements by period",icon:""},{name:"Periodical Stock Statement",path:"/inventory/reports/periodical-stock-statement",description:"Detailed item movements by period",icon:""},{name:"Issue Register",path:"/inventory/reports/issue-register",description:"Issued items to departments/projects",icon:""},{name:"Stock Transfer Register",path:"/inventory/reports/stock-transfer-register",description:"Transfers between warehouses",icon:""},{name:"Stock Verification",path:"/inventory/reports/stock-verification",description:"Verification variances by item",icon:""},{name:"Stock Aging Analysis",path:"/inventory/reports/stock-aging-analysis",description:"Age buckets and holding",icon:""},{name:"Slow Moving Items",path:"/inventory/reports/slow-moving",description:"Low turnover items",icon:""},{name:"Fast Moving Items",path:"/inventory/reports/fast-moving",description:"High turnover items",icon:""},{name:"Non Moving Items",path:"/inventory/reports/non-moving",description:"No movement in period",icon:""}]}];return e.jsx(lo,{title:"Inventory Management",description:"Stock management, warehouse operations, and inventory control",stats:t,sections:r,features:Vee})}function $ee(){return e.jsxs(hl,{children:[e.jsx(tt,{index:!0,element:e.jsx(qee,{})}),e.jsx(tt,{path:"material-requisitions",element:e.jsx(see,{})}),e.jsx(tt,{path:"material-requisitions/:id",element:e.jsx(ree,{})}),e.jsx(tt,{path:"stock-updation",element:e.jsx(bee,{})}),e.jsx(tt,{path:"stock-verification",element:e.jsx(jee,{})}),e.jsx(tt,{path:"stock-updation/:id",element:e.jsx(yee,{})}),e.jsx(tt,{path:"stock-verification/:id",element:e.jsx(Nee,{})}),e.jsx(tt,{path:"return-to-stores",element:e.jsx(wee,{})}),e.jsx(tt,{path:"return-to-stores/new",element:e.jsx(cC,{})}),e.jsx(tt,{path:"return-to-stores/:id",element:e.jsx(cC,{})}),e.jsx(tt,{path:"stock-adjustments",element:e.jsx(ZZ,{})}),e.jsx(tt,{path:"stock-adjustments/new",element:e.jsx(iC,{})}),e.jsx(tt,{path:"stock-adjustments/:id",element:e.jsx(iC,{})}),e.jsx(tt,{path:"issue-to-requirement",element:e.jsx(_ee,{})}),e.jsx(tt,{path:"issue-to-requirement/new",element:e.jsx(dC,{})}),e.jsx(tt,{path:"issue-to-requirement/:id",element:e.jsx(dC,{})}),e.jsx(tt,{path:"stock-transfers",element:e.jsx(eee,{})}),e.jsx(tt,{path:"stock-transfers/:id",element:e.jsx(tee,{})}),e.jsx(tt,{path:"transfer-acceptance",element:e.jsx(mee,{})}),e.jsx(tt,{path:"transfer-acceptance/:id",element:e.jsx(hee,{})}),e.jsx(tt,{path:"stock-reorder",element:e.jsx(Cee,{})}),e.jsx(tt,{path:"stock-upload",element:e.jsx(kee,{})}),e.jsx(tt,{path:"alerts/low-stock",element:e.jsx(Oee,{})}),e.jsx(tt,{path:"stock-take",element:e.jsx(Aee,{})}),e.jsx(tt,{path:"stock-take/:id",element:e.jsx(fee,{})}),e.jsx(tt,{path:"grn-local",element:e.jsx(oee,{})}),e.jsx(tt,{path:"grn-local/:id",element:e.jsx(cee,{})}),e.jsx(tt,{path:"grn-import",element:e.jsx(dee,{})}),e.jsx(tt,{path:"grn-import/:id",element:e.jsx(uee,{})}),e.jsx(tt,{path:"sales-returns",element:e.jsx(lF,{})}),e.jsx(tt,{path:"sales-returns/new",element:e.jsx(See,{})}),e.jsx(tt,{path:"purchase-returns",element:e.jsx(Mee,{})}),e.jsx(tt,{path:"purchase-returns/new",element:e.jsx(Qee,{})}),e.jsx(tt,{path:"items",element:e.jsx(aee,{})}),e.jsx(tt,{path:"items/:id",element:e.jsx(nee,{})}),e.jsx(tt,{path:"item-groups",element:e.jsx(pee,{})}),e.jsx(tt,{path:"item-groups/:id",element:e.jsx(xee,{})}),e.jsx(tt,{path:"unit-conversions",element:e.jsx(gee,{})}),e.jsx(tt,{path:"unit-conversions/:id",element:e.jsx(vee,{})}),e.jsx(tt,{path:"warehouses",element:e.jsx(iee,{})}),e.jsx(tt,{path:"warehouses/:id",element:e.jsx(lee,{})}),e.jsx(tt,{path:"reports",element:e.jsx(Hee,{title:"Inventory Reports",description:"Stock reports and analytics"})}),e.jsx(tt,{path:"reports/health-monitor",element:e.jsx(Eee,{})}),e.jsx(tt,{path:"reports/periodical-stock-summary",element:e.jsx(Bee,{})}),e.jsx(tt,{path:"reports/periodical-stock-statement",element:e.jsx(Fee,{})}),e.jsx(tt,{path:"reports/issue-register",element:e.jsx(Tee,{})}),e.jsx(tt,{path:"reports/stock-transfer-register",element:e.jsx(Iee,{})}),e.jsx(tt,{path:"reports/stock-verification",element:e.jsx(Lee,{})}),e.jsx(tt,{path:"reports/stock-aging-analysis",element:e.jsx(Dee,{})}),e.jsx(tt,{path:"reports/slow-moving",element:e.jsx(Pee,{})}),e.jsx(tt,{path:"reports/fast-moving",element:e.jsx(Uee,{})}),e.jsx(tt,{path:"reports/non-moving",element:e.jsx(Ree,{})}),e.jsx(tt,{path:"*",element:e.jsx(dd,{to:"/inventory",replace:!0})})]})}const Vee=[{module_key:"inventory",label:"Material Requisition",path:"/inventory/material-requisitions",type:"feature"},{module_key:"inventory",label:"Stock Upload",path:"/inventory/stock-upload",type:"feature"},{module_key:"inventory",label:"Stock Updation",path:"/inventory/stock-updation",type:"feature"},{module_key:"inventory",label:"Stock Verification",path:"/inventory/stock-verification",type:"feature"},{module_key:"inventory",label:"Return to Stores Advice",path:"/inventory/return-to-stores",type:"feature"},{module_key:"inventory",label:"Stock Adjustment",path:"/inventory/stock-adjustments",type:"feature"},{module_key:"inventory",label:"Issue to Requirement Area",path:"/inventory/issue-to-requirement",type:"feature"},{module_key:"inventory",label:"Warehouse Stock Transfer",path:"/inventory/stock-transfers",type:"feature"},{module_key:"inventory",label:"Transfer Acceptance",path:"/inventory/transfer-acceptance",type:"feature"},{module_key:"inventory",label:"Stock Reorder",path:"/inventory/stock-reorder",type:"feature"},{module_key:"inventory",label:"Daily Stock Take",path:"/inventory/stock-take",type:"feature"},{module_key:"inventory",label:"Material Receipt (GRN) - Local",path:"/inventory/grn-local",type:"feature"},{module_key:"inventory",label:"Material Receipt (GRN) - Import",path:"/inventory/grn-import",type:"feature"},{module_key:"inventory",label:"Sales Return",path:"/inventory/sales-returns",type:"feature"},{module_key:"inventory",label:"Purchase Return",path:"/inventory/purchase-returns",type:"feature"},{module_key:"inventory",label:"Items Setup",path:"/inventory/items",type:"feature"},{module_key:"inventory",label:"Item Groups & Sub Groups",path:"/inventory/item-groups",type:"feature"},{module_key:"inventory",label:"Unit Conversion",path:"/inventory/unit-conversions",type:"feature"},{module_key:"inventory",label:"Warehouse Setup",path:"/inventory/warehouses",type:"feature"},{module_key:"inventory",label:"Inventory Reports",path:"/inventory/reports",type:"dashboard"},{module_key:"inventory",label:"Health Monitor",path:"/inventory/reports/health-monitor",type:"dashboard"},{module_key:"inventory",label:"Periodical Stock Summary",path:"/inventory/reports/periodical-stock-summary",type:"dashboard"},{module_key:"inventory",label:"Periodical Stock Statement",path:"/inventory/reports/periodical-stock-statement",type:"dashboard"},{module_key:"inventory",label:"Issue Register",path:"/inventory/reports/issue-register",type:"dashboard"},{module_key:"inventory",label:"Stock Transfer Register",path:"/inventory/reports/stock-transfer-register",type:"dashboard"},{module_key:"inventory",label:"Stock Verification",path:"/inventory/reports/stock-verification",type:"dashboard"},{module_key:"inventory",label:"Stock Aging Analysis",path:"/inventory/reports/stock-aging-analysis",type:"dashboard"},{module_key:"inventory",label:"Slow Moving Items",path:"/inventory/reports/slow-moving",type:"dashboard"},{module_key:"inventory",label:"Fast Moving Items",path:"/inventory/reports/fast-moving",type:"dashboard"},{module_key:"inventory",label:"Non Moving Items",path:"/inventory/reports/non-moving",type:"dashboard"}];function Wee(){const[t,s]=f.useState(""),[r,a]=f.useState("ALL"),[n,i]=f.useState([]),[l,o]=f.useState(!1),[d,u]=f.useState("");f.useEffect(()=>{let m=!0;return o(!0),u(""),Z.get("/purchase/rfqs").then(p=>{var g;m&&i(Array.isArray((g=p.data)==null?void 0:g.items)?p.data.items:[])}).catch(p=>{var g,x;m&&u(((x=(g=p==null?void 0:p.response)==null?void 0:g.data)==null?void 0:x.message)||"Failed to load RFQs")}).finally(()=>{m&&o(!1)}),()=>{m=!1}},[]);const c=m=>({DRAFT:"badge-neutral",SENT:"badge-info",EXPIRED:"badge-error",CLOSED:"badge-success"})[m]||"badge-info",h=f.useMemo(()=>n.filter(m=>{const p=String(m.rfq_no||"").toLowerCase().includes(t.toLowerCase())||String(m.delivery_terms||"").toLowerCase().includes(t.toLowerCase()),g=r==="ALL"||m.status===r;return p&&g}),[n,t,r]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Request for Quotation (RFQ)"}),e.jsx("p",{className:"text-sm mt-1",children:"Create and send RFQs to suppliers for competitive bidding"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/purchase",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/purchase/rfqs/new",className:"btn-success",children:"+ New RFQ"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by RFQ no or delivery terms...",className:"input",value:t,onChange:m=>s(m.target.value)})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs("select",{className:"input",value:r,onChange:m=>a(m.target.value),children:[e.jsx("option",{value:"ALL",children:"All Status"}),e.jsx("option",{value:"DRAFT",children:"Draft"}),e.jsx("option",{value:"SENT",children:"Sent"}),e.jsx("option",{value:"EXPIRED",children:"Expired"}),e.jsx("option",{value:"CLOSED",children:"Closed"})]})})]})}),e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"RFQ No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Expiry Date"}),e.jsx("th",{children:"Delivery Terms"}),e.jsx("th",{children:"Suppliers"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[l?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):d?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-8 text-red-600",children:d})}):null,h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No RFQs found"})}):h.map(m=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:m.rfq_no}),e.jsx("td",{children:new Date(m.rfq_date).toLocaleDateString()}),e.jsx("td",{children:m.expiry_date?new Date(m.expiry_date).toLocaleDateString():"-"}),e.jsx("td",{children:m.delivery_terms||"-"}),e.jsx("td",{children:m.supplier_count||0}),e.jsx("td",{children:e.jsx("span",{className:`badge ${c(m.status)}`,children:m.status})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:`/purchase/rfqs/${m.id}`,className:"text-brand hover:text-brand-600 dark:text-brand-300 dark:hover:text-brand-200 text-sm font-medium",children:"View"}),e.jsx(Re,{to:`/purchase/rfqs/${m.id}/edit`,className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-medium",children:"Edit"})]})})]},m.id))]})]})}),e.jsx("div",{className:"card-body border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{children:["Showing ",h.length," of ",n.length," ","RFQs"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-success px-3 py-1.5",disabled:!0,children:"Previous"}),e.jsx("button",{className:"btn-success px-3 py-1.5",disabled:!0,children:"Next"})]})]})})]})]})}function Wb(){const{id:t}=Ps(),s=ps(),r=!!t&&t!=="new",[a,n]=f.useState(!1),[i,l]=f.useState(!1),[o,d]=f.useState(""),[u,c]=f.useState({rfq_no:"",rfq_date:Eh(new Date,"yyyy-MM-dd"),expiry_date:"",status:"DRAFT",delivery_terms:"FOB",terms_conditions:`1. Price validity: 30 days from quote date
2. Delivery: As per agreed schedule
3. Payment terms: Net 30 days
4. Quality standards must be met
5. All prices should be quoted in GHS`}),[h,m]=f.useState([]),[p,g]=f.useState([]),[x,b]=f.useState([]),[y,j]=f.useState([]),[N,_]=f.useState([]),[F,I]=f.useState(!1),[w,E]=f.useState(""),W=f.useRef(null),[R,U]=f.useState("");f.useEffect(()=>{T()},[]),f.useEffect(()=>{r&&Y()},[t,r]),f.useEffect(()=>{r||Z.get("/purchase/rfqs/next-no").then(B=>{var G;(G=B.data)!=null&&G.nextNo&&c(O=>({...O,rfq_no:B.data.nextNo}))}).catch(B=>console.error("Failed to load next RFQ number",B))},[r]);const T=async()=>{try{const[B,G,O]=await Promise.all([Z.get("/purchase/suppliers?active=true"),Z.get("/inventory/items"),Z.get("/inventory/uoms")]);b(B.data.items||[]),j(G.data.items||[]),_(O.data.items||[])}catch(B){console.error("Failed to load dependencies",B)}},Y=async()=>{var B,G;n(!0);try{const O=await Z.get(`/purchase/rfqs/${t}`),{item:K,items:J,suppliers:te}=O.data;c({rfq_no:K.rfq_no,rfq_date:K.rfq_date?Eh(new Date(K.rfq_date),"yyyy-MM-dd"):"",expiry_date:K.expiry_date?Eh(new Date(K.expiry_date),"yyyy-MM-dd"):"",status:K.status,delivery_terms:K.delivery_terms||"FOB",terms_conditions:K.terms_conditions||""}),m(J.map(se=>({...se,required_date:se.required_date?Eh(new Date(se.required_date),"yyyy-MM-dd"):""}))),g(te.map(se=>({id:se.supplier_id,supplier_name:se.supplier_name,email:se.email,phone:se.phone})))}catch(O){d(((G=(B=O==null?void 0:O.response)==null?void 0:B.data)==null?void 0:G.message)||"Failed to load RFQ")}finally{n(!1)}},H=B=>{const{id:G,value:O}=B.target;c(K=>({...K,[G]:O}))},M=(B,G,O)=>{const K=[...h];K[B]={...K[B],[G]:O},m(K)},q=(B,G)=>{const O=y.find(K=>K.id===Number(G));if(O){const K=[...h];K[B]={...K[B],item_id:O.id,item_name:O.item_name,uom:O.uom||"PCS"},m(K)}},z=()=>{m([...h,{item_name:"",qty:0,uom:"PCS",required_date:"",specifications:""}])},Q=B=>{m(h.filter((G,O)=>O!==B))},L=B=>{const G=p.find(O=>O.id===B.id);g(G?p.filter(O=>O.id!==B.id):[...p,B])},V=f.useMemo(()=>w?x.filter(B=>B.supplier_name.toLowerCase().includes(w.toLowerCase())||B.email&&B.email.toLowerCase().includes(w.toLowerCase())):x,[x,w]),P=()=>{window.print()},C=async()=>{const B=W.current;if(!B)return;const G=B.style.cssText;B.style.cssText=G+";position:fixed;left:-10000px;top:0;display:block;z-index:-1;background:white;width:794px;padding:32px;";try{const O=await wi(B,{scale:2,useCORS:!0}),K=O.toDataURL("image/png"),J=new hs("p","mm","a4"),te=J.internal.pageSize.getWidth(),se=J.internal.pageSize.getHeight(),ae=te,ne=O.height*ae/O.width;let ue=0;for(;ue<ne;)J.addImage(K,"PNG",0,-ue,ae,ne),ue+=se,ue<ne&&J.addPage();const oe="RFQ_"+(u.rfq_no||new Date().toISOString().slice(0,10))+".pdf";J.save(oe)}finally{B.style.cssText=G}},k=async(B=null)=>{var O,K;if(!u.rfq_date){alert("RFQ Date is required");return}if(h.length===0){alert("Please add at least one item to the RFQ");return}if(h.filter(J=>!J.item_name||!J.qty||Number(J.qty)<=0).length>0){alert("All items must have a name and quantity greater than 0");return}l(!0);try{const J={...u,rfq_no:u.rfq_no||null,status:B||u.status,items:h,supplier_ids:p.map(te=>te.id)};r?await Z.put(`/purchase/rfqs/${t}`,J):(await Z.post("/purchase/rfqs",J)).data.id,B&&c(te=>({...te,status:B})),U("RFQ Saved Successfully"),setTimeout(()=>{s("/purchase/rfqs")},1e3)}catch(J){console.error(J),alert(((K=(O=J==null?void 0:J.response)==null?void 0:O.data)==null?void 0:K.message)||"Failed to save RFQ")}finally{l(!1)}};return a?e.jsx("div",{className:"p-4",children:"Loading..."}):o?e.jsxs("div",{className:"p-4 text-red-600",children:["Error: ",o]}):e.jsxs("div",{className:"max-w-7xl mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"print:hidden",children:[R&&e.jsx("div",{className:"mb-3 p-3 rounded border border-green-300 bg-green-100 text-green-700",children:R}),e.jsxs("div",{className:"bg-gradient-to-r from-[#0E3646] to-[#1a5570] p-6 rounded-xl text-white shadow-lg",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx("span",{children:""})," Request for Quotation (RFQ)"]}),e.jsx("p",{className:"opacity-90 text-sm mt-1",children:"Create and send RFQs to suppliers for competitive bidding"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 bg-gray-50 p-4 rounded-lg border border-gray-200",children:[e.jsx("button",{onClick:()=>I(!0),className:"px-4 py-2 bg-[#17a2b8] text-white rounded hover:bg-cyan-700 transition flex items-center gap-2",children:" Select Suppliers"}),e.jsx("button",{onClick:()=>s("/purchase/rfqs"),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition flex items-center gap-2 ml-auto",children:" View List"}),e.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[e.jsxs("button",{onClick:C,className:"flex items-center gap-2 px-3 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition text-sm",children:[e.jsx(Cc,{className:"w-4 h-4"}),"Download PDF"]}),e.jsxs("button",{onClick:P,className:"flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition text-sm",children:[e.jsx(tA,{className:"w-4 h-4"}),"Print"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 space-y-6",children:[e.jsxs("section",{children:[e.jsx("div",{className:"flex items-center gap-2 border-b-2 border-[#0E3646] pb-2 mb-4",children:e.jsx("h2",{className:"text-lg font-semibold text-[#0E3646]",children:" RFQ Information"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-semibold text-[#0E3646]",children:"RFQ Number"}),e.jsx("input",{type:"text",value:u.rfq_no,readOnly:!0,className:"p-2 border border-gray-300 rounded bg-gray-100 text-gray-600"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-semibold text-[#0E3646] after:content-['*'] after:text-red-500",children:"RFQ Date"}),e.jsx("input",{type:"date",id:"rfq_date",value:u.rfq_date,onChange:H,className:"p-2 border border-gray-300 rounded focus:ring-2 focus:ring-[#0E3646] focus:border-transparent outline-none"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-semibold text-[#0E3646]",children:"Expiry Date"}),e.jsx("input",{type:"date",id:"expiry_date",value:u.expiry_date,onChange:H,className:"p-2 border border-gray-300 rounded focus:ring-2 focus:ring-[#0E3646] focus:border-transparent outline-none"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-semibold text-[#0E3646]",children:"Status"}),e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-bold w-fit ${u.status==="SENT"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:u.status})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-semibold text-[#0E3646]",children:"Delivery Terms"}),e.jsxs("select",{id:"delivery_terms",value:u.delivery_terms,onChange:H,className:"p-2 border border-gray-300 rounded focus:ring-2 focus:ring-[#0E3646] focus:border-transparent outline-none",children:[e.jsx("option",{value:"FOB",children:"FOB - Free on Board"}),e.jsx("option",{value:"CIF",children:"CIF - Cost, Insurance & Freight"}),e.jsx("option",{value:"EXW",children:"EXW - Ex Works"}),e.jsx("option",{value:"DDP",children:"DDP - Delivered Duty Paid"})]})]}),e.jsxs("div",{className:"col-span-1 md:col-span-2 lg:col-span-2 flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-semibold text-[#0E3646]",children:"Terms & Conditions"}),e.jsx("textarea",{id:"terms_conditions",value:u.terms_conditions,onChange:H,rows:"3",className:"p-2 border border-gray-300 rounded focus:ring-2 focus:ring-[#0E3646] focus:border-transparent outline-none",placeholder:"Enter terms and conditions..."})]})]})]}),e.jsxs("section",{children:[e.jsx("div",{className:"flex items-center gap-2 border-b-2 border-[#0E3646] pb-2 mb-4",children:e.jsxs("h2",{className:"text-lg font-semibold text-[#0E3646]",children:[" Selected Suppliers (",p.length,")"]})}),p.length===0?e.jsx("div",{className:"text-center p-8 bg-gray-50 rounded border border-dashed border-gray-300 text-gray-500",children:'No suppliers selected. Click "Select Suppliers" to add.'}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:p.map(B=>e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded p-4 relative hover:border-[#0E3646] transition group",children:[e.jsx("button",{onClick:()=>L(B),className:"absolute top-2 right-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition",children:""}),e.jsxs("div",{className:"font-semibold text-[#0E3646]",children:[B.supplier_name,B.supplier_code&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",B.supplier_code,")"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2 space-y-1",children:[B.contact_person&&e.jsxs("div",{className:"flex items-center gap-2",children:[" ",B.contact_person]}),e.jsxs("div",{className:"flex items-center gap-2",children:[" ",B.email||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[" ",B.phone||"N/A"]})]})]},B.id))})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h2",{className:"text-lg font-semibold text-[#0E3646]",children:" RFQ Items"})}),e.jsx("button",{onClick:z,className:"px-3 py-1 bg-[#0E3646] text-white text-sm rounded hover:bg-[#082330] transition",children:" Add Item"})]}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-[#0E3646] text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 w-12",children:"#"}),e.jsx("th",{className:"p-3",children:"Item Name"}),e.jsx("th",{className:"p-3 w-32",children:"Quantity"}),e.jsx("th",{className:"p-3 w-24",children:"UOM"}),e.jsx("th",{className:"p-3 w-40",children:"Required Date"}),e.jsx("th",{className:"p-3 w-64",children:"Specifications"}),e.jsx("th",{className:"p-3 w-20",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"p-8 text-center text-gray-500",children:'No items added. Click "Add Item" to start.'})}):h.map((B,G)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsx("td",{className:"p-3",children:G+1}),e.jsx("td",{className:"p-3",children:e.jsxs("select",{value:B.item_id||"",onChange:O=>q(G,O.target.value),className:"w-full p-1 border border-gray-300 rounded focus:ring-2 focus:ring-[#0E3646] focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Select Item"}),y.map(O=>e.jsxs("option",{value:O.id,children:[O.item_name," (",O.item_code,")"]},O.id))]})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",value:B.qty,onChange:O=>M(G,"qty",O.target.value),className:"w-full p-1 border border-gray-300 rounded"})}),e.jsx("td",{className:"p-3",children:e.jsxs("select",{value:B.uom||"",onChange:O=>M(G,"uom",O.target.value),className:"w-full p-1 border border-gray-300 rounded focus:ring-2 focus:ring-[#0E3646] focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Select UOM"}),N.map(O=>e.jsxs("option",{value:O.uom_code,children:[O.uom_name," (",O.uom_code,")"]},O.id))]})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"date",value:B.required_date||"",onChange:O=>M(G,"required_date",O.target.value),className:"w-full p-1 border border-gray-300 rounded"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"text",value:B.specifications||"",onChange:O=>M(G,"specifications",O.target.value),className:"w-full p-1 border border-gray-300 rounded"})}),e.jsx("td",{className:"p-3",children:e.jsx("button",{onClick:()=>Q(G),className:"text-red-500 hover:bg-red-50 p-1 rounded transition",children:""})})]},G))})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{window.confirm("Are you sure? Unsaved changes will be lost.")&&(m([]),g([]),c(B=>({...B,terms_conditions:""})))},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition",children:" Clear"}),e.jsx("button",{onClick:()=>k("DRAFT"),disabled:i,className:"px-4 py-2 bg-[#0E3646] text-white rounded hover:bg-[#082330] transition disabled:opacity-50",children:i?"Saving...":" Save as Draft"}),e.jsx("button",{onClick:()=>k("SENT"),disabled:i,className:"px-4 py-2 bg-[#28a745] text-white rounded hover:bg-green-700 transition disabled:opacity-50",children:i?"Sending...":" Send RFQ to Suppliers"})]})]}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 bg-[#0E3646] text-white rounded-t-xl flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Select Suppliers"}),e.jsx("button",{onClick:()=>I(!1),className:"text-white hover:bg-white/10 w-8 h-8 rounded flex items-center justify-center text-xl",children:""})]}),e.jsxs("div",{className:"p-6 flex-1 overflow-y-auto",children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:" Search suppliers...",value:w,onChange:B=>E(B.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0E3646] outline-none"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[V.map(B=>{const G=p.some(O=>O.id===B.id);return e.jsx("div",{onClick:()=>L(B),className:`
                        border-2 rounded-lg p-4 cursor-pointer transition
                        ${G?"border-[#0E3646] bg-blue-50":"border-gray-200 hover:border-blue-300"}
                      `,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`
                          w-5 h-5 rounded border flex items-center justify-center mt-1
                          ${G?"bg-[#0E3646] border-[#0E3646]":"border-gray-400 bg-white"}
                        `,children:G&&e.jsx("span",{className:"text-white text-xs",children:""})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-[#0E3646]",children:[B.supplier_name,B.supplier_code&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2 font-normal",children:["(",B.supplier_code,")"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1 space-y-1",children:[B.contact_person&&e.jsxs("div",{className:"flex items-center gap-2",children:[" ",B.contact_person]}),e.jsxs("div",{className:"flex items-center gap-2",children:[" ",B.email||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[" ",B.phone||"N/A"]})]})]})]})},B.id)}),V.length===0&&e.jsxs("div",{className:"col-span-full text-center py-8 text-gray-500",children:['No suppliers found matching "',w,'"']})]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 flex justify-end gap-3 bg-gray-50 rounded-b-xl",children:e.jsx("button",{onClick:()=>I(!1),className:"px-6 py-2 bg-[#0E3646] text-white rounded hover:bg-[#082330] transition font-medium",children:"Done"})})]})})]}),e.jsxs("div",{className:"hidden print:block p-8 max-w-[19cm] mx-auto bg-white border border-gray-300",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-semibold text-[#0E3646]",children:"Request for Quotation"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["RFQ Number: ",u.rfq_no||""]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-700",children:[e.jsxs("div",{children:["Date: ",u.rfq_date||""]}),e.jsxs("div",{children:["Expiry Date: ",u.expiry_date||""]}),e.jsxs("div",{children:["Status: ",u.status]}),e.jsxs("div",{children:["Delivery Terms: ",u.delivery_terms]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"font-semibold text-[#0E3646] mb-2",children:"Selected Suppliers"}),p.length===0?e.jsx("div",{className:"text-sm text-gray-600",children:"No suppliers selected."}):e.jsxs("table",{className:"w-full text-xs border border-gray-400",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-left",children:"Supplier"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-left",children:"Email"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-left",children:"Phone"})]})}),e.jsx("tbody",{children:p.map(B=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-400 px-2 py-1",children:B.supplier_name}),e.jsx("td",{className:"border border-gray-400 px-2 py-1",children:B.email||""}),e.jsx("td",{className:"border border-gray-400 px-2 py-1",children:B.phone||""})]},B.id))})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"font-semibold text-[#0E3646] mb-2",children:"RFQ Items"}),h.length===0?e.jsx("div",{className:"text-sm text-gray-600",children:"No items added."}):e.jsxs("table",{className:"w-full text-xs border border-gray-400",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-left",children:"#"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-left",children:"Item"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-right",children:"Qty"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-left",children:"UOM"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-left",children:"Required Date"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-left",children:"Specifications"})]})}),e.jsx("tbody",{children:h.map((B,G)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-400 px-2 py-1",children:G+1}),e.jsx("td",{className:"border border-gray-400 px-2 py-1",children:B.item_name||""}),e.jsx("td",{className:"border border-gray-400 px-2 py-1 text-right",children:B.qty||""}),e.jsx("td",{className:"border border-gray-400 px-2 py-1",children:B.uom||""}),e.jsx("td",{className:"border border-gray-400 px-2 py-1",children:B.required_date||""}),e.jsx("td",{className:"border border-gray-400 px-2 py-1",children:B.specifications||""})]},G))})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-[#0E3646] mb-2",children:"Terms and Conditions"}),e.jsx("div",{className:"text-sm whitespace-pre-line",children:u.terms_conditions||"None"})]})]}),e.jsxs("div",{ref:W,className:"hidden p-8 bg-white",style:{width:"794px",maxWidth:"794px"},children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-semibold text-[#0E3646]",children:"Request for Quotation"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["RFQ Number: ",u.rfq_no||""]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-700",children:[e.jsxs("div",{children:["Date: ",u.rfq_date||""]}),e.jsxs("div",{children:["Expiry Date: ",u.expiry_date||""]}),e.jsxs("div",{children:["Status: ",u.status]}),e.jsxs("div",{children:["Delivery Terms: ",u.delivery_terms]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"font-semibold text-[#0E3646] mb-2",children:"Selected Suppliers"}),p.length===0?e.jsx("div",{className:"text-sm text-gray-600",children:"No suppliers selected."}):e.jsxs("table",{className:"w-full text-xs border border-gray-400",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-left",children:"Supplier"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-left",children:"Email"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-left",children:"Phone"})]})}),e.jsx("tbody",{children:p.map(B=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-400 px-2 py-1",children:B.supplier_name}),e.jsx("td",{className:"border border-gray-400 px-2 py-1",children:B.email||""}),e.jsx("td",{className:"border border-gray-400 px-2 py-1",children:B.phone||""})]},B.id))})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"font-semibold text-[#0E3646] mb-2",children:"RFQ Items"}),h.length===0?e.jsx("div",{className:"text-sm text-gray-600",children:"No items added."}):e.jsxs("table",{className:"w-full text-xs border border-gray-400",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-left",children:"#"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-left",children:"Item"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-right",children:"Qty"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-left",children:"UOM"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-left",children:"Required Date"}),e.jsx("th",{className:"border border-gray-400 px-2 py-1 text-left",children:"Specifications"})]})}),e.jsx("tbody",{children:h.map((B,G)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-400 px-2 py-1",children:G+1}),e.jsx("td",{className:"border border-gray-400 px-2 py-1",children:B.item_name||""}),e.jsx("td",{className:"border border-gray-400 px-2 py-1 text-right",children:B.qty||""}),e.jsx("td",{className:"border border-gray-400 px-2 py-1",children:B.uom||""}),e.jsx("td",{className:"border border-gray-400 px-2 py-1",children:B.required_date||""}),e.jsx("td",{className:"border border-gray-400 px-2 py-1",children:B.specifications||""})]},G))})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-[#0E3646] mb-2",children:"Terms and Conditions"}),e.jsx("div",{className:"text-sm whitespace-pre-line",children:u.terms_conditions||"None"})]})]})]})}function Gee(){const[t,s]=f.useState(""),[r,a]=f.useState("ALL"),[n,i]=f.useState([]),[l,o]=f.useState(!1),[d,u]=f.useState(""),{canPerformAction:c}=Ls();f.useEffect(()=>{let p=!0;return o(!0),u(""),Z.get("/purchase/supplier-quotations").then(g=>{var x;p&&i(Array.isArray((x=g.data)==null?void 0:x.items)?g.data.items:[])}).catch(g=>{var x,b;p&&u(((b=(x=g==null?void 0:g.response)==null?void 0:x.data)==null?void 0:b.message)||"Failed to load supplier quotations")}).finally(()=>{p&&o(!1)}),()=>{p=!1}},[]);const h=p=>({DRAFT:"badge-neutral",SUBMITTED:"badge-info",RECEIVED:"badge-info",UNDER_REVIEW:"badge-warning",ACCEPTED:"badge-success",REJECTED:"badge-error"})[p]||"badge-info",m=f.useMemo(()=>n.filter(p=>{const g=String(p.quotation_no||"").toLowerCase().includes(t.toLowerCase())||String(p.supplier_name||"").toLowerCase().includes(t.toLowerCase())||String(p.rfq_no||"").toLowerCase().includes(t.toLowerCase()),x=r==="ALL"||p.status===r;return g&&x}),[n,t,r]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Supplier Quotations"}),e.jsx("p",{className:"text-sm mt-1",children:"Receive and manage supplier quotations"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/purchase",className:"btn btn-secondary",children:"Return to Menu"}),c("purchase:supplier-quotations","create")&&e.jsx(Re,{to:"/purchase/supplier-quotations/new",className:"btn-success",children:"+ New Quotation"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by quotation no, supplier, or RFQ no...",className:"input",value:t,onChange:p=>s(p.target.value)})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs("select",{className:"input",value:r,onChange:p=>a(p.target.value),children:[e.jsx("option",{value:"ALL",children:"All Status"}),e.jsx("option",{value:"DRAFT",children:"Draft"}),e.jsx("option",{value:"SUBMITTED",children:"Submitted"}),e.jsx("option",{value:"RECEIVED",children:"Received"}),e.jsx("option",{value:"UNDER_REVIEW",children:"Under Review"}),e.jsx("option",{value:"ACCEPTED",children:"Accepted"}),e.jsx("option",{value:"REJECTED",children:"Rejected"})]})})]})}),e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Quotation No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{children:"RFQ No"}),e.jsx("th",{children:"Valid Until"}),e.jsx("th",{className:"text-right",children:"Total Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[l?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):d?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center py-8 text-red-600",children:d})}):null,m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No quotations found"})}):m.map(p=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:p.quotation_no}),e.jsx("td",{children:new Date(p.quotation_date).toLocaleDateString()}),e.jsx("td",{children:p.supplier_name}),e.jsx("td",{children:p.rfq_no}),e.jsx("td",{children:p.valid_until?new Date(p.valid_until).toLocaleDateString():""}),e.jsx("td",{className:"text-right font-medium",children:p.total_amount.toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${h(p.status)}`,children:p.status.replace("_"," ")})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[c("purchase:supplier-quotations","view")&&e.jsx(Re,{to:`/purchase/supplier-quotations/${p.id}`,className:"text-brand hover:text-brand-600 dark:text-brand-300 dark:hover:text-brand-200 text-sm font-medium",children:"View"}),c("purchase:supplier-quotations","edit")&&e.jsx(Re,{to:`/purchase/supplier-quotations/${p.id}/edit`,className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-medium",children:"Edit"})]})})]},p.id))]})]})}),e.jsx("div",{className:"card-body border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{children:["Showing ",m.length," of ",n.length," ","quotations"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-success px-3 py-1.5",disabled:!0,children:"Previous"}),e.jsx("button",{className:"btn-success px-3 py-1.5",disabled:!0,children:"Next"})]})]})})]})]})}function Gb(){const{id:t}=Ps(),s=ps(),r=!!t&&t!=="new",[a,n]=f.useState({quotation_no:"",quotation_date:new Date().toISOString().split("T")[0],supplier_id:"",rfq_id:"",valid_until:"",status:"DRAFT",remarks:"",contact_person:"",email:"",phone:"",currency:"USD",exchange_rate:1,payment_terms:"Net30",delivery_time:"",delivery_terms:"FOB",shipping_cost:0,discount_percent:0}),[i,l]=f.useState([{item_id:"",item_name:"",qty:0,unit_price:0,tax_percent:0,delivery_date:"",line_total:0}]),[o,d]=f.useState([]),[u,c]=f.useState([]),[h,m]=f.useState([]),[p,g]=f.useState([]),[x,b]=f.useState(!1),[y,j]=f.useState(!1),[N,_]=f.useState(""),[F,I]=f.useState([]),[w,E]=f.useState(!1),[W,R]=f.useState([]),[U,T]=f.useState([]),[Y,H]=f.useState(null);f.useEffect(()=>{let K=!0;async function J(){var te,se,ae,ne,ue,oe,le;try{const[X,me,we,Ie,_e]=await Promise.all([Z.get("/purchase/suppliers"),Z.get("/inventory/items"),Z.get("/purchase/rfqs"),Z.get("/finance/tax-codes"),Z.get("/finance/currencies")]);if(!K)return;d(Array.isArray((te=X.data)==null?void 0:te.items)?X.data.items:[]),m(Array.isArray((se=me.data)==null?void 0:se.items)?me.data.items:[]),c(Array.isArray((ae=we.data)==null?void 0:ae.items)?we.data.items:[]),g(Array.isArray((ne=Ie.data)==null?void 0:ne.items)?Ie.data.items:[]),T(Array.isArray((ue=_e.data)==null?void 0:ue.items)?_e.data.items:[])}catch(X){if(!K)return;_(((le=(oe=X==null?void 0:X.response)==null?void 0:oe.data)==null?void 0:le.message)||"Failed to load suppliers/items")}}return J(),()=>{K=!1}},[]),f.useEffect(()=>{if(r)return;let K=!0;return Z.get("/purchase/supplier-quotations/next-no").then(J=>{var te;K&&(te=J.data)!=null&&te.nextNo&&n(se=>({...se,quotation_no:J.data.nextNo}))}).catch(J=>console.error("Failed to load next supplier quotation number",J)),()=>{K=!1}},[r]),f.useEffect(()=>{if(!r)return;let K=!0;return b(!0),_(""),Z.get(`/purchase/supplier-quotations/${t}`).then(J=>{var ae,ne;if(!K)return;const te=(ae=J.data)==null?void 0:ae.item,se=Array.isArray((ne=J.data)==null?void 0:ne.details)?J.data.details:[];te&&(n(ue=>{const oe={...ue,quotation_no:te.quotation_no||"",quotation_date:te.quotation_date?String(te.quotation_date).split("T")[0]:new Date().toISOString().split("T")[0],supplier_id:te.supplier_id?String(te.supplier_id):"",rfq_id:te.rfq_id?String(te.rfq_id):"",valid_until:te.valid_until?String(te.valid_until).split("T")[0]:"",status:te.status||"DRAFT",remarks:te.remarks||"",exchange_rate:te.exchange_rate!==void 0&&te.exchange_rate!==null?Number(te.exchange_rate)||ue.exchange_rate||1:ue.exchange_rate||1},le=`supplierQuoteExtras:${t}`;try{const X=window.localStorage.getItem(le);if(X){const me=JSON.parse(X);me&&me.formData&&Object.assign(oe,me.formData)}}catch{}return oe}),H(te.currency_id||null),l(()=>{let ue=se.length&&se.map(le=>({item_id:le.item_id?String(le.item_id):"",item_name:le.item_name||"",qty:Number(le.qty)||0,unit_price:Number(le.unit_price)||0,tax_percent:le.tax_percent!==void 0&&le.tax_percent!==null&&Number(le.tax_percent)||0,delivery_date:le.delivery_date?String(le.delivery_date).split("T")[0]:"",line_total:Number(le.line_total)||0}));(!ue||!ue.length)&&(ue=[{item_id:"",item_name:"",qty:0,unit_price:0,tax_percent:0,delivery_date:"",line_total:0}]);const oe=`supplierQuoteExtras:${t}`;try{const le=window.localStorage.getItem(oe);if(le){const X=JSON.parse(le);if(X&&Array.isArray(X.items))return ue.map((me,we)=>({...me,...X.items[we]||{}}))}}catch{}return ue}))}).catch(J=>{var te,se;K&&_(((se=(te=J==null?void 0:J.response)==null?void 0:te.data)==null?void 0:se.message)||"Failed to load supplier quotation")}).finally(()=>{K&&b(!1)}),()=>{K=!1}},[t,r]);const M=async K=>{var ne;const J=String(K||"").toUpperCase(),te=Array.isArray(U)?U:[];if(!J||!te.length)return;const se=te.find(ue=>String(ue.is_base)==="1"||ue.is_base===1||ue.is_base===!0)||te.find(ue=>String(ue.code||ue.currency_code||"").toUpperCase()==="GHS")||te.find(ue=>/ghana|cedi/i.test(String(ue.name||ue.currency_name||""))),ae=te.find(ue=>String(ue.code||ue.currency_code||"").toUpperCase()===J);if(!se||!ae||se.id===ae.id){n(ue=>({...ue,exchange_rate:1}));return}try{const ue=a.quotation_date||new Date().toISOString().split("T")[0],oe=await Z.get("/finance/currency-rates",{params:{fromCurrencyId:ae.id,toCurrencyId:se.id,to:ue}}),X=(Array.isArray((ne=oe.data)==null?void 0:ne.items)?oe.data.items:[])[0];if(X&&X.rate)n(me=>({...me,exchange_rate:Number(X.rate)||me.exchange_rate||1}));else try{await Z.post("/finance/currency-rates",{fromCurrencyId:ae.id,toCurrencyId:se.id,rate:1,rateDate:ue}),n(me=>({...me,exchange_rate:1}))}catch{n(me=>({...me,exchange_rate:1}))}}catch{n(ue=>({...ue,exchange_rate:ue.exchange_rate||1}))}};f.useEffect(()=>{if(r&&Y&&Array.isArray(U)&&U.length){const K=U.find(J=>String(J.id)===String(Y));if(K){const J=String(K.code||K.currency_code||"").toUpperCase();n(te=>({...te,currency:J||te.currency}))}}},[r,Y,U]),f.useEffect(()=>{M(a.currency)},[U,a.currency,a.quotation_date]);const q=async K=>{var se,ae,ne;const{name:J,value:te}=K.target;if(n(ue=>({...ue,[J]:te})),J==="rfq_id"&&!te){R([]);return}if(J==="rfq_id"&&te)try{const ue=await Z.get(`/purchase/rfqs/${te}`),oe=(se=ue.data)==null?void 0:se.item,le=Array.isArray((ae=ue.data)==null?void 0:ae.items)?ue.data.items:[],X=Array.isArray((ne=ue.data)==null?void 0:ne.suppliers)?ue.data.suppliers:[];if(R(X),oe&&n(me=>{const we={...me,rfq_id:te,valid_until:oe.expiry_date||me.valid_until,delivery_terms:oe.delivery_terms||me.delivery_terms,remarks:oe.remarks||me.remarks};if(X.length===1){const Ie=X[0];we.supplier_id=String(Ie.supplier_id),we.contact_person=Ie.supplier_name||me.contact_person,we.email=Ie.email||me.email,we.phone=Ie.phone||me.phone}else X.length>1&&(we.supplier_id="",we.contact_person="",we.email="",we.phone="");return we}),le.length){const me=le.map(we=>({item_id:String(we.item_id),item_name:we.item_name||"",qty:Number(we.qty)||0,unit_price:0,tax_percent:0,delivery_date:we.required_date||"",line_total:0}));l(me)}}catch(ue){console.error("Failed to fetch RFQ details",ue)}J==="currency"&&await M(te)},z=(K,J,te)=>{const se=[...i];if(se[K][J]=te,J==="item_id"){const ae=h.find(ne=>String(ne.id)===String(te));ae&&(se[K].item_name=ae.item_name||ae.name||"")}if(J==="qty"||J==="unit_price"||J==="tax_percent"){const ae=parseFloat(se[K].qty||0),ne=parseFloat(se[K].unit_price||0);se[K].line_total=ae*ne}l(se)},Q=()=>{l([...i,{item_id:"",item_name:"",qty:0,unit_price:0,tax_percent:0,delivery_date:"",line_total:0}])},L=K=>{i.length>1&&l(i.filter((J,te)=>te!==K))},V=f.useMemo(()=>i.reduce((K,J)=>K+(parseFloat(J.line_total)||0),0),[i]),P=f.useMemo(()=>i.reduce((K,J)=>{const te=parseFloat(J.qty)||0,se=parseFloat(J.unit_price)||0,ae=parseFloat(J.tax_percent)||0,ne=te*se;return K+ne*(ae/100)},0),[i]),C=f.useMemo(()=>{const K=parseFloat(a.shipping_cost)||0,J=parseFloat(a.discount_percent)||0,te=V+P+K,se=te*(J/100);return te-se},[V,P,a.shipping_cost,a.discount_percent]);f.useMemo(()=>V,[V]);const k=async K=>{var J,te,se;K.preventDefault(),j(!0),_("");try{const ne=(Array.isArray(U)?U:[]).find(X=>String(X.code||X.currency_code||"").toUpperCase()===String(a.currency||"").toUpperCase()),ue=(ne==null?void 0:ne.id)||null,oe={quotation_no:a.quotation_no||void 0,quotation_date:a.quotation_date,supplier_id:Number(a.supplier_id),rfq_id:a.rfq_id?Number(a.rfq_id):null,valid_until:a.valid_until||null,status:a.status,remarks:a.remarks||null,currency_id:ue,exchange_rate:Number(a.exchange_rate)||1,details:i.filter(X=>X.item_id).map(X=>({item_id:Number(X.item_id),qty:Number(X.qty)||0,unit_price:Number(X.unit_price)||0,line_total:Number(X.line_total)||0})),attachments:F.map(X=>({url:X.url,filename:X.filename,note:X.note||null}))},le={formData:{contact_person:a.contact_person,email:a.email,phone:a.phone,currency:a.currency,payment_terms:a.payment_terms,delivery_time:a.delivery_time,delivery_terms:a.delivery_terms,shipping_cost:a.shipping_cost,discount_percent:a.discount_percent},items:i.map(X=>({tax_percent:X.tax_percent,delivery_date:X.delivery_date}))};if(r){await Z.put(`/purchase/supplier-quotations/${t}`,oe);const X=`supplierQuoteExtras:${t}`;window.localStorage.setItem(X,JSON.stringify(le))}else{const me=(J=(await Z.post("/purchase/supplier-quotations",oe)).data)==null?void 0:J.id;if(me){const we=`supplierQuoteExtras:${me}`;window.localStorage.setItem(we,JSON.stringify(le))}}s("/purchase/supplier-quotations")}catch(ae){_(((se=(te=ae==null?void 0:ae.response)==null?void 0:te.data)==null?void 0:se.message)||"Failed to save supplier quotation")}finally{j(!1)}},B=async K=>{var J,te,se,ae;E(!0);try{const ne=new FormData;ne.append("file",K);const ue=await Z.post("/upload",ne,{headers:{"Content-Type":"multipart/form-data"}}),oe=(J=ue.data)==null?void 0:J.url,le=((te=ue.data)==null?void 0:te.filename)||K.name;oe&&I(X=>[...X,{url:oe,filename:le}])}catch(ne){_(((ae=(se=ne==null?void 0:ne.response)==null?void 0:se.data)==null?void 0:ae.message)||"File upload failed")}finally{E(!1)}},G=async K=>{const J=Array.from(K.target.files||[]);for(const te of J)await B(te);K.target.value=""},O=K=>{I(J=>J.filter((te,se)=>se!==K))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:[r?"Edit":"New"," Supplier Quotation"]}),e.jsx("p",{className:"text-sm mt-1",children:r?"Update quotation details":"Record a new supplier quotation"})]}),e.jsx(Re,{to:"/purchase/supplier-quotations",className:"btn-success",children:"Back to List"})]}),e.jsxs("form",{onSubmit:k,children:[x?e.jsx("div",{className:"card mb-6",children:e.jsx("div",{className:"card-body",children:"Loading..."})}):null,N?e.jsx("div",{className:"card mb-6",children:e.jsx("div",{className:"card-body text-red-600",children:N})}):null,e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("h2",{className:"text-lg font-semibold text-white dark:text-slate-100",children:"Quotation Information"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Quotation No *"}),e.jsx("input",{type:"text",name:"quotation_no",className:"input",value:a.quotation_no,onChange:q,placeholder:"Auto-generated",disabled:r,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Quotation Date *"}),e.jsx("input",{type:"date",name:"quotation_date",className:"input",value:a.quotation_date,onChange:q,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Supplier *"}),e.jsxs("select",{name:"supplier_id",className:"input",value:a.supplier_id,onChange:q,disabled:W.length>1,required:!0,children:[e.jsx("option",{value:"",children:"Select Supplier"}),o.map(K=>e.jsx("option",{value:K.id,children:K.supplier_name||K.name||K.supplier_code||`Supplier #${K.id}`},K.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"RFQ No"}),e.jsxs("select",{name:"rfq_id",className:"input",value:a.rfq_id,onChange:q,children:[e.jsx("option",{value:"",children:"Select RFQ"}),u.map(K=>e.jsxs("option",{value:K.id,children:[K.rfq_no," ",K.status?`- ${K.status}`:""]},K.id))]})]}),W.length>1&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"RFQ Supplier"}),e.jsxs("select",{className:"input",value:a.supplier_id,onChange:K=>{const J=K.target.value,te=W.find(se=>String(se.supplier_id)===String(J));n(se=>({...se,supplier_id:J,contact_person:(te==null?void 0:te.supplier_name)||se.contact_person,email:(te==null?void 0:te.email)||se.email,phone:(te==null?void 0:te.phone)||se.phone}))},children:[e.jsx("option",{value:"",children:"Select Supplier from RFQ"}),W.map(K=>e.jsx("option",{value:K.supplier_id,children:K.supplier_name},K.supplier_id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Valid Until *"}),e.jsx("input",{type:"date",name:"valid_until",className:"input",value:a.valid_until,onChange:q,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{name:"status",className:"input",value:a.status,onChange:q,children:[e.jsx("option",{value:"DRAFT",children:"DRAFT"}),e.jsx("option",{value:"SUBMITTED",children:"SUBMITTED"})]})]}),e.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[e.jsx("label",{className:"label",children:"Remarks"}),e.jsx("textarea",{name:"remarks",className:"input",rows:"3",value:a.remarks,onChange:q,placeholder:"Additional notes..."})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("h2",{className:"text-lg font-semibold text-white dark:text-slate-100",children:"Supplier & Contact"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Contact Person"}),e.jsx("input",{type:"text",name:"contact_person",className:"input",value:a.contact_person,onChange:q,placeholder:"Enter contact person name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Email"}),e.jsx("input",{type:"email",name:"email",className:"input",value:a.email,onChange:q,placeholder:"email@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Phone"}),e.jsx("input",{type:"tel",name:"phone",className:"input",value:a.phone,onChange:q,placeholder:"+233-000-000-0000"})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("h2",{className:"text-lg font-semibold text-white dark:text-slate-100",children:"Terms"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsxs("select",{name:"currency",className:"input",value:a.currency,onChange:q,children:[e.jsx("option",{value:"USD",children:"USD - US Dollar"}),e.jsx("option",{value:"GHS",children:"GHS - Ghana Cedi"}),e.jsx("option",{value:"EUR",children:"EUR - Euro"}),e.jsx("option",{value:"GBP",children:"GBP - British Pound"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Exchange Rate"}),e.jsx("input",{type:"number",name:"exchange_rate",className:"input text-right",value:a.exchange_rate,onChange:q,step:"0.000001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Payment Terms"}),e.jsxs("select",{name:"payment_terms",className:"input",value:a.payment_terms,onChange:q,children:[e.jsx("option",{value:"Net30",children:"Net 30 days"}),e.jsx("option",{value:"Net60",children:"Net 60 days"}),e.jsx("option",{value:"Advance50",children:"50% Advance"}),e.jsx("option",{value:"COD",children:"Cash on Delivery"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Delivery Time"}),e.jsx("input",{type:"text",name:"delivery_time",className:"input",value:a.delivery_time,onChange:q,placeholder:"e.g., 2-3 weeks"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Delivery Terms"}),e.jsxs("select",{name:"delivery_terms",className:"input",value:a.delivery_terms,onChange:q,children:[e.jsx("option",{value:"FOB",children:"FOB"}),e.jsx("option",{value:"CIF",children:"CIF"}),e.jsx("option",{value:"EXW",children:"EXW"}),e.jsx("option",{value:"DDP",children:"DDP"})]})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-WHITE dark:text-slate-100",children:"Quotation Items"}),e.jsx("button",{type:"button",onClick:Q,className:"btn-success",children:"+ Add Item"})]})}),e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"30%"},children:"Item"}),e.jsx("th",{className:"text-right",style:{width:"10%"},children:"Quantity"}),e.jsx("th",{className:"text-right",style:{width:"15%"},children:"Unit Price"}),e.jsx("th",{className:"text-right",style:{width:"15%"},children:"Tax"}),e.jsx("th",{className:"text-right",style:{width:"15%"},children:"Line Total"}),e.jsx("th",{style:{width:"15%"},children:"Delivery Date"}),e.jsx("th",{style:{width:"10%"},children:"Action"})]})}),e.jsx("tbody",{children:i.map((K,J)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("select",{className:"input",value:K.item_id,onChange:te=>z(J,"item_id",te.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Item"}),h.map(te=>e.jsx("option",{value:te.id,children:(te.item_code||te.code||te.id)+" - "+(te.item_name||te.name||"")},te.id))]})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"input text-right",value:K.qty,onChange:te=>z(J,"qty",te.target.value),step:"1",min:"0",required:!0})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"input text-right",value:K.unit_price,onChange:te=>z(J,"unit_price",te.target.value),step:"1",min:"0",required:!0})}),e.jsx("td",{children:e.jsxs("select",{className:"input text-right",value:K.tax_percent,onChange:te=>z(J,"tax_percent",te.target.value),children:[e.jsx("option",{value:0,children:"No Tax"}),p.map(te=>e.jsxs("option",{value:te.rate_percent,children:[te.code," - ",te.name," (",Number(te.rate_percent).toFixed(2),"%)"]},te.id))]})}),e.jsx("td",{className:"text-right font-medium",children:K.line_total.toFixed(2)}),e.jsx("td",{children:e.jsx("input",{type:"date",className:"input",value:K.delivery_date,onChange:te=>z(J,"delivery_date",te.target.value)})}),e.jsx("td",{children:e.jsx("button",{type:"button",onClick:()=>L(J),className:"text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 text-sm font-medium",disabled:i.length===1,children:"Remove"})})]},J))})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("h2",{className:"text-lg font-semibold text-white dark:text-slate-100",children:"Summary"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"space-y-7",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{children:"Subtotal"}),e.jsx("div",{className:"font-semibold",children:V.toFixed(2)})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-center flex-1",children:[e.jsx("div",{children:"Total Tax"}),e.jsx("div",{className:"font-semibold",children:P.toFixed(2)})]}),e.jsx("div",{className:"flex-1"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:"Shipping Cost"}),e.jsx("div",{children:e.jsx("input",{type:"number",className:"input w-32",value:a.shipping_cost,onChange:K=>n(J=>({...J,shipping_cost:K.target.value})),step:"1",min:"0"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:"Discount (%)"}),e.jsx("div",{children:e.jsx("input",{type:"number",className:"input w-32",value:a.discount_percent,onChange:K=>n(J=>({...J,discount_percent:K.target.value})),step:"1",min:"0"})})]}),e.jsxs("div",{className:"flex items-center justify-between border-t pt-4 md:col-span-2 lg:col-span-3",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Grand Total"}),e.jsx("div",{className:"text-lg font-bold",children:C.toFixed(2)})]})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("h2",{className:"text-lg font-semibold text-white dark:text-slate-100",children:"Supporting Documents"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"file",className:"input",onChange:G,multiple:!0}),e.jsx("span",{className:"text-sm",children:w?"Uploading...":"Attach PDF, DOCX, XLSX, images"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Filename"}),e.jsx("th",{children:"Link"}),e.jsx("th",{children:"Note"}),e.jsx("th",{className:"text-right",children:"Action"})]})}),e.jsxs("tbody",{children:[F.length?null:e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center py-6 text-slate-500 dark:text-slate-400",children:"No attachments"})}),F.map((K,J)=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:K.filename}),e.jsx("td",{children:e.jsx("a",{href:K.url,target:"_blank",rel:"noreferrer",className:"text-brand hover:text-brand-700",children:"View"})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input",value:K.note||"",onChange:te=>I(se=>se.map((ae,ne)=>ne===J?{...ae,note:te.target.value}:ae)),placeholder:"Optional note"})}),e.jsx("td",{className:"text-right",children:e.jsx("button",{type:"button",className:"btn-success",onClick:()=>O(J),children:"Remove"})})]},`${K.url}-${J}`))]})]})})]})})]}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(Re,{to:"/purchase/supplier-quotations",className:"btn-success",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"btn-success",children:[y?"Saving...":r?"Update":"Create"," Quotation"]})]})]})]})}function Kee(){const[t,s]=f.useState(""),[r,a]=f.useState(!1),[n,i]=f.useState(!1),[l,o]=f.useState(""),[d,u]=f.useState([]),[c,h]=f.useState(null),[m,p]=f.useState("comparison"),{canPerformAction:g}=Ls();f.useEffect(()=>{let I=!0;return a(!0),o(""),Z.get("/purchase/rfqs").then(w=>{var E;I&&u(Array.isArray((E=w.data)==null?void 0:E.items)?w.data.items:[])}).catch(w=>{var E,W;I&&o(((W=(E=w==null?void 0:w.response)==null?void 0:E.data)==null?void 0:W.message)||"Failed to load RFQs")}).finally(()=>{I&&a(!1)}),()=>{I=!1}},[]);const x=async()=>{var I,w;if(g("purchase:quotation-analysis","view")&&t){i(!0),o("");try{const E=await Z.get("/purchase/quotation-analysis",{params:{rfq_no:t}});h(E.data)}catch(E){o(((w=(I=E==null?void 0:E.response)==null?void 0:I.data)==null?void 0:w.message)||"Failed to load quotation analysis"),h(null)}finally{i(!1)}}},b=f.useMemo(()=>{if(!(c!=null&&c.items))return[];const I=new Set;return c.items.forEach(w=>{w.suppliers.forEach(E=>I.add(E.supplier))}),Array.from(I)},[c]),y=I=>!I.suppliers||I.suppliers.length===0?1/0:Math.min(...I.suppliers.map(w=>w.unit_price)),j=(I,w)=>I.suppliers.find(E=>E.supplier===w),N=I=>c!=null&&c.items?c.items.reduce((w,E)=>{const W=j(E,I);return w+(W?W.total:0)},0):0,F=d.find(I=>I.rfq_no===t)||{};return g("purchase:quotation-analysis","view")?e.jsxs("div",{className:"quotation-analysis-container",children:[e.jsx("style",{children:`
        :root {
            --primary: #0E3646;
            --primary-dark: #082330;
            --primary-light: #1a5570;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --light: #f8f9fa;
            --border: #dee2e6;
        }

        .quotation-analysis-container {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #fff;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 30px;
            border-radius: 12px 12px 0 0;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: var(--light);
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(14, 54, 70, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .form-content {
            padding: 30px;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 13px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 6px;
        }

        .form-control {
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .comparison-table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .comparison-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: white;
            min-width: 1200px;
        }

        .comparison-table thead th {
            background: var(--primary);
            color: white;
            padding: 15px;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            text-align: left;
        }

        .comparison-table tbody td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            border-right: 1px solid var(--border);
            vertical-align: top;
        }

        .comparison-table tbody td:last-child {
            border-right: none;
        }

        .supplier-column {
            min-width: 220px;
            background: #f8f9fa;
        }

        .price-cell {
            font-weight: 600;
            font-size: 15px;
            color: var(--primary);
        }

        .best-price {
            background: #d4edda !important;
            position: relative;
        }

        .best-price::after {
            content: " Best";
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 10px;
            background: var(--success);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        .tabs {
            display: flex;
            gap: 0;
            border-bottom: 2px solid var(--border);
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s;
            font-size: 14px;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: rgba(14, 54, 70, 0.05);
        }

        .info-card {
            background: #e7f3ff;
            border-left: 4px solid var(--info);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .supplier-info-card {
            background: white;
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            transition: all 0.3s;
        }

        .supplier-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .supplier-name-large {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .stat-row {
            display: flex;
            gap: 30px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #6c757d;
            font-weight: 600;
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .score-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
        }
        
        .score-excellent { background: #d4edda; color: #155724; }
        .score-good { background: #d1ecf1; color: #0c5460; }
        .score-average { background: #fff3cd; color: #856404; }

      `}),e.jsxs("div",{className:"container mx-auto bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"header",children:[e.jsx("h1",{children:" Quotation Analysis & Comparison"}),e.jsx("p",{children:"Compare supplier quotations and select the best offer"})]}),e.jsxs("div",{className:"toolbar",children:[e.jsx("div",{className:"form-group",style:{maxWidth:"300px",margin:0},children:e.jsxs("select",{className:"form-control",value:t,onChange:I=>s(I.target.value),children:[e.jsx("option",{value:"",children:"Select RFQ"}),d.map(I=>e.jsxs("option",{value:I.rfq_no,children:[I.rfq_no," -"," ",I.description||I.status||"No Description"]},I.id))]})}),e.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[e.jsx("button",{className:"btn btn-info",onClick:x,disabled:!t||n,children:n?"Loading...":" Generate Report"}),e.jsx(Re,{to:"/purchase",className:"btn btn-secondary",children:"Back to Purchase"})]})]}),e.jsxs("div",{className:"form-content",children:[t&&e.jsxs("div",{className:"form-section",children:[e.jsx("div",{className:"section-title",children:" RFQ Details"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"RFQ Number"}),e.jsx("input",{type:"text",className:"form-control",value:F.rfq_no||"",readOnly:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"RFQ Date"}),e.jsx("input",{type:"text",className:"form-control",value:F.rfq_date?Eh(new Date(F.rfq_date),"yyyy-MM-dd"):"",readOnly:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Status"}),e.jsx("input",{type:"text",className:"form-control",value:F.status||"",readOnly:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Expiry Date"}),e.jsx("input",{type:"text",className:"form-control",value:F.expiry_date?Eh(new Date(F.expiry_date),"yyyy-MM-dd"):"",readOnly:!0})]})]})]}),l&&e.jsx("div",{className:"p-4 text-red-600 bg-red-50 rounded mb-4",children:l}),c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"info-card",children:e.jsxs("p",{children:[e.jsx("strong",{children:" Analysis Status:"})," Quotations loaded. Review the comparison below to make your selection."]})}),e.jsxs("div",{className:"tabs",children:[e.jsx("button",{className:`tab ${m==="comparison"?"active":""}`,onClick:()=>p("comparison"),children:" Price Comparison"}),e.jsx("button",{className:`tab ${m==="detailed"?"active":""}`,onClick:()=>p("detailed"),children:" Detailed Analysis"}),e.jsx("button",{className:`tab ${m==="scoring"?"active":""}`,onClick:()=>p("scoring"),children:" Scoring Matrix"})]}),m==="comparison"&&e.jsx("div",{className:"tab-content active",children:e.jsx("div",{className:"comparison-table-container",children:e.jsxs("table",{className:"comparison-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{minWidth:"250px"},children:"Item Details"}),b.map(I=>e.jsx("th",{className:"supplier-column",children:I},I))]})}),e.jsxs("tbody",{children:[c.items.map((I,w)=>{const E=y(I);return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("strong",{children:I.item_name}),e.jsx("br",{}),e.jsx("small",{style:{color:"#6c757d"},children:I.item_code}),e.jsx("br",{}),e.jsxs("small",{style:{color:"#6c757d"},children:["Qty: ",I.qty," ",I.uom||"Units"]})]}),b.map(W=>{const R=j(I,W);if(!R)return e.jsx("td",{children:"-"},W);const U=R.unit_price===E;return e.jsxs("td",{className:`price-cell ${U?"best-price":""}`,children:[e.jsxs("div",{style:{fontSize:"16px",marginBottom:"5px"},children:["$",R.unit_price.toFixed(2)]}),e.jsxs("div",{style:{color:"#6c757d",fontWeight:"normal",fontSize:"13px"},children:["Subtotal: $",R.total.toFixed(2)]}),e.jsxs("div",{style:{marginTop:"5px",color:"var(--primary)"},children:["Total: $",R.total.toFixed(2)]}),e.jsx("div",{style:{marginTop:"8px",fontSize:"12px",fontWeight:"normal"},children:e.jsxs("div",{style:{color:"#28a745"},children:[" ",R.delivery_days," days delivery"]})})]},W)})]},w)}),e.jsxs("tr",{style:{background:"var(--primary)",color:"white",fontWeight:700,fontSize:"15px"},children:[e.jsx("td",{children:"GRAND TOTAL"}),b.map(I=>e.jsxs("td",{children:["$",N(I).toLocaleString("en-US",{minimumFractionDigits:2})]},I))]})]})]})})}),m==="detailed"&&e.jsx("div",{className:"tab-content active",children:b.map((I,w)=>e.jsxs("div",{className:"supplier-info-card",children:[e.jsxs("div",{className:"supplier-header",children:[e.jsx("span",{className:"supplier-name-large",children:I}),e.jsx("span",{className:"score-badge score-good",children:"Score: TBD"})]}),e.jsxs("div",{className:"stat-row",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Total Quoted"}),e.jsxs("span",{className:"stat-value",children:["$",N(I).toLocaleString()]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Status"}),e.jsx("span",{className:"stat-value",children:"Active"})]})]})]},w))}),m==="scoring"&&e.jsx("div",{className:"tab-content active",children:e.jsx("div",{className:"comparison-table-container",children:e.jsxs("table",{className:"comparison-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{minWidth:"250px"},children:"Criteria"}),e.jsx("th",{style:{width:"120px"},children:"Weight"}),b.map(I=>e.jsx("th",{className:"supplier-column",children:I},I))]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Price Competitiveness"})}),e.jsx("td",{children:"40%"}),b.map(I=>e.jsx("td",{children:"-"},I))]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Delivery Speed"})}),e.jsx("td",{children:"30%"}),b.map(I=>e.jsx("td",{children:"-"},I))]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Quality / Specs"})}),e.jsx("td",{children:"20%"}),b.map(I=>e.jsx("td",{children:"-"},I))]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Payment Terms"})}),e.jsx("td",{children:"10%"}),b.map(I=>e.jsx("td",{children:"-"},I))]}),e.jsxs("tr",{style:{background:"#f8f9fa",fontWeight:600},children:[e.jsx("td",{children:e.jsx("strong",{children:"TOTAL SCORE"})}),e.jsx("td",{children:"100%"}),b.map(I=>e.jsx("td",{children:"-"},I))]})]})]})})})]})]})]})]}):e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"max-w-3xl mx-auto card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h1",{className:"text-xl font-semibold mb-2",children:"Quotation Analysis"}),e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"You do not have permission to view quotation analysis."}),e.jsx(Re,{to:"/purchase",className:"btn btn-secondary",children:"Back to Purchase"})]})})})}function zee(){const[t,s]=f.useState(""),[r,a]=f.useState("ALL"),[n,i]=f.useState([]),[l,o]=f.useState(!1),[d,u]=f.useState(""),[c,h]=f.useState(!1),[m,p]=f.useState(!1),[g,x]=f.useState(""),[b,y]=f.useState(null),[j,N]=f.useState([]),[_,F]=f.useState(null),[I,w]=f.useState(null),[E,W]=f.useState(null),[R,U]=f.useState(!1),[T,Y]=f.useState(null),[H,M]=f.useState(!1),{canPerformAction:q}=Ls();f.useEffect(()=>{let k=!0;return o(!0),u(""),Z.get("/purchase/orders").then(B=>{var O;if(!k)return;const G=Array.isArray((O=B.data)==null?void 0:O.items)?B.data.items:[];i(G.filter(K=>String(K.po_type||"").toUpperCase()==="LOCAL"))}).catch(B=>{var G,O;k&&u(((O=(G=B==null?void 0:B.response)==null?void 0:G.data)==null?void 0:O.message)||"Failed to load purchase orders")}).finally(()=>{k&&o(!1)}),()=>{k=!1}},[]);const z=k=>({DRAFT:"badge-warning",PENDING_APPROVAL:"badge-warning",APPROVED:"badge-info",RECEIVED:"badge-success",RETURNED:"badge-error",CANCELLED:"badge-error"})[k]||"badge-info",Q=f.useMemo(()=>n.filter(k=>{const B=String(k.po_no||"").toLowerCase().includes(t.toLowerCase())||String(k.supplier_name||"").toLowerCase().includes(t.toLowerCase()),G=r==="ALL"||k.status===r;return B&&G}),[n,t,r]),L=async k=>{var B,G,O;if(Y(k),h(!0),x(""),I)await V();else try{p(!0);const K=await Z.get("/workflows"),J=Array.isArray((B=K.data)==null?void 0:B.items)?K.data.items:[];w(J),await P(J)}catch(K){x(((O=(G=K==null?void 0:K.response)==null?void 0:G.data)==null?void 0:O.message)||"Failed to load workflows")}finally{p(!1)}},V=async()=>{var J,te,se;if(!I||!I.length){y(null),F(null),x(""),M(!1);return}const k="/purchase/purchase-orders-local",B=ae=>String(ae||"").trim().toUpperCase().replace(/\s+/g,"_"),O=I.filter(ae=>String(ae.document_route)===k||B(ae.document_type)==="PURCHASE_ORDER").some(ae=>Number(ae.is_active)===0),K=I.find(ae=>Number(ae.is_active)===1&&String(ae.document_route)===k)||I.find(ae=>Number(ae.is_active)===1&&B(ae.document_type)==="PURCHASE_ORDER")||null;if(y(K||null),M(!K&&O),F(null),!!K)try{p(!0);const ne=(J=(await Z.get(`/workflows/${K.id}`)).data)==null?void 0:J.item,ue=Array.isArray(ne==null?void 0:ne.steps)?ne.steps:[];N(ue);const oe=ue[0]||null;if(F(oe?{userId:oe.approver_user_id,name:oe.approver_name,stepName:oe.step_name,stepOrder:oe.step_order,approvalLimit:oe.approval_limit}:null),oe){const le=(Array.isArray(oe.approvers)&&oe.approvers.length?oe.approvers[0].id:oe.approver_user_id)||null;W(le)}else W(null)}catch(ae){x(((se=(te=ae==null?void 0:ae.response)==null?void 0:te.data)==null?void 0:se.message)||"Failed to load workflow details")}finally{p(!1)}},P=async k=>{var te,se,ae;if(!k||!k.length){y(null),F(null),x(""),M(!1);return}const B="/purchase/purchase-orders-local",G=ne=>String(ne||"").trim().toUpperCase().replace(/\s+/g,"_"),K=k.filter(ne=>String(ne.document_route)===B||G(ne.document_type)==="PURCHASE_ORDER").some(ne=>Number(ne.is_active)===0),J=k.find(ne=>Number(ne.is_active)===1&&String(ne.document_route)===B)||k.find(ne=>Number(ne.is_active)===1&&G(ne.document_type)==="PURCHASE_ORDER")||null;if(y(J||null),M(!J&&K),F(null),!!J)try{p(!0);const ue=(te=(await Z.get(`/workflows/${J.id}`)).data)==null?void 0:te.item,oe=Array.isArray(ue==null?void 0:ue.steps)?ue.steps:[];N(oe);const le=oe[0]||null;if(F(le?{userId:le.approver_user_id,name:le.approver_name,stepName:le.step_name,stepOrder:le.step_order,approvalLimit:le.approval_limit}:null),le){const X=(Array.isArray(le.approvers)&&le.approvers.length?le.approvers[0].id:le.approver_user_id)||null;W(X)}else W(null)}catch(ne){x(((ae=(se=ne==null?void 0:ne.response)==null?void 0:se.data)==null?void 0:ae.message)||"Failed to load workflow details")}finally{p(!1)}},C=async()=>{var O,K,J;if(!T)return;const B=Array.isArray(j)&&j.length>0?j[0]:null,G=B?Array.isArray(B.approvers)&&B.approvers.length?B.approvers:B.approver_user_id?[{id:B.approver_user_id}]:[]:[];if(b&&G.length>0&&!E){x("Please select target approver");return}U(!0),x("");try{const te=await Z.post(`/purchase/orders/${T.id}/submit`,{amount:T.total_amount===void 0||T.total_amount===null?null:Number(T.total_amount||0),workflow_id:b?b.id:null,target_user_id:E||null}),se=((O=te==null?void 0:te.data)==null?void 0:O.status)||"PENDING_APPROVAL";i(ae=>ae.map(ne=>ne.id===T.id?{...ne,status:se}:ne)),h(!1),Y(null)}catch(te){x(((J=(K=te==null?void 0:te.response)==null?void 0:K.data)==null?void 0:J.message)||"Failed to forward for approval")}finally{U(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Purchase Orders - Local"}),e.jsx("p",{className:"text-sm mt-1",children:"Manage local purchase orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/purchase",className:"btn btn-secondary",children:"Return to Menu"}),q("purchase:purchase-orders-local","create")&&e.jsx(Re,{to:"/purchase/purchase-orders-local/new",className:"btn-success",children:"+ New Purchase Order"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by PO no or supplier...",className:"input",value:t,onChange:k=>s(k.target.value)})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs("select",{className:"input",value:r,onChange:k=>a(k.target.value),children:[e.jsx("option",{value:"ALL",children:"All Status"}),e.jsx("option",{value:"DRAFT",children:"Draft"}),e.jsx("option",{value:"PENDING_APPROVAL",children:"Pending Approval"}),e.jsx("option",{value:"APPROVED",children:"Approved"}),e.jsx("option",{value:"RECEIVED",children:"Received"}),e.jsx("option",{value:"RETURNED",children:"Returned"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})})]})}),e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"PO No"}),e.jsx("th",{children:"PO Date"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{className:"text-right",children:"Total Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[l?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):d?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-red-600",children:d})}):null,Q.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No purchase orders found"})}):Q.map(k=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:k.po_no}),e.jsx("td",{children:k.po_date?new Date(k.po_date).toLocaleDateString():""}),e.jsx("td",{children:k.supplier_name}),e.jsx("td",{className:"text-right font-medium",children:Number(k.total_amount||0).toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${z(k.status)}`,children:k.status})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[q("purchase:purchase-orders-local","view")&&e.jsx(Re,{to:`/purchase/purchase-orders-local/${k.id}`,className:"text-brand hover:text-brand-600 dark:text-brand-300 dark:hover:text-brand-200 text-sm font-medium",children:"View"}),k.status==="DRAFT"&&q("purchase:purchase-orders-local","edit")&&e.jsx(Re,{to:`/purchase/purchase-orders-local/${k.id}/edit`,className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-medium",children:"Edit"}),k.status==="APPROVED"?e.jsx("span",{className:"text-sm font-medium px-2 py-1 rounded bg-green-500 text-white",children:"Approved"}):k.status==="DRAFT"||k.status==="RETURNED"?e.jsx("button",{type:"button",className:"text-sm font-medium px-2 py-1 rounded bg-brand text-white hover:bg-brand-700 transition-colors",onClick:()=>L(k),disabled:H,children:"Forward for Approval"}):null]})})]},k.id))]})]})}),e.jsx("div",{className:"card-body border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{children:["Showing ",Q.length," of ",n.length," orders"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-success px-3 py-1.5",disabled:!0,children:"Previous"}),e.jsx("button",{className:"btn-success px-3 py-1.5",disabled:!0,children:"Next"})]})]})})]}),c?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-[640px] max-w-[95%]",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-brand text-white rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Forward Purchase Order for Approval"}),e.jsx("button",{type:"button",onClick:()=>{h(!1),y(null),F(null),x(""),Y(null)},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Document No:"," ",e.jsx("span",{className:"font-semibold",children:(T==null?void 0:T.po_no)||""})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:b?`${b.workflow_name} (${b.workflow_code})`:"None (inactive)"})]}),e.jsx("div",{children:m?e.jsx("div",{className:"text-sm",children:"Loading workflow..."}):null}),e.jsx("div",{children:g?e.jsx("div",{className:"text-sm text-red-600",children:g}):null}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Target Approver"}),(()=>{const B=Array.isArray(j)&&j.length>0?j[0]:null,G=B?Array.isArray(B.approvers)&&B.approvers.length?B.approvers.map(O=>({id:O.id,name:O.username})):B.approver_user_id?[{id:B.approver_user_id,name:B.approver_name||String(B.approver_user_id)}]:[]:[];return G.length>0?e.jsxs("div",{className:"mt-1",children:[e.jsxs("select",{className:"input w-full",value:E||"",onChange:O=>W(O.target.value?Number(O.target.value):null),children:[e.jsx("option",{value:"",children:"Select target approver"}),G.map(O=>e.jsx("option",{value:O.id,children:O.name},O.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:_?`Step ${_.stepOrder}  ${_.stepName}${_.approvalLimit!=null?`  Limit: ${Number(_.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:b?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})()]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{h(!1),y(null),F(null),x(""),Y(null)},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:C,disabled:R||!T||Array.isArray(j)&&j.length>0&&b&&!E,children:R?"Forwarding...":"Forward"})]})]})}):null]})}function Kb(){var Ke,Je;const{id:t}=Ps(),s=Ur(),r=ps(),{user:a}=Kr(),n=!t||t==="new",i=!!t&&t!=="new"&&(s.pathname.includes("/edit")||(()=>{try{const xe=new URLSearchParams(s.search||""),ye=String(xe.get("mode")||"").toLowerCase(),Ae=String(xe.get("edit")||"").toLowerCase();return ye==="edit"||Ae==="1"||Ae==="true"}catch{return!1}})()),[l,o]=f.useState(!1),[d,u]=f.useState(!1),[c,h]=f.useState(""),[m,p]=f.useState(!1),[g,x]=f.useState(!1),[b,y]=f.useState(""),[j,N]=f.useState(null),[_,F]=f.useState(null),[I,w]=f.useState([]),[E,W]=f.useState(!1),[R,U]=f.useState(null),[T,Y]=f.useState(null),[H,M]=f.useState([]),[q,z]=f.useState([]),[Q,L]=f.useState([]),[V,P]=f.useState([]),[C,k]=f.useState([]),[B,G]=f.useState([]),[O,K]=f.useState([]),[J,te]=f.useState([]),[se,ae]=f.useState([]),ne=f.useRef(null),[ue,oe]=f.useState({po_no:"",po_date:new Date().toISOString().split("T")[0],supplier_id:"",quotation_id:"",po_type:"LOCAL",status:"DRAFT",warehouse_id:"",currency:"GHS",exchange_rate:1,delivery_date:"",payment_terms:30,remarks:"",port_loading:"",port_discharge:"",incoterms:"",hs_code:"",shipping_date:"",insurance_required:!1,freight_amount:0,other_charges:0,discount_amount:0,tax_amount:0,terms_conditions:`1. All goods must meet specified quality standards
2. Delivery to be made as per schedule
3. Payment terms: Net 30 days from delivery
4. Supplier responsible for any defects within warranty period
5. Late delivery penalties may apply as per agreement
6. All disputes subject to arbitration in Accra, Ghana`}),[le,X]=f.useState([{item_id:"",qty:0,uom:"",unit_price:0,discount_percent:0,tax_percent:0,line_total:0}]),[me,we]=f.useState({name:"",address:"",phone:"",email:"",city:"",state:"",country:"",logoUrl:""}),[Ie,_e]=f.useState({open:!1,itemId:null,defaultUom:"",currentUom:"",rowIdx:null}),{uoms:Fe}=$i(),Le=f.useMemo(()=>{const xe=Array.isArray(Fe)?Fe:[],ye=xe.find(Ae=>String(Ae.uom_code||"").toUpperCase()==="PCS")||xe[0];return ye&&ye.uom_code?ye.uom_code:"PCS"},[Fe]);f.useEffect(()=>{let xe=!0;async function ye(){var Ae,be,Ee,dt,mt,it,ht;try{const[ft,Rt,Ge,at,je]=await Promise.allSettled([Z.get("/purchase/suppliers"),Z.get("/inventory/warehouses"),Z.get("/inventory/items"),Z.get("/purchase/quotations"),Z.get("/inventory/unit-conversions")]);if(!xe)return;if(ft.status==="fulfilled"&&M(Array.isArray((Ae=ft.value.data)==null?void 0:Ae.items)?ft.value.data.items:[]),Rt.status==="fulfilled"&&z(Array.isArray((be=Rt.value.data)==null?void 0:be.items)?Rt.value.data.items:[]),Ge.status==="fulfilled"&&L(Array.isArray((Ee=Ge.value.data)==null?void 0:Ee.items)?Ge.value.data.items:[]),at.status==="fulfilled"){const Se=Array.isArray((dt=at.value.data)==null?void 0:dt.items)?at.value.data.items:[];k(Se);const nt=String(ue.supplier_id||""),Ze=nt&&nt.length?Se.filter(gt=>String(gt.supplier_id)===String(nt)):[];P(Ze)}je.status==="fulfilled"&&te(Array.isArray((mt=je.value.data)==null?void 0:mt.items)?je.value.data.items:[])}catch(ft){if(!xe)return;h(((ht=(it=ft==null?void 0:ft.response)==null?void 0:it.data)==null?void 0:ht.message)||"Failed to load lookups")}}return ye(),()=>{xe=!1}},[]);const rt=()=>{window.print()},He=async()=>{const xe=ne.current;if(!xe)return;const ye=xe.style.cssText;xe.style.cssText=ye+";position:fixed;left:-10000px;top:0;display:block;z-index:-1;background:white;width:794px;padding:32px;";try{const Ae=await wi(xe,{scale:2,useCORS:!0}),be=Ae.toDataURL("image/png"),Ee=new hs("p","mm","a4"),dt=Ee.internal.pageSize.getWidth(),mt=Ee.internal.pageSize.getHeight(),it=dt,ht=Ae.height*it/Ae.width;let ft=0;for(;ft<ht;)Ee.addImage(be,"PNG",0,-ft,it,ht),ft+=mt,ft<ht&&Ee.addPage();const Rt="PurchaseOrder_"+(ue.po_no||new Date().toISOString().slice(0,10))+".pdf";Ee.save(Rt)}finally{xe.style.cssText=ye}};f.useEffect(()=>{let xe=!0;async function ye(){var Ae;try{const be=await Z.get("/finance/currencies");if(!xe)return;const Ee=Array.isArray((Ae=be.data)==null?void 0:Ae.items)?be.data.items:[];G(Ee)}catch{}}return ye(),()=>{xe=!1}},[]),f.useEffect(()=>{async function xe(){var ye;try{const Ae=Array.isArray(B)?B:[];if(!Ae.length)return;const be=Ae.find(ht=>String(ht.is_base)==="1"||ht.is_base===1||ht.is_base===!0)||Ae.find(ht=>String(ht.code||ht.currency_code||"").toUpperCase()==="GHS")||Ae.find(ht=>/ghana|cedi/i.test(String(ht.name||ht.currency_name||""))),Ee=Ae.find(ht=>String(ht.code||ht.currency_code||"").toUpperCase()==="USD");if(!be||!Ee||be.id===Ee.id)return;const dt=ue.po_date||new Date().toISOString().split("T")[0],mt=await Z.get("/finance/currency-rates",{params:{fromCurrencyId:Ee.id,toCurrencyId:be.id,to:dt}});if(!(Array.isArray((ye=mt.data)==null?void 0:ye.items)?mt.data.items:[]).length)try{await Z.post("/finance/currency-rates",{fromCurrencyId:Ee.id,toCurrencyId:be.id,rate:1,rateDate:dt})}catch{}}catch{}}xe()},[B,ue.po_date]),f.useEffect(()=>{let xe=!0;async function ye(){var Ae;try{const be=await Z.get("/sales/prices/standard");if(!xe)return;const Ee=Array.isArray((Ae=be.data)==null?void 0:Ae.items)?be.data.items:[];K(Ee)}catch{}}return ye(),()=>{xe=!1}},[]),f.useEffect(()=>{let xe=!0;async function ye(){var Ae;try{const be=await Z.get("/finance/tax-codes");if(!xe)return;const dt=(Array.isArray((Ae=be.data)==null?void 0:Ae.items)?be.data.items:[]).map(mt=>({value:mt.id,label:mt.name,rate:Number(mt.rate_percent)}));ae(dt)}catch{}}return ye(),()=>{xe=!1}},[]);const st=async xe=>{var dt;const ye=String(xe||"").toUpperCase(),Ae=Array.isArray(B)?B:[];if(!ye||!Ae.length)return;const be=Ae.find(mt=>String(mt.is_base)==="1"||mt.is_base===1||mt.is_base===!0)||Ae.find(mt=>String(mt.code||mt.currency_code||"").toUpperCase()==="GHS")||Ae.find(mt=>/ghana|cedi/i.test(String(mt.name||mt.currency_name||""))),Ee=Ae.find(mt=>String(mt.code||mt.currency_code||"").toUpperCase()===ye);if(!be||!Ee||be.id===Ee.id){oe(mt=>({...mt,exchange_rate:1}));return}try{const mt=ue.po_date||new Date().toISOString().split("T")[0],it=await Z.get("/finance/currency-rates",{params:{fromCurrencyId:Ee.id,toCurrencyId:be.id,to:mt}}),ft=(Array.isArray((dt=it.data)==null?void 0:dt.items)?it.data.items:[])[0];if(ft&&ft.rate)oe(Rt=>({...Rt,exchange_rate:Number(ft.rate)||Rt.exchange_rate||1}));else try{await Z.post("/finance/currency-rates",{fromCurrencyId:Ee.id,toCurrencyId:be.id,rate:1,rateDate:mt}),oe(Rt=>({...Rt,exchange_rate:1}))}catch{oe(Rt=>({...Rt,exchange_rate:1}))}}catch{}};f.useEffect(()=>{st(ue.currency)},[B,ue.currency,ue.po_date]),f.useEffect(()=>{if(i)return;let xe=!0;return Z.get("/purchase/orders/next-no",{params:{po_type:ue.po_type||"LOCAL"}}).then(ye=>{var Ae;if(xe&&(Ae=ye.data)!=null&&Ae.nextNo){const be=String(ye.data.nextNo||""),Ee=be.replace(/^PO-/i,"LP-"),dt=Ee.toUpperCase().startsWith("LP-")?Ee:`LP-${be.replace(/^LP-/i,"")}`;oe(mt=>({...mt,po_no:mt.po_no||dt}))}}).catch(ye=>console.error("Failed to load next purchase order number",ye)),()=>{xe=!1}},[i,ue.po_type]),f.useEffect(()=>{De()},[]);async function De(){var xe,ye,Ae;try{const Ee=(ye=(xe=(await Z.get("/admin/me")).data)==null?void 0:xe.scope)==null?void 0:ye.companyId;if(Ee){const mt=((Ae=(await Z.get(`/admin/companies/${Ee}`)).data)==null?void 0:Ae.item)||{};we(it=>({...it,name:mt.name||it.name||"",address:mt.address||it.address||"",phone:mt.telephone||it.phone||"",email:mt.email||it.email||"",city:mt.city||it.city||"",state:mt.state||it.state||"",country:mt.country||it.country||"",logoUrl:mt.has_logo===1||mt.has_logo===!0?`/api/admin/companies/${Ee}/logo`:Ws}))}else we(dt=>({...dt,logoUrl:dt.logoUrl||Ws}))}catch{we(be=>({...be,logoUrl:be.logoUrl||Ws}))}}f.useEffect(()=>{if(n)return;let xe=!0;return o(!0),h(""),Z.get(`/purchase/orders/${t}`).then(ye=>{var Ee,dt,mt;if(!xe)return;const Ae=(Ee=ye.data)==null?void 0:Ee.item,be=Array.isArray((mt=(dt=ye.data)==null?void 0:dt.item)==null?void 0:mt.details)?ye.data.item.details:[];Ae&&(oe({po_no:Ae.po_no||"",po_date:Ae.po_date||new Date().toISOString().split("T")[0],supplier_id:Ae.supplier_id?String(Ae.supplier_id):"",po_type:Ae.po_type||"LOCAL",status:Ae.status||"DRAFT",warehouse_id:Ae.warehouse_id?String(Ae.warehouse_id):"",currency:Ae.currency||"GHS",exchange_rate:Number(Ae.exchange_rate)||1,delivery_date:Ae.delivery_date||"",payment_terms:Ae.payment_terms||30,remarks:Ae.remarks||"",port_loading:Ae.port_loading||"",port_discharge:Ae.port_discharge||"",incoterms:Ae.incoterms||"",hs_code:Ae.hs_code||"",shipping_date:Ae.shipping_date||"",insurance_required:!!Ae.insurance_required,freight_amount:Number(Ae.freight_amount)||0,other_charges:Number(Ae.other_charges)||0,discount_amount:Number(Ae.discount_amount)||0,tax_amount:Number(Ae.tax_amount)||0,terms_conditions:Ae.terms_conditions||ue.terms_conditions}),X(be.length?be.filter(it=>it).map(it=>({item_id:it.item_id?String(it.item_id):"",qty:Number(it.qty)||0,uom:it.uom||"",unit_price:Number(it.unit_price)||0,discount_percent:Number(it.discount_percent)||0,tax_percent:Number(it.tax_percent)||0,line_total:Number(it.line_total)||0})):[{item_id:"",qty:0,uom:"",unit_price:0,discount_percent:0,tax_percent:0,line_total:0}]))}).catch(ye=>{var Ae,be;xe&&h(((be=(Ae=ye==null?void 0:ye.response)==null?void 0:Ae.data)==null?void 0:be.message)||"Failed to load purchase order")}).finally(()=>{xe&&o(!1)}),()=>{xe=!1}},[t]);const Te=f.useMemo(()=>{let xe=0,ye=0,Ae=0;le.forEach(mt=>{if(!mt)return;const it=Number(mt.qty)||0,ht=Number(mt.unit_price)||0,ft=Number(mt.discount_percent)||0,Rt=Number(mt.tax_percent)||0,Ge=it*ht,at=Ge*(ft/100),Se=(Ge-at)*(Rt/100);xe+=Ge,ye+=at,Ae+=Se});const be=Number(ue.freight_amount)||0,Ee=Number(ue.other_charges)||0,dt=xe-ye+Ae+be+Ee;return{subTotal:xe,totalDiscount:ye,totalTax:Ae,freight:be,other:Ee,grandTotal:dt}},[le,ue.freight_amount,ue.other_charges]),Ce=async xe=>{var dt,mt;const{name:ye,value:Ae,type:be,checked:Ee}=xe.target;if(oe(it=>({...it,[ye]:be==="checkbox"?Ee:Ae})),ye==="supplier_id"){const it=String(Ae||"");if(it){const ht=(Array.isArray(C)?C:[]).filter(ft=>String(ft.supplier_id)===it);P(ht),oe(ft=>{const Rt=ht.some(Ge=>String(Ge.id)===String(ft.quotation_id||""));return{...ft,quotation_id:Rt?ft.quotation_id:""}});try{const ft=H.find(Ge=>String(Ge.id)===it),Rt=ft&&ft.supplier_code&&String(ft.supplier_code).trim()||(ft?`SU-${String(Number(ft.id||0)).padStart(6,"0")}`:"");if(Rt){const Ge=await Z.get("/finance/accounts",{params:{search:Rt}}),at=Array.isArray((dt=Ge.data)==null?void 0:dt.items)?Ge.data.items:[],je=at.find(nt=>String(nt.code)===Rt)||at[0]||null,Se=je&&(je.currency_code||je.currency||je.currencyCode)||null;if(Se){const nt=String(Se).toUpperCase();oe(Ze=>({...Ze,currency:nt})),await st(nt)}}}catch{}}else P(Array.isArray(C)?C:[])}if(ye==="quotation_id"&&Ae)try{const ht=(mt=(await Z.get(`/purchase/quotations/${Ae}`)).data)==null?void 0:mt.item;if(ht){const Rt=(Array.isArray(B)?B:[]).find(Se=>String(Se.id)===String(ht.currency_id||"")),Ge=String((Rt==null?void 0:Rt.code)||(Rt==null?void 0:Rt.currency_code)||ht.currency_code||ht.currency||"").toUpperCase()||ue.currency,je=new Set(["USD","EUR","GBP"]).has(Ge)?Ge:ue.currency;if(oe(Se=>({...Se,supplier_id:ht.supplier_id?String(ht.supplier_id):Se.supplier_id,currency:je,exchange_rate:ht.exchange_rate!==void 0&&ht.exchange_rate!==null?Number(ht.exchange_rate)||Se.exchange_rate||1:Se.exchange_rate,delivery_date:ht.valid_until||Se.delivery_date||"",remarks:ht.remarks||Se.remarks||""})),ht.exchange_rate!==void 0&&ht.exchange_rate!==null||await st(je),ht.details){const Se=ht.details.map(nt=>({item_id:String(nt.item_id),qty:Number(nt.qty)||0,uom:nt.uom||Le,unit_price:Number(nt.unit_price)||0,discount_percent:Number(nt.discount_percent)||0,tax_percent:0,line_total:Number(nt.line_total)||0}));X(Se)}}}catch(it){console.error("Failed to fetch quotation details",it)}ye==="currency"&&await st(Ae)},Pe=(xe,ye,Ae)=>{const be=[...le];if(be[xe]={...be[xe],[ye]:Ae},ye==="item_id"){const at=Q.find(Ze=>String(Ze.id)===String(Ae)),je=(at==null?void 0:at.uom)||Le;be[xe].uom=je;let nt=at&&Number(at.cost_price)||0;if(Array.isArray(O)&&O.length){const Ze=O.filter(gt=>String(gt.product_id)===String(Ae)).sort((gt,jt)=>{const Mt=gt.effective_date?new Date(gt.effective_date).getTime():0;return(jt.effective_date?new Date(jt.effective_date).getTime():0)-Mt||new Date(jt.created_at).getTime()-new Date(gt.created_at).getTime()});Ze.length>0&&(nt=Number(Ze[0].cost_price)||nt)}be[xe].unit_price=nt}const Ee=Number(be[xe].qty)||0,dt=Number(be[xe].unit_price)||0,mt=Number(be[xe].discount_percent)||0,it=Number(be[xe].tax_percent)||0,ht=Ee*dt,ft=ht*(mt/100),Rt=ht-ft,Ge=Rt*(it/100);be[xe].line_total=Rt+Ge,X(be)},fe=()=>{X(xe=>[...xe,{item_id:"",qty:0,uom:"",unit_price:0,discount_percent:0,tax_percent:0,line_total:0}])},he=xe=>{X(ye=>ye.length>1?ye.filter((Ae,be)=>be!==xe):ye)},Ue=async xe=>{var ye,Ae,be,Ee,dt,mt,it,ht,ft,Rt,Ge,at,je;xe.preventDefault(),u(!0),h("");try{const Se=(be=(Ae=(ye=xe==null?void 0:xe.nativeEvent)==null?void 0:ye.submitter)==null?void 0:Ae.dataset)==null?void 0:be.submitType,nt=Se==="pending"?"PENDING_APPROVAL":Se==="draft"?"DRAFT":ue.status||"DRAFT";if(!ue.supplier_id){h("Supplier is required"),u(!1);return}const Ze=le.filter(Ne=>Ne.item_id&&Number(Ne.qty)>0&&Number(Ne.unit_price)>0);if(Ze.length===0){h("At least one item with quantity and unit price is required"),u(!1);return}const gt=String(ue.po_no||""),Mt={po_no:gt.toUpperCase().startsWith("LP-")?gt:gt.replace(/^PO-/i,"LP-")||(gt.length?`LP-${gt.replace(/^LP-/i,"")}`:""),po_date:ue.po_date,po_type:"LOCAL",status:nt,supplier_id:Number(ue.supplier_id),warehouse_id:Number(ue.warehouse_id)||null,currency:ue.currency,exchange_rate:Number(ue.exchange_rate)||1,delivery_date:ue.delivery_date||"",payment_terms:Number(ue.payment_terms)||0,remarks:ue.remarks||"",port_loading:ue.port_loading||"",port_discharge:ue.port_discharge||"",incoterms:ue.incoterms||"",hs_code:ue.hs_code||"",shipping_date:ue.shipping_date||"",insurance_required:!!ue.insurance_required,freight_amount:Number(ue.freight_amount)||0,other_charges:Number(ue.other_charges)||0,discount_amount:Te.totalDiscount,tax_amount:Te.totalTax,total_amount:Te.grandTotal,terms_conditions:ue.terms_conditions||"",quotation_id:ue.quotation_id?Number(ue.quotation_id):void 0,details:Ze.map(Ne=>({item_id:Number(Ne.item_id),qty:Number(Ne.qty)||0,uom:Ne.uom||"",unit_price:Number(Ne.unit_price)||0,discount_percent:Number(Ne.discount_percent)||0,tax_percent:Number(Ne.tax_percent)||0,line_total:Number(Ne.line_total)||0}))};if(Se==="pending"){if(i){await Z.post(`/purchase/orders/${t}/submit`,{amount:Te.grandTotal??null,workflow_id:j?j.id:null,target_user_id:T||null});const Ne=await Z.get(`/purchase/orders/${t}`),ke=(Ee=Ne.data)==null?void 0:Ee.item,qe=Array.isArray((mt=(dt=Ne.data)==null?void 0:dt.item)==null?void 0:mt.details)?Ne.data.item.details:[];ke&&(oe({po_no:ke.po_no||"",po_date:ke.po_date||new Date().toISOString().split("T")[0],supplier_id:ke.supplier_id?String(ke.supplier_id):"",po_type:ke.po_type||"LOCAL",status:ke.status||"DRAFT",warehouse_id:ke.warehouse_id?String(ke.warehouse_id):"",currency:ke.currency||"GHS",exchange_rate:Number(ke.exchange_rate)||1,delivery_date:ke.delivery_date||"",payment_terms:ke.payment_terms||30,remarks:ke.remarks||"",port_loading:ke.port_loading||"",port_discharge:ke.port_discharge||"",incoterms:ke.incoterms||"",hs_code:ke.hs_code||"",shipping_date:ke.shipping_date||"",insurance_required:!!ke.insurance_required,freight_amount:Number(ke.freight_amount)||0,other_charges:Number(ke.other_charges)||0}),X(qe.map(ge=>({item_id:ge.item_id?String(ge.item_id):"",qty:Number(ge.qty)||Number(ge.qty_ordered)||0,uom:ge.uom||Le||"",unit_price:Number(ge.unit_price)||0,discount_percent:Number(ge.discount_percent)||0,tax_percent:Number(ge.tax_percent)||0,line_total:Number(ge.line_total)||Number(ge.amount)||0}))))}else{const Ne=await Z.post("/purchase/orders",Mt),ke=(it=Ne==null?void 0:Ne.data)==null?void 0:it.id;ke&&await Z.post(`/purchase/orders/${ke}/submit`,{amount:Te.grandTotal??null,workflow_id:j?j.id:null,target_user_id:T||null})}r("/purchase/purchase-orders-local");return}if(i){await Z.put(`/purchase/orders/${t}/status`,{status:nt});const Ne=await Z.get(`/purchase/orders/${t}`),ke=(ht=Ne.data)==null?void 0:ht.item,qe=Array.isArray((Rt=(ft=Ne.data)==null?void 0:ft.item)==null?void 0:Rt.details)?Ne.data.item.details:[];ke&&(oe({po_no:ke.po_no||"",po_date:ke.po_date||new Date().toISOString().split("T")[0],supplier_id:ke.supplier_id?String(ke.supplier_id):"",po_type:ke.po_type||"LOCAL",status:ke.status||"DRAFT",warehouse_id:ke.warehouse_id?String(ke.warehouse_id):"",currency:ke.currency||"GHS",exchange_rate:Number(ke.exchange_rate)||1,delivery_date:ke.delivery_date||"",payment_terms:ke.payment_terms||30,remarks:ke.remarks||"",port_loading:ke.port_loading||"",port_discharge:ke.port_discharge||"",incoterms:ke.incoterms||"",hs_code:ke.hs_code||"",shipping_date:ke.shipping_date||"",insurance_required:!!ke.insurance_required,freight_amount:Number(ke.freight_amount)||0,other_charges:Number(ke.other_charges)||0}),X(qe.map(ge=>({item_id:ge.item_id?String(ge.item_id):"",qty:Number(ge.qty)||Number(ge.qty_ordered)||0,uom:ge.uom||Le||"",unit_price:Number(ge.unit_price)||0,discount_percent:Number(ge.discount_percent)||0,tax_percent:Number(ge.tax_percent)||0,line_total:Number(ge.line_total)||Number(ge.amount)||0}))))}else{const Ne=await Z.post("/purchase/orders",Mt),ke=(Ge=Ne==null?void 0:Ne.data)==null?void 0:Ge.id;ke&&nt!=="DRAFT"&&await Z.put(`/purchase/orders/${ke}/status`,{status:nt})}r("/purchase/purchase-orders-local")}catch(Se){const nt=((je=(at=Se==null?void 0:Se.response)==null?void 0:at.data)==null?void 0:je.message)||(Se==null?void 0:Se.message)||"Error saving purchase order. Please try again.";h(nt)}finally{u(!1)}},Ye=async()=>{var xe,ye,Ae;if(!n){W(!0),y("");try{const be=await Z.post(`/purchase/orders/${t}/submit`,{amount:Te.grandTotal??null,workflow_id:j?j.id:null,target_user_id:T||null}),Ee=((xe=be==null?void 0:be.data)==null?void 0:xe.status)||"PENDING_APPROVAL";oe(dt=>({...dt,status:Ee})),p(!1),r("/purchase/purchase-orders-local")}catch(be){y(((Ae=(ye=be==null?void 0:be.response)==null?void 0:ye.data)==null?void 0:Ae.message)||"Failed to forward for approval")}finally{W(!1)}}};return console.log("Rendering PurchaseOrdersLocalForm",{id:t,isNew:n,isEdit:i}),e.jsxs("div",{className:"w-full pb-10",children:[e.jsx("div",{className:"hidden print:block p-8 max-w-[19cm] mx-auto",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:me.logoUrl||Ws,alt:me.name||"Company",className:"w-16 h-16 object-contain border border-gray-300"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold text-base",children:me.name||"Company"}),me.address&&e.jsx("div",{children:me.address}),(me.city||me.state||me.country)&&e.jsx("div",{children:[me.city,me.state,me.country].filter(Boolean).join(", ")}),e.jsxs("div",{className:"flex gap-3",children:[me.phone&&e.jsx("span",{children:me.phone}),me.email&&e.jsx("span",{children:me.email})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-xl font-semibold",children:"Purchase Order"})}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{children:["DATE: ",ue.po_date||""]}),e.jsxs("div",{children:["PO #: ",ue.po_no||""]})]})]})}),e.jsxs("div",{ref:ne,className:"hidden p-8 bg-white",style:{width:"794px",maxWidth:"794px"},children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:me.logoUrl||Ws,alt:me.name||"Company",className:"w-16 h-16 object-contain border border-gray-300"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold text-base",children:me.name||"Company"}),me.address&&e.jsx("div",{children:me.address}),(me.city||me.state||me.country)&&e.jsx("div",{children:[me.city,me.state,me.country].filter(Boolean).join(", ")}),e.jsxs("div",{className:"flex gap-3",children:[me.phone&&e.jsx("span",{children:me.phone}),me.email&&e.jsx("span",{children:me.email})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-xl font-semibold",children:"Purchase Order"})}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{children:["DATE: ",ue.po_date||""]}),e.jsxs("div",{children:["PO #: ",ue.po_no||""]}),e.jsxs("div",{children:["Supplier:"," ",((Ke=H.find(xe=>String(xe.id)===String(ue.supplier_id)))==null?void 0:Ke.supplier_name)||((Je=H.find(xe=>String(xe.id)===String(ue.supplier_id)))==null?void 0:Je.name)||""]}),e.jsxs("div",{children:["Currency: ",ue.currency||""]}),e.jsxs("div",{children:["Exchange Rate: ",Number(ue.exchange_rate||1).toFixed(2)]})]})]}),e.jsx("div",{className:"mb-2",style:{width:"100%",overflow:"visible",margin:"0 auto"},children:e.jsxs("table",{className:"text-sm",style:{width:"100%",tableLayout:"fixed"},children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"40%"}}),e.jsx("col",{style:{width:"20%"}}),e.jsx("col",{style:{width:"20%"}}),e.jsx("col",{style:{width:"20%"}})]}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left",children:"Description"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Quantity"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Unit Price"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Net Amount"})]})}),e.jsx("tbody",{children:le.map((xe,ye)=>{const Ae=Q.find(Ee=>String(Ee.id)===String(xe.item_id)),be=(Ae==null?void 0:Ae.item_name)||(Ae==null?void 0:Ae.item_code)||"Item";return e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2",children:be}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(xe.qty||0).toFixed(2)}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(xe.unit_price||0).toFixed(2)}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(xe.line_total||0).toFixed(2)})]},ye)})}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2 font-semibold",children:"Subtotal"}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Te.subTotal||0).toFixed(2)})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2 font-semibold",children:"Discount"}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Te.totalDiscount||0).toFixed(2)})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2 font-semibold",children:"Tax"}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Te.totalTax||0).toFixed(2)})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2 font-semibold",children:"Freight"}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Te.freight||0).toFixed(2)})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2 font-semibold",children:"Other Charges"}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Te.other||0).toFixed(2)})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2 font-semibold",children:"Grand Total"}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(Te.grandTotal||0).toFixed(2)})]})]})]})})]}),e.jsxs("div",{className:"w-full bg-white rounded-xl shadow-[0_4px_20px_rgba(14,54,70,0.15)] overflow-hidden",children:[e.jsxs("div",{className:"bg-[#0E3646] text-white p-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:" Purchase Order"}),e.jsx("p",{className:"opacity-90",children:"Create local and import purchase orders"})]}),e.jsxs("div",{className:"flex flex-wrap justify-between items-center p-5 bg-[#f8f9fa] border-b border-[#dee2e6] gap-4",children:[e.jsx("div",{className:"flex bg-[#f8f9fa] p-1 rounded-md border border-[#dee2e6]",children:e.jsx("button",{type:"button",className:`px-5 py-2.5 rounded text-sm font-semibold transition-all ${ue.po_type==="LOCAL"?"bg-[#0E3646] text-white":"text-gray-500 hover:bg-gray-200"}`,onClick:()=>oe({...ue,po_type:"LOCAL"}),children:" Local Order"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Re,{to:"/purchase/purchase-orders-local",className:"btn btn-secondary font-medium flex items-center gap-2",children:" View Orders"}),e.jsxs("button",{type:"button",onClick:He,className:"btn-outline font-medium flex items-center gap-2",children:[e.jsx(Cc,{className:"w-4 h-4"}),"Download PDF"]}),e.jsxs("button",{type:"button",onClick:rt,className:"btn-primary font-medium flex items-center gap-2",children:[e.jsx(tA,{className:"w-4 h-4"}),"Print"]})]})]}),e.jsxs("div",{className:"p-8",children:[l&&e.jsx("div",{className:"text-center py-4",children:"Loading..."}),c&&e.jsx("div",{className:"bg-red-50 text-red-600 p-4 rounded mb-6 border border-red-200",children:c}),e.jsxs("form",{onSubmit:Ue,children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"text-lg font-semibold text-[#0E3646] mb-5 pb-2 border-b-2 border-[#0E3646]",children:" Purchase Order Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5 required",children:"PO Number"}),e.jsx("input",{type:"text",name:"po_no",value:ue.po_no,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10 bg-[#e9ecef] cursor-not-allowed",readOnly:!0,placeholder:"Auto-generated"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5 required",children:"PO Date"}),e.jsx("input",{type:"date",name:"po_date",value:ue.po_date,onChange:Ce,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10",required:!0})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5",children:"Order Type"}),e.jsx("input",{type:"text",value:ue.po_type,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm bg-[#e9ecef]",readOnly:!0})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5",children:"Status"}),e.jsx("div",{children:e.jsx("span",{className:"px-4 py-1.5 rounded-full text-xs font-bold bg-[#e9ecef] text-[#495057]",children:ue.status})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5 required",children:"Supplier"}),e.jsxs("select",{name:"supplier_id",value:ue.supplier_id,onChange:Ce,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10",required:!0,children:[e.jsx("option",{value:"",children:"Select Supplier"}),Array.isArray(H)&&H.map(xe=>xe&&e.jsx("option",{value:xe.id,children:xe.supplier_name||xe.name||"Unknown Supplier"},xe.id))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5",children:"Reference Quotation"}),e.jsxs("select",{name:"quotation_id",value:ue.quotation_id,onChange:Ce,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10",children:[e.jsx("option",{value:"",children:"Select Quotation"}),Array.isArray(V)&&V.map(xe=>xe&&e.jsxs("option",{value:xe.id,children:[xe.quotation_no," - ",xe.supplier_name]},xe.id))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5 required",children:"Warehouse"}),e.jsxs("select",{name:"warehouse_id",value:ue.warehouse_id,onChange:Ce,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10",children:[e.jsx("option",{value:"",children:"Select Warehouse"}),Array.isArray(q)&&q.map(xe=>xe&&e.jsx("option",{value:xe.id,children:xe.warehouse_name||xe.name||"Unknown Warehouse"},xe.id))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5 required",children:"Currency"}),e.jsxs("select",{name:"currency",value:ue.currency,onChange:Ce,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10",children:[e.jsx("option",{value:"GHS",children:"GHS - Ghana Cedi"}),e.jsx("option",{value:"USD",children:"USD - US Dollar"}),e.jsx("option",{value:"EUR",children:"EUR - Euro"}),e.jsx("option",{value:"GBP",children:"GBP - British Pound"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5",children:"Exchange Rate"}),e.jsx("input",{type:"number",name:"exchange_rate",value:ue.exchange_rate,onChange:Ce,step:"0.0001",className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5 required",children:"Expected Delivery Date"}),e.jsx("input",{type:"date",name:"delivery_date",value:ue.delivery_date,onChange:Ce,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5",children:"Payment Terms (Days)"}),e.jsx("input",{type:"number",name:"payment_terms",value:ue.payment_terms,onChange:Ce,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10"})]})]})]}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-[#f8f9fa] p-5 rounded-lg border border-[#dee2e6]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{className:"text-lg font-semibold text-[#0E3646]",children:" Order Items"}),e.jsx("button",{type:"button",onClick:fe,className:"px-4 py-2 bg-[#0E3646] text-white rounded hover:bg-[#082330] transition-all text-sm font-medium flex items-center gap-2",children:" Add Item"})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("div",{className:"mb-2 text-xs text-slate-600",children:"If a unit conversion exists for the selected item and UOM, use the number of UOM button beside the UOM to convert quantity to the items default for accurate costing."}),e.jsxs("table",{className:"w-full border-collapse bg-white rounded-lg overflow-hidden",children:[e.jsx("thead",{className:"bg-[#0E3646] text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left text-[13px] w-[50px]",children:"#"}),e.jsx("th",{className:"p-3 text-left text-[13px]",children:"Item Name"}),e.jsx("th",{className:"p-3 text-left text-[13px] w-[100px]",children:"Qty"}),e.jsx("th",{className:"p-3 text-left text-[13px] w-[120px]",children:"UOM"}),e.jsx("th",{className:"p-3 text-left text-[13px] w-[120px]",children:"Unit Price"}),e.jsx("th",{className:"p-3 text-left text-[13px] w-[100px]",children:"Disc %"}),e.jsx("th",{className:"p-3 text-left text-[13px] w-[100px]",children:"Tax %"}),e.jsx("th",{className:"p-3 text-left text-[13px] w-[150px]",children:"Net Amount"}),e.jsx("th",{className:"p-3 text-left text-[13px] w-[80px]",children:"Action"})]})}),e.jsx("tbody",{children:le.map((xe,ye)=>xe&&e.jsxs("tr",{className:"border-b border-[#dee2e6] hover:bg-[#0E3646]/5 transition-colors",children:[e.jsx("td",{className:"p-3 text-sm",children:ye+1}),e.jsx("td",{className:"p-3",children:e.jsxs("select",{value:xe.item_id,onChange:Ae=>Pe(ye,"item_id",Ae.target.value),className:"w-full p-2 border border-[#dee2e6] rounded text-sm focus:outline-none focus:border-[#0E3646]",required:!0,children:[e.jsx("option",{value:"",children:"Select Item"}),Array.isArray(Q)&&Q.map(Ae=>Ae&&e.jsx("option",{value:Ae.id,children:Ae.item_name||Ae.item_code||"Unknown Item"},Ae.id))]})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",value:xe.qty,onChange:Ae=>Pe(ye,"qty",Ae.target.value),className:"w-full p-2 border border-[#dee2e6] rounded text-sm text-right focus:outline-none focus:border-[#0E3646]",min:"0",step:"1"})}),e.jsxs("td",{className:"p-3",children:[e.jsxs("select",{value:xe.uom||Le||"",onChange:Ae=>Pe(ye,"uom",Ae.target.value),className:"w-full p-2 border border-[#dee2e6] rounded text-sm text-center focus:outline-none focus:border-[#0E3646]",children:[e.jsx("option",{value:"",children:"Select UOM"}),Array.isArray(Fe)&&Fe.map(Ae=>Ae&&e.jsx("option",{value:Ae.uom_code,children:Ae.uom_name?`${Ae.uom_name} (${Ae.uom_code})`:Ae.uom_code},Ae.id))]}),(()=>{const Ae=Q.find(ht=>String(ht.id)===String(xe.item_id)),be=(Ae==null?void 0:Ae.uom)&&String(Ae.uom)||xe.uom&&String(xe.uom)||(Le?String(Le):""),Ee=(Array.isArray(J)?J:[]).filter(ht=>Number(ht.is_active)&&Number(ht.item_id)===Number(xe.item_id)&&String(ht.to_uom)===be).map(ht=>String(ht.from_uom)),dt=String(xe.uom||""),mt=dt&&dt!==be?dt:Ee[0]||"";return Ee.length>0&&mt&&mt!==be?e.jsx("button",{type:"button",className:"ml-2 px-2 py-1 text-xs border border-brand text-brand rounded hover:bg-brand hover:text-white transition-colors",onClick:()=>_e({open:!0,itemId:xe.item_id,defaultUom:be,currentUom:mt,rowIdx:ye}),children:`number of ${mt}`}):null})()]}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",value:xe.unit_price,onChange:Ae=>Pe(ye,"unit_price",Ae.target.value),className:"w-full p-2 border border-[#dee2e6] rounded text-sm text-right focus:outline-none focus:border-[#0E3646]",min:"0",step:"1"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",value:xe.discount_percent,onChange:Ae=>Pe(ye,"discount_percent",Ae.target.value),className:"w-full p-2 border border-[#dee2e6] rounded text-sm text-right focus:outline-none focus:border-[#0E3646]",min:"0",max:"100",step:"1"})}),e.jsx("td",{className:"p-3",children:e.jsxs("select",{value:(()=>{const Ae=se.find(be=>Number(be.rate)===Number(xe.tax_percent||0));return Ae?Ae.value:""})(),onChange:Ae=>{const be=Ae.target.value,Ee=se.find(mt=>String(mt.value)===String(be)),dt=Ee?Ee.rate:0;Pe(ye,"tax_percent",dt)},className:"w-full p-2 border border-[#dee2e6] rounded text-sm text-right focus:outline-none focus:border-[#0E3646]",children:[e.jsx("option",{value:"",children:"No Tax"}),se.map(Ae=>e.jsx("option",{value:Ae.value,children:Ae.label},Ae.value))]})}),e.jsxs("td",{className:"p-3 text-right font-medium text-sm",children:[ue.currency," ",xe.line_total.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("button",{type:"button",onClick:()=>he(ye),className:"text-[#dc3545] hover:bg-[#dc3545]/10 p-1.5 rounded transition-colors",children:""})})]},ye))})]})]}),e.jsxs("div",{className:"bg-[#f8f9fa] p-5 rounded-lg mt-5 border border-[#dee2e6]",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b border-[#dee2e6]",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Items:"}),e.jsx("span",{className:"font-bold",children:le.filter(xe=>xe&&xe.item_id).length})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-[#dee2e6]",children:[e.jsx("span",{className:"text-sm font-medium",children:"Sub Total:"}),e.jsxs("span",{className:"font-bold",children:[ue.currency," ",Te.subTotal.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-[#dee2e6] text-[#dc3545]",children:[e.jsx("span",{className:"text-sm font-medium",children:"Discount:"}),e.jsxs("span",{className:"font-bold",children:["-",ue.currency," ",Te.totalDiscount.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-[#dee2e6] text-[#0E3646]",children:[e.jsx("span",{className:"text-sm font-medium",children:"Tax Amount:"}),e.jsxs("span",{className:"font-bold",children:[ue.currency," ",Te.totalTax.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-[#dee2e6] items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Freight Charges:"}),e.jsx("input",{type:"number",name:"freight_amount",value:ue.freight_amount,onChange:Ce,className:"w-[150px] p-1.5 border border-[#dee2e6] rounded text-sm text-right focus:outline-none focus:border-[#0E3646]"})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-[#dee2e6] items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Other Charges:"}),e.jsx("input",{type:"number",name:"other_charges",value:ue.other_charges,onChange:Ce,className:"w-[150px] p-1.5 border border-[#dee2e6] rounded text-sm text-right focus:outline-none focus:border-[#0E3646]"})]}),e.jsxs("div",{className:"flex justify-between py-3 text-lg font-bold text-[#0E3646]",children:[e.jsx("span",{children:"GRAND TOTAL:"}),e.jsxs("span",{children:[ue.currency," ",Te.grandTotal.toLocaleString(void 0,{minimumFractionDigits:2})]})]})]})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"text-lg font-semibold text-[#0E3646] mb-5 pb-2 border-b-2 border-[#0E3646]",children:" Terms & Conditions"}),e.jsx("div",{className:"flex flex-col",children:e.jsx("textarea",{name:"terms_conditions",value:ue.terms_conditions,onChange:Ce,rows:"6",className:"p-3 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10",placeholder:"Enter terms and conditions..."})})]}),e.jsxs("div",{className:"flex flex-wrap justify-between items-center mt-8 gap-4",children:[e.jsx("div",{children:e.jsx("button",{type:"button",className:"px-5 py-2.5 bg-[#dc3545] text-white rounded hover:bg-[#c82333] transition-all font-medium flex items-center gap-2",onClick:()=>alert("Delete functionality not implemented yet"),children:" Delete"})}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{type:"button",className:"px-5 py-2.5 bg-[#6c757d] text-white rounded hover:bg-[#5a6268] transition-all font-medium flex items-center gap-2",onClick:()=>oe({...ue,remarks:""}),children:" Clear"}),e.jsx("button",{type:"submit",disabled:d,"data-submit-type":"draft",className:"px-5 py-2.5 bg-[#0E3646] text-white rounded hover:bg-[#082330] transition-all font-medium flex items-center gap-2 disabled:opacity-70",children:d?"Saving...":" Save as Draft"}),e.jsx("button",{type:"button",className:"px-5 py-2.5 bg-[#17a2b8] text-white rounded hover:bg-[#138496] transition-all font-medium flex items-center gap-2",onClick:()=>window.print(),children:" Print"}),e.jsx("button",{type:"submit",disabled:d,"data-submit-type":"pending",className:"px-5 py-2.5 bg-[#28a745] text-white rounded hover:bg-[#218838] transition-all font-medium flex items-center gap-2 disabled:opacity-70",children:" Submit for Approval"})]})]})]})]})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-erp w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-brand text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Forward for Approval"}),e.jsx("button",{onClick:()=>{p(!1),N(null),F(null),y("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Document No:"," ",e.jsx("span",{className:"font-semibold",children:ue.po_no})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:j?`${j.workflow_name} (${j.workflow_code})`:"None (inactive)"})]}),e.jsx("div",{children:g?e.jsx("div",{className:"text-sm",children:"Loading workflow..."}):null}),e.jsx("div",{children:b?e.jsx("div",{className:"text-sm text-red-600",children:b}):null}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Target Approver"}),(()=>{const ye=Array.isArray(I)&&I.length>0?I[0]:null,Ae=ye?Array.isArray(ye.approvers)&&ye.approvers.length?ye.approvers.map(be=>({id:be.id,name:be.username})):ye.approver_user_id?[{id:ye.approver_user_id,name:ye.approver_name||String(ye.approver_user_id)}]:[]:[];return Ae.length>0?e.jsxs("div",{className:"mt-1",children:[e.jsxs("select",{className:"input w-full",value:T||"",onChange:be=>Y(be.target.value?Number(be.target.value):null),children:[e.jsx("option",{value:"",children:"Select target approver"}),Ae.map(be=>e.jsx("option",{value:be.id,children:be.name},be.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:_?`Step ${_.stepOrder}  ${_.stepName}${_.approvalLimit!=null?`  Limit: ${Number(_.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:j?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})()]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{p(!1),N(null),F(null),y("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:Ye,disabled:E||n,children:E?"Forwarding...":"Forward"})]})]})}),e.jsx(Ic,{open:Ie.open,itemId:Ie.itemId,defaultUom:Ie.defaultUom,currentUom:Ie.currentUom,onClose:()=>_e({open:!1,itemId:null,defaultUom:"",currentUom:"",rowIdx:null}),onApply:xe=>{const{converted_qty:ye}=xe||{},Ae=Ie.rowIdx;Ae!=null&&X(be=>{const Ee=[...be],dt={...Ee[Ae]},mt=Number(ye||0);dt.qty=mt,dt.uom=Ie.defaultUom||dt.uom;const it=Number(dt.unit_price||0),ht=Number(dt.discount_percent||0),ft=Number(dt.tax_percent||0),Rt=mt*it,Ge=Rt*(ht/100),at=Rt-Ge,je=at*(ft/100);return dt.line_total=at+je,Ee[Ae]=dt,Ee})}})]})}function Yee(){const[t,s]=f.useState(""),[r,a]=f.useState("ALL"),[n,i]=f.useState([]),[l,o]=f.useState(!1),[d,u]=f.useState(""),[c,h]=f.useState(!1),[m,p]=f.useState(null),[g,x]=f.useState(!1),[b,y]=f.useState(""),[j,N]=f.useState(null),[_,F]=f.useState(null),[I,w]=f.useState([]),[E,W]=f.useState(!1),[R,U]=f.useState(null),[T,Y]=f.useState(null),{canPerformAction:H}=Ls();f.useEffect(()=>{let P=!0;return o(!0),u(""),Z.get("/purchase/orders").then(C=>{var B;if(!P)return;const k=Array.isArray((B=C.data)==null?void 0:B.items)?C.data.items:[];i(k.filter(G=>String(G.po_type||"").toUpperCase()==="IMPORT"))}).catch(C=>{var k,B;P&&u(((B=(k=C==null?void 0:C.response)==null?void 0:k.data)==null?void 0:B.message)||"Failed to load purchase orders")}).finally(()=>{P&&o(!1)}),()=>{P=!1}},[]);const M=P=>({DRAFT:"badge-warning",PENDING_APPROVAL:"badge-warning",APPROVED:"badge-info",RECEIVED:"badge-success",RETURNED:"badge-error",CANCELLED:"badge-error"})[P]||"badge-info",q=f.useMemo(()=>n.filter(P=>{const C=String(P.po_no||"").toLowerCase().includes(t.toLowerCase())||String(P.supplier_name||"").toLowerCase().includes(t.toLowerCase()),k=r==="ALL"||P.status===r;return C&&k}),[n,t,r]),z=async P=>{var C,k,B;if(p(P),h(!0),y(""),R)await Q();else try{x(!0);const G=await Z.get("/workflows"),O=Array.isArray((C=G.data)==null?void 0:C.items)?G.data.items:[];U(O),await L(O)}catch(G){y(((B=(k=G==null?void 0:G.response)==null?void 0:k.data)==null?void 0:B.message)||"Failed to load workflows")}finally{x(!1)}},Q=async()=>{var B,G,O;if(!R||!R.length){N(null),F(null),y("");return}const P="/purchase/purchase-orders-import",C=K=>String(K||"").trim().toUpperCase().replace(/\s+/g,"_"),k=R.find(K=>Number(K.is_active)===1&&String(K.document_route)===P)||R.find(K=>Number(K.is_active)===1&&C(K.document_type)==="PURCHASE_ORDER")||null;if(N(k||null),F(null),!!k)try{x(!0);const J=(B=(await Z.get(`/workflows/${k.id}`)).data)==null?void 0:B.item,te=Array.isArray(J==null?void 0:J.steps)?J.steps:[];w(te);const se=te[0]||null;if(F(se?{userId:se.approver_user_id,name:se.approver_name,stepName:se.step_name,stepOrder:se.step_order,approvalLimit:se.approval_limit}:null),se){const ae=(Array.isArray(se.approvers)&&se.approvers.length?se.approvers[0].id:se.approver_user_id)||null;Y(ae)}else Y(null)}catch(K){y(((O=(G=K==null?void 0:K.response)==null?void 0:G.data)==null?void 0:O.message)||"Failed to load workflow details")}finally{x(!1)}},L=async P=>{var G,O,K;if(!P||!P.length){N(null),F(null),y("");return}const C="/purchase/purchase-orders-import",k=J=>String(J||"").trim().toUpperCase().replace(/\s+/g,"_"),B=P.find(J=>Number(J.is_active)===1&&String(J.document_route)===C)||P.find(J=>Number(J.is_active)===1&&k(J.document_type)==="PURCHASE_ORDER")||null;if(N(B||null),F(null),!!B)try{x(!0);const te=(G=(await Z.get(`/workflows/${B.id}`)).data)==null?void 0:G.item,se=Array.isArray(te==null?void 0:te.steps)?te.steps:[];w(se);const ae=se[0]||null;F(ae?{userId:ae.approver_user_id,name:ae.approver_name,stepName:ae.step_name,stepOrder:ae.step_order,approvalLimit:ae.approval_limit}:null)}catch(J){y(((K=(O=J==null?void 0:J.response)==null?void 0:O.data)==null?void 0:K.message)||"Failed to load workflow details")}finally{x(!1)}},V=async()=>{var P,C,k;if(m){W(!0),y("");try{const B=await Z.post(`/purchase/orders/${m.id}/submit`,{amount:(m==null?void 0:m.total_amount)??null,workflow_id:j?j.id:null,target_user_id:T||null}),G=((P=B==null?void 0:B.data)==null?void 0:P.status)||"PENDING_APPROVAL";i(O=>O.map(K=>K.id===m.id?{...K,status:G}:K)),h(!1),p(null)}catch(B){y(((k=(C=B==null?void 0:B.response)==null?void 0:C.data)==null?void 0:k.message)||"Failed to forward for approval")}finally{W(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Purchase Orders - Import"}),e.jsx("p",{className:"text-sm mt-1",children:"Manage import purchase orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/purchase",className:"btn btn-secondary",children:"Return to Menu"}),H("purchase:purchase-orders-import","create")&&e.jsx(Re,{to:"/purchase/purchase-orders-import/new",className:"btn-success",children:"+ New Purchase Order"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by PO no or supplier...",className:"input",value:t,onChange:P=>s(P.target.value)})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs("select",{className:"input",value:r,onChange:P=>a(P.target.value),children:[e.jsx("option",{value:"ALL",children:"All Status"}),e.jsx("option",{value:"DRAFT",children:"Draft"}),e.jsx("option",{value:"APPROVED",children:"Approved"}),e.jsx("option",{value:"RECEIVED",children:"Received"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})})]})}),e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"PO No"}),e.jsx("th",{children:"PO Date"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{className:"text-right",children:"Total Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[l?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):d?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-red-600",children:d})}):null,q.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No purchase orders found"})}):q.map(P=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:P.po_no}),e.jsx("td",{children:P.po_date?new Date(P.po_date).toLocaleDateString():""}),e.jsx("td",{children:P.supplier_name}),e.jsx("td",{className:"text-right font-medium",children:Number(P.total_amount||0).toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${M(P.status)}`,children:P.status})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[H("purchase:purchase-orders-import","view")&&e.jsx(Re,{to:`/purchase/purchase-orders-import/${P.id}`,className:"text-brand hover:text-brand-600 dark:text-brand-300 dark:hover:text-brand-200 text-sm font-medium",children:"View"}),P.status==="DRAFT"&&H("purchase:purchase-orders-import","edit")?e.jsx(Re,{to:`/purchase/purchase-orders-import/${P.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-medium",children:"Edit"}):null,P.status==="APPROVED"?e.jsx("span",{className:"text-sm font-medium px-2 py-1 rounded bg-green-500 text-white",children:"Approved"}):P.status==="DRAFT"||P.status==="RETURNED"?e.jsx("button",{type:"button",onClick:()=>z(P),className:"text-sm font-medium px-2 py-1 rounded bg-brand text-white hover:bg-brand-700 transition-colors",children:"Forward for Approval"}):null]})})]},P.id))]})]})}),e.jsx("div",{className:"card-body border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{children:["Showing ",q.length," of ",n.length," orders"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-success px-3 py-1.5",disabled:!0,children:"Previous"}),e.jsx("button",{className:"btn-success px-3 py-1.5",disabled:!0,children:"Next"})]})]})})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-erp w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-brand text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Forward for Approval"}),e.jsx("button",{onClick:()=>{h(!1),p(null),N(null),F(null),y("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Document No:"," ",e.jsx("span",{className:"font-semibold",children:m==null?void 0:m.po_no})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:j?`${j.workflow_name} (${j.workflow_code})`:"None (inactive)"})]}),e.jsx("div",{children:g?e.jsx("div",{className:"text-sm",children:"Loading workflow..."}):null}),e.jsx("div",{children:b?e.jsx("div",{className:"text-sm text-red-600",children:b}):null}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Target Approver"}),(()=>{const C=Array.isArray(I)&&I.length>0?I[0]:null,k=C?Array.isArray(C.approvers)&&C.approvers.length?C.approvers.map(B=>({id:B.id,name:B.username})):C.approver_user_id?[{id:C.approver_user_id,name:C.approver_name||String(C.approver_user_id)}]:[]:[];return k.length>0?e.jsxs("div",{className:"mt-1",children:[e.jsxs("select",{className:"input w-full",value:T||"",onChange:B=>Y(B.target.value?Number(B.target.value):null),children:[e.jsx("option",{value:"",children:"Select target approver"}),k.map(B=>e.jsx("option",{value:B.id,children:B.name},B.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:_?`Step ${_.stepOrder}  ${_.stepName}${_.approvalLimit!=null?`  Limit: ${Number(_.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:j?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})()]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{h(!1),p(null),N(null),F(null),y("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:V,disabled:E,children:E?"Forwarding...":"Forward"})]})]})})]})}function zb(){var Je,xe;const{id:t}=Ps(),s=Ur(),r=ps(),{user:a}=Kr(),n=!t||t==="new",i=!!t&&t!=="new"&&(s.pathname.includes("/edit")||(()=>{try{const ye=new URLSearchParams(s.search||""),Ae=String(ye.get("mode")||"").toLowerCase(),be=String(ye.get("edit")||"").toLowerCase();return Ae==="edit"||be==="1"||be==="true"}catch{return!1}})()),l=!!t&&t!=="new"&&!i,[o,d]=f.useState(!1),[u,c]=f.useState(!1),[h,m]=f.useState(""),[p,g]=f.useState(!1),[x,b]=f.useState(!1),[y,j]=f.useState(""),[N,_]=f.useState(null),[F,I]=f.useState(null),[w,E]=f.useState([]),[W,R]=f.useState(!1),[U,T]=f.useState(null),[Y,H]=f.useState(null),[M,q]=f.useState([]),[z,Q]=f.useState([]),[L,V]=f.useState([]),[P,C]=f.useState([]),[k,B]=f.useState([]),[G,O]=f.useState([]),[K,J]=f.useState([]),[te,se]=f.useState([]),[ae,ne]=f.useState([]),ue=f.useRef(null),[oe,le]=f.useState({open:!1,itemId:null,defaultUom:"",currentUom:"",rowIdx:null}),[X,me]=f.useState({po_no:"",po_date:new Date().toISOString().split("T")[0],supplier_id:"",quotation_id:"",po_type:"IMPORT",status:"DRAFT",warehouse_id:"",currency:"USD",exchange_rate:1,delivery_date:"",payment_terms:30,delivery_terms:"",remarks:"",port_loading:"",port_discharge:"",incoterms:"",hs_code:"",shipping_date:"",insurance_required:!1,freight_amount:0,other_charges:0,discount_amount:0,tax_amount:0,terms_conditions:`1. All goods must meet specified quality standards
2. Delivery to be made as per schedule
3. Payment terms: Net 30 days from delivery
4. Supplier responsible for any defects within warranty period
5. Late delivery penalties may apply as per agreement
6. All disputes subject to arbitration in Accra, Ghana`}),[we,Ie]=f.useState([{item_id:"",qty:0,uom:"",unit_price:0,discount_percent:0,tax_percent:0,line_total:0}]),[_e,Fe]=f.useState({name:"",address:"",phone:"",email:"",city:"",state:"",country:"",logoUrl:""}),{uoms:Le}=$i(),rt=f.useMemo(()=>{const ye=Array.isArray(Le)?Le:[],Ae=ye.find(be=>String(be.uom_code||"").toUpperCase()==="PCS")||ye[0];return Ae&&Ae.uom_code?Ae.uom_code:"PCS"},[Le]);f.useEffect(()=>{let ye=!0;async function Ae(){var be,Ee,dt,mt,it,ht,ft,Rt;try{const[Ge,at,je,Se,nt]=await Promise.allSettled([Z.get("/purchase/suppliers"),Z.get("/inventory/warehouses"),Z.get("/inventory/items"),Z.get("/purchase/quotations"),Z.get("/inventory/unit-conversions")]);if(!ye)return;if(Ge.status==="fulfilled"){const Ze=Array.isArray((be=Ge.value.data)==null?void 0:be.items)?Ge.value.data.items:[];q(Ze)}if(at.status==="fulfilled"&&Q(Array.isArray((Ee=at.value.data)==null?void 0:Ee.items)?at.value.data.items:[]),je.status==="fulfilled"&&V(Array.isArray((dt=je.value.data)==null?void 0:dt.items)?je.value.data.items:[]),Se.status==="fulfilled"){const Ze=Array.isArray((mt=Se.value.data)==null?void 0:mt.items)?Se.value.data.items:[];B(Ze);const gt=String(X.supplier_id||""),jt=gt&&gt.length?Ze.filter(Mt=>String(Mt.supplier_id)===String(gt)):[];C(jt)}if(nt.status==="fulfilled"&&ne(Array.isArray((it=nt.value.data)==null?void 0:it.items)?nt.value.data.items:[]),Ge.status==="rejected"&&Se.status==="fulfilled"){const Ze=Array.isArray((ht=Se.value.data)==null?void 0:ht.items)?Se.value.data.items:[],gt=new Set,jt=[];for(const Mt of Ze){const Ne=Mt.supplier_id;Ne&&!gt.has(String(Ne))&&(gt.add(String(Ne)),jt.push({id:Ne,supplier_name:Mt.supplier_name,supplier_type:Mt.supplier_type||null}))}jt.length&&q(jt)}Ge.status==="rejected"&&at.status==="rejected"&&je.status==="rejected"&&Se.status==="rejected"&&m("Failed to load lookups")}catch(Ge){if(!ye)return;m(((Rt=(ft=Ge==null?void 0:Ge.response)==null?void 0:ft.data)==null?void 0:Rt.message)||"Failed to load lookups")}}return Ae(),()=>{ye=!1}},[]),f.useEffect(()=>{if(i)return;let ye=!0;return Z.get("/purchase/orders/next-no",{params:{po_type:X.po_type||"IMPORT"}}).then(Ae=>{var be;ye&&(be=Ae.data)!=null&&be.nextNo&&me(Ee=>({...Ee,po_no:Ee.po_no||Ae.data.nextNo}))}).catch(Ae=>console.error("Failed to load next purchase order number",Ae)),()=>{ye=!1}},[i,X.po_type]),f.useEffect(()=>{He()},[]);async function He(){var ye,Ae,be;try{const dt=(Ae=(ye=(await Z.get("/admin/me")).data)==null?void 0:ye.scope)==null?void 0:Ae.companyId;if(dt){const it=((be=(await Z.get(`/admin/companies/${dt}`)).data)==null?void 0:be.item)||{};Fe(ht=>({...ht,name:it.name||ht.name||"",address:it.address||ht.address||"",phone:it.telephone||ht.phone||"",email:it.email||ht.email||"",city:it.city||ht.city||"",state:it.state||ht.state||"",country:it.country||ht.country||"",logoUrl:it.has_logo===1||it.has_logo===!0?`/api/admin/companies/${dt}/logo`:Ws}))}else Fe(mt=>({...mt,logoUrl:mt.logoUrl||Ws}))}catch{Fe(Ee=>({...Ee,logoUrl:Ee.logoUrl||Ws}))}}f.useEffect(()=>{let ye=!0;async function Ae(){var be;try{const Ee=await Z.get("/finance/currencies");if(!ye)return;const dt=Array.isArray((be=Ee.data)==null?void 0:be.items)?Ee.data.items:[];O(dt)}catch(Ee){console.error("Error fetching currencies:",Ee)}}return Ae(),()=>{ye=!1}},[]),f.useEffect(()=>{async function ye(){var Ae;try{const be=Array.isArray(G)?G:[];if(!be.length)return;const Ee=be.find(ft=>String(ft.is_base)==="1"||ft.is_base===1||ft.is_base===!0)||be.find(ft=>String(ft.code||ft.currency_code||"").toUpperCase()==="GHS")||be.find(ft=>/ghana|cedi/i.test(String(ft.name||ft.currency_name||""))),dt=be.find(ft=>String(ft.code||ft.currency_code||"").toUpperCase()==="USD");if(!Ee||!dt||Ee.id===dt.id)return;const mt=X.po_date||new Date().toISOString().split("T")[0],it=await Z.get("/finance/currency-rates",{params:{fromCurrencyId:dt.id,toCurrencyId:Ee.id,to:mt}});if(!(Array.isArray((Ae=it.data)==null?void 0:Ae.items)?it.data.items:[]).length)try{await Z.post("/finance/currency-rates",{fromCurrencyId:dt.id,toCurrencyId:Ee.id,rate:1,rateDate:mt})}catch(ft){console.error("Failed to seed USD->GHS rate",ft)}}catch(be){console.error("ensureUsdGhsRate error",be)}}ye()},[G,X.po_date]),f.useEffect(()=>{let ye=!0;async function Ae(){var be;try{const Ee=await Z.get("/sales/prices/standard");if(!ye)return;const dt=Array.isArray((be=Ee.data)==null?void 0:be.items)?Ee.data.items:[];J(dt)}catch(Ee){console.error("Error fetching standard prices:",Ee)}}return Ae(),()=>{ye=!1}},[]),f.useEffect(()=>{let ye=!0;async function Ae(){var be;try{const Ee=await Z.get("/finance/tax-codes");if(!ye)return;const mt=(Array.isArray((be=Ee.data)==null?void 0:be.items)?Ee.data.items:[]).map(it=>({value:it.id,label:it.name,rate:Number(it.rate_percent)}));se(mt)}catch(Ee){console.error("Error fetching tax codes:",Ee)}}return Ae(),()=>{ye=!1}},[]);const st=async ye=>{var mt;const Ae=String(ye||"").toUpperCase(),be=Array.isArray(G)?G:[];if(!Ae||!be.length)return;const Ee=be.find(it=>String(it.is_base)==="1"||it.is_base===1||it.is_base===!0)||be.find(it=>String(it.code||it.currency_code||"").toUpperCase()==="GHS")||be.find(it=>/ghana|cedi/i.test(String(it.name||it.currency_name||""))),dt=be.find(it=>String(it.code||it.currency_code||"").toUpperCase()===Ae);if(!Ee||!dt||Ee.id===dt.id){me(it=>({...it,exchange_rate:1}));return}try{const it=X.po_date||new Date().toISOString().split("T")[0],ht=await Z.get("/finance/currency-rates",{params:{fromCurrencyId:dt.id,toCurrencyId:Ee.id,to:it}}),Rt=(Array.isArray((mt=ht.data)==null?void 0:mt.items)?ht.data.items:[])[0];if(Rt&&Rt.rate)me(Ge=>({...Ge,exchange_rate:Number(Rt.rate)||Ge.exchange_rate||1}));else try{await Z.post("/finance/currency-rates",{fromCurrencyId:dt.id,toCurrencyId:Ee.id,rate:1,rateDate:it}),me(Ge=>({...Ge,exchange_rate:1}))}catch{me(Ge=>({...Ge,exchange_rate:1}))}}catch{}};f.useEffect(()=>{st(X.currency)},[G,X.currency,X.po_date]),f.useEffect(()=>{if(!t||t==="new")return;let ye=!0;return d(!0),m(""),Z.get(`/purchase/orders/${t}`).then(Ae=>{var dt,mt,it;if(!ye)return;const be=(dt=Ae.data)==null?void 0:dt.item,Ee=Array.isArray((it=(mt=Ae.data)==null?void 0:mt.item)==null?void 0:it.details)?Ae.data.item.details:[];be&&(me({po_no:be.po_no||"",po_date:be.po_date||new Date().toISOString().split("T")[0],supplier_id:be.supplier_id?String(be.supplier_id):"",po_type:be.po_type||"IMPORT",status:be.status||"DRAFT",warehouse_id:be.warehouse_id?String(be.warehouse_id):"",currency:be.currency||"GHS",exchange_rate:Number(be.exchange_rate)||1,delivery_date:be.delivery_date||"",payment_terms:be.payment_terms||30,delivery_terms:be.delivery_terms||"",remarks:be.remarks||"",port_loading:be.port_loading||"",port_discharge:be.port_discharge||"",incoterms:be.incoterms||"",hs_code:be.hs_code||"",shipping_date:be.shipping_date||"",insurance_required:!!be.insurance_required,freight_amount:Number(be.freight_amount)||0,other_charges:Number(be.other_charges)||0,discount_amount:Number(be.discount_amount)||0,tax_amount:Number(be.tax_amount)||0,terms_conditions:be.terms_conditions||X.terms_conditions}),Ie(Ee.length?Ee.filter(ht=>ht).map(ht=>({item_id:ht.item_id?String(ht.item_id):"",qty:Number(ht.qty)||0,uom:ht.uom||"",unit_price:Number(ht.unit_price)||0,discount_percent:Number(ht.discount_percent)||0,tax_percent:Number(ht.tax_percent)||0,line_total:Number(ht.line_total)||0})):[{item_id:"",qty:0,uom:"",unit_price:0,discount_percent:0,tax_percent:0,line_total:0}]))}).catch(Ae=>{var be,Ee;ye&&m(((Ee=(be=Ae==null?void 0:Ae.response)==null?void 0:be.data)==null?void 0:Ee.message)||"Failed to load purchase order")}).finally(()=>{ye&&d(!1)}),()=>{ye=!1}},[t]);const De=f.useMemo(()=>{let ye=0,Ae=0,be=0;we.forEach(it=>{if(!it)return;const ht=Number(it.qty)||0,ft=Number(it.unit_price)||0,Rt=Number(it.discount_percent)||0,Ge=Number(it.tax_percent)||0,at=ht*ft,je=at*(Rt/100),nt=(at-je)*(Ge/100);ye+=at,Ae+=je,be+=nt});const Ee=Number(X.freight_amount)||0,dt=Number(X.other_charges)||0,mt=ye-Ae+be+Ee+dt;return{subTotal:ye,totalDiscount:Ae,totalTax:be,freight:Ee,other:dt,grandTotal:mt}},[we,X.freight_amount,X.other_charges]),Te=async ye=>{var mt,it;const{name:Ae,value:be,type:Ee,checked:dt}=ye.target;if(me(ht=>({...ht,[Ae]:Ee==="checkbox"?dt:be})),Ae==="supplier_id"){const ht=String(be||"");if(ht){const ft=(Array.isArray(k)?k:[]).filter(Rt=>String(Rt.supplier_id)===ht);C(ft),me(Rt=>{const Ge=ft.some(at=>String(at.id)===String(Rt.quotation_id||""));return{...Rt,quotation_id:Ge?Rt.quotation_id:""}});try{const Rt=M.find(at=>String(at.id)===ht),Ge=Rt&&Rt.supplier_code&&String(Rt.supplier_code).trim()||(Rt?`SU-${String(Number(Rt.id||0)).padStart(6,"0")}`:"");if(Ge){const at=await Z.get("/finance/accounts",{params:{search:Ge}}),je=Array.isArray((mt=at.data)==null?void 0:mt.items)?at.data.items:[],Se=je.find(Ze=>String(Ze.code)===Ge)||je[0]||null,nt=Se&&(Se.currency_code||Se.currency||Se.currencyCode)||null;if(nt){const Ze=String(nt).toUpperCase();me(gt=>({...gt,currency:Ze})),await st(Ze)}}}catch{}}else C(Array.isArray(k)?k:[])}if(Ae==="quotation_id"&&be)try{const ft=(it=(await Z.get(`/purchase/quotations/${be}`)).data)==null?void 0:it.item;if(ft){const Ge=(Array.isArray(G)?G:[]).find(nt=>String(nt.id)===String(ft.currency_id||"")),at=String((Ge==null?void 0:Ge.code)||(Ge==null?void 0:Ge.currency_code)||ft.currency_code||ft.currency||"").toUpperCase()||X.currency,Se=new Set(["USD","EUR","GBP"]).has(at)?at:X.currency;if(me(nt=>({...nt,supplier_id:ft.supplier_id?String(ft.supplier_id):nt.supplier_id,currency:Se,exchange_rate:ft.exchange_rate!==void 0&&ft.exchange_rate!==null?Number(ft.exchange_rate)||nt.exchange_rate||1:nt.exchange_rate,delivery_date:ft.valid_until||nt.delivery_date||"",remarks:ft.remarks||nt.remarks||""})),ft.exchange_rate!==void 0&&ft.exchange_rate!==null||await st(Se),ft.details){const nt=ft.details.map(Ze=>({item_id:String(Ze.item_id),qty:Number(Ze.qty)||0,uom:Ze.uom||rt,unit_price:Number(Ze.unit_price)||0,discount_percent:Number(Ze.discount_percent)||0,tax_percent:0,line_total:Number(Ze.line_total)||0}));Ie(nt)}}}catch(ht){console.error("Failed to fetch quotation details",ht)}Ae==="currency"&&await st(be)},Ce=()=>{window.print()},Pe=async()=>{const ye=ue.current;if(!ye)return;const Ae=ye.style.cssText;ye.style.cssText=Ae+";position:fixed;left:-10000px;top:0;display:block;z-index:-1;background:white;width:794px;padding:32px;";try{const be=await wi(ye,{scale:2,useCORS:!0}),Ee=be.toDataURL("image/png"),dt=new hs("p","mm","a4"),mt=dt.internal.pageSize.getWidth(),it=dt.internal.pageSize.getHeight(),ht=mt,ft=be.height*ht/be.width;let Rt=0;for(;Rt<ft;)dt.addImage(Ee,"PNG",0,-Rt,ht,ft),Rt+=it,Rt<ft&&dt.addPage();const Ge="PurchaseOrder_"+(X.po_no||new Date().toISOString().slice(0,10))+".pdf";dt.save(Ge)}finally{ye.style.cssText=Ae}},fe=(ye,Ae,be)=>{const Ee=[...we];if(Ee[ye]={...Ee[ye],[Ae]:be},Ae==="item_id"){const je=L.find(gt=>String(gt.id)===String(be)),Se=(je==null?void 0:je.uom)||rt;Ee[ye].uom=Se;let Ze=je&&Number(je.cost_price)||0;if(Array.isArray(K)&&K.length){const gt=K.filter(jt=>String(jt.product_id)===String(be)).sort((jt,Mt)=>{const Ne=jt.effective_date?new Date(jt.effective_date).getTime():0;return(Mt.effective_date?new Date(Mt.effective_date).getTime():0)-Ne||new Date(Mt.created_at).getTime()-new Date(jt.created_at).getTime()});gt.length>0&&(Ze=Number(gt[0].cost_price)||Ze)}Ee[ye].unit_price=Ze}const dt=Number(Ee[ye].qty)||0,mt=Number(Ee[ye].unit_price)||0,it=Number(Ee[ye].discount_percent)||0,ht=Number(Ee[ye].tax_percent)||0,ft=dt*mt,Rt=ft*(it/100),Ge=ft-Rt,at=Ge*(ht/100);Ee[ye].line_total=Ge+at,Ie(Ee)},he=()=>{Ie(ye=>[...ye,{item_id:"",qty:0,uom:"",unit_price:0,discount_percent:0,tax_percent:0,line_total:0}])},Ue=ye=>{Ie(Ae=>Ae.length>1?Ae.filter((be,Ee)=>Ee!==ye):Ae)},Ye=async ye=>{var Ae,be,Ee,dt,mt,it,ht;ye.preventDefault(),c(!0),m("");try{const ft=(Ee=(be=(Ae=ye==null?void 0:ye.nativeEvent)==null?void 0:Ae.submitter)==null?void 0:be.dataset)==null?void 0:Ee.submitType,Rt=ft==="pending"?"PENDING_APPROVAL":ft==="draft"?"DRAFT":X.status||"DRAFT";if(!X.supplier_id){m("Supplier is required"),c(!1);return}const Ge=we.filter(je=>je.item_id&&Number(je.qty)>0&&Number(je.unit_price)>0);if(Ge.length===0){m("At least one item with quantity and unit price is required"),c(!1);return}const at={po_no:X.po_no,po_date:X.po_date,po_type:"IMPORT",status:Rt,supplier_id:Number(X.supplier_id),warehouse_id:Number(X.warehouse_id)||null,currency:X.currency,exchange_rate:Number(X.exchange_rate)||1,delivery_date:X.delivery_date||"",payment_terms:Number(X.payment_terms)||0,delivery_terms:X.delivery_terms||"",remarks:X.remarks||"",port_loading:X.port_loading||"",port_discharge:X.port_discharge||"",incoterms:X.incoterms||"",hs_code:X.hs_code||"",shipping_date:X.shipping_date||"",insurance_required:!!X.insurance_required,freight_amount:Number(X.freight_amount)||0,other_charges:Number(X.other_charges)||0,discount_amount:De.totalDiscount,tax_amount:De.totalTax,total_amount:De.grandTotal,terms_conditions:X.terms_conditions||"",quotation_id:X.quotation_id?Number(X.quotation_id):void 0,details:Ge.map(je=>({item_id:Number(je.item_id),qty:Number(je.qty)||0,uom:je.uom||"",unit_price:Number(je.unit_price)||0,discount_percent:Number(je.discount_percent)||0,tax_percent:Number(je.tax_percent)||0,line_total:Number(je.line_total)||0}))};if(ft==="pending"){if(i)await Z.post(`/purchase/orders/${t}/submit`,{amount:De.grandTotal??null,workflow_id:N?N.id:null,target_user_id:Y||null});else{const je=await Z.post("/purchase/orders",at),Se=(dt=je==null?void 0:je.data)==null?void 0:dt.id;Se&&await Z.post(`/purchase/orders/${Se}/submit`,{amount:De.grandTotal??null,workflow_id:N?N.id:null,target_user_id:Y||null})}r("/purchase/purchase-orders-import");return}if(i)await Z.put(`/purchase/orders/${t}/status`,{status:Rt});else{const je=await Z.post("/purchase/orders",at),Se=(mt=je==null?void 0:je.data)==null?void 0:mt.id;Se&&Rt!=="DRAFT"&&await Z.put(`/purchase/orders/${Se}/status`,{status:Rt})}r("/purchase/purchase-orders-import")}catch(ft){const Rt=((ht=(it=ft==null?void 0:ft.response)==null?void 0:it.data)==null?void 0:ht.message)||(ft==null?void 0:ft.message)||"Error saving purchase order. Please try again.";m(Rt)}finally{c(!1)}},Ke=async()=>{var ye,Ae,be;if(!n){R(!0),j("");try{const Ee=await Z.post(`/purchase/orders/${t}/submit`,{amount:De.grandTotal??null,workflow_id:N?N.id:null,target_user_id:Y||null}),dt=((ye=Ee==null?void 0:Ee.data)==null?void 0:ye.status)||"PENDING_APPROVAL";me(mt=>({...mt,status:dt})),g(!1)}catch(Ee){j(((be=(Ae=Ee==null?void 0:Ee.response)==null?void 0:Ae.data)==null?void 0:be.message)||"Failed to forward for approval")}finally{R(!1)}}};return console.log("Rendering PurchaseOrdersImportForm",{id:t,isNew:n,isEdit:i,isView:l}),e.jsxs("div",{className:"w-full pb-10",children:[e.jsx("div",{className:"hidden print:block p-8 max-w-[19cm] mx-auto",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:_e.logoUrl||Ws,alt:_e.name||"Company",className:"w-16 h-16 object-contain border border-gray-300"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold text-base",children:_e.name||"Company"}),_e.address&&e.jsx("div",{children:_e.address}),(_e.city||_e.state||_e.country)&&e.jsx("div",{children:[_e.city,_e.state,_e.country].filter(Boolean).join(", ")}),e.jsxs("div",{className:"flex gap-3",children:[_e.phone&&e.jsx("span",{children:_e.phone}),_e.email&&e.jsx("span",{children:_e.email})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-xl font-semibold",children:"Purchase Order"})}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{children:["DATE: ",X.po_date||""]}),e.jsxs("div",{children:["PO #: ",X.po_no||""]})]})]})}),e.jsxs("div",{className:"w-full bg-white rounded-xl shadow-[0_4px_20px_rgba(14,54,70,0.15)] overflow-hidden",children:[e.jsxs("div",{className:"bg-[#0E3646] text-white p-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:" Purchase Order"}),e.jsx("p",{className:"opacity-90",children:"Create local and import purchase orders"})]}),e.jsxs("div",{className:"flex flex-wrap justify-between items-center p-5 bg-[#f8f9fa] border-b border-[#dee2e6] gap-4",children:[e.jsx("div",{className:"flex bg-[#f8f9fa] p-1 rounded-md border border-[#dee2e6]",children:e.jsx("button",{type:"button",className:`px-5 py-2.5 rounded text-sm font-semibold transition-all ${X.po_type==="IMPORT"?"bg-[#0E3646] text-white":"text-gray-500 hover:bg-gray-200"}`,onClick:()=>me({...X,po_type:"IMPORT"}),children:" Import Order"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Re,{to:"/purchase/purchase-orders-import",className:"btn btn-secondary font-medium flex items-center gap-2",children:" View Orders"}),e.jsxs("button",{type:"button",onClick:Pe,className:"btn-outline font-medium flex items-center gap-2",children:[e.jsx(Cc,{className:"w-4 h-4"}),"Download PDF"]}),e.jsxs("button",{type:"button",onClick:Ce,className:"btn-primary font-medium flex items-center gap-2",children:[e.jsx(tA,{className:"w-4 h-4"}),"Print"]})]})]}),e.jsxs("div",{className:"p-8",children:[o&&e.jsx("div",{className:"text-center py-4",children:"Loading..."}),h&&e.jsx("div",{className:"bg-red-50 text-red-600 p-4 rounded mb-6 border border-red-200",children:h}),e.jsxs("form",{onSubmit:Ye,children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"text-lg font-semibold text-[#0E3646] mb-5 pb-2 border-b-2 border-[#0E3646]",children:" Purchase Order Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5 required",children:"PO Number"}),e.jsx("input",{type:"text",name:"po_no",value:X.po_no,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10 bg-[#e9ecef] cursor-not-allowed",readOnly:!0,placeholder:"Auto-generated"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5 required",children:"PO Date"}),e.jsx("input",{type:"date",name:"po_date",value:X.po_date,onChange:Te,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10",required:!0})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5",children:"Order Type"}),e.jsx("input",{type:"text",value:X.po_type,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm bg-[#e9ecef]",readOnly:!0})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5",children:"Status"}),e.jsx("div",{children:e.jsx("span",{className:"px-4 py-1.5 rounded-full text-xs font-bold bg-[#e9ecef] text-[#495057]",children:X.status})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5 required",children:"Supplier"}),e.jsxs("select",{name:"supplier_id",value:X.supplier_id,onChange:Te,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10",required:!0,children:[e.jsx("option",{value:"",children:"Select Supplier"}),Array.isArray(M)&&M.map(ye=>ye&&e.jsx("option",{value:ye.id,children:ye.supplier_name||ye.name||"Unknown Supplier"},ye.id))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5",children:"Reference Quotation"}),e.jsxs("select",{name:"quotation_id",value:X.quotation_id,onChange:Te,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10",children:[e.jsx("option",{value:"",children:"Select Quotation"}),Array.isArray(P)&&P.map(ye=>ye&&e.jsxs("option",{value:ye.id,children:[ye.quotation_no," - ",ye.supplier_name]},ye.id))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5 required",children:"Warehouse"}),e.jsxs("select",{name:"warehouse_id",value:X.warehouse_id,onChange:Te,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10",children:[e.jsx("option",{value:"",children:"Select Warehouse"}),Array.isArray(z)&&z.map(ye=>ye&&e.jsx("option",{value:ye.id,children:ye.warehouse_name||ye.name||"Unknown Warehouse"},ye.id))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5 required",children:"Currency"}),e.jsxs("select",{name:"currency",value:X.currency,onChange:Te,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10",children:[e.jsx("option",{value:"GHS",children:"GHS - Ghana Cedi"}),e.jsx("option",{value:"USD",children:"USD - US Dollar"}),e.jsx("option",{value:"EUR",children:"EUR - Euro"}),e.jsx("option",{value:"GBP",children:"GBP - British Pound"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5",children:"Exchange Rate"}),e.jsx("input",{type:"number",name:"exchange_rate",value:X.exchange_rate,onChange:Te,step:"0.01",className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5 required",children:"Expected Delivery Date"}),e.jsx("input",{type:"date",name:"delivery_date",value:X.delivery_date,onChange:Te,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5",children:"Payment Terms (Days)"}),e.jsx("input",{type:"number",name:"payment_terms",value:X.payment_terms,onChange:Te,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5",children:"Delivery Terms"}),e.jsxs("select",{name:"delivery_terms",value:X.delivery_terms,onChange:Te,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10",children:[e.jsx("option",{value:"",children:"Select Terms"}),e.jsx("option",{value:"FOB",children:"FOB - Free on Board"}),e.jsx("option",{value:"CIF",children:"CIF - Cost, Insurance & Freight"}),e.jsx("option",{value:"EXW",children:"EXW - Ex Works"}),e.jsx("option",{value:"DDP",children:"DDP - Delivered Duty Paid"})]})]})]})]}),X.po_type==="IMPORT"&&e.jsxs("div",{className:"mb-8 bg-[#fff3cd] border-l-4 border-[#ffc107] p-6 rounded",children:[e.jsx("div",{className:"text-lg font-semibold text-[#0E3646] mb-4",children:" Import Order Details"}),e.jsxs("div",{className:"bg-[#e7f3ff] border-l-4 border-[#17a2b8] p-4 rounded mb-5 text-sm text-[#0c5460]",children:[e.jsx("strong",{children:" Import Order:"})," Additional documentation and compliance requirements apply for international procurement."]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5",children:"Port of Loading"}),e.jsx("input",{type:"text",name:"port_loading",value:X.port_loading,onChange:Te,placeholder:"e.g., Shanghai, China",className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5",children:"Port of Discharge"}),e.jsx("input",{type:"text",name:"port_discharge",value:X.port_discharge,onChange:Te,placeholder:"e.g., Tema Port, Ghana",className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5",children:"Incoterms"}),e.jsxs("select",{name:"incoterms",value:X.incoterms,onChange:Te,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10",children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"FOB",children:"FOB"}),e.jsx("option",{value:"CIF",children:"CIF"}),e.jsx("option",{value:"CFR",children:"CFR"}),e.jsx("option",{value:"EXW",children:"EXW"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5",children:"HS Code"}),e.jsx("input",{type:"text",name:"hs_code",value:X.hs_code,onChange:Te,placeholder:"Harmonized System Code",className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5",children:"Expected Shipping Date"}),e.jsx("input",{type:"date",name:"shipping_date",value:X.shipping_date,onChange:Te,className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-[13px] font-bold text-[#0E3646] mb-1.5",children:"Insurance Required"}),e.jsxs("select",{name:"insurance_required",value:X.insurance_required?"YES":"NO",onChange:ye=>me({...X,insurance_required:ye.target.value==="YES"}),className:"p-2.5 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10",children:[e.jsx("option",{value:"YES",children:"Yes"}),e.jsx("option",{value:"NO",children:"No"})]})]})]})]}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-[#f8f9fa] p-5 rounded-lg border border-[#dee2e6]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{className:"text-lg font-semibold text-[#0E3646]",children:" Order Items"}),e.jsx("button",{type:"button",onClick:he,className:"px-4 py-2 bg-[#0E3646] text-white rounded hover:bg-[#082330] transition-all text-sm font-medium flex items-center gap-2",children:" Add Item"})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("div",{className:"mb-2 text-xs text-slate-600",children:"If a unit conversion exists for the selected item and UOM, use the number of UOM button beside the UOM to convert quantity to the items default for accurate costing."}),e.jsxs("table",{className:"w-full border-collapse bg-white rounded-lg overflow-hidden",children:[e.jsx("thead",{className:"bg-[#0E3646] text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left text-[13px] w-[50px]",children:"#"}),e.jsx("th",{className:"p-3 text-left text-[13px]",children:"Item Name"}),e.jsx("th",{className:"p-3 text-left text-[13px] w-[100px]",children:"Qty"}),e.jsx("th",{className:"p-3 text-left text-[13px] w-[120px]",children:"UOM"}),e.jsx("th",{className:"p-3 text-left text-[13px] w-[120px]",children:"Unit Price"}),e.jsx("th",{className:"p-3 text-left text-[13px] w-[100px]",children:"Disc %"}),e.jsx("th",{className:"p-3 text-left text-[13px] w-[140px]",children:"Tax %"}),e.jsx("th",{className:"p-3 text-left text-[13px] w-[150px]",children:"Net Amount"}),e.jsx("th",{className:"p-3 text-left text-[13px] w-[80px]",children:"Action"})]})}),e.jsx("tbody",{children:we.map((ye,Ae)=>ye&&e.jsxs("tr",{className:"border-b border-[#dee2e6] hover:bg-[#0E3646]/5 transition-colors",children:[e.jsx("td",{className:"p-3 text-sm",children:Ae+1}),e.jsx("td",{className:"p-3",children:e.jsxs("select",{value:ye.item_id,onChange:be=>fe(Ae,"item_id",be.target.value),className:"w-full p-2 border border-[#dee2e6] rounded text-sm focus:outline-none focus:border-[#0E3646]",required:!0,children:[e.jsx("option",{value:"",children:"Select Item"}),Array.isArray(L)&&L.map(be=>be&&e.jsx("option",{value:be.id,children:be.item_name||be.item_code||"Unknown Item"},be.id))]})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",value:ye.qty,onChange:be=>fe(Ae,"qty",be.target.value),className:"w-full p-2 border border-[#dee2e6] rounded text-sm text-right focus:outline-none focus:border-[#0E3646]",min:"0",step:"1"})}),e.jsxs("td",{className:"p-3",children:[e.jsxs("select",{value:ye.uom||rt||"",onChange:be=>fe(Ae,"uom",be.target.value),className:"w-full p-2 border border-[#dee2e6] rounded text-sm text-center focus:outline-none focus:border-[#0E3646]",children:[e.jsx("option",{value:"",children:"Select UOM"}),Array.isArray(Le)&&Le.map(be=>be&&e.jsx("option",{value:be.uom_code,children:be.uom_name?`${be.uom_name} (${be.uom_code})`:be.uom_code},be.id))]}),(()=>{const be=L.find(ht=>String(ht.id)===String(ye.item_id)),Ee=(be==null?void 0:be.uom)&&String(be.uom)||(rt?String(rt):""),dt=String(ye.uom||""),mt=Array.isArray(ae)&&ae.some(ht=>Number(ht.is_active)&&Number(ht.item_id)===Number(ye.item_id)&&String(ht.from_uom)===dt&&String(ht.to_uom)===Ee);return dt&&Ee&&dt!==Ee&&String(ye.item_id||"")&&mt?e.jsx("button",{type:"button",className:"ml-2 px-2 py-1 text-xs border border-brand text-brand rounded hover:bg-brand hover:text-white transition-colors",onClick:()=>le({open:!0,itemId:ye.item_id,defaultUom:Ee,currentUom:dt,rowIdx:Ae}),children:`number of ${dt}`}):null})()]}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",value:ye.unit_price,onChange:be=>fe(Ae,"unit_price",be.target.value),className:"w-full p-2 border border-[#dee2e6] rounded text-sm text-right focus:outline-none focus:border-[#0E3646]",min:"0",step:"1"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",value:ye.discount_percent,onChange:be=>fe(Ae,"discount_percent",be.target.value),className:"w-full p-2 border border-[#dee2e6] rounded text-sm text-right focus:outline-none focus:border-[#0E3646]",min:"0",max:"100",step:"1"})}),e.jsx("td",{className:"p-3",children:e.jsxs("select",{value:(()=>{const be=te.find(Ee=>Number(Ee.rate)===Number(ye.tax_percent||0));return be?be.value:""})(),onChange:be=>{const Ee=be.target.value,dt=te.find(it=>String(it.value)===String(Ee)),mt=dt?dt.rate:0;fe(Ae,"tax_percent",mt)},className:"w-full p-2 border border-[#dee2e6] rounded text-sm text-right focus:outline-none focus:border-[#0E3646]",children:[e.jsx("option",{value:"",children:"No Tax"}),te.map(be=>e.jsx("option",{value:be.value,children:be.label},be.value))]})}),e.jsxs("td",{className:"p-3 text-right font-medium text-sm",children:[X.currency," ",ye.line_total.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("button",{type:"button",onClick:()=>Ue(Ae),className:"text-[#dc3545] hover:bg-[#dc3545]/10 p-1.5 rounded transition-colors",children:""})})]},Ae))})]})]}),e.jsxs("div",{className:"bg-[#f8f9fa] p-5 rounded-lg mt-5 border border-[#dee2e6]",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b border-[#dee2e6]",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Items:"}),e.jsx("span",{className:"font-bold",children:we.filter(ye=>ye&&ye.item_id).length})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-[#dee2e6]",children:[e.jsx("span",{className:"text-sm font-medium",children:"Sub Total:"}),e.jsxs("span",{className:"font-bold",children:[X.currency," ",De.subTotal.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-[#dee2e6] text-[#dc3545]",children:[e.jsx("span",{className:"text-sm font-medium",children:"Discount:"}),e.jsxs("span",{className:"font-bold",children:["-",X.currency," ",De.totalDiscount.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-[#dee2e6] text-[#0E3646]",children:[e.jsx("span",{className:"text-sm font-medium",children:"Tax Amount:"}),e.jsxs("span",{className:"font-bold",children:[X.currency," ",De.totalTax.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-[#dee2e6] items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Freight Charges:"}),e.jsx("input",{type:"number",name:"freight_amount",value:X.freight_amount,onChange:Te,className:"w-[150px] p-1.5 border border-[#dee2e6] rounded text-sm text-right focus:outline-none focus:border-[#0E3646]"})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-[#dee2e6] items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Other Charges:"}),e.jsx("input",{type:"number",name:"other_charges",value:X.other_charges,onChange:Te,className:"w-[150px] p-1.5 border border-[#dee2e6] rounded text-sm text-right focus:outline-none focus:border-[#0E3646]"})]}),e.jsxs("div",{className:"flex justify-between py-3 text-lg font-bold text-[#0E3646]",children:[e.jsx("span",{children:"GRAND TOTAL:"}),e.jsxs("span",{children:[X.currency," ",De.grandTotal.toLocaleString(void 0,{minimumFractionDigits:2})]})]})]})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"text-lg font-semibold text-[#0E3646] mb-5 pb-2 border-b-2 border-[#0E3646]",children:" Terms & Conditions"}),e.jsx("div",{className:"flex flex-col",children:e.jsx("textarea",{name:"terms_conditions",value:X.terms_conditions,onChange:Te,rows:"6",className:"p-3 border border-[#dee2e6] rounded-md text-sm focus:outline-none focus:border-[#0E3646] focus:ring-2 focus:ring-[#0E3646]/10",placeholder:"Enter terms and conditions..."})})]}),e.jsxs("div",{className:"flex flex-wrap justify-between items-center mt-8 gap-4",children:[e.jsx("div",{children:e.jsx("button",{type:"button",className:"px-5 py-2.5 bg-[#dc3545] text-white rounded hover:bg-[#c82333] transition-all font-medium flex items-center gap-2",onClick:()=>alert("Delete functionality not implemented yet"),children:" Delete"})}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{type:"button",className:"px-5 py-2.5 bg-[#6c757d] text-white rounded hover:bg-[#5a6268] transition-all font-medium flex items-center gap-2",onClick:()=>me({...X,remarks:""}),children:" Clear"}),!l&&e.jsx("button",{type:"submit",disabled:u,"data-submit-type":"draft",className:"px-5 py-2.5 bg-[#0E3646] text-white rounded hover:bg-[#082330] transition-all font-medium flex items-center gap-2 disabled:opacity-70",children:u?"Saving...":" Save as Draft"}),!l&&e.jsx("button",{type:"submit",disabled:u,"data-submit-type":"pending",className:"px-5 py-2.5 bg-[#28a745] text-white rounded hover:bg-[#218838] transition-all font-medium flex items-center gap-2 disabled:opacity-70",children:" Submit for Approval"})]})]})]})]})]}),e.jsxs("div",{ref:ue,className:"hidden p-8 bg-white",style:{width:"794px",maxWidth:"794px"},children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:_e.logoUrl||Ws,alt:_e.name||"Company",className:"w-16 h-16 object-contain border border-gray-300"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold text-base",children:_e.name||"Company"}),_e.address&&e.jsx("div",{children:_e.address}),(_e.city||_e.state||_e.country)&&e.jsx("div",{children:[_e.city,_e.state,_e.country].filter(Boolean).join(", ")}),e.jsxs("div",{className:"flex gap-3",children:[_e.phone&&e.jsx("span",{children:_e.phone}),_e.email&&e.jsx("span",{children:_e.email})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-xl font-semibold",children:"Purchase Order"})}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{children:["DATE: ",X.po_date||""]}),e.jsxs("div",{children:["PO #: ",X.po_no||""]}),e.jsxs("div",{children:["Supplier:"," ",((Je=M.find(ye=>String(ye.id)===String(X.supplier_id)))==null?void 0:Je.supplier_name)||((xe=M.find(ye=>String(ye.id)===String(X.supplier_id)))==null?void 0:xe.name)||""]}),e.jsxs("div",{children:["Currency: ",X.currency||""]}),e.jsxs("div",{children:["Exchange Rate: ",Number(X.exchange_rate||1).toFixed(2)]}),X.incoterms&&e.jsxs("div",{children:["Incoterms: ",X.incoterms]}),X.port_loading&&e.jsxs("div",{children:["Port Loading: ",X.port_loading]}),X.port_discharge&&e.jsxs("div",{children:["Port Discharge: ",X.port_discharge]})]})]}),e.jsx("div",{className:"mb-2",style:{width:"100%",overflow:"visible",margin:"0 auto"},children:e.jsxs("table",{className:"text-sm",style:{width:"100%",tableLayout:"fixed"},children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"40%"}}),e.jsx("col",{style:{width:"20%"}}),e.jsx("col",{style:{width:"20%"}}),e.jsx("col",{style:{width:"20%"}})]}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left",children:"Description"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Quantity"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Unit Price"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Net Amount"})]})}),e.jsx("tbody",{children:we.map((ye,Ae)=>{const be=L.find(dt=>String(dt.id)===String(ye.item_id)),Ee=(be==null?void 0:be.item_name)||(be==null?void 0:be.item_code)||"Item";return e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2",children:Ee}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(ye.qty||0).toFixed(2)}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(ye.unit_price||0).toFixed(2)}),e.jsx("td",{className:"px-2 py-2 text-right",children:Number(ye.line_total||0).toFixed(2)})]},Ae)})})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx("div",{}),e.jsx("div",{children:e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx("div",{className:"px-2 py-1 font-medium",children:"Gross Subtotal"}),e.jsx("div",{className:"px-2 py-1 text-right",children:Number(De.subTotal||0).toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-medium",children:"Discount"}),e.jsx("div",{className:"px-2 py-1 text-right",children:Number(De.totalDiscount||0).toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-medium",children:"Net Sub Total"}),e.jsx("div",{className:"px-2 py-1 text-right font-semibold",children:Number(De.subTotal-De.totalDiscount||0).toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-medium",children:"Tax Amount"}),e.jsx("div",{className:"px-2 py-1 text-right",children:Number(De.totalTax||0).toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-medium",children:"Freight Charges"}),e.jsx("div",{className:"px-2 py-1 text-right",children:Number(De.freight||0).toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-medium",children:"Other Charges"}),e.jsx("div",{className:"px-2 py-1 text-right",children:Number(De.other||0).toFixed(2)}),e.jsx("div",{className:"px-2 py-1 font-semibold",children:"Total"}),e.jsx("div",{className:"px-2 py-1 text-right font-semibold",children:Number(De.grandTotal||0).toFixed(2)})]})})})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-erp w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-brand text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Forward for Approval"}),e.jsx("button",{onClick:()=>{g(!1),_(null),I(null),j("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Document No:"," ",e.jsx("span",{className:"font-semibold",children:X.po_no})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:N?`${N.workflow_name} (${N.workflow_code})`:"None (inactive)"})]}),e.jsx("div",{children:x?e.jsx("div",{className:"text-sm",children:"Loading workflow..."}):null}),e.jsx("div",{children:y?e.jsx("div",{className:"text-sm text-red-600",children:y}):null}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Target Approver"}),(()=>{const Ae=Array.isArray(w)&&w.length>0?w[0]:null,be=Ae?Array.isArray(Ae.approvers)&&Ae.approvers.length?Ae.approvers.map(Ee=>({id:Ee.id,name:Ee.username})):Ae.approver_user_id?[{id:Ae.approver_user_id,name:Ae.approver_name||String(Ae.approver_user_id)}]:[]:[];return be.length>0?e.jsxs("div",{className:"mt-1",children:[e.jsxs("select",{className:"input w-full",value:Y||"",onChange:Ee=>H(Ee.target.value?Number(Ee.target.value):null),children:[e.jsx("option",{value:"",children:"Select target approver"}),be.map(Ee=>e.jsx("option",{value:Ee.id,children:Ee.name},Ee.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:F?`Step ${F.stepOrder}  ${F.stepName}${F.approvalLimit!=null?`  Limit: ${Number(F.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:N?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})()]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{g(!1),_(null),I(null),j("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:Ke,disabled:W||n,children:W?"Forwarding...":"Forward"})]})]})}),e.jsx(Ic,{open:oe.open,itemId:oe.itemId,defaultUom:oe.defaultUom,currentUom:oe.currentUom,onClose:()=>le({open:!1,itemId:null,defaultUom:"",currentUom:"",rowIdx:null}),onApply:ye=>{const{converted_qty:Ae}=ye||{},be=oe.rowIdx;be!=null&&Ie(Ee=>{const dt=[...Ee],mt={...dt[be]},it=Number(Ae||0);mt.qty=it,mt.uom=oe.defaultUom||mt.uom;const ht=Number(mt.unit_price||0),ft=Number(mt.discount_percent||0),Rt=Number(mt.tax_percent||0),Ge=it*ht,at=Ge*(ft/100),je=Ge-at,Se=je*(Rt/100);return mt.line_total=je+Se,dt[be]=mt,dt})}})]})}function Xee(){const[t,s]=f.useState(""),[r,a]=f.useState(!1),[n,i]=f.useState(""),[l,o]=f.useState([]),{canPerformAction:d}=Ls();f.useEffect(()=>{let h=!0;return a(!0),i(""),Z.get("/purchase/shipping-advices").then(m=>{var p;h&&o(Array.isArray((p=m.data)==null?void 0:p.items)?m.data.items:[])}).catch(m=>{var p,g;h&&i(((g=(p=m==null?void 0:m.response)==null?void 0:p.data)==null?void 0:g.message)||"Failed to load shipping advice")}).finally(()=>{h&&a(!1)}),()=>{h=!1}},[]);const u=h=>({DRAFT:"badge-info",IN_TRANSIT:"badge-warning",ARRIVED:"badge-success",CLEARED:"badge-success",CANCELLED:"badge-error"})[h]||"badge-info",c=f.useMemo(()=>{const h=t.toLowerCase();return l.filter(m=>{const p=String(m.advice_no||"").toLowerCase(),g=String(m.po_no||"").toLowerCase(),x=String(m.bill_of_lading||"").toLowerCase();return p.includes(h)||g.includes(h)||x.includes(h)})},[l,t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Shipping Advice"}),e.jsx("p",{className:"text-sm mt-1",children:"Track shipments and vessel information"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/purchase",className:"btn btn-secondary",children:"Return to Menu"}),d("purchase:shipping-advice","create")&&e.jsx(Re,{to:"/purchase/shipping-advice/new",className:"btn-success",children:"+ New Shipping Advice"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by advice no / PO / vessel...",className:"input",value:t,onChange:h=>s(h.target.value)})})})}),e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Advice No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"PO"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{children:"ETD"}),e.jsx("th",{children:"ETA"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[r?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):n?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center py-8 text-red-600",children:n})}):null,c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No records"})}):c.map(h=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:h.advice_no}),e.jsx("td",{children:h.advice_date?new Date(h.advice_date).toLocaleDateString():""}),e.jsx("td",{children:h.po_no}),e.jsx("td",{children:h.supplier_name}),e.jsx("td",{children:h.etd_date?new Date(h.etd_date).toLocaleDateString():"-"}),e.jsx("td",{children:h.eta_date?new Date(h.eta_date).toLocaleDateString():"-"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${u(h.status)}`,children:h.status})}),e.jsxs("td",{children:[d("purchase:shipping-advice","view")&&e.jsx(Re,{to:`/purchase/shipping-advice/${h.id}?mode=view`,className:"text-brand hover:text-brand-600 dark:text-brand-300 dark:hover:text-brand-200 text-sm font-medium",children:"View"}),d("purchase:shipping-advice","edit")&&e.jsx(Re,{to:`/purchase/shipping-advice/${h.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-medium ml-2",children:"Edit"})]})]},h.id))]})]})})]})]})}function uC(){const{id:t}=Ps(),s=ps(),r=!t||t==="new",{user:a}=Kr(),[n,i]=f.useState(!1),[l,o]=f.useState(!1),[d,u]=f.useState(""),[c,h]=f.useState([]),[m,p]=f.useState({advice_no:"Auto-generated",advice_date:new Date().toISOString().split("T")[0],po_id:"",status:"IN_TRANSIT",shipping_method:"",shipping_company:"",tracking_number:"",vessel_name:"",voyage_number:"",port_of_loading:"",port_of_discharge:"",bl_number:"",bl_date:"",container_numbers:"",total_packages:0,gross_weight:0,volume:0,etd:"",eta:"",remarks:""}),[g,x]=f.useState([]),[b,y]=f.useState([]),[j,N]=f.useState([]),[_,F]=f.useState({name:"",address:"",phone:"",email:"",city:"",state:"",country:"",logoUrl:""});f.useEffect(()=>{Promise.all([Z.get("/purchase/orders?status=APPROVED"),Z.get("/purchase/shipping-advices")]).then(([q,z])=>{var G,O;const L=(Array.isArray((G=q.data)==null?void 0:G.items)?q.data.items:[]).filter(K=>String(K.po_type||"").toUpperCase()==="IMPORT"),P=(Array.isArray((O=z.data)==null?void 0:O.items)?z.data.items:[]).filter(K=>String(K.status||"").toUpperCase()!=="CANCELLED"),C=new Set(P.map(K=>K.po_id||K.poId).filter(K=>K!=null).map(K=>String(K))),k=new Set(P.map(K=>K.po_no||K.poNo).filter(K=>K!=null).map(K=>String(K))),B=L.filter(K=>{const J=String(K.id),te=String(K.po_no||K.poNo||"");return!(C.has(J)||te&&k.has(te))});h(B)}).catch(q=>console.error(q))},[]),f.useEffect(()=>{I()},[]),f.useEffect(()=>{r&&(async()=>{var q;try{const Q=(q=(await Z.get("/purchase/shipping-advices/next-no")).data)==null?void 0:q.nextNo;Q&&p(L=>({...L,advice_no:Q}))}catch{}})()},[r]);async function I(){var q,z,Q;try{const V=(z=(q=(await Z.get("/admin/me")).data)==null?void 0:q.scope)==null?void 0:z.companyId;if(V){const C=((Q=(await Z.get(`/admin/companies/${V}`)).data)==null?void 0:Q.item)||{};F(k=>({...k,name:C.name||k.name||"",address:C.address||k.address||"",phone:C.telephone||k.phone||"",email:C.email||k.email||"",city:C.city||k.city||"",state:C.state||k.state||"",country:C.country||k.country||"",logoUrl:C.has_logo===1||C.has_logo===!0?`/api/admin/companies/${V}/logo`:Ws}))}else F(P=>({...P,logoUrl:P.logoUrl||Ws}))}catch{F(L=>({...L,logoUrl:L.logoUrl||Ws}))}}f.useEffect(()=>{r||(i(!0),Z.get(`/purchase/shipping-advices/${t}`).then(q=>{var L;const z=((L=q.data)==null?void 0:L.item)||{},Q=z.details||[];p({advice_no:z.advice_no,advice_date:z.advice_date?z.advice_date.split("T")[0]:"",po_id:z.po_id,supplier_id:z.supplier_id,status:z.status,tracking_number:z.bill_of_lading||"",vessel_name:z.vessel_name||"",container_numbers:z.container_no||"",etd:z.etd_date?z.etd_date.split("T")[0]:"",eta:z.eta_date?z.eta_date.split("T")[0]:"",remarks:z.remarks||""}),x(Q.map(V=>({item_id:V.item_id,item_code:V.item_code,item_name:V.item_name,ordered_qty:0,shipped_qty:V.qty_shipped,uom:"pcs",remarks:V.remarks||""})))}).catch(q=>{var z,Q;return u(((Q=(z=q==null?void 0:q.response)==null?void 0:z.data)==null?void 0:Q.message)||"Failed to load data")}).finally(()=>i(!1)))},[t,r]),f.useEffect(()=>{m.po_id&&Z.get(`/purchase/orders/${m.po_id}`).then(q=>{var L,V,P;const z=((V=(L=q.data)==null?void 0:L.item)==null?void 0:V.details)||[],Q=(P=q.data)==null?void 0:P.item;if(N(z),Q&&Q.supplier_id&&p(C=>({...C,supplier_id:Q.supplier_id})),r&&g.length===0){const C=z.map(k=>({item_id:k.item_id,item_code:k.item_code,item_name:k.item_name,ordered_qty:k.qty,shipped_qty:k.qty,uom:k.uom||"pcs",package_numbers:"",remarks:""}));x(C)}else g.length>0&&x(C=>C.map(k=>{const B=z.find(G=>String(G.item_id)===String(k.item_id));return B?{...k,ordered_qty:B.qty}:k}))}).catch(console.error)},[m.po_id,r]);const w=q=>{const{name:z,value:Q}=q.target;p(L=>({...L,[z]:Q}))},E=(q,z,Q)=>{const L=[...g];L[q]={...L[q],[z]:Q},x(L)},W=q=>{x(g.filter((z,Q)=>Q!==q))},R=()=>{y([{status_title:"",status_date:new Date().toISOString().slice(0,16),description:"",location:""},...b])},U=(q,z,Q)=>{const L=[...b];L[q]={...L[q],[z]:Q},y(L)},T=q=>{y(b.filter((z,Q)=>Q!==q))},Y=async q=>{var z,Q,L;q.preventDefault(),o(!0),u("");try{const V=((z=c.find(C=>String(C.id)===String(m.po_id)))==null?void 0:z.supplier_id)||null,P={advice_no:m.advice_no,advice_date:m.advice_date,po_id:m.po_id,supplier_id:m.supplier_id||V,status:m.status||"IN_TRANSIT",vessel_name:m.vessel_name||null,bill_of_lading:m.tracking_number||null,container_no:m.container_numbers||null,etd_date:m.etd||null,eta_date:m.eta||null,remarks:m.remarks||null,details:g.map(C=>({item_id:C.item_id,qty_shipped:Number(C.shipped_qty)||0,remarks:C.remarks||null}))};r?await Z.post("/purchase/shipping-advices",P):await Z.put(`/purchase/shipping-advices/${t}`,P),s("/purchase/shipping-advice")}catch(V){u(((L=(Q=V==null?void 0:V.response)==null?void 0:Q.data)==null?void 0:L.message)||"Failed to save")}finally{o(!1)}},H=()=>{alert("Notification sent to warehouse and stakeholders!")},M=()=>{window.print()};return e.jsxs("div",{className:"space-y-6 pb-20",children:[e.jsx("div",{className:"hidden print:block p-8 max-w-[19cm] mx-auto",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:_.logoUrl||Ws,alt:_.name||"Company",className:"w-16 h-16 object-contain border border-gray-300"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold text-base",children:_.name||"Company"}),_.address&&e.jsx("div",{children:_.address}),(_.city||_.state||_.country)&&e.jsx("div",{children:[_.city,_.state,_.country].filter(Boolean).join(", ")}),e.jsxs("div",{className:"flex gap-3",children:[_.phone&&e.jsx("span",{children:_.phone}),_.email&&e.jsx("span",{children:_.email})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-xl font-semibold",children:"Shipping Advice"})}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{children:["DATE: ",m.advice_date||""]}),e.jsxs("div",{children:["Advice #: ",m.advice_no||""]})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:[r?"New":"Edit"," Shipping Advice"]}),e.jsx("p",{className:"text-sm text-slate-500",children:"Manage shipment details, tracking, and items."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/purchase/shipping-advice",className:"btn btn-outline",children:"Cancel"}),e.jsx("button",{onClick:M,className:"btn btn-outline",type:"button",children:"Print"}),e.jsx("button",{onClick:Y,className:"btn btn-primary",disabled:l,children:l?"Saving...":"Save Advice"})]})]}),d&&e.jsx("div",{className:"p-4 bg-red-50 text-red-700 rounded-lg border border-red-200",children:d}),n?e.jsx("div",{className:"text-center py-10",children:"Loading..."}):e.jsxs("form",{onSubmit:Y,className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 border-b pb-2",children:"General Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Advice No"}),e.jsx("input",{type:"text",className:"input bg-slate-100",value:m.advice_no,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Advice Date *"}),e.jsx("input",{type:"date",className:"input",name:"advice_date",value:m.advice_date,onChange:w,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Purchase Order *"}),e.jsxs("select",{className:"input",name:"po_id",value:m.po_id,onChange:w,required:!0,disabled:!r&&g.length>0,children:[e.jsx("option",{value:"",children:"Select PO..."}),c.map(q=>e.jsxs("option",{value:q.id,children:[q.po_no," - ",q.supplier_name]},q.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",name:"status",value:m.status,onChange:w,children:[e.jsx("option",{value:"DRAFT",children:"Draft"}),e.jsx("option",{value:"IN_TRANSIT",children:"In Transit"}),e.jsx("option",{value:"ARRIVED",children:"Arrived"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 border-b pb-2",children:"Shipment Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Shipping Method"}),e.jsxs("select",{className:"input",name:"shipping_method",value:m.shipping_method,onChange:w,children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"SEA",children:"Sea Freight"}),e.jsx("option",{value:"AIR",children:"Air Freight"}),e.jsx("option",{value:"ROAD",children:"Road Freight"}),e.jsx("option",{value:"COURIER",children:"Courier"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Shipping Company"}),e.jsx("input",{type:"text",className:"input",name:"shipping_company",value:m.shipping_company,onChange:w,placeholder:"e.g. Maersk, DHL"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Tracking / BL No"}),e.jsx("input",{type:"text",className:"input",name:"tracking_number",value:m.tracking_number,onChange:w})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Vessel / Flight Name"}),e.jsx("input",{type:"text",className:"input",name:"vessel_name",value:m.vessel_name,onChange:w})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voyage No"}),e.jsx("input",{type:"text",className:"input",name:"voyage_number",value:m.voyage_number,onChange:w})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Port of Loading"}),e.jsx("input",{type:"text",className:"input",name:"port_of_loading",value:m.port_of_loading,onChange:w})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Port of Discharge"}),e.jsx("input",{type:"text",className:"input",name:"port_of_discharge",value:m.port_of_discharge,onChange:w})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Container Nos"}),e.jsx("input",{type:"text",className:"input",name:"container_numbers",value:m.container_numbers,onChange:w,placeholder:"Comma separated"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"ETD (Estimated Departure)"}),e.jsx("input",{type:"date",className:"input",name:"etd",value:m.etd,onChange:w})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"ETA (Estimated Arrival)"}),e.jsx("input",{type:"date",className:"input",name:"eta",value:m.eta,onChange:w})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Total Packages"}),e.jsx("input",{type:"number",className:"input",name:"total_packages",value:m.total_packages,onChange:w})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Gross Weight (kg)"}),e.jsx("input",{type:"number",className:"input",name:"gross_weight",value:m.gross_weight,onChange:w,step:"0.01"})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 border-b pb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Items in Shipment"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-secondary",onClick:()=>{},children:"Refresh from PO"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item Code"}),e.jsx("th",{children:"Item Name"}),e.jsx("th",{className:"w-24",children:"Ordered"}),e.jsx("th",{className:"w-32",children:"Shipped Qty"}),e.jsx("th",{className:"w-24",children:"UOM"}),e.jsx("th",{children:"Package Nos"}),e.jsx("th",{children:"Remarks"}),e.jsx("th",{className:"w-10"})]})}),e.jsxs("tbody",{children:[g.map((q,z)=>e.jsxs("tr",{children:[e.jsx("td",{children:q.item_code}),e.jsx("td",{children:q.item_name}),e.jsx("td",{className:"text-slate-500",children:q.ordered_qty}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"input input-sm w-full",value:q.shipped_qty,onChange:Q=>E(z,"shipped_qty",Q.target.value),step:"0.01"})}),e.jsx("td",{children:q.uom}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input input-sm w-full",value:q.package_numbers,onChange:Q=>E(z,"package_numbers",Q.target.value),placeholder:"e.g. 1-10"})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input input-sm w-full",value:q.remarks,onChange:Q=>E(z,"remarks",Q.target.value)})}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700",onClick:()=>W(z),children:""})})]},z)),g.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center py-4 text-slate-500",children:"No items selected. Select a PO to populate items."})})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 border-b pb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Tracking Timeline"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:R,children:"+ Add Event"})]}),e.jsxs("div",{className:"space-y-4 max-h-96 overflow-y-auto pr-2",children:[b.map((q,z)=>e.jsxs("div",{className:"flex gap-4 items-start p-3 bg-slate-50 dark:bg-slate-800 rounded-lg border",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("input",{type:"text",className:"input input-sm font-semibold",placeholder:"Status (e.g. Departed)",value:q.status_title,onChange:Q=>U(z,"status_title",Q.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"datetime-local",className:"input input-sm w-full",value:q.status_date?new Date(q.status_date).toISOString().slice(0,16):"",onChange:Q=>U(z,"status_date",Q.target.value)}),e.jsx("input",{type:"text",className:"input input-sm w-full",placeholder:"Location",value:q.location,onChange:Q=>U(z,"location",Q.target.value)})]}),e.jsx("textarea",{className:"input input-sm w-full",placeholder:"Description / Notes",rows:"2",value:q.description,onChange:Q=>U(z,"description",Q.target.value)})]}),e.jsx("button",{type:"button",className:"text-red-500",onClick:()=>T(z),children:""})]},z)),b.length===0&&e.jsx("p",{className:"text-center text-slate-500 py-4",children:"No tracking updates yet."})]})]}),e.jsxs("div",{className:"card p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 border-b pb-2",children:"Additional Remarks"}),e.jsx("textarea",{className:"input w-full h-32",name:"remarks",value:m.remarks,onChange:w,placeholder:"Any internal notes or instructions..."})]}),e.jsxs("div",{className:"pt-6 border-t",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{type:"button",className:"btn btn-info w-full sm:w-auto",onClick:H,children:" Send Arrival Notification"}),e.jsx("button",{type:"button",className:"btn btn-secondary w-full sm:w-auto",onClick:()=>y(q=>[{status_title:"Arrived at Port",status_date:new Date().toISOString(),location:m.port_of_discharge||"Port",description:"Vessel has arrived at discharge port."},...q]),children:" Mark as Arrived"})]})]})]})]})]})]})}function Jee(){const[t,s]=f.useState(""),[r,a]=f.useState(!1),[n,i]=f.useState(""),[l,o]=f.useState([]),{canPerformAction:d}=Ls();f.useEffect(()=>{let h=!0;return a(!0),i(""),Z.get("/purchase/port-clearances").then(m=>{var p;h&&o(Array.isArray((p=m.data)==null?void 0:p.items)?m.data.items:[])}).catch(m=>{var p,g;h&&i(((g=(p=m==null?void 0:m.response)==null?void 0:p.data)==null?void 0:g.message)||"Failed to load port clearances")}).finally(()=>{h&&a(!1)}),()=>{h=!1}},[]);const u=h=>({PENDING:"badge-warning",CLEARED:"badge-success",CANCELLED:"badge-error"})[h]||"badge-info",c=f.useMemo(()=>{const h=t.toLowerCase();return l.filter(m=>{const p=String(m.clearance_no||"").toLowerCase(),g=String(m.advice_no||"").toLowerCase();return p.includes(h)||g.includes(h)})},[l,t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Clearing at Port"}),e.jsx("p",{className:"text-sm mt-1",children:"Manage customs and port clearances"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/purchase",className:"btn btn-secondary",children:"Return to Menu"}),d("purchase:port-clearances","create")&&e.jsx(Re,{to:"/purchase/port-clearances/new",className:"btn-success",children:"+ New Clearance"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by clearance no / shipping advice...",className:"input",value:t,onChange:h=>s(h.target.value)})})})}),e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Clearance No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"PO"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{children:"Clearing Agent"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[r?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):n?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-8 text-red-600",children:n})}):null,c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No records"})}):c.map(h=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:h.clearance_no}),e.jsx("td",{children:h.clearance_date?new Date(h.clearance_date).toLocaleDateString():""}),e.jsx("td",{children:h.po_no||""}),e.jsx("td",{children:h.supplier_name||""}),e.jsx("td",{children:h.clearing_agent||""}),e.jsx("td",{children:e.jsx("span",{className:`badge ${u(h.status)}`,children:h.status})}),e.jsxs("td",{children:[d("purchase:port-clearances","view")&&e.jsx(Re,{to:`/purchase/port-clearances/${h.id}?mode=view`,className:"text-brand hover:text-brand-600 dark:text-brand-300 dark:hover:text-brand-200 text-sm font-medium",children:"View"}),d("purchase:port-clearances","edit")&&e.jsx(Re,{to:`/purchase/port-clearances/${h.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-medium ml-2",children:"Edit"})]})]},h.id))]})]})})]})]})}function mC(){const{id:t}=Ps(),s=ps(),r=!t||t==="new",[a,n]=f.useState(!1),[i,l]=f.useState(!1),[o,d]=f.useState(""),[u,c]=f.useState([]),[h,m]=f.useState({clearance_no:r?"Auto-generated":"",clearance_date:new Date().toISOString().split("T")[0],shipping_advice_id:"",status:"PENDING",port_of_entry:"",arrival_date:"",clearing_agent:"",target_clearance_date:"",customs_declaration_number:"",declaration_date:"",hs_code:"",assessment_date:"",total_clearance_cost:0}),[p,g]=f.useState([]);f.useEffect(()=>{let _=!0;return Promise.all([Z.get("/purchase/shipping-advices"),Z.get("/purchase/port-clearances")]).then(([F,I])=>{var U,T;if(!_)return;const w=Array.isArray((U=F.data)==null?void 0:U.items)?F.data.items:[],E=Array.isArray((T=I.data)==null?void 0:T.items)?I.data.items:[],W=new Set(E.map(Y=>Y.advice_id||Y.adviceId).filter(Y=>Y!=null).map(Y=>String(Y))),R=w.filter(Y=>{const H=String(Y.status||"").toUpperCase(),M=H==="IN_TRANSIT"||H==="ARRIVED",q=!W.has(String(Y.id));return M&&q});c(R)}).catch(F=>{_&&console.error("Failed to load shipping advice",F)}),()=>{_=!1}},[]),f.useEffect(()=>{r&&Z.get("/purchase/port-clearances/next-no").then(_=>{var I;const F=(I=_.data)==null?void 0:I.nextNo;F&&m(w=>({...w,clearance_no:F}))}).catch(()=>{})},[r]),f.useEffect(()=>{h.shipping_advice_id&&Z.get(`/purchase/shipping-advices/${h.shipping_advice_id}`).then(_=>{var I;const F=(I=_.data)==null?void 0:I.item;if(F){const w=F.eta_date&&typeof F.eta_date=="string"?F.eta_date.split("T")[0]:F.eta_date||"";m(E=>({...E,arrival_date:E.arrival_date||w||E.arrival_date,target_clearance_date:E.target_clearance_date||w||E.target_clearance_date}))}}).catch(console.error)},[h.shipping_advice_id]),f.useEffect(()=>{if(r)return;let _=!0;return n(!0),d(""),Z.get(`/purchase/port-clearances/${t}`).then(F=>{var w;if(!_)return;const I=(w=F.data)==null?void 0:w.item;if(I)if(m({clearance_no:I.clearance_no||"",clearance_date:I.clearance_date?typeof I.clearance_date=="string"?I.clearance_date.split("T")[0]:I.clearance_date:new Date().toISOString().split("T")[0],shipping_advice_id:I.advice_id?String(I.advice_id):"",status:I.status||"PENDING",port_of_entry:I.port_of_entry||"",arrival_date:I.arrival_date||"",clearing_agent:I.clearing_agent||"",target_clearance_date:I.target_clearance_date||"",customs_declaration_number:I.customs_entry_no||I.customs_declaration_number||"",declaration_date:I.declaration_date||"",hs_code:I.hs_code||"",assessment_date:I.assessment_date||"",total_clearance_cost:Number(I.total_clearance_cost)||Number(I.duty_amount||0)+Number(I.other_charges||0)||0}),F.data.charges&&Array.isArray(F.data.charges))g(F.data.charges.map(E=>({id:E.id,charge_type:E.charge_type,amount:E.amount,vendor_authority:E.vendor_authority||""})));else{const E=[];Number(I.duty_amount)>0&&E.push({charge_type:"DUTY",amount:I.duty_amount,vendor_authority:"Customs"}),Number(I.other_charges)>0&&E.push({charge_type:"OTHER",amount:I.other_charges,vendor_authority:"Other"}),g(E)}}).catch(F=>{var I,w;_&&d(((w=(I=F==null?void 0:F.response)==null?void 0:I.data)==null?void 0:w.message)||"Failed to load port clearance")}).finally(()=>{_&&n(!1)}),()=>{_=!1}},[t,r]),f.useEffect(()=>{const _=p.reduce((F,I)=>F+(Number(I.amount)||0),0);m(F=>({...F,total_clearance_cost:_}))},[p]);const x=_=>{const{name:F,value:I}=_.target;m(w=>({...w,[F]:I}))},b=()=>{g([...p,{charge_type:"DUTY",amount:0,vendor_authority:""}])},y=_=>{const F=[...p];F.splice(_,1),g(F)},j=(_,F,I)=>{const w=[...p];w[_]={...w[_],[F]:I},g(w)},N=async _=>{var F,I;_.preventDefault(),l(!0),d("");try{const w={...h,shipping_advice_id:Number(h.shipping_advice_id),charges:p.map(E=>({charge_type:E.charge_type,amount:Number(E.amount),vendor_authority:E.vendor_authority}))};r?await Z.post("/purchase/port-clearances",w):await Z.put(`/purchase/port-clearances/${t}`,w),s("/purchase/port-clearances")}catch(w){d(((I=(F=w==null?void 0:w.response)==null?void 0:F.data)==null?void 0:I.message)||"Failed to save port clearance")}finally{l(!1)}};return a?e.jsx("div",{className:"p-4",children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:[r?"New":"Edit"," Port Clearance"]}),e.jsx("p",{className:"text-sm mt-1 text-slate-500",children:"Manage customs declarations and port charges"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/purchase/port-clearances",className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:N,disabled:i,className:"btn-primary",children:i?"Saving...":"Save Changes"})]})]}),o&&e.jsx("div",{className:"p-4 bg-red-50 text-red-700 rounded-md border border-red-200",children:o}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Clearance Details"})}),e.jsxs("div",{className:"card-body grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Clearance No"}),e.jsx("input",{type:"text",className:"input",value:h.clearance_no,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Clearance Date"}),e.jsx("input",{type:"date",className:"input",name:"clearance_date",value:h.clearance_date,onChange:x,required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Shipping Advice"}),e.jsxs("select",{className:"input",name:"shipping_advice_id",value:h.shipping_advice_id,onChange:x,required:!0,children:[e.jsx("option",{value:"",children:"Select Shipping Advice..."}),u.map(_=>e.jsxs("option",{value:_.id,children:[_.advice_no," - ",_.po_no," (",_.supplier_name,")"]},_.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",name:"status",value:h.status,onChange:x,children:[e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"IN_PROGRESS",children:"In Progress"}),e.jsx("option",{value:"CLEARED",children:"Cleared"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Target Clearance Date"}),e.jsx("input",{type:"date",className:"input",name:"target_clearance_date",value:h.target_clearance_date,onChange:x})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Customs & Import Data"})}),e.jsxs("div",{className:"card-body grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Port of Entry"}),e.jsx("input",{type:"text",className:"input",name:"port_of_entry",value:h.port_of_entry,onChange:x,placeholder:"e.g. Tema Port"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Arrival Date"}),e.jsx("input",{type:"date",className:"input",name:"arrival_date",value:h.arrival_date,onChange:x})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Clearing Agent"}),e.jsx("input",{type:"text",className:"input",name:"clearing_agent",value:h.clearing_agent,onChange:x})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"HS Code"}),e.jsx("input",{type:"text",className:"input",name:"hs_code",value:h.hs_code,onChange:x})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Customs Decl. No"}),e.jsx("input",{type:"text",className:"input",name:"customs_declaration_number",value:h.customs_declaration_number,onChange:x})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Declaration Date"}),e.jsx("input",{type:"date",className:"input",name:"declaration_date",value:h.declaration_date,onChange:x})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex justify-between items-center",children:[e.jsx("h3",{className:"card-title",children:"Charges & Duties"}),e.jsx("button",{type:"button",onClick:b,className:"btn-sm btn-secondary",children:"+ Add Charge"})]}),e.jsxs("div",{className:"card-body space-y-4",children:[p.length===0&&e.jsx("p",{className:"text-sm text-slate-500 italic",children:"No charges added yet."}),p.map((_,F)=>e.jsxs("div",{className:"flex gap-4 items-end border-b border-slate-100 pb-4 last:border-0 last:pb-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"label text-xs",children:"Type"}),e.jsxs("select",{className:"input text-sm py-1",value:_.charge_type,onChange:I=>j(F,"charge_type",I.target.value),children:[e.jsx("option",{value:"DUTY",children:"Import Duty"}),e.jsx("option",{value:"VAT",children:"VAT"}),e.jsx("option",{value:"LEVY",children:"Import Levy"}),e.jsx("option",{value:"HANDLING",children:"Port Handling"}),e.jsx("option",{value:"STORAGE",children:"Storage Fees"}),e.jsx("option",{value:"OTHER",children:"Other Charges"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"label text-xs",children:"Amount"}),e.jsx("input",{type:"number",step:"1",className:"input text-sm py-1",value:_.amount,onChange:I=>j(F,"amount",I.target.value)})]}),e.jsxs("div",{className:"flex-[2]",children:[e.jsx("label",{className:"label text-xs",children:"Vendor / Authority"}),e.jsx("input",{type:"text",className:"input text-sm py-1",value:_.vendor_authority,onChange:I=>j(F,"vendor_authority",I.target.value),placeholder:"e.g. GRA"})]}),e.jsx("button",{type:"button",onClick:()=>y(F),className:"text-red-500 hover:text-red-700 pb-2",children:""})]},F)),e.jsx("div",{className:"flex justify-end pt-4 border-t border-slate-100",children:e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-sm font-medium text-slate-500 mr-4",children:"Total Cost:"}),e.jsx("span",{className:"text-xl font-bold text-slate-900",children:h.total_clearance_cost.toLocaleString(void 0,{minimumFractionDigits:2})})]})})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Documents"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-6 text-center hover:bg-slate-50 cursor-pointer transition-colors",children:[e.jsx("div",{className:"text-slate-400 mb-2",children:e.jsx("svg",{className:"w-8 h-8 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsx("p",{className:"text-sm text-slate-600 font-medium",children:"Click to upload documents"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"PDF, JPG, PNG up to 10MB"})]}),e.jsx("div",{className:"mt-4 space-y-2",children:e.jsx("p",{className:"text-xs text-slate-400 italic text-center",children:"No documents attached"})})]})]}),e.jsx("div",{className:"card bg-blue-50 border-blue-100",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"Help & Instructions"}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"Ensure all duties are calculated based on the latest HS Code rates."}),e.jsx("li",{children:"Attach scanned copies of the Customs Declaration."}),e.jsx("li",{children:"Update status to 'Cleared' only when goods have left the port."})]})]})})]})]})]})}function hC(){const s=Ur().pathname.includes("purchase-bills-import")?"IMPORT":"LOCAL",{canPerformAction:r}=Ls(),[a,n]=f.useState(""),[i,l]=f.useState(!1),[o,d]=f.useState(""),[u,c]=f.useState([]);f.useEffect(()=>{let g=!0;return l(!0),d(""),Z.get("/purchase/bills",{params:{bill_type:s}}).then(x=>{var b;g&&c(Array.isArray((b=x.data)==null?void 0:b.items)?x.data.items:[])}).catch(x=>{var b,y;g&&d(((y=(b=x==null?void 0:x.response)==null?void 0:b.data)==null?void 0:y.message)||"Failed to load purchase bills")}).finally(()=>{g&&l(!1)}),()=>{g=!1}},[s]);const h=g=>({DRAFT:"badge-info",POSTED:"badge-success",CANCELLED:"badge-error"})[g]||"badge-info",m=g=>({UNPAID:"badge-error",PARTIALLY_PAID:"badge-warning",PAID:"badge-success"})[g]||"badge-info",p=f.useMemo(()=>{const g=a.toLowerCase();return u.filter(x=>{const b=String(x.bill_no||"").toLowerCase(),y=String(x.supplier_name||"").toLowerCase(),j=String(x.po_no||"").toLowerCase();return b.includes(g)||y.includes(g)||j.includes(g)})},[u,a]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:["Purchase Bills - ",s]}),e.jsx("p",{className:"text-sm mt-1",children:"Record and manage supplier bills"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/purchase",className:"btn btn-secondary",children:"Return to Menu"}),r(s==="IMPORT"?"purchase:purchase-bills-import":"purchase:purchase-bills-local","create")&&e.jsx(Re,{to:`/purchase/purchase-bills-${s.toLowerCase()}/new`,className:"btn-success",children:"+ New Bill"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by bill no / supplier / PO...",className:"input",value:a,onChange:g=>n(g.target.value)})})})}),e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Bill No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{children:"PO"}),e.jsx("th",{children:"GRN"}),e.jsx("th",{className:"text-right",children:"Total"}),e.jsx("th",{className:"text-right",children:"Tax"}),e.jsx("th",{className:"text-right",children:"Net"}),e.jsx("th",{children:"Payment"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[i?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):o?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center py-8 text-red-600",children:o})}):null,p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No records"})}):p.map(g=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:g.bill_no}),e.jsx("td",{children:g.bill_date?new Date(g.bill_date).toLocaleDateString():""}),e.jsx("td",{children:g.supplier_name}),e.jsx("td",{children:g.po_no||"-"}),e.jsx("td",{children:g.grn_no?g.grn_no:g.grn_id?e.jsx(Re,{to:`/inventory/grn-local/${g.grn_id}?mode=view`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:g.grn_no||String(g.grn_id)}):"-"}),e.jsx("td",{className:"text-right font-medium",children:Number(g.total_amount||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{className:"text-right",children:Number(g.tax_amount||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{className:"text-right font-medium",children:Number(g.net_amount||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${m(String(g.payment_status||""))}`,children:String(g.payment_status||"")||"-"})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${h(g.status)}`,children:g.status})}),e.jsxs("td",{children:[r(s==="IMPORT"?"purchase:purchase-bills-import":"purchase:purchase-bills-local","view")&&e.jsx(Re,{to:`/purchase/purchase-bills-${s.toLowerCase()}/${g.id}?mode=view`,className:"text-brand hover:text-brand-600 dark:text-brand-300 dark:hover:text-brand-200 text-sm font-medium",children:"View"}),e.jsx("button",{type:"button",className:"ml-2 text-slate-700 hover:text-slate-900 text-sm",title:"Print",onClick:()=>window.open(`/purchase/purchase-bills-${s.toLowerCase()}/${g.id}?mode=view`,"_blank"),children:"Print"}),e.jsx("button",{type:"button",className:"ml-2 text-slate-700 hover:text-slate-900 text-sm",title:"PDF",onClick:()=>window.open(`/purchase/purchase-bills-${s.toLowerCase()}/${g.id}?mode=view`,"_blank"),children:"PDF"}),r(s==="IMPORT"?"purchase:purchase-bills-import":"purchase:purchase-bills-local","edit")&&e.jsx(Re,{to:`/purchase/purchase-bills-${s.toLowerCase()}/${g.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-medium ml-2",children:"Edit"})]})]},g.id))]})]})})]})]})}const RA=[{id:4,code:"GHS",name:"Ghanaian Cedi"},{id:1,code:"USD",name:"US Dollar"},{id:2,code:"EUR",name:"Euro"},{id:3,code:"GBP",name:"British Pound"}];function Ox(){const{id:t}=Ps(),s=ps(),r=Ur(),a=!t||t==="new",n=r.pathname.includes("purchase-bills-import")?"IMPORT":"LOCAL",[i,l]=f.useState(!1),[o,d]=f.useState(!1),[u,c]=f.useState(""),[h,m]=f.useState([]),[p,g]=f.useState([]),[x,b]=f.useState([]),[y,j]=f.useState([]),[N,_]=f.useState([]),[F,I]=f.useState([]),[w,E]=f.useState([]),[W,R]=f.useState(null),[U,T]=f.useState([]),[Y,H]=f.useState(t&&t!=="new"?Number(t):null),[M,q]=f.useState({bill_no:"",bill_date:new Date().toISOString().split("T")[0],supplier_id:"",po_id:"",grn_id:"",bill_type:n,due_date:"",currency_id:4,exchange_rate:1,payment_terms:30,status:"DRAFT",discount_amount:0,freight_charges:0,other_charges:0}),[z,Q]=f.useState([{id:Date.now(),item_id:"",uom_id:"",qty:0,unit_price:0,discount_percent:0,tax_amount:0,line_total:0}]);f.useEffect(()=>{let se=!0;return(async()=>{var ne,ue,oe,le,X,me,we,Ie;try{if(a){const st=n==="IMPORT"?`PIB-${String(1).padStart(6,"0")}`:`PLB-${String(1).padStart(6,"0")}`;q(De=>({...De,bill_no:st}))}const[_e,Fe,Le,rt,He]=await Promise.all([Z.get("/purchase/suppliers").catch(()=>({data:{items:[]}})),Z.get("/purchase/orders").catch(()=>({data:{items:[]}})),Z.get("/inventory/items").catch(()=>({data:{items:[]}})),Z.get("/inventory/uoms").catch(()=>({data:{items:[]}})),Z.get("/finance/tax-codes").catch(()=>({data:{items:[]}}))]);se&&(m(Array.isArray((ne=_e.data)==null?void 0:ne.items)?_e.data.items:[]),g(Array.isArray((ue=Fe.data)==null?void 0:ue.items)?Fe.data.items:[]),j(Array.isArray((oe=Le.data)==null?void 0:oe.items)?Le.data.items:[]),_(Array.isArray((le=Le.data)==null?void 0:le.items)?Le.data.items:[]),I(Array.isArray((X=rt.data)==null?void 0:X.items)?rt.data.items:[]),T(Array.isArray((me=He.data)==null?void 0:me.items)?He.data.items:[]));try{const st=await Z.get("/purchase/grns",{params:{status:"APPROVED"}});se&&b(Array.isArray((we=st.data)==null?void 0:we.items)?st.data.items:[])}catch{}try{const st=await Z.get("/finance/currencies");if(se){const De=Array.isArray((Ie=st.data)==null?void 0:Ie.items)?st.data.items:[];E(De);const Te=De.find(Ce=>Number(Ce.is_base)===1);R(Te?Number(Te.id):null)}}catch{}}catch{se&&c("Failed to load lookups")}})(),()=>{se=!1}},[]),f.useEffect(()=>{if(a)return;let se=!0;return l(!0),c(""),Z.get(`/purchase/bills/${t}`).then(ae=>{var oe,le;if(!se)return;const ne=(oe=ae.data)==null?void 0:oe.item,ue=Array.isArray((le=ae.data)==null?void 0:le.details)?ae.data.details:[];ne&&(q({bill_no:ne.bill_no||"",bill_date:ne.bill_date?ne.bill_date.split("T")[0]:"",supplier_id:ne.supplier_id?String(ne.supplier_id):"",po_id:ne.po_id?String(ne.po_id):"",grn_id:ne.grn_id?String(ne.grn_id):"",bill_type:ne.bill_type||n,due_date:ne.due_date?ne.due_date.split("T")[0]:"",currency_id:ne.currency_id||4,exchange_rate:Number(ne.exchange_rate)||1,payment_terms:Number(ne.payment_terms)||30,status:ne.status||"DRAFT",discount_amount:Number(ne.discount_amount)||0,freight_charges:Number(ne.freight_charges)||0,other_charges:Number(ne.other_charges)||0}),Q(ue.length?ue.map(X=>({id:X.id||Date.now()+Math.random(),item_id:X.item_id?String(X.item_id):"",uom_id:X.uom_id?String(X.uom_id):"",qty:Number(X.qty)||0,unit_price:Number(X.unit_price)||0,discount_percent:Number(X.discount_percent)||0,tax_amount:Number(X.tax_amount)||0,line_total:Number(X.line_total)||0})):[]))}).catch(ae=>{se&&c("Failed to load purchase bill")}).finally(()=>{se&&l(!1)}),()=>{se=!1}},[t,a]);const L=se=>{const ae=Number(se.qty)||0,ne=Number(se.unit_price)||0,ue=Number(se.discount_percent)||0;let oe=Number(se.tax_amount)||0;const le=ae*ne,X=le*(ue/100),me=le-X;if(se.tax_code_id){const Ie=U.find(Fe=>String(Fe.id)===String(se.tax_code_id)),_e=Ie&&Number(Ie.rate_percent)||0;oe=me*(_e/100)}const we=me+oe;return{...se,tax_amount:oe,line_total:we}},V=async(se,ae)=>{var ne;try{const oe=(ne=(await Z.get(`/finance/item-tax/${ae}`)).data)==null?void 0:ne.tax;if(!oe)return;Q(le=>le.map(X=>{if(X.id!==se)return X;const me=Number(X.qty)||0,we=Number(X.unit_price)||0,Ie=Number(X.discount_percent)||0,_e=me*we,Fe=_e*(Ie/100),Le=_e-Fe,rt=Number(oe.tax_rate)||0,He={...X,tax_code_id:String(oe.id),tax_amount:Le*(rt/100)};return L(He)}))}catch{}},P=(se,ae,ne)=>{Q(ue=>ue.map(oe=>{if(oe.id!==se)return oe;let le={...oe,[ae]:ne};if(ae==="item_id"){const X=y.find(me=>String(me.id)===String(ne));if(X&&X.uom){const me=F.find(we=>String(we.uom_code)===String(X.uom));le.uom_id=me?String(me.id):""}ne&&V(se,ne)}if(ae==="tax_code_id"){const X=U.find(He=>String(He.id)===String(ne)),me=Number(le.qty)||0,we=Number(le.unit_price)||0,Ie=Number(le.discount_percent)||0,_e=me*we,Fe=_e*(Ie/100),Le=_e-Fe,rt=X&&Number(X.rate_percent)||0;le.tax_amount=Le*(rt/100)}return L(le)}))},C=()=>{Q(se=>[...se,{id:Date.now(),item_id:"",uom_id:"",qty:0,unit_price:0,discount_percent:0,tax_amount:0,line_total:0}])},k=se=>{Q(ae=>ae.filter(ne=>ne.id!==se))},B=async se=>{var ae,ne,ue,oe;try{const le=await Z.get(`/purchase/grns/${se}`),X=(ae=le.data)==null?void 0:ae.item,me=(ue=(ne=le.data)==null?void 0:ne.item)==null?void 0:ue.details;if(X&&(q(_e=>({..._e,po_id:X.po_id?String(X.po_id):_e.po_id,supplier_id:X.supplier_id?String(X.supplier_id):_e.supplier_id,grn_id:String(se)})),X.po_id))try{const Fe=(oe=(await Z.get(`/purchase/orders/${X.po_id}`)).data)==null?void 0:oe.item;if(Fe){const Le=String(Fe.currency||Fe.currency_code||Fe.currencyCode||"").toUpperCase(),rt=RA.find(He=>String(He.code).toUpperCase()===Le)||RA[0];q(He=>({...He,currency_id:Number(Fe.currency_id)||(rt?Number(rt.id):He.currency_id),exchange_rate:Fe.exchange_rate!=null?Number(Fe.exchange_rate||1):He.exchange_rate}))}}catch{}if(Array.isArray(me)&&me.length>0){const _e=me.map(Fe=>{const Le=F.find(De=>De.uom_code===Fe.uom||De.uom_name===Fe.uom),rt=Number(Fe.qty_accepted)||0,He=Number(Fe.unit_price)||0,st=rt*He;return{id:Date.now()+Math.random(),item_id:Fe.item_id?String(Fe.item_id):"",uom_id:Le?String(Le.id):"",qty:rt,unit_price:He,discount_percent:0,tax_amount:0,line_total:st}});Q(_e)}const Ie=Array.from(new Set(me.map(_e=>_e.item_id?String(_e.item_id):"").filter(Boolean))).map(_e=>y.find(Le=>String(Le.id)===_e)||{id:_e,item_code:_e,item_name:""});_(Ie)}catch(le){console.error("Failed to load GRN details",le)}},G=async se=>{var ue,oe,le;const{name:ae,value:ne}=se.target;if(q(X=>({...X,[ae]:ne})),ae==="supplier_id")if(ne){const X=h.find(we=>String(we.id)===String(ne)),me=X&&X.supplier_code&&String(X.supplier_code).trim()||(X?`SU-${String(Number(X.id||0)).padStart(6,"0")}`:"");if(me)try{const we=await Z.get("/finance/accounts",{params:{search:me}}),Ie=Array.isArray((ue=we.data)==null?void 0:ue.items)?we.data.items:[],_e=Ie.find(Le=>String(Le.code)===me)||Ie[0]||null,Fe=_e&&_e.currency_code&&String(_e.currency_code)||null;if(Fe){const Le=RA.find(rt=>String(rt.code).toUpperCase()===Fe.toUpperCase())||null;Le&&q(rt=>({...rt,currency_id:Number(Le.id)}))}}catch{}}else q(X=>({...X,currency_id:4}));if(ae==="grn_id"&&ne?await B(ne):ae==="grn_id"&&!ne&&_(y),ae==="po_id"&&ne){const X=p.find(Ie=>String(Ie.id)===ne);let me=M.supplier_id;X&&X.supplier_id&&(me=String(X.supplier_id),q(Ie=>({...Ie,supplier_id:me})));const we=x.filter(Ie=>String(Ie.po_id)===ne&&Ie.grn_type===n&&String(Ie.status).toUpperCase()==="APPROVED");we.length===1?await B(we[0].id):(q(Ie=>{const _e=we.find(Fe=>String(Fe.id)===Ie.grn_id);return{...Ie,supplier_id:me||Ie.supplier_id,grn_id:_e?Ie.grn_id:""}}),_(y))}if(ae==="currency_id"){const X=RA.find(Fe=>Number(Fe.id)===Number(ne)),me=X?String(X.code).toUpperCase():null,we=me&&w.find(Fe=>String(Fe.code).toUpperCase()===me.toUpperCase()),Ie=we?Number(we.id):null,_e=W?Number(W):null;if(!Ie||!_e)q(Fe=>({...Fe,exchange_rate:1}));else if(Ie===_e)q(Fe=>({...Fe,exchange_rate:1}));else try{const Fe=await Z.get("/finance/currency-rates",{params:{fromCurrencyId:Ie,toCurrencyId:_e}}),Le=Array.isArray((oe=Fe.data)==null?void 0:oe.items)?Fe.data.items:[];if(Le.length>0){const rt=Number(Le[0].rate)||1;q(He=>({...He,exchange_rate:rt}))}else{const rt=await Z.get("/finance/currency-rates",{params:{fromCurrencyId:_e,toCurrencyId:Ie}}),He=Array.isArray((le=rt.data)==null?void 0:le.items)?rt.data.items:[];if(He.length>0){const st=Number(He[0].rate)||1;q(De=>({...De,exchange_rate:1/st}))}else q(st=>({...st,exchange_rate:1}))}}catch{q(Fe=>({...Fe,exchange_rate:1}))}}},O=f.useMemo(()=>{const se=z.reduce((me,we)=>me+(Number(we.qty)||0)*(Number(we.unit_price)||0),0),ae=z.reduce((me,we)=>me+(Number(we.tax_amount)||0),0),ne=z.reduce((me,we)=>{const Ie=(Number(we.qty)||0)*(Number(we.unit_price)||0);return me+Ie*(Number(we.discount_percent)||0)/100},0),ue=ne+(Number(M.discount_amount)||0),oe=Number(M.freight_charges)||0,le=Number(M.other_charges)||0,X=se-ue+ae+oe+le;return{subTotal:se,itemDiscounts:ne,lineTaxTotal:ae,grandTotal:X}},[z,M.discount_amount,M.freight_charges,M.other_charges]),K=async()=>{var se,ae,ne;if(!M.bill_date){c("Bill Date is required");return}if(!M.supplier_id){c("Supplier is required");return}if(!M.grn_id){c("GRN is required for posting");return}if(z.length===0||!z.some(ue=>ue.item_id)){c("At least one item is required");return}try{d(!0);const ue={...M,bill_no:M.bill_no||void 0,supplier_id:Number(M.supplier_id),po_id:M.po_id?Number(M.po_id):null,grn_id:M.grn_id?Number(M.grn_id):null,currency_id:Number(M.currency_id),exchange_rate:Number(M.exchange_rate),payment_terms:Number(M.payment_terms),discount_amount:Number(M.discount_amount),freight_charges:Number(M.freight_charges),other_charges:Number(M.other_charges),status:"DRAFT",details:z.filter(X=>X.item_id).map(X=>({item_id:Number(X.item_id),uom_id:X.uom_id?Number(X.uom_id):null,qty:Number(X.qty)||0,unit_price:Number(X.unit_price)||0,discount_percent:Number(X.discount_percent)||0,tax_amount:Number(X.tax_amount)||0,line_total:Number(X.line_total)||0}))};let oe=null;if(Y)await Z.put(`/purchase/bills/${Y}`,ue);else{const X=await Z.post("/purchase/bills",ue);oe=Number(((se=X==null?void 0:X.data)==null?void 0:se.id)||0)||null,oe&&H(oe)}const le=Y||oe;if(!le){c("Bill not found for posting");return}await Z.post(`/purchase/bills/${le}/post`,{}),q(X=>({...X,status:"POSTED"})),s(`/purchase/purchase-bills-${n.toLowerCase()}`)}catch(ue){c(((ne=(ae=ue==null?void 0:ue.response)==null?void 0:ae.data)==null?void 0:ne.message)||"Posting failed")}finally{d(!1)}},J=()=>{q(se=>({...se,supplier_id:"",po_id:"",grn_id:"",due_date:"",currency_id:4,exchange_rate:1,payment_terms:30,discount_amount:0,freight_charges:0,other_charges:0})),Q([{id:Date.now(),item_id:"",uom_id:"",qty:0,unit_price:0,discount_percent:0,tax_amount:0,line_total:0}])},te=`/purchase/purchase-bills-${n.toLowerCase()}`;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:[a?"New":"Edit"," Purchase Bill - ",n]}),e.jsx("p",{className:"text-sm mt-1",children:"Record and manage supplier bills"})]}),e.jsx(Re,{to:te,className:"btn-secondary",children:"Back to List"})]}),i&&e.jsx("div",{className:"p-4 bg-white rounded shadow",children:"Loading..."}),u&&e.jsx("div",{className:"p-4 text-red-600 bg-white rounded shadow",children:u}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg px-4 py-2",children:e.jsx("h3",{className:"font-semibold",children:"Invoice Information"})}),e.jsxs("div",{className:"card-body p-4 grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Invoice Type"}),e.jsxs("select",{className:"input",value:M.bill_type,disabled:!0,children:[e.jsx("option",{value:"LOCAL",children:"Local"}),e.jsx("option",{value:"IMPORT",children:"Import"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Bill No"}),e.jsx("input",{className:"input bg-gray-100",value:M.bill_no,placeholder:"Auto-generated",disabled:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label required",children:"Bill Date"}),e.jsx("input",{type:"date",className:"input",name:"bill_date",value:M.bill_date,onChange:G})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label required",children:"Supplier"}),e.jsxs("select",{className:"input",name:"supplier_id",value:M.supplier_id,onChange:G,children:[e.jsx("option",{value:"",children:"-- Select Supplier --"}),h.map(se=>e.jsx("option",{value:se.id,children:se.supplier_name},se.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Related PO"}),e.jsxs("select",{className:"input",name:"po_id",value:M.po_id,onChange:G,children:[e.jsx("option",{value:"",children:"-- Select PO --"}),p.filter(se=>(!M.supplier_id||String(se.supplier_id)===String(M.supplier_id))&&se.po_type===n).map(se=>e.jsx("option",{value:se.id,children:se.po_no},se.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Related GRN"}),e.jsxs("select",{className:"input",name:"grn_id",value:M.grn_id,onChange:G,children:[e.jsx("option",{value:"",children:"-- Select GRN --"}),x.filter(se=>(!M.supplier_id||String(se.supplier_id)===String(M.supplier_id))&&(!M.po_id||String(se.po_id)===String(M.po_id))&&se.grn_type===n&&String(se.status).toUpperCase()==="APPROVED").map(se=>e.jsx("option",{value:se.id,children:se.grn_no},se.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Due Date"}),e.jsx("input",{type:"date",className:"input",name:"due_date",value:M.due_date,onChange:G})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsx("select",{className:"input",name:"currency_id",value:M.currency_id,onChange:G,children:RA.map(se=>e.jsx("option",{value:se.id,children:se.code},se.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Exchange Rate"}),e.jsx("input",{type:"number",className:"input text-right",name:"exchange_rate",value:M.exchange_rate,onChange:G,step:"0.000001"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Payment Terms (Days)"}),e.jsx("input",{type:"number",className:"input text-right",name:"payment_terms",value:M.payment_terms,onChange:G})]}),e.jsx("div",{className:"form-group"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg px-4 py-2 flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold",children:"Items"}),e.jsx("button",{type:"button",className:"btn-success text-xs",onClick:C,children:"+ Add Item"})]}),e.jsxs("div",{className:"card-body overflow-x-auto",children:[e.jsxs("div",{className:"mb-2 text-xs text-slate-600",children:["Unit of Measure and Conversions: select UOM per line. If the supplier billed in a different UOM than the items default, define or verify a conversion to ensure correct quantities and amounts.",e.jsx("span",{className:"ml-2",children:e.jsx(Re,{to:"/inventory/unit-conversions",className:"text-brand font-medium underline",children:"Manage conversions"})})]}),e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-1/4",children:"Item"}),e.jsx("th",{className:"w-28 text-right",children:"Qty"}),e.jsx("th",{className:"w-36 text-right",children:"UOM"}),e.jsx("th",{className:"w-32 text-right",children:"Unit Price"}),e.jsx("th",{className:"w-28 text-right",children:"Disc %"}),e.jsx("th",{className:"w-40 text-right",children:"Tax Amt"}),e.jsx("th",{className:"w-32 text-right",children:"Net Amount"}),e.jsx("th",{className:"w-16",children:"Action"})]})}),e.jsx("tbody",{children:z.map(se=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("select",{className:"input text-sm w-full",value:se.item_id,onChange:ae=>P(se.id,"item_id",ae.target.value),children:[e.jsx("option",{value:"",children:"Select Item"}),N.map(ae=>e.jsxs("option",{value:String(ae.id),children:[ae.item_code," - ",ae.item_name]},ae.id))]})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"input text-right text-sm w-full",value:se.qty,onChange:ae=>P(se.id,"qty",ae.target.value)})}),e.jsx("td",{children:e.jsxs("select",{className:"input text-sm w-full",value:se.uom_id,onChange:ae=>P(se.id,"uom_id",ae.target.value),children:[e.jsx("option",{value:"",children:"Select UOM"}),F.map(ae=>e.jsx("option",{value:String(ae.id),children:ae.uom_name?`${ae.uom_name} (${ae.uom_code})`:ae.uom_code},ae.id))]})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"input text-right text-sm w-full",value:se.unit_price,onChange:ae=>P(se.id,"unit_price",ae.target.value)})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"input text-right text-sm w-full",value:se.discount_percent,onChange:ae=>P(se.id,"discount_percent",ae.target.value)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{className:"input text-sm w-full",value:se.tax_code_id||"",onChange:ae=>P(se.id,"tax_code_id",ae.target.value),children:[e.jsx("option",{value:"",children:"No Tax"}),U.map(ae=>e.jsx("option",{value:String(ae.id),children:ae.name},ae.id))]}),e.jsx("span",{className:"text-right w-32",children:Number(se.tax_amount||0).toFixed(2)})]})}),e.jsx("td",{className:"text-right font-medium",children:Number(se.line_total).toFixed(2)}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700 p-1",onClick:()=>k(se.id),title:"Remove",children:e.jsx(VL,{size:16})})})]},se.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"hidden md:block"}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-gray-100 px-4 py-2 border-b",children:e.jsx("h3",{className:"font-semibold text-gray-700",children:"Summary"})}),e.jsxs("div",{className:"card-body p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Sub Total:"}),e.jsx("span",{className:"font-semibold",children:O.subTotal.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center text-red-600",children:[e.jsx("span",{className:"text-gray-600",children:"Discount Amount (Items + Global):"}),e.jsxs("span",{children:["-"," ",(O.itemDiscounts+Number(M.discount_amount)||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Global Discount Input:"}),e.jsx("input",{type:"number",className:"input w-32 text-right",name:"discount_amount",value:M.discount_amount,onChange:G})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Tax Amount:"}),e.jsx("span",{className:"font-semibold",children:O.lineTaxTotal.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Freight Charges:"}),e.jsx("input",{type:"number",className:"input w-32 text-right",name:"freight_charges",value:M.freight_charges,onChange:G})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Other Charges:"}),e.jsx("input",{type:"number",className:"input w-32 text-right",name:"other_charges",value:M.other_charges,onChange:G})]}),e.jsxs("div",{className:"border-t pt-2 mt-2 flex justify-between items-center text-lg font-bold",children:[e.jsx("span",{children:"Grand Total:"}),e.jsx("span",{children:O.grandTotal.toFixed(2)})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 justify-end",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:J,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-success",onClick:K,disabled:o,children:"Post"})]})]})}function Zee(){const[t,s]=f.useState(""),[r,a]=f.useState([]),[n,i]=f.useState(!1),[l,o]=f.useState(""),{canPerformAction:d}=Ls();f.useEffect(()=>{let c=!0;return i(!0),o(""),Z.get("/purchase/suppliers").then(h=>{var m;c&&a(Array.isArray((m=h.data)==null?void 0:m.items)?h.data.items:[])}).catch(h=>{var m,p;c&&o(((p=(m=h==null?void 0:h.response)==null?void 0:m.data)==null?void 0:p.message)||"Failed to load suppliers")}).finally(()=>{c&&i(!1)}),()=>{c=!1}},[]);const u=f.useMemo(()=>{const c=t.toLowerCase();return r.filter(h=>String(h.supplier_code||"").toLowerCase().includes(c)||String(h.supplier_name||"").toLowerCase().includes(c)||String(h.phone||"").toLowerCase().includes(c)||String(h.email||"").toLowerCase().includes(c))},[r,t]);return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Supplier Details Setup"}),e.jsx("p",{className:"text-sm mt-1",children:"Add and manage supplier master data"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/purchase",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/purchase/suppliers/new",className:"btn-success",children:"+ New Supplier"})]})]})}),e.jsxs("div",{className:"card-body",children:[l?e.jsx("div",{className:"text-sm text-red-600 mb-4",children:l}):null,e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by code, name, phone, email...",className:"input max-w-md",value:t,onChange:c=>s(c.target.value)})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[n?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):null,!n&&!u.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No suppliers found"})}):null,u.map(c=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:c.supplier_code||"-"}),e.jsx("td",{children:c.supplier_name}),e.jsx("td",{children:c.phone||"-"}),e.jsx("td",{children:c.email||"-"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${c.is_active?"badge-success":"badge-error"}`,children:c.is_active?"ACTIVE":"INACTIVE"})}),e.jsxs("td",{children:[d("purchase:suppliers","view")&&e.jsx(Re,{to:`/purchase/suppliers/${c.id}?mode=view`,className:"text-brand hover:text-brand-700 text-sm font-medium",children:"View"}),d("purchase:suppliers","edit")&&e.jsx(Re,{to:`/purchase/suppliers/${c.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"})]})]},c.id))]})]})})]})]})})}function AC(){const{id:t}=Ps(),s=ps(),r=!t||t==="new",a=f.useRef(null),[n,i]=f.useState(!1),[l,o]=f.useState(!1),[d,u]=f.useState(""),[c,h]=f.useState(""),[m,p]=f.useState("basic"),[g,x]=f.useState([]),[b,y]=f.useState({supplier_code:"",supplier_name:"",contact_person:"",email:"",phone:"",address:"",payment_terms:"",is_active:!0,supplier_type:"LOCAL",service_contractor:!1,tax_id:"",business_reg_no:"",industry:"",website:"",city:"",country:"GH",currency_id:"",credit_limit:"",bank_name:"",bank_account:"",swift_code:""});f.useEffect(()=>{if(r)return;let I=!0;return i(!0),u(""),Z.get(`/purchase/suppliers/${t}`).then(w=>{var W;if(!I)return;const E=(W=w.data)==null?void 0:W.item;E&&y(R=>({...R,supplier_code:E.supplier_code||"",supplier_name:E.supplier_name||"",contact_person:E.contact_person||"",email:E.email||"",phone:E.phone||"",address:E.address||"",payment_terms:E.payment_terms||"",is_active:!!E.is_active,supplier_type:E.supplier_type||R.supplier_type||"LOCAL",service_contractor:String(E.service_contractor||"").toUpperCase()==="Y"}))}).catch(w=>{var E,W;I&&u(((W=(E=w==null?void 0:w.response)==null?void 0:E.data)==null?void 0:W.message)||"Failed to load supplier")}).finally(()=>{I&&i(!1)}),()=>{I=!1}},[t,r]),f.useEffect(()=>{if(!r)return;(async()=>{var w,E,W;try{const R=await Z.get("/purchase/suppliers/next-code");if((w=R.data)!=null&&w.code){y(U=>({...U,supplier_code:R.data.code}));return}}catch(R){console.error("Failed to fetch next supplier code",R)}try{const R=await Z.get("/purchase/suppliers"),U=Array.isArray((E=R.data)==null?void 0:E.items)?R.data.items:[],T=await Z.get("/finance/accounts",{params:{search:"SU-"}}),Y=Array.isArray((W=T.data)==null?void 0:W.items)?T.data.items:[];let H=0;for(const q of U){const z=String(q.supplier_code||"").match(/^SU-(\d{6})$/);if(z){const Q=Number(z[1]);Number.isFinite(Q)&&Q>H&&(H=Q)}}for(const q of Y){const z=String(q.code||"").match(/^SU-(\d{6})$/);if(z){const Q=Number(z[1]);Number.isFinite(Q)&&Q>H&&(H=Q)}}const M=`SU-${String(H+1).padStart(6,"0")}`;y(q=>({...q,supplier_code:M}))}catch{}})()},[r]),f.useEffect(()=>{(async()=>{var w;try{const E=await Z.get("/finance/currencies"),W=Array.isArray((w=E.data)==null?void 0:w.items)?E.data.items:[];x(W);const R=W.find(U=>Number(U.is_base)===1)||W.find(U=>String(U.code||U.currency_code||"").toUpperCase()==="GHS")||W.find(U=>/ghana|cedi/i.test(String(U.name||U.currency_name||"")));R&&y(U=>({...U,currency_id:U.currency_id||String(R.id||"")}))}catch(E){console.error("Failed to fetch currencies",E)}})()},[]);const j=I=>{const{name:w,value:E,type:W,checked:R}=I.target;y(U=>({...U,[w]:W==="checkbox"?R:E}))},N=async I=>{var w,E;I.preventDefault(),o(!0),u(""),h("");try{const W={supplier_code:b.supplier_code||null,supplier_name:b.supplier_name,contact_person:b.contact_person||null,email:b.email||null,phone:b.phone||null,address:b.address||null,payment_terms:b.payment_terms||null,is_active:!!b.is_active,supplier_type:b.supplier_type||"LOCAL",currency_id:b.currency_id===void 0||b.currency_id===null?null:String(b.currency_id||""),service_contractor:b.service_contractor?"Y":"N"};r?await Z.post("/purchase/suppliers",W):await Z.put(`/purchase/suppliers/${t}`,W),h("Supplier saved successfully!"),ct.success("Supplier saved successfully"),s("/purchase/suppliers")}catch(W){u(((E=(w=W==null?void 0:W.response)==null?void 0:w.data)==null?void 0:E.message)||"Failed to save supplier")}finally{o(!1)}},_=()=>{const w="data:text/csv;charset=utf-8,"+["supplier_name","supplier_code","contact_person","email","phone","address","payment_terms"].join(",")+`
Example Supplier,SUP001,John Doe,john@example.com,1234567890,123 Main St,30 Days`,E=encodeURI(w),W=document.createElement("a");W.setAttribute("href",E),W.setAttribute("download","supplier_template.csv"),document.body.appendChild(W),W.click(),document.body.removeChild(W)},F=I=>{const w=I.target.files[0];if(!w)return;const E=new FileReader;E.onload=async W=>{const U=W.target.result.split(`
`).map(q=>q.trim()).filter(q=>q);if(U.length<2){u("Invalid CSV format or empty file");return}const T=U[0].split(",").map(q=>q.trim()),Y=U.slice(1);let H=0,M=0;i(!0);for(const q of Y){const z=q.split(",").map(L=>L.trim());if(z.length<1)continue;const Q={};if(T.forEach((L,V)=>{z[V]&&(Q[L]=z[V])}),!Q.supplier_name){M++;continue}try{await Z.post("/purchase/suppliers",{supplier_name:Q.supplier_name,supplier_code:Q.supplier_code||null,contact_person:Q.contact_person||null,email:Q.email||null,phone:Q.phone||null,address:Q.address||null,payment_terms:Q.payment_terms||null,is_active:!0}),H++}catch(L){console.error("Failed to upload row",q,L),M++}}i(!1),h(`Mass upload completed. Success: ${H}, Failed: ${M}`),a.current&&(a.current.value="")},E.readAsText(w)};return e.jsxs("div",{className:"max-w-7xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden my-6",children:[e.jsxs("div",{className:"text-white p-8",style:{background:"linear-gradient(135deg, #0E3646 0%, #0E3646 100%)"},children:[e.jsx("h1",{className:"text-3xl font-bold",children:" Supplier Setup & Configuration"}),e.jsx("p",{className:"mt-2 text-slate-300",children:"Manage supplier information, contacts, and performance"})]}),e.jsxs("div",{className:"flex flex-wrap justify-between items-center p-6 bg-slate-50 border-b border-slate-200 gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx("input",{type:"text",className:"w-full pl-3 pr-10 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#0E3646]",placeholder:"Search suppliers..."}),e.jsx("span",{className:"absolute right-3 top-2.5 text-slate-400",children:""})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"bg-slate-600 hover:bg-slate-700 text-white px-4 py-2 rounded-md transition-colors flex items-center gap-2",onClick:_,children:" Template"}),e.jsx("button",{type:"button",className:"bg-slate-600 hover:bg-slate-700 text-white px-4 py-2 rounded-md transition-colors flex items-center gap-2",onClick:()=>{var I;return(I=a.current)==null?void 0:I.click()},children:" Mass Upload"}),e.jsx("input",{type:"file",ref:a,className:"hidden",accept:".csv",onChange:F}),!r&&e.jsx("button",{type:"button",className:"text-white px-4 py-2 rounded-md transition-colors flex items-center gap-2",style:{backgroundColor:"#0E3646"},onClick:()=>{y({supplier_code:"",supplier_name:"",contact_person:"",email:"",phone:"",address:"",payment_terms:"",is_active:!0,supplier_type:"LOCAL",tax_id:"",business_reg_no:"",industry:"",website:"",city:"",country:"GH",currency:"GHS",credit_limit:"",bank_name:"",bank_account:"",swift_code:""}),s("/purchase/suppliers/new")},children:" New Supplier"}),e.jsx(Re,{to:"/purchase/suppliers",className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md transition-colors flex items-center gap-2",children:" View All"})]})]}),e.jsxs("div",{className:"p-8",children:[n&&e.jsx("div",{className:"text-center py-4",children:"Loading..."}),d&&e.jsx("div",{className:"bg-red-50 text-red-600 p-4 rounded-md mb-6",children:d}),c&&e.jsx("div",{className:"bg-green-50 text-green-600 p-4 rounded-md mb-6",children:c}),e.jsxs("form",{onSubmit:N,children:[e.jsx("div",{className:"flex border-b-2 border-slate-200 mb-8 overflow-x-auto",children:[{id:"basic",label:" Basic Information"},{id:"financial",label:" Financial Details"},{id:"documents",label:" Documents"}].map(I=>e.jsx("button",{type:"button",className:`px-6 py-3 font-medium whitespace-nowrap transition-colors border-b-2 -mb-[2px] ${m===I.id?"border-[#0E3646] text-[#0E3646]":"border-transparent text-slate-500 hover:bg-slate-50"}`,onClick:()=>p(I.id),children:I.label},I.id))}),e.jsxs("div",{className:m==="basic"?"block":"hidden",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4 pb-2 border-b-2 border-slate-800",children:" Supplier Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"Supplier Code"}),e.jsx("input",{type:"text",name:"supplier_code",className:`w-full px-3 py-2 border border-slate-300 rounded-md ${r?"bg-gray-50":"bg-gray-100 text-slate-500"}`,value:b.supplier_code,onChange:j,placeholder:r?"Auto-generated":"Locked for existing supplier",readOnly:!r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"Supplier Name *"}),e.jsx("input",{type:"text",name:"supplier_name",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 focus:border-transparent outline-none",value:b.supplier_name,onChange:j,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"Supplier Type"}),e.jsxs("select",{name:"supplier_type",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 outline-none",value:b.supplier_type,onChange:j,children:[e.jsx("option",{value:"LOCAL",children:"Local Supplier"}),e.jsx("option",{value:"IMPORT",children:"Import Supplier"}),e.jsx("option",{value:"BOTH",children:"Both"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"svc_contractor",type:"checkbox",name:"service_contractor",checked:b.service_contractor,onChange:j}),e.jsx("label",{htmlFor:"svc_contractor",className:"text-sm font-semibold text-slate-800",children:"Service Contractor"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"Status"}),e.jsxs("select",{name:"is_active",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 outline-none",value:b.is_active,onChange:I=>j({target:{name:"is_active",value:I.target.value==="true"}}),children:[e.jsx("option",{value:!0,children:"Active"}),e.jsx("option",{value:!1,children:"Inactive"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"Tax Registration Number"}),e.jsx("input",{type:"text",name:"tax_id",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 outline-none",value:b.tax_id,onChange:j,placeholder:"TIN/VAT number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"Industry"}),e.jsxs("select",{name:"industry",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 outline-none",value:b.industry,onChange:j,children:[e.jsx("option",{value:"",children:"Select Industry"}),e.jsx("option",{value:"MANUFACTURING",children:"Manufacturing"}),e.jsx("option",{value:"TRADING",children:"Trading"}),e.jsx("option",{value:"SERVICES",children:"Services"})]})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"Website"}),e.jsx("input",{type:"url",name:"website",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 outline-none",value:b.website,onChange:j,placeholder:"https://www.supplier.com"})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4 pb-2 border-b-2 border-slate-800",children:" Address & Contact"}),e.jsx("div",{className:"grid grid-cols-1 gap-6 mb-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"Address"}),e.jsx("textarea",{name:"address",rows:"2",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 outline-none",value:b.address,onChange:j,placeholder:"Street address"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"City"}),e.jsx("input",{type:"text",name:"city",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 outline-none",value:b.city,onChange:j})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"Country"}),e.jsxs("select",{name:"country",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 outline-none",value:b.country,onChange:j,children:[e.jsx("option",{value:"GH",children:"Ghana"}),e.jsx("option",{value:"NG",children:"Nigeria"}),e.jsx("option",{value:"CN",children:"China"}),e.jsx("option",{value:"US",children:"United States"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",name:"phone",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 outline-none",value:b.phone,onChange:j})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"Email"}),e.jsx("input",{type:"email",name:"email",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 outline-none",value:b.email,onChange:j})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"Contact Person (Primary)"}),e.jsx("input",{type:"text",name:"contact_person",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 outline-none",value:b.contact_person,onChange:j})]})})]})]}),e.jsxs("div",{className:m==="financial"?"block":"hidden",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4 pb-2 border-b-2 border-slate-800",children:" Payment & Financial Terms"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"Default Currency"}),e.jsxs("select",{name:"currency_id",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 outline-none",value:b.currency_id,onChange:j,children:[e.jsx("option",{value:"",children:"Select currency"}),g.map(I=>e.jsx("option",{value:I.id,children:(I.code||I.currency_code)+" - "+(I.name||I.currency_name||"")},I.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"Payment Terms (Days)"}),e.jsx("input",{type:"text",name:"payment_terms",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 outline-none",value:b.payment_terms,onChange:j})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"Credit Limit"}),e.jsx("input",{type:"number",name:"credit_limit",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 outline-none",value:b.credit_limit,onChange:j})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"Bank Name"}),e.jsx("input",{type:"text",name:"bank_name",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 outline-none",value:b.bank_name,onChange:j})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"Account Number"}),e.jsx("input",{type:"text",name:"bank_account",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 outline-none",value:b.bank_account,onChange:j})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-800 mb-1",children:"SWIFT Code"}),e.jsx("input",{type:"text",name:"swift_code",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-slate-500 outline-none",value:b.swift_code,onChange:j})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4 pb-2 border-b-2 border-slate-800",children:" Financial Statistics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"p-6 rounded-lg text-white text-center shadow-md",style:{background:"linear-gradient(135deg, #0E3646 0%, #1a5570 100%)"},children:[e.jsx("div",{className:"text-3xl font-bold mb-1",children:"GHS 250,000"}),e.jsx("div",{className:"text-sm opacity-90",children:"Total Purchases YTD"})]}),e.jsxs("div",{className:"p-6 rounded-lg text-white text-center shadow-md",style:{background:"linear-gradient(135deg, #0E3646 0%, #1a5570 100%)"},children:[e.jsx("div",{className:"text-3xl font-bold mb-1",children:"15"}),e.jsx("div",{className:"text-sm opacity-90",children:"Purchase Orders"})]}),e.jsxs("div",{className:"p-6 rounded-lg text-white text-center shadow-md",style:{background:"linear-gradient(135deg, #0E3646 0%, #1a5570 100%)"},children:[e.jsx("div",{className:"text-3xl font-bold mb-1",children:"GHS 45,000"}),e.jsx("div",{className:"text-sm opacity-90",children:"Outstanding Balance"})]}),e.jsxs("div",{className:"p-6 rounded-lg text-white text-center shadow-md",style:{background:"linear-gradient(135deg, #0E3646 0%, #1a5570 100%)"},children:[e.jsx("div",{className:"text-3xl font-bold mb-1",children:"28 Days"}),e.jsx("div",{className:"text-sm opacity-90",children:"Avg Payment Time"})]})]})]})]}),e.jsx("div",{className:m==="documents"?"block":"hidden",children:e.jsx("div",{className:"text-center py-10 text-slate-500 bg-slate-50 rounded-lg border border-dashed border-slate-300",children:e.jsx("p",{children:"Document Management coming soon."})})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-slate-200 mt-6",children:[e.jsx(Re,{to:"/purchase/suppliers",className:"px-6 py-2 border border-slate-300 rounded-md text-slate-700 hover:bg-slate-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",className:"px-6 py-2 text-white rounded-md transition-colors",style:{backgroundColor:"#2E8B1F"},onClick:()=>{window.confirm("Activate this supplier?")&&alert("Supplier activated successfully!")},children:" Activate"}),e.jsx("button",{type:"submit",className:"px-6 py-2 text-white rounded-md transition-colors disabled:opacity-50",style:{backgroundColor:"#0E3646"},disabled:l,children:l?"Saving...":" Save Supplier"})]})]})]})]})}function ete(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var m,p,g;try{o(!0);const x=await Z.get("/purchase/reports/import-order-tracking",{params:{from:t||null,to:r||null}});i(((m=x.data)==null?void 0:m.items)||[])}catch(x){ct.error(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Failed to load report")}finally{o(!1)}}function u(){const m=["PO No","Supplier","Order Date","Shipment ETA","Status","Value"],p=(Array.isArray(n)?n:[]).map(j=>[j.po_no||"-",j.supplier_name||"-",j.order_date?new Date(j.order_date).toLocaleDateString():"-",j.eta_date?new Date(j.eta_date).toLocaleDateString():"-",j.status||"-",Number(j.total_value||0).toFixed(2)]),g=[m.join(","),...p.map(j=>j.join(","))].join(`
`),x=new Blob([g],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(x),y=document.createElement("a");y.href=b,y.download="import-order-tracking.csv",y.click(),URL.revokeObjectURL(b)}function c(){const m=(Array.isArray(n)?n:[]).map(x=>({po_no:x.po_no||"-",supplier:x.supplier_name||"-",order_date:x.order_date?new Date(x.order_date).toLocaleDateString():"-",shipment_eta:x.eta_date?new Date(x.eta_date).toLocaleDateString():"-",status:x.status||"-",value:Number(x.total_value||0)})),p=is.json_to_sheet(m),g=is.book_new();is.book_append_sheet(g,p,"ImportOrderTracking"),yr(g,"import-order-tracking.xlsx")}function h(){const m=new hs("p","mm","a4");let p=15;m.setFontSize(14),m.text("Import Order Tracking",10,p),p+=8,m.setFontSize(10),m.text("PO No",10,p),m.text("Supplier",45,p),m.text("Order Date",95,p),m.text("Shipment ETA",130,p),m.text("Status",165,p),m.text("Value",190,p,{align:"right"}),p+=4,m.line(10,p,200,p),p+=5,(Array.isArray(n)?n:[]).forEach(g=>{p>270&&(m.addPage(),p=15);const x=String(g.po_no||"-"),b=String(g.supplier_name||"-"),y=g.order_date?new Date(g.order_date).toLocaleDateString():"-",j=g.eta_date?new Date(g.eta_date).toLocaleDateString():"-",N=String(g.status||"-"),_=Number(g.total_value||0).toFixed(2);m.text(x,10,p),m.text(b.slice(0,35),45,p),m.text(y,95,p),m.text(j,130,p),m.text(N,165,p),m.text(_,190,p,{align:"right"}),p+=5}),m.save("import-order-tracking.pdf")}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Import Order Tracking"}),e.jsx("p",{className:"text-sm mt-1",children:"Status and shipment tracking for import POs"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/purchase",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("button",{type:"button",className:"btn-success",onClick:u,disabled:l||n.length===0,children:"Export CSV"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:c,disabled:l||n.length===0,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:h,disabled:l||n.length===0,children:"Export PDF"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:m=>s(m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:m=>a(m.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"PO No"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{children:"Order Date"}),e.jsx("th",{children:"Shipment ETA"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"text-right",children:"Value"})]})}),e.jsx("tbody",{children:n.map(m=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:m.po_no||"-"}),e.jsx("td",{children:m.supplier_name||"-"}),e.jsx("td",{children:m.order_date?new Date(m.order_date).toLocaleDateString():"-"}),e.jsx("td",{children:m.eta_date?new Date(m.eta_date).toLocaleDateString():"-"}),e.jsx("td",{children:m.status||"-"}),e.jsx("td",{className:"text-right",children:Number(m.total_value||0).toLocaleString()})]},m.id))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function tte(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var m,p,g;try{o(!0);const x=await Z.get("/purchase/reports/local-order-tracking",{params:{from:t||null,to:r||null}});i(((m=x.data)==null?void 0:m.items)||[])}catch(x){ct.error(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Failed to load report")}finally{o(!1)}}function u(){const m=["PO No","Supplier","Order Date","Expected Delivery","Status","Value"],p=(Array.isArray(n)?n:[]).map(j=>[j.po_no||"-",j.supplier_name||"-",j.order_date?new Date(j.order_date).toLocaleDateString():"-",j.expected_delivery?new Date(j.expected_delivery).toLocaleDateString():"-",j.status||"-",Number(j.total_value||0).toFixed(2)]),g=[m.join(","),...p.map(j=>j.join(","))].join(`
`),x=new Blob([g],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(x),y=document.createElement("a");y.href=b,y.download="local_order_tracking.csv",y.click(),URL.revokeObjectURL(b)}function c(){const m=(Array.isArray(n)?n:[]).map(x=>({po_no:x.po_no||"-",supplier:x.supplier_name||"-",order_date:x.order_date?new Date(x.order_date).toLocaleDateString():"-",expected_delivery:x.expected_delivery?new Date(x.expected_delivery).toLocaleDateString():"-",status:x.status||"-",value:Number(x.total_value||0)})),p=is.json_to_sheet(m),g=is.book_new();is.book_append_sheet(g,p,"LocalOrderTracking"),yr(g,"local-order-tracking.xlsx")}function h(){const m=new hs("p","mm","a4");let p=15;m.setFontSize(14),m.text("Local Order Tracking",10,p),p+=8,m.setFontSize(10);const g=["PO No","Supplier","Order Date","Expected","Status","Value"];m.text(g[0],10,p),m.text(g[1],40,p),m.text(g[2],90,p),m.text(g[3],120,p),m.text(g[4],150,p),m.text(g[5],180,p,{align:"right"}),p+=4,m.line(10,p,200,p),p+=5,(Array.isArray(n)?n:[]).forEach(x=>{p>270&&(m.addPage(),p=15);const b=String(x.po_no||"-"),y=String(x.supplier_name||"-"),j=x.order_date?new Date(x.order_date).toLocaleDateString():"-",N=x.expected_delivery?new Date(x.expected_delivery).toLocaleDateString():"-",_=String(x.status||"-"),F=Number(x.total_value||0).toFixed(2);m.text(b,10,p),m.text(y.slice(0,30),40,p),m.text(j,90,p),m.text(N,120,p),m.text(_,150,p),m.text(F,180,p,{align:"right"}),p+=5}),m.save("local-order-tracking.pdf")}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Local Order Tracking"}),e.jsx("p",{className:"text-sm mt-1",children:"Status tracking for local purchase orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/purchase",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("button",{type:"button",className:"btn-success",onClick:u,disabled:l||n.length===0,children:"Export CSV"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:c,disabled:l||n.length===0,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:h,disabled:l||n.length===0,children:"Export PDF"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:m=>s(m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:m=>a(m.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"PO No"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{children:"Order Date"}),e.jsx("th",{children:"Expected Delivery"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"text-right",children:"Value"})]})}),e.jsx("tbody",{children:n.map(m=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:m.po_no||"-"}),e.jsx("td",{children:m.supplier_name||"-"}),e.jsx("td",{children:m.order_date?new Date(m.order_date).toLocaleDateString():"-"}),e.jsx("td",{children:m.expected_delivery?new Date(m.expected_delivery).toLocaleDateString():"-"}),e.jsx("td",{children:m.status||"-"}),e.jsx("td",{className:"text-right",children:Number(m.total_value||0).toLocaleString()})]},m.id))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function ste(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var m,p,g;try{o(!0);const x=await Z.get("/purchase/reports/purchase-tracking",{params:{from:t||null,to:r||null}});i(((m=x.data)==null?void 0:m.items)||[])}catch(x){ct.error(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Failed to load report")}finally{o(!1)}}function u(){const m=["Stage","Reference","Supplier","Date","Status","Value"],p=(Array.isArray(n)?n:[]).map(j=>[j.stage||"-",j.ref_no||"-",j.supplier_name||"-",j.txn_date?new Date(j.txn_date).toLocaleDateString():"-",j.status||"-",Number(j.total_value||0).toFixed(2)]),g=[m.join(","),...p.map(j=>j.join(","))].join(`
`),x=new Blob([g],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(x),y=document.createElement("a");y.href=b,y.download="purchase_tracking.csv",y.click(),URL.revokeObjectURL(b)}function c(){const m=(Array.isArray(n)?n:[]).map(x=>({stage:x.stage||"-",reference:x.ref_no||"-",supplier:x.supplier_name||"-",date:x.txn_date?new Date(x.txn_date).toLocaleDateString():"-",status:x.status||"-",value:Number(x.total_value||0)})),p=is.json_to_sheet(m),g=is.book_new();is.book_append_sheet(g,p,"PurchaseTracking"),yr(g,"purchase-tracking.xlsx")}function h(){const m=new hs("p","mm","a4");let p=15;m.setFontSize(14),m.text("Purchase Tracking",10,p),p+=8,m.setFontSize(10);const g=["Stage","Reference","Supplier","Date","Status","Value"];m.text(g[0],10,p),m.text(g[1],45,p),m.text(g[2],90,p),m.text(g[3],130,p),m.text(g[4],160,p),m.text(g[5],190,p,{align:"right"}),p+=4,m.line(10,p,200,p),p+=5,(Array.isArray(n)?n:[]).forEach(x=>{p>270&&(m.addPage(),p=15);const b=String(x.stage||"-"),y=String(x.ref_no||"-"),j=String(x.supplier_name||"-"),N=x.txn_date?new Date(x.txn_date).toLocaleDateString():"-",_=String(x.status||"-"),F=Number(x.total_value||0).toFixed(2);m.text(b.slice(0,25),10,p),m.text(y.slice(0,30),45,p),m.text(j.slice(0,35),90,p),m.text(N,130,p),m.text(_,160,p),m.text(F,190,p,{align:"right"}),p+=5}),m.save("purchase-tracking.pdf")}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Purchase Tracking"}),e.jsx("p",{className:"text-sm mt-1",children:"Overall tracking of purchase requests, orders, and bills"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/purchase",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("button",{type:"button",className:"btn-success",onClick:u,disabled:l||n.length===0,children:"Export CSV"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:c,disabled:l||n.length===0,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:h,disabled:l||n.length===0,children:"Export PDF"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:m=>s(m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:m=>a(m.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Stage"}),e.jsx("th",{children:"Reference"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"text-right",children:"Value"})]})}),e.jsx("tbody",{children:n.map((m,p)=>e.jsxs("tr",{children:[e.jsx("td",{children:m.stage||"-"}),e.jsx("td",{className:"font-medium",children:m.ref_no||"-"}),e.jsx("td",{children:m.supplier_name||"-"}),e.jsx("td",{children:m.txn_date?new Date(m.txn_date).toLocaleDateString():"-"}),e.jsx("td",{children:m.status||"-"}),e.jsx("td",{className:"text-right",children:Number(m.total_value||0).toLocaleString()})]},m.id||p))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function dF(){var g;const t=Ur(),{canPerformAction:s}=Ls(),r=((g=t.state)==null?void 0:g.success)||"",[a,n]=f.useState([]),[i,l]=f.useState(!1),[o,d]=f.useState(""),[u,c]=f.useState(""),[h,m]=f.useState("ALL");f.useEffect(()=>{l(!0),d(""),Z.get("/purchase/service-bills").then(x=>{var b;n(Array.isArray((b=x==null?void 0:x.data)==null?void 0:b.items)?x.data.items:[])}).catch(x=>{var b,y;d(((y=(b=x==null?void 0:x.response)==null?void 0:b.data)==null?void 0:y.message)||"Failed to load service bills")}).finally(()=>l(!1))},[]);const p=f.useMemo(()=>{const x=u.trim().toLowerCase();return a.filter(b=>{const y=String(b.bill_no||"").toLowerCase(),j=String(b.client_name||"").toLowerCase(),N=String(b.status||"").toUpperCase(),_=!x||y.includes(x)||j.includes(x),F=h==="ALL"||N===String(h).toUpperCase();return _&&F})},[a,u,h]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Service Bills"}),e.jsx("p",{className:"text-sm mt-1",children:"Prepare and manage service bills"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/purchase",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/purchase/service-bills/new",className:"btn-success",children:"+ New Bill"})]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[r?e.jsx("div",{className:"mb-3 p-3 rounded bg-green-50 border border-green-200 text-green-700 text-sm",children:r}):null,o?e.jsx("div",{className:"mb-3 text-sm text-red-600",children:o}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Search by bill no or client...",className:"input",value:u,onChange:x=>c(x.target.value)}),e.jsxs("select",{className:"input",value:h,onChange:x=>m(x.target.value),children:[e.jsx("option",{value:"ALL",children:"All Status"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"PAID",children:"Paid"}),e.jsx("option",{value:"OVERDUE",children:"Overdue"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Client"}),e.jsx("th",{children:"Payment"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[i?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):null,!i&&p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center text-slate-500 dark:text-slate-400",children:"No service bills"})}):null,p.map(x=>e.jsxs("tr",{children:[e.jsx("td",{children:x.bill_no}),e.jsx("td",{children:x.bill_date}),e.jsx("td",{children:x.client_name||"-"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${String(x.payment||"").toUpperCase()==="PAID"?"badge-success":"badge-warning"}`,children:String(x.payment||"UNPAID").toUpperCase()})}),e.jsx("td",{className:"text-right",children:Number(x.total_amount||0).toFixed(2)}),e.jsx("td",{children:e.jsx("span",{className:`badge ${String(x.status||"").toUpperCase()==="PAID"?"badge-success":String(x.status||"").toUpperCase()==="OVERDUE"?"badge-error":"badge-warning"}`,children:String(x.status||"").toUpperCase()})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[s("service-management:service-bills","view")&&e.jsx(Re,{to:`/purchase/service-bills/${x.id}?mode=view`,className:"btn btn-xs btn-outline",children:"View"}),s("service-management:service-bills","edit")&&e.jsx(Re,{to:`/purchase/service-bills/${x.id}?mode=edit`,className:`btn btn-xs btn-primary ${String(x.payment||"").toUpperCase()==="PAID"?"pointer-events-none opacity-50 cursor-not-allowed":""}`,"aria-disabled":String(x.payment||"").toUpperCase()==="PAID",children:"Edit"})]})})]},x.id))]})]})})]})})]})}function rte({status:t}){const s=String(t||"").toLowerCase(),r={paid:{label:" PAID",cls:"bg-green-100 text-green-700 border-green-200"},overdue:{label:" OVERDUE",cls:"bg-red-100 text-red-700 border-red-200"},pending:{label:" PENDING",cls:"bg-amber-100 text-amber-700 border-amber-200"}},a=r[s]||r.pending;return e.jsx("span",{className:`inline-block px-3 py-1 text-xs rounded border ${a.cls}`,children:a.label})}function ate({payment:t}){const s=String(t||"").toLowerCase(),r={paid:{label:"Paid",cls:"bg-green-100 text-green-700 border-green-200"},unpaid:{label:"Unpaid",cls:"bg-amber-100 text-amber-700 border-amber-200"}},a=r[s]||r.unpaid;return e.jsx("span",{className:`inline-block px-3 py-1 text-xs rounded border ${a.cls}`,children:a.label})}function nte({idx:t,row:s,taxCodes:r,onChange:a,onRemove:n,readOnly:i}){var b;const l=(y,j)=>a(t,{...s,[y]:j}),o=Number(s.qty||0),d=Number(s.rate||0),u=o*d,c=Number(s.discount_percent||0),h=Number((r.find(y=>String(y.id)===String(s.tax_code_id))||{}).rate_percent||0)||0,m=u*(c/100),p=u-m,g=p*(h/100),x=p+g;return e.jsxs("tr",{children:[e.jsx("td",{className:"p-2",children:t+1}),e.jsx("td",{className:"p-2",children:e.jsxs("select",{className:`input ${i?"bg-blue-50 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700 font-semibold":""}`,value:s.item_id||"",onChange:y=>l("item_id",y.target.value),disabled:i,children:[e.jsx("option",{value:"",children:"Select service item"}),(b=s.options)==null?void 0:b.map(y=>e.jsx("option",{value:String(y.id),children:y.item_name},y.id))]})}),e.jsx("td",{className:"p-2",children:e.jsxs("select",{className:`input ${i?"bg-blue-50 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700 font-semibold":""}`,value:s.category||"",onChange:y=>l("category",y.target.value),disabled:i,children:[e.jsx("option",{value:"",children:"Select service"}),e.jsx("option",{value:"installation",children:"Installation"}),e.jsx("option",{value:"maintenance",children:"Maintenance"}),e.jsx("option",{value:"repair",children:"Repair"}),e.jsx("option",{value:"consultation",children:"Consultation"})]})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:`input text-right ${i?"bg-blue-50 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700 font-semibold":""}`,type:"number",value:s.qty??"",onChange:y=>l("qty",y.target.value),placeholder:"Qty",readOnly:i,disabled:i})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:`input text-right ${i?"bg-blue-50 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700 font-semibold":""}`,type:"number",value:s.rate??"",onChange:y=>l("rate",y.target.value),placeholder:"Rate",readOnly:i,disabled:i})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:`input text-right ${i?"bg-blue-50 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700 font-semibold":""}`,type:"number",step:"0.01",value:s.discount_percent??"",onChange:y=>l("discount_percent",y.target.value),placeholder:"Disc %",readOnly:i,disabled:i})}),e.jsx("td",{className:"p-2",children:e.jsxs("select",{className:`input ${i?"bg-blue-50 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700 font-semibold":""}`,value:s.tax_code_id||"",onChange:y=>l("tax_code_id",y.target.value),disabled:i,children:[e.jsx("option",{value:"",children:"No Tax"}),r.map(y=>e.jsx("option",{value:String(y.id),children:y.name},y.id))]})}),e.jsx("td",{className:"p-2 text-right",children:Number(x||0).toFixed(2)}),e.jsx("td",{className:"p-2",children:i?null:e.jsx("button",{type:"button",className:"btn-danger",onClick:()=>n(t),children:"Remove"})})]})}function Yb(){var q;const t=ps(),s=Ur(),{id:r}=Ps(),a=String(new URLSearchParams(s.search).get("mode")||"").toLowerCase()==="view",n=a?"bg-blue-50 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700 font-semibold":"",i=((q=s.state)==null?void 0:q.success)||"",[l,o]=f.useState({number:"",status:"pending",billDate:"",dueDate:"",supplierId:"",relatedExecId:"",currency:"GHS",exchangeRate:1,paymentTermsDays:"30",otherCharges:0,services:[],subtotal:0,tax:0,total:0,paymentMethod:"cash",paymentReference:"",notes:"",terms:""}),[d,u]=f.useState([]),[c,h]=f.useState([]),[m,p]=f.useState([]),[g,x]=f.useState(null),[b,y]=f.useState([]),[j,N]=f.useState([]),[_]=f.useState([{key:"cash",label:"Cash",icon:""},{key:"card",label:"Card",icon:""},{key:"mobile",label:"Mobile Money",icon:""},{key:"bank",label:"Bank Transfer",icon:""}]),F=z=>{o(Q=>({...Q,paymentMethod:z}))},I=(z,Q)=>{o(L=>({...L,[z]:Q}))},w=()=>{o(z=>({...z,services:[...z.services,{item_id:"",desc:"",category:"",qty:"",rate:"",options:b,discount_percent:"",tax_code_id:""}]}))},E=z=>{o(Q=>({...Q,services:Q.services.filter((L,V)=>V!==z)}))},W=(z,Q)=>{if(o(L=>({...L,services:L.services.map((V,P)=>P===z?Q:V)})),Q.item_id){const L=b.find(V=>String(V.id)===String(Q.item_id));L&&o(V=>({...V,services:V.services.map((P,C)=>C===z?{...Q,desc:L.item_name}:P)}))}},R=f.useMemo(()=>{let z=0,Q=0,L=0;for(const C of l.services){const k=Number(C.qty||0),B=Number(C.rate||0),G=k*B;z+=G;const O=Number(C.discount_percent||0),K=G*(O/100);Q+=K;const J=Number((j.find(ae=>String(ae.id)===String(C.tax_code_id))||{}).rate_percent||0)||0,se=(G-K)*(J/100);L+=se}const V=Number(l.otherCharges||0),P=z-Q+L+V;return{subtotal:z,discountAmount:Q,taxAmount:L,otherCharges:V,total:P}},[l.services,l.otherCharges,j]);Is.useEffect(()=>{o(z=>({...z,subtotal:R.subtotal,tax:R.taxAmount,total:R.total}))},[R.subtotal,R.taxAmount,R.total]),Is.useEffect(()=>{let z=!0;async function Q(){var L,V,P,C,k;try{const[B,G,O,K]=await Promise.all([Z.get("/purchase/suppliers",{params:{contractor:"Y"}}),Z.get("/purchase/service-executions"),Z.get("/finance/currencies"),Z.get("/inventory/items")]);if(!z)return;u(Array.isArray((L=B.data)==null?void 0:L.items)?B.data.items:[]),h(Array.isArray((V=G.data)==null?void 0:V.items)?G.data.items:[]);const J=Array.isArray((P=O.data)==null?void 0:P.items)?O.data.items:[];p(J);const te=J.find(ne=>Number(ne.is_base)===1)||J.find(ne=>String(ne.code||ne.currency_code||"").toUpperCase()==="GHS")||J.find(ne=>/ghana|cedi/i.test(String(ne.name||ne.currency_name||"")));x(te?Number(te.id):null);const ae=(Array.isArray((C=K.data)==null?void 0:C.items)?K.data.items:[]).filter(ne=>String(ne.service_item||"").toUpperCase()==="Y");y(ae.map(ne=>({id:ne.id,item_name:ne.item_name})));try{const ne=await Z.get("/finance/tax-codes");N(Array.isArray((k=ne.data)==null?void 0:k.items)?ne.data.items:[])}catch{}}catch{}}return Q(),()=>{z=!1}},[]);const U=z=>{if(!z)return null;try{const Q=new Date(z);if(!isNaN(Q))return Q.toISOString().slice(0,10)}catch{}return typeof z=="string"?z.slice(0,10):null},T=z=>{const Q=String(z||"").match(/(\d+)\s*days?/i);return Q?String(Number(Q[1])):""},Y=z=>{const Q=String(z||"").split(`
`).map(B=>B.trim()),L=B=>{const G=Q.find(O=>O.toLowerCase().startsWith(B.toLowerCase()));return G?G.split(":").slice(1).join(":").trim():""},V=L("SupplierId"),P=L("RelatedExec"),C=L("Currency"),k=L("Exchange");return{supplierId:V||"",relatedExecId:P||"",currency:C||"",exchangeRate:k||""}};Is.useEffect(()=>{let z=!0;async function Q(){var L,V;if(r)try{const P=await Z.get(`/purchase/service-bills/${r}`),C=((L=P.data)==null?void 0:L.item)||{},k=Array.isArray((V=P.data)==null?void 0:V.details)?P.data.details:[];if(!z)return;const B=Y(C.notes),G=Number(C.total_amount||0)-(Number(C.subtotal||0)-Number(C.discount_amount||0)+Number(C.tax_amount||0));o(O=>({...O,payment:String(C.payment||O.payment||"UNPAID").toUpperCase(),number:C.bill_no||O.number,status:String(C.status||O.status).toLowerCase(),serviceDate:U(C.service_date)||O.serviceDate,billDate:U(C.bill_date)||O.billDate,dueDate:U(C.due_date)||O.dueDate,supplierId:B.supplierId||O.supplierId,relatedExecId:B.relatedExecId||O.relatedExecId,currency:String(B.currency||O.currency||"GHS").toUpperCase(),exchangeRate:B.exchangeRate?Number(B.exchangeRate):O.exchangeRate,paymentTermsDays:T(C.payment_terms)||O.paymentTermsDays,services:k.map(K=>({item_id:"",desc:K.description||"",category:K.category||"",qty:K.qty,rate:K.rate,discount_percent:"",tax_code_id:"",options:b,discountAmount:Number(C.discount_amount||O.discountAmount||0),discountPercent:Number(C.discount_percent||O.discountPercent||0)})),taxPercent:Number(C.tax_percent||O.taxPercent||0),subtotal:Number(C.subtotal||O.subtotal||0),tax:Number(C.tax_amount||O.tax||0),total:Number(C.total_amount||O.total||0),otherCharges:Number(G||0),notes:C.notes||O.notes,terms:C.payment_terms||O.terms,paymentMethod:C.payment_method||O.paymentMethod,paymentReference:C.payment_reference||O.paymentReference}))}catch{}}return Q(),()=>{z=!1}},[]);const H=async z=>{var C;o(k=>({...k,currency:z})),o(k=>({...k,currency:z}));const L=(Array.isArray(m)?m:[]).find(k=>String(k.code||k.currency_code||"").toUpperCase()===z),V=g?Number(g):null,P=L?Number(L.id):null;if(!V||!P||V===P){o(k=>({...k,exchangeRate:1}));return}try{const k=await Z.get("/finance/currency-rates",{params:{fromCurrencyId:P,toCurrencyId:V}}),G=(Array.isArray((C=k.data)==null?void 0:C.items)?k.data.items:[])[0];G&&G.rate?o(O=>({...O,exchangeRate:Number(G.rate)||1})):o(O=>({...O,exchangeRate:1}))}catch{o(k=>({...k,exchangeRate:1}))}};Is.useEffect(()=>{let z=!0;async function Q(){var L;try{const P=(L=(await Z.get("/purchase/service-bills/next-no")).data)==null?void 0:L.nextNo,C=Number(String(P||"").replace(/\D/g,""))||1,k=String(C).padStart(6,"0");if(!z)return;o(B=>B.number?B:{...B,number:`SVB-${k}`})}catch{if(!z)return;o(V=>V.number?V:{...V,number:`SVB-${String(1).padStart(6,"0")}`})}}return Q(),()=>{z=!1}},[]);function M(){var C;const z=d.find(k=>String(k.id)===String(l.supplierId||"")),Q=(z==null?void 0:z.supplier_name)||(z==null?void 0:z.name)||(z==null?void 0:z.company)||null,L={bill_no:l.number||null,bill_date:U(l.billDate),due_date:U(l.dueDate),supplier_id:l.supplierId||null,service_date:U(l.serviceDate),client_name:Q,status:((C=l.status)==null?void 0:C.toUpperCase())||"PENDING",payment_method:l.paymentMethod||"cash",payment_reference:l.paymentReference||null,payment_terms:l.paymentTermsDays?`${l.paymentTermsDays} days`:null,notes:[l.notes||"",l.supplierId?`SupplierId: ${l.supplierId}`:"",l.relatedExecId?`RelatedExec: ${l.relatedExecId}`:"",l.currency?`Currency: ${l.currency}`:"",l.exchangeRate?`Exchange: ${l.exchangeRate}`:""].filter(Boolean).join(`
`).trim()||null,details:l.services.map(k=>({description:k.desc||"",category:k.category||"",qty:Number(k.qty||0),rate:Number(k.rate||0),amount:Number(k.qty||0)*Number(k.rate||0)})),subtotal:Number(R.subtotal||0),discount_amount:Number(R.discountAmount||0),tax_amount:Number(R.taxAmount||0),total_amount:Number(R.total||0)},V=String(new URLSearchParams(s.search).get("mode")||"").toLowerCase()==="edit";(r&&V?Z.put(`/purchase/service-bills/${r}`,L):Z.post("/purchase/service-bills",L)).then(()=>{t("/purchase/service-bills",{state:{success:"Service bill saved successfully"}})}).catch(k=>{var B,G;return alert(((G=(B=k==null?void 0:k.response)==null?void 0:B.data)==null?void 0:G.message)||"Failed to save service bill")})}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Re,{to:"/purchase/service-bills",className:"btn-secondary",children:" Back"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Service Bill"}),e.jsx("p",{className:"text-sm mt-1",children:"Prepare and issue bill for services provided"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Bill No"}),e.jsx("div",{className:"text-lg font-semibold",children:l.number})]})]}),i?e.jsx("div",{className:"mb-3 p-3 rounded bg-green-50 border border-green-200 text-green-700 text-sm",children:i}):null,e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-semibold",children:"Bill Details"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rte,{status:l.status}),e.jsx(ate,{payment:l.payment})]})]})}),e.jsxs("div",{className:"card-body grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Bill No"}),e.jsx("input",{className:`input ${n}`,value:l.number,onChange:z=>I("number",z.target.value),placeholder:"Auto-generated",readOnly:a,disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Bill Date"}),e.jsx("input",{className:`input ${n}`,type:"date",value:l.billDate,onChange:z=>I("billDate",z.target.value),readOnly:a,disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Supplier"}),e.jsxs("select",{className:`input ${n}`,value:l.supplierId||"",onChange:z=>I("supplierId",z.target.value),disabled:a,children:[e.jsx("option",{value:"",children:"-- Select Supplier --"}),d.map(z=>e.jsx("option",{value:String(z.id),children:z.supplier_name||z.name||z.company||z.id},z.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Service Execution"}),e.jsxs("select",{className:`input ${n}`,value:l.relatedExecId||"",onChange:z=>I("relatedExecId",z.target.value),disabled:a,children:[e.jsx("option",{value:"",children:"-- Select Execution --"}),c.map(z=>e.jsx("option",{value:String(z.id),children:z.execution_no||z.order_no||z.id},z.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsx("select",{className:`input ${n}`,value:l.currency||"GHS",onChange:z=>H(String(z.target.value||"GHS").toUpperCase()),disabled:a,children:m.map(z=>e.jsxs("option",{value:String(z.code||z.currency_code).toUpperCase(),children:[String(z.code||z.currency_code).toUpperCase()," -"," ",z.name||z.currency_name]},z.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Exchange Rate"}),e.jsx("input",{className:`input text-right ${n}`,type:"number",step:"0.000001",value:l.exchangeRate||1,onChange:z=>I("exchangeRate",z.target.value),readOnly:a,disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Payment Terms (Days)"}),e.jsx("input",{className:`input text-right ${n}`,type:"number",value:l.paymentTermsDays||"",onChange:z=>I("paymentTermsDays",z.target.value),placeholder:"e.g., 30",readOnly:a,disabled:a})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"font-semibold",children:"Bill Information"})}),e.jsxs("div",{className:"card-body grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Bill Date"}),e.jsx("input",{className:`input ${n}`,type:"date",value:l.billDate,onChange:z=>I("billDate",z.target.value),readOnly:a,disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Due Date"}),e.jsx("input",{className:`input ${n}`,type:"date",value:l.dueDate,onChange:z=>I("dueDate",z.target.value),readOnly:a,disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Service Date"}),e.jsx("input",{className:`input ${n}`,type:"date",value:l.serviceDate||"",onChange:z=>I("serviceDate",z.target.value),readOnly:a,disabled:a})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Category"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{className:"text-right",children:"Rate"}),e.jsx("th",{className:"text-right",children:"Disc %"}),e.jsx("th",{children:"Tax"}),e.jsx("th",{className:"text-right",children:"Amount"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[l.services.map((z,Q)=>e.jsx(nte,{idx:Q,row:{...z,options:b},taxCodes:j,onChange:W,onRemove:E,readOnly:a},Q)),e.jsx("tr",{children:a?null:e.jsx("td",{colSpan:"7",children:e.jsx("button",{type:"button",className:"btn-success",onClick:w,children:"+ Add Service Line"})})})]})]})})}),e.jsx("div",{className:"md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:"Sub Total"}),e.jsx("div",{className:"font-semibold",children:Number(R.subtotal||0).toFixed(2)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:"Discount Amount"}),e.jsx("div",{className:"font-semibold",children:Number(R.discountAmount||0).toFixed(2)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:"Tax Amount"}),e.jsx("div",{className:"font-semibold",children:Number(R.taxAmount||0).toFixed(2)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:"Other Charges"}),e.jsx("input",{className:"input w-36 text-right",type:"number",step:"0.01",value:l.otherCharges,onChange:z=>I("otherCharges",z.target.value)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:"Grand Total"}),e.jsx("div",{className:"text-xl font-bold",children:Number(R.total||0).toFixed(2)})]})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"font-semibold",children:"Payment Details"})}),e.jsx("div",{className:"card-body grid grid-cols-1 md:grid-cols-2 gap-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Payment Method"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:_.map(z=>{const Q=l.paymentMethod===z.key;return e.jsxs("button",{type:"button",className:`p-3 rounded border text-left ${Q?"border-brand-500 bg-brand-50":"border-slate-200 bg-white"}`,onClick:()=>F(z.key),children:[e.jsx("div",{className:"text-2xl",children:z.icon}),e.jsx("div",{className:"text-sm",children:z.label})]},z.key)})})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"font-semibold",children:"Terms & Notes"})}),e.jsxs("div",{className:"card-body space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Payment Terms"}),e.jsx("textarea",{className:`input ${n}`,rows:3,value:l.terms,onChange:z=>I("terms",z.target.value),placeholder:"Payment due within 14 days",readOnly:a,disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Additional Notes"}),e.jsx("textarea",{className:`input ${n}`,rows:3,value:l.notes,onChange:z=>I("notes",z.target.value),placeholder:"Any additional information",readOnly:a,disabled:a})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>t("/purchase/service-bills"),children:"Cancel"}),a?null:e.jsx("button",{type:"button",className:"btn-primary",onClick:M,children:"Save Bill"})]})]})}function uF(){const[t,s]=f.useState(""),[r,a]=f.useState([]),[n,i]=f.useState(!1),[l,o]=f.useState(""),{canPerformAction:d}=Ls();f.useEffect(()=>{let c=!0;return i(!0),o(""),Z.get("/purchase/service-confirmations").then(h=>{var m;c&&a(Array.isArray((m=h.data)==null?void 0:m.items)?h.data.items:[])}).catch(h=>{var m,p;c&&o(((p=(m=h==null?void 0:h.response)==null?void 0:m.data)==null?void 0:p.message)||"Failed to load service confirmations")}).finally(()=>{c&&i(!1)}),()=>{c=!1}},[]);const u=f.useMemo(()=>{const c=t.toLowerCase();return r.filter(h=>String(h.sc_no||"").toLowerCase().includes(c)||String(h.supplier_name||"").toLowerCase().includes(c)||String(h.status||"").toLowerCase().includes(c))},[r,t]);return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Service Confirmation"}),e.jsx("p",{className:"text-sm mt-1",children:"Confirm service receipts"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/service-management",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/service-management/service-confirmation/new",className:"btn-success",children:"+ New Confirmation"})]})]})}),e.jsxs("div",{className:"card-body",children:[l?e.jsx("div",{className:"text-sm text-red-600 mb-4",children:l}):null,e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by no, supplier, status...",className:"input max-w-md",value:t,onChange:c=>s(c.target.value)})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[n?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):null,!n&&!u.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"No confirmations found"})}):null,u.map(c=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-brand-700 dark:text-brand-300",children:c.sc_no}),e.jsx("td",{children:c.sc_date?String(c.sc_date).slice(0,10):"-"}),e.jsx("td",{children:c.supplier_name||"-"}),e.jsx("td",{children:Number(c.total_amount||0).toFixed(2)}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-info",children:c.status||"DRAFT"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[d("service-management:service-confirmations","view")&&e.jsx(Re,{to:`/service-management/service-confirmation/${c.id}?mode=view`,className:"text-brand hover:text-brand-700 text-sm font-medium",children:"View"}),d("service-management:service-confirmations","edit")&&e.jsx(Re,{to:`/service-management/service-confirmation/${c.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Edit"})]})})]},c.id))]})]})})]})]})})}function fC(t){if(!t)return"";try{return new Date(t).toISOString().slice(0,10)}catch{return""}}function yj(){const{id:t}=Ps(),{search:s}=Ur(),r=ps(),a=t==="new",n=new URLSearchParams(s).get("mode")||(a?"edit":"view"),[i,l]=f.useState(new Date),[o,d]=f.useState(!1),[u,c]=f.useState(!1),[h,m]=f.useState(""),[p,g]=f.useState([]),[x,b]=f.useState([]),[y,j]=f.useState(""),N=f.useMemo(()=>x.find(he=>String(he.id)===String(y)),[x,y]),[_,F]=f.useState({sc_no:"",sc_date:fC(new Date),supplier_id:"",status:"DRAFT",remarks:"",details:[]}),[I,w]=f.useState(""),[E,W]=f.useState(0),[R,U]=f.useState(""),[T,Y]=f.useState(""),[H,M]=f.useState(""),[q,z]=f.useState(!1),[Q,L]=f.useState(!1),[V,P]=f.useState(!1),[C,k]=f.useState(!1),[B,G]=f.useState(!1),[O,K]=f.useState(""),[J,te]=f.useState(""),[se,ae]=f.useState(!1),[ne,ue]=f.useState(!1),[oe,le]=f.useState(""),[X,me]=f.useState(""),[we,Ie]=f.useState(!1),[_e,Fe]=f.useState(""),Le=f.useMemo(()=>{const he=q&&Q&&V&&C&&B,Ue=!!O,Ye=!!y,Ke=!!_.supplier_id,Je=!!_.sc_date;return he&&Ue&&Ye&&Ke&&Je},[q,Q,V,C,B,O,y,_.supplier_id,_.sc_date]);f.useEffect(()=>{let he=!0;return Z.get("/purchase/suppliers",{params:{contractor:"Y"}}).then(Ue=>{var Je;if(!he)return;const Ke=(Array.isArray((Je=Ue.data)==null?void 0:Je.items)?Ue.data.items:[]).filter(xe=>String(xe.service_contractor||"").toUpperCase()==="Y");g(Ke)}).catch(Ue=>{var Ye,Ke;he&&m(((Ke=(Ye=Ue==null?void 0:Ue.response)==null?void 0:Ye.data)==null?void 0:Ke.message)||"Failed to load suppliers")}),Z.get("/purchase/service-orders",{params:{type:"EXTERNAL"}}).then(Ue=>{var Je;if(!he)return;const Ke=(Array.isArray((Je=Ue.data)==null?void 0:Je.items)?Ue.data.items:[]).map(xe=>({id:xe.id,order_no:xe.order_no,status:xe.status||"",assigned_supervisor_username:xe.assigned_supervisor_username||"",order_date:xe.order_date||""}));b(Ke)}).catch(()=>{he&&b([])}),()=>{he=!1}},[]),f.useEffect(()=>{const he=setInterval(()=>l(new Date),1e3);return()=>clearInterval(he)},[]),f.useEffect(()=>{if(a)return;let he=!0;return d(!0),m(""),Z.get(`/purchase/service-confirmations/${t}`).then(Ue=>{var Je,xe;if(!he)return;const Ye=(Je=Ue.data)==null?void 0:Je.item,Ke=Array.isArray((xe=Ue.data)==null?void 0:xe.details)?Ue.data.details:[];Ye&&F({sc_no:Ye.sc_no||"",sc_date:fC(Ye.sc_date),supplier_id:Ye.supplier_id?String(Ye.supplier_id):"",status:Ye.status||"DRAFT",remarks:Ye.remarks||"",details:Ke.map(ye=>({description:ye.description||"",qty:ye.qty??"",unit_price:ye.unit_price??""}))})}).catch(Ue=>{var Ye,Ke;he&&m(((Ke=(Ye=Ue==null?void 0:Ue.response)==null?void 0:Ye.data)==null?void 0:Ke.message)||"Failed to load service confirmation")}).finally(()=>{he&&d(!1)}),()=>{he=!1}},[t,a]),f.useMemo(()=>[{key:"diagnosis",name:"Diagnosis",icon:"",price:50},{key:"repair",name:"Repair",icon:"",price:150},{key:"maintenance",name:"Maintenance",icon:"",price:100},{key:"installation",name:"Installation",icon:"",price:200},{key:"consultation",name:"Consultation",icon:"",price:75},{key:"upgrade",name:"Upgrade",icon:"",price:220}],[]);const rt=f.useMemo(()=>{const he=_.details||[];let Ue=0;for(const Ye of he){const Ke=Number(Ye.qty),Je=Number(Ye.unit_price);!Number.isFinite(Ke)||!Number.isFinite(Je)||(Ue+=Ke*Je)}return Ue},[_.details]),He=f.useMemo(()=>rt*.125,[rt]),st=f.useMemo(()=>rt+He,[rt,He]);f.useMemo(()=>st*(Number(E)/100),[st,E]);function De(){window.print()}function Te(){alert("Downloading confirmation PDF (demo)")}async function Ce(){try{await navigator.clipboard.writeText(window.location.href),alert("Link copied to clipboard")}catch{alert("Unable to copy link")}}const Pe=async he=>{var Ue,Ye;he&&typeof he.preventDefault=="function"&&he.preventDefault(),c(!0),m("");try{if(!y)throw new Error("Select completed external service order");if(!(q&&Q&&V&&C&&B))throw new Error("Check all acceptance items");if(!O)throw new Error("Select satisfaction rating");const Ke={sc_no:_.sc_no||`SC-${String(Math.floor(Math.random()*1e6)).padStart(6,"0")}`,sc_date:_.sc_date,supplier_id:_.supplier_id?Number(_.supplier_id):null,status:"CONFIRMED",remarks:(_.remarks||"")+(X?`
Notes: ${X}`:"")+(se?`
Warranty provided`:"")+(ne&&oe?`
Follow-up: ${oe}`:""),details:(_.details||[]).map(Je=>({description:String(Je.description||"").trim(),qty:Je.qty===""?null:Number(Je.qty),unit_price:Je.unit_price===""?null:Number(Je.unit_price)})),satisfaction:Number(O),customer_feedback:J||null};if(!Ke.sc_date||!Ke.supplier_id)throw new Error("Date and supplier are required");a?await Z.post("/purchase/service-confirmations",Ke):await Z.put(`/purchase/service-confirmations/${t}`,Ke),r("/purchase/service-confirmation")}catch(Ke){m(((Ye=(Ue=Ke==null?void 0:Ke.response)==null?void 0:Ue.data)==null?void 0:Ye.message)||(Ke==null?void 0:Ke.message)||"Failed to save service confirmation")}finally{c(!1)}},fe=f.useMemo(()=>{const he=_.supplier_id?Number(_.supplier_id):null;if(!he)return"";const Ue=p.find(Ye=>Number(Ye.id)===he);return Ue&&Ue.supplier_name||""},[_.supplier_id,p]);return n==="view"&&!a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx("div",{className:"bg-green-100 rounded-full p-3",children:e.jsx("span",{className:"text-3xl",children:""})})}),e.jsx("div",{className:"text-2xl font-bold",style:{color:"#0E3646"},children:"Service Confirmation"}),e.jsx("div",{className:"text-sm mt-1",children:"Confirmation saved successfully"})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-4 border-l-4",style:{borderLeftColor:"#0E3646"},children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Confirmation Number"}),e.jsx("div",{className:"text-xl font-bold",style:{color:"#0E3646"},children:_.sc_no||"-"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",className:"flex items-center gap-2 px-3 py-2 border-2 border-slate-200 rounded-lg hover:bg-slate-50 transition-colors",onClick:De,children:[" ",e.jsx("span",{className:"text-sm font-medium",children:"Print"})]}),e.jsxs("button",{type:"button",className:"flex items-center gap-2 px-3 py-2 border-2 border-slate-200 rounded-lg hover:bg-slate-50 transition-colors",onClick:Te,children:[" ",e.jsx("span",{className:"text-sm font-medium",children:"Download"})]}),e.jsxs("button",{type:"button",className:"flex items-center gap-2 px-3 py-2 border-2 border-slate-200 rounded-lg hover:bg-slate-50 transition-colors",onClick:Ce,children:[" ",e.jsx("span",{className:"text-sm font-medium",children:"Share"})]})]})]})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-semibold",children:"Status"}),e.jsx("span",{className:"badge badge-info",children:_.status||"DRAFT"})]})}),e.jsxs("div",{className:"card-body grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Supplier"}),e.jsx("div",{className:"font-semibold",children:fe||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Appointment"}),e.jsx("div",{className:"font-semibold",children:_.sc_date||"-"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Remarks"}),e.jsx("div",{className:"font-semibold",children:_.remarks||"-"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"font-semibold",children:"Selected Services"})}),e.jsx("div",{className:"card-body",children:_.details.length?e.jsx("div",{className:"space-y-2",children:_.details.map((he,Ue)=>{const Ye=Math.max(1,Number(he.qty||1)),Ke=Number(he.unit_price||0),Je=Ye*Ke;return e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-medium text-brand-700",children:he.description}),e.jsx("div",{className:"font-semibold",children:`GH ${Je.toFixed(2)}`})]}),e.jsx("div",{className:"text-xs text-slate-600",children:`GH ${Ke.toFixed(2)}  ${Ye}`})]},Ue)})}):e.jsxs("div",{className:"text-center text-slate-600 p-6",children:[e.jsx("div",{className:"text-3xl",children:""}),e.jsx("div",{className:"text-sm mt-2",children:"No services selected"})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"font-semibold",children:"Totals"})}),e.jsxs("div",{className:"card-body space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Services Subtotal"}),e.jsx("div",{children:`GH ${rt.toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Tax (12.5%)"}),e.jsx("div",{children:`GH ${He.toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2 font-bold",children:[e.jsx("div",{children:"Total"}),e.jsx("div",{children:`GH ${st.toFixed(2)}`})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/purchase/service-confirmation",className:"btn-secondary",children:"Back to List"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>r(`/purchase/service-confirmation/${t}?mode=edit`),children:"Edit Confirmation"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Re,{to:"/purchase/service-confirmation",className:"px-3 py-1 rounded bg-white text-brand hover:bg-slate-100",children:" Back"}),e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:a?"New Service Confirmation":"Edit Service Confirmation"}),e.jsx("p",{className:"text-sm mt-1",children:"Confirm service receipts"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm",children:i.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("div",{className:"text-sm font-semibold",children:i.toLocaleTimeString()})]})]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Service Order Reference"}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Completed Service Order *"}),e.jsxs("select",{className:"input",value:y,onChange:he=>j(he.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select external service order..."}),x.map(he=>e.jsx("option",{value:String(he.id),children:he.order_no||""},he.id))]})]}),N?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 bg-blue-50 border border-blue-200 rounded p-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Order"}),e.jsx("div",{className:"font-semibold",children:N.order_no||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Status"}),e.jsx("div",{className:"font-semibold",children:N.status||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Supervisor"}),e.jsx("div",{className:"font-semibold",children:N.assigned_supervisor_username||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Date"}),e.jsx("div",{className:"font-semibold",children:N.order_date||"-"})]})]}):null]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Date *"}),e.jsx("input",{type:"date",className:"input",value:_.sc_date,onChange:he=>F({..._,sc_date:he.target.value}),required:!0})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Supplier *"}),e.jsxs("select",{className:"input",value:_.supplier_id,onChange:he=>F({..._,supplier_id:he.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select supplier..."}),p.map(he=>e.jsx("option",{value:String(he.id),children:(he.supplier_code?`${he.supplier_code} - `:"")+he.supplier_name},he.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Time"}),e.jsx("input",{type:"time",className:"input",value:I,onChange:he=>w(he.target.value)})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Service Acceptance"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:q,onChange:he=>z(he.target.checked)}),e.jsx("span",{children:"All services listed were completed as specified"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:Q,onChange:he=>L(he.target.checked)}),e.jsx("span",{children:"Work quality meets agreed standards"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:V,onChange:he=>P(he.target.checked)}),e.jsx("span",{children:"Materials used were as specified or approved"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:he=>k(he.target.checked)}),e.jsx("span",{children:"Service location was left clean and tidy"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:B,onChange:he=>G(he.target.checked)}),e.jsx("span",{children:"All documentation, warranties, and instructions received"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Overall Satisfaction *"}),e.jsx("div",{className:"flex flex-wrap gap-3 mt-1",children:[5,4,3,2,1].map(he=>e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"radio",name:"satisfaction",value:String(he),checked:O===String(he),onChange:Ue=>K(Ue.target.value)}),Array.from({length:he}).map(()=>"").join("")]},he))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Customer Feedback"," ",e.jsx("span",{className:"text-slate-500",children:"(Optional)"})]}),e.jsx("textarea",{className:"input",value:J,onChange:he=>te(he.target.value)})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-3",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Additional Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Remarks"}),e.jsx("textarea",{className:"input",rows:"3",value:_.remarks,onChange:he=>F({..._,remarks:he.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:se,onChange:he=>ae(he.target.checked)}),e.jsx("span",{children:"Warranty documentation provided"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:ne,onChange:he=>ue(he.target.checked)}),e.jsx("span",{children:"Follow-up visit required"})]})]}),ne?e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Follow-up Details"}),e.jsx("textarea",{className:"input",value:oe,onChange:he=>le(he.target.value)})]}):null,e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Additional Notes"," ",e.jsx("span",{className:"text-slate-500",children:"(Optional)"})]}),e.jsx("textarea",{className:"input",value:X,onChange:he=>me(he.target.value)})]})]})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"font-semibold",children:"Confirmation Summary"})}),e.jsxs("div",{className:"card-body space-y-2",children:[e.jsxs("div",{className:"flex justify-between py-1 border-b border-slate-200",children:[e.jsx("div",{className:"text-sm",children:"Supplier"}),e.jsx("div",{className:"text-sm font-semibold",children:fe||"-"})]}),e.jsxs("div",{className:"flex justify-between py-1 border-b border-slate-200",children:[e.jsx("div",{className:"text-sm",children:"Appointment"}),e.jsx("div",{className:"text-sm font-semibold",children:(_.sc_date||"")+(I?` ${I}`:"")})]}),e.jsxs("div",{className:"flex justify-between py-1",children:[e.jsx("div",{className:"text-sm",children:"Location"}),e.jsx("div",{className:"text-sm font-semibold",children:"In Shop"})]}),e.jsxs("div",{className:"flex justify-between py-1 border-t pt-2",children:[e.jsx("div",{className:"text-sm",children:"Total"}),e.jsx("div",{className:"text-sm font-semibold",children:`GH ${rt.toFixed(2)}`})]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"inline-block px-3 py-1 rounded-full text-xs font-semibold "+(Le?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"),children:Le?"Ready to Confirm":"Pending Confirmation"})})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(Re,{to:"/service-management/service-confirmation",className:"btn-secondary",children:"Cancel"}),e.jsx("button",{type:"button",className:"btn-danger px-4 py-2",onClick:()=>{Fe(""),Ie(!0)},children:"Reject Service"}),e.jsx("button",{type:"button",className:"btn-success",onClick:Pe,disabled:u||!Le,children:"Confirm Service Completion"})]}),h?e.jsx("div",{className:"text-sm text-red-600 mt-3",children:h}):null]})]}),we?e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card w-full max-w-lg",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"font-semibold",children:"Service Rejection"})}),e.jsxs("div",{className:"card-body space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Reason for Rejection *"}),e.jsx("textarea",{className:"input",rows:"4",value:_e,onChange:he=>Fe(he.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>Ie(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"btn-danger",onClick:()=>{if(!_e.trim()){alert("Please provide a reason for rejection.");return}alert("Service rejection has been recorded."),Ie(!1)},children:"Submit Rejection"})]})]})]})}):null]})}function Xb(){var se;const t=ps(),s=Ur(),r=Ps(),a=r!=null&&r.id?Number(r.id):null,n=((se=s==null?void 0:s.pathname)==null?void 0:se.endsWith(`/direct-purchase/${(r==null?void 0:r.id)||""}`))&&String(new URLSearchParams(s.search).get("mode")||"")==="view",[i,l]=f.useState([]),[o,d]=f.useState([]),[u,c]=f.useState([]),[h,m]=f.useState([]),[p,g]=f.useState(null),[x,b]=f.useState([]),[y,j]=f.useState([]),[N,_]=f.useState([]),{uoms:F}=$i(),I=f.useMemo(()=>{const ae=Array.isArray(F)?F:[],ne=ae.find(ue=>String(ue.uom_code||"").toUpperCase()==="PCS")||ae[0];return ne&&ne.uom_code?ne.uom_code:"PCS"},[F]),[w,E]=f.useState({supplier_id:"",purchase_date:new Date().toISOString().slice(0,10),warehouse_id:"",currency_id:"",exchange_rate:1,payment_terms:30,remarks:""}),[W,R]=f.useState([{item_id:"",qty:"",unit_price:"",discount_percent:"",tax_percent:"",uom:"PCS",line_total:0}]),[U,T]=f.useState(!1),[Y,H]=f.useState(""),[M,q]=f.useState(""),[z,Q]=f.useState({open:!1,itemId:null,defaultUom:"",currentUom:"",rowIdx:null});f.useEffect(()=>{let ae=!1;async function ne(){if(a)try{const ue=await Z.get(`/purchase/direct-purchases/${a}`),oe=(ue==null?void 0:ue.data)||null;if(!oe||ae)return;E({supplier_id:oe.supplier_id||"",purchase_date:String(oe.dp_date||"").slice(0,10),warehouse_id:oe.warehouse_id||"",currency_id:oe.currency_id||"",exchange_rate:Number(oe.exchange_rate||1),payment_terms:oe.payment_terms||30,remarks:oe.remarks||""});const le=Array.isArray(oe.details)?oe.details:[];R(le.length?le.map(X=>({item_id:X.item_id,qty:X.qty,unit_price:X.unit_price,discount_percent:X.discount_percent,tax_percent:X.tax_percent,uom:X.uom||"PCS",line_total:X.line_total})):[{item_id:"",qty:"",unit_price:"",discount_percent:"",tax_percent:"",uom:"PCS",line_total:0}])}catch{}}return ne(),()=>{ae=!0}},[a]),f.useEffect(()=>{let ae=!0;async function ne(){var ue;try{const[oe,le,X,me,we,Ie,_e]=await Promise.all([Z.get("/purchase/suppliers").then(Fe=>Fe.data.items||[]),Z.get("/inventory/warehouses").then(Fe=>Fe.data.items||[]),Z.get("/inventory/items").then(Fe=>Fe.data.items||[]),Z.get("/finance/currencies").then(Fe=>Fe.data.items||[]),Z.get("/sales/prices/standard").catch(()=>({data:{items:[]}})).then(Fe=>Fe.data.items||[]),Z.get("/inventory/unit-conversions").catch(()=>({data:{items:[]}})).then(Fe=>Fe.data.items||[]),Z.get("/finance/tax-codes").catch(()=>({data:{items:[]}})).then(Fe=>Fe.data.items||[])]);if(ae){l(oe),d(le),c(X),m(me),b(Array.isArray(we)?we:[]),j(Array.isArray(Ie)?Ie:[]);const Fe=(Array.isArray(_e)?_e:[]).map(rt=>({value:rt.id,label:rt.name,rate:Number(rt.rate_percent)}));_(Fe);const Le=((ue=(me||[]).find(rt=>Number(rt.is_base)===1))==null?void 0:ue.id)||null;g(Le),!w.currency_id&&Le&&E(rt=>({...rt,currency_id:Le}))}}catch{}}return ne(),()=>{ae=!1}},[]),f.useEffect(()=>{let ae=!1;async function ne(){var le;const ue=Number(w.currency_id||0)||null,oe=Number(p||0)||null;if(!(!ue||!oe))try{const X=await Z.get("/finance/currency-rates",{params:{fromCurrencyId:ue,toCurrencyId:oe}}),we=(Array.isArray((le=X==null?void 0:X.data)==null?void 0:le.items)?X.data.items:[])[0]||null,Ie=we?Number(we.rate||1):1;ae||E(_e=>({..._e,exchange_rate:Ie||1}))}catch{}}return ne(),()=>{ae=!0}},[w.currency_id,p]);const L=f.useMemo(()=>{let ae=0,ne=0,ue=0;for(const le of W){const X=Number(le.qty||0),me=Number(le.unit_price||0),we=Number(le.discount_percent||0),Ie=Number(le.tax_percent||0),_e=X*me,Fe=_e*(we/100),rt=Math.max(0,_e-Fe)*(Ie/100);ae+=_e,ne+=Fe,ue+=rt}const oe=ae-ne+ue;return{subtotal:ae,totalDiscount:ne,totalTax:ue,grandTotal:oe}},[W]);function V(ae,ne){E(ue=>({...ue,[ae]:ne}))}function P(ae){const ne=ae?Number(ae):null,ue=i.find(X=>Number(X.id)===ne)||null,oe=(ue==null?void 0:ue.currency_id)??p??"",le=(ue==null?void 0:ue.payment_terms)??30;E(X=>({...X,supplier_id:ae,currency_id:oe||"",payment_terms:Number(le||30)}))}function C(ae){const ne=Number(ae.qty||0),ue=Number(ae.unit_price||0),oe=Number(ae.discount_percent||0),le=Number(ae.tax_percent||0),X=ne*ue,me=X*(oe/100),we=X-me,Ie=we*(le/100);return{...ae,line_total:we+Ie}}function k(ae,ne,ue){R(oe=>{const le=[...oe];return le[ae]=C({...le[ae],[ne]:ue}),le})}function B(ae,ne){var X;const ue=u.find(me=>Number(me.id)===Number(ne)),oe=(ue==null?void 0:ue.uom)||I;let le=ue&&Number(ue.cost_price)?Number(ue.cost_price):Number(((X=W[ae])==null?void 0:X.unit_price)||0);if(Array.isArray(x)&&x.length){const me=x.filter(we=>String(we.product_id)===String(ne)).sort((we,Ie)=>{const _e=we.effective_date?new Date(we.effective_date).getTime():0;return(Ie.effective_date?new Date(Ie.effective_date).getTime():0)-_e||new Date(Ie.created_at).getTime()-new Date(we.created_at).getTime()});me.length>0&&(le=Number(me[0].cost_price)||le)}R(me=>{const we=[...me];return we[ae]=C({...we[ae],item_id:ne,uom:String(oe||"PCS"),unit_price:le}),we})}function G(){R(ae=>[...ae,{item_id:"",qty:"",unit_price:"",discount_percent:"",tax_percent:"",uom:"PCS",line_total:0}])}function O(ae){R(ne=>ne.filter((ue,oe)=>oe!==ae))}function K(ae,ne){if(n)return;const ue=u.find(Ie=>Number(Ie.id)===Number(ne.item_id)),oe=(ue==null?void 0:ue.uom)&&String(ue.uom)||String(ne.uom||"")||String(I||""),le=(Array.isArray(y)?y:[]).filter(Ie=>Number(Ie.is_active)&&Number(Ie.item_id)===Number(ne.item_id)&&String(Ie.to_uom)===oe).map(Ie=>String(Ie.from_uom)),X=String(ne.uom||""),me=X&&X!==oe?X:le[0]||"";le.length>0&&me&&me!==oe&&Q({open:!0,itemId:ne.item_id,defaultUom:oe,currentUom:me,rowIdx:ae})}function J({item_id:ae,to_uom:ne,converted_qty:ue}){R(oe=>{const le=[...oe],X=z.rowIdx;return X!=null&&le[X]&&(le[X]=C({...le[X],qty:ue,uom:ne})),le})}async function te(ae){var ne,ue;T(!0),H(""),q("");try{const oe={supplier_id:Number(w.supplier_id),purchase_date:w.purchase_date,warehouse_id:Number(w.warehouse_id),currency_id:w.currency_id?Number(w.currency_id):null,exchange_rate:Number(w.exchange_rate||1),payment_terms:w.payment_terms?Number(w.payment_terms):null,remarks:w.remarks||null,status:ae==="post"?"POST":"DRAFT",details:W.filter(we=>Number(we.item_id)&&Number(we.qty)).map(we=>({item_id:Number(we.item_id),qty:Number(we.qty),unit_price:Number(we.unit_price||0),discount_percent:Number(we.discount_percent||0),tax_percent:Number(we.tax_percent||0),uom:String(we.uom||"PCS")}))};if(!oe.details.length){H("Add at least one item with quantity"),T(!1);return}const le=a?await Z.put(`/purchase/direct-purchases/${a}`,oe):await Z.post("/purchase/direct-purchases",oe),me=`Direct Purchase ${((le==null?void 0:le.data)||{}).dp_no||""} saved`;q(me),t("/purchase/direct-purchase",{state:{success:me}})}catch(oe){H(String(((ue=(ne=oe==null?void 0:oe.response)==null?void 0:ne.data)==null?void 0:ue.message)||oe.message||"Error"))}finally{T(!1)}}return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"rounded-lg border border-[#dee2e6] bg-white shadow-erp",children:[e.jsxs("div",{className:"px-6 py-4 border-b bg-brand text-white rounded-t-lg",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Direct Purchase"}),e.jsx("p",{className:"text-sm mt-1 opacity-90",children:"Complete a full purchase in one step"})]}),e.jsxs("div",{className:"px-6 py-5 space-y-4",children:[Y?e.jsx("div",{className:"alert alert-error",children:Y}):null,M?e.jsx("div",{className:"alert alert-success",children:M}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"label",children:"Supplier"}),e.jsxs("select",{className:"input",value:w.supplier_id,onChange:ae=>P(ae.target.value),disabled:n,children:[e.jsx("option",{value:"",children:"Select supplier"}),i.map(ae=>e.jsx("option",{value:ae.id,children:ae.supplier_name},ae.id))]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"label",children:"Purchase Date"}),e.jsx("input",{type:"date",className:"input",value:w.purchase_date,onChange:ae=>V("purchase_date",ae.target.value),disabled:n})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"label",children:"Warehouse"}),e.jsxs("select",{className:"input",value:w.warehouse_id,onChange:ae=>V("warehouse_id",ae.target.value),disabled:n,children:[e.jsx("option",{value:"",children:"Select warehouse"}),o.map(ae=>e.jsx("option",{value:ae.id,children:ae.warehouse_name},ae.id))]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsxs("select",{className:"input",value:w.currency_id,onChange:ae=>V("currency_id",ae.target.value),disabled:n,children:[e.jsx("option",{value:"",children:"Select currency"}),h.map(ae=>e.jsxs("option",{value:ae.id,children:[ae.code," ",ae.is_base?"(Base)":""]},ae.id))]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"label",children:"Exchange Rate"}),e.jsx("input",{type:"number",className:"input",value:w.exchange_rate,onChange:ae=>V("exchange_rate",ae.target.value),disabled:n})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"label",children:"Payment Terms"}),e.jsx("input",{type:"number",className:"input",value:w.payment_terms,onChange:ae=>V("payment_terms",ae.target.value),disabled:n})]}),e.jsxs("div",{className:"md:col-span-3 flex flex-col gap-1",children:[e.jsx("label",{className:"label",children:"Remarks"}),e.jsx("textarea",{className:"input",rows:"3",value:w.remarks,onChange:ae=>V("remarks",ae.target.value),disabled:n})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"overflow-x-auto rounded border border-[#dee2e6]",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:240},children:"Item"}),e.jsx("th",{style:{width:100},children:"Qty"}),e.jsx("th",{style:{width:120},children:"UOM"}),e.jsx("th",{style:{width:140},children:"Unit Price"}),e.jsx("th",{style:{width:120},children:"Discount %"}),e.jsx("th",{style:{width:140},children:"Tax Code"}),e.jsx("th",{style:{width:140},className:"text-right",children:"Line Total"}),e.jsx("th",{style:{width:80}})]})}),e.jsx("tbody",{children:W.map((ae,ne)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("select",{className:"input",value:ae.item_id,onChange:ue=>B(ne,ue.target.value),disabled:n,children:[e.jsx("option",{value:"",children:"Select item"}),u.map(ue=>e.jsxs("option",{value:ue.id,children:[ue.item_code," - ",ue.item_name]},ue.id))]})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"input",value:ae.qty,onChange:ue=>k(ne,"qty",ue.target.value),disabled:n})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{className:"input",value:ae.uom||I,onChange:ue=>k(ne,"uom",ue.target.value),disabled:n,children:[e.jsx("option",{value:"",children:"Select UOM"}),(Array.isArray(F)?F:[]).map(ue=>e.jsx("option",{value:ue.uom_code,children:ue.uom_name?`${ue.uom_name} (${ue.uom_code})`:ue.uom_code},ue.id))]}),(()=>{const ue=u.find(Ie=>String(Ie.id)===String(ae.item_id)),oe=(ue==null?void 0:ue.uom)&&String(ue.uom)||ae.uom&&String(ae.uom)||(I?String(I):""),le=(Array.isArray(y)?y:[]).filter(Ie=>Number(Ie.is_active)&&Number(Ie.item_id)===Number(ae.item_id)&&String(Ie.to_uom)===oe).map(Ie=>String(Ie.from_uom)),X=String(ae.uom||""),me=X&&X!==oe?X:le[0]||"";return le.length>0&&me&&me!==oe?e.jsxs("button",{type:"button",className:"btn-outline text-xs",onClick:()=>K(ne,ae),children:["Verify qty in ",me]}):null})()]})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"input",value:ae.unit_price,onChange:ue=>k(ne,"unit_price",ue.target.value),disabled:n})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"input",value:ae.discount_percent,onChange:ue=>k(ne,"discount_percent",ue.target.value),disabled:n})}),e.jsx("td",{children:e.jsxs("select",{className:"input",value:(()=>{const ue=N.find(oe=>Number(oe.rate)===Number(ae.tax_percent||0));return ue?ue.value:""})(),onChange:ue=>{const oe=ue.target.value,le=N.find(me=>String(me.value)===String(oe)),X=le?le.rate:0;k(ne,"tax_percent",X)},disabled:n,children:[e.jsx("option",{value:"",children:"No Tax"}),N.map(ue=>e.jsx("option",{value:ue.value,children:ue.label},ue.value))]})}),e.jsx("td",{className:"text-right font-medium",children:Number(ae.line_total||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{children:n?null:e.jsx("button",{className:"btn btn-danger",onClick:()=>O(ne),children:"Remove"})})]},ne))})]})}),n?null:e.jsx("div",{className:"mt-3",children:e.jsx("button",{className:"btn btn-outline",onClick:G,children:"Add Line"})})]}),e.jsxs("div",{className:"bg-[#f8f9fa] p-5 rounded-lg mt-5 border border-[#dee2e6]",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b border-[#dee2e6]",children:[e.jsx("span",{className:"text-sm font-medium",children:"Sub Total:"}),e.jsx("span",{className:"font-bold",children:Number(L.subtotal||0).toLocaleString(void 0,{minimumFractionDigits:2})})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-[#dee2e6] text-[#dc3545]",children:[e.jsx("span",{className:"text-sm font-medium",children:"Discount:"}),e.jsxs("span",{className:"font-bold",children:["-",Number(L.totalDiscount||0).toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-[#dee2e6] text-[#0E3646]",children:[e.jsx("span",{className:"text-sm font-medium",children:"Tax Amount:"}),e.jsx("span",{className:"font-bold",children:Number(L.totalTax||0).toLocaleString(void 0,{minimumFractionDigits:2})})]}),e.jsxs("div",{className:"flex justify-between py-3 text-lg font-bold text-[#0E3646]",children:[e.jsx("span",{children:"GRAND TOTAL:"}),e.jsx("span",{children:Number(L.grandTotal||0).toLocaleString(void 0,{minimumFractionDigits:2})})]})]}),n?null:e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx("button",{className:"btn btn-outline",disabled:U,onClick:()=>te("draft"),children:"Save Draft"}),e.jsx("button",{className:"btn btn-primary",disabled:U,onClick:()=>te("post"),children:"Save & Post"}),e.jsx("button",{className:"btn",onClick:()=>t("/purchase/direct-purchase"),children:"Back"})]})]})]}),e.jsx(Ic,{open:z.open,onClose:()=>Q(ae=>({...ae,open:!1})),itemId:z.itemId,defaultUom:z.defaultUom,currentUom:z.currentUom,conversions:y,onApply:J})]})}function ite(){const t=ps(),s=Ur(),{canAccessPath:r}=Ls(),[a,n]=f.useState([]),[i,l]=f.useState(!0),[o,d]=f.useState(""),[u,c]=f.useState("");f.useEffect(()=>{let m=!0;async function p(){var g,x,b;l(!0),d("");try{const y=await Z.get("/purchase/direct-purchases"),j=Array.isArray((g=y==null?void 0:y.data)==null?void 0:g.items)?y.data.items:Array.isArray(y==null?void 0:y.data)?y.data:[];m&&n(j)}catch(y){m&&d(((b=(x=y==null?void 0:y.response)==null?void 0:x.data)==null?void 0:b.message)||"Failed to load")}finally{m&&l(!1)}}return p(),()=>{m=!1}},[]),f.useEffect(()=>{var p;const m=(p=s==null?void 0:s.state)==null?void 0:p.success;m&&(c(String(m)),window.history.replaceState({},document.title,s.pathname))},[s==null?void 0:s.state]);function h(m){return`GHS ${Number(m||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}return e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/purchase",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Purchase"}),e.jsx("h1",{className:"text-2xl font-bold mt-2",children:"Direct Purchases"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Single-step purchases created from the Direct Purchase form"})]}),e.jsx("div",{className:"flex gap-2",children:r("/purchase/direct-purchase/new")&&e.jsx("button",{className:"btn btn-primary",onClick:()=>t("/purchase/direct-purchase/new"),children:"Create Direct Purchase"})})]}),u&&e.jsx("div",{className:"alert alert-success",children:u}),o&&e.jsx("div",{className:"alert alert-error",children:o}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:i?e.jsx("div",{children:"Loading..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{className:"text-right",children:"Amount"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[a.map((m,p)=>e.jsxs("tr",{children:[e.jsx("td",{children:m.dp_no||m.document_no||m.id}),e.jsx("td",{children:String(m.purchase_date||m.date||"").slice(0,10)}),e.jsx("td",{children:m.supplier_name||m.supplier||m.supplier_id}),e.jsx("td",{className:"text-right",children:h(m.grand_total??m.total_amount??m.amount??0)}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"btn-outline text-xs",onClick:()=>t(`/purchase/direct-purchase/${m.id}?mode=view`),children:"View"}),e.jsx("button",{type:"button",className:"btn-ghost text-xs",onClick:()=>t(`/purchase/direct-purchase/${m.id}/edit`),children:"Edit"})]})})]},m.id||p)),a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center text-slate-500",children:"No records found"})})]})]})})})})]})}function Mx({title:t,description:s}){return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg",children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:t}),s?e.jsx("p",{className:"text-sm mt-1",children:s}):null]}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"text-sm",children:"This page is ready to be implemented."})})]})}function lte(){const{token:t}=Kr(),[s,r]=f.useState(null),[a,n]=f.useState(!1);f.useEffect(()=>{let d=!1;return n(!0),Z.get("/purchase/analytics/overview").then(u=>{d||r(u.data||null)}).catch(()=>{d||r(null)}).finally(()=>{d||n(!1)}),()=>{d=!0}},[t]);const i=d=>`GH${Number(d||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`,l=[{rbac_key:"total-purchases",icon:"",value:a?"...":i((s==null?void 0:s.totalPurchases)||0),label:"Total Purchases",change:a?"":`${Number((s==null?void 0:s.totalPurchaseOrders)||0)} orders`,path:"/purchase/reports"},{rbac_key:"active-purchase-orders",icon:"",value:a?"...":String((s==null?void 0:s.activePurchaseOrders)??0),label:"Active Purchase Orders",path:"/purchase/purchase-orders-local"},{rbac_key:"active-suppliers",icon:"",value:a?"...":String((s==null?void 0:s.activeSuppliers)??0),label:"Active Suppliers",path:"/purchase/suppliers"},{rbac_key:"pending-approvals",icon:"",value:a?"...":String((s==null?void 0:s.pendingApprovals)??0),label:"Pending Approvals",path:"/administration/workflows/approvals"},{rbac_key:"outstanding-payables",icon:"",value:a?"...":i((s==null?void 0:s.outstandingPayables)||0),label:"Outstanding Payables",path:"/purchase/purchase-bills-local"}],o=[{title:"Quick Purchase",items:[{title:"Direct Purchase",description:"Create quick single-step purchases",path:"/purchase/direct-purchase",icon:""}]},{title:"Procurement",items:[{title:"Request for Quotation",description:"Create and manage RFQs",path:"/purchase/rfqs",icon:""},{title:"Supplier Quotations",description:"Capture and compare supplier quotations",path:"/purchase/supplier-quotations",icon:""},{title:"Quotation Analysis",description:"Analyze quotation options and decisions",path:"/purchase/quotation-analysis",icon:""}]},{title:"Purchase Orders",items:[{title:"Local Purchase Orders",description:"Manage local POs",path:"/purchase/purchase-orders-local",icon:""},{title:"Import Purchase Orders",description:"Manage import POs",path:"/purchase/purchase-orders-import",icon:""}]},{title:"Logistics",items:[{title:"Shipping Advice",description:"Manage shipping advice documents",path:"/purchase/shipping-advice",icon:""},{title:"Port Clearances",description:"Track port clearance records",path:"/purchase/port-clearances",icon:""}]},{title:"Billing",items:[{title:"Local Purchase Bills",description:"Create and manage local purchase bills",path:"/purchase/purchase-bills-local",icon:""},{title:"Import Purchase Bills",description:"Create and manage import purchase bills",path:"/purchase/purchase-bills-import",icon:""}]},{title:"Master Data",items:[{title:"Suppliers",description:"Manage suppliers and contacts",path:"/purchase/suppliers",icon:""}]},{title:"Reports",items:[{title:"Purchase Reports",description:"View purchase analytics and reports",path:"/purchase/reports",icon:"",module_key:"purchase",feature_key:"reports"}]},{title:"Dashboards",items:[{title:"Procurement Overview",description:"Key procurement KPIs and summaries",path:"/purchase/procurement-overview",icon:"",module_key:"purchase",feature_key:"procurement-overview"},{title:"Supplier Analytics",description:"Supplier performance and trend analysis",path:"/purchase/supplier-analytics",icon:"",module_key:"purchase",feature_key:"supplier-analytics"}]}];return e.jsx(lo,{title:" Purchase",description:"Purchase management and procurement workflows",stats:l,sections:o,features:cte})}function ote(){return e.jsxs(hl,{children:[e.jsx(tt,{index:!0,element:e.jsx(lte,{})}),e.jsx(tt,{path:"rfqs",element:e.jsx(Wee,{})}),e.jsx(tt,{path:"rfqs/new",element:e.jsx(Wb,{})}),e.jsx(tt,{path:"rfqs/:id",element:e.jsx(Wb,{})}),e.jsx(tt,{path:"rfqs/:id/edit",element:e.jsx(Wb,{})}),e.jsx(tt,{path:"supplier-quotations",element:e.jsx(Gee,{})}),e.jsx(tt,{path:"supplier-quotations/new",element:e.jsx(Gb,{})}),e.jsx(tt,{path:"supplier-quotations/:id",element:e.jsx(Gb,{})}),e.jsx(tt,{path:"supplier-quotations/:id/edit",element:e.jsx(Gb,{})}),e.jsx(tt,{path:"quotation-analysis",element:e.jsx(Kee,{})}),e.jsx(tt,{path:"purchase-orders-local",element:e.jsx(zee,{})}),e.jsx(tt,{path:"purchase-orders-local/new",element:e.jsx(Kb,{})}),e.jsx(tt,{path:"purchase-orders-local/:id",element:e.jsx(Kb,{})}),e.jsx(tt,{path:"purchase-orders-local/:id/edit",element:e.jsx(Kb,{})}),e.jsx(tt,{path:"purchase-orders-import",element:e.jsx(Yee,{})}),e.jsx(tt,{path:"purchase-orders-import/new",element:e.jsx(zb,{})}),e.jsx(tt,{path:"purchase-orders-import/:id",element:e.jsx(zb,{})}),e.jsx(tt,{path:"purchase-orders-import/:id/edit",element:e.jsx(zb,{})}),e.jsx(tt,{path:"shipping-advice",element:e.jsx(Xee,{})}),e.jsx(tt,{path:"shipping-advice/new",element:e.jsx(uC,{})}),e.jsx(tt,{path:"shipping-advice/:id",element:e.jsx(uC,{})}),e.jsx(tt,{path:"port-clearances",element:e.jsx(Jee,{})}),e.jsx(tt,{path:"port-clearances/new",element:e.jsx(mC,{})}),e.jsx(tt,{path:"port-clearances/:id",element:e.jsx(mC,{})}),e.jsx(tt,{path:"purchase-bills-local",element:e.jsx(hC,{})}),e.jsx(tt,{path:"purchase-bills-local/new",element:e.jsx(Ox,{})}),e.jsx(tt,{path:"purchase-bills-local/:id",element:e.jsx(Ox,{})}),e.jsx(tt,{path:"purchase-bills-import",element:e.jsx(hC,{})}),e.jsx(tt,{path:"purchase-bills-import/new",element:e.jsx(Ox,{})}),e.jsx(tt,{path:"purchase-bills-import/:id",element:e.jsx(Ox,{})}),e.jsx(tt,{path:"direct-purchase",element:e.jsx(ite,{})}),e.jsx(tt,{path:"direct-purchase/new",element:e.jsx(Xb,{})}),e.jsx(tt,{path:"direct-purchase/:id",element:e.jsx(Xb,{})}),e.jsx(tt,{path:"direct-purchase/:id/edit",element:e.jsx(Xb,{})}),e.jsx(tt,{path:"direct-purchases",element:e.jsx(dd,{to:"/purchase/direct-purchase",replace:!0})}),e.jsx(tt,{path:"service-bills",element:e.jsx(dF,{})}),e.jsx(tt,{path:"service-bills/new",element:e.jsx(Yb,{})}),e.jsx(tt,{path:"service-bills/:id",element:e.jsx(Yb,{})}),e.jsx(tt,{path:"service-bills/:id/edit",element:e.jsx(Yb,{})}),e.jsx(tt,{path:"service-confirmation",element:e.jsx(uF,{})}),e.jsx(tt,{path:"service-confirmation/new",element:e.jsx(yj,{})}),e.jsx(tt,{path:"service-confirmation/:id",element:e.jsx(yj,{})}),e.jsx(tt,{path:"suppliers",element:e.jsx(Zee,{})}),e.jsx(tt,{path:"suppliers/new",element:e.jsx(AC,{})}),e.jsx(tt,{path:"suppliers/:id",element:e.jsx(AC,{})}),e.jsx(tt,{path:"suppliers/mass-upload",element:e.jsx(Mx,{title:"Mass Suppliers Upload",description:"Import suppliers in bulk from file"})}),e.jsx(tt,{path:"reports",element:e.jsx(Mx,{title:"Purchase Reports",description:"View purchase analytics and reports"})}),e.jsx(tt,{path:"reports/import-order-tracking",element:e.jsx(ete,{})}),e.jsx(tt,{path:"reports/local-order-tracking",element:e.jsx(tte,{})}),e.jsx(tt,{path:"reports/purchase-tracking",element:e.jsx(ste,{})}),e.jsx(tt,{path:"procurement-overview",element:e.jsx(Mx,{title:"Procurement Overview",description:"Procurement overview dashboard"})}),e.jsx(tt,{path:"supplier-analytics",element:e.jsx(Mx,{title:"Supplier Analytics",description:"Supplier analytics dashboard"})}),e.jsx(tt,{path:"*",element:e.jsx(dd,{to:"/purchase",replace:!0})})]})}const cte=[{module_key:"purchase",label:"Direct Purchase",path:"/purchase/direct-purchase",type:"feature",icon:""},{module_key:"purchase",label:"Request for Quotation",path:"/purchase/rfqs",type:"feature",icon:""},{module_key:"purchase",label:"Supplier Quotations",path:"/purchase/supplier-quotations",type:"feature",icon:""},{module_key:"purchase",label:"Quotation Analysis",path:"/purchase/quotation-analysis",type:"feature",icon:""},{module_key:"purchase",label:"Local Purchase Orders",path:"/purchase/purchase-orders-local",type:"feature",icon:""},{module_key:"purchase",label:"Import Purchase Orders",path:"/purchase/purchase-orders-import",type:"feature",icon:""},{module_key:"purchase",label:"Shipping Advice",path:"/purchase/shipping-advice",type:"feature",icon:""},{module_key:"purchase",label:"Port Clearances",path:"/purchase/port-clearances",type:"feature",icon:""},{module_key:"purchase",label:"Local Purchase Bills",path:"/purchase/purchase-bills-local",type:"feature",icon:""},{module_key:"purchase",label:"Import Purchase Bills",path:"/purchase/purchase-bills-import",type:"feature",icon:""},{module_key:"purchase",label:"Suppliers",path:"/purchase/suppliers",type:"feature",icon:""},{module_key:"purchase",label:"Purchase Reports",path:"/purchase/reports",type:"feature",icon:""},{module_key:"purchase",label:"Procurement Overview",path:"/purchase/procurement-overview",type:"dashboard",icon:""},{module_key:"purchase",label:"Supplier Analytics",path:"/purchase/supplier-analytics",type:"dashboard",icon:""}];function dte(){const[t,s]=Is.useState([{rbac_key:"cash-balance",icon:"",value:"245,000",label:"Cash Balance",change:" 5% this month",changeType:"positive",path:"/finance/reports"},{rbac_key:"pending-vouchers",icon:"",value:"12",label:"Pending Vouchers",change:"3 urgent",changeType:"neutral",path:"/finance/journal-voucher"},{rbac_key:"monthly-expenses",icon:"",value:"32,000",label:"Monthly Expenses",change:" 2% vs last month",changeType:"positive",path:"/finance/reports"}]);Is.useEffect(()=>{let a=!0;async function n(){var i,l,o,d,u,c,h,m,p;try{const g=await Z.get("/bi/dashboards"),x=Number(((o=(l=(i=g==null?void 0:g.data)==null?void 0:i.summary)==null?void 0:l.finance)==null?void 0:o.cash_balance)||0),b=Number(((c=(u=(d=g==null?void 0:g.data)==null?void 0:d.summary)==null?void 0:u.finance)==null?void 0:c.pending_vouchers)||0),y=Number(((p=(m=(h=g==null?void 0:g.data)==null?void 0:h.summary)==null?void 0:m.finance)==null?void 0:p.monthly_expenses)||0);a&&s(j=>{const N=[...j];return N[0]={...N[0],value:`${x.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},N[1]={...N[1],value:String(b)},N[2]={...N[2],value:`${y.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},N})}catch{}}return n(),()=>{a=!1}},[]);const r=[{title:"Voucher Management",features:[{name:"Journal Entry",path:"/finance/journal-voucher",description:"General ledger journal entries",icon:""},{name:"Make Payment",path:"/finance/payment-voucher",description:"Record outgoing payments",icon:""},{name:"Receive Payment",path:"/finance/receipt-voucher",description:"Record incoming payments",icon:""},{name:"Credit Note",path:"/finance/credit-note",description:"Customer credit notes",icon:""},{name:"Debit Note",path:"/finance/debit-note",description:"Supplier debit notes",icon:""},{name:"Sales Voucher",path:"/finance/sales-voucher",description:"Sales transaction vouchers",icon:""},{name:"Purchase Voucher",path:"/finance/purchase-voucher",description:"Purchase transaction vouchers",icon:""},{name:"Account Transfer",path:"/finance/contra-voucher",description:"Bank or ledger transfers",icon:""},{name:"Voucher Register Report",path:"/finance/reports",description:"Voucher listing with filters (report)",icon:""}]},{title:"Accounting Setup",features:[{name:"Chart of Account Groups",path:"/finance/account-groups",description:"Setup account group hierarchy",icon:""},{name:"Accounts Creation",path:"/finance/accounts",description:"Create and manage accounts",icon:""},{name:"Cost Centers",path:"/finance/cost-centers",description:"Define and manage cost centers",icon:""},{name:"Tax Codes & Deductions",path:"/finance/tax-codes",description:"Configure tax and deduction codes",icon:""},{name:"Currencies",path:"/finance/currencies",description:"Manage currencies and base currency",icon:""},{name:"Fiscal Years",path:"/finance/fiscal-years",description:"Open/close fiscal periods",icon:""}]},{title:"Reports & Analysis",features:[{name:"Voucher Register",path:"/finance/reports/voucher-register",description:"Voucher listing with filters",icon:""},{name:"Payment Due",path:"/finance/reports/payment-due",description:"Upcoming and overdue payables",icon:""},{name:"Customer Outstanding",path:"/finance/reports/customer-outstanding",description:"Receivables outstanding by customer",icon:""},{name:"Trial Balance",path:"/finance/reports/trial-balance",description:"Debits and credits summary",icon:""},{name:"Audit Trail",path:"/finance/reports/audit-trail",description:"System activity on finance transactions",icon:""},{name:"Journal Report",path:"/finance/reports/journals",description:"Journal entries by range",icon:""},{name:"General Ledger",path:"/finance/reports/general-ledger",description:"Account ledger movements",icon:""},{name:"Debtors Ledger",path:"/finance/reports/debtors-ledger",description:"Customer ledger with running balance",icon:""},{name:"Creditors Ledger",path:"/finance/reports/creditors-ledger",description:"Supplier ledger with running balance",icon:""},{name:"Supplier Outstanding",path:"/finance/reports/supplier-outstanding",description:"Payables outstanding by supplier",icon:""},{name:"Profit & Loss",path:"/finance/reports/profit-and-loss",description:"Income vs. expenses summary",icon:""},{name:"Balance Sheet",path:"/finance/reports/balance-sheet",description:"Assets, liabilities, and equity",icon:""},{name:"Cash Flow",path:"/finance/reports/cash-flow",description:"Operating, investing, financing flows",icon:""},{name:"Ratio Analysis",path:"/finance/reports/ratio-analysis",description:"Key performance ratios",icon:""}]},{title:"Banking",features:[{name:"Bank Reconciliation",path:"/finance/bank-reconciliation",description:"Match bank statements with ledger, mark cleared",icon:""},{name:"Post-Dated Cheques (PDC)",path:"/finance/pdc-postings",description:"Register instruments and track status",icon:""}]}];return e.jsx(lo,{title:"Finance Module",description:"Comprehensive accounting, budgeting, and financial reporting system",stats:t,sections:r,features:ute})}const ute=[{module_key:"finance",label:"Journal Entry",path:"/finance/journal-voucher",type:"feature"},{module_key:"finance",label:"Make Payment",path:"/finance/payment-voucher",type:"feature"},{module_key:"finance",label:"Receive Payment",path:"/finance/receipt-voucher",type:"feature"},{module_key:"finance",label:"Credit Note",path:"/finance/credit-note",type:"feature"},{module_key:"finance",label:"Debit Note",path:"/finance/debit-note",type:"feature"},{module_key:"finance",label:"Sales Voucher",path:"/finance/sales-voucher",type:"feature"},{module_key:"finance",label:"Purchase Voucher",path:"/finance/purchase-voucher",type:"feature"},{module_key:"finance",label:"Account Transfer",path:"/finance/contra-voucher",type:"feature"},{module_key:"finance",label:"Voucher Register Report",path:"/finance/reports",type:"dashboard"},{module_key:"finance",label:"Chart of Account Groups",path:"/finance/account-groups",type:"feature"},{module_key:"finance",label:"Accounts Creation",path:"/finance/accounts",type:"feature"},{module_key:"finance",label:"Cost Centers",path:"/finance/cost-centers",type:"feature"},{module_key:"finance",label:"Tax Codes & Deductions",path:"/finance/tax-codes",type:"feature"},{module_key:"finance",label:"Currencies",path:"/finance/currencies",type:"feature"},{module_key:"finance",label:"Fiscal Years",path:"/finance/fiscal-years",type:"feature"},{module_key:"finance",label:"Voucher Register",path:"/finance/reports/voucher-register",type:"dashboard"},{module_key:"finance",label:"Payment Due",path:"/finance/reports/payment-due",type:"dashboard"},{module_key:"finance",label:"Customer Outstanding",path:"/finance/reports/customer-outstanding",type:"dashboard"},{module_key:"finance",label:"Trial Balance",path:"/finance/reports/trial-balance",type:"dashboard"},{module_key:"finance",label:"Audit Trail",path:"/finance/reports/audit-trail",type:"dashboard"},{module_key:"finance",label:"Journal Report",path:"/finance/reports/journals",type:"dashboard"},{module_key:"finance",label:"General Ledger",path:"/finance/reports/general-ledger",type:"dashboard"},{module_key:"finance",label:"Debtors Ledger",path:"/finance/reports/debtors-ledger",type:"dashboard"},{module_key:"finance",label:"Creditors Ledger",path:"/finance/reports/creditors-ledger",type:"dashboard"},{module_key:"finance",label:"Supplier Outstanding",path:"/finance/reports/supplier-outstanding",type:"dashboard"},{module_key:"finance",label:"Profit & Loss",path:"/finance/reports/profit-and-loss",type:"dashboard"},{module_key:"finance",label:"Balance Sheet",path:"/finance/reports/balance-sheet",type:"dashboard"},{module_key:"finance",label:"Cash Flow",path:"/finance/reports/cash-flow",type:"dashboard"},{module_key:"finance",label:"Ratio Analysis",path:"/finance/reports/ratio-analysis",type:"dashboard"},{module_key:"finance",label:"Bank Reconciliation",path:"/finance/bank-reconciliation",type:"feature"},{module_key:"finance",label:"Post-Dated Cheques (PDC)",path:"/finance/pdc-postings",type:"feature"}];function mte({status:t}){const s=t==="DRAFT"?"badge badge-warning":t==="APPROVED"||t==="POSTED"?"badge badge-success":t==="REVERSED"||t==="CANCELLED"?"badge badge-error":"badge badge-info";return e.jsx("span",{className:s,children:t})}function ou({voucherTypeCode:t,title:s}){const{canPerformAction:r}=Ls(),[a,n]=f.useState([]),[i,l]=f.useState(!0),[o,d]=f.useState(""),[u,c]=f.useState("ALL"),h=String(t).toUpperCase()==="PV",m=String(t).toUpperCase()==="RV",p=String(t).toUpperCase()==="CV",[g,x]=f.useState(!1),[b,y]=f.useState(null),[j,N]=f.useState(!1),[_,F]=f.useState(""),[I,w]=f.useState(null),[E,W]=f.useState([]),[R,U]=f.useState(null),[T,Y]=f.useState(null),[H,M]=f.useState(null),[q,z]=f.useState(!1),[Q,L]=f.useState({name:"",address:"",phone:"",email:"",city:"",state:"",country:"",postalCode:"",website:"",taxId:"",registrationNo:"",logoUrl:""}),[V,P]=f.useState(null),[C,k]=f.useState(null),B=String(t).toUpperCase()==="JV"?"journal-voucher":String(t).toUpperCase()==="PV"?"payment-voucher":String(t).toUpperCase()==="RV"?"receipt-voucher":String(t).toUpperCase()==="CV"?"contra-voucher":String(t).toUpperCase()==="SV"?"sales-voucher":String(t).toUpperCase()==="PUV"?"purchase-voucher":String(t).toUpperCase()==="DN"?"debit-note":"credit-note";async function G(){var Ce,Pe,fe;try{l(!0);const he=await Z.get("/finance/vouchers",{params:{voucherTypeCode:t}});n(((Ce=he.data)==null?void 0:Ce.items)||[])}catch(he){ct.error(((fe=(Pe=he==null?void 0:he.response)==null?void 0:Pe.data)==null?void 0:fe.message)||"Failed to load vouchers")}finally{l(!1)}}const[O,K]=f.useState([]),[J,te]=f.useState(!1);async function se(){var Ce;try{te(!0);const Pe=await Z.get("/finance/accounts",{params:{active:1}});K(((Ce=Pe.data)==null?void 0:Ce.items)||[])}catch{K([])}finally{te(!1)}}f.useEffect(()=>{G(),p&&se()},[t]),f.useEffect(()=>{let Ce=!0;async function Pe(){var fe,he,Ue;try{const Ke=(he=(fe=(await Z.get("/admin/me")).data)==null?void 0:fe.scope)==null?void 0:he.companyId;if(!Ke)return;const xe=((Ue=(await Z.get(`/admin/companies/${Ke}`)).data)==null?void 0:Ue.item)||{};if(!Ce)return;L(ye=>({...ye,name:xe.name||ye.name||"",address:xe.address||ye.address||"",phone:xe.telephone||ye.phone||"",email:xe.email||ye.email||"",city:xe.city||ye.city||"",state:xe.state||ye.state||"",country:xe.country||ye.country||"",postalCode:xe.postal_code||ye.postalCode||"",website:xe.website||ye.website||"",taxId:xe.tax_id||ye.taxId||"",registrationNo:xe.registration_no||ye.registrationNo||"",logoUrl:xe.has_logo===1||xe.has_logo===!0?`/api/admin/companies/${Ke}/logo`:ye.logoUrl||""}))}catch{}}return Pe(),()=>{Ce=!1}},[]);const ae=f.useMemo(()=>a.filter(Ce=>{const Pe=o.trim().toLowerCase(),fe=!Pe||String(Ce.voucher_no||"").toLowerCase().includes(Pe)||String(Ce.narration||"").toLowerCase().includes(Pe),he=u==="ALL"||Ce.status===u;return fe&&he}),[a,o,u]),ne=f.useMemo(()=>{const Ce=new Map;for(const Pe of O||[]){const fe=String(Pe.code||""),he=String(Pe.name||"");fe&&Ce.set(fe,he)}return Ce},[O]);function ue(Ce){var Ye,Ke;const Pe=String(Ce.narration||"");if(!p||!Pe)return Pe||"-";const fe=Pe.split(" | ").map(Je=>Je.trim());let he="",Ue="";for(const Je of fe)if(Je.toLowerCase().startsWith("from:")){const xe=((Ye=Je.split(":")[1])==null?void 0:Ye.trim())||"";he=ne.get(xe)||xe}else if(Je.toLowerCase().startsWith("to:")){const xe=((Ke=Je.split(":")[1])==null?void 0:Ke.trim())||"";Ue=ne.get(xe)||xe}return he&&Ue?`${he}  ${Ue}`:he||Ue||Pe||"-"}function oe(Ce){return String(Ce??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function le(Ce){return`<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Voucher</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 24px; color: #0f172a; background: #fff; }
      .vh { font-size: 12px; }
      .vh table { border-collapse: collapse; width: 100%; }
      .vh th, .vh td { border: 1px solid #e2e8f0; padding: 6px 8px; vertical-align: top; }
      .vh th { background: #f8fafc; text-align: left; }
      .vh .right { text-align: right; }
      .vh .center { text-align: center; }
      .vh-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 8px; }
      .vh-logo { min-width: 120px; max-width: 200px; }
      .vh-company { text-align: right; font-size: 11px; line-height: 1.35; }
      .vh-company .name { font-weight: 800; font-size: 14px; }
      .vh-titlebar { display: flex; align-items: center; gap: 10px; color: #0f172a; margin: 4px 0 10px; }
      .vh-titlebar .line { flex: 1; height: 1px; background: #0f172a; }
      .vh-titlebar .title { font-weight: 700; }
      .vh-details { width: 100%; margin-bottom: 10px; border: 1px solid #cbd5e1; }
      .vh-details td { border-color: #cbd5e1; }
      .vh-details .label { width: 32%; color: #475569; }
      .vh-details .label-wide { width: 40%; color: #475569; }
      .vh-items thead th { font-weight: 600; }
      .vh-footer a { color: inherit; text-decoration: underline; }
      @media print { button { display: none; } }
    </style>
  </head>
  <body>${Ce||""}</body>
</html>`}async function X(Ce){var fe;const Pe=Array.from(((fe=Ce==null?void 0:Ce.querySelectorAll)==null?void 0:fe.call(Ce,"img"))||[]);Pe.length&&await Promise.all(Pe.map(he=>new Promise(Ue=>{if(he.complete)return Ue();const Ye=()=>Ue();he.addEventListener("load",Ye,{once:!0}),he.addEventListener("error",Ye,{once:!0})})))}function me(Ce){const Pe=Ce.company||{},fe=Ce.receipt||{},he=Array.isArray(Ce.items)?Ce.items:[],Ue=Ce.totals||{};return`
    <div class="vh">
      <div class="vh-header">
        <div class="vh-logo">${Pe.logoHtml||""}</div>
        <div class="vh-company">
          <div class="name">${oe(Pe.name||"")}</div>
          <div>${oe(Pe.addressLine1||"")}</div>
          <div>${oe(Pe.addressLine2||"")}</div>
          <div>Telephone: ${oe(Pe.phone||"")}</div>
          <div>${oe(Pe.website||"")}</div>
          <div>TIN: ${oe(Pe.taxId||"")} &nbsp; Reg: ${oe(Pe.registrationNo||"")}</div>
        </div>
      </div>
      <div class="vh-titlebar">
        <div class="line"></div>
        <div class="title">* Receipt Voucher *</div>
        <div class="line"></div>
      </div>
      <table class="vh-details">
        <tr>
          <td style="width:50%;vertical-align:top;border-right:1px solid #cbd5e1;">
            <table style="width:100%;">
              <tr><td class="label-wide">Receipt No</td><td>:</td><td>${oe(fe.receiptNo||"")}</td></tr>
              <tr><td class="label-wide">Date/Time</td><td>:</td><td>${oe(fe.dateTime||"")}</td></tr>
              <tr><td class="label-wide">Method</td><td>:</td><td>${oe(fe.paymentMethod||"")}</td></tr>
            </table>
          </td>
          <td style="width:50%;vertical-align:top;">
            <div style="padding:8px;">
              <div class="label">Narration</div>
              <div>${oe(fe.headerText||"")}</div>
            </div>
          </td>
        </tr>
      </table>
      <table class="vh-items">
        <thead>
          <tr>
            <th>Description</th>
            <th class="right" style="width:22%;">Amount</th>
          </tr>
        </thead>
        <tbody>
          ${he.map(Ye=>`
            <tr>
              <td>${oe(Ye.name||"")}</td>
              <td class="right">${oe(Ye.lineTotal||Ye.price||"0.00")}</td>
            </tr>
          `).join("")}
          <tr>
            <td class="right"><strong>Subtotal</strong></td>
            <td class="right"><strong>${oe(Number(Ue.subtotal||0).toFixed(2))}</strong></td>
          </tr>
          <tr>
            <td class="right">Tax</td>
            <td class="right">${oe(Number(Ue.tax||0).toFixed(2))}</td>
          </tr>
          <tr>
            <td class="right"><strong>Total</strong></td>
            <td class="right"><strong>${oe(Number(Ue.total||Ue.grand||0).toFixed(2))}</strong></td>
          </tr>
        </tbody>
      </table>
      <div class="vh-footer" style="margin-top:10px;text-align:center;">
        <div>${oe(fe.footerText||"")}</div>
      </div>
    </div>
    `}function we(Ce){const Pe=Ce.company||{},fe=Ce.payment||{},he=Array.isArray(Ce.items)?Ce.items:[],Ue=Ce.totals||{};return`
    <div class="vh">
      <div class="vh-header">
        <div class="vh-logo">${Pe.logoHtml||""}</div>
        <div class="vh-company">
          <div class="name">${oe(Pe.name||"")}</div>
          <div>${oe(Pe.addressLine1||"")}</div>
          <div>${oe(Pe.addressLine2||"")}</div>
          <div>Telephone: ${oe(Pe.phone||"")}</div>
          <div>${oe(Pe.website||"")}</div>
          <div>TIN: ${oe(Pe.taxId||"")} &nbsp; Reg: ${oe(Pe.registrationNo||"")}</div>
        </div>
      </div>
      <div class="vh-titlebar">
        <div class="line"></div>
        <div class="title">* Payment Voucher *</div>
        <div class="line"></div>
      </div>
      <table class="vh-details">
        <tr>
          <td style="width:50%;vertical-align:top;border-right:1px solid #cbd5e1;">
            <table style="width:100%;">
              <tr><td class="label-wide">Payment No</td><td>:</td><td>${oe(fe.paymentNo||"")}</td></tr>
              <tr><td class="label-wide">Date/Time</td><td>:</td><td>${oe(fe.dateTime||"")}</td></tr>
              <tr><td class="label-wide">Method</td><td>:</td><td>${oe(fe.paymentMethod||"")}</td></tr>
            </table>
          </td>
          <td style="width:50%;vertical-align:top;">
            <div style="padding:8px;">
              <div class="label">Narration</div>
              <div>${oe(fe.headerText||"")}</div>
            </div>
          </td>
        </tr>
      </table>
      <table class="vh-items">
        <thead>
          <tr>
            <th>Description</th>
            <th class="right" style="width:22%;">Amount</th>
          </tr>
        </thead>
        <tbody>
          ${he.map(Ye=>`
            <tr>
              <td>${oe(Ye.name||"")}</td>
              <td class="right">${oe(Ye.lineTotal||Ye.price||"0.00")}</td>
            </tr>
          `).join("")}
          <tr>
            <td class="right"><strong>Subtotal</strong></td>
            <td class="right"><strong>${oe(Number(Ue.subtotal||0).toFixed(2))}</strong></td>
          </tr>
          <tr>
            <td class="right">Tax</td>
            <td class="right">${oe(Number(Ue.tax||0).toFixed(2))}</td>
          </tr>
          <tr>
            <td class="right"><strong>Total</strong></td>
            <td class="right"><strong>${oe(Number(Ue.total||Ue.grand||0).toFixed(2))}</strong></td>
          </tr>
        </tbody>
      </table>
      <div class="vh-footer" style="margin-top:10px;text-align:center;">
        <div>${oe(fe.footerText||"")}</div>
      </div>
    </div>
    `}function Ie(Ce,Pe){const fe=String(Q.logoUrl||"").trim(),he=fe?`<img src="${fe}" alt="${oe(Q.name||"Company")}" style="max-height:80px;object-fit:contain;" />`:"",Ue=(Array.isArray(Pe)?Pe:[]).filter(Ke=>Number(Ke.credit||0)>0).map(Ke=>{const Je=Number(Ke.credit||0);return{name:String(Ke.description||Ke.account_name||""),qty:"1.00",price:Je.toFixed(2),discount:"0.00",lineTotal:Je.toFixed(2)}}),Ye=Ue.reduce((Ke,Je)=>{const xe=Number(Je.lineTotal||0);return Ke.subtotal+=xe,Ke.total+=xe,Ke},{subtotal:0,total:0});return{company:{name:Q.name||"",addressLine1:Q.address||"",addressLine2:[Q.city,Q.state,Q.country].filter(Boolean).join("  "),phone:Q.phone||"",website:Q.website||"",taxId:Q.taxId||"",registrationNo:Q.registrationNo||"",logoUrl:fe,logoHtml:he},receipt:{receiptNo:String(Ce.voucher_no||""),dateTime:Ce.voucher_date?new Date(Ce.voucher_date).toLocaleString():new Date().toLocaleString(),paymentMethod:"",headerText:"",footerText:""},items:Ue,totals:{subtotal:Ye.subtotal.toFixed(2),tax:"0.00",total:Ye.total.toFixed(2)}}}function _e(Ce,Pe){const fe=String(Q.logoUrl||"").trim(),he=fe?`<img src="${fe}" alt="${oe(Q.name||"Company")}" style="max-height:80px;object-fit:contain;" />`:"",Ue=(Array.isArray(Pe)?Pe:[]).filter(Ke=>Number(Ke.debit||0)>0).map(Ke=>{const Je=Number(Ke.debit||0);return{name:String(Ke.description||Ke.account_name||""),qty:"1.00",price:Je.toFixed(2),discount:"0.00",lineTotal:Je.toFixed(2)}}),Ye=Ue.reduce((Ke,Je)=>{const xe=Number(Je.lineTotal||0);return Ke.subtotal+=xe,Ke.total+=xe,Ke},{subtotal:0,total:0});return{company:{name:Q.name||"",addressLine1:Q.address||"",addressLine2:[Q.city,Q.state,Q.country].filter(Boolean).join("  "),phone:Q.phone||"",website:Q.website||"",taxId:Q.taxId||"",registrationNo:Q.registrationNo||"",logoUrl:fe,logoHtml:he},payment:{paymentNo:String(Ce.voucher_no||""),dateTime:Ce.voucher_date?new Date(Ce.voucher_date).toLocaleString():new Date().toLocaleString(),paymentMethod:"",headerText:"",footerText:""},items:Ue,totals:{subtotal:Ye.subtotal.toFixed(2),tax:"0.00",total:Ye.total.toFixed(2)}}}async function Fe(Ce){var Pe,fe,he;try{const Ue=await Z.get(`/finance/vouchers/${Ce}`),Ye=((Pe=Ue.data)==null?void 0:Pe.voucher)||{},Ke=Array.isArray((fe=Ue.data)==null?void 0:fe.lines)?Ue.data.lines:[],Je=m?me(Ie(Ye,Ke)):h?we(_e(Ye,Ke)):"",xe=le(Je),ye=document.createElement("iframe");ye.style.position="fixed",ye.style.right="0",ye.style.bottom="0",ye.style.width="0",ye.style.height="0",ye.style.border="0",document.body.appendChild(ye);const Ae=((he=ye.contentWindow)==null?void 0:he.document)||ye.contentDocument||null;if(!Ae){document.body.removeChild(ye),window.print();return}Ae.open(),Ae.write(xe),Ae.close();const be=ye.contentWindow||window;setTimeout(()=>{be.focus();try{be.print()}catch{}setTimeout(()=>{document.body.removeChild(ye)},100)},200)}catch{}}async function Le(Ce){var Pe,fe;try{const he=await Z.get(`/finance/vouchers/${Ce}`),Ue=((Pe=he.data)==null?void 0:Pe.voucher)||{},Ye=Array.isArray((fe=he.data)==null?void 0:fe.lines)?he.data.lines:[],Ke=m?me(Ie(Ue,Ye)):h?we(_e(Ue,Ye)):"";if(!Ke)return;const Je=document.createElement("div");Je.style.position="fixed",Je.style.left="-10000px",Je.style.top="0",Je.style.width="794px",Je.style.background="white",Je.style.padding="32px",Je.innerHTML=Ke,document.body.appendChild(Je);try{await X(Je);const xe=await wi(Je,{scale:2,useCORS:!0}),ye=xe.toDataURL("image/png"),Ae=new hs("p","mm","a4"),be=Ae.internal.pageSize.getWidth(),Ee=Ae.internal.pageSize.getHeight(),dt=be,mt=xe.height*dt/xe.width;let it=0;for(;it<mt;)Ae.addImage(ye,"PNG",0,-it,dt,mt),it+=Ee,it<mt&&Ae.addPage();const ht=(m?"ReceiptVoucher_":h?"PaymentVoucher_":"Voucher_")+(String(Ue.voucher_no||"").replaceAll(" ","_")||new Date().toISOString().slice(0,10))+".pdf";Ae.save(ht)}finally{document.body.removeChild(Je)}}catch{}}async function rt(Ce){var Pe,fe;try{const he=window.prompt("Reason for reversal (optional):")||"";await Z.post(`/finance/vouchers/${Ce}/reverse`,{reason:he}),ct.success("Voucher reversed"),G()}catch(he){ct.error(((fe=(Pe=he==null?void 0:he.response)==null?void 0:Pe.data)==null?void 0:fe.message)||"Failed to reverse voucher")}}async function He(Ce){var Pe,fe,he;if(y(Ce),x(!0),F(""),T)await st();else try{N(!0);const Ue=await Z.get("/workflows"),Ye=Array.isArray((Pe=Ue.data)==null?void 0:Pe.items)?Ue.data.items:[];Y(Ye),await De(Ye)}catch(Ue){F(((he=(fe=Ue==null?void 0:Ue.response)==null?void 0:fe.data)==null?void 0:he.message)||"Failed to load workflows")}finally{N(!1)}}async function st(){var Ue,Ye,Ke;if(!T||!T.length){w(null),U(null),W([]),F("");return}const Ce=h?"/finance/payment-voucher":m?"/finance/receipt-voucher":"/finance/contra-voucher",Pe=h?["PAYMENT_VOUCHER","Payment Voucher","PV"]:m?["RECEIPT_VOUCHER","Receipt Voucher","RV"]:["CONTRA_VOUCHER","Contra Voucher","CV"],fe=Je=>String(Je||"").trim().toUpperCase().replace(/\s+/g,"_"),he=T.find(Je=>Number(Je.is_active)===1&&String(Je.document_route||"")===Ce)||T.find(Je=>Number(Je.is_active)===1&&(fe(Je.document_type)===fe(Pe[0])||fe(Je.document_type)===fe(Pe[1])||fe(Je.document_type)===fe(Pe[2])))||null;if(w(he||null),U(null),M(null),W([]),!!he)try{N(!0);const Je=await Z.get(`/workflows/${he.id}`),xe=((Ue=Je==null?void 0:Je.data)==null?void 0:Ue.item)||{},ye=Array.isArray(xe==null?void 0:xe.steps)?xe.steps:[];W(ye);const Ae=ye[0]||null;if(U(Ae?{userId:Ae.approver_user_id,name:Ae.approver_name,stepName:Ae.step_name,stepOrder:Ae.step_order,approvalLimit:Ae.approval_limit}:null),Ae){const be=(Array.isArray(Ae.approvers)&&Ae.approvers.length?Ae.approvers[0].id:Ae.approver_user_id)||null;M(be)}else M(null)}catch(Je){F(((Ke=(Ye=Je==null?void 0:Je.response)==null?void 0:Ye.data)==null?void 0:Ke.message)||"Failed to load workflow details")}finally{N(!1)}}async function De(Ce){var Ye,Ke,Je;if(!Ce||!Ce.length){w(null),U(null),W([]),F("");return}const Pe=h?"/finance/payment-voucher":m?"/finance/receipt-voucher":"/finance/contra-voucher",fe=h?["PAYMENT_VOUCHER","Payment Voucher","PV"]:m?["RECEIPT_VOUCHER","Receipt Voucher","RV"]:["CONTRA_VOUCHER","Contra Voucher","CV"],he=xe=>String(xe||"").trim().toUpperCase().replace(/\s+/g,"_"),Ue=Ce.find(xe=>Number(xe.is_active)===1&&String(xe.document_route||"")===Pe)||Ce.find(xe=>Number(xe.is_active)===1&&(he(xe.document_type)===he(fe[0])||he(xe.document_type)===he(fe[1])||he(xe.document_type)===he(fe[2])))||null;if(w(Ue||null),U(null),M(null),W([]),!!Ue)try{N(!0);const xe=await Z.get(`/workflows/${Ue.id}`),ye=((Ye=xe==null?void 0:xe.data)==null?void 0:Ye.item)||{},Ae=Array.isArray(ye==null?void 0:ye.steps)?ye.steps:[];W(Ae);const be=Ae[0]||null;if(U(be?{userId:be.approver_user_id,name:be.approver_name,stepName:be.step_name,stepOrder:be.step_order,approvalLimit:be.approval_limit}:null),be){const Ee=(Array.isArray(be.approvers)&&be.approvers.length?be.approvers[0].id:be.approver_user_id)||null;M(Ee)}else M(null)}catch(xe){F(((Je=(Ke=xe==null?void 0:xe.response)==null?void 0:Ke.data)==null?void 0:Je.message)||"Failed to load workflow details")}finally{N(!1)}}async function Te(){var Ce,Pe,fe;if(b){z(!0),F("");try{const he=b.total_debit===void 0||b.total_debit===null?b.total_credit===void 0||b.total_credit===null?null:Number(b.total_credit||0):Number(b.total_debit||0),Ue=await Z.post(`/finance/vouchers/${b.id}/submit`,{amount:he,workflow_id:I?I.id:null,target_user_id:H||null}),Ye=((Ce=Ue==null?void 0:Ue.data)==null?void 0:Ce.status)||"PENDING_APPROVAL";n(Ke=>Ke.map(Je=>Je.id===b.id?{...Je,status:Ye}:Je)),x(!1),y(null)}catch(he){F(((fe=(Pe=he==null?void 0:he.response)==null?void 0:Pe.data)==null?void 0:fe.message)||"Failed to forward for approval")}finally{z(!1)}}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:s}),e.jsx("p",{className:"text-sm mt-1",children:"List, review, and manage vouchers"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/finance",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("button",{type:"button",className:"btn-success",onClick:G,disabled:i,children:"Refresh"}),e.jsx(Re,{to:"./create",className:"btn-success",children:"Create New"})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{className:"input",placeholder:"Search voucher no or narration...",value:o,onChange:Ce=>d(Ce.target.value)})}),e.jsx("div",{className:"w-full md:w-56",children:e.jsxs("select",{className:"input",value:u,onChange:Ce=>c(Ce.target.value),children:[e.jsx("option",{value:"ALL",children:"All Status"}),e.jsx("option",{value:"DRAFT",children:"Draft"}),e.jsx("option",{value:"SUBMITTED",children:"Submitted"}),e.jsx("option",{value:"APPROVED",children:"Approved"}),e.jsx("option",{value:"POSTED",children:"Posted"}),e.jsx("option",{value:"REVERSED",children:"Reversed"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})})]}),i?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-brand"}),e.jsx("div",{className:"mt-2",children:"Loading..."})]}):ae.length===0?e.jsx("div",{className:"text-center py-12",children:"No vouchers found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Voucher No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Narration"}),e.jsx("th",{className:"text-right",children:"Debit"}),e.jsx("th",{className:"text-right",children:"Credit"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:ae.map(Ce=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:Ce.voucher_no}),e.jsx("td",{children:new Date(Ce.voucher_date).toLocaleDateString()}),e.jsx("td",{children:ue(Ce)}),e.jsx("td",{className:"text-right",children:`GH ${Number(Ce.total_debit||0).toLocaleString()}`}),e.jsx("td",{className:"text-right",children:`GH ${Number(Ce.total_credit||0).toLocaleString()}`}),e.jsx("td",{children:e.jsx(mte,{status:Ce.status})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-3",children:[r("finance:vouchers","view")&&e.jsx(Re,{to:`/finance/${B}/${Ce.id}?mode=view`,className:"text-brand hover:text-brand-600 font-medium text-sm",children:"View"}),r("finance:vouchers","edit")&&e.jsx(Re,{to:`/finance/${B}/${Ce.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 font-medium text-sm",style:{display:(h||m)&&Ce.status==="APPROVED"?"none":"inline"},children:"Edit"}),(h||m)&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"inline-flex items-center px-3 py-1.5 rounded bg-green-600 hover:bg-green-700 text-white text-xs font-semibold",onClick:()=>Fe(Ce.id),children:"Print"}),e.jsx("button",{type:"button",className:"inline-flex items-center px-3 py-1.5 rounded bg-purple-600 hover:bg-purple-700 text-white text-xs font-semibold",onClick:()=>Le(Ce.id),children:"PDF"})]}),(h||m||p)&&(Ce.status==="APPROVED"?e.jsx("span",{className:"ml-3 text-sm font-medium px-2 py-1 rounded bg-green-500 text-white",children:"Approved"}):e.jsx("button",{type:"button",className:"ml-3 text-sm font-medium px-2 py-1 rounded bg-brand text-white hover:bg-brand-700 transition-colors",onClick:()=>He(Ce),disabled:q||Ce.status==="POSTED"||Ce.status==="REJECTED"||Ce.status==="PENDING_APPROVAL"||Ce.status==="SUBMITTED",children:"Forward for Approval"})),!h&&!m&&!p&&e.jsx("button",{type:"button",className:"text-red-600 hover:text-red-700 font-medium text-sm",onClick:()=>rt(Ce.id),disabled:Ce.status==="REVERSED",children:"Reverse"})]})})]},Ce.id))})]})})]})}),g?e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-erp w/full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-brand text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Forward for Approval"}),e.jsx("button",{onClick:()=>{x(!1),y(null),w(null),U(null),M(null),W([]),F("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Voucher:"," ",e.jsx("span",{className:"font-semibold",children:b==null?void 0:b.voucher_no})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:I?`${I.workflow_name} (${I.workflow_code})`:"None (inactive)"})]}),e.jsxs("div",{children:[j?e.jsx("div",{className:"text-sm",children:"Loading workflow..."}):null,_?e.jsx("div",{className:"text-sm text-red-600",children:_}):null]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Target Approver"}),(()=>{const Pe=Array.isArray(E)&&E.length>0?E[0]:null,fe=Pe?Array.isArray(Pe.approvers)&&Pe.approvers.length?Pe.approvers.map(he=>({id:he.id,name:he.username})):Pe.approver_user_id?[{id:Pe.approver_user_id,name:Pe.approver_name||String(Pe.approver_user_id)}]:[]:[];return fe.length>0?e.jsxs("div",{className:"mt-1",children:[e.jsxs("select",{className:"input w-full",value:H||"",onChange:he=>M(he.target.value?Number(he.target.value):null),children:[e.jsx("option",{value:"",children:"Select target approver"}),fe.map(he=>e.jsx("option",{value:he.id,children:he.name},he.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:R?`Step ${R.stepOrder}  ${R.stepName}${R.approvalLimit!=null?`  Limit: ${Number(R.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:I?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})()]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{x(!1),y(null),w(null),U(null),M(null),W([]),F("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:Te,disabled:q||!b||Array.isArray(E)&&E.length>0&&I&&!H,children:q?"Forwarding...":"Forward"})]})]})}):null]})}function OA(){return{accountId:"",description:"",debit:"",credit:""}}function Ai({voucherTypeCode:t,title:s}){var gn,po;const r=ps(),{id:a}=Ps(),{search:n}=Ur(),l=new URLSearchParams(n).get("mode")==="view",o=!!a,[d,u]=f.useState(!1),[c,h]=f.useState([]),[m,p]=f.useState([]),[g,x]=f.useState([]),[b,y]=f.useState([]),[j,N]=f.useState([]),[_,F]=f.useState([]),[I,w]=f.useState([]),[E,W]=f.useState([]),[R,U]=f.useState([]),[T,Y]=f.useState(""),[H,M]=f.useState(new Date().toISOString().split("T")[0]),[q,z]=f.useState(""),[Q,L]=f.useState(""),[V,P]=f.useState([OA(),OA()]),C=String(t).toUpperCase()==="RV",k=String(t).toUpperCase()==="PV",B=String(t).toUpperCase()==="CV",G=String(t).toUpperCase()==="DN",O=String(t).toUpperCase()==="CN",K=String(t).toUpperCase()==="JV",[J,te]=f.useState({receivedFrom:"",receivedFromCode:"",payerAccountId:"",paymentMethod:"Cash",reference:"",chequeDate:"",depositAccountId:"",taxCodeId:"",items:[{description:"",accountId:"",amount:"",referenceNo:""}],notes:""}),[se,ae]=f.useState({payTo:"",payToCode:"",payToAccountId:"",paymentMethod:"Cash",reference:"",chequeDate:"",paymentAccountId:"",taxCodeId:"",items:[{description:"",accountId:"",amount:""}],notes:""}),[ne,ue]=f.useState(""),[oe,le]=f.useState(""),[X,me]=f.useState(!1),[we,Ie]=f.useState(""),[_e,Fe]=f.useState(!1),[Le,rt]=f.useState(!1),[He,st]=f.useState(!1),[De,Te]=f.useState(""),[Ce,Pe]=f.useState(""),[fe,he]=f.useState(null),[Ue,Ye]=f.useState([]),[Ke,Je]=f.useState(!1),[xe,ye]=f.useState(""),[Ae,be]=f.useState(null),[Ee,dt]=f.useState(null),[mt,it]=f.useState(null),[ht,ft]=f.useState(null),[Rt,Ge]=f.useState(!1),[at,je]=f.useState("DRAFT"),[Se,nt]=f.useState({fromAccountId:"",toAccountId:"",transferMethod:"Cash",reference:"",chequeDate:"",taxCodeId:"",items:[{description:"",amount:""}],notes:""}),[Ze,gt]=f.useState(""),[jt,Mt]=f.useState([]),[Ne,ke]=f.useState(""),qe=f.useMemo(()=>{const Be=Array.isArray(jt)?jt:[];return Be.find(lt=>String(lt.is_base)==="1"||lt.is_base===1||lt.is_base===!0)||Be.find(lt=>String(lt.code||lt.currency_code||"").toUpperCase()==="GHS")||Be.find(lt=>/ghana|cedi/i.test(String(lt.name||lt.currency_name||"")))},[jt]),ge=f.useMemo(()=>{const Be=V.find(ut=>String(ut.accountId||"")),lt=g.find(ut=>String(ut.id)===String((Be==null?void 0:Be.accountId)||""));return(lt==null?void 0:lt.currency_id)||null},[V,g]);async function Me(){var Be,lt,ut,yt,It,Lt,qt,ss,$t;try{const[ms,Ns,rs,ns,os,fs,or]=await Promise.all([Z.get("/finance/voucher-types"),Z.get("/finance/fiscal-years"),Z.get("/finance/accounts"),Z.get("/finance/tax-codes"),Z.get("/sales/customers?active=true"),Z.get("/purchase/suppliers?active=true"),Z.get("/finance/currencies")]),cn=((Be=ms.data)==null?void 0:Be.items)||[],aa=((lt=Ns.data)==null?void 0:lt.items)||[],pr=((ut=rs.data)==null?void 0:ut.items)||[],na=(((yt=ns.data)==null?void 0:yt.items)||[]).filter(rr=>Number(rr.is_active||0)===1),tr=Array.isArray((It=os.data)==null?void 0:It.items)?os.data.items:[],ba=Array.isArray((Lt=fs.data)==null?void 0:Lt.items)?fs.data.items:[],Zn=Array.isArray((qt=or.data)==null?void 0:qt.items)?or.data.items:[],Pl=[...tr.map(rr=>({type:"CUSTOMER",id:rr.id,code:rr.customer_code&&String(rr.customer_code).trim()||`C${String(Number(rr.id||0)).padStart(5,"0")}`,name:String(rr.customer_name||"").trim()})),...ba.map(rr=>({type:"SUPPLIER",id:rr.id,code:rr.supplier_code&&String(rr.supplier_code).trim()||`SU-${String(Number(rr.id||0)).padStart(6,"0")}`,name:String(rr.supplier_name||"").trim(),serviceContractor:String(rr.service_contractor||"N").toUpperCase()}))].filter(rr=>rr.name).sort((rr,zr)=>rr.name.localeCompare(zr.name));h(cn),p(aa),x(pr),y(na),N(Pl),Mt(Zn),!Q&&aa.length&&L(String(aa[0].id))}catch(ms){ct.error((($t=(ss=ms==null?void 0:ms.response)==null?void 0:ss.data)==null?void 0:$t.message)||"Failed to load finance setup")}}async function Ve(Be){var lt;try{const ut=await Z.get("/sales/invoices",{params:{customer_id:Be}}),It=(Array.isArray((lt=ut.data)==null?void 0:lt.items)?ut.data.items:[]).filter(Lt=>String(Lt.customer_id)===String(Be)&&Number(Lt.balance_amount||0)>0).map(Lt=>({id:Lt.id,invoice_no:Lt.invoice_no,balance_amount:Number(Lt.balance_amount||0),total_amount:Number(Lt.total_amount||Lt.net_amount||0),tax_code_id:Lt.tax_code_id||null})).sort((Lt,qt)=>Lt.invoice_no.localeCompare(qt.invoice_no));F(It)}catch{F([])}}async function vt(Be){var lt,ut;try{const yt=await Z.get("/purchase/bills"),Lt=(Array.isArray((lt=yt.data)==null?void 0:lt.items)?yt.data.items:[]).filter($t=>String($t.supplier_id)===String(Be.id)).map($t=>({id:$t.id,bill_no:$t.bill_no,payment_status:String($t.payment_status||"UNPAID"),outstanding:Math.max(0,Math.round((Number($t.net_amount||0)-Number($t.amount_paid||0))*100)/100)})).filter($t=>$t.payment_status!=="PAID"&&Number($t.outstanding)>0);let qt=Lt;if(String(Be.serviceContractor||"N")==="Y"){const $t=await Z.get("/purchase/service-bills",{params:{supplierId:Be.id}}),Ns=(Array.isArray((ut=$t.data)==null?void 0:ut.items)?$t.data.items:[]).map(rs=>({id:`SB-${rs.id}`,bill_no:rs.bill_no,payment_status:String(rs.payment||"UNPAID"),outstanding:Math.max(0,Math.round((Number(rs.total_amount||0)-Number(rs.amount_paid||0))*100)/100)})).filter(rs=>rs.payment_status!=="PAID"&&Number(rs.outstanding)>0);qt=[...Lt,...Ns]}qt=qt.sort(($t,ms)=>String($t.bill_no||"").localeCompare(String(ms.bill_no||""))),w(qt);const ss=new Set(qt.map($t=>String($t.bill_no)));W($t=>$t.filter(ms=>ss.has(String(ms))))}catch{w([]),W([])}}f.useEffect(()=>{Me()},[]),f.useEffect(()=>{async function Be(){var lt;if(!o&&k)try{const ut=await Z.get("/finance/vouchers/next-no?voucherTypeCode=PV"),yt=String(((lt=ut.data)==null?void 0:lt.nextNo)||""),It=yt.match(/^PV-?(\d+)$/i),Lt=It?`PV-${String(It[1]).padStart(6,"0")}`:yt;Y(Lt)}catch{Y("")}}Be()},[k,o]),f.useEffect(()=>{async function Be(){var lt;if(!o&&C)try{const ut=await Z.get("/finance/vouchers/next-no?voucherTypeCode=RV"),yt=String(((lt=ut.data)==null?void 0:lt.nextNo)||""),It=yt.match(/^RV-?(\d+)$/i),Lt=It?`RV-${String(It[1]).padStart(6,"0")}`:yt;Y(Lt)}catch{Y("")}}Be()},[C,o]),f.useEffect(()=>{async function Be(){var lt;if(!o&&B)try{const ut=await Z.get("/finance/vouchers/next-no?voucherTypeCode=CV"),yt=String(((lt=ut.data)==null?void 0:lt.nextNo)||""),It=yt.match(/^CV-?(\d+)$/i),Lt=It?`CV-${String(It[1]).padStart(6,"0")}`:yt;Y(Lt)}catch{Y("")}}Be()},[B,o]),f.useEffect(()=>{async function Be(){var lt;if(!o&&G)try{const ut=await Z.get("/finance/vouchers/next-no?voucherTypeCode=DN"),yt=String(((lt=ut.data)==null?void 0:lt.nextNo)||""),It=yt.match(/^DN-?(\d+)$/i),Lt=It?`DN-${String(It[1]).padStart(6,"0")}`:yt;Y(Lt)}catch{Y("")}}Be()},[G,o]),f.useEffect(()=>{async function Be(){var lt;if(!o&&O)try{const ut=await Z.get("/finance/vouchers/next-no?voucherTypeCode=CN"),yt=String(((lt=ut.data)==null?void 0:lt.nextNo)||""),It=yt.match(/^CN-?(\d+)$/i),Lt=It?`CN-${String(It[1]).padStart(6,"0")}`:yt;Y(Lt)}catch{Y("")}}Be()},[O,o]),f.useEffect(()=>{async function Be(){var lt;if(!o&&K)try{const ut=await Z.get("/finance/vouchers/next-no?voucherTypeCode=JV"),yt=String(((lt=ut.data)==null?void 0:lt.nextNo)||""),It=yt.match(/^JV-?(\d+)$/i),Lt=It?`JV-${String(It[1]).padStart(6,"0")}`:yt;Y(Lt)}catch{Y("")}}Be()},[K,o]),f.useEffect(()=>{if(!(O||G))return;const Be=ge||null,lt=(qe==null?void 0:qe.id)||null;if(!Be||!lt){ke("1");return}if(String(Be)===String(lt)){ke("1");return}(async()=>{var ut,yt;try{const It=await Z.get("/finance/currency-rates",{params:{fromCurrencyId:Number(Be),toCurrencyId:Number(lt),to:H||null}}),qt=(Array.isArray((ut=It.data)==null?void 0:ut.items)?It.data.items:[]).slice().sort(($t,ms)=>new Date(ms.rate_date).getTime()-new Date($t.rate_date).getTime());let ss=qt.length?Number(qt[0].rate||0):0;if(!ss)try{const $t=await Z.get("/finance/currency-rates",{params:{fromCurrencyId:Number(lt),toCurrencyId:Number(Be),to:H||null}}),Ns=(Array.isArray((yt=$t.data)==null?void 0:yt.items)?$t.data.items:[]).slice().sort((ns,os)=>new Date(os.rate_date).getTime()-new Date(ns.rate_date).getTime()),rs=Ns.length?Number(Ns[0].rate||0):0;ss=rs?1/rs:0}catch{}ke(ss?String(ss):"1")}catch{ke("1")}})()},[O,G,ge,qe,H]);async function St(){var Be,lt,ut,yt,It,Lt,qt,ss;if(o)try{u(!0);const ms=(await Z.get(`/finance/vouchers/${a}`)).data||{},Ns=ms.item||ms.voucher||ms;if(!Ns)return;const rs=(Ns.voucher_date||Ns.date||new Date().toISOString()).split("T")[0];M(rs),Y(String(Ns.voucher_no||((Be=ms.voucher)==null?void 0:Be.voucher_no)||"")),je(String(Ns.status||((lt=ms.voucher)==null?void 0:lt.status)||"DRAFT")),(Ns.fiscal_year_id||Ns.fiscalYearId||(ut=ms.voucher)!=null&&ut.fiscal_year_id)&&L(String(Ns.fiscal_year_id||Ns.fiscalYearId||((yt=ms.voucher)==null?void 0:yt.fiscal_year_id))),z(Ns.narration||((It=ms.voucher)==null?void 0:It.narration)||"");const ns=Array.isArray(ms.lines)?ms.lines:Array.isArray(Ns.lines)?Ns.lines:Ns.items||[],os=String(Ns.narration||((Lt=ms.voucher)==null?void 0:Lt.narration)||""),fs=pr=>{const na=os.match(new RegExp(`${pr}\\s*:\\s*([^|]+)`,"i"));return na?String(na[1]).trim():""},or=ns.filter(pr=>Number(pr.credit||0)>0),cn=ns.filter(pr=>Number(pr.debit||0)>0),aa=ns.map(pr=>({accountId:String(pr.account_id||pr.accountId||""),description:pr.description||"",debit:Number(pr.debit||0),credit:Number(pr.credit||0)}))||[];if(P(aa.length?aa:[OA(),OA()]),C){const pr=aa.find(zr=>Number(zr.debit||0)>0),na=aa.filter(zr=>Number(zr.credit||0)>0),tr=or[0]||null,ba=fs("Received from")||(tr==null?void 0:tr.account_name)||"",Zn=tr!=null&&tr.account_code?String(tr.account_code):"",Pl=tr!=null&&tr.account_id?String(tr.account_id):"",rr=Zn?j.find(zr=>String(zr.code)===Zn):null;String((rr==null?void 0:rr.type)||"").toUpperCase()==="CUSTOMER"&&(rr!=null&&rr.id)?await Ve(rr.id):F([]),te(zr=>({...zr,depositAccountId:(pr==null?void 0:pr.accountId)||"",receivedFrom:ba||zr.receivedFrom,receivedFromCode:Zn||zr.receivedFromCode,payerAccountId:Pl||zr.payerAccountId,paymentMethod:fs("Method")||zr.paymentMethod,reference:fs("Ref")||zr.reference,items:na.length>0?na.map(ei=>({description:ei.description||"",accountId:String(ei.accountId||""),amount:Number(ei.credit||0),referenceNo:String((or.find(Rc=>String(Rc.account_id||"")===String(ei.accountId||""))||{}).reference_no||"")||""})):zr.items}))}else if(k){const pr=aa.find(rr=>Number(rr.credit||0)>0),na=aa.filter(rr=>Number(rr.debit||0)>0),tr=cn[0]||null,ba=fs("Paid to")||(tr==null?void 0:tr.account_name)||"",Zn=tr!=null&&tr.account_code?String(tr.account_code):"",Pl=tr!=null&&tr.account_id?String(tr.account_id):"";ae(rr=>({...rr,paymentAccountId:(pr==null?void 0:pr.accountId)||"",payTo:ba||rr.payTo,payToCode:Zn||rr.payToCode,payToAccountId:Pl||rr.payToAccountId,paymentMethod:fs("Method")||rr.paymentMethod,reference:fs("Ref")||rr.reference,items:na.length>0?na.map(zr=>({description:zr.description||"",accountId:String(zr.accountId||""),amount:Number(zr.debit||0)})):rr.items}))}else if(B){const pr=aa.find(tr=>Number(tr.debit||0)>0),na=aa.find(tr=>Number(tr.credit||0)>0);nt(tr=>({...tr,toAccountId:(pr==null?void 0:pr.accountId)||"",fromAccountId:(na==null?void 0:na.accountId)||"",items:aa.length>0?aa.filter(ba=>Number(ba.debit||0)>0||Number(ba.credit||0)>0).map(ba=>({description:ba.description||"",amount:Number(ba.debit||ba.credit||0)})):tr.items}))}}catch($t){ct.error(((ss=(qt=$t==null?void 0:$t.response)==null?void 0:qt.data)==null?void 0:ss.message)||"Failed to load voucher")}finally{u(!1)}}f.useEffect(()=>{St()},[a]);async function xt(Be){var lt,ut,yt;try{const It=await Z.get("/finance/voucher-types",{params:{code:Be}}),Lt=Array.isArray((lt=It.data)==null?void 0:lt.items)?It.data.items:[];if(Lt.length>0)return Number(Lt[0].id||0);const qt=String(Be||"").toUpperCase(),ss=qt==="PV"?"Payment Voucher":qt==="RV"?"Receipt Voucher":qt==="CV"?"Contra Voucher":qt==="CN"?"Credit Note":qt==="DN"?"Debit Note":"Voucher",$t=qt==="PV"?"PAYMENT":qt==="RV"?"RECEIPT":"GENERAL";await Z.post("/finance/voucher-types",{code:qt,name:ss,category:$t,prefix:qt,next_number:1,requires_approval:0,is_active:1});const ms=await Z.get("/finance/voucher-types",{params:{code:qt}}),Ns=Array.isArray((ut=ms.data)==null?void 0:ut.items)?ms.data.items:[];return Number(((yt=Ns==null?void 0:Ns[0])==null?void 0:yt.id)||0)}catch{return 0}}const Ct=f.useMemo(()=>c.find(Be=>Be.code===t),[c,t]),Tt=f.useMemo(()=>{const Be=c.find(ut=>String(ut.code).toUpperCase()===String(t).toUpperCase());if(Be!=null&&Be.name)return Be.name;const lt=String(t||"").toUpperCase();return lt==="CN"?"Credit Note":lt==="DN"?"Debit Note":"Voucher"},[c,t]),bt=f.useMemo(()=>{var Be,lt;if(C){const ut=J.items.reduce((yt,It)=>yt+Number(It.amount||0),0);return{debit:ut,credit:ut,subtotal:ut,tax:0,grand:ut}}if(k){const ut=se.items.reduce((Lt,qt)=>Lt+Number(qt.amount||0),0),yt=Number(((Be=b.find(Lt=>String(Lt.id)===String(se.taxCodeId)))==null?void 0:Be.rate_percent)||0),It=Math.round(ut*yt)/100;return{debit:ut,credit:ut,subtotal:ut,tax:It,grand:ut+It}}if(B){const ut=Se.items.reduce((Lt,qt)=>Lt+Number(qt.amount||0),0),yt=Number(((lt=b.find(Lt=>String(Lt.id)===String(Se.taxCodeId)))==null?void 0:lt.rate_percent)||0),It=Math.round(ut*yt)/100;return{debit:ut,credit:ut,subtotal:ut,tax:It,grand:ut+It}}return V.reduce((ut,yt)=>(ut.debit+=Number(yt.debit||0),ut.credit+=Number(yt.credit||0),ut),{debit:0,credit:0})},[V,J,se,Se,C,k,B,b]),Jt=Math.round(bt.debit*100)===Math.round(bt.credit*100),Gt=l?"bg-blue-50 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700 font-semibold":"",[Ht,es]=f.useState({name:"",address:"",city:"",state:"",country:"",phone:"",email:"",website:"",taxId:"",registrationNo:"",logoUrl:""}),[js,Zs]=f.useState({}),Xs=f.useMemo(()=>{const Be=g.filter(ut=>["DEBTORS","CREDITORS"].includes(String(ut.group_name||"").toUpperCase()));if(!we)return Be;const lt=String(we).toLowerCase();return Be.filter(ut=>String(ut.name||"").toLowerCase().includes(lt)||String(ut.code||"").toLowerCase().includes(lt))},[g,we]),Hs=f.useMemo(()=>{if(!C)return{components:[],taxTotal:0,grand:bt.grand};const Be=bt.subtotal||0,ut=(js[String(J.taxCodeId||"")]||[]).map(Lt=>{const qt=Number(Lt.rate_percent||0),ss=Be*qt/100;return{name:Lt.component_name,rate:qt,amount:ss,sort_order:Lt.sort_order||0}}).sort((Lt,qt)=>Lt.sort_order-qt.sort_order),yt=ut.reduce((Lt,qt)=>Lt+qt.amount,0),It=Be+yt;return{components:ut,taxTotal:yt,grand:It}},[C,bt.subtotal,bt.grand,J.taxCodeId,js]);f.useEffect(()=>{async function Be(){var ut;const lt=String(J.taxCodeId||"");if(!(!C||!lt||js[lt]))try{const yt=await Z.get(`/finance/tax-codes/${lt}/components`),It=Array.isArray((ut=yt.data)==null?void 0:ut.items)?yt.data.items:[];Zs(Lt=>({...Lt,[lt]:It}))}catch{}}Be()},[C,J.taxCodeId,js]),f.useEffect(()=>{let Be=!0;async function lt(){var ut,yt,It;try{const qt=(yt=(ut=(await Z.get("/admin/me")).data)==null?void 0:ut.scope)==null?void 0:yt.companyId;if(!qt)return;const $t=((It=(await Z.get(`/admin/companies/${qt}`)).data)==null?void 0:It.item)||{},ms=$t.has_logo===1||$t.has_logo===!0?`/api/admin/companies/${qt}/logo`:"";if(!Be)return;es({name:$t.name||"",address:$t.address||"",city:$t.city||"",state:$t.state||"",country:$t.country||"",phone:$t.telephone||"",email:$t.email||"",website:$t.website||"",taxId:$t.tax_id||"",registrationNo:$t.registration_no||"",logoUrl:ms})}catch{}}return lt(),()=>{Be=!1}},[]);function Bs(Be){return String(Be??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Ln(Be){return`<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Voucher</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 24px; color: #0f172a; background: #fff; }
      .vh { font-size: 12px; }
      .vh table { border-collapse: collapse; width: 100%; }
      .vh th, .vh td { border: 1px solid #e2e8f0; padding: 6px 8px; vertical-align: top; }
      .vh th { background: #f8fafc; text-align: left; }
      .vh .right { text-align: right; }
      .vh .center { text-align: center; }
      .vh-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 8px; }
      .vh-logo { min-width: 120px; max-width: 200px; }
      .vh-company { text-align: right; font-size: 11px; line-height: 1.35; }
      .vh-company .name { font-weight: 800; font-size: 14px; }
      .vh-titlebar { display: flex; align-items: center; gap: 10px; color: #0f172a; margin: 4px 0 10px; }
      .vh-titlebar .line { flex: 1; height: 1px; background: #0f172a; }
      .vh-titlebar .title { font-weight: 700; }
      .vh-details { width: 100%; margin-bottom: 10px; border: 1px solid #cbd5e1; }
      .vh-details td { border-color: #cbd5e1; }
      .vh-details .label { width: 32%; color: #475569; }
      .vh-details .label-wide { width: 40%; color: #475569; }
      .vh-items thead th { font-weight: 600; }
      .vh-footer a { color: inherit; text-decoration: underline; }
      @media print { button { display: none; } }
    </style>
  </head>
  <body>${Be||""}</body>
</html>`}function br(Be){const lt=Be.company||{},ut=Be.receipt||{},yt=Array.isArray(Be.items)?Be.items:[],It=Be.totals||{};return`
    <div class="vh">
      <div class="vh-header">
        <div class="vh-logo">${lt.logoHtml||""}</div>
        <div class="vh-company">
          <div class="name">${Bs(lt.name||"")}</div>
          <div>${Bs(lt.addressLine1||"")}</div>
          <div>${Bs(lt.addressLine2||"")}</div>
          <div>Telephone: ${Bs(lt.phone||"")}</div>
          <div>Email: ${Bs(lt.email||"")}</div>
          <div>${Bs(lt.website||"")}</div>
          <div>TIN: ${Bs(lt.taxId||"")} &nbsp; Reg: ${Bs(lt.registrationNo||"")}</div>
        </div>
      </div>
      <div class="vh-titlebar">
        <div class="line"></div>
        <div class="title">* Receipt Voucher *</div>
        <div class="line"></div>
      </div>
      <table class="vh-details">
        <tr>
          <td style="width:50%;vertical-align:top;border-right:1px solid #cbd5e1;">
            <table style="width:100%;">
              <tr><td class="label-wide">Receipt No</td><td>:</td><td>${Bs(ut.receiptNo||"")}</td></tr>
              <tr><td class="label-wide">Date/Time</td><td>:</td><td>${Bs(ut.dateTime||"")}</td></tr>
              <tr><td class="label-wide">Method</td><td>:</td><td>${Bs(ut.paymentMethod||"")}</td></tr>
            </table>
          </td>
          <td style="width:50%;vertical-align:top;">
            <div style="padding:8px;">
              <div class="label">Narration</div>
              <div>${Bs(ut.headerText||"")}</div>
            </div>
          </td>
        </tr>
      </table>
      <table class="vh-items">
        <thead>
          <tr>
            <th>Description</th>
            <th class="right" style="width:22%;">Amount</th>
          </tr>
        </thead>
        <tbody>
          ${yt.map(Lt=>`
            <tr>
              <td>${Bs(Lt.name||"")}</td>
              <td class="right">${Bs(Lt.lineTotal||Lt.price||"0.00")}</td>
            </tr>
          `).join("")}
          <tr>
            <td class="right"><strong>Subtotal</strong></td>
            <td class="right"><strong>${Bs(Number(It.subtotal||0).toFixed(2))}</strong></td>
          </tr>
          <tr>
            <td class="right">Tax</td>
            <td class="right">${Bs(Number(It.tax||0).toFixed(2))}</td>
          </tr>
          <tr>
            <td class="right"><strong>Total</strong></td>
            <td class="right"><strong>${Bs(Number(It.total||It.grand||0).toFixed(2))}</strong></td>
          </tr>
        </tbody>
      </table>
      <div class="vh-footer" style="margin-top:10px;text-align:center;">
        <div>${Bs(ut.footerText||"")}</div>
      </div>
    </div>
    `}function mr(Be){const lt=Be.company||{},ut=Be.payment||{},yt=Array.isArray(Be.items)?Be.items:[],It=Be.totals||{};return`
    <div class="vh">
      <div class="vh-header">
        <div class="vh-logo">${lt.logoHtml||""}</div>
        <div class="vh-company">
          <div class="name">${Bs(lt.name||"")}</div>
          <div>${Bs(lt.addressLine1||"")}</div>
          <div>${Bs(lt.addressLine2||"")}</div>
          <div>Telephone: ${Bs(lt.phone||"")}</div>
          <div>Email: ${Bs(lt.email||"")}</div>
          <div>${Bs(lt.website||"")}</div>
          <div>TIN: ${Bs(lt.taxId||"")} &nbsp; Reg: ${Bs(lt.registrationNo||"")}</div>
        </div>
      </div>
      <div class="vh-titlebar">
        <div class="line"></div>
        <div class="title">* Payment Voucher *</div>
        <div class="line"></div>
      </div>
      <table class="vh-details">
        <tr>
          <td style="width:50%;vertical-align:top;border-right:1px solid #cbd5e1;">
            <table style="width:100%;">
              <tr><td class="label-wide">Payment No</td><td>:</td><td>${Bs(ut.paymentNo||"")}</td></tr>
              <tr><td class="label-wide">Date/Time</td><td>:</td><td>${Bs(ut.dateTime||"")}</td></tr>
              <tr><td class="label-wide">Method</td><td>:</td><td>${Bs(ut.paymentMethod||"")}</td></tr>
            </table>
          </td>
          <td style="width:50%;vertical-align:top;">
            <div style="padding:8px;">
              <div class="label">Narration</div>
              <div>${Bs(ut.headerText||"")}</div>
            </div>
          </td>
        </tr>
      </table>
      <table class="vh-items">
        <thead>
          <tr>
            <th>Description</th>
            <th class="right" style="width:22%;">Amount</th>
          </tr>
        </thead>
        <tbody>
          ${yt.map(Lt=>`
            <tr>
              <td>${Bs(Lt.name||"")}</td>
              <td class="right">${Bs(Lt.lineTotal||Lt.price||"0.00")}</td>
            </tr>
          `).join("")}
          <tr>
            <td class="right"><strong>Subtotal</strong></td>
            <td class="right"><strong>${Bs(Number(It.subtotal||0).toFixed(2))}</strong></td>
          </tr>
          <tr>
            <td class="right">Tax</td>
            <td class="right">${Bs(Number(It.tax||0).toFixed(2))}</td>
          </tr>
          <tr>
            <td class="right"><strong>Total</strong></td>
            <td class="right"><strong>${Bs(Number(It.total||It.grand||0).toFixed(2))}</strong></td>
          </tr>
        </tbody>
      </table>
      <div class="vh-footer" style="margin-top:10px;text-align:center;">
        <div>${Bs(ut.footerText||"")}</div>
      </div>
    </div>
    `}const Ja=()=>{const Be=String(Ht.logoUrl||"").trim(),lt=Be?`<img src="${Be}" alt="${Bs(Ht.name||"Company")}" style="max-height:80px;object-fit:contain;" />`:"",ut=[];Ht.address&&ut.push(Ht.address);const yt=[Ht.city,Ht.state].filter(Boolean).join(", ");yt&&ut.push(yt),Ht.country&&ut.push(Ht.country);const It=String(ut[0]||""),Lt=String(ut.slice(1).join("  ")||""),qt=(Array.isArray(J.items)?J.items:[]).map(Ns=>{const rs=Number(Ns.amount||0);return{name:String(Ns.description||""),qty:"1.00",price:rs.toFixed(2),discount:"0.00",lineTotal:rs.toFixed(2)}}),ss=H?new Date(H):new Date,$t=String(J.paymentMethod||"").toUpperCase(),ms=$t==="CASH"?"Cash":$t==="BANK"?"Bank":$t==="CHEQUE"?"Cheque":$t==="TRANSFER"?"Bank Transfer":$t==="CARD"?"Card":"Other";return{company:{name:Ht.name||"",addressLine1:It,addressLine2:Lt,phone:Ht.phone||"",website:Ht.website||"",taxId:Ht.taxId||"",registrationNo:Ht.registrationNo||"",logoUrl:Be,logoHtml:lt},receipt:{receiptNo:String(T||""),dateTime:ss.toLocaleString(),paymentMethod:ms,headerText:"",footerText:""},items:qt,totals:{subtotal:Number(bt.subtotal||0).toFixed(2),tax:Number(bt.tax||0).toFixed(2),total:Number(bt.grand||0).toFixed(2)}}},Tr=()=>{const Be=String(Ht.logoUrl||"").trim(),lt=Be?`<img src="${Be}" alt="${Bs(Ht.name||"Company")}" style="max-height:80px;object-fit:contain;" />`:"",ut=[];Ht.address&&ut.push(Ht.address);const yt=[Ht.city,Ht.state].filter(Boolean).join(", ");yt&&ut.push(yt),Ht.country&&ut.push(Ht.country);const It=String(ut[0]||""),Lt=String(ut.slice(1).join("  ")||""),qt=(Array.isArray(se.items)?se.items:[]).map(Ns=>{const rs=Number(Ns.amount||0);return{name:String(Ns.description||""),qty:"1.00",price:rs.toFixed(2),discount:"0.00",lineTotal:rs.toFixed(2)}}),ss=H?new Date(H):new Date,$t=String(se.paymentMethod||"").toUpperCase(),ms=$t==="CASH"?"Cash":$t==="BANK"?"Bank":$t==="CHEQUE"?"Cheque":$t==="TRANSFER"?"Bank Transfer":$t==="CARD"?"Card":"Other";return{company:{name:Ht.name||"",addressLine1:It,addressLine2:Lt,phone:Ht.phone||"",website:Ht.website||"",taxId:Ht.taxId||"",registrationNo:Ht.registrationNo||"",logoUrl:Be,logoHtml:lt},payment:{paymentNo:String(T||""),dateTime:ss.toLocaleString(),paymentMethod:ms,headerText:"",footerText:""},items:qt,totals:{subtotal:Number(bt.subtotal||0).toFixed(2),tax:Number(bt.tax||0).toFixed(2),total:Number(bt.grand||0).toFixed(2)}}};async function ta(Be){var ut;const lt=Array.from(((ut=Be==null?void 0:Be.querySelectorAll)==null?void 0:ut.call(Be,"img"))||[]);lt.length!==0&&await Promise.race([Promise.all(lt.map(yt=>new Promise(It=>{if(yt.complete)return It();const Lt=()=>It();yt.addEventListener("load",Lt,{once:!0}),yt.addEventListener("error",Lt,{once:!0})}))),new Promise(yt=>setTimeout(yt,1500))])}const fl=async()=>{var Be;try{const lt=C?br(Ja()):k?mr(Tr()):"",ut=Ln(lt),yt=document.createElement("iframe");yt.style.position="fixed",yt.style.right="0",yt.style.bottom="0",yt.style.width="0",yt.style.height="0",yt.style.border="0",document.body.appendChild(yt);const It=((Be=yt.contentWindow)==null?void 0:Be.document)||yt.contentDocument||null;if(!It){document.body.removeChild(yt),window.print();return}It.open(),It.write(ut),It.close();const Lt=yt.contentWindow||window;setTimeout(()=>{Lt.focus();try{Lt.print()}catch{}setTimeout(()=>{document.body.removeChild(yt)},100)},200)}catch{}},Za=async()=>{try{const Be=C?br(Ja()):k?mr(Tr()):"";if(!Be)return;const lt=document.createElement("div");lt.style.position="fixed",lt.style.left="-10000px",lt.style.top="0",lt.style.width="794px",lt.style.background="white",lt.style.padding="32px",lt.innerHTML=Be,document.body.appendChild(lt);try{await ta(lt);const ut=await wi(lt,{scale:2,useCORS:!0}),yt=ut.toDataURL("image/png"),It=new hs("p","mm","a4"),Lt=It.internal.pageSize.getWidth(),qt=It.internal.pageSize.getHeight(),ss=Lt,$t=ut.height*ss/ut.width;let ms=0;for(;ms<$t;)It.addImage(yt,"PNG",0,-ms,ss,$t),ms+=qt,ms<$t&&It.addPage();const Ns=(C?"ReceiptVoucher_":k?"PaymentVoucher_":"Voucher_")+(T||new Date().toISOString().slice(0,10))+".pdf";It.save(Ns)}finally{document.body.removeChild(lt)}}catch{}};function Sa(Be,lt){l||P(ut=>ut.map((yt,It)=>It===Be?{...yt,...lt}:yt))}function Ci(){l||P(Be=>[...Be,OA()])}function Vi(Be){l||P(lt=>lt.length<=2?lt:lt.filter((ut,yt)=>yt!==Be))}async function va(Be){var qt,ss,$t,ms,Ns,rs;if(Be.preventDefault(),l)return;const lt=Number((Ct==null?void 0:Ct.id)||0)||await xt(t),ut=Number(lt||0);let yt=[];if(C){if(!J.depositAccountId){ct.error("Select deposit account");return}const ns=J.items.map(fs=>({accountId:Number(fs.accountId||0),description:fs.description||null,amount:Number(fs.amount||0),referenceNo:fs.referenceNo&&String(fs.referenceNo).trim()||null})).filter(fs=>fs.accountId&&fs.amount>0);if(ns.length===0){ct.error("Enter at least one payment detail item");return}const os=ns.reduce((fs,or)=>fs+or.amount,0);yt=[{accountId:Number(J.depositAccountId),description:J.receivedFrom||"Receipt",debit:Number(os),credit:0},...ns.map(fs=>({accountId:fs.accountId,description:fs.description,debit:0,credit:fs.amount,referenceNo:fs.referenceNo||null}))]}else if(k){if(!se.paymentAccountId){ct.error("Select payment account");return}const ns=se.items.map(fs=>({accountId:Number(fs.accountId||0),description:fs.description||null,amount:Number(fs.amount||0),referenceNo:fs.referenceNo&&String(fs.referenceNo).trim()||null})).filter(fs=>fs.accountId&&fs.amount>0);if(ns.length===0){ct.error("Enter at least one payment detail item");return}const os=ns.reduce((fs,or)=>fs+or.amount,0);yt=[...ns.map(fs=>({accountId:fs.accountId,description:fs.description,debit:fs.amount,credit:0,referenceNo:fs.referenceNo||null})),{accountId:Number(se.paymentAccountId),description:se.payTo||"Payment",debit:0,credit:Number(os)}]}else if(B){if(!Se.fromAccountId||!Se.toAccountId){ct.error("Select both From and To accounts");return}if(String(Se.fromAccountId)===String(Se.toAccountId)){ct.error("From and To accounts must be different");return}const ns=Se.items.map(fs=>({description:fs.description||null,amount:Number(fs.amount||0)})).filter(fs=>fs.amount>0);if(ns.length===0){ct.error("Enter at least one transfer detail item");return}const os=ns.reduce((fs,or)=>fs+or.amount,0);yt=[{accountId:Number(Se.toAccountId),description:"Account Transfer",debit:Number(os),credit:0},{accountId:Number(Se.fromAccountId),description:"Account Transfer",debit:0,credit:Number(os)}]}else yt=V.map(ns=>({accountId:Number(ns.accountId||0),description:ns.description||null,debit:Number(ns.debit||0),credit:Number(ns.credit||0)})).filter(ns=>ns.accountId&&(ns.debit||ns.credit));if(yt.length<2){ct.error("Enter at least two posting lines");return}const It=yt.reduce((ns,os)=>ns+Number(os.debit||0),0),Lt=yt.reduce((ns,os)=>ns+Number(os.credit||0),0);if(Math.round(It*100)!==Math.round(Lt*100)){ct.error("Total debit must equal total credit");return}try{u(!0);const ns={voucherTypeId:ut,voucherTypeCode:t,voucherDate:H,narration:C?[J.receivedFrom?`Received from: ${J.receivedFrom}`:null,J.paymentMethod?`Method: ${J.paymentMethod}`:null,J.reference?`Ref: ${J.reference}`:null,q||null].filter(Boolean).join(" | "):k?[se.payTo?`Paid to: ${se.payTo}`:null,se.paymentMethod?`Method: ${se.paymentMethod}`:null,se.reference?`Ref: ${se.reference}`:null,q||null].filter(Boolean).join(" | "):B?[Se.fromAccountId?`From: ${(qt=g.find(os=>String(os.id)===String(Se.fromAccountId)))==null?void 0:qt.code}`:null,Se.toAccountId?`To: ${(ss=g.find(os=>String(os.id)===String(Se.toAccountId)))==null?void 0:ss.code}`:null,Se.transferMethod?`Method: ${Se.transferMethod}`:null,Se.reference?`Ref: ${Se.reference}`:null,q||null].filter(Boolean).join(" | "):q,lines:yt,...k?{apply_to_purchase_bills:(se.items||[]).map(os=>({ref:os.referenceNo&&String(os.referenceNo)||"",amount:Number(os.amount||0)})).filter(os=>os.ref&&os.amount>0).map(os=>{const fs=I.find(or=>String(or.bill_no)===String(os.ref));return fs?{bill_id:Number(fs.id),amount:os.amount}:null}).filter(Boolean),apply_to_service_bills:(se.items||[]).map(os=>({ref:os.referenceNo&&String(os.referenceNo)||"",amount:Number(os.amount||0)})).filter(os=>os.ref&&os.amount>0).map(os=>{const fs=I.find(aa=>String(aa.bill_no)===String(os.ref));if(!fs)return null;const or=String(fs.id||"");return/^SB-\d+$/.test(or)?{bill_id:Number(or.replace(/^SB-/,"")),amount:os.amount}:null}).filter(Boolean)}:{}};if(o){const os=await Z.put(`/finance/vouchers/${a}`,ns);ct.success((($t=os.data)==null?void 0:$t.message)||"Updated voucher")}else{const os=await Z.post("/finance/vouchers",ns);ct.success(`Created ${((ms=os.data)==null?void 0:ms.voucherNo)||"voucher"}`)}r(`/finance/${t==="JV"?"journal-voucher":t==="PV"?"payment-voucher":t==="RV"?"receipt-voucher":t==="CV"?"contra-voucher":t==="SV"?"sales-voucher":t==="PUV"?"purchase-voucher":t==="DN"?"debit-note":t==="CN"?"credit-note":"journal-voucher"}`)}catch(ns){ct.error(((rs=(Ns=ns==null?void 0:ns.response)==null?void 0:Ns.data)==null?void 0:rs.message)||"Failed to create voucher")}finally{u(!1)}}if(K||O||G)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:s}),e.jsx("p",{className:"text-sm mt-1",children:"Create a new voucher (double-entry enforced)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"..",className:"btn-success",children:"Back"}),at==="APPROVED"?e.jsx("span",{className:"px-2 py-1 rounded bg-green-500 text-white text-sm font-medium",children:"Approved"}):e.jsx("button",{type:"button",className:"btn-success",onClick:async()=>{var Be,lt,ut,yt;if(o&&(Fe(!0),ye(""),!mt))try{Je(!0);const It=await Z.get("/workflows"),Lt=Array.isArray((Be=It.data)==null?void 0:Be.items)?It.data.items:[];it(Lt);const qt=(bt==null?void 0:bt.grand)===""||(bt==null?void 0:bt.grand)==null?null:Number((bt==null?void 0:bt.grand)||0);let ss=null;const $t=Lt.filter(rs=>String(rs.document_route||"")==="/finance/receipt-voucher"),ms=Lt.filter(rs=>["RECEIPT_VOUCHER","Receipt Voucher","RV"].includes(String(rs.document_type||""))),Ns=[...$t,...ms];for(const rs of Ns){if(ss)break;if(Number(rs.is_active)!==1)continue;if(qt===null){ss=rs;break}const ns=rs.min_amount===null||Number(qt)>=Number(rs.min_amount),os=rs.max_amount===null||Number(qt)<=Number(rs.max_amount);if(ns&&os){ss=rs;break}}if(!ss)for(const rs of ms){if(ss)break;if(Number(rs.is_active)!==1)continue;if(qt===null){ss=rs;break}const ns=rs.min_amount===null||Number(qt)>=Number(rs.min_amount),os=rs.max_amount===null||Number(qt)<=Number(rs.max_amount);if(ns&&os){ss=rs;break}}if(be(ss),dt(null),ft(null),ss){const rs=await Z.get(`/workflows/${ss.id}`),ns=((lt=rs==null?void 0:rs.data)==null?void 0:lt.item)||{},os=Number(ns.current_step_order||1),fs=Array.isArray(ns==null?void 0:ns.next_step_approvers)?ns.next_step_approvers:[],or=fs.length>0?Number(fs[0].id):null;dt({stepOrder:os||1,stepName:String(ns.step_name||"Step 1"),approvalLimit:fs.length>0?Number(fs[0].approval_limit||0):null,approvers:fs}),ft(or)}}catch(It){ye(((yt=(ut=It==null?void 0:It.response)==null?void 0:ut.data)==null?void 0:yt.message)||"Failed to load workflows")}finally{Je(!1)}},disabled:d||!o,children:"Forward for Approval"})]})]})})}),e.jsx("form",{onSubmit:va,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[!(k||C)&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher Type"}),e.jsx("input",{className:"input",value:Tt,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher No"}),e.jsx("input",{className:"input",value:T||(K?"JV-000001":O?"CN-000001":G?"DN-000001":""),disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher Date *"}),e.jsx("input",{className:`input ${Gt}`,type:"date",value:H,onChange:Be=>M(Be.target.value),required:!0,disabled:l})]}),!(k||C)&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Fiscal Year *"}),e.jsxs("select",{className:`input ${Gt}`,value:Q,onChange:Be=>L(Be.target.value),required:!0,disabled:l,children:[e.jsx("option",{value:"",children:"Select"}),m.map(Be=>e.jsx("option",{value:Be.id,children:Be.code},Be.id))]})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"label",children:"Narration"}),e.jsx("input",{className:"input",value:q,onChange:Be=>z(Be.target.value),placeholder:"Optional narration",disabled:l})]})]}),X&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-xl shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center px-4 py-3 border-b",children:[e.jsx("div",{className:"font-semibold text-brand",children:"Select Paid To"}),e.jsx("button",{type:"button",className:"text-slate-600 hover:text-slate-800 text-xl font-bold",onClick:()=>me(!1),children:""})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("label",{className:"label",children:"Search"}),e.jsx("input",{className:"input w-full",placeholder:"Type name or code",value:we,onChange:Be=>Ie(Be.target.value),autoFocus:!0}),e.jsx("div",{className:"mt-3 max-h-64 overflow-y-auto border rounded",children:Xs.length===0?e.jsx("div",{className:"p-3 text-center text-slate-500",children:"No matches"}):Xs.sort((Be,lt)=>String(Be.name).localeCompare(String(lt.name))).map(Be=>e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-slate-100 border-b last:border-b-0",onClick:()=>{const lt=String(Be.id),ut=String(Be.name||""),yt=se.items.length===0?[{description:"",accountId:lt,amount:0}]:se.items.map((It,Lt)=>Lt===0?{...It,accountId:lt}:It);Ua({payTo:ut,payToAccountId:lt,items:yt}),me(!1),Ie("")},children:[e.jsx("div",{className:"font-medium",children:Be.name}),e.jsx("div",{className:"text-xs text-slate-500",children:Be.code})]},Be.id))}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{me(!1),Ie("")},children:"Close"})})]})]})}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:[O||G?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Exchange Rate"}),e.jsx("input",{className:"input",value:Ne||"",readOnly:!0})]})}):null,e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("div",{className:"font-semibold text-slate-800 dark:text-slate-200",children:"Posting Lines"}),e.jsx("button",{type:"button",className:"btn-success",onClick:Ci,disabled:l,children:"+ Add Line"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Account"}),e.jsx("th",{children:"Description"}),O||G?e.jsx("th",{className:"text-right w-32",children:"Currency"}):null,e.jsx("th",{className:"text-right",children:"Debit"}),e.jsx("th",{className:"text-right",children:"Credit"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:V.map((Be,lt)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("select",{className:"input",value:Be.accountId,onChange:ut=>Sa(lt,{accountId:ut.target.value}),required:!0,disabled:l,children:[e.jsx("option",{value:"",children:"Select account"}),g.map(ut=>e.jsxs("option",{value:ut.id,children:[ut.code," - ",ut.name]},ut.id))]})}),e.jsx("td",{children:e.jsx("input",{className:"input",value:Be.description,onChange:ut=>Sa(lt,{description:ut.target.value}),placeholder:"Line memo",disabled:l})}),O||G?e.jsx("td",{className:"text-right",children:(()=>{const ut=g.find(yt=>String(yt.id)===String(Be.accountId||""));return(ut==null?void 0:ut.currency_code)||""})()}):null,e.jsx("td",{children:e.jsx("input",{className:"input text-right",type:"number",min:"0",step:"1",value:Be.debit||"",onChange:ut=>Sa(lt,{debit:String(ut.target.value||"").replace(/^0+(?=\d)/,""),credit:0}),onFocus:()=>{String(Be.debit??"")==="0"&&Sa(lt,{debit:""})},disabled:l})}),e.jsx("td",{children:e.jsx("input",{className:"input text-right",type:"number",min:"0",step:"1",value:Be.credit||"",onChange:ut=>Sa(lt,{credit:String(ut.target.value||"").replace(/^0+(?=\d)/,""),debit:0}),onFocus:()=>{String(Be.credit??"")==="0"&&Sa(lt,{credit:""})},disabled:l})}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"text-red-600 hover:text-red-700 text-sm font-medium",onClick:()=>Vi(lt),disabled:l,children:"Remove"})})]},lt))})]})}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs("div",{className:"w-72 space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Debit"}),e.jsx("span",{children:`GH ${bt.debit.toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Credit"}),e.jsx("span",{children:`GH ${bt.credit.toFixed(2)}`})]}),e.jsxs("div",{className:`flex justify-between text-sm font-semibold ${Jt?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"}`,children:[e.jsx("span",{children:"Status"}),e.jsx("span",{children:Jt?"Balanced":"Not Balanced"})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"..",className:"btn-success",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-success",disabled:d||!Jt||l,children:d?"Saving...":"Save Voucher"})]})]})})}),_e?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-[640px] max-w-[95%]",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-brand text-white rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Forward Receipt Voucher for Approval"}),e.jsx("button",{type:"button",onClick:()=>{Fe(!1),be(null),dt(null),ye("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Document No:"," ",e.jsx("span",{className:"font-semibold",children:T||"-"})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:Ae?Ae.workflow_name:"Auto"})]}),e.jsx("div",{className:"text-sm text-red-600",children:xe||""}),e.jsx("div",{children:Ke?e.jsx("div",{className:"text-slate-600",children:"Loading workflows..."}):Ee&&Array.isArray(Ee.approvers)?e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Assign To"}),e.jsxs("select",{className:"input",value:ht||"",onChange:Be=>ft(Be.target.value||null),children:[e.jsx("option",{value:"",children:"Select approver"}),Ee.approvers.map(Be=>e.jsx("option",{value:Be.id,children:Be.username},Be.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:Ee?`Step ${Ee.stepOrder}  ${Ee.stepName}${Ee.approvalLimit!=null?`  Limit: ${Number(Ee.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:Ae?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{Fe(!1),be(null),dt(null),ye("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:async()=>{var Be,lt,ut;if(o){Ge(!0),ye("");try{const yt=await Z.post(`/finance/vouchers/${a}/submit`,{amount:(bt==null?void 0:bt.grand)===""||(bt==null?void 0:bt.grand)==null?null:Number((bt==null?void 0:bt.grand)||0),workflow_id:Ae?Ae.id:null,target_user_id:ht||null}),It=((Be=yt==null?void 0:yt.data)==null?void 0:Be.status)||"PENDING_APPROVAL";je(It),Fe(!1)}catch(yt){ye(((ut=(lt=yt==null?void 0:yt.response)==null?void 0:lt.data)==null?void 0:ut.message)||"Failed to forward for approval")}finally{Ge(!1)}}},disabled:Rt||!o,children:Rt?"Forwarding...":"Forward"})]})]})}):null]});function en(Be){l||te(lt=>({...lt,...Be}))}function Pa(Be,lt){l||en({items:J.items.map((ut,yt)=>yt===Be?{...ut,...lt}:ut)})}function co(Be){const lt=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],ut=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"],yt=["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],It=Math.floor(Be||0),Lt=Math.round(((Be||0)-It)*100);function qt($t){return $t===0?"":$t<10?lt[$t]:$t<20?yt[$t-10]:$t<100?ut[Math.floor($t/10)]+($t%10!==0?" "+lt[$t%10]:""):$t<1e3?lt[Math.floor($t/100)]+" Hundred"+($t%100!==0?" "+qt($t%100):""):$t<1e6?qt(Math.floor($t/1e3))+" Thousand"+($t%1e3!==0?" "+qt($t%1e3):""):qt(Math.floor($t/1e6))+" Million"+($t%1e6!==0?" "+qt($t%1e6):"")}let ss=qt(It)+" Cedi"+(It!==1?"s":"");return Lt>0&&(ss+=" and "+qt(Lt)+" Pesewa"+(Lt!==1?"s":"")),ss}function Jo(Be){const lt=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],ut=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"],yt=["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],It=Math.floor(Be||0),Lt=Math.round(((Be||0)-It)*100);function qt(ms){return ms===0?"Zero":ms<10?lt[ms]:ms<20?yt[ms-10]:ms<100?ut[Math.floor(ms/10)]+(ms%10!==0?" "+lt[ms%10]:""):ms<1e3?lt[Math.floor(ms/100)]+" Hundred"+(ms%100!==0?" "+qt(ms%100):""):ms<1e6?qt(Math.floor(ms/1e3))+" Thousand"+(ms%1e3!==0?" "+qt(ms%1e3):""):qt(Math.floor(ms/1e6))+" Million"+(ms%1e6!==0?" "+qt(ms%1e6):"")}const ss=qt(It),$t=String(Lt).padStart(2,"0");return Lt>0?`${ss} and ${$t}/100`:`${ss}`}const Il=f.useMemo(()=>["Cheque","Bank Transfer","Credit Card"].includes(J.paymentMethod||""),[J.paymentMethod]),xn=f.useMemo(()=>{const Be=g.find(lt=>String(lt.id)===String(J.depositAccountId||""));return(Be==null?void 0:Be.currency_code)||""},[g,J.depositAccountId]),Pc=f.useMemo(()=>{const Be=g.find(lt=>String(lt.id)===String(J.payerAccountId||""));return(Be==null?void 0:Be.currency_code)||""},[g,J.payerAccountId]),uo=f.useMemo(()=>{const Be=g.find(lt=>String(lt.id)===String(J.payerAccountId||""));return(Be==null?void 0:Be.currency_id)||null},[g,J.payerAccountId]),hr=f.useMemo(()=>{const Be=g.find(lt=>String(lt.id)===String(J.depositAccountId||""));return(Be==null?void 0:Be.currency_id)||null},[g,J.depositAccountId]),Ll=f.useMemo(()=>{const Be=g.find(lt=>String(lt.id)===String(Se.toAccountId||""));return(Be==null?void 0:Be.currency_code)||""},[g,Se.toAccountId]),Zo=f.useMemo(()=>{const Be=g.find(lt=>String(lt.id)===String(Se.fromAccountId||""));return(Be==null?void 0:Be.currency_code)||""},[g,Se.fromAccountId]),ec=f.useMemo(()=>{const Be=g.find(lt=>String(lt.id)===String(Se.fromAccountId||""));return(Be==null?void 0:Be.currency_id)||null},[g,Se.fromAccountId]),Uc=f.useMemo(()=>{const Be=g.find(lt=>String(lt.id)===String(Se.toAccountId||""));return(Be==null?void 0:Be.currency_id)||null},[g,Se.toAccountId]),ki=f.useMemo(()=>{const Be=new Set(["BANK ACCOUNTS","CASH AND CASH EQUIVALENTS"]);return(g||[]).filter(lt=>Be.has(String(lt.group_name||"").trim().toUpperCase()))},[g]),mo=f.useMemo(()=>{const Be=g.find(qt=>String(qt.id)===String(Se.fromAccountId||"")),lt=g.find(qt=>String(qt.id)===String(Se.toAccountId||"")),ut=String((Be==null?void 0:Be.group_code)||"").toUpperCase(),yt=String((Be==null?void 0:Be.group_name)||"").toUpperCase(),It=String((lt==null?void 0:lt.group_code)||"").toUpperCase(),Lt=String((lt==null?void 0:lt.group_name)||"").toUpperCase();return ut==="AST_BANK"||yt==="BANK ACCOUNTS"||It==="AST_BANK"||Lt==="BANK ACCOUNTS"},[g,Se.fromAccountId,Se.toAccountId]),Dl=f.useMemo(()=>{const Be=hr;let lt=jt.find(ut=>String(ut.id)===String(Be));return!lt&&xn&&(lt=jt.find(ut=>String(ut.code)===String(xn))),lt?String(lt.name||""):""},[jt,hr,xn]),Wi=f.useMemo(()=>["Cheque","Bank Transfer","Credit Card"].includes(se.paymentMethod||""),[se.paymentMethod]),Ir=f.useMemo(()=>{const Be=g.find(lt=>String(lt.id)===String(se.paymentAccountId||""));return(Be==null?void 0:Be.currency_code)||""},[g,se.paymentAccountId]),Yn=f.useMemo(()=>{const Be=g.find(lt=>String(lt.id)===String(se.payToAccountId||""));return(Be==null?void 0:Be.currency_code)||""},[g,se.payToAccountId]),Xn=f.useMemo(()=>{const Be=g.find(lt=>String(lt.id)===String(se.payToAccountId||""));return(Be==null?void 0:Be.currency_id)||null},[g,se.payToAccountId]),Os=f.useMemo(()=>{const Be=g.find(lt=>String(lt.id)===String(se.paymentAccountId||""));return(Be==null?void 0:Be.currency_id)||null},[g,se.paymentAccountId]),ho=f.useMemo(()=>{const Be=Os,lt=jt.find(ut=>String(ut.id)===String(Be));return String(lt?lt.name||lt.code||"":Ir||"")},[jt,Os,Ir]),Gi=f.useMemo(()=>{const Be=c.find(lt=>String(lt.code).toUpperCase()===String(t).toUpperCase());return(Be==null?void 0:Be.name)||"Payment Voucher"},[c,t]),Ki=f.useMemo(()=>{const Be=c.find(lt=>String(lt.code).toUpperCase()===String(t).toUpperCase());return(Be==null?void 0:Be.name)||"Receive Voucher"},[c,t]);if(f.useEffect(()=>{if(!B)return;const Be=ec||null,lt=Uc||null,ut=Zo||"",yt=Ll||"";if(!Be||!lt){le("");return}if(ut&&yt&&ut===yt){le("1");return}(async()=>{var It;try{const Lt=await Z.get("/finance/currency-rates",{params:{fromCurrencyId:Number(Be),toCurrencyId:Number(lt),to:H||null}}),ss=(Array.isArray((It=Lt.data)==null?void 0:It.items)?Lt.data.items:[]).slice().sort((ms,Ns)=>new Date(Ns.rate_date).getTime()-new Date(ms.rate_date).getTime()),$t=ss.length?Number(ss[0].rate||0):0;le($t?String($t):"")}catch{le("")}})()},[B,ec,Uc,Zo,Ll,H]),C)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:s}),e.jsx("p",{className:"text-sm mt-1",children:"Record incoming payments"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"..",className:"btn-success",children:"Back"}),at==="APPROVED"?e.jsx("span",{className:"px-2 py-1 rounded bg-green-500 text-white text-sm font-medium",children:"Approved"}):e.jsx("button",{type:"button",className:"btn-success",onClick:async()=>{var Be,lt,ut,yt;if(o&&(Fe(!0),ye(""),!mt))try{Je(!0);const It=await Z.get("/workflows"),Lt=Array.isArray((Be=It.data)==null?void 0:Be.items)?It.data.items:[];it(Lt);const qt=(bt==null?void 0:bt.grand)===""||(bt==null?void 0:bt.grand)==null?null:Number((bt==null?void 0:bt.grand)||0);let ss=null;const $t=Lt.filter(rs=>String(rs.document_route||"")==="/finance/contra-voucher"),ms=Lt.filter(rs=>["CONTRA_VOUCHER","Contra Voucher","CV"].includes(String(rs.document_type||""))),Ns=[...$t,...ms];for(const rs of Ns){if(ss)break;if(Number(rs.is_active)!==1)continue;if(qt===null){ss=rs;break}const ns=rs.min_amount===null||Number(qt)>=Number(rs.min_amount),os=rs.max_amount===null||Number(qt)<=Number(rs.max_amount);if(ns&&os){ss=rs;break}}if(!ss)for(const rs of ms){if(ss)break;if(Number(rs.is_active)!==1)continue;if(qt===null){ss=rs;break}const ns=rs.min_amount===null||Number(qt)>=Number(rs.min_amount),os=rs.max_amount===null||Number(qt)<=Number(rs.max_amount);if(ns&&os){ss=rs;break}}if(be(ss),dt(null),ft(null),ss){const rs=await Z.get(`/workflows/${ss.id}`),ns=((lt=rs==null?void 0:rs.data)==null?void 0:lt.item)||{},os=Number(ns.current_step_order||1),fs=Array.isArray(ns==null?void 0:ns.next_step_approvers)?ns.next_step_approvers:[],or=fs.length>0?Number(fs[0].id):null;dt({stepOrder:os||1,stepName:String(ns.step_name||"Step 1"),approvalLimit:fs.length>0?Number(fs[0].approval_limit||0):null,approvers:fs}),ft(or)}}catch(It){ye(((yt=(ut=It==null?void 0:It.response)==null?void 0:ut.data)==null?void 0:yt.message)||"Failed to load workflows")}finally{Je(!1)}},disabled:d||!o,children:"Forward for Approval"})]})]})})}),e.jsx("form",{onSubmit:va,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[!(k||C)&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher Type"}),e.jsx("input",{className:"input",value:Ki,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher No"}),e.jsx("input",{className:"input",value:T||"RV-000001",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher Date *"}),e.jsx("input",{className:`input ${Gt}`,type:"date",value:H,onChange:Be=>M(Be.target.value),required:!0,disabled:l})]}),!(k||C)&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Fiscal Year *"}),e.jsxs("select",{className:`input ${Gt}`,value:Q,onChange:Be=>L(Be.target.value),required:!0,disabled:l,children:[e.jsx("option",{value:"",children:"Select"}),m.map(Be=>e.jsx("option",{value:Be.id,children:Be.code},Be.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Received From"}),e.jsxs("select",{className:`input ${Gt}`,value:J.receivedFromCode||"",onChange:Be=>{const lt=Be.target.value,ut=j.find(Ns=>String(Ns.code)===String(lt)),yt=(ut==null?void 0:ut.name)||"",It=g.find(Ns=>String(Ns.code)===String(lt)),Lt=String((ut==null?void 0:ut.type)||"").toUpperCase()==="CUSTOMER",qt=String((ut==null?void 0:ut.type)||"").toUpperCase()==="SUPPLIER",ss=g.find(Ns=>{const rs=String(Ns.group_name||"").toUpperCase(),ns=Lt?"DEBTORS":qt?"CREDITORS":"";if(ns&&rs!==ns)return!1;const os=String(Ns.name||"").trim().toLowerCase(),fs=String(yt||"").trim().toLowerCase();return os===fs||os.includes(fs)||fs.includes(os)}),$t=It||ss||null,ms=$t!=null&&$t.id?String($t.id):"";Lt&&(ut!=null&&ut.id)?Ve(ut.id):F([]),en({receivedFrom:yt,receivedFromCode:lt,payerAccountId:ms,items:J.items.length===0?[{description:"",accountId:ms,amount:"",referenceNo:""}]:J.items.map((Ns,rs)=>rs===0?{...Ns,accountId:ms}:Ns)})},disabled:l,children:[e.jsx("option",{value:"",children:"Select customer or supplier"}),j.map(Be=>e.jsx("option",{value:Be.code,children:Be.name},Be.code))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Payment Method"}),e.jsxs("select",{className:`input ${Gt}`,value:J.paymentMethod,onChange:Be=>en({paymentMethod:Be.target.value}),disabled:l,children:[e.jsx("option",{children:"Cash"}),e.jsx("option",{children:"Cheque"}),e.jsx("option",{children:"Bank Transfer"}),e.jsx("option",{children:"Credit Card"}),e.jsx("option",{children:"Mobile Money"})]})]}),Il?e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Reference / Cheque No"}),e.jsx("input",{className:`input ${Gt}`,value:J.reference,onChange:Be=>en({reference:Be.target.value}),placeholder:"Reference Number or Cheque Number",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Cheque Date"}),e.jsx("input",{className:`input ${Gt}`,type:"date",value:J.chequeDate||"",onChange:Be=>en({chequeDate:Be.target.value}),disabled:l})]})]})}):null]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"label",children:"Deposit Account *"}),e.jsx("span",{className:"text-xs text-slate-500",children:xn||""})]}),e.jsxs("select",{className:`input ${Gt}`,value:J.depositAccountId,onChange:Be=>en({depositAccountId:Be.target.value}),required:!0,disabled:l,children:[e.jsx("option",{value:"",children:"Select account"}),g.filter(Be=>{const lt=String(Be.group_code||"").toUpperCase(),ut=String(Be.group_name||"").toUpperCase();return Il?lt==="AST_BANK"||ut==="BANK ACCOUNTS":lt==="AST_CASH"||ut==="CASH AND CASH EQUIVALENTS"}).map(Be=>e.jsxs("option",{value:Be.id,children:[Be.code," - ",Be.name]},Be.id))]})]}),e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsx("input",{className:"input bg-blue-50 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700 font-semibold",value:xn||"",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Exchange Rate"}),e.jsx("input",{className:"input bg-blue-50 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700 font-semibold",value:Ze||"",readOnly:!0})]})]})})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:[O||G?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Exchange Rate"}),e.jsx("input",{className:"input",value:Ne||"",readOnly:!0})]})}):null,e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("div",{className:"font-semibold text-slate-800 dark:text-slate-200",children:"Payment Details"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-10",children:"#"}),e.jsx("th",{children:"Description"}),e.jsx("th",{className:"w-64",children:"Account"}),e.jsx("th",{className:"w-64",children:"Bill"}),e.jsx("th",{className:"text-right w-32",children:"Currency"}),e.jsx("th",{className:"text-right w-40",children:"Amount"}),e.jsx("th",{className:"w-24"})]})}),e.jsx("tbody",{children:J.items.length===0?e.jsx("tr",{children:e.jsx("td",{className:"text-center p-2",colSpan:7,children:"No items"})}):J.items.map((Be,lt)=>e.jsxs("tr",{children:[e.jsx("td",{children:lt+1}),e.jsx("td",{children:e.jsx("input",{className:`input ${Gt}`,value:Be.description,onChange:ut=>Pa(lt,{description:ut.target.value}),placeholder:"Description",disabled:l})}),e.jsx("td",{children:e.jsxs("select",{className:`input bg-blue-50 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700 font-semibold ${Gt}`,value:Be.accountId,onChange:ut=>{const yt=ut.target.value;if(Pa(lt,{accountId:yt}),lt===0){const It=g.find($t=>String($t.id)===String(yt)),Lt=It!=null&&It.code?String(It.code):"",qt=j.find($t=>String($t.code)===String(Lt)),ss=(qt==null?void 0:qt.name)||"";en({receivedFrom:ss,receivedFromCode:Lt,payerAccountId:String(yt||"")})}},required:!0,disabled:l,children:[e.jsx("option",{value:"",children:"Select account"}),g.map(ut=>e.jsx("option",{value:ut.id,children:ut.name},ut.id))]})}),e.jsx("td",{children:_.length>0?lt===0?e.jsx("select",{multiple:!0,className:`input ${Gt}`,value:R,onChange:ut=>{const yt=Array.from(ut.target.selectedOptions).map(ss=>ss.value);U(yt);const It=_.filter(ss=>yt.includes(String(ss.invoice_no))),Lt=It.length>0?It.map(ss=>({description:"",accountId:J.payerAccountId||"",amount:Number(ss.balance_amount||0),referenceNo:String(ss.invoice_no)})):[{description:"",accountId:J.payerAccountId||"",amount:0,referenceNo:""}],qt=It.length>0&&It[0].tax_code_id||null;en({items:Lt,...qt?{taxCodeId:String(qt)}:{}})},size:Math.min(6,Math.max(3,_.length)),disabled:l,children:_.map(ut=>e.jsxs("option",{value:ut.invoice_no,children:[ut.invoice_no,"  Outstanding"," ",Number(ut.balance_amount||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]},ut.id))}):e.jsx("div",{className:"text-slate-500 dark:text-slate-400 text-sm",children:"Select invoices using first row"}):e.jsx("div",{className:"text-slate-500 dark:text-slate-400 text-sm",children:"No outstanding invoices for selected customer"})}),e.jsx("td",{className:"text-right",children:Pc||""}),e.jsx("td",{children:e.jsx("input",{className:`input text-right ${Gt}`,type:"number",min:"0",step:"1",value:Be.amount||"",onChange:ut=>Pa(lt,{amount:Number(ut.target.value||0)}),onFocus:()=>{Number(Be.amount||0)===0&&Pa(lt,{amount:""})},disabled:l})}),e.jsx("td",{children:e.jsx("div",{})})]},lt))})]})}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{className:"font-semibold",children:Number(bt.subtotal||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Tax Code"}),e.jsxs("select",{className:`input w-36 ${Gt}`,value:J.taxCodeId,onChange:Be=>en({taxCodeId:Be.target.value}),disabled:l,children:[e.jsx("option",{value:"",children:"Select"}),b.map(Be=>e.jsx("option",{value:Be.id,children:Be.name},Be.id))]})]}),e.jsx("span",{className:"font-semibold",children:Number(Hs.taxTotal||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]}),Hs.components.map(Be=>e.jsxs("div",{className:"flex justify-between text-sm text-slate-700",children:[e.jsxs("span",{children:[Be.name," [",Be.rate,"%]"]}),e.jsx("span",{children:Number(Be.amount||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]},Be.name))]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"font-semibold",children:"TOTAL AMOUNT"}),e.jsx("span",{className:"font-bold",children:Number(Hs.grand||bt.grand||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Amount in Words"}),e.jsx("textarea",{className:"input h-20",value:`${Jo(Number(Hs.grand||bt.grand||0))} ${Dl}`.trim(),readOnly:!0})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes / Remarks"}),e.jsx("textarea",{className:"input h-24",value:J.notes,onChange:Be=>en({notes:Be.target.value}),placeholder:"Additional notes or comments"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:fl,children:"Print Voucher"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:Za,children:"Download PDF"}),e.jsx(Re,{to:"..",className:"btn-success",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-success",disabled:d||l||!Jt||!J.depositAccountId||Number(bt.grand||0)<=0,children:d?"Saving...":"Save Voucher"})]})]})})}),_e?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-[640px] max-w-[95%]",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-brand text-white rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Forward Contra Voucher for Approval"}),e.jsx("button",{type:"button",onClick:()=>{Fe(!1),be(null),dt(null),ye("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Document No:"," ",e.jsx("span",{className:"font-semibold",children:T||"-"})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:Ae?Ae.workflow_name:"Auto"})]}),e.jsx("div",{className:"text-sm text-red-600",children:xe||""}),e.jsx("div",{children:Ke?e.jsx("div",{className:"text-slate-600",children:"Loading workflows..."}):Ee&&Array.isArray(Ee.approvers)?e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Assign To"}),e.jsxs("select",{className:"input",value:ht||"",onChange:Be=>ft(Be.target.value||null),children:[e.jsx("option",{value:"",children:"Select approver"}),Ee.approvers.map(Be=>e.jsx("option",{value:Be.id,children:Be.username},Be.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:Ee?`Step ${Ee.stepOrder}  ${Ee.stepName}${Ee.approvalLimit!=null?`  Limit: ${Number(Ee.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:Ae?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{Fe(!1),be(null),dt(null),ye("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:async()=>{var Be,lt,ut;if(o){Ge(!0),ye("");try{const yt=await Z.post(`/finance/vouchers/${a}/submit`,{amount:(bt==null?void 0:bt.grand)===""||(bt==null?void 0:bt.grand)==null?null:Number((bt==null?void 0:bt.grand)||0),workflow_id:Ae?Ae.id:null,target_user_id:ht||null}),It=((Be=yt==null?void 0:yt.data)==null?void 0:Be.status)||"PENDING_APPROVAL";je(It),Fe(!1)}catch(yt){ye(((ut=(lt=yt==null?void 0:yt.response)==null?void 0:lt.data)==null?void 0:ut.message)||"Failed to forward for approval")}finally{Ge(!1)}}},disabled:Rt||!o,children:Rt?"Forwarding...":"Forward"})]})]})}):null]});function Ua(Be){l||ae(lt=>({...lt,...Be}))}function Jn(Be,lt){if(l)return;const ut=se.items.map((It,Lt)=>Lt===Be?{...It,...lt}:It),yt=ut[Be];if(Object.prototype.hasOwnProperty.call(lt,"amount")&&(!yt.referenceNo||String(yt.referenceNo).trim()==="")){const It=new Set(ut.map(qt=>String(qt.referenceNo||"")).filter(qt=>qt&&qt.length>0)),Lt=E.find(qt=>!It.has(String(qt)))||E[0]||null;Lt&&(ut[Be]={...yt,referenceNo:String(Lt)})}Ua({items:ut})}const[Ao,fo]=f.useState(0);function tc(Be,lt){if(l)return;const ut=se.items.findIndex(yt=>String(yt.referenceNo||"")===String(Be||""));ut>=0?Jn(ut,{amount:Number(lt||0)}):Ua({items:[...se.items,{description:`Bill ${Be} payment`,accountId:se.payToAccountId||"",amount:Number(lt||0),referenceNo:String(Be||"")}]})}function sc(Be){if(l)return;const lt=[...E],ut=I.filter(Lt=>lt.includes(String(Lt.bill_no)));let yt=Number(Be||0);const It=new Map(se.items.map(Lt=>[String(Lt.referenceNo||""),{...Lt}]));for(let Lt=0;Lt<ut.length;Lt++){const qt=ut[Lt],ss=Number((qt==null?void 0:qt.outstanding)||0),$t=Math.max(0,Math.min(ss,yt));yt=Math.max(0,yt-$t),It.set(String(qt.bill_no),{description:`Bill ${qt.bill_no} payment`,accountId:se.payToAccountId||"",amount:$t,referenceNo:String(qt.bill_no)})}Ua({items:Array.from(It.values())})}async function Pu(Be){var lt,ut,yt,It,Lt,qt;if(Be){rt(!0),st(!0),Te(""),he(null),Ye([]);try{const ss=String(Be.id||"");if(ss.startsWith("SB-")){const $t=Number(ss.replace(/^SB-/,""));Pe("SERVICE");const ms=await Z.get(`/purchase/service-bills/${$t}`);he(((lt=ms.data)==null?void 0:lt.item)||null),Ye(((ut=ms.data)==null?void 0:ut.details)||[])}else{const $t=Number(Be.id);Pe("PURCHASE");const ms=await Z.get(`/purchase/bills/${$t}`);he(((yt=ms.data)==null?void 0:yt.item)||null),Ye(((It=ms.data)==null?void 0:It.details)||[])}}catch(ss){Te(((qt=(Lt=ss==null?void 0:ss.response)==null?void 0:Lt.data)==null?void 0:qt.message)||"Failed to load bill details")}finally{st(!1)}}}if(f.useEffect(()=>{if(!k)return;const Be=g.find(Lt=>String(Lt.id)===String(se.paymentAccountId||""));if(!Be)return;const lt=String(Be.group_code||"").toUpperCase(),ut=String(Be.group_name||"").toUpperCase();(Wi?lt==="AST_BANK"||ut==="BANK ACCOUNTS":lt==="AST_CASH"||ut==="CASH AND CASH EQUIVALENTS")||Ua({paymentAccountId:""})},[k,Wi,g,se.paymentAccountId]),f.useEffect(()=>{if(!C)return;const Be=g.find(Lt=>String(Lt.id)===String(J.depositAccountId||""));if(!Be)return;const lt=String(Be.group_code||"").toUpperCase(),ut=String(Be.group_name||"").toUpperCase();(Il?lt==="AST_BANK"||ut==="BANK ACCOUNTS":lt==="AST_CASH"||ut==="CASH AND CASH EQUIVALENTS")||en({depositAccountId:""})},[C,Il,g,J.depositAccountId]),f.useEffect(()=>{if(!k)return;const Be=Xn||null,lt=Os||null,ut=Yn||"",yt=Ir||"";if(!Be||!lt){ue("");return}if(ut&&yt&&ut===yt){ue("1");return}(async()=>{var It;try{const Lt=await Z.get("/finance/currency-rates",{params:{fromCurrencyId:Number(Be),toCurrencyId:Number(lt),to:H||null}}),ss=(Array.isArray((It=Lt.data)==null?void 0:It.items)?Lt.data.items:[]).slice().sort((ms,Ns)=>new Date(Ns.rate_date).getTime()-new Date(ms.rate_date).getTime()),$t=ss.length?Number(ss[0].rate||0):0;ue($t?String($t):"")}catch{ue("")}})()},[k,Xn,Os,Yn,Ir,H]),f.useEffect(()=>{if(!C)return;const Be=uo||null,lt=hr||null,ut=Pc||"",yt=xn||"";if(!Be||!lt){gt("1");return}if(ut&&yt&&ut===yt){gt("1");return}(async()=>{var It,Lt;try{const qt=await Z.get("/finance/currency-rates",{params:{fromCurrencyId:Number(Be),toCurrencyId:Number(lt),to:H||null}}),$t=(Array.isArray((It=qt.data)==null?void 0:It.items)?qt.data.items:[]).slice().sort((Ns,rs)=>new Date(rs.rate_date).getTime()-new Date(Ns.rate_date).getTime());let ms=$t.length?Number($t[0].rate||0):0;if(!ms)try{const Ns=await Z.get("/finance/currency-rates",{params:{fromCurrencyId:Number(lt),toCurrencyId:Number(Be),to:H||null}}),ns=(Array.isArray((Lt=Ns.data)==null?void 0:Lt.items)?Ns.data.items:[]).slice().sort((fs,or)=>new Date(or.rate_date).getTime()-new Date(fs.rate_date).getTime()),os=ns.length?Number(ns[0].rate||0):0;ms=os?1/os:0}catch{}gt(ms?String(ms):"1")}catch{gt("1")}})()},[C,uo,hr,Pc,xn,H]),k)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:s}),e.jsx("p",{className:"text-sm mt-1",children:"Record outgoing payments"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"..",className:"btn-success",children:"Back"}),at==="APPROVED"?e.jsx("span",{className:"px-2 py-1 rounded bg-green-500 text-white text-sm font-medium",children:"Approved"}):e.jsx("button",{type:"button",className:"btn-success",onClick:async()=>{var Be,lt,ut,yt,It;if(o&&(Fe(!0),ye(""),!mt))try{Je(!0);const Lt=await Z.get("/workflows"),qt=Array.isArray((Be=Lt.data)==null?void 0:Be.items)?Lt.data.items:[];it(qt);const ss=(bt==null?void 0:bt.grand)===""||(bt==null?void 0:bt.grand)==null?null:Number((bt==null?void 0:bt.grand)||0);let $t=null;const ms=qt.filter(ns=>String(ns.document_route||"")==="/finance/payment-voucher"),Ns=qt.filter(ns=>["PAYMENT_VOUCHER","Payment Voucher","PV"].includes(String(ns.document_type||""))),rs=[...ms,...Ns];for(const ns of rs){if($t)break;if(Number(ns.is_active)!==1)continue;if(ss===null){$t=ns;break}const os=ns.min_amount===null||Number(ss)>=Number(ns.min_amount),fs=ns.max_amount===null||Number(ss)<=Number(ns.max_amount);if(os&&fs){$t=ns;break}}if(!$t)for(const ns of Ns){if($t)break;if(Number(ns.is_active)!==1)continue;if(ss===null){$t=ns;break}const os=ns.min_amount===null||Number(ss)>=Number(ns.min_amount),fs=ns.max_amount===null||Number(ss)<=Number(ns.max_amount);if(os&&fs){$t=ns;break}}if(be($t),dt(null),ft(null),$t){const ns=await Z.get(`/workflows/${$t.id}`),os=((lt=ns==null?void 0:ns.data)==null?void 0:lt.item)||{},fs=Number(os.current_step_order||1),or=Array.isArray(os==null?void 0:os.next_step_approvers)?os.next_step_approvers:[],cn=await Z.get(`/workflows/${$t.id}`),aa=Array.isArray((ut=cn==null?void 0:cn.data)!=null&&ut.item?[cn.data.item]:[])?[]:[],pr=fs||1,na=or.length>0?Number(or[0].id):null;dt({stepOrder:pr,stepName:String(os.step_name||"Step 1"),approvalLimit:or.length>0?Number(or[0].approval_limit||0):null,approvers:or}),ft(na)}}catch(Lt){ye(((It=(yt=Lt==null?void 0:Lt.response)==null?void 0:yt.data)==null?void 0:It.message)||"Failed to load workflows")}finally{Je(!1)}},disabled:d||!o,children:"Forward for Approval"})]})]})})}),e.jsx("form",{onSubmit:va,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[!(k||C)&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher Type"}),e.jsx("input",{className:"input",value:Gi,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher No"}),e.jsx("input",{className:"input",value:T||"PV-000000",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher Date *"}),e.jsx("input",{className:"input",type:"date",value:H,onChange:Be=>M(Be.target.value),required:!0,disabled:l})]}),!(k||C)&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Fiscal Year *"}),e.jsxs("select",{className:"input",value:Q,onChange:Be=>L(Be.target.value),required:!0,disabled:l,children:[e.jsx("option",{value:"",children:"Select"}),m.map(Be=>e.jsx("option",{value:Be.id,children:Be.code},Be.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Paid To"}),e.jsxs("select",{className:`input ${Gt}`,value:se.payToCode||"",onChange:Be=>{const lt=Be.target.value,ut=j.find(ss=>String(ss.code)===String(lt)),yt=(ut==null?void 0:ut.name)||"",It=g.find(ss=>String(ss.code)===String(lt)),Lt=It!=null&&It.id?String(It.id):"",qt=se.items.length===0?[{description:"",accountId:Lt,amount:0}]:se.items.map((ss,$t)=>$t===0?{...ss,accountId:Lt}:ss);Ua({payTo:yt,payToCode:lt,payToAccountId:Lt,items:qt}),String((ut==null?void 0:ut.type)||"").toUpperCase()==="SUPPLIER"&&(ut!=null&&ut.id)?vt(ut):(w([]),W([]))},disabled:l,children:[e.jsx("option",{value:"",children:"Select customer or supplier"}),j.map(Be=>e.jsx("option",{value:Be.code,children:Be.name},Be.code))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Payment Method"}),e.jsxs("select",{className:`input ${Gt}`,value:se.paymentMethod,onChange:Be=>Ua({paymentMethod:Be.target.value}),children:[e.jsx("option",{children:"Cash"}),e.jsx("option",{children:"Cheque"}),e.jsx("option",{children:"Bank Transfer"}),e.jsx("option",{children:"Credit Card"}),e.jsx("option",{children:"Mobile Money"})]})]}),Wi?e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Reference / Cheque No"}),e.jsx("input",{className:`input ${Gt}`,value:se.reference,onChange:Be=>Ua({reference:Be.target.value}),placeholder:"Reference Number or Cheque Number",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Cheque Date"}),e.jsx("input",{className:`input ${Gt}`,type:"date",value:se.chequeDate||"",onChange:Be=>Ua({chequeDate:Be.target.value}),disabled:l})]})]})}):null]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Payment Account *"}),e.jsxs("select",{className:`input ${Gt}`,value:se.paymentAccountId,onChange:Be=>Ua({paymentAccountId:Be.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select account"}),g.filter(Be=>{const lt=String(Be.group_code||"").toUpperCase(),ut=String(Be.group_name||"").toUpperCase();return Wi?lt==="AST_BANK"||ut==="BANK ACCOUNTS":lt==="AST_CASH"||ut==="CASH AND CASH EQUIVALENTS"}).map(Be=>e.jsxs("option",{value:Be.id,children:[Be.code," - ",Be.name]},Be.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Outstanding Bills"}),I.length>0?e.jsx("select",{multiple:!0,className:`input ${Gt}`,value:E,onChange:Be=>{const lt=Array.from(Be.target.selectedOptions).map(Lt=>Lt.value);W(lt);const ut=I.filter(Lt=>lt.includes(String(Lt.bill_no))),yt=ut.reduce((Lt,qt)=>Lt+Number(qt.outstanding||0),0);fo(yt);const It=ut.map(Lt=>({description:`Bill ${Lt.bill_no} payment`,accountId:se.payToAccountId||"",amount:Number(Lt.outstanding||0),referenceNo:String(Lt.bill_no)}));Ua({items:It.length>0?It:[{description:"",accountId:se.payToAccountId||"",amount:0,referenceNo:""}]}),sc(yt)},onDoubleClick:Be=>{var It,Lt;if(l)return;const lt=Be.target.selectedIndex;if(lt==null||lt<0)return;const ut=(Lt=(It=Be.target.options)==null?void 0:It[lt])==null?void 0:Lt.value,yt=I.find(qt=>String(qt.bill_no)===String(ut));yt&&Pu(yt)},size:Math.min(10,Math.max(3,I.length)),disabled:l,children:I.map(Be=>e.jsxs("option",{value:Be.bill_no,children:[Be.bill_no,"  ",Be.payment_status,"  Outstanding"," ",Number(Be.outstanding||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]},Be.id))}):e.jsx("div",{className:"input bg-gray-100 text-gray-500",children:"No bills for selected supplier"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsx("input",{className:"input bg-blue-50 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700 font-semibold",value:Ir||"",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Exchange Rate"}),e.jsx("input",{className:"input bg-blue-50 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700 font-semibold",value:ne||"",readOnly:!0})]})]}),e.jsx("div",{})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("div",{className:"font-semibold text-slate-800 dark:text-slate-200",children:"Payment Details"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-10",children:"#"}),e.jsx("th",{children:"Description"}),e.jsx("th",{className:"w-64",children:"Account"}),e.jsx("th",{className:"text-right w-32",children:"Currency"}),e.jsx("th",{className:"text-right w-40",children:"Amount"})]})}),e.jsx("tbody",{children:se.items.length===0?e.jsx("tr",{children:e.jsx("td",{className:"text-center p-2",colSpan:5,children:"No items"})}):se.items.map((Be,lt)=>e.jsxs("tr",{children:[e.jsx("td",{children:lt+1}),e.jsx("td",{children:e.jsx("input",{className:`input ${Gt}`,value:Be.description,onChange:ut=>Jn(lt,{description:ut.target.value}),placeholder:"Description"})}),e.jsx("td",{children:e.jsxs("select",{className:`input bg-blue-50 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700 font-semibold ${Gt}`,value:Be.accountId,onChange:ut=>Jn(lt,{accountId:ut.target.value}),required:!0,disabled:l,children:[e.jsx("option",{value:"",children:"Select account"}),g.map(ut=>e.jsx("option",{value:ut.id,children:ut.name},ut.id))]})}),e.jsx("td",{className:"text-right",children:Yn||""}),e.jsx("td",{children:e.jsx("input",{className:`input text-right ${Gt}`,type:"number",min:"0",step:"1",value:Be.amount||"",onChange:ut=>Jn(lt,{amount:Number(ut.target.value||0)}),onFocus:()=>{Number(Be.amount||0)===0&&Jn(lt,{amount:""})},disabled:l})})]},lt))})]})}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{className:"font-semibold",children:Number(bt.subtotal||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Tax (",Number(((gn=b.find(Be=>String(Be.id)===String(se.taxCodeId)))==null?void 0:gn.rate_percent)||0),"%)"]}),e.jsxs("select",{className:"input w-36",value:se.taxCodeId,onChange:Be=>Ua({taxCodeId:Be.target.value}),children:[e.jsx("option",{value:"",children:"Select"}),b.map(Be=>e.jsx("option",{value:Be.id,children:Be.name},Be.id))]})]}),e.jsx("span",{className:"font-semibold",children:Number(bt.tax||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"font-semibold",children:"TOTAL AMOUNT"}),e.jsx("span",{className:"font-bold",children:Number(bt.grand||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Amount in Words"}),e.jsx("textarea",{className:"input h-20",value:`${Jo(Number(bt.grand||0))} ${ho}`.trim(),readOnly:!0})]})})]})]}),E.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Knock Off Payment Against Bills"}),e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx("label",{className:"label mb-0",children:"Total to Allocate"}),e.jsx("input",{type:"number",className:`input w-40 text-right ${Gt}`,min:"0",step:"0.01",value:Number(Ao||0),onChange:Be=>{const lt=Number(Be.target.value||0);fo(lt),sc(lt)},disabled:l}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{let Be=E.reduce((lt,ut)=>{const yt=se.items.find(It=>String(It.referenceNo||"")===String(ut));return lt+Number((yt==null?void 0:yt.amount)||0)},0);Be<=0&&(sc(Ao),Be=E.reduce((lt,ut)=>{const yt=se.items.find(It=>String(It.referenceNo||"")===String(ut));return lt+Number((yt==null?void 0:yt.amount)||0)},0)),ct.success(`Knock-off confirmed. Allocated GH ${Be.toFixed(2)} (FIFO applied)`)},disabled:l,children:"Confirm Knock-off"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-32",children:"Bill No"}),e.jsx("th",{className:"text-right w-40",children:"Outstanding"}),e.jsx("th",{className:"text-right w-40",children:"Knock-off Amount"}),e.jsx("th",{className:"text-right w-40",children:"Balance After Knock-off"})]})}),e.jsx("tbody",{children:E.map(Be=>{const lt=I.find(Lt=>String(Lt.bill_no)===String(Be)),ut=Number((lt==null?void 0:lt.outstanding)||0),yt=se.items.find(Lt=>String(Lt.referenceNo||"")===String(Be))||{amount:0},It=Math.max(0,ut-Number(yt.amount||0));return e.jsxs("tr",{children:[e.jsx("td",{children:String(Be)}),e.jsx("td",{className:"text-right",children:ut.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{children:e.jsx("input",{className:`input text-right ${Gt}`,type:"number",min:"0",step:"0.01",value:Number(yt.amount||0),onChange:Lt=>tc(Be,Number(Lt.target.value||0)),disabled:l})}),e.jsx("td",{className:"text-right",children:It.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]},`knock-${Be}`)})})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes / Remarks"}),e.jsx("textarea",{className:`input h-24 ${Gt}`,value:se.notes,onChange:Be=>Ua({notes:Be.target.value}),placeholder:"Additional notes or comments"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:fl,children:"Print Voucher"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:Za,children:"Download PDF"}),e.jsx(Re,{to:"..",className:"btn-success",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-success",disabled:d||l||!Jt||!se.paymentAccountId||Number(bt.grand||0)<=0,children:d?"Saving...":"Save Voucher"})]})]})})}),Le?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-[800px] max-w-[95%]",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-brand text-white rounded-t-lg",children:[e.jsxs("div",{className:"font-semibold",children:[Ce==="SERVICE"?"Service Bill":"Purchase Bill"," ","Details"]}),e.jsx("button",{type:"button",className:"text-white text-xl font-bold",onClick:()=>rt(!1),children:""})]}),e.jsx("div",{className:"p-4",children:He?e.jsx("div",{className:"text-center py-6",children:"Loading..."}):De?e.jsx("div",{className:"text-center text-red-600 py-6",children:De}):fe?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Bill No"}),e.jsx("div",{className:"input",children:fe.bill_no})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Date"}),e.jsx("div",{className:"input",children:fe.bill_date||""})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Status"}),e.jsx("div",{className:"input",children:fe.status||""})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Amount"}),e.jsx("div",{className:"input",children:Number(fe.total_amount||fe.net_amount||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{className:"text-right w-32",children:"Qty"}),e.jsx("th",{className:"text-right w-32",children:"Price"}),e.jsx("th",{className:"text-right w-40",children:"Amount"})]})}),e.jsx("tbody",{children:Ue.length===0?e.jsx("tr",{children:e.jsx("td",{className:"text-center text-slate-500",colSpan:4,children:"No details"})}):Ue.map(Be=>e.jsxs("tr",{children:[e.jsxs("td",{children:[Be.item_name||Be.description||""," ",e.jsx("span",{className:"text-xs text-slate-500",children:Be.item_code||Be.category||""})]}),e.jsx("td",{className:"text-right",children:Number(Be.qty||Be.quantity||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{className:"text-right",children:Number(Be.unit_price||Be.rate||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{className:"text-right",children:Number(Be.line_total||Be.amount||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]},Be.id))})]})})]}):e.jsx("div",{className:"text-center text-slate-500 py-6",children:"No data"})}),e.jsx("div",{className:"p-3 border-t flex justify-end",children:e.jsx("button",{type:"button",className:"btn-success",onClick:()=>rt(!1),children:"Close"})})]})}):null,_e?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-[640px] max-w-[95%]",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-brand text-white rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Forward Payment Voucher for Approval"}),e.jsx("button",{type:"button",onClick:()=>{Fe(!1),be(null),dt(null),ye("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Document No:"," ",e.jsx("span",{className:"font-semibold",children:T||"-"})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:Ae?Ae.workflow_name:"Auto"})]}),e.jsx("div",{className:"text-sm text-red-600",children:xe||""}),e.jsx("div",{children:Ke?e.jsx("div",{className:"text-slate-600",children:"Loading workflows..."}):Ee&&Array.isArray(Ee.approvers)?e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Assign To"}),e.jsxs("select",{className:"input",value:ht||"",onChange:Be=>ft(Be.target.value||null),children:[e.jsx("option",{value:"",children:"Select approver"}),Ee.approvers.map(Be=>e.jsx("option",{value:Be.id,children:Be.username},Be.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:Ee?`Step ${Ee.stepOrder}  ${Ee.stepName}${Ee.approvalLimit!=null?`  Limit: ${Number(Ee.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:Ae?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{Fe(!1),be(null),dt(null),ye("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:async()=>{var Be,lt,ut;if(o){Ge(!0),ye("");try{const yt=await Z.post(`/finance/vouchers/${a}/submit`,{amount:(bt==null?void 0:bt.grand)===""||(bt==null?void 0:bt.grand)==null?null:Number((bt==null?void 0:bt.grand)||0),workflow_id:Ae?Ae.id:null,target_user_id:ht||null}),It=((Be=yt==null?void 0:yt.data)==null?void 0:Be.status)||"PENDING_APPROVAL";je(It),Fe(!1)}catch(yt){ye(((ut=(lt=yt==null?void 0:yt.response)==null?void 0:lt.data)==null?void 0:ut.message)||"Failed to forward for approval")}finally{Ge(!1)}}},disabled:Rt||!o,children:Rt?"Forwarding...":"Forward"})]})]})}):null]});function Ra(Be){l||nt(lt=>({...lt,...Be}))}function Dn(Be,lt){l||Ra({items:Se.items.map((ut,yt)=>yt===Be?{...ut,...lt}:ut)})}if(B)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:s}),e.jsx("p",{className:"text-sm mt-1",children:"Transfer funds between accounts"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"..",className:"btn-success",children:"Back"}),e.jsx("button",{type:"button",className:"btn-success",onClick:async()=>{var Be,lt,ut,yt;if(o&&(Fe(!0),ye(""),!mt))try{Je(!0);const It=await Z.get("/workflows"),Lt=Array.isArray((Be=It.data)==null?void 0:Be.items)?It.data.items:[];it(Lt);const qt=(bt==null?void 0:bt.grand)===""||(bt==null?void 0:bt.grand)==null?null:Number((bt==null?void 0:bt.grand)||0);let ss=null;const $t=Lt.filter(rs=>String(rs.document_route||"")==="/finance/contra-voucher"),ms=Lt.filter(rs=>["CONTRA_VOUCHER","Contra Voucher","CV"].includes(String(rs.document_type||""))),Ns=[...$t,...ms];for(const rs of Ns){if(ss)break;if(Number(rs.is_active)!==1)continue;if(qt===null){ss=rs;break}const ns=rs.min_amount===null||Number(qt)>=Number(rs.min_amount),os=rs.max_amount===null||Number(qt)<=Number(rs.max_amount);if(ns&&os){ss=rs;break}}if(!ss)for(const rs of ms){if(ss)break;if(Number(rs.is_active)!==1)continue;if(qt===null){ss=rs;break}const ns=rs.min_amount===null||Number(qt)>=Number(rs.min_amount),os=rs.max_amount===null||Number(qt)<=Number(rs.max_amount);if(ns&&os){ss=rs;break}}if(be(ss),dt(null),ft(null),ss){const rs=await Z.get(`/workflows/${ss.id}`),ns=((lt=rs==null?void 0:rs.data)==null?void 0:lt.item)||{},os=Number(ns.current_step_order||1),fs=Array.isArray(ns==null?void 0:ns.next_step_approvers)?ns.next_step_approvers:[],or=fs.length>0?Number(fs[0].id):null;dt({stepOrder:os||1,stepName:String(ns.step_name||"Step 1"),approvalLimit:fs.length>0?Number(fs[0].approval_limit||0):null,approvers:fs}),ft(or)}}catch(It){ye(((yt=(ut=It==null?void 0:It.response)==null?void 0:ut.data)==null?void 0:yt.message)||"Failed to load workflows")}finally{Je(!1)}},disabled:d||!o,children:"Forward for Approval"})]})]})})}),e.jsx("form",{onSubmit:va,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher Type"}),e.jsx("input",{className:"input",value:"Contra Voucher",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher No"}),e.jsx("input",{className:"input",value:T||"CV-000001",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher Date *"}),e.jsx("input",{className:"input",type:"date",value:H,onChange:Be=>M(Be.target.value),required:!0,disabled:l})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From Account *"}),e.jsxs("select",{className:"input",value:Se.fromAccountId,onChange:Be=>Ra({fromAccountId:Be.target.value}),required:!0,disabled:l,children:[e.jsx("option",{value:"",children:"Select account"}),ki.map(Be=>e.jsx("option",{value:Be.id,children:Be.name},Be.id))]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsx("input",{className:"input bg-blue-50 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700 font-semibold",value:Zo||"",readOnly:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To Account *"}),e.jsxs("select",{className:"input",value:Se.toAccountId,onChange:Be=>Ra({toAccountId:Be.target.value}),required:!0,disabled:l,children:[e.jsx("option",{value:"",children:"Select account"}),ki.map(Be=>e.jsx("option",{value:Be.id,children:Be.name},Be.id))]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsx("input",{className:"input bg-blue-50 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700 font-semibold",value:Ll||"",readOnly:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Transfer Method"}),e.jsxs("select",{className:"input",value:Se.transferMethod,onChange:Be=>Ra({transferMethod:Be.target.value}),disabled:l,children:[e.jsx("option",{children:"Cash"}),e.jsx("option",{children:"Cheque"}),e.jsx("option",{children:"Bank Transfer"})]})]}),mo?e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Reference / Cheque No"}),e.jsx("input",{className:"input",value:Se.reference,onChange:Be=>Ra({reference:Be.target.value}),placeholder:"Reference Number or Cheque Number",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Cheque Date"}),e.jsx("input",{className:"input",type:"date",value:Se.chequeDate||"",onChange:Be=>Ra({chequeDate:Be.target.value}),disabled:l})]})]})}):e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Reference / Instrument No"}),e.jsx("input",{className:"input",value:Se.reference,onChange:Be=>Ra({reference:Be.target.value}),placeholder:"Reference Number",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Exchange Rate"}),e.jsx("input",{className:"input bg-blue-50 text-blue-700 border-blue-300 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700 font-semibold",value:oe||"",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Tax Code"}),e.jsxs("select",{className:"input",value:Se.taxCodeId,onChange:Be=>Ra({taxCodeId:Be.target.value}),disabled:l,children:[e.jsx("option",{value:"",children:"None"}),b.map(Be=>e.jsx("option",{value:Be.id,children:Be.name},Be.id))]})]})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("div",{className:"font-semibold text-slate-800 dark:text-slate-200",children:"Transfer Details"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-10",children:"#"}),e.jsx("th",{className:"w-64",children:"Description"}),e.jsx("th",{className:"text-right w-40",children:"Amount to Transfer"}),e.jsx("th",{className:"w-24 hidden"})]})}),e.jsx("tbody",{children:Se.items.length===0?e.jsx("tr",{children:e.jsx("td",{className:"text-center p-2",colSpan:4,children:"No items"})}):Se.items.map((Be,lt)=>e.jsxs("tr",{children:[e.jsx("td",{children:lt+1}),e.jsx("td",{children:e.jsx("input",{className:"input",value:Be.description,onChange:ut=>Dn(lt,{description:ut.target.value}),placeholder:"Description",disabled:l})}),e.jsx("td",{children:e.jsx("input",{className:"input text-right",type:"number",min:"0",step:"1",value:Be.amount,onChange:ut=>Dn(lt,{amount:Number(ut.target.value||0)}),onFocus:()=>{Number(Be.amount||0)===0&&Dn(lt,{amount:""})},disabled:l})}),e.jsx("td",{className:"hidden"})]},lt))})]})}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{className:"font-semibold",children:Number(bt.subtotal||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:["Tax (",Number(((po=b.find(Be=>String(Be.id)===String(Se.taxCodeId)))==null?void 0:po.rate_percent)||0),"%)"]})}),e.jsx("span",{className:"font-semibold",children:Number(bt.tax||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"font-semibold",children:"TOTAL AMOUNT"}),e.jsx("span",{className:"font-bold",children:Number(bt.grand||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Amount in Words"}),e.jsx("textarea",{className:"input h-20",value:co(Number(bt.grand||0)),readOnly:!0})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes / Remarks"}),e.jsx("textarea",{className:"input h-24",value:Se.notes,onChange:Be=>Ra({notes:Be.target.value}),placeholder:"Additional notes or comments"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:fl,children:"Print Voucher"}),e.jsx(Re,{to:"..",className:"btn-success",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-success",disabled:d||l||!Jt||!Se.fromAccountId||!Se.toAccountId||Number(bt.grand||0)<=0,children:d?"Saving...":"Save Voucher"})]})]})})}),_e?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-[640px] max-w-[95%]",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-brand text-white rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Forward Contra Voucher for Approval"}),e.jsx("button",{type:"button",onClick:()=>{Fe(!1),be(null),dt(null),ye("")},className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-sm text-slate-700",children:["Document No:"," ",e.jsx("span",{className:"font-semibold",children:T||"-"})]}),e.jsxs("div",{className:"text-sm text-slate-700",children:["Workflow:"," ",e.jsx("span",{className:"font-semibold",children:Ae?Ae.workflow_name:"Auto"})]}),e.jsx("div",{className:"text-sm text-red-600",children:xe||""}),e.jsx("div",{children:Ke?e.jsx("div",{className:"text-slate-600",children:"Loading workflows..."}):Ee&&Array.isArray(Ee.approvers)?e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Assign To"}),e.jsxs("select",{className:"input",value:ht||"",onChange:Be=>ft(Be.target.value||null),children:[e.jsx("option",{value:"",children:"Select approver"}),Ee.approvers.map(Be=>e.jsx("option",{value:Be.id,children:Be.username},Be.id))]}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:Ee?`Step ${Ee.stepOrder}  ${Ee.stepName}${Ee.approvalLimit!=null?`  Limit: ${Number(Ee.approvalLimit).toLocaleString()}`:""}`:""})]}):e.jsx("div",{className:"text-slate-600",children:Ae?"No approver found in workflow definition":"No active workflow; default behavior will apply"})})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 bg-gray-50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:()=>{Fe(!1),be(null),dt(null),ye("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-brand text-white rounded hover:bg-brand-700",onClick:async()=>{var Be,lt,ut;if(o){Ge(!0),ye("");try{const yt=await Z.post(`/finance/vouchers/${a}/submit`,{amount:(bt==null?void 0:bt.grand)===""||(bt==null?void 0:bt.grand)==null?null:Number((bt==null?void 0:bt.grand)||0),workflow_id:Ae?Ae.id:null,target_user_id:ht||null}),It=((Be=yt==null?void 0:yt.data)==null?void 0:Be.status)||"PENDING_APPROVAL";je(It),Fe(!1)}catch(yt){ye(((ut=(lt=yt==null?void 0:yt.response)==null?void 0:lt.data)==null?void 0:ut.message)||"Failed to forward for approval")}finally{Ge(!1)}}},disabled:Rt||!o,children:Rt?"Forwarding...":"Forward"})]})]})}):null]})}function pC(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var u,c,h;try{o(!0);const m=await Z.get("/finance/reports/voucher-register",{params:{from:t||null,to:r||null}});i(((u=m.data)==null?void 0:u.items)||[])}catch(m){ct.error(((h=(c=m==null?void 0:m.response)==null?void 0:c.data)==null?void 0:h.message)||"Failed to load report")}finally{o(!1)}}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/finance",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Finance"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Voucher Register"}),e.jsx("p",{className:"text-sm mt-1",children:"Voucher listing report with date filters"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:u=>s(u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:u=>a(u.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=is.json_to_sheet(u),h=is.book_new();is.book_append_sheet(h,c,"VoucherRegister"),yr(h,"voucher-register.xlsx")},disabled:!n.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=new hs("p","mm","a4");let h=15;c.setFontSize(14),c.text("Voucher Register",10,h),h+=8,c.setFontSize(10),c.text("Date",10,h),c.text("Voucher No",45,h),c.text("Type",95,h),c.text("Narration",125,h),c.text("Debit",160,h),c.text("Credit",180,h),c.text("Status",200,h,{align:"right"}),h+=4,c.line(10,h,200,h),h+=5,u.forEach(m=>{h>270&&(c.addPage(),h=15);const p=m.voucher_date?new Date(m.voucher_date).toLocaleDateString():"-",g=String(m.voucher_no||"-"),x=String(m.voucher_type_code||"-"),b=String(m.narration||"-").slice(0,35),y=String(Number(m.total_debit||0).toLocaleString()),j=String(Number(m.total_credit||0).toLocaleString()),N=String(m.status||"-");c.text(p,10,h),c.text(g,45,h),c.text(x,95,h),c.text(b,125,h),c.text(y,160,h),c.text(j,180,h),c.text(N,200,h,{align:"right"}),h+=5}),c.save("voucher-register.pdf")},disabled:!n.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Voucher No"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Narration"}),e.jsx("th",{className:"text-right",children:"Debit"}),e.jsx("th",{className:"text-right",children:"Credit"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:n.map(u=>e.jsxs("tr",{children:[e.jsx("td",{children:new Date(u.voucher_date).toLocaleDateString()}),e.jsx("td",{className:"font-medium",children:u.voucher_no}),e.jsx("td",{children:u.voucher_type_code}),e.jsx("td",{children:u.narration||"-"}),e.jsx("td",{className:"text-right",children:Number(u.total_debit||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(u.total_credit||0).toLocaleString()}),e.jsx("td",{children:u.status})]},u.id))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function hte(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var c,h,m;try{o(!0);const p=await Z.get("/finance/reports/trial-balance",{params:{from:t||null,to:r||null}});i(((c=p.data)==null?void 0:c.items)||[])}catch(p){ct.error(((m=(h=p==null?void 0:p.response)==null?void 0:h.data)==null?void 0:m.message)||"Failed to load trial balance")}finally{o(!1)}}f.useEffect(()=>{d()},[]);const u=n.reduce((c,h)=>(c.opening_debit+=Number(h.opening_debit||0),c.opening_credit+=Number(h.opening_credit||0),c.movement_debit+=Number(h.movement_debit||0),c.movement_credit+=Number(h.movement_credit||0),c.closing_debit+=Number(h.closing_debit||0),c.closing_credit+=Number(h.closing_credit||0),c),{opening_debit:0,opening_credit:0,movement_debit:0,movement_credit:0,closing_debit:0,closing_credit:0});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/finance",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Finance"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Trial Balance"}),e.jsx("p",{className:"text-sm mt-1",children:"Debits and credits by account"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:c=>s(c.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:c=>a(c.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const c=Array.isArray(n)?n:[];if(!c.length)return;const h=is.json_to_sheet(c),m=is.book_new();is.book_append_sheet(m,h,"TrialBalance"),yr(m,"trial-balance.xlsx")},disabled:!n.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const c=Array.isArray(n)?n:[];if(!c.length)return;const h=new hs("p","mm","a4");let m=15;h.setFontSize(14),h.text("Trial Balance",10,m),m+=8,h.setFontSize(10),h.text("Account",10,m),h.text("Op Dr",95,m),h.text("Op Cr",115,m),h.text("Mv Dr",135,m),h.text("Mv Cr",155,m),h.text("Cls Dr",175,m),h.text("Cls Cr",190,m,{align:"right"}),m+=4,h.line(10,m,200,m),m+=5,c.forEach(p=>{m>270&&(h.addPage(),m=15);const g=`${String(p.account_code||"-")} ${String(p.account_name||"").slice(0,40)}`.trim();h.text(g,10,m),h.text(String(Number(p.opening_debit||0).toLocaleString()),95,m),h.text(String(Number(p.opening_credit||0).toLocaleString()),115,m),h.text(String(Number(p.movement_debit||0).toLocaleString()),135,m),h.text(String(Number(p.movement_credit||0).toLocaleString()),155,m),h.text(String(Number(p.closing_debit||0).toLocaleString()),175,m),h.text(String(Number(p.closing_credit||0).toLocaleString()),190,m,{align:"right"}),m+=5}),m+=5,h.setFontSize(11),h.text(`Totals  Op Dr: ${u.opening_debit.toLocaleString()}`,10,m),m+=6,h.text(`Op Cr: ${u.opening_credit.toLocaleString()}`,10,m),m+=6,h.text(`Mv Dr: ${u.movement_debit.toLocaleString()}`,10,m),m+=6,h.text(`Mv Cr: ${u.movement_credit.toLocaleString()}`,10,m),m+=6,h.text(`Cls Dr: ${u.closing_debit.toLocaleString()}`,10,m),m+=6,h.text(`Cls Cr: ${u.closing_credit.toLocaleString()}`,10,m),h.save("trial-balance.pdf")},disabled:!n.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Account"}),e.jsx("th",{className:"text-right",children:"Opening Dr"}),e.jsx("th",{className:"text-right",children:"Opening Cr"}),e.jsx("th",{className:"text-right",children:"Movement Dr"}),e.jsx("th",{className:"text-right",children:"Movement Cr"}),e.jsx("th",{className:"text-right",children:"Closing Dr"}),e.jsx("th",{className:"text-right",children:"Closing Cr"})]})}),e.jsx("tbody",{children:n.map(c=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{className:"font-medium",children:c.account_code}),e.jsx("div",{className:"text-sm",children:c.account_name})]}),e.jsx("td",{className:"text-right",children:Number(c.opening_debit||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(c.opening_credit||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(c.movement_debit||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(c.movement_credit||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(c.closing_debit||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(c.closing_credit||0).toLocaleString()})]},c.account_id))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{className:"font-semibold",children:"Totals"}),e.jsx("td",{className:"text-right font-semibold",children:u.opening_debit.toLocaleString()}),e.jsx("td",{className:"text-right font-semibold",children:u.opening_credit.toLocaleString()}),e.jsx("td",{className:"text-right font-semibold",children:u.movement_debit.toLocaleString()}),e.jsx("td",{className:"text-right font-semibold",children:u.movement_credit.toLocaleString()}),e.jsx("td",{className:"text-right font-semibold",children:u.closing_debit.toLocaleString()}),e.jsx("td",{className:"text-right font-semibold",children:u.closing_credit.toLocaleString()})]})})]})})]})})]})}function Ate(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var u,c,h;try{o(!0);const m=await Z.get("/finance/reports/journals",{params:{from:t||null,to:r||null}});i(((u=m.data)==null?void 0:u.items)||[])}catch(m){ct.error(((h=(c=m==null?void 0:m.response)==null?void 0:c.data)==null?void 0:h.message)||"Failed to load journals")}finally{o(!1)}}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/finance",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Finance"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Journals"}),e.jsx("p",{className:"text-sm mt-1",children:"Journal entries for the selected period"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:u=>s(u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:u=>a(u.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=is.json_to_sheet(u),h=is.book_new();is.book_append_sheet(h,c,"Journals"),yr(h,"journals.xlsx")},disabled:!n.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=new hs("p","mm","a4");let h=15;c.setFontSize(14),c.text("Journals",10,h),h+=8,c.setFontSize(10),c.text("Date",10,h),c.text("Voucher No",45,h),c.text("Line",95,h),c.text("Account",115,h),c.text("Debit",160,h),c.text("Credit",190,h,{align:"right"}),h+=4,c.line(10,h,200,h),h+=5,u.forEach(m=>{h>270&&(c.addPage(),h=15);const p=m.voucher_date?new Date(m.voucher_date).toLocaleDateString():"-",g=String(m.voucher_no||"-"),x=String(m.line_no||"-"),b=`${String(m.account_code||"-")} ${String(m.account_name||"").slice(0,30)}`.trim(),y=String(Number(m.debit||0).toLocaleString()),j=String(Number(m.credit||0).toLocaleString());c.text(p,10,h),c.text(g,45,h),c.text(x,95,h),c.text(b,115,h),c.text(y,160,h),c.text(j,190,h,{align:"right"}),h+=5}),c.save("journals.pdf")},disabled:!n.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Voucher No"}),e.jsx("th",{children:"Line"}),e.jsx("th",{children:"Account"}),e.jsx("th",{children:"Description"}),e.jsx("th",{className:"text-right",children:"Debit"}),e.jsx("th",{className:"text-right",children:"Credit"})]})}),e.jsx("tbody",{children:n.map((u,c)=>e.jsxs("tr",{children:[e.jsx("td",{children:new Date(u.voucher_date).toLocaleDateString()}),e.jsx("td",{className:"font-medium",children:u.voucher_no}),e.jsx("td",{children:u.line_no}),e.jsxs("td",{children:[e.jsx("div",{className:"font-medium",children:u.account_code}),e.jsx("div",{className:"text-sm",children:u.account_name})]}),e.jsx("td",{children:u.description||"-"}),e.jsx("td",{className:"text-right",children:Number(u.debit||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(u.credit||0).toLocaleString()})]},`${u.id}-${c}`))})]})})]})})]})}function fte(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState(""),[l,o]=f.useState([]),[d,u]=f.useState(0),[c,h]=f.useState([]),[m,p]=f.useState(!1);async function g(){var b,y,j,N;try{const _=await Z.get("/finance/accounts",{params:{postable:1,active:1}});o(((b=_.data)==null?void 0:b.items)||[]),!n&&((N=(j=(y=_.data)==null?void 0:y.items)==null?void 0:j[0])!=null&&N.id)&&i(String(_.data.items[0].id))}catch{ct.error("Failed to load accounts")}}async function x(){var b,y,j,N;if(n)try{p(!0);const _=await Z.get("/finance/reports/general-ledger",{params:{accountId:n,from:t||null,to:r||null}});u(Number(((b=_.data)==null?void 0:b.opening_balance)||0)),h(((y=_.data)==null?void 0:y.items)||[])}catch(_){ct.error(((N=(j=_==null?void 0:_.response)==null?void 0:j.data)==null?void 0:N.message)||"Failed to load general ledger")}finally{p(!1)}}return f.useEffect(()=>{g()},[]),f.useEffect(()=>{x()},[n]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/finance",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Finance"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"General Ledger"}),e.jsx("p",{className:"text-sm mt-1",children:"Ledger entries for a selected account"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Account"}),e.jsx("select",{className:"input",value:n,onChange:b=>i(b.target.value),children:l.map(b=>e.jsxs("option",{value:b.id,children:[b.code,"  ",b.name]},b.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:b=>s(b.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:b=>a(b.target.value)})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:x,disabled:m,children:m?"Running...":"Run"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:m,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const b=Array.isArray(c)?c:[];if(!b.length)return;const y=is.json_to_sheet(b),j=is.book_new();is.book_append_sheet(j,y,"GeneralLedger"),yr(j,"general-ledger.xlsx")},disabled:!c.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const b=Array.isArray(c)?c:[];if(!b.length)return;const y=new hs("p","mm","a4");let j=15;y.setFontSize(14),y.text("General Ledger",10,j),j+=6,y.setFontSize(10),y.text(`Opening: ${Number(d||0).toLocaleString()}`,10,j),j+=8,y.text("Date",10,j),y.text("Voucher No",45,j),y.text("Line",95,j),y.text("Description",115,j),y.text("Debit",160,j),y.text("Credit",180,j),y.text("Balance",200,j,{align:"right"}),j+=4,y.line(10,j,200,j),j+=5,b.forEach(N=>{j>270&&(y.addPage(),j=15);const _=N.voucher_date?new Date(N.voucher_date).toLocaleDateString():"-",F=String(N.voucher_no||"-"),I=String(N.line_no||"-"),w=String(N.description||"-").slice(0,35),E=String(Number(N.debit||0).toLocaleString()),W=String(Number(N.credit||0).toLocaleString()),R=String(Number(N.balance||0).toLocaleString());y.text(_,10,j),y.text(F,45,j),y.text(I,95,j),y.text(w,115,j),y.text(E,160,j),y.text(W,180,j),y.text(R,200,j,{align:"right"}),j+=5}),y.save("general-ledger.pdf")},disabled:!c.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 mb-4",children:[e.jsx("div",{className:"text-sm",children:"Opening Balance"}),e.jsx("div",{className:"text-xl font-semibold",children:Number(d||0).toLocaleString()})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Voucher No"}),e.jsx("th",{children:"Line"}),e.jsx("th",{children:"Description"}),e.jsx("th",{className:"text-right",children:"Debit"}),e.jsx("th",{className:"text-right",children:"Credit"}),e.jsx("th",{className:"text-right",children:"Balance"})]})}),e.jsx("tbody",{children:c.map((b,y)=>e.jsxs("tr",{children:[e.jsx("td",{children:new Date(b.voucher_date).toLocaleDateString()}),e.jsx("td",{className:"font-medium",children:b.voucher_no}),e.jsx("td",{children:b.line_no}),e.jsx("td",{children:b.description||"-"}),e.jsx("td",{className:"text-right",children:Number(b.debit||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(b.credit||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(b.balance||0).toLocaleString()})]},`${b.voucher_no}-${b.line_no}-${y}`))})]})})]})})]})}function pte(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState({items:[],total:0}),[l,o]=f.useState({items:[],total:0}),[d,u]=f.useState(0),[c,h]=f.useState(!1);async function m(){var p,g,x,b,y;try{h(!0);const j=await Z.get("/finance/reports/profit-and-loss",{params:{from:t||null,to:r||null}});i(((p=j.data)==null?void 0:p.income)||{items:[],total:0}),o(((g=j.data)==null?void 0:g.expenses)||{items:[],total:0}),u(Number(((x=j.data)==null?void 0:x.net_profit)||0))}catch(j){ct.error(((y=(b=j==null?void 0:j.response)==null?void 0:b.data)==null?void 0:y.message)||"Failed to load P&L")}finally{h(!1)}}return f.useEffect(()=>{m()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/finance",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Finance"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Profit and Loss"}),e.jsx("p",{className:"text-sm mt-1",children:"Income and expense summary"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:p=>s(p.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:p=>a(p.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:m,disabled:c,children:c?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:c,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const p=[...n.items.map(b=>({section:"Income",...b})),...l.items.map(b=>({section:"Expenses",...b}))];if(!p.length)return;const g=is.json_to_sheet(p),x=is.book_new();is.book_append_sheet(x,g,"ProfitAndLoss"),yr(x,"profit-and-loss.xlsx")},disabled:!n.items.length&&!l.items.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const p=[...n.items.map(b=>({section:"Income",...b})),...l.items.map(b=>({section:"Expenses",...b}))];if(!p.length)return;const g=new hs("p","mm","a4");let x=15;g.setFontSize(14),g.text("Profit and Loss",10,x),x+=8,g.setFontSize(10),g.text("Section",10,x),g.text("Account",60,x),g.text("Amount",190,x,{align:"right"}),x+=4,g.line(10,x,200,x),x+=5,p.forEach(b=>{x>270&&(g.addPage(),x=15);const y=String(b.section),j=`${String(b.account_code||"-")} ${String(b.account_name||"").slice(0,40)}`.trim(),N=String(Number(b.amount||0).toLocaleString());g.text(y,10,x),g.text(j,60,x),g.text(N,190,x,{align:"right"}),x+=5}),x+=5,g.setFontSize(11),g.text(`Total Income: ${Number(n.total||0).toLocaleString()}`,10,x),x+=6,g.text(`Total Expenses: ${Number(l.total||0).toLocaleString()}`,10,x),x+=6,g.text(`Net Profit: ${Number(d||0).toLocaleString()}`,10,x),g.save("profit-and-loss.pdf")},disabled:!n.items.length&&!l.items.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Income"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:n.items.map(p=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{className:"font-medium",children:p.account_code}),e.jsx("div",{className:"text-sm",children:p.account_name})]}),e.jsx("td",{className:"text-right",children:Number(p.amount||0).toLocaleString()})]},p.account_id))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{className:"font-semibold",children:"Total Income"}),e.jsx("td",{className:"text-right font-semibold",children:Number(n.total||0).toLocaleString()})]})})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Expenses"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:l.items.map(p=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{className:"font-medium",children:p.account_code}),e.jsx("div",{className:"text-sm",children:p.account_name})]}),e.jsx("td",{className:"text-right",children:Number(p.amount||0).toLocaleString()})]},p.account_id))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{className:"font-semibold",children:"Total Expenses"}),e.jsx("td",{className:"text-right font-semibold",children:Number(l.total||0).toLocaleString()})]})})]})})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 mt-6",children:[e.jsx("div",{className:"text-sm",children:"Net Profit"}),e.jsx("div",{className:"text-xl font-semibold",children:Number(d||0).toLocaleString()})]})]})})]})}function xte(){const[t,s]=f.useState(""),[r,a]=f.useState({items:[],total:0}),[n,i]=f.useState({items:[],total:0}),[l,o]=f.useState({items:[],total:0}),[d,u]=f.useState(0),[c,h]=f.useState(!1);async function m(){var g,x,b,y,j,N;try{h(!0);const _=await Z.get("/finance/reports/balance-sheet",{params:{to:t||null}});a(((g=_.data)==null?void 0:g.assets)||{items:[],total:0}),i(((x=_.data)==null?void 0:x.liabilities)||{items:[],total:0}),o(((b=_.data)==null?void 0:b.equity)||{items:[],total:0}),u(Number(((y=_.data)==null?void 0:y.balance)||0))}catch(_){ct.error(((N=(j=_==null?void 0:_.response)==null?void 0:j.data)==null?void 0:N.message)||"Failed to load balance sheet")}finally{h(!1)}}f.useEffect(()=>{m()},[]);function p({title:g,data:x}){return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:g}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:x.items.map(b=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{className:"font-medium",children:b.account_code}),e.jsx("div",{className:"text-sm",children:b.account_name})]}),e.jsx("td",{className:"text-right",children:Number(b.amount||0).toLocaleString()})]},b.account_id))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsxs("td",{className:"font-semibold",children:["Total ",g]}),e.jsx("td",{className:"text-right font-semibold",children:Number(x.total||0).toLocaleString()})]})})]})})}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/finance",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Finance"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Balance Sheet"}),e.jsx("p",{className:"text-sm mt-1",children:"Position at selected date"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"As Of"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:g=>s(g.target.value)})]}),e.jsxs("div",{className:"md:col-span-3 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:m,disabled:c,children:c?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>s(""),disabled:c,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const g=[...r.items.map(y=>({section:"Assets",...y})),...n.items.map(y=>({section:"Liabilities",...y})),...l.items.map(y=>({section:"Equity",...y}))];if(!g.length)return;const x=is.json_to_sheet(g),b=is.book_new();is.book_append_sheet(b,x,"BalanceSheet"),yr(b,"balance-sheet.xlsx")},disabled:!r.items.length&&!n.items.length&&!l.items.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const g=[...r.items.map(y=>({section:"Assets",...y})),...n.items.map(y=>({section:"Liabilities",...y})),...l.items.map(y=>({section:"Equity",...y}))];if(!g.length)return;const x=new hs("p","mm","a4");let b=15;x.setFontSize(14),x.text("Balance Sheet",10,b),b+=8,x.setFontSize(10),x.text("Section",10,b),x.text("Account",60,b),x.text("Amount",190,b,{align:"right"}),b+=4,x.line(10,b,200,b),b+=5,g.forEach(y=>{b>270&&(x.addPage(),b=15);const j=String(y.section),N=`${String(y.account_code||"-")} ${String(y.account_name||"").slice(0,40)}`.trim(),_=String(Number(y.amount||0).toLocaleString());x.text(j,10,b),x.text(N,60,b),x.text(_,190,b,{align:"right"}),b+=5}),b+=5,x.setFontSize(11),x.text(`Total Assets: ${Number(r.total||0).toLocaleString()}`,10,b),b+=6,x.text(`Total Liabilities: ${Number(n.total||0).toLocaleString()}`,10,b),b+=6,x.text(`Total Equity: ${Number(l.total||0).toLocaleString()}`,10,b),b+=6,x.text(`Balance: ${Number(d||0).toLocaleString()}`,10,b),x.save("balance-sheet.pdf")},disabled:!r.items.length&&!n.items.length&&!l.items.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(p,{title:"Assets",data:r}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{title:"Liabilities",data:n}),e.jsx(p,{title:"Equity",data:l})]})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 mt-6",children:[e.jsx("div",{className:"text-sm",children:"Assets - (Liabilities + Equity)"}),e.jsx("div",{className:"text-xl font-semibold",children:Number(d||0).toLocaleString()})]})]})})]})}function gte(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState({inflow:0,outflow:0,net:0}),[d,u]=f.useState(!1);async function c(){var h,m,p,g;try{u(!0);const x=await Z.get("/finance/reports/cash-flow",{params:{from:t||null,to:r||null}});i(((h=x.data)==null?void 0:h.items)||[]),o(((m=x.data)==null?void 0:m.totals)||{inflow:0,outflow:0,net:0})}catch(x){ct.error(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Failed to load cash flow")}finally{u(!1)}}return f.useEffect(()=>{c()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/finance",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Finance"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Cash Flow"}),e.jsx("p",{className:"text-sm mt-1",children:"Movements in bank and cash accounts"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:h=>s(h.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:h=>a(h.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:c,disabled:d,children:d?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:d,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const h=Array.isArray(n)?n:[];if(!h.length)return;const m=is.json_to_sheet(h),p=is.book_new();is.book_append_sheet(p,m,"CashFlow"),yr(p,"cash-flow.xlsx")},disabled:!n.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const h=Array.isArray(n)?n:[];if(!h.length)return;const m=new hs("p","mm","a4");let p=15;m.setFontSize(14),m.text("Cash Flow",10,p),p+=8,m.setFontSize(10),m.text("Bank",10,p),m.text("Account",70,p),m.text("Inflow",130,p),m.text("Outflow",160,p),m.text("Net",190,p,{align:"right"}),p+=4,m.line(10,p,200,p),p+=5,h.forEach(g=>{p>270&&(m.addPage(),p=15);const x=String(g.bank_name||"-").slice(0,40),b=`${String(g.account_code||"-")} ${String(g.account_name||"").slice(0,30)}`.trim(),y=String(Number(g.inflow||0).toLocaleString()),j=String(Number(g.outflow||0).toLocaleString()),N=String(Number(g.net||0).toLocaleString());m.text(x,10,p),m.text(b,70,p),m.text(y,130,p),m.text(j,160,p),m.text(N,190,p,{align:"right"}),p+=5}),p+=5,m.setFontSize(11),m.text(`Totals  Inflow: ${Number(l.inflow||0).toLocaleString()}`,10,p),p+=6,m.text(`Outflow: ${Number(l.outflow||0).toLocaleString()}`,10,p),p+=6,m.text(`Net: ${Number(l.net||0).toLocaleString()}`,10,p),m.save("cash-flow.pdf")},disabled:!n.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Bank"}),e.jsx("th",{children:"Account"}),e.jsx("th",{className:"text-right",children:"Inflow"}),e.jsx("th",{className:"text-right",children:"Outflow"}),e.jsx("th",{className:"text-right",children:"Net"})]})}),e.jsx("tbody",{children:n.map(h=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:h.bank_name}),e.jsxs("td",{children:[e.jsx("div",{className:"font-medium",children:h.account_code}),e.jsx("div",{className:"text-sm",children:h.account_name})]}),e.jsx("td",{className:"text-right",children:Number(h.inflow||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(h.outflow||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(h.net||0).toLocaleString()})]},`${h.bank_account_id}-${h.account_id}`))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{className:"font-semibold",children:"Totals"}),e.jsx("td",{}),e.jsx("td",{className:"text-right font-semibold",children:Number(l.inflow||0).toLocaleString()}),e.jsx("td",{className:"text-right font-semibold",children:Number(l.outflow||0).toLocaleString()}),e.jsx("td",{className:"text-right font-semibold",children:Number(l.net||0).toLocaleString()})]})})]})})]})})]})}function vte(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var u,c,h;try{o(!0);const m=await Z.get("/finance/reports/payment-due",{params:{from:t||null,to:r||null}});i(((u=m.data)==null?void 0:u.items)||[])}catch(m){ct.error(((h=(c=m==null?void 0:m.response)==null?void 0:c.data)==null?void 0:h.message)||"Failed to load report")}finally{o(!1)}}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/finance",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Finance"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Payment Due Report"}),e.jsx("p",{className:"text-sm mt-1",children:"Upcoming and overdue payables by due date"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From Due Date"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:u=>s(u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To Due Date"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:u=>a(u.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=["Due Date","Ref","Party","Amount","Outstanding","Status"],h=u.map(b=>[b.due_date?new Date(b.due_date).toLocaleDateString():"-",String(b.ref_no||"-"),String(b.party_name||"-"),Number(b.amount||0).toFixed(2),Number(b.outstanding||0).toFixed(2),String(b.status||"-")]),m=[c.join(","),...h.map(b=>b.join(","))].join(`
`),p=new Blob([m],{type:"text/csv;charset=utf-8;"}),g=URL.createObjectURL(p),x=document.createElement("a");x.href=g,x.download="payment-due.csv",x.click(),URL.revokeObjectURL(g)},disabled:!n.length,children:"Export CSV"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=is.json_to_sheet(u),h=is.book_new();is.book_append_sheet(h,c,"PaymentDue"),yr(h,"payment-due.xlsx")},disabled:!n.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=new hs("p","mm","a4");let h=15;c.setFontSize(14),c.text("Payment Due Report",10,h),h+=8,c.setFontSize(10),c.text("Due Date",10,h),c.text("Ref",45,h),c.text("Party",85,h),c.text("Amount",140,h),c.text("Outstanding",165,h),c.text("Status",200,h,{align:"right"}),h+=4,c.line(10,h,200,h),h+=5,u.forEach(m=>{h>270&&(c.addPage(),h=15);const p=m.due_date?new Date(m.due_date).toLocaleDateString():"-",g=String(m.ref_no||"-"),x=String(m.party_name||"-").slice(0,40),b=String(Number(m.amount||0).toLocaleString()),y=String(Number(m.outstanding||0).toLocaleString()),j=String(m.status||"-");c.text(p,10,h),c.text(g,45,h),c.text(x,85,h),c.text(b,140,h),c.text(y,165,h),c.text(j,200,h,{align:"right"}),h+=5}),c.save("payment-due.pdf")},disabled:!n.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Due Date"}),e.jsx("th",{children:"Reference"}),e.jsx("th",{children:"Party"}),e.jsx("th",{className:"text-right",children:"Amount"}),e.jsx("th",{className:"text-right",children:"Outstanding"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:n.map(u=>e.jsxs("tr",{children:[e.jsx("td",{children:u.due_date?new Date(u.due_date).toLocaleDateString():"-"}),e.jsx("td",{className:"font-medium",children:u.ref_no||"-"}),e.jsx("td",{children:u.party_name||"-"}),e.jsx("td",{className:"text-right",children:Number(u.amount||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(u.outstanding||0).toLocaleString()}),e.jsx("td",{children:u.status||"-"})]},u.id))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function bte(){const[t,s]=f.useState(""),[r,a]=f.useState([]),[n,i]=f.useState(!1);async function l(){var o,d,u;try{i(!0);const c=await Z.get("/finance/reports/customer-outstanding",{params:{asOf:t||null}});a(((o=c.data)==null?void 0:o.items)||[])}catch(c){ct.error(((u=(d=c==null?void 0:c.response)==null?void 0:d.data)==null?void 0:u.message)||"Failed to load report")}finally{i(!1)}}return f.useEffect(()=>{l()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/finance",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Finance"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Customer Outstanding Report"}),e.jsx("p",{className:"text-sm mt-1",children:"Receivables outstanding per customer as of a date"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"As of Date"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:o=>s(o.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:l,disabled:n,children:n?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s("")},disabled:n,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const o=Array.isArray(r)?r:[];if(!o.length)return;const d=is.json_to_sheet(o),u=is.book_new();is.book_append_sheet(u,d,"CustomerOutstanding"),yr(u,"customer-outstanding.xlsx")},disabled:!r.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const o=Array.isArray(r)?r:[];if(!o.length)return;const d=new hs("p","mm","a4");let u=15;d.setFontSize(14),d.text("Customer Outstanding Report",10,u),u+=8,d.setFontSize(10),d.text("Customer",10,u),d.text("Invoice No",75,u),d.text("Inv Date",115,u),d.text("Due Date",145,u),d.text("Amount",165,u),d.text("Received",180,u),d.text("Outstanding",200,u,{align:"right"}),u+=4,d.line(10,u,200,u),u+=5,o.forEach(c=>{u>270&&(d.addPage(),u=15);const h=String(c.customer_name||"-").slice(0,60),m=String(c.invoice_no||"-"),p=c.invoice_date?new Date(c.invoice_date).toLocaleDateString():"-",g=c.due_date?new Date(c.due_date).toLocaleDateString():"-",x=String(Number(c.amount||0).toLocaleString()),b=String(Number(c.received||0).toLocaleString()),y=String(Number(c.outstanding||0).toLocaleString());d.text(h,10,u),d.text(m,75,u),d.text(p,115,u),d.text(g,145,u),d.text(x,165,u),d.text(b,180,u),d.text(y,200,u,{align:"right"}),u+=5}),d.save("customer-outstanding.pdf")},disabled:!r.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Invoice No"}),e.jsx("th",{children:"Invoice Date"}),e.jsx("th",{children:"Due Date"}),e.jsx("th",{className:"text-right",children:"Amount"}),e.jsx("th",{className:"text-right",children:"Received"}),e.jsx("th",{className:"text-right",children:"Outstanding"})]})}),e.jsx("tbody",{children:r.map(o=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:o.customer_name||"-"}),e.jsx("td",{children:o.invoice_no||"-"}),e.jsx("td",{children:o.invoice_date?new Date(o.invoice_date).toLocaleDateString():"-"}),e.jsx("td",{children:o.due_date?new Date(o.due_date).toLocaleDateString():"-"}),e.jsx("td",{className:"text-right",children:Number(o.amount||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(o.received||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(o.outstanding||0).toLocaleString()})]},o.id))})]})}),r.length===0&&!n?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function yte(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var u,c,h;try{o(!0);const m=await Z.get("/finance/reports/audit-trail",{params:{from:t||null,to:r||null}});i(((u=m.data)==null?void 0:u.items)||[])}catch(m){ct.error(((h=(c=m==null?void 0:m.response)==null?void 0:c.data)==null?void 0:h.message)||"Failed to load report")}finally{o(!1)}}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/finance",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Finance"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Audit Trail"}),e.jsx("p",{className:"text-sm mt-1",children:"System activity for finance transactions"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:u=>s(u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:u=>a(u.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=is.json_to_sheet(u),h=is.book_new();is.book_append_sheet(h,c,"AuditTrail"),yr(h,"audit-trail.xlsx")},disabled:!n.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=new hs("p","mm","a4");let h=15;c.setFontSize(14),c.text("Audit Trail",10,h),h+=8,c.setFontSize(10),c.text("Date/Time",10,h),c.text("User",60,h),c.text("Action",95,h),c.text("Entity",130,h),c.text("Ref",165,h),c.text("Details",190,h,{align:"right"}),h+=4,c.line(10,h,200,h),h+=5,u.forEach(m=>{h>270&&(c.addPage(),h=15);const p=m.action_time?new Date(m.action_time).toLocaleString():"-",g=String(m.user_name||"-").slice(0,25),x=String(m.action||"-").slice(0,25),b=String(m.entity||"-").slice(0,25),y=String(m.ref_no||"-").slice(0,25),j=String(m.details||"-").slice(0,60);c.text(p,10,h),c.text(g,60,h),c.text(x,95,h),c.text(b,130,h),c.text(y,165,h),c.text(j,190,h,{align:"right"}),h+=5}),c.save("audit-trail.pdf")},disabled:!n.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date/Time"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"Action"}),e.jsx("th",{children:"Entity"}),e.jsx("th",{children:"Reference"}),e.jsx("th",{children:"Details"})]})}),e.jsx("tbody",{children:n.map(u=>e.jsxs("tr",{children:[e.jsx("td",{children:u.action_time?new Date(u.action_time).toLocaleString():"-"}),e.jsx("td",{children:u.user_name||"-"}),e.jsx("td",{children:u.action||"-"}),e.jsx("td",{children:u.entity||"-"}),e.jsx("td",{className:"font-medium",children:u.ref_no||"-"}),e.jsx("td",{children:u.details||"-"})]},u.id))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function jte(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1),d=f.useMemo(()=>{const c=n.reduce((p,g)=>p+Number(g.debit||0),0),h=n.reduce((p,g)=>p+Number(g.credit||0),0),m=c-h;return{debit:c,credit:h,balance:m}},[n]);async function u(){var c,h,m;try{o(!0);const p=await Z.get("/finance/reports/debtors-ledger",{params:{from:t||null,to:r||null}});i(((c=p.data)==null?void 0:c.items)||[])}catch(p){ct.error(((m=(h=p==null?void 0:p.response)==null?void 0:h.data)==null?void 0:m.message)||"Failed to load report")}finally{o(!1)}}return f.useEffect(()=>{u()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/finance",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Finance"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Debtors Ledger"}),e.jsx("p",{className:"text-sm mt-1",children:"Customer ledger movements and running balance"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:c=>s(c.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:c=>a(c.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:u,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const c=Array.isArray(n)?n:[];if(!c.length)return;const h=is.json_to_sheet(c),m=is.book_new();is.book_append_sheet(m,h,"DebtorsLedger"),yr(m,"debtors-ledger.xlsx")},disabled:!n.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const c=Array.isArray(n)?n:[];if(!c.length)return;const h=new hs("p","mm","a4");let m=15;h.setFontSize(14),h.text("Debtors Ledger",10,m),m+=8,h.setFontSize(10),h.text("Date",10,m),h.text("Document",45,m),h.text("Description",95,m),h.text("Debit",140,m),h.text("Credit",165,m),h.text("Balance",190,m,{align:"right"}),m+=4,h.line(10,m,200,m),m+=5,c.forEach((p,g)=>{m>270&&(h.addPage(),m=15);const x=p.txn_date?new Date(p.txn_date).toLocaleDateString():"-",b=String(p.doc_no||"-"),y=String(p.description||"-").slice(0,35),j=Number(p.debit||0),N=Number(p.credit||0),_=c.slice(0,g+1).reduce((F,I)=>F+Number(I.debit||0)-Number(I.credit||0),0);h.text(x,10,m),h.text(b,45,m),h.text(y,95,m),h.text(String(j.toLocaleString()),140,m),h.text(String(N.toLocaleString()),165,m),h.text(String(Number(_||0).toLocaleString()),190,m,{align:"right"}),m+=5}),m+=5,h.setFontSize(11),h.text(`Totals  Debit: ${Number(d.debit||0).toLocaleString()}`,10,m),m+=6,h.text(`Credit: ${Number(d.credit||0).toLocaleString()}`,10,m),m+=6,h.text(`Balance: ${Number(d.balance||0).toLocaleString()}`,10,m),h.save("debtors-ledger.pdf")},disabled:!n.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Document"}),e.jsx("th",{children:"Description"}),e.jsx("th",{className:"text-right",children:"Debit"}),e.jsx("th",{className:"text-right",children:"Credit"}),e.jsx("th",{className:"text-right",children:"Balance"})]})}),e.jsx("tbody",{children:n.map((c,h)=>{const m=n.slice(0,h+1).reduce((p,g)=>p+Number(g.debit||0)-Number(g.credit||0),0);return e.jsxs("tr",{children:[e.jsx("td",{children:c.txn_date?new Date(c.txn_date).toLocaleDateString():"-"}),e.jsx("td",{className:"font-medium",children:c.doc_no||"-"}),e.jsx("td",{children:c.description||"-"}),e.jsx("td",{className:"text-right",children:Number(c.debit||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(c.credit||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(m||0).toLocaleString()})]},c.id||h)})}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"text-right font-medium",children:"Totals"}),e.jsx("td",{className:"text-right font-medium",children:d.debit.toLocaleString()}),e.jsx("td",{className:"text-right font-medium",children:d.credit.toLocaleString()}),e.jsx("td",{className:"text-right font-medium",children:d.balance.toLocaleString()})]})})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function Nte(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1),d=f.useMemo(()=>{const c=n.reduce((p,g)=>p+Number(g.debit||0),0),h=n.reduce((p,g)=>p+Number(g.credit||0),0),m=c-h;return{debit:c,credit:h,balance:m}},[n]);async function u(){var c,h,m;try{o(!0);const p=await Z.get("/finance/reports/creditors-ledger",{params:{from:t||null,to:r||null}});i(((c=p.data)==null?void 0:c.items)||[])}catch(p){ct.error(((m=(h=p==null?void 0:p.response)==null?void 0:h.data)==null?void 0:m.message)||"Failed to load report")}finally{o(!1)}}return f.useEffect(()=>{u()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/finance",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Finance"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Creditors Ledger"}),e.jsx("p",{className:"text-sm mt-1",children:"Supplier ledger movements and running balance"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:c=>s(c.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:c=>a(c.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:u,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const c=Array.isArray(n)?n:[];if(!c.length)return;const h=is.json_to_sheet(c),m=is.book_new();is.book_append_sheet(m,h,"CreditorsLedger"),yr(m,"creditors-ledger.xlsx")},disabled:!n.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const c=Array.isArray(n)?n:[];if(!c.length)return;const h=new hs("p","mm","a4");let m=15;h.setFontSize(14),h.text("Creditors Ledger",10,m),m+=8,h.setFontSize(10),h.text("Date",10,m),h.text("Document",45,m),h.text("Description",95,m),h.text("Debit",140,m),h.text("Credit",165,m),h.text("Balance",190,m,{align:"right"}),m+=4,h.line(10,m,200,m),m+=5,c.forEach((p,g)=>{m>270&&(h.addPage(),m=15);const x=p.txn_date?new Date(p.txn_date).toLocaleDateString():"-",b=String(p.doc_no||"-"),y=String(p.description||"-").slice(0,35),j=Number(p.debit||0),N=Number(p.credit||0),_=c.slice(0,g+1).reduce((F,I)=>F+Number(I.debit||0)-Number(I.credit||0),0);h.text(x,10,m),h.text(b,45,m),h.text(y,95,m),h.text(String(j.toLocaleString()),140,m),h.text(String(N.toLocaleString()),165,m),h.text(String(Number(_||0).toLocaleString()),190,m,{align:"right"}),m+=5}),m+=5,h.setFontSize(11),h.text(`Totals  Debit: ${Number(d.debit||0).toLocaleString()}`,10,m),m+=6,h.text(`Credit: ${Number(d.credit||0).toLocaleString()}`,10,m),m+=6,h.text(`Balance: ${Number(d.balance||0).toLocaleString()}`,10,m),h.save("creditors-ledger.pdf")},disabled:!n.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Document"}),e.jsx("th",{children:"Description"}),e.jsx("th",{className:"text-right",children:"Debit"}),e.jsx("th",{className:"text-right",children:"Credit"}),e.jsx("th",{className:"text-right",children:"Balance"})]})}),e.jsx("tbody",{children:n.map((c,h)=>{const m=n.slice(0,h+1).reduce((p,g)=>p+Number(g.debit||0)-Number(g.credit||0),0);return e.jsxs("tr",{children:[e.jsx("td",{children:c.txn_date?new Date(c.txn_date).toLocaleDateString():"-"}),e.jsx("td",{className:"font-medium",children:c.doc_no||"-"}),e.jsx("td",{children:c.description||"-"}),e.jsx("td",{className:"text-right",children:Number(c.debit||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(c.credit||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(m||0).toLocaleString()})]},c.id||h)})}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"text-right font-medium",children:"Totals"}),e.jsx("td",{className:"text-right font-medium",children:d.debit.toLocaleString()}),e.jsx("td",{className:"text-right font-medium",children:d.credit.toLocaleString()}),e.jsx("td",{className:"text-right font-medium",children:d.balance.toLocaleString()})]})})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function wte(){const[t,s]=f.useState(""),[r,a]=f.useState([]),[n,i]=f.useState(!1);async function l(){var o,d,u;try{i(!0);const c=await Z.get("/finance/reports/supplier-outstanding",{params:{asOf:t||null}});a(((o=c.data)==null?void 0:o.items)||[])}catch(c){ct.error(((u=(d=c==null?void 0:c.response)==null?void 0:d.data)==null?void 0:u.message)||"Failed to load report")}finally{i(!1)}}return f.useEffect(()=>{l()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/finance",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Finance"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Supplier Outstanding Report"}),e.jsx("p",{className:"text-sm mt-1",children:"Payables outstanding per supplier as of a date"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"As of Date"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:o=>s(o.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:l,disabled:n,children:n?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s("")},disabled:n,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const o=Array.isArray(r)?r:[];if(!o.length)return;const d=is.json_to_sheet(o),u=is.book_new();is.book_append_sheet(u,d,"SupplierOutstanding"),yr(u,"supplier-outstanding.xlsx")},disabled:!r.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const o=Array.isArray(r)?r:[];if(!o.length)return;const d=new hs("p","mm","a4");let u=15;d.setFontSize(14),d.text("Supplier Outstanding Report",10,u),u+=8,d.setFontSize(10),d.text("Supplier",10,u),d.text("Bill No",75,u),d.text("Bill Date",110,u),d.text("Due Date",140,u),d.text("Amount",165,u),d.text("Paid",180,u),d.text("Outstanding",200,u,{align:"right"}),u+=4,d.line(10,u,200,u),u+=5,o.forEach(c=>{u>270&&(d.addPage(),u=15);const h=String(c.supplier_name||"-").slice(0,60),m=String(c.bill_no||"-"),p=c.bill_date?new Date(c.bill_date).toLocaleDateString():"-",g=c.due_date?new Date(c.due_date).toLocaleDateString():"-",x=String(Number(c.amount||0).toLocaleString()),b=String(Number(c.paid||0).toLocaleString()),y=String(Number(c.outstanding||0).toLocaleString());d.text(h,10,u),d.text(m,75,u),d.text(p,110,u),d.text(g,140,u),d.text(x,165,u),d.text(b,180,u),d.text(y,200,u,{align:"right"}),u+=5}),d.save("supplier-outstanding.pdf")},disabled:!r.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Supplier"}),e.jsx("th",{children:"Bill No"}),e.jsx("th",{children:"Bill Date"}),e.jsx("th",{children:"Due Date"}),e.jsx("th",{className:"text-right",children:"Amount"}),e.jsx("th",{className:"text-right",children:"Paid"}),e.jsx("th",{className:"text-right",children:"Outstanding"})]})}),e.jsx("tbody",{children:r.map(o=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:o.supplier_name||"-"}),e.jsx("td",{children:o.bill_no||"-"}),e.jsx("td",{children:o.bill_date?new Date(o.bill_date).toLocaleDateString():"-"}),e.jsx("td",{children:o.due_date?new Date(o.due_date).toLocaleDateString():"-"}),e.jsx("td",{className:"text-right",children:Number(o.amount||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(o.paid||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(o.outstanding||0).toLocaleString()})]},o.id))})]})}),r.length===0&&!n?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function _te(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState([]),[l,o]=f.useState(!1);async function d(){var u,c,h;try{o(!0);const m=await Z.get("/finance/reports/ratio-analysis",{params:{from:t||null,to:r||null}});i(((u=m.data)==null?void 0:u.items)||[])}catch(m){ct.error(((h=(c=m==null?void 0:m.response)==null?void 0:c.data)==null?void 0:h.message)||"Failed to load report")}finally{o(!1)}}return f.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/finance",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Finance"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Ratio Analysis"}),e.jsx("p",{className:"text-sm mt-1",children:"Key financial ratios for performance insights"})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",type:"date",value:t,onChange:u=>s(u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",type:"date",value:r,onChange:u=>a(u.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:d,disabled:l,children:l?"Running...":"Run Report"}),e.jsx("button",{type:"button",className:"btn-success",onClick:()=>{s(""),a("")},disabled:l,children:"Clear"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=is.json_to_sheet(u),h=is.book_new();is.book_append_sheet(h,c,"RatioAnalysis"),yr(h,"ratio-analysis.xlsx")},disabled:!n.length,children:"Export Excel"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{const u=Array.isArray(n)?n:[];if(!u.length)return;const c=new hs("p","mm","a4");let h=15;c.setFontSize(14),c.text("Ratio Analysis",10,h),h+=8,c.setFontSize(10),c.text("Ratio",10,h),c.text("Value",95,h),c.text("Notes",130,h),h+=4,c.line(10,h,200,h),h+=5,u.forEach(m=>{h>270&&(c.addPage(),h=15);const p=String(m.name||"-").slice(0,70),g=Number(m.value||0).toFixed(2),x=String(m.notes||"-").slice(0,60);c.text(p,10,h),c.text(g,95,h),c.text(x,130,h),h+=5}),c.save("ratio-analysis.pdf")},disabled:!n.length,children:"Export PDF"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>window.print(),children:"Print"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ratio"}),e.jsx("th",{className:"text-right",children:"Value"}),e.jsx("th",{children:"Notes"})]})}),e.jsx("tbody",{children:n.map((u,c)=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:u.name||"-"}),e.jsx("td",{className:"text-right",children:Number(u.value||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{children:u.notes||"-"})]},u.key||c))})]})}),n.length===0&&!l?e.jsx("div",{className:"text-center py-10",children:"No rows."}):null]})})]})}function Ste(){const[t,s]=f.useState([]),[r,a]=f.useState(!0),[n,i]=f.useState(""),[l,o]=f.useState(""),[d,u]=f.useState(""),[c,h]=f.useState(!0),[m,p]=f.useState(""),[g,x]=f.useState(""),[b,y]=f.useState("ASSET"),[j,N]=f.useState(""),[_,F]=f.useState(""),[I,w]=f.useState(""),[E,W]=f.useState(""),[R,U]=f.useState("ASSET"),[T,Y]=f.useState("");async function H(){var L,V,P;try{a(!0);const C=await Z.get("/finance/account-groups",{params:{search:n||null,nature:l||null,active:d||null,includeTotals:c?"1":"0"}});s(((L=C.data)==null?void 0:L.items)||[])}catch(C){ct.error(((P=(V=C==null?void 0:C.response)==null?void 0:V.data)==null?void 0:P.message)||"Failed to load account groups")}finally{a(!1)}}f.useEffect(()=>{H()},[]);async function M(L){var V,P;L.preventDefault();try{await Z.post("/finance/account-groups",{code:m,name:g,nature:b,parentId:j?Number(j):null,isActive:1}),ct.success("Account group created"),p(""),x(""),N(""),H()}catch(C){ct.error(((P=(V=C==null?void 0:C.response)==null?void 0:V.data)==null?void 0:P.message)||"Failed to create group")}}async function q(L,V){var P,C;try{a(!0),await Z.put(`/finance/account-groups/${L}/active`,{isActive:+!!V}),ct.success("Status updated"),await H()}catch(k){ct.error(((C=(P=k==null?void 0:k.response)==null?void 0:P.data)==null?void 0:C.message)||"Failed to update active status")}finally{a(!1)}}function z(){F(""),w(""),W(""),U("ASSET"),Y("")}async function Q(){var L,V;try{a(!0);const P={code:I,name:E,nature:R,parentId:T?Number(T):null};await Z.put(`/finance/account-groups/${_}`,P),ct.success("Group updated"),z(),await H()}catch(P){ct.error(((V=(L=P==null?void 0:P.response)==null?void 0:L.data)==null?void 0:V.message)||"Failed to update group")}finally{a(!1)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Chart of Account Groups"}),e.jsx("p",{className:"text-sm mt-1",children:"Maintain account group hierarchy"})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(Re,{to:"/finance",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("input",{className:"input w-48",placeholder:"Search code/name...",value:n,onChange:L=>i(L.target.value)}),e.jsxs("select",{className:"input w-40",value:l,onChange:L=>o(L.target.value),children:[e.jsx("option",{value:"",children:"All Nature"}),e.jsx("option",{value:"ASSET",children:"Asset"}),e.jsx("option",{value:"LIABILITY",children:"Liability"}),e.jsx("option",{value:"EQUITY",children:"Equity"}),e.jsx("option",{value:"INCOME",children:"Income"}),e.jsx("option",{value:"EXPENSE",children:"Expense"})]}),e.jsxs("select",{className:"input w-32",value:d,onChange:L=>u(L.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]}),e.jsx("button",{className:"btn-success",onClick:H,disabled:r,children:"Apply"})]})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:M,className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Code *"}),e.jsx("input",{className:"input",value:m,onChange:L=>p(L.target.value),required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Name *"}),e.jsx("input",{className:"input",value:g,onChange:L=>x(L.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nature *"}),e.jsxs("select",{className:"input",value:b,onChange:L=>y(L.target.value),children:[e.jsx("option",{value:"ASSET",children:"Asset"}),e.jsx("option",{value:"LIABILITY",children:"Liability"}),e.jsx("option",{value:"EQUITY",children:"Equity"}),e.jsx("option",{value:"INCOME",children:"Income"}),e.jsx("option",{value:"EXPENSE",children:"Expense"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Parent"}),e.jsxs("select",{className:"input",value:j,onChange:L=>N(L.target.value),children:[e.jsx("option",{value:"",children:"None"}),t.map(L=>e.jsxs("option",{value:L.id,children:[L.code," - ",L.name]},L.id))]})]}),e.jsx("div",{className:"md:col-span-5 flex justify-end",children:e.jsx("button",{className:"btn-success",type:"submit",children:"Create Group"})})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:r?e.jsx("div",{className:"text-center py-10",children:"Loading..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Nature"}),e.jsx("th",{children:"Parent"}),e.jsx("th",{className:"text-right",children:"Accounts"}),e.jsx("th",{children:"Active"})]})}),e.jsx("tbody",{children:t.map(L=>e.jsx("tr",{children:String(_)===String(L.id)?e.jsxs(e.Fragment,{children:[e.jsx("td",{children:e.jsx("input",{className:"input",value:I,onChange:V=>w(V.target.value)})}),e.jsx("td",{children:e.jsx("input",{className:"input",value:E,onChange:V=>W(V.target.value)})}),e.jsx("td",{children:e.jsxs("select",{className:"input",value:R,onChange:V=>U(V.target.value),children:[e.jsx("option",{value:"ASSET",children:"Asset"}),e.jsx("option",{value:"LIABILITY",children:"Liability"}),e.jsx("option",{value:"EQUITY",children:"Equity"}),e.jsx("option",{value:"INCOME",children:"Income"}),e.jsx("option",{value:"EXPENSE",children:"Expense"})]})}),e.jsx("td",{children:e.jsxs("select",{className:"input",value:T,onChange:V=>Y(V.target.value),children:[e.jsx("option",{value:"",children:"None"}),t.map(V=>e.jsxs("option",{value:V.id,children:[V.code," - ",V.name]},`p-${V.id}`))]})}),e.jsx("td",{className:"text-right",children:typeof L.account_count=="number"?L.account_count:"-"}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-success",disabled:r,onClick:Q,children:"Save"}),e.jsx("button",{className:"btn btn-secondary",disabled:r,onClick:z,children:"Cancel"})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"font-medium",children:L.code}),e.jsx("td",{children:L.name}),e.jsx("td",{children:L.nature}),e.jsx("td",{children:L.parent_name||"-"}),e.jsx("td",{className:"text-right",children:typeof L.account_count=="number"?L.account_count:"-"}),e.jsx("td",{children:e.jsx("div",{className:"flex gap-2",children:L.is_active?e.jsx("button",{className:"btn btn-secondary",disabled:r||typeof L.active_account_count=="number"&&L.active_account_count>0,onClick:()=>{window.confirm("Deactivate this group?")&&q(L.id,0)},children:"Deactivate"}):e.jsx("button",{className:"btn-success",disabled:r,onClick:()=>q(L.id,1),children:"Activate"})})})]})},L.id))})]})})})})]})}function xC(){const[t,s]=f.useState([]),[r,a]=f.useState([]),[n,i]=f.useState([]),[l,o]=f.useState(!0),[d,u]=f.useState(""),[c,h]=f.useState(""),[m,p]=f.useState(""),[g,x]=f.useState(""),[b,y]=f.useState(""),[j,N]=f.useState(""),[_,F]=f.useState(""),[I,w]=f.useState(""),[E,W]=f.useState(""),[R,U]=f.useState(!0),[T,Y]=f.useState(""),[H,M]=f.useState(""),[q,z]=f.useState(""),[Q,L]=f.useState(""),[V,P]=f.useState(""),[C,k]=f.useState(!0);async function B(){var se,ae,ne,ue,oe;try{o(!0);const[le,X,me]=await Promise.all([Z.get("/finance/accounts",{params:{search:d||null,groupId:c||null,nature:m||null,active:g||null,postable:b||null}}),Z.get("/finance/account-groups"),Z.get("/finance/currencies")]);s(((se=le.data)==null?void 0:se.items)||[]),a(((ae=X.data)==null?void 0:ae.items)||[]),i(((ne=me.data)==null?void 0:ne.items)||[])}catch(le){ct.error(((oe=(ue=le==null?void 0:le.response)==null?void 0:ue.data)==null?void 0:oe.message)||"Failed to load accounts")}finally{o(!1)}}async function G(){var se,ae;try{await Z.post("/finance/accounts/sync")}catch(ne){ct.error(((ae=(se=ne==null?void 0:ne.response)==null?void 0:se.data)==null?void 0:ae.message)||"Failed to sync accounts from customers/suppliers")}}f.useEffect(()=>{(async()=>(await G(),await B()))()},[]);async function O(se){var ae,ne;se.preventDefault();try{await Z.post("/finance/accounts",{groupId:Number(j),code:_,name:I,currencyId:E?Number(E):null,isPostable:R,isControlAccount:0,isActive:1}),ct.success("Account created"),F(""),w(""),N(""),W(""),U(!0),B()}catch(ue){ct.error(((ne=(ae=ue==null?void 0:ue.response)==null?void 0:ae.data)==null?void 0:ne.message)||"Failed to create account")}}async function K(se,ae){var ne,ue;try{o(!0),await Z.put(`/finance/accounts/${se}/active`,{isActive:+!!ae}),ct.success("Status updated"),await B()}catch(oe){ct.error(((ue=(ne=oe==null?void 0:oe.response)==null?void 0:ne.data)==null?void 0:ue.message)||"Failed to update active status")}finally{o(!1)}}function J(){Y(""),M(""),z(""),L(""),P(""),k(!0)}async function te(){var se,ae;try{o(!0),await Z.put(`/finance/accounts/${T}`,{groupId:H?Number(H):null,code:q,name:Q,currencyId:V?Number(V):null,isPostable:C?1:0}),ct.success("Account updated"),J(),await B()}catch(ne){ct.error(((ae=(se=ne==null?void 0:ne.response)==null?void 0:se.data)==null?void 0:ae.message)||"Failed to update account")}finally{o(!1)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Chart of Accounts"}),e.jsx("p",{className:"text-sm mt-1",children:"Create and manage ledger accounts"})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(Re,{to:"/finance",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("input",{className:"input w-48",placeholder:"Search code/name...",value:d,onChange:se=>u(se.target.value)}),e.jsxs("select",{className:"input w-48",value:c,onChange:se=>h(se.target.value),children:[e.jsx("option",{value:"",children:"All Groups"}),r.map(se=>e.jsxs("option",{value:se.id,children:[se.code," - ",se.name]},`flt-${se.id}`))]}),e.jsxs("select",{className:"input w-40",value:m,onChange:se=>p(se.target.value),children:[e.jsx("option",{value:"",children:"All Nature"}),e.jsx("option",{value:"ASSET",children:"Asset"}),e.jsx("option",{value:"LIABILITY",children:"Liability"}),e.jsx("option",{value:"EQUITY",children:"Equity"}),e.jsx("option",{value:"INCOME",children:"Income"}),e.jsx("option",{value:"EXPENSE",children:"Expense"})]}),e.jsxs("select",{className:"input w-32",value:g,onChange:se=>x(se.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]}),e.jsxs("select",{className:"input w-40",value:b,onChange:se=>y(se.target.value),children:[e.jsx("option",{value:"",children:"All Posting"}),e.jsx("option",{value:"1",children:"Postable"}),e.jsx("option",{value:"0",children:"Non-postable"})]}),e.jsx("button",{className:"btn-success",onClick:B,disabled:l,children:"Apply"})]})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:O,className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Group *"}),e.jsxs("select",{className:"input",value:j,onChange:se=>N(se.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select group"}),r.map(se=>e.jsxs("option",{value:se.id,children:[se.code," - ",se.name]},se.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Code *"}),e.jsx("input",{className:"input",value:_,onChange:se=>F(se.target.value),required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Name *"}),e.jsx("input",{className:"input",value:I,onChange:se=>w(se.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsxs("select",{className:"input",value:E,onChange:se=>W(se.target.value),children:[e.jsx("option",{value:"",children:"Default"}),n.map(se=>e.jsx("option",{value:se.id,children:se.code},se.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Posting"}),e.jsxs("select",{className:"input",value:R?"1":"0",onChange:se=>U(se.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Postable"}),e.jsx("option",{value:"0",children:"Non-postable"})]})]}),e.jsx("div",{className:"md:col-span-6 flex justify-end",children:e.jsx("button",{className:"btn-success",type:"submit",children:"Create Account"})})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:l?e.jsx("div",{className:"text-center py-10",children:"Loading..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Group"}),e.jsx("th",{children:"Nature"}),e.jsx("th",{children:"Currency"}),e.jsx("th",{children:"Postable"}),e.jsx("th",{children:"Active"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:t.map(se=>e.jsx("tr",{children:String(T)===String(se.id)?e.jsxs(e.Fragment,{children:[e.jsx("td",{children:e.jsx("input",{className:"input",value:q,onChange:ae=>z(ae.target.value)})}),e.jsx("td",{children:e.jsx("input",{className:"input",value:Q,onChange:ae=>L(ae.target.value)})}),e.jsx("td",{children:e.jsx("select",{className:"input",value:H,onChange:ae=>M(ae.target.value),children:r.map(ae=>e.jsxs("option",{value:ae.id,children:[ae.code," - ",ae.name]},`g-${ae.id}`))})}),e.jsx("td",{children:se.nature}),e.jsx("td",{children:e.jsxs("select",{className:"input",value:V,onChange:ae=>P(ae.target.value),children:[e.jsx("option",{value:"",children:"Default"}),n.map(ae=>e.jsx("option",{value:ae.id,children:ae.code},`c-${ae.id}`))]})}),e.jsx("td",{children:e.jsxs("select",{className:"input",value:C?"1":"0",onChange:ae=>k(ae.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Yes"}),e.jsx("option",{value:"0",children:"No"})]})}),e.jsx("td",{children:se.is_active?"Yes":"No"}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-success",disabled:l,onClick:te,children:"Save"}),e.jsx("button",{className:"btn btn-secondary",disabled:l,onClick:J,children:"Cancel"})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"font-medium",children:se.code}),e.jsx("td",{children:se.name}),e.jsx("td",{children:se.group_name}),e.jsx("td",{children:se.nature}),e.jsx("td",{children:se.currency_code||"-"}),e.jsx("td",{children:se.is_postable?"Yes":"No"}),e.jsx("td",{children:se.is_active?"Yes":"No"}),e.jsx("td",{children:e.jsx("div",{className:"flex gap-2",children:se.is_active?e.jsx("button",{className:"btn btn-secondary",disabled:l,onClick:()=>K(se.id,0),children:"Deactivate"}):e.jsx("button",{className:"btn-success",disabled:l,onClick:()=>K(se.id,1),children:"Activate"})})})]})},se.id))})]})})})})]})}function Cte(){const[t,s]=f.useState([]),[r,a]=f.useState(!0),[n,i]=f.useState(""),[l,o]=f.useState(""),[d,u]=f.useState(""),[c,h]=f.useState("TAX"),[m,p]=f.useState(!0),[g,x]=f.useState({}),[b,y]=f.useState(null),[j,N]=f.useState(null),[_,F]=f.useState([]),[I,w]=f.useState(""),[E,W]=f.useState(""),[R,U]=f.useState(""),[T,Y]=f.useState(!0);async function H(){var J,te,se;try{a(!0);const ae=await Z.get("/finance/tax-codes");s(((J=ae.data)==null?void 0:J.items)||[])}catch(ae){ct.error(((se=(te=ae==null?void 0:ae.response)==null?void 0:te.data)==null?void 0:se.message)||"Failed to load tax codes")}finally{a(!1)}}f.useEffect(()=>{H()},[]);async function M(J){var te,se,ae;try{const ne=await Z.get(`/finance/tax-codes/${J}/components`);F(((te=ne.data)==null?void 0:te.items)||[])}catch(ne){ct.error(((ae=(se=ne==null?void 0:ne.response)==null?void 0:se.data)==null?void 0:ae.message)||"Failed to load tax components")}}function q(J){y(J.id),N(J),w(""),W(""),U(""),Y(!0),M(J.id)}async function z(J){var te,se;if(J.preventDefault(),!!b)try{await Z.post(`/finance/tax-codes/${b}/components`,{componentName:I.trim(),ratePercent:E?Number(E):0,sortOrder:R?Number(R):100,isActive:T}),ct.success("Component added"),w(""),W(""),U(""),Y(!0),M(b)}catch(ae){ct.error(((se=(te=ae==null?void 0:ae.response)==null?void 0:te.data)==null?void 0:se.message)||"Failed to add tax component")}}const[Q,L]=f.useState({});function V(J,te,se){L(ae=>({...ae,[J]:{...ae[J]||{},[te]:se}}))}async function P(J){var se,ae;const te=Q[J];if(te)try{await Z.put(`/finance/tax-components/${J}`,{componentName:te.component_name,ratePercent:te.rate_percent===""||te.rate_percent===null?void 0:Number(te.rate_percent),sortOrder:te.sort_order===""||te.sort_order===null?void 0:Number(te.sort_order),isActive:te.is_active}),ct.success("Component updated"),L(ne=>{const ue={...ne};return delete ue[J],ue}),M(b)}catch(ne){ct.error(((ae=(se=ne==null?void 0:ne.response)==null?void 0:se.data)==null?void 0:ae.message)||"Failed to update component")}}async function C(J){var te,se;if(window.confirm("Disable this component?"))try{await Z.delete(`/finance/tax-components/${J}`),ct.success("Component disabled"),L(ae=>{const ne={...ae};return delete ne[J],ne}),M(b)}catch(ae){ct.error(((se=(te=ae==null?void 0:ae.response)==null?void 0:te.data)==null?void 0:se.message)||"Failed to disable component")}}async function k(J){var te,se;J.preventDefault();try{await Z.post("/finance/tax-codes",{code:n.trim(),name:l.trim(),ratePercent:d?Number(d):0,type:c,isActive:m}),ct.success("Tax code created"),i(""),o(""),u(""),h("TAX"),p(!0),H()}catch(ae){ct.error(((se=(te=ae==null?void 0:ae.response)==null?void 0:te.data)==null?void 0:se.message)||"Failed to create tax code")}}function B(J,te,se){x(ae=>({...ae,[J]:{...ae[J]||{},[te]:se}}))}async function G(J){var se,ae;const te=g[J];if(te)try{await Z.put(`/finance/tax-codes/${J}`,{name:te.name,ratePercent:te.rate_percent===""||te.rate_percent===null?void 0:Number(te.rate_percent),type:te.type,isActive:te.is_active}),ct.success("Tax code updated"),x(ne=>{const ue={...ne};return delete ue[J],ue}),H()}catch(ne){ct.error(((ae=(se=ne==null?void 0:ne.response)==null?void 0:se.data)==null?void 0:ae.message)||"Failed to update tax code")}}function O(J){x(te=>{const se={...te};return delete se[J],se})}async function K(J){var te,se;try{await Z.put(`/finance/tax-codes/${J.id}`,{isActive:!J.is_active}),H()}catch(ae){ct.error(((se=(te=ae==null?void 0:ae.response)==null?void 0:te.data)==null?void 0:se.message)||"Failed to toggle status")}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Tax Codes & Deductions"}),e.jsx("p",{className:"text-sm mt-1",children:"Configure tax and deduction codes used across modules"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/finance",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("button",{className:"btn btn-secondary",onClick:H,disabled:r,children:"Refresh"})]})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:k,className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Code *"}),e.jsx("input",{className:"input",value:n,onChange:J=>i(J.target.value),required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Name *"}),e.jsx("input",{className:"input",value:l,onChange:J=>o(J.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Rate (%)"}),e.jsx("input",{className:"input",type:"number",step:"0.01",min:"0",value:d,onChange:J=>u(J.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Type *"}),e.jsxs("select",{className:"input",value:c,onChange:J=>h(J.target.value),required:!0,children:[e.jsx("option",{value:"TAX",children:"Tax"}),e.jsx("option",{value:"DEDUCTION",children:"Deduction"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:J=>p(J.target.checked)}),"Active"]})}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{className:"btn-success",children:"Create"})})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Rate (%)"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:t.map(J=>{const te=!!g[J.id],se=g[J.id]||{};return e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:J.code}),e.jsx("td",{children:te?e.jsx("input",{className:"input",value:se.name??"",onChange:ae=>B(J.id,"name",ae.target.value)}):J.name}),e.jsx("td",{children:te?e.jsxs("select",{className:"input",value:se.type??"TAX",onChange:ae=>B(J.id,"type",ae.target.value),children:[e.jsx("option",{value:"TAX",children:"Tax"}),e.jsx("option",{value:"DEDUCTION",children:"Deduction"})]}):J.type}),e.jsx("td",{children:te?e.jsx("input",{className:"input",type:"number",step:"0.01",min:"0",value:se.rate_percent===void 0?J.rate_percent:se.rate_percent,onChange:ae=>B(J.id,"rate_percent",ae.target.value)}):Number(J.rate_percent||0).toFixed(2)}),e.jsx("td",{children:te?e.jsxs("select",{className:"input",value:(se.is_active?1:0).toString(),onChange:ae=>B(J.id,"is_active",ae.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]}):J.is_active?e.jsx("span",{className:"badge badge-success",children:"Active"}):e.jsx("span",{className:"badge badge-error",children:"Inactive"})}),e.jsx("td",{className:"text-right",children:te?e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"btn-success",onClick:()=>G(J.id),children:"Save"}),e.jsx("button",{className:"btn",onClick:()=>O(J.id),children:"Cancel"})]}):e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>q(J),children:"Components"}),e.jsx("button",{className:"btn",onClick:()=>K(J),children:J.is_active?"Disable":"Enable"})]})})]},J.id)})})]})})})}),b&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Components for ",j==null?void 0:j.code," - ",j==null?void 0:j.name]}),e.jsx("p",{className:"text-sm",children:"Define composite taxes/deductions"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>M(b),children:"Refresh"}),e.jsx("button",{className:"btn",onClick:()=>y(null),children:"Close"})]})]}),e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("form",{onSubmit:z,className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Component Name *"}),e.jsx("input",{className:"input",value:I,onChange:J=>w(J.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Rate (%)"}),e.jsx("input",{className:"input",type:"number",step:"0.01",min:"0",value:E,onChange:J=>W(J.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Sort Order"}),e.jsx("input",{className:"input",type:"number",min:"0",value:R,onChange:J=>U(J.target.value)})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:J=>Y(J.target.checked)}),"Active"]})}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{className:"btn-success",children:"Add Component"})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Component"}),e.jsx("th",{children:"Rate (%)"}),e.jsx("th",{children:"Sort"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[_.map(J=>{const te=!!Q[J.id],se=Q[J.id]||{};return e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:te?e.jsx("input",{className:"input",value:se.component_name===void 0?J.component_name:se.component_name,onChange:ae=>V(J.id,"component_name",ae.target.value)}):J.component_name}),e.jsx("td",{children:te?e.jsx("input",{className:"input",type:"number",step:"0.01",min:"0",value:se.rate_percent===void 0?J.rate_percent:se.rate_percent,onChange:ae=>V(J.id,"rate_percent",ae.target.value)}):Number(J.rate_percent||0).toFixed(2)}),e.jsx("td",{children:te?e.jsx("input",{className:"input",type:"number",min:"0",value:se.sort_order===void 0?J.sort_order:se.sort_order,onChange:ae=>V(J.id,"sort_order",ae.target.value)}):J.sort_order}),e.jsx("td",{children:te?e.jsxs("select",{className:"input",value:(se.is_active?1:0).toString(),onChange:ae=>V(J.id,"is_active",ae.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]}):J.is_active?e.jsx("span",{className:"badge badge-success",children:"Active"}):e.jsx("span",{className:"badge badge-error",children:"Inactive"})}),e.jsx("td",{className:"text-right",children:te?e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"btn-success",onClick:()=>P(J.id),children:"Save"}),e.jsx("button",{className:"btn",onClick:()=>L(ae=>{const ne={...ae};return delete ne[J.id],ne}),children:"Cancel"})]}):e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx("button",{className:"btn",onClick:()=>C(J.id),children:"Disable"})})})]},J.id)}),_.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-6 text-slate-600",children:"No components defined"})})]})]})})]})]})]})}function kte(){const[t,s]=f.useState([]),[r,a]=f.useState(!0),[n,i]=f.useState(""),[l,o]=f.useState(""),[d,u]=f.useState(""),[c,h]=f.useState(!1),[m,p]=f.useState(!0);async function g(){var _,F,I;try{a(!0);const w=await Z.get("/finance/currencies");s(((_=w.data)==null?void 0:_.items)||[])}catch(w){ct.error(((I=(F=w==null?void 0:w.response)==null?void 0:F.data)==null?void 0:I.message)||"Failed to load currencies")}finally{a(!1)}}f.useEffect(()=>{g()},[]);async function x(_){var F,I;_.preventDefault();try{await Z.post("/finance/currencies",{code:n.trim().toUpperCase(),name:l.trim(),symbol:d.trim()||null,isBase:c,isActive:m}),ct.success("Currency created"),i(""),o(""),u(""),h(!1),p(!0),g()}catch(w){ct.error(((I=(F=w==null?void 0:w.response)==null?void 0:F.data)==null?void 0:I.message)||"Failed to create currency")}}async function b(_){var F,I;try{await Z.put(`/finance/currencies/${_}`,{isBase:1}),ct.success("Base currency updated"),g()}catch(w){ct.error(((I=(F=w==null?void 0:w.response)==null?void 0:F.data)==null?void 0:I.message)||"Failed to set base currency")}}async function y(_){var F,I;try{await Z.put(`/finance/currencies/${_.id}`,{isActive:_.is_active?0:1}),g()}catch(w){ct.error(((I=(F=w==null?void 0:w.response)==null?void 0:F.data)==null?void 0:I.message)||"Failed to toggle status")}}async function j(_){var F,I;try{await Z.put(`/finance/currencies/${_.id}`,{name:_._name??_.name,symbol:_._symbol??_.symbol}),ct.success("Currency updated"),g()}catch(w){ct.error(((I=(F=w==null?void 0:w.response)==null?void 0:F.data)==null?void 0:I.message)||"Failed to update currency")}}function N(_,F,I){s(w=>w.map(E=>E.id===_?{...E,[F]:I}:E))}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Currencies"}),e.jsx("p",{className:"text-sm mt-1",children:"Manage currencies and base currency for the company"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/finance",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("button",{className:"btn btn-secondary",onClick:g,disabled:r,children:"Refresh"})]})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:x,className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Code *"}),e.jsx("input",{className:"input",value:n,onChange:_=>i(_.target.value),required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Name *"}),e.jsx("input",{className:"input",value:l,onChange:_=>o(_.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Symbol"}),e.jsx("input",{className:"input",value:d,onChange:_=>u(_.target.value)})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:_=>h(_.target.checked)}),"Set as Base"]})}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:_=>p(_.target.checked)}),"Active"]})}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{className:"btn-success",children:"Create"})})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Symbol"}),e.jsx("th",{children:"Base"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:t.map(_=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:_.code}),e.jsx("td",{children:e.jsx("input",{className:"input",value:_._name??_.name??"",onChange:F=>N(_.id,"_name",F.target.value)})}),e.jsx("td",{children:e.jsx("input",{className:"input",value:_._symbol??_.symbol??"",onChange:F=>N(_.id,"_symbol",F.target.value)})}),e.jsx("td",{children:_.is_base?e.jsx("span",{className:"badge badge-success",children:"Base"}):e.jsx("button",{className:"btn",onClick:()=>b(_.id),children:"Set Base"})}),e.jsx("td",{children:_.is_active?e.jsx("span",{className:"badge badge-success",children:"Active"}):e.jsx("span",{className:"badge badge-error",children:"Inactive"})}),e.jsx("td",{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"btn-success",onClick:()=>j(_),children:"Save"}),e.jsx("button",{className:"btn",onClick:()=>y(_),children:_.is_active?"Disable":"Enable"})]})})]},_.id))})]})})})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-slate-50 rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Currency Rates"}),e.jsx("p",{className:"text-sm",children:"Maintain exchange rate history"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{className:"btn btn-secondary",disabled:!1,onClick:()=>{},children:"Help"})})]})}),e.jsx("div",{className:"card-body space-y-4",children:e.jsx(Ete,{items:t})})]})]})}function Ete({items:t}){const[s,r]=f.useState([]),[a,n]=f.useState(!0),[i,l]=f.useState(""),[o,d]=f.useState(""),[u,c]=f.useState(""),[h,m]=f.useState(""),[p,g]=f.useState(""),[x,b]=f.useState(""),[y,j]=f.useState(""),[N,_]=f.useState(""),[F,I]=f.useState({});async function w(){var E,W,R;try{n(!0);const U=await Z.get("/finance/currency-rates",{params:{fromCurrencyId:i||null,toCurrencyId:o||null,from:u||null,to:h||null}});r(((E=U.data)==null?void 0:E.items)||[])}catch(U){ct.error(((R=(W=U==null?void 0:U.response)==null?void 0:W.data)==null?void 0:R.message)||"Failed to load currency rates")}finally{n(!1)}}return f.useEffect(()=>{w()},[i,o,u,h]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From Currency"}),e.jsxs("select",{className:"input",value:i,onChange:E=>l(E.target.value),children:[e.jsx("option",{value:"",children:"All"}),t.map(E=>e.jsxs("option",{value:E.id,children:[E.code," - ",E.name]},`f-${E.id}`))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To Currency"}),e.jsxs("select",{className:"input",value:o,onChange:E=>d(E.target.value),children:[e.jsx("option",{value:"",children:"All"}),t.map(E=>e.jsxs("option",{value:E.id,children:[E.code," - ",E.name]},`t-${E.id}`))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From Date"}),e.jsx("input",{className:"input",type:"date",value:u,onChange:E=>c(E.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To Date"}),e.jsx("input",{className:"input",type:"date",value:h,onChange:E=>m(E.target.value)})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{className:"btn btn-secondary",onClick:w,disabled:a,children:"Refresh"})})]}),e.jsxs("form",{onSubmit:async E=>{var W,R;E.preventDefault();try{await Z.post("/finance/currency-rates",{fromCurrencyId:Number(p),toCurrencyId:Number(x),rate:Number(y),rateDate:N||void 0}),ct.success("Rate added"),g(""),b(""),j(""),_(""),w()}catch(U){ct.error(((R=(W=U==null?void 0:U.response)==null?void 0:W.data)==null?void 0:R.message)||"Failed to add currency rate")}},className:"grid grid-cols-1 md:grid-cols-6 gap-3 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From *"}),e.jsxs("select",{className:"input",value:p,onChange:E=>g(E.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select"}),t.map(E=>e.jsxs("option",{value:E.id,children:[E.code," - ",E.name]},`n-f-${E.id}`))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To *"}),e.jsxs("select",{className:"input",value:x,onChange:E=>b(E.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select"}),t.map(E=>e.jsxs("option",{value:E.id,children:[E.code," - ",E.name]},`n-t-${E.id}`))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Rate *"}),e.jsx("input",{className:"input",type:"number",step:"0.000001",min:"0",value:y,onChange:E=>j(E.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Effective Date"}),e.jsx("input",{className:"input",type:"date",value:N,onChange:E=>_(E.target.value)})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{className:"btn-success",children:"Add Rate"})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"From"}),e.jsx("th",{children:"To"}),e.jsx("th",{children:"Rate"}),e.jsx("th",{children:"Date"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[s.map(E=>{const W=F[E.id]||{},R=!!F[E.id];return e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:E.from_code}),e.jsx("td",{children:E.to_code}),e.jsx("td",{children:R?e.jsx("input",{className:"input",type:"number",step:"0.000001",min:"0",value:W.rate===void 0?E.rate:W.rate,onChange:U=>I(T=>({...T,[E.id]:{...T[E.id]||{},rate:U.target.value}}))}):Number(E.rate).toFixed(6)}),e.jsx("td",{children:R?e.jsx("input",{className:"input",type:"date",value:W.rate_date===void 0?E.rate_date?String(E.rate_date).slice(0,10):"":W.rate_date,onChange:U=>I(T=>({...T,[E.id]:{...T[E.id]||{},rate_date:U.target.value}}))}):E.rate_date?String(E.rate_date).slice(0,10):""}),e.jsx("td",{className:"text-right",children:R?e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"btn-success",onClick:async()=>{var U,T;try{await Z.put(`/finance/currency-rates/${E.id}`,{rate:W.rate===""||W.rate===null?void 0:Number(W.rate),rateDate:W.rate_date||void 0}),ct.success("Rate updated"),I(Y=>{const H={...Y};return delete H[E.id],H}),w()}catch(Y){ct.error(((T=(U=Y==null?void 0:Y.response)==null?void 0:U.data)==null?void 0:T.message)||"Failed to update rate")}},children:"Save"}),e.jsx("button",{className:"btn",onClick:()=>I(U=>{const T={...U};return delete T[E.id],T}),children:"Cancel"})]}):e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx("button",{className:"btn",onClick:async()=>{var U,T;if(window.confirm("Delete this rate?"))try{await Z.delete(`/finance/currency-rates/${E.id}`),ct.success("Rate deleted"),I(Y=>{const H={...Y};return delete H[E.id],H}),w()}catch(Y){ct.error(((T=(U=Y==null?void 0:Y.response)==null?void 0:U.data)==null?void 0:T.message)||"Failed to delete rate")}},children:"Delete"})})})]},E.id)}),s.length===0&&!a&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-6 text-slate-600",children:"No rates found"})})]})]})})]})}function Bte(){const[t,s]=f.useState([]),[r,a]=f.useState(!0),[n,i]=f.useState(""),[l,o]=f.useState(""),[d,u]=f.useState(""),[c,h]=f.useState(!0);async function m(){var b,y,j;try{a(!0);const N=await Z.get("/finance/fiscal-years");s(((b=N.data)==null?void 0:b.items)||[])}catch(N){ct.error(((j=(y=N==null?void 0:N.response)==null?void 0:y.data)==null?void 0:j.message)||"Failed to load fiscal years")}finally{a(!1)}}f.useEffect(()=>{m()},[]);async function p(b){var y,j;b.preventDefault();try{await Z.post("/finance/fiscal-years",{code:n.trim(),startDate:l,endDate:d,isOpen:c}),ct.success("Fiscal year created"),i(""),o(""),u(""),h(!0),m()}catch(N){ct.error(((j=(y=N==null?void 0:N.response)==null?void 0:y.data)==null?void 0:j.message)||"Failed to create fiscal year")}}async function g(b){var y,j;try{await Z.post(`/finance/fiscal-years/${b}/open`),ct.success("Fiscal year opened"),m()}catch(N){ct.error(((j=(y=N==null?void 0:N.response)==null?void 0:y.data)==null?void 0:j.message)||"Failed to open fiscal year")}}async function x(b){var y,j;try{await Z.post(`/finance/fiscal-years/${b}/close`),ct.success("Fiscal year closed"),m()}catch(N){ct.error(((j=(y=N==null?void 0:N.response)==null?void 0:y.data)==null?void 0:j.message)||"Failed to close fiscal year")}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Fiscal Years"}),e.jsx("p",{className:"text-sm mt-1",children:"Open and close fiscal periods, manage reporting ranges"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/finance",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("button",{className:"btn btn-secondary",onClick:m,disabled:r,children:"Refresh"})]})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:p,className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Code *"}),e.jsx("input",{className:"input",value:n,onChange:b=>i(b.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Start Date *"}),e.jsx("input",{className:"input",type:"date",value:l,onChange:b=>o(b.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"End Date *"}),e.jsx("input",{className:"input",type:"date",value:d,onChange:b=>u(b.target.value),required:!0})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:b=>h(b.target.checked)}),"Set Open"]})}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{className:"btn-success",children:"Create"})})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Start"}),e.jsx("th",{children:"End"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:t.map(b=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:b.code}),e.jsx("td",{children:b.start_date?String(b.start_date).split("T")[0]:""}),e.jsx("td",{children:b.end_date?String(b.end_date).split("T")[0]:""}),e.jsx("td",{children:b.is_open?e.jsx("span",{className:"badge badge-success",children:"Open"}):e.jsx("span",{className:"badge badge-error",children:"Closed"})}),e.jsx("td",{className:"text-right",children:e.jsx("div",{className:"flex justify-end gap-2",children:b.is_open?e.jsx("button",{className:"btn",onClick:()=>x(b.id),children:"Close"}):e.jsx("button",{className:"btn",onClick:()=>g(b.id),children:"Open"})})})]},b.id))})]})})})})]})}function Fte(){const[t,s]=f.useState([]),[r,a]=f.useState(!1),[n,i]=f.useState(""),[l,o]=f.useState({code:"",name:""}),[d,u]=f.useState(!1),[c,h]=f.useState(""),m=async()=>{var g;a(!0),i("");try{const x=await Z.get("/finance/cost-centers"),b=Array.isArray((g=x.data)==null?void 0:g.items)?x.data.items:[];s(b)}catch{i("Cost center API not available")}finally{a(!1)}};f.useEffect(()=>{m()},[]);const p=async g=>{if(g.preventDefault(),!(!l.code||!l.name)){u(!0),i(""),h("");try{await Z.post("/finance/cost-centers",{code:l.code,name:l.name,is_active:1}),o({code:"",name:""}),h("Cost center saved successfully"),await m()}catch{i("Failed to save cost center")}finally{u(!1)}}};return e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"font-semibold",children:"Cost Centers"})}),e.jsxs("div",{className:"card-body space-y-4",children:[n?e.jsx("div",{className:"text-sm text-red-600",children:n}):null,c?e.jsx("div",{className:"text-sm text-green-700",children:c}):null,e.jsxs("form",{onSubmit:p,className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Code"}),e.jsx("input",{className:"input",value:l.code,onChange:g=>o(x=>({...x,code:g.target.value})),placeholder:"OPS",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Name"}),e.jsx("input",{className:"input",value:l.name,onChange:g=>o(x=>({...x,name:g.target.value})),placeholder:"Operations",required:!0})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{className:"btn-primary",disabled:d||!l.code||!l.name,children:d?"Saving...":"Save"})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Status"})]})}),e.jsxs("tbody",{children:[!r&&t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"text-center text-slate-500",children:"No cost centers"})}):null,t.map(g=>e.jsxs("tr",{children:[e.jsx("td",{children:g.code}),e.jsx("td",{children:g.name}),e.jsx("td",{children:Number(g.is_active)===1?"Active":"Inactive"})]},g.id))]})]})})]})]})})}function Tte(){const[t,s]=f.useState([]),[r,a]=f.useState([]),[n,i]=f.useState(!0),[l,o]=f.useState(""),[d,u]=f.useState(""),[c,h]=f.useState(""),[m,p]=f.useState("");async function g(){var y,j,N,_;try{i(!0);const[F,I]=await Promise.all([Z.get("/finance/bank-accounts"),Z.get("/finance/bank-reconciliations")]);s(((y=F.data)==null?void 0:y.items)||[]),a(((j=I.data)==null?void 0:j.items)||[])}catch(F){ct.error(((_=(N=F==null?void 0:F.response)==null?void 0:N.data)==null?void 0:_.message)||"Failed to load bank accounts / reconciliations")}finally{i(!1)}}f.useEffect(()=>{g()},[]);async function x(y){var j,N;if(y.preventDefault(),d&&c){const _=new Date(d),F=new Date(c);if(_>F){ct.error("Statement From must be before or equal to Statement To");return}}try{await Z.post("/finance/bank-reconciliations",{bankAccountId:Number(l),statementFrom:d,statementTo:c,statementEndingBalance:m?Number(m):void 0}),ct.success("Reconciliation created"),o(""),u(""),h(""),p(""),g()}catch(_){ct.error(((N=(j=_==null?void 0:_.response)==null?void 0:j.data)==null?void 0:N.message)||"Failed to create reconciliation")}}async function b(y){var j,N;if(y.status!=="COMPLETED"&&window.confirm("Mark this reconciliation as COMPLETED?"))try{await Z.post(`/finance/bank-reconciliations/${y.id}/complete`),ct.success("Reconciliation completed"),g()}catch(_){ct.error(((N=(j=_==null?void 0:_.response)==null?void 0:j.data)==null?void 0:N.message)||"Failed to complete reconciliation")}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Bank Reconciliation"}),e.jsx("p",{className:"text-sm mt-1",children:"Create and manage bank reconciliations"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/finance",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("button",{className:"btn btn-secondary",disabled:n,onClick:g,children:"Refresh"})]})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:x,className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Bank Account *"}),e.jsxs("select",{className:"input",value:l,onChange:y=>o(y.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select"}),t.map(y=>e.jsxs("option",{value:y.id,children:[y.name," (",y.account_number||"No Acc",")"]},y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Statement From *"}),e.jsx("input",{className:"input",type:"date",value:d,onChange:y=>u(y.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Statement To *"}),e.jsx("input",{className:"input",type:"date",value:c,onChange:y=>h(y.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Ending Balance"}),e.jsx("input",{className:"input",type:"number",step:"0.01",value:m,onChange:y=>p(y.target.value)})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{className:"btn-success",children:"Create"})})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Bank"}),e.jsx("th",{children:"From"}),e.jsx("th",{children:"To"}),e.jsx("th",{className:"text-right",children:"Ending Balance"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[r.map(y=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:y.bank_account_name}),e.jsx("td",{children:String(y.statement_from).slice(0,10)}),e.jsx("td",{children:String(y.statement_to).slice(0,10)}),e.jsx("td",{className:"text-right",children:Number(y.statement_ending_balance||0).toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsx("td",{children:y.status==="COMPLETED"?e.jsx("span",{className:"badge badge-success",children:"Completed"}):e.jsx("span",{className:"badge badge-info",children:"Draft"})}),e.jsx("td",{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(Re,{to:`/finance/bank-reconciliation/${y.id}`,className:"btn btn-secondary",children:"Open"}),y.status!=="COMPLETED"&&e.jsx("button",{className:"btn",onClick:()=>b(y),children:"Complete"})]})})]},y.id)),r.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-6 text-slate-600",children:"No reconciliations found"})})]})]})})})})]})}function Ite(){var C,k;const{id:t}=Ps();ps();const[s,r]=f.useState(!0),[a,n]=f.useState(null),[i,l]=f.useState([]),[o,d]=f.useState({}),[u,c]=f.useState({voucherId:"",statementDate:"",description:"",amount:"",cleared:!1}),[h,m]=f.useState({}),[p,g]=f.useState([]),[x,b]=f.useState(""),[y,j]=f.useState(!1),[N,_]=f.useState(null),[F,I]=f.useState([]),[w,E]=f.useState(!1),[W,R]=f.useState({date:"",description:"",amount:"",cleared:"",voucher_no:""}),[U,T]=f.useState(null);async function Y(){var B,G,O,K;try{r(!0);const J=await Z.get(`/finance/bank-reconciliations/${t}`);n(((B=J.data)==null?void 0:B.header)||null),l(((G=J.data)==null?void 0:G.lines)||[]),d({}),m({});try{const te=await Z.get(`/finance/bank-reconciliations/${t}/summary`);T(te.data||null)}catch{T(null)}}catch(J){ct.error(((K=(O=J==null?void 0:J.response)==null?void 0:O.data)==null?void 0:K.message)||"Failed to load reconciliation")}finally{r(!1)}}f.useEffect(()=>{Y()},[t]),f.useEffect(()=>{(async()=>{var B;try{const G=await Z.get("/finance/vouchers");g(((B=G.data)==null?void 0:B.items)||[])}catch{}})()},[]);async function H(){var O,K;const B=o.statement_from||(a==null?void 0:a.statement_from),G=o.statement_to||(a==null?void 0:a.statement_to);if(B&&G){const J=new Date(B),te=new Date(G);if(J>te){ct.error("Statement From must be before or equal to Statement To");return}}try{await Z.put(`/finance/bank-reconciliations/${t}`,{statementFrom:o.statement_from||void 0,statementTo:o.statement_to||void 0,statementEndingBalance:o.statement_ending_balance===""||o.statement_ending_balance===null?void 0:Number(o.statement_ending_balance),status:o.status||void 0}),ct.success("Header updated"),Y()}catch(J){ct.error(((K=(O=J==null?void 0:J.response)==null?void 0:O.data)==null?void 0:K.message)||"Failed to update header")}}async function M(B){var G,O;if(B.preventDefault(),!u.statementDate){ct.error("Statement Date is required");return}if(!u.amount||Number(u.amount)===0){ct.error("Amount must be non-zero");return}if(a!=null&&a.statement_from&&(a!=null&&a.statement_to)){const K=new Date(u.statementDate),J=new Date(a.statement_from),te=new Date(a.statement_to);if(K<J||K>te){ct.error("Line date must be within reconciliation date range");return}}try{await Z.post(`/finance/bank-reconciliations/${t}/lines`,{voucherId:u.voucherId?Number(u.voucherId):void 0,statementDate:u.statementDate,description:u.description||void 0,amount:Number(u.amount),cleared:u.cleared?1:0}),ct.success("Line added"),c({voucherId:"",statementDate:"",description:"",amount:"",cleared:!1}),Y()}catch(K){ct.error(((O=(G=K==null?void 0:K.response)==null?void 0:G.data)==null?void 0:O.message)||"Failed to add line")}}async function q(B){var O,K;const G=h[B.id]||{};if(G.amount!==void 0&&(G.amount===""||Number(G.amount)===0)){ct.error("Amount must be non-zero");return}if(G.statement_date){const J=new Date(G.statement_date),te=new Date(a.statement_from),se=new Date(a.statement_to);if(J<te||J>se){ct.error("Line date must be within reconciliation date range");return}}try{await Z.put(`/finance/bank-reconciliation-lines/${B.id}`,{voucherId:G.voucher_id===void 0?void 0:Number(G.voucher_id||0),statementDate:G.statement_date||void 0,description:G.description||void 0,amount:G.amount===void 0||G.amount===""?void 0:Number(G.amount),cleared:G.cleared===void 0?void 0:G.cleared?1:0}),ct.success("Line updated"),m(J=>{const te={...J};return delete te[B.id],te}),Y()}catch(J){ct.error(((K=(O=J==null?void 0:J.response)==null?void 0:O.data)==null?void 0:K.message)||"Failed to update line")}}async function z(B){var G,O;if(window.confirm("Delete this line?"))try{await Z.delete(`/finance/bank-reconciliation-lines/${B.id}`),ct.success("Line deleted"),m(K=>{const J={...K};return delete J[B.id],J}),Y()}catch(K){ct.error(((O=(G=K==null?void 0:K.response)==null?void 0:G.data)==null?void 0:O.message)||"Failed to delete line")}}async function Q(B){var G,O,K,J;if(B.preventDefault(),!N){ct.error("Choose a CSV or XLSX file");return}try{j(!0);const te=new FormData;if(te.append("file",N),w){const ue={};W.date&&(ue.date=W.date),W.description&&(ue.description=W.description),W.amount&&(ue.amount=W.amount),W.cleared&&(ue.cleared=W.cleared),W.voucher_no&&(ue.voucher_no=W.voucher_no),te.append("mapping",JSON.stringify(ue))}const se=await Z.post(`/finance/bank-reconciliations/${t}/lines/import`,te,{headers:{"Content-Type":"multipart/form-data"}}),ae=((G=se.data)==null?void 0:G.insertedCount)||0,ne=((O=se.data)==null?void 0:O.skippedCount)||0;ct.success(`Imported ${ae} lines, skipped ${ne}`),_(null),Y()}catch(te){ct.error(((J=(K=te==null?void 0:te.response)==null?void 0:K.data)==null?void 0:J.message)||"Failed to import lines")}finally{j(!1)}}async function L(B){try{const G=await Z.get(`/finance/bank-reconciliations/lines/import-template?format=${B}`,{responseType:"blob"}),O=new Blob([G.data],{type:B==="xlsx"?"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"text/csv"}),K=URL.createObjectURL(O),J=document.createElement("a");J.href=K,J.download=B==="xlsx"?"reconciliation_import_template.xlsx":"reconciliation_import_template.csv",document.body.appendChild(J),J.click(),J.remove(),URL.revokeObjectURL(K)}catch{ct.error("Failed to download template")}}function V(B){if(_(B),I([]),!B)return;const G=new FileReader;G.onload=()=>{try{const O=qf(G.result,{type:"binary"}),K=O.Sheets[O.SheetNames[0]],J=is.sheet_to_json(K,{header:1}),se=(Array.isArray(J==null?void 0:J[0])?J[0]:[]).map(ae=>String(ae||"").trim()).filter(ae=>ae.length>0);I(se)}catch{}},G.readAsBinaryString(B)}if(!a&&!s)return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Reconciliation Not Found"})}),e.jsx("div",{className:"card-body",children:e.jsx(Re,{to:"/finance/bank-reconciliation",className:"btn",children:"Back to List"})})]})});const P=U?{cleared:Number(U.clearedTotal||0),uncleared:Number(U.unclearedTotal||0),ending:Number(U.statementEndingBalance||0),openingBook:Number(U.openingBookBalance||0),periodMovement:Number(U.periodBookMovement||0),endingBook:Number(U.endingBookBalance||0),diffBankVsCleared:Number(U.diffBankVsCleared||0),diffBankVsBook:Number(U.diffBankVsBook||0),outstandingEstimate:Number(U.outstandingEstimate||0)}:{cleared:i.filter(B=>Number(B.cleared)).reduce((B,G)=>B+Number(G.amount||0),0),uncleared:i.filter(B=>!Number(B.cleared)).reduce((B,G)=>B+Number(G.amount||0),0),ending:Number((a==null?void 0:a.statement_ending_balance)||0),openingBook:0,periodMovement:0,endingBook:0,diffBankVsCleared:Number((a==null?void 0:a.statement_ending_balance)||0)-i.filter(B=>Number(B.cleared)).reduce((B,G)=>B+Number(G.amount||0),0),diffBankVsBook:0,outstandingEstimate:0};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Bank Reconciliation Details"}),e.jsxs("p",{className:"text-sm mt-1",children:[a==null?void 0:a.bank_account_name," ",a!=null&&a.account_number?`(${a.account_number})`:""]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/finance",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/finance/bank-reconciliation",className:"btn btn-secondary",children:"Back to List"}),e.jsx("button",{className:"btn btn-secondary",disabled:s,onClick:Y,children:"Refresh"})]})]})}),a&&e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Statement From"}),e.jsx("input",{className:"input",type:"date",value:o.statement_from===void 0?(C=a.statement_from)==null?void 0:C.slice(0,10):o.statement_from,onChange:B=>d(G=>({...G,statement_from:B.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Statement To"}),e.jsx("input",{className:"input",type:"date",value:o.statement_to===void 0?(k=a.statement_to)==null?void 0:k.slice(0,10):o.statement_to,onChange:B=>d(G=>({...G,statement_to:B.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Ending Balance"}),e.jsx("input",{className:"input",type:"number",step:"0.01",value:o.statement_ending_balance===void 0?a.statement_ending_balance??"":o.statement_ending_balance,onChange:B=>d(G=>({...G,statement_ending_balance:B.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:o.status===void 0?a.status:o.status,onChange:B=>d(G=>({...G,status:B.target.value})),children:[e.jsx("option",{value:"DRAFT",children:"Draft"}),e.jsx("option",{value:"COMPLETED",children:"Completed"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{className:"btn-success",onClick:H,children:"Save Header"})})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Cleared Total"}),e.jsx("div",{className:"text-xl font-semibold",children:P.cleared.toLocaleString("en-US",{minimumFractionDigits:2})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Uncleared Total"}),e.jsx("div",{className:"text-xl font-semibold",children:P.uncleared.toLocaleString("en-US",{minimumFractionDigits:2})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Statement Ending Balance"}),e.jsx("div",{className:"text-xl font-semibold",children:P.ending.toLocaleString("en-US",{minimumFractionDigits:2})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Diff (Ending  Cleared)"}),e.jsx("div",{className:`text-xl font-semibold ${P.diffBankVsCleared===0?"text-green-600":"text-red-600"}`,children:P.diffBankVsCleared.toLocaleString("en-US",{minimumFractionDigits:2})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Book Opening"}),e.jsx("div",{className:"text-xl font-semibold",children:P.openingBook.toLocaleString("en-US",{minimumFractionDigits:2})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Book Movement"}),e.jsx("div",{className:"text-xl font-semibold",children:P.periodMovement.toLocaleString("en-US",{minimumFractionDigits:2})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Book Ending"}),e.jsx("div",{className:"text-xl font-semibold",children:P.endingBook.toLocaleString("en-US",{minimumFractionDigits:2})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Diff (Ending  Book)"}),e.jsx("div",{className:`text-xl font-semibold ${P.diffBankVsBook===0?"text-green-600":"text-red-600"}`,children:P.diffBankVsBook.toLocaleString("en-US",{minimumFractionDigits:2})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"label",children:"Outstanding Estimate (Book  Cleared)"}),e.jsx("div",{className:"text-xl font-semibold",children:P.outstandingEstimate.toLocaleString("en-US",{minimumFractionDigits:2})})]})]})})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-slate-50 rounded-t-lg",children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Statement Lines"}),e.jsx("p",{className:"text-sm",children:"Add bank statement lines and mark cleared"})]})})}),e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("form",{onSubmit:Q,className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"label",children:"Import Lines (CSV/XLSX)"}),e.jsx("input",{className:"input",type:"file",accept:".csv,.xlsx",onChange:B=>{var G;return V(((G=B.target.files)==null?void 0:G[0])||null)}})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{className:"btn-secondary",disabled:y,children:y?"Importing...":"Import"})}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("button",{type:"button",className:"btn",onClick:()=>L("csv"),children:"Download CSV Template"}),e.jsx("button",{type:"button",className:"btn",onClick:()=>L("xlsx"),children:"Download XLSX Template"})]}),e.jsxs("div",{className:"md:col-span-6",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:B=>E(B.target.checked)}),"Advanced Mapping"]}),w&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Date Column"}),e.jsxs("select",{className:"input",value:W.date,onChange:B=>R(G=>({...G,date:B.target.value})),children:[e.jsx("option",{value:"",children:"Auto"}),F.map(B=>e.jsx("option",{value:B,children:B},`date-${B}`))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Description Column"}),e.jsxs("select",{className:"input",value:W.description,onChange:B=>R(G=>({...G,description:B.target.value})),children:[e.jsx("option",{value:"",children:"Auto"}),F.map(B=>e.jsx("option",{value:B,children:B},`desc-${B}`))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Amount Column"}),e.jsxs("select",{className:"input",value:W.amount,onChange:B=>R(G=>({...G,amount:B.target.value})),children:[e.jsx("option",{value:"",children:"Auto"}),F.map(B=>e.jsx("option",{value:B,children:B},`amt-${B}`))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Cleared Column"}),e.jsxs("select",{className:"input",value:W.cleared,onChange:B=>R(G=>({...G,cleared:B.target.value})),children:[e.jsx("option",{value:"",children:"Auto"}),F.map(B=>e.jsx("option",{value:B,children:B},`clr-${B}`))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher No. Column"}),e.jsxs("select",{className:"input",value:W.voucher_no,onChange:B=>R(G=>({...G,voucher_no:B.target.value})),children:[e.jsx("option",{value:"",children:"Auto"}),F.map(B=>e.jsx("option",{value:B,children:B},`vno-${B}`))]})]})]})]})]}),e.jsxs("form",{onSubmit:M,className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher (optional)"}),e.jsx("input",{className:"input mb-2",placeholder:"Search voucher no.",value:x,onChange:B=>b(B.target.value)}),e.jsxs("select",{className:"input",value:u.voucherId,onChange:B=>c(G=>({...G,voucherId:B.target.value})),children:[e.jsx("option",{value:"",children:"None"}),(x?p.filter(B=>String(B.voucher_no||"").toLowerCase().includes(x.toLowerCase())):p).slice(0,50).map(B=>e.jsxs("option",{value:B.id,children:[B.voucher_no," (",B.voucher_type_code,") -"," ",String(B.voucher_date).slice(0,10)]},B.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Statement Date *"}),e.jsx("input",{className:"input",type:"date",value:u.statementDate,onChange:B=>c(G=>({...G,statementDate:B.target.value})),required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("input",{className:"input",value:u.description,onChange:B=>c(G=>({...G,description:B.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Amount *"}),e.jsx("input",{className:"input",type:"number",step:"0.01",value:u.amount,onChange:B=>c(G=>({...G,amount:B.target.value})),required:!0})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:u.cleared,onChange:B=>c(G=>({...G,cleared:B.target.checked}))}),"Cleared"]})}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{className:"btn-success",children:"Add Line"})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Voucher"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Description"}),e.jsx("th",{className:"text-right",children:"Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[i.map(B=>{var K;const G=h[B.id]||{},O=!!h[B.id];return e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:O?e.jsx("input",{className:"input",type:"number",min:"0",value:G.voucher_id===void 0?B.voucher_id??"":G.voucher_id,onChange:J=>m(te=>({...te,[B.id]:{...te[B.id]||{},voucher_id:J.target.value}}))}):B.voucher_no?`${B.voucher_no}`:""}),e.jsx("td",{children:O?e.jsx("input",{className:"input",type:"date",value:G.statement_date===void 0?(K=B.statement_date)==null?void 0:K.slice(0,10):G.statement_date,onChange:J=>m(te=>({...te,[B.id]:{...te[B.id]||{},statement_date:J.target.value}}))}):String(B.statement_date).slice(0,10)}),e.jsx("td",{children:O?e.jsx("input",{className:"input",value:G.description===void 0?B.description??"":G.description,onChange:J=>m(te=>({...te,[B.id]:{...te[B.id]||{},description:J.target.value}}))}):B.description}),e.jsx("td",{className:"text-right",children:O?e.jsx("input",{className:"input",type:"number",step:"0.01",value:G.amount===void 0?B.amount??"":G.amount,onChange:J=>m(te=>({...te,[B.id]:{...te[B.id]||{},amount:J.target.value}}))}):Number(B.amount||0).toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsx("td",{children:O?e.jsxs("select",{className:"input",value:G.cleared??B.cleared?"1":"0",onChange:J=>m(te=>({...te,[B.id]:{...te[B.id]||{},cleared:J.target.value==="1"}})),children:[e.jsx("option",{value:"1",children:"Cleared"}),e.jsx("option",{value:"0",children:"Uncleared"})]}):B.cleared?e.jsx("span",{className:"badge badge-success",children:"Cleared"}):e.jsx("span",{className:"badge badge-error",children:"Uncleared"})}),e.jsx("td",{className:"text-right",children:O?e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"btn-success",onClick:()=>q(B),children:"Save"}),e.jsx("button",{className:"btn",onClick:()=>m(J=>{const te={...J};return delete te[B.id],te}),children:"Cancel"})]}):e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>m(J=>({...J,[B.id]:{voucher_id:B.voucher_id,statement_date:String(B.statement_date).slice(0,10),description:B.description,amount:B.amount,cleared:!!B.cleared}})),children:"Edit"}),e.jsx("button",{className:"btn",onClick:()=>z(B),children:"Delete"})]})})]},B.id)}),i.length===0&&!s&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-6 text-slate-600",children:"No lines yet"})})]})]})})]})]})]})}function Lte(){const[t,s]=f.useState([]),[r,a]=f.useState([]),[n,i]=f.useState(!0),[l,o]=f.useState(""),[d,u]=f.useState(""),[c,h]=f.useState(""),[m,p]=f.useState(""),[g,x]=f.useState(""),[b,y]=f.useState([]),[j,N]=f.useState("");async function _(){var E,W,R,U;try{i(!0);const[T,Y]=await Promise.all([Z.get("/finance/pdc-postings"),Z.get("/finance/bank-accounts")]);let H=((E=T.data)==null?void 0:E.items)||[];l&&(H=H.filter(M=>M.status===l)),s(H),a(((W=Y.data)==null?void 0:W.items)||[])}catch(T){ct.error(((U=(R=T==null?void 0:T.response)==null?void 0:R.data)==null?void 0:U.message)||"Failed to load PDCs")}finally{i(!1)}}f.useEffect(()=>{_()},[l]),f.useEffect(()=>{(async()=>{var E;try{const W=await Z.get("/finance/vouchers");y(((E=W.data)==null?void 0:E.items)||[])}catch{}})()},[]);async function F(E){var R,U;if(E.preventDefault(),!d){ct.error("Voucher ID is required");return}if(!c.trim()){ct.error("Instrument No. is required");return}if(!m){ct.error("Instrument Date is required");return}const W=b.find(T=>Number(T.id)===Number(d));if(W){const T=new Date(m),Y=new Date(W.voucher_date);if(T<Y){ct.error("Instrument Date must be on or after voucher date");return}}try{await Z.post("/finance/pdc-postings",{voucherId:Number(d),instrumentNo:c.trim(),instrumentDate:m,bankAccountId:g?Number(g):void 0}),ct.success("PDC created"),u(""),h(""),p(""),x(""),_()}catch(T){ct.error(((U=(R=T==null?void 0:T.response)==null?void 0:R.data)==null?void 0:U.message)||"Failed to create PDC")}}async function I(E,W){var R,U;if(window.confirm(`Change status to ${W}?`))try{await Z.put(`/finance/pdc-postings/${E.id}`,{status:W}),ct.success("Status updated"),_()}catch(T){ct.error(((U=(R=T==null?void 0:T.response)==null?void 0:R.data)==null?void 0:U.message)||"Failed to update status")}}async function w(E){var W,R;if(window.confirm("Delete this PDC?"))try{await Z.delete(`/finance/pdc-postings/${E.id}`),ct.success("PDC deleted"),_()}catch(U){ct.error(((R=(W=U==null?void 0:U.response)==null?void 0:W.data)==null?void 0:R.message)||"Failed to delete PDC")}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Post-Dated Cheques (PDC)"}),e.jsx("p",{className:"text-sm mt-1",children:"Register and manage PDC postings"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/finance",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx("button",{className:"btn btn-secondary",disabled:n,onClick:_,children:"Refresh"})]})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:F,className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher *"}),e.jsx("input",{className:"input mb-2",placeholder:"Search voucher no.",value:j,onChange:E=>N(E.target.value)}),e.jsxs("select",{className:"input",value:d,onChange:E=>u(E.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select"}),(j?b.filter(E=>String(E.voucher_no||"").toLowerCase().includes(j.toLowerCase())):b).slice(0,50).map(E=>e.jsxs("option",{value:E.id,children:[E.voucher_no," (",E.voucher_type_code,") -"," ",String(E.voucher_date).slice(0,10)]},E.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Instrument No. *"}),e.jsx("input",{className:"input",value:c,onChange:E=>h(E.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Instrument Date *"}),e.jsx("input",{className:"input",type:"date",value:m,onChange:E=>p(E.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Bank Account"}),e.jsxs("select",{className:"input",value:g,onChange:E=>x(E.target.value),children:[e.jsx("option",{value:"",children:"Select"}),r.map(E=>e.jsxs("option",{value:E.id,children:[E.name," (",E.account_number||"No Acc",")"]},E.id))]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{className:"btn-success",children:"Add PDC"})})]})})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:l,onChange:E=>o(E.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"HELD",children:"Held"}),e.jsx("option",{value:"POSTED",children:"Posted"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Instrument No."}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Voucher"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[t.map(E=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:E.instrument_no}),e.jsx("td",{children:String(E.instrument_date).slice(0,10)}),e.jsx("td",{children:E.voucher_no}),e.jsx("td",{children:e.jsx("span",{className:"badge",children:E.status})}),e.jsx("td",{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(Re,{to:`/finance/pdc-postings/${E.id}`,className:"btn btn-secondary",children:"Edit"}),E.status==="HELD"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn",onClick:()=>I(E,"POSTED"),children:"Post"}),e.jsx("button",{className:"btn",onClick:()=>I(E,"CANCELLED"),children:"Cancel"}),e.jsx("button",{className:"btn",onClick:()=>w(E),children:"Delete"})]})]})})]},E.id)),t.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-6 text-slate-600",children:"No PDCs found"})})]})]})})]})})]})}function Dte(){var x;const{id:t}=Ps(),[s,r]=f.useState(!0),[a,n]=f.useState(null),[i,l]=f.useState([]),[o,d]=f.useState({}),[u,c]=f.useState([]),[h,m]=f.useState("");async function p(){var b,y,j,N;try{r(!0);const[_,F]=await Promise.all([Z.get("/finance/pdc-postings"),Z.get("/finance/bank-accounts")]),I=(((b=_.data)==null?void 0:b.items)||[]).find(w=>Number(w.id)===Number(t));n(I||null),d({}),l(((y=F.data)==null?void 0:y.items)||[])}catch(_){ct.error(((N=(j=_==null?void 0:_.response)==null?void 0:j.data)==null?void 0:N.message)||"Failed to load PDC")}finally{r(!1)}}f.useEffect(()=>{p()},[t]),f.useEffect(()=>{(async()=>{var b;try{const y=await Z.get("/finance/vouchers");c(((b=y.data)==null?void 0:b.items)||[])}catch{}})()},[]);async function g(){var j,N;if(o.instrument_date!==void 0&&!String(o.instrument_date).trim()||!(a!=null&&a.instrument_date)&&o.instrument_date===void 0){ct.error("Instrument Date is required");return}const b=o.voucher_id===void 0||o.voucher_id===""?a==null?void 0:a.voucher_id:Number(o.voucher_id),y=o.instrument_date===void 0||!String(o.instrument_date).trim()?a==null?void 0:a.instrument_date:o.instrument_date;if(b&&y){const _=u.find(F=>Number(F.id)===Number(b));if(_){const F=new Date(y),I=new Date(_.voucher_date);if(F<I){ct.error("Instrument Date must be on or after voucher date");return}}}try{await Z.put(`/finance/pdc-postings/${t}`,{voucherId:o.voucher_id===void 0?void 0:Number(o.voucher_id),instrumentNo:o.instrument_no||void 0,instrumentDate:o.instrument_date||void 0,bankAccountId:o.bank_account_id===void 0?void 0:o.bank_account_id?Number(o.bank_account_id):null,status:o.status||void 0}),ct.success("PDC updated"),p()}catch(_){ct.error(((N=(j=_==null?void 0:_.response)==null?void 0:j.data)==null?void 0:N.message)||"Failed to update PDC")}}return!a&&!s?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h1",{className:"text-2xl font-bold",children:"PDC Not Found"})}),e.jsx("div",{className:"card-body",children:e.jsx(Re,{to:"/finance/pdc-postings",className:"btn",children:"Back to List"})})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Edit Post-Dated Cheque"}),e.jsx("p",{className:"text-sm mt-1",children:a==null?void 0:a.instrument_no})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/finance",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/finance/pdc-postings",className:"btn btn-secondary",children:"Back to List"}),e.jsx("button",{className:"btn btn-secondary",disabled:s,onClick:p,children:"Refresh"})]})]})}),a&&e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher"}),e.jsx("input",{className:"input mb-2",placeholder:"Search voucher no.",value:h,onChange:b=>m(b.target.value)}),e.jsxs("select",{className:"input",value:o.voucher_id===void 0?a.voucher_id??"":o.voucher_id,onChange:b=>d(y=>({...y,voucher_id:b.target.value})),children:[e.jsx("option",{value:"",children:"Select"}),(h?u.filter(b=>String(b.voucher_no||"").toLowerCase().includes(h.toLowerCase())):u).slice(0,50).map(b=>e.jsxs("option",{value:b.id,children:[b.voucher_no," (",b.voucher_type_code,") -"," ",String(b.voucher_date).slice(0,10)]},b.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Instrument No."}),e.jsx("input",{className:"input",value:o.instrument_no===void 0?a.instrument_no??"":o.instrument_no,onChange:b=>d(y=>({...y,instrument_no:b.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Instrument Date"}),e.jsx("input",{className:"input",type:"date",value:o.instrument_date===void 0?(x=a.instrument_date)==null?void 0:x.slice(0,10):o.instrument_date,onChange:b=>d(y=>({...y,instrument_date:b.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Bank Account"}),e.jsxs("select",{className:"input",value:o.bank_account_id===void 0?a.bank_account_id??"":o.bank_account_id,onChange:b=>d(y=>({...y,bank_account_id:b.target.value})),children:[e.jsx("option",{value:"",children:"Select"}),i.map(b=>e.jsxs("option",{value:b.id,children:[b.name," (",b.account_number||"No Acc",")"]},b.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:o.status===void 0?a.status:o.status,onChange:b=>d(y=>({...y,status:b.target.value})),children:[e.jsx("option",{value:"HELD",children:"Held"}),e.jsx("option",{value:"POSTED",children:"Posted"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{className:"btn-success",onClick:g,children:"Save"})})]})})})]})}function Pte(){return e.jsxs(hl,{children:[e.jsx(tt,{path:"/",element:e.jsx(dte,{})}),e.jsx(tt,{path:"/journal-voucher",element:e.jsx(ou,{voucherTypeCode:"JV",title:"Journal Entry"})}),e.jsx(tt,{path:"/journal-voucher/create",element:e.jsx(Ai,{voucherTypeCode:"JV",title:"New Journal Entry"})}),e.jsx(tt,{path:"/journal-voucher/:id",element:e.jsx(Ai,{voucherTypeCode:"JV",title:"Journal Entry"})}),e.jsx(tt,{path:"/payment-voucher",element:e.jsx(ou,{voucherTypeCode:"PV",title:"Make Payment"})}),e.jsx(tt,{path:"/payment-voucher/create",element:e.jsx(Ai,{voucherTypeCode:"PV",title:"Make Payment"})}),e.jsx(tt,{path:"/payment-voucher/:id",element:e.jsx(Ai,{voucherTypeCode:"PV",title:"Make Payment"})}),e.jsx(tt,{path:"/receipt-voucher",element:e.jsx(ou,{voucherTypeCode:"RV",title:"Receive Payment"})}),e.jsx(tt,{path:"/receipt-voucher/create",element:e.jsx(Ai,{voucherTypeCode:"RV",title:"Receive Payment"})}),e.jsx(tt,{path:"/receipt-voucher/:id",element:e.jsx(Ai,{voucherTypeCode:"RV",title:"Receive Payment"})}),e.jsx(tt,{path:"/contra-voucher",element:e.jsx(ou,{voucherTypeCode:"CV",title:"Account Transfer"})}),e.jsx(tt,{path:"/contra-voucher/create",element:e.jsx(Ai,{voucherTypeCode:"CV",title:"Account Transfer"})}),e.jsx(tt,{path:"/contra-voucher/:id",element:e.jsx(Ai,{voucherTypeCode:"CV",title:"Account Transfer"})}),e.jsx(tt,{path:"/sales-voucher",element:e.jsx(ou,{voucherTypeCode:"SV",title:"Sales Vouchers"})}),e.jsx(tt,{path:"/sales-voucher/create",element:e.jsx(Ai,{voucherTypeCode:"SV",title:"New Sales Voucher"})}),e.jsx(tt,{path:"/sales-voucher/:id",element:e.jsx(Ai,{voucherTypeCode:"SV",title:"Sales Vouchers"})}),e.jsx(tt,{path:"/purchase-voucher",element:e.jsx(ou,{voucherTypeCode:"PUV",title:"Purchase Vouchers"})}),e.jsx(tt,{path:"/purchase-voucher/create",element:e.jsx(Ai,{voucherTypeCode:"PUV",title:"New Purchase Voucher"})}),e.jsx(tt,{path:"/purchase-voucher/:id",element:e.jsx(Ai,{voucherTypeCode:"PUV",title:"Purchase Vouchers"})}),e.jsx(tt,{path:"/debit-note",element:e.jsx(ou,{voucherTypeCode:"DN",title:"Debit Notes"})}),e.jsx(tt,{path:"/debit-note/create",element:e.jsx(Ai,{voucherTypeCode:"DN",title:"New Debit Note"})}),e.jsx(tt,{path:"/debit-note/:id",element:e.jsx(Ai,{voucherTypeCode:"DN",title:"Debit Notes"})}),e.jsx(tt,{path:"/credit-note",element:e.jsx(ou,{voucherTypeCode:"CN",title:"Credit Notes"})}),e.jsx(tt,{path:"/credit-note/create",element:e.jsx(Ai,{voucherTypeCode:"CN",title:"New Credit Note"})}),e.jsx(tt,{path:"/credit-note/:id",element:e.jsx(Ai,{voucherTypeCode:"CN",title:"Credit Notes"})}),e.jsx(tt,{path:"/account-groups",element:e.jsx(Ste,{})}),e.jsx(tt,{path:"/accounts",element:e.jsx(xC,{})}),e.jsx(tt,{path:"/coa",element:e.jsx(xC,{})}),e.jsx(tt,{path:"/tax-codes",element:e.jsx(Cte,{})}),e.jsx(tt,{path:"/cost-centers",element:e.jsx(Fte,{})}),e.jsx(tt,{path:"/currencies",element:e.jsx(kte,{})}),e.jsx(tt,{path:"/fiscal-years",element:e.jsx(Bte,{})}),e.jsx(tt,{path:"/bank-reconciliation",element:e.jsx(Tte,{})}),e.jsx(tt,{path:"/bank-reconciliation/:id",element:e.jsx(Ite,{})}),e.jsx(tt,{path:"/pdc-postings",element:e.jsx(Lte,{})}),e.jsx(tt,{path:"/pdc-postings/:id",element:e.jsx(Dte,{})}),e.jsx(tt,{path:"/reports",element:e.jsx(pC,{})}),e.jsx(tt,{path:"/reports/voucher-register",element:e.jsx(pC,{})}),e.jsx(tt,{path:"/reports/trial-balance",element:e.jsx(hte,{})}),e.jsx(tt,{path:"/reports/journals",element:e.jsx(Ate,{})}),e.jsx(tt,{path:"/reports/general-ledger",element:e.jsx(fte,{})}),e.jsx(tt,{path:"/reports/payment-due",element:e.jsx(vte,{})}),e.jsx(tt,{path:"/reports/customer-outstanding",element:e.jsx(bte,{})}),e.jsx(tt,{path:"/reports/audit-trail",element:e.jsx(yte,{})}),e.jsx(tt,{path:"/reports/debtors-ledger",element:e.jsx(jte,{})}),e.jsx(tt,{path:"/reports/creditors-ledger",element:e.jsx(Nte,{})}),e.jsx(tt,{path:"/reports/supplier-outstanding",element:e.jsx(wte,{})}),e.jsx(tt,{path:"/reports/ratio-analysis",element:e.jsx(_te,{})}),e.jsx(tt,{path:"/reports/profit-and-loss",element:e.jsx(pte,{})}),e.jsx(tt,{path:"/reports/balance-sheet",element:e.jsx(xte,{})}),e.jsx(tt,{path:"/reports/cash-flow",element:e.jsx(gte,{})}),e.jsx(tt,{path:"*",element:e.jsx(dd,{to:"/finance",replace:!0})})]})}function Ute(){const t=ps(),{canPerformAction:s}=Ls(),[r,a]=f.useState([]),[n,i]=f.useState(!0),[l,o]=f.useState(""),[d,u]=f.useState(""),[c,h]=f.useState("ALL"),[m,p]=f.useState("ALL");f.useEffect(()=>{g()},[]);const g=async()=>{var N,_,F;try{i(!0),o("");const I=await Z.get("/hr/employees");a(Array.isArray((N=I.data)==null?void 0:N.items)?I.data.items:[])}catch(I){o(((F=(_=I==null?void 0:I.response)==null?void 0:_.data)==null?void 0:F.message)||"Error fetching employees"),console.error("Error fetching employees:",I)}finally{i(!1)}},x=N=>N?e.jsx("span",{className:"badge badge-success",children:"ACTIVE"}):e.jsx("span",{className:"badge badge-error",children:"INACTIVE"}),b=N=>{const _={PERMANENT:"badge badge-success",CONTRACT:"badge badge-info",TEMPORARY:"badge badge-warning",INTERN:"badge bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300"};return e.jsx("span",{className:_[N]||"badge",children:N})},y=r.filter(N=>{const _=String(N.emp_no||"").toLowerCase().includes(d.toLowerCase())||String(N.full_name||"").toLowerCase().includes(d.toLowerCase())||String(N.email||"").toLowerCase().includes(d.toLowerCase()),F=c==="ALL"||(c==="ACTIVE"?N.is_active:!N.is_active),I=m==="ALL"||N.department===m;return _&&F&&I}),j=["ALL",...new Set(r.map(N=>N.department).filter(Boolean))];return n?e.jsx("div",{className:"text-center py-8",children:"Loading employees..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Employee Setup"}),e.jsx("p",{className:"text-sm mt-1",children:"Manage employee records and information"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/human-resources",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/human-resources/employees/new",className:"btn-success",children:"+ New Employee"})]})]})})}),l&&e.jsx("div",{className:"alert alert-error",children:e.jsx("span",{children:l})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by employee number, name, or email...",className:"input",value:d,onChange:N=>u(N.target.value)})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsx("select",{className:"input",value:m,onChange:N=>p(N.target.value),children:j.map(N=>e.jsx("option",{value:N,children:N==="ALL"?"All Departments":N},N))})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs("select",{className:"input",value:c,onChange:N=>h(N.target.value),children:[e.jsx("option",{value:"ALL",children:"All Status"}),e.jsx("option",{value:"ACTIVE",children:"Active"}),e.jsx("option",{value:"INACTIVE",children:"Inactive"})]})})]}),n?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-brand"}),e.jsx("p",{className:"mt-2",children:"Loading employees..."})]}):y.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"No employees found."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Emp No"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Designation"}),e.jsx("th",{children:"Department"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:y.map(N=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:N.emp_no}),e.jsx("td",{children:N.full_name}),e.jsx("td",{children:N.designation}),e.jsx("td",{children:N.department}),e.jsx("td",{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:N.email}),e.jsx("div",{className:"text-slate-500",children:N.contact_no})]})}),e.jsx("td",{children:b(N.employment_type)}),e.jsx("td",{children:x(N.is_active)}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[s("human-resources:employees","view")&&e.jsx("button",{onClick:()=>t(`/human-resources/employees/${N.id}`),className:"text-brand hover:text-brand-600 font-medium text-sm",children:"View"}),s("human-resources:employees","edit")&&e.jsx("button",{onClick:()=>t(`/human-resources/employees/${N.id}`),className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:"Edit"})]})})]},N.id))})]})})]})})]})}function gC(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState(""),[o,d]=f.useState({emp_no:"",full_name:"",designation:"",department:"",email:"",contact_no:"",employment_type:"PERMANENT",date_joined:new Date().toISOString().split("T")[0],is_active:1});f.useEffect(()=>{r&&u()},[s]);async function u(){var m,p,g;try{n(!0),l("");const x=await Z.get(`/hr/employees/${s}`);(m=x.data)!=null&&m.item&&d(x.data.item)}catch(x){l(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Error fetching employee")}finally{n(!1)}}function c(m,p){d(g=>({...g,[m]:p}))}async function h(m){var p,g;m.preventDefault(),n(!0),l("");try{r?await Z.put(`/hr/employees/${s}`,o):await Z.post("/hr/employees",o),t("/human-resources/employees")}catch(x){l(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Error saving employee")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"Edit Employee":"New Employee"}),e.jsx("p",{className:"text-sm mt-1",children:"Employee setup and configuration"})]}),e.jsx(Re,{to:"/human-resources/employees",className:"btn-success",children:"Back"})]})})}),e.jsx("form",{onSubmit:h,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[i&&e.jsx("div",{className:"alert alert-error mb-4",children:i}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Employee No"}),e.jsx("input",{className:"input",value:o.emp_no,onChange:m=>c("emp_no",m.target.value),placeholder:"Auto-generated"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Full Name *"}),e.jsx("input",{className:"input",value:o.full_name,onChange:m=>c("full_name",m.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Designation"}),e.jsx("input",{className:"input",value:o.designation,onChange:m=>c("designation",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Department"}),e.jsx("input",{className:"input",value:o.department,onChange:m=>c("department",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Email"}),e.jsx("input",{className:"input",type:"email",value:o.email,onChange:m=>c("email",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Contact No"}),e.jsx("input",{className:"input",value:o.contact_no,onChange:m=>c("contact_no",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Employment Type"}),e.jsxs("select",{className:"input",value:o.employment_type,onChange:m=>c("employment_type",m.target.value),children:[e.jsx("option",{value:"PERMANENT",children:"Permanent"}),e.jsx("option",{value:"CONTRACT",children:"Contract"}),e.jsx("option",{value:"TEMPORARY",children:"Temporary"}),e.jsx("option",{value:"INTERN",children:"Intern"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Date Joined"}),e.jsx("input",{className:"input",type:"date",value:o.date_joined,onChange:m=>c("date_joined",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Active"}),e.jsxs("select",{className:"input",value:String(o.is_active),onChange:m=>c("is_active",Number(m.target.value)),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(Re,{to:"/human-resources/employees",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",type:"submit",disabled:a,children:a?"Saving...":"Save Employee"})]})]})})})]})}function Rte(){const{canPerformAction:t}=Ls(),s=[{id:1,code:"ANNUAL",name:"Annual Leave",daysPerYear:21,active:!0},{id:2,code:"SICK",name:"Sick Leave",daysPerYear:10,active:!0}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Leave Setup"}),e.jsx("p",{className:"text-sm mt-1",children:"Configure leave types and balances"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/human-resources",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/human-resources/leave-setup/new",className:"btn-success",children:"+ New Leave Type"})]})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Days/Year"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:r.code}),e.jsx("td",{children:r.name}),e.jsx("td",{children:r.daysPerYear}),e.jsx("td",{children:r.active?e.jsx("span",{className:"badge badge-success",children:"Active"}):e.jsx("span",{className:"badge badge-error",children:"Inactive"})}),e.jsxs("td",{children:[t("human-resources:leave-setup","view")&&e.jsx(Re,{to:`/human-resources/leave-setup/${r.id}?mode=view`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"View"}),t("human-resources:leave-setup","edit")&&e.jsx(Re,{to:`/human-resources/leave-setup/${r.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"})]})]},r.id))})]})})})})]})}function vC(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState({code:"",name:"",daysPerYear:0,active:!0});f.useEffect(()=>{r&&(n(!0),setTimeout(()=>{l({code:"ANNUAL",name:"Annual Leave",daysPerYear:21,active:!0}),n(!1)},150))},[r]);function o(u,c){l(h=>({...h,[u]:c}))}async function d(u){u.preventDefault(),n(!0);try{t("/human-resources/leave-setup")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"Edit Leave Type":"New Leave Type"}),e.jsx("p",{className:"text-sm mt-1",children:"Leave configuration"})]}),e.jsx(Re,{to:"/human-resources/leave-setup",className:"btn-success",children:"Back"})]})}),e.jsx("form",{onSubmit:d,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Code *"}),e.jsx("input",{className:"input",value:i.code,onChange:u=>o("code",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Name *"}),e.jsx("input",{className:"input",value:i.name,onChange:u=>o("name",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Days per Year"}),e.jsx("input",{className:"input",type:"number",min:"0",value:i.daysPerYear,onChange:u=>o("daysPerYear",Number(u.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:i.active?"1":"0",onChange:u=>o("active",u.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/human-resources/leave-setup",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",type:"submit",disabled:a,children:a?"Saving...":"Save"})]})]})})})]})}function Ote(){const{canPerformAction:t}=Ls(),s=[{id:1,code:"DAY",name:"Day Shift",start:"08:00",end:"17:00",active:!0},{id:2,code:"NIGHT",name:"Night Shift",start:"20:00",end:"05:00",active:!0}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Shift System Setup"}),e.jsx("p",{className:"text-sm mt-1",children:"Manage work shifts"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/human-resources",className:"btn btn-secondary",children:"Return to Menu"}),t("human-resources:shifts","create")&&e.jsx(Re,{to:"/human-resources/shifts/new",className:"btn-success",children:"+ New Shift"})]})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Start"}),e.jsx("th",{children:"End"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:r.code}),e.jsx("td",{children:r.name}),e.jsx("td",{children:r.start}),e.jsx("td",{children:r.end}),e.jsx("td",{children:r.active?e.jsx("span",{className:"badge badge-success",children:"Active"}):e.jsx("span",{className:"badge badge-error",children:"Inactive"})}),e.jsx("td",{children:t("human-resources:shifts","edit")&&e.jsx(Re,{to:`/human-resources/shifts/${r.id}`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"Edit"})})]},r.id))})]})})})})]})}function bC(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState({code:"",name:"",start:"08:00",end:"17:00",active:!0});f.useEffect(()=>{r&&(n(!0),setTimeout(()=>{l({code:"DAY",name:"Day Shift",start:"08:00",end:"17:00",active:!0}),n(!1)},150))},[r]);function o(u,c){l(h=>({...h,[u]:c}))}async function d(u){u.preventDefault(),n(!0);try{t("/human-resources/shifts")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"Edit Shift":"New Shift"}),e.jsx("p",{className:"text-sm mt-1",children:"Shift configuration"})]}),e.jsx(Re,{to:"/human-resources/shifts",className:"btn-success",children:"Back"})]})}),e.jsx("form",{onSubmit:d,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Code *"}),e.jsx("input",{className:"input",value:i.code,onChange:u=>o("code",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Name *"}),e.jsx("input",{className:"input",value:i.name,onChange:u=>o("name",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Start Time"}),e.jsx("input",{className:"input",type:"time",value:i.start,onChange:u=>o("start",u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"End Time"}),e.jsx("input",{className:"input",type:"time",value:i.end,onChange:u=>o("end",u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:i.active?"1":"0",onChange:u=>o("active",u.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/human-resources/shifts",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",type:"submit",disabled:a,children:a?"Saving...":"Save"})]})]})})})]})}function Mte(){const{canPerformAction:t}=Ls(),s=[{id:1,emp:"EMP-001",name:"John Doe",date:"2025-01-02",status:"PRESENT"},{id:2,emp:"EMP-002",name:"Jane Smith",date:"2025-01-02",status:"PRESENT"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Attendance System"}),e.jsx("p",{className:"text-sm mt-1",children:"Track employee attendance"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/human-resources",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/human-resources/attendance/new",className:"btn-success",children:"+ New Entry"})]})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Emp No"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:r.emp}),e.jsx("td",{children:r.name}),e.jsx("td",{children:new Date(r.date).toLocaleDateString()}),e.jsx("td",{children:r.status}),e.jsxs("td",{children:[t("human-resources:attendance","view")&&e.jsx(Re,{to:`/human-resources/attendance/${r.id}?mode=view`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"View"}),t("human-resources:attendance","edit")&&e.jsx(Re,{to:`/human-resources/attendance/${r.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"})]})]},r.id))})]})})})})]})}function yC(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState({empNo:"",date:new Date().toISOString().split("T")[0],status:"PRESENT"});f.useEffect(()=>{r&&(n(!0),setTimeout(()=>{l({empNo:"EMP-001",date:"2025-01-02",status:"PRESENT"}),n(!1)},150))},[r]);function o(u,c){l(h=>({...h,[u]:c}))}async function d(u){u.preventDefault(),n(!0);try{t("/human-resources/attendance")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"Edit Attendance":"New Attendance"}),e.jsx("p",{className:"text-sm mt-1",children:"Attendance entry"})]}),e.jsx(Re,{to:"/human-resources/attendance",className:"btn-success",children:"Back"})]})}),e.jsx("form",{onSubmit:d,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Employee No *"}),e.jsx("input",{className:"input",value:i.empNo,onChange:u=>o("empNo",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Date *"}),e.jsx("input",{className:"input",type:"date",value:i.date,onChange:u=>o("date",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:i.status,onChange:u=>o("status",u.target.value),children:[e.jsx("option",{value:"PRESENT",children:"Present"}),e.jsx("option",{value:"ABSENT",children:"Absent"}),e.jsx("option",{value:"LEAVE",children:"Leave"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/human-resources/attendance",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",type:"submit",disabled:a,children:a?"Saving...":"Save"})]})]})})})]})}function Qte(){const{canPerformAction:t}=Ls(),s=[{id:1,name:"Standard Monthly",currency:"GHS",active:!0}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Salary Configuration"}),e.jsx("p",{className:"text-sm mt-1",children:"Define salary structures and components"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/human-resources",className:"btn btn-secondary",children:"Return to Menu"}),t("human-resources:salary-config","create")&&e.jsx(Re,{to:"/human-resources/salary-config/new",className:"btn-success",children:"+ New Config"})]})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Currency"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:r.name}),e.jsx("td",{children:r.currency}),e.jsx("td",{children:r.active?e.jsx("span",{className:"badge badge-success",children:"Active"}):e.jsx("span",{className:"badge badge-error",children:"Inactive"})}),e.jsx("td",{children:t("human-resources:salary-config","edit")&&e.jsx(Re,{to:`/human-resources/salary-config/${r.id}`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"Edit"})})]},r.id))})]})})})})]})}function jC(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState({name:"",currency:"GHS",active:!0});f.useEffect(()=>{r&&(n(!0),setTimeout(()=>{l({name:"Standard Monthly",currency:"GHS",active:!0}),n(!1)},150))},[r]);function o(u,c){l(h=>({...h,[u]:c}))}async function d(u){u.preventDefault(),n(!0);try{t("/human-resources/salary-config")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"Edit Salary Config":"New Salary Config"}),e.jsx("p",{className:"text-sm mt-1",children:"Salary config setup"})]}),e.jsx(Re,{to:"/human-resources/salary-config",className:"btn-success",children:"Back"})]})}),e.jsx("form",{onSubmit:d,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Name *"}),e.jsx("input",{className:"input",value:i.name,onChange:u=>o("name",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Currency"}),e.jsx("input",{className:"input",value:i.currency,onChange:u=>o("currency",u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:i.active?"1":"0",onChange:u=>o("active",u.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/human-resources/salary-config",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",type:"submit",disabled:a,children:a?"Saving...":"Save"})]})]})})})]})}function Hte(){const{canPerformAction:t}=Ls(),s=[{id:1,name:"Income Tax",active:!0},{id:2,name:"Social Security",active:!0},{id:3,name:"Tier 3",active:!0}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Tax & Deductions"}),e.jsx("p",{className:"text-sm mt-1",children:"Configure payroll deductions"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/human-resources",className:"btn btn-secondary",children:"Return to Menu"}),t("human-resources:tax-config","create")&&e.jsx(Re,{to:"/human-resources/tax-config/new",className:"btn-success",children:"+ New Config"})]})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:r.name}),e.jsx("td",{children:r.active?e.jsx("span",{className:"badge badge-success",children:"Active"}):e.jsx("span",{className:"badge badge-error",children:"Inactive"})}),e.jsx("td",{children:t("human-resources:tax-config","edit")&&e.jsx(Re,{to:`/human-resources/tax-config/${r.id}`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"Edit"})})]},r.id))})]})})})})]})}function NC(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState({name:"",ratePercent:0,active:!0});f.useEffect(()=>{r&&(n(!0),setTimeout(()=>{l({name:"Income Tax",ratePercent:0,active:!0}),n(!1)},150))},[r]);function o(u,c){l(h=>({...h,[u]:c}))}async function d(u){u.preventDefault(),n(!0);try{t("/human-resources/tax-config")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"Edit Tax Config":"New Tax Config"}),e.jsx("p",{className:"text-sm mt-1",children:"Tax and deduction setup"})]}),e.jsx(Re,{to:"/human-resources/tax-config",className:"btn-success",children:"Back"})]})}),e.jsx("form",{onSubmit:d,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Name *"}),e.jsx("input",{className:"input",value:i.name,onChange:u=>o("name",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Rate (%)"}),e.jsx("input",{className:"input",type:"number",step:"0.01",min:"0",value:i.ratePercent,onChange:u=>o("ratePercent",Number(u.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:i.active?"1":"0",onChange:u=>o("active",u.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/human-resources/tax-config",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",type:"submit",disabled:a,children:a?"Saving...":"Save"})]})]})})})]})}function qte(){const{canPerformAction:t}=Ls(),s=[{id:1,name:"Transport Allowance",amount:200,active:!0}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Employee Allowances"}),e.jsx("p",{className:"text-sm mt-1",children:"Allowance setup (placeholder)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/human-resources",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/human-resources/allowances/new",className:"btn-success",children:"+ New"})]})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{className:"text-right",children:"Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:r.name}),e.jsx("td",{className:"text-right",children:Number(r.amount).toFixed(2)}),e.jsx("td",{children:r.active?e.jsx("span",{className:"badge badge-success",children:"Active"}):e.jsx("span",{className:"badge badge-error",children:"Inactive"})}),e.jsxs("td",{children:[t("human-resources:allowances","view")&&e.jsx(Re,{className:"text-brand hover:text-brand-600 text-sm font-medium",to:`/human-resources/allowances/${r.id}?mode=view`,children:"View"}),t("human-resources:allowances","edit")&&e.jsx(Re,{className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",to:`/human-resources/allowances/${r.id}?mode=edit`,children:"Edit"})]})]},r.id))})]})})})]})}function wC(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState({name:"",amount:0,active:!0});f.useEffect(()=>{r&&(n(!0),setTimeout(()=>{l({name:"Transport Allowance",amount:200,active:!0}),n(!1)},150))},[r]);function o(u,c){l(h=>({...h,[u]:c}))}async function d(u){u.preventDefault(),n(!0);try{t("/human-resources/allowances")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"Edit Allowance":"New Allowance"})}),e.jsx(Re,{to:"/human-resources/allowances",className:"btn-success",children:"Back"})]})}),e.jsx("form",{onSubmit:d,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Name *"}),e.jsx("input",{className:"input",value:i.name,onChange:u=>o("name",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Amount"}),e.jsx("input",{className:"input",type:"number",step:"0.01",min:"0",value:i.amount,onChange:u=>o("amount",Number(u.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:i.active?"1":"0",onChange:u=>o("active",u.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{className:"btn-success",to:"/human-resources/allowances",children:"Cancel"}),e.jsx("button",{className:"btn-success",disabled:a,children:a?"Saving...":"Save"})]})]})})})]})}function $te(){const{canPerformAction:t}=Ls(),s=[{id:1,employee:"John Doe",amount:1e3,balance:600,status:"ACTIVE"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Employee Loans"}),e.jsx("p",{className:"text-sm mt-1",children:"Loan setup and tracking (placeholder)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/human-resources",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/human-resources/loans/new",className:"btn-success",children:"+ New"})]})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Employee"}),e.jsx("th",{className:"text-right",children:"Amount"}),e.jsx("th",{className:"text-right",children:"Balance"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:r.employee}),e.jsx("td",{className:"text-right",children:Number(r.amount).toFixed(2)}),e.jsx("td",{className:"text-right",children:Number(r.balance).toFixed(2)}),e.jsx("td",{children:r.status}),e.jsxs("td",{children:[t("human-resources:loans","view")&&e.jsx(Re,{to:`/human-resources/loans/${r.id}?mode=view`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"View"}),t("human-resources:loans","edit")&&e.jsx(Re,{to:`/human-resources/loans/${r.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"})]})]},r.id))})]})})})]})}function _C(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState({employee:"",amount:0,status:"ACTIVE"});f.useEffect(()=>{r&&(n(!0),setTimeout(()=>{l({employee:"John Doe",amount:1e3,status:"ACTIVE"}),n(!1)},150))},[r]);function o(u,c){l(h=>({...h,[u]:c}))}async function d(u){u.preventDefault(),n(!0);try{t("/human-resources/loans")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"Edit Loan":"New Loan"})}),e.jsx(Re,{to:"/human-resources/loans",className:"btn-success",children:"Back"})]})}),e.jsx("form",{onSubmit:d,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Employee *"}),e.jsx("input",{className:"input",value:i.employee,onChange:u=>o("employee",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Amount"}),e.jsx("input",{className:"input",type:"number",step:"0.01",min:"0",value:i.amount,onChange:u=>o("amount",Number(u.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:i.status,onChange:u=>o("status",u.target.value),children:[e.jsx("option",{value:"ACTIVE",children:"Active"}),e.jsx("option",{value:"CLOSED",children:"Closed"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/human-resources/loans",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",disabled:a,children:a?"Saving...":"Save"})]})]})})})]})}function Vte(){const{canPerformAction:t}=Ls(),[s]=f.useState([{id:1,period:"2025-01",employee:"John Doe",netPay:2500,status:"GENERATED"}]),[r,a]=f.useState({name:"",address:"",logoUrl:""});f.useEffect(()=>{let u=!0;async function c(){var h,m,p;try{const x=(m=(h=(await Z.get("/admin/me")).data)==null?void 0:h.scope)==null?void 0:m.companyId;if(!x)return;const y=((p=(await Z.get(`/admin/companies/${x}`)).data)==null?void 0:p.item)||{},j=y.has_logo===1||y.has_logo===!0?`/api/admin/companies/${x}/logo`:"";if(!u)return;a({name:String(y.name||""),address:String(y.address||""),logoUrl:String(j||"")})}catch{}}return c(),()=>{u=!1}},[]);function n(u){return String(u??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function i(u){return`<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Payslip</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 16px; color: #0f172a; }
      table { border-collapse: collapse; width: 100%; }
      th, td { border: 1px solid #e2e8f0; padding: 6px 8px; vertical-align: top; }
      th { background: #f8fafc; text-align: left; }
    </style>
  </head>
  <body>${u||""}</body>
</html>`}async function l(u){var h;const c=Array.from(((h=u==null?void 0:u.querySelectorAll)==null?void 0:h.call(u,"img"))||[]);c.length&&await Promise.all(c.map(m=>new Promise(p=>{if(m.complete)return p();const g=()=>p();m.addEventListener("load",g,{once:!0}),m.addEventListener("error",g,{once:!0})})))}async function o(u){var b;const c=`<div>
  <div style="font-weight:800;font-size:18px;">Payslip</div>
  <div>Period: ${n(String(u.period||""))}</div>
  <div>Employee: ${n(String(u.employee||""))}</div>
  <div>Net Pay: ${n(Number(u.netPay||0).toFixed(2))}</div>
  <div>Status: ${n(String(u.status||""))}</div>
</div>`,h=i(c),m=document.createElement("iframe");m.style.position="fixed",m.style.right="0",m.style.bottom="0",m.style.width="0",m.style.height="0",m.style.border="0",document.body.appendChild(m);const p=((b=m.contentWindow)==null?void 0:b.document)||m.contentDocument||null;if(!p){document.body.removeChild(m);return}p.open(),p.write(h),p.close();const g=m.contentWindow||window;setTimeout(()=>{g.focus();try{g.print()}catch{}setTimeout(()=>{document.body.removeChild(m)},100)},200)}async function d(u){const c=`<div>
  <div style="font-weight:800;font-size:18px;">Payslip</div>
  <div>Period: ${n(String(u.period||""))}</div>
  <div>Employee: ${n(String(u.employee||""))}</div>
  <div>Net Pay: ${n(Number(u.netPay||0).toFixed(2))}</div>
  <div>Status: ${n(String(u.status||""))}</div>
</div>`,h=document.createElement("div");h.style.position="fixed",h.style.left="-10000px",h.style.top="0",h.style.width="794px",h.style.background="white",h.style.padding="32px",h.innerHTML=c,document.body.appendChild(h);try{await l(h);const m=await wi(h,{scale:2,useCORS:!0}),p=m.toDataURL("image/png"),g=new hs("p","mm","a4"),x=g.internal.pageSize.getWidth(),b=g.internal.pageSize.getHeight(),y=x,j=m.height*y/m.width;let N=0;for(;N<j;)g.addImage(p,"PNG",0,-N,y,j),N+=b,N<j&&g.addPage();const _="Payslip_"+(String(u.period||"").replaceAll(" ","_")||new Date().toISOString().slice(0,10))+".pdf";g.save(_)}finally{document.body.removeChild(h)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Payslips"}),e.jsx("p",{className:"text-sm mt-1",children:"Payslip configuration (placeholder)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/human-resources",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/human-resources/payslips/new",className:"btn-success",children:"+ New"})]})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Period"}),e.jsx("th",{children:"Employee"}),e.jsx("th",{className:"text-right",children:"Net Pay"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.map(u=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:u.period}),e.jsx("td",{children:u.employee}),e.jsx("td",{className:"text-right",children:Number(u.netPay).toFixed(2)}),e.jsx("td",{children:u.status}),e.jsxs("td",{children:[t("human-resources:payslips","view")&&e.jsx(Re,{to:`/human-resources/payslips/${u.id}?mode=view`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"View"}),t("human-resources:payslips","edit")&&e.jsx(Re,{to:`/human-resources/payslips/${u.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"}),e.jsx("button",{type:"button",className:"ml-2 inline-flex items-center px-3 py-1.5 rounded bg-green-600 hover:bg-green-700 text-white text-xs font-semibold",onClick:()=>o(u),children:"Print"}),e.jsx("button",{type:"button",className:"ml-1 inline-flex items-center px-3 py-1.5 rounded bg-purple-600 hover:bg-purple-700 text-white text-xs font-semibold",onClick:()=>d(u),children:"PDF"})]})]},u.id))})]})})})]})}function jl(t){return String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Wte(t){return`<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Payslip</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 16px; color: #0f172a; }
      table { border-collapse: collapse; width: 100%; }
      th, td { border: 1px solid #e2e8f0; padding: 6px 8px; vertical-align: top; }
      th { background: #f8fafc; text-align: left; }
    </style>
  </head>
  <body>${t||""}</body>
</html>`}async function Gte(t){var r;const s=Array.from(((r=t==null?void 0:t.querySelectorAll)==null?void 0:r.call(t,"img"))||[]);s.length!==0&&await Promise.race([Promise.all(s.map(a=>new Promise(n=>{if(a.complete)return n();const i=()=>n();a.addEventListener("load",i,{once:!0}),a.addEventListener("error",i,{once:!0})}))),new Promise(a=>setTimeout(a,1500))])}function SC(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState({period:"",employee:"",netPay:0,status:"GENERATED"}),[o,d]=f.useState({name:"",address:"",logoUrl:""});f.useEffect(()=>{r&&(n(!0),setTimeout(()=>{l({period:"2025-01",employee:"John Doe",netPay:2500,status:"GENERATED"}),n(!1)},150))},[r]),f.useEffect(()=>{let g=!0;async function x(){var b,y,j;try{const _=(y=(b=(await Z.get("/admin/me")).data)==null?void 0:b.scope)==null?void 0:y.companyId;if(!_)return;const I=((j=(await Z.get(`/admin/companies/${_}`)).data)==null?void 0:j.item)||{},w=I.has_logo===1||I.has_logo===!0?`/api/admin/companies/${_}/logo`:"";if(!g)return;d({name:String(I.name||""),address:String(I.address||""),logoUrl:String(w||"")})}catch{}}return x(),()=>{g=!1}},[]);const u=f.useMemo(()=>{const g=String(o.logoUrl||"").trim(),x=g?`<img src="${g}" alt="${jl(o.name||"Company")}" style="max-height:80px;object-fit:contain;" />`:"";return{company:{name:o.name||"OmniSuite Ltd",address:o.address||"123 Business Rd",logoUrl:g,logoHtml:x},payslip:{period:String(i.period||""),employee:String(i.employee||""),netPay:Number(i.netPay||0).toFixed(2),status:String(i.status||"")}}},[i,o]);function c(g,x){l(b=>({...b,[g]:x}))}async function h(){var I;const g=jl(u.company.name),b=`<div style="display:flex;justify-content:space-between;align-items:flex-start;">
  <div>
    ${u.company.logoUrl?`<img src="${u.company.logoUrl}" alt="${g}" style="max-height:80px;object-fit:contain;" />`:""}
    <div style="font-weight:800;font-size:18px;">${g}</div>
    <div style="font-size:12px;color:#475569;">${jl(u.company.address)}</div>
  </div>
  <div style="text-align:right;">
    <div style="font-weight:800;font-size:20px;">PAYSLIP</div>
    <div style="font-size:12px;">Period: ${jl(u.payslip.period)}</div>
  </div>
</div>
<hr />
<div style="font-size:12px;margin-bottom:10px;"><strong>Employee:</strong> ${jl(u.payslip.employee)}</div>
<table style="font-size:12px;">
  <tbody>
    <tr><td>Net Pay</td><td style="text-align:right;">${jl(u.payslip.netPay)}</td></tr>
    <tr><td>Status</td><td style="text-align:right;">${jl(u.payslip.status)}</td></tr>
  </tbody>
</table>`,y=Wte(b),j=document.createElement("iframe");j.style.position="fixed",j.style.right="0",j.style.bottom="0",j.style.width="0",j.style.height="0",j.style.border="0",document.body.appendChild(j);const N=((I=j.contentWindow)==null?void 0:I.document)||j.contentDocument||null;if(!N){document.body.removeChild(j);return}N.open(),N.write(y),N.close();const _=j.contentWindow||window;setTimeout(()=>{_.focus();try{_.print()}catch{}setTimeout(()=>{document.body.removeChild(j)},100)},200)}async function m(){const g=jl(u.company.name),b=`<div style="display:flex;justify-content:space-between;align-items:flex-start;">
  <div>
    ${u.company.logoUrl?`<img src="${u.company.logoUrl}" alt="${g}" style="max-height:80px;object-fit:contain;" />`:""}
    <div style="font-weight:800;font-size:18px;">${g}</div>
    <div style="font-size:12px;color:#475569;">${jl(u.company.address)}</div>
  </div>
  <div style="text-align:right;">
    <div style="font-weight:800;font-size:20px;">PAYSLIP</div>
    <div style="font-size:12px;">Period: ${jl(u.payslip.period)}</div>
  </div>
</div>
<hr />
<div style="font-size:12px;margin-bottom:10px;"><strong>Employee:</strong> ${jl(u.payslip.employee)}</div>
<table style="font-size:12px;">
  <tbody>
    <tr><td>Net Pay</td><td style="text-align:right;">${jl(u.payslip.netPay)}</td></tr>
    <tr><td>Status</td><td style="text-align:right;">${jl(u.payslip.status)}</td></tr>
  </tbody>
</table>`,y=document.createElement("div");y.style.position="fixed",y.style.left="-10000px",y.style.top="0",y.style.width="794px",y.style.background="white",y.style.padding="32px",y.innerHTML=b,document.body.appendChild(y);try{await Gte(y);const j=await wi(y,{scale:2,useCORS:!0}),N=j.toDataURL("image/png"),_=new hs("p","mm","a4"),F=_.internal.pageSize.getWidth(),I=_.internal.pageSize.getHeight(),w=F,E=j.height*w/j.width;let W=0;for(;W<E;)_.addImage(N,"PNG",0,-W,w,E),W+=I,W<E&&_.addPage();const R="Payslip_"+(u.payslip.period||new Date().toISOString().slice(0,10))+".pdf";_.save(R)}finally{document.body.removeChild(y)}}async function p(g){g.preventDefault(),n(!0);try{t("/human-resources/payslips")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"Edit Payslip":"New Payslip"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:h,children:"Print"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:m,children:"Download PDF"}),e.jsx(Re,{to:"/human-resources/payslips",className:"btn-success",children:"Back"})]})]})}),e.jsx("form",{onSubmit:p,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Period *"}),e.jsx("input",{className:"input",value:i.period,onChange:g=>c("period",g.target.value),required:!0,placeholder:"YYYY-MM"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Employee *"}),e.jsx("input",{className:"input",value:i.employee,onChange:g=>c("employee",g.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Net Pay"}),e.jsx("input",{className:"input",type:"number",step:"0.01",min:"0",value:i.netPay,onChange:g=>c("netPay",Number(g.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:i.status,onChange:g=>c("status",g.target.value),children:[e.jsx("option",{value:"GENERATED",children:"Generated"}),e.jsx("option",{value:"PAID",children:"Paid"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/human-resources/payslips",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",disabled:a,children:a?"Saving...":"Save"})]})]})})})]})}function Kte(){const{canPerformAction:t}=Ls(),s=[{id:1,employee:"John Doe",effectiveDate:"2025-01-01",from:"Junior",to:"Senior"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Promotions"}),e.jsx("p",{className:"text-sm mt-1",children:"Track employee promotions (placeholder)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/human-resources",className:"btn btn-secondary",children:"Return to Menu"}),t("human-resources:promotions","create")&&e.jsx(Re,{to:"/human-resources/promotions/new",className:"btn-success",children:"+ New"})]})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Employee"}),e.jsx("th",{children:"Effective Date"}),e.jsx("th",{children:"From"}),e.jsx("th",{children:"To"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:r.employee}),e.jsx("td",{children:new Date(r.effectiveDate).toLocaleDateString()}),e.jsx("td",{children:r.from}),e.jsx("td",{children:r.to}),e.jsx("td",{children:t("human-resources:promotions","edit")&&e.jsx(Re,{to:`/human-resources/promotions/${r.id}`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"Edit"})})]},r.id))})]})})})]})}function CC(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState({employee:"",effectiveDate:new Date().toISOString().split("T")[0],from:"",to:""});f.useEffect(()=>{r&&(n(!0),setTimeout(()=>{l({employee:"John Doe",effectiveDate:"2025-01-01",from:"Junior",to:"Senior"}),n(!1)},150))},[r]);function o(u,c){l(h=>({...h,[u]:c}))}async function d(u){u.preventDefault(),n(!0);try{t("/human-resources/promotions")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"Edit Promotion":"New Promotion"})}),e.jsx(Re,{to:"/human-resources/promotions",className:"btn-success",children:"Back"})]})}),e.jsx("form",{onSubmit:d,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Employee *"}),e.jsx("input",{className:"input",value:i.employee,onChange:u=>o("employee",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Effective Date"}),e.jsx("input",{className:"input",type:"date",value:i.effectiveDate,onChange:u=>o("effectiveDate",u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{className:"input",value:i.from,onChange:u=>o("from",u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{className:"input",value:i.to,onChange:u=>o("to",u.target.value)})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/human-resources/promotions",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",disabled:a,children:a?"Saving...":"Save"})]})]})})})]})}function zte(){const{canPerformAction:t}=Ls(),s=[{id:1,provider:"Omni Health",policyName:"Standard Plan",active:!0}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Medical Policies"}),e.jsx("p",{className:"text-sm mt-1",children:"Employee medical policy setup (placeholder)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/human-resources",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/human-resources/medical-policies/new",className:"btn-success",children:"+ New"})]})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Provider"}),e.jsx("th",{children:"Policy"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:r.provider}),e.jsx("td",{children:r.policyName}),e.jsx("td",{children:r.active?e.jsx("span",{className:"badge badge-success",children:"Active"}):e.jsx("span",{className:"badge badge-error",children:"Inactive"})}),e.jsxs("td",{children:[t("human-resources:medical-policies","view")&&e.jsx(Re,{to:`/human-resources/medical-policies/${r.id}?mode=view`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"View"}),t("human-resources:medical-policies","edit")&&e.jsx(Re,{to:`/human-resources/medical-policies/${r.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"})]})]},r.id))})]})})})]})}function kC(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState({provider:"",policyName:"",active:!0});f.useEffect(()=>{r&&(n(!0),setTimeout(()=>{l({provider:"Omni Health",policyName:"Standard Plan",active:!0}),n(!1)},150))},[r]);function o(u,c){l(h=>({...h,[u]:c}))}async function d(u){u.preventDefault(),n(!0);try{t("/human-resources/medical-policies")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg flex justify-between items-center",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:r?"Edit Medical Policy":"New Medical Policy"})}),e.jsx(Re,{to:"/human-resources/medical-policies",className:"btn-success",children:"Back"})]})}),e.jsx("form",{onSubmit:d,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Provider *"}),e.jsx("input",{className:"input",value:i.provider,onChange:u=>o("provider",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Policy Name *"}),e.jsx("input",{className:"input",value:i.policyName,onChange:u=>o("policyName",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:i.active?"1":"0",onChange:u=>o("active",u.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/human-resources/medical-policies",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",disabled:a,children:a?"Saving...":"Save"})]})]})})})]})}function Yte(){const t=[{title:"Attendance Summary",description:"Attendance by date range (placeholder)"},{title:"Payroll Summary",description:"Gross vs deductions (placeholder)"},{title:"Leave Balances",description:"Remaining leave by employee (placeholder)"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg",children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"HR Reports"}),e.jsx("p",{className:"text-sm mt-1",children:"Attendance, payroll, and leave reports"})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map((s,r)=>e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:[e.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100",children:s.title}),e.jsx("div",{className:"text-sm mt-1",children:s.description})]},r))})})})]})}function Xte(){const[t,s]=Is.useState([{rbac_key:"active-employees",icon:"",value:"142",label:"Active Employees",change:"5 new this month",changeType:"positive",path:"/human-resources/employees"},{rbac_key:"on-leave",icon:"",value:"8",label:"On Leave",change:"Today",changeType:"neutral",path:"/human-resources/leave-setup"},{rbac_key:"payroll-status",icon:"",value:"Pending",label:"Payroll Status",change:"Due in 3 days",changeType:"negative",path:"/human-resources/payslips"}]);Is.useEffect(()=>{let a=!0;async function n(){var i,l,o,d,u,c,h,m,p;try{const g=await Z.get("/bi/dashboards"),x=Number(((o=(l=(i=g==null?void 0:g.data)==null?void 0:i.summary)==null?void 0:l.hr)==null?void 0:o.employees)||0),b=Number(((c=(u=(d=g==null?void 0:g.data)==null?void 0:d.summary)==null?void 0:u.hr)==null?void 0:c.on_leave)||0),y=String(((p=(m=(h=g==null?void 0:g.data)==null?void 0:h.summary)==null?void 0:m.hr)==null?void 0:p.payroll_status)||"").trim();a&&s(j=>{const N=[...j];return N[0]={...N[0],value:String(x)},N[1]={...N[1],value:String(b)},N[2]={...N[2],value:y||N[2].value},N})}catch{}}return n(),()=>{a=!1}},[]);const r=[{title:"Employee Management",features:[{name:"Employee Setup",path:"/human-resources/employees",description:"Manage employee records and information",icon:""},{name:"Promotions",path:"/human-resources/promotions",description:"Record employee promotions and salary changes",icon:""}]},{title:"Leave & Attendance",features:[{name:"Leave Setup",path:"/human-resources/leave-setup",description:"Configure leave types and employee leave balances",icon:""},{name:"Shift Management",path:"/human-resources/shifts",description:"Setup and manage work shifts",icon:""},{name:"Attendance",path:"/human-resources/attendance",description:"Track employee attendance and check-ins",icon:""}]},{title:"Payroll & Compensation",features:[{name:"Salary Configuration",path:"/human-resources/salary-config",description:"Setup salary components and structures",icon:""},{name:"Tax & Deductions",path:"/human-resources/tax-config",description:"Configure income tax, tier 3, and social security",icon:""},{name:"Employee Allowances",path:"/human-resources/allowances",description:"Manage employee allowances and benefits",icon:""},{name:"Employee Loans",path:"/human-resources/loans",description:"Track and manage employee loans",icon:""},{name:"Payslips",path:"/human-resources/payslips",description:"Generate and manage employee payslips",icon:""}]},{title:"Policies & Reports",features:[{name:"Medical Policies",path:"/human-resources/medical-policies",description:"Setup employee medical insurance policies",icon:""},{name:"HR Reports",path:"/human-resources/reports",description:"View attendance, payroll, and leave reports",icon:""}]}];return e.jsx(lo,{title:"Human Resources",description:"Employee management and payroll processing",stats:t,sections:r,features:Zte})}function Jte(){return e.jsxs(hl,{children:[e.jsx(tt,{index:!0,element:e.jsx(Xte,{})}),e.jsx(tt,{path:"employees",element:e.jsx(Ute,{})}),e.jsx(tt,{path:"employees/new",element:e.jsx(gC,{})}),e.jsx(tt,{path:"employees/:id",element:e.jsx(gC,{})}),e.jsx(tt,{path:"leave-setup",element:e.jsx(Rte,{})}),e.jsx(tt,{path:"leave-setup/new",element:e.jsx(vC,{})}),e.jsx(tt,{path:"leave-setup/:id",element:e.jsx(vC,{})}),e.jsx(tt,{path:"shifts",element:e.jsx(Ote,{})}),e.jsx(tt,{path:"shifts/new",element:e.jsx(bC,{})}),e.jsx(tt,{path:"shifts/:id",element:e.jsx(bC,{})}),e.jsx(tt,{path:"attendance",element:e.jsx(Mte,{})}),e.jsx(tt,{path:"attendance/new",element:e.jsx(yC,{})}),e.jsx(tt,{path:"attendance/:id",element:e.jsx(yC,{})}),e.jsx(tt,{path:"salary-config",element:e.jsx(Qte,{})}),e.jsx(tt,{path:"salary-config/new",element:e.jsx(jC,{})}),e.jsx(tt,{path:"salary-config/:id",element:e.jsx(jC,{})}),e.jsx(tt,{path:"tax-config",element:e.jsx(Hte,{})}),e.jsx(tt,{path:"tax-config/new",element:e.jsx(NC,{})}),e.jsx(tt,{path:"tax-config/:id",element:e.jsx(NC,{})}),e.jsx(tt,{path:"allowances",element:e.jsx(qte,{})}),e.jsx(tt,{path:"allowances/new",element:e.jsx(wC,{})}),e.jsx(tt,{path:"allowances/:id",element:e.jsx(wC,{})}),e.jsx(tt,{path:"loans",element:e.jsx($te,{})}),e.jsx(tt,{path:"loans/new",element:e.jsx(_C,{})}),e.jsx(tt,{path:"loans/:id",element:e.jsx(_C,{})}),e.jsx(tt,{path:"payslips",element:e.jsx(Vte,{})}),e.jsx(tt,{path:"payslips/new",element:e.jsx(SC,{})}),e.jsx(tt,{path:"payslips/:id",element:e.jsx(SC,{})}),e.jsx(tt,{path:"promotions",element:e.jsx(Kte,{})}),e.jsx(tt,{path:"promotions/new",element:e.jsx(CC,{})}),e.jsx(tt,{path:"promotions/:id",element:e.jsx(CC,{})}),e.jsx(tt,{path:"medical-policies",element:e.jsx(zte,{})}),e.jsx(tt,{path:"medical-policies/new",element:e.jsx(kC,{})}),e.jsx(tt,{path:"medical-policies/:id",element:e.jsx(kC,{})}),e.jsx(tt,{path:"reports",element:e.jsx(Yte,{})}),e.jsx(tt,{path:"*",element:e.jsx(dd,{to:"/human-resources",replace:!0})})]})}const Zte=[{module_key:"human-resources",label:"Employee Setup",path:"/human-resources/employees",type:"feature"},{module_key:"human-resources",label:"Promotions",path:"/human-resources/promotions",type:"feature"},{module_key:"human-resources",label:"Leave Setup",path:"/human-resources/leave-setup",type:"feature"},{module_key:"human-resources",label:"Shift Management",path:"/human-resources/shifts",type:"feature"},{module_key:"human-resources",label:"Attendance",path:"/human-resources/attendance",type:"feature"},{module_key:"human-resources",label:"Salary Configuration",path:"/human-resources/salary-config",type:"feature"},{module_key:"human-resources",label:"Tax & Deductions",path:"/human-resources/tax-config",type:"feature"},{module_key:"human-resources",label:"Employee Allowances",path:"/human-resources/allowances",type:"feature"},{module_key:"human-resources",label:"Employee Loans",path:"/human-resources/loans",type:"feature"},{module_key:"human-resources",label:"Payslips",path:"/human-resources/payslips",type:"feature"},{module_key:"human-resources",label:"Medical Policies",path:"/human-resources/medical-policies",type:"feature"},{module_key:"human-resources",label:"HR Reports",path:"/human-resources/reports",type:"dashboard"}];function ese(){const{canPerformAction:t}=Ls(),s=[{id:1,assetNo:"AST-001",name:"Generator",location:"Plant 1",status:"ACTIVE"},{id:2,assetNo:"AST-002",name:"Forklift",location:"Warehouse",status:"ACTIVE"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Assets"}),e.jsx("p",{className:"text-sm mt-1",children:"Register and manage maintainable assets"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/maintenance",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/maintenance/assets/new",className:"btn-success",children:"+ New Asset"})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Asset No"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Location"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:r.assetNo}),e.jsx("td",{children:r.name}),e.jsx("td",{children:r.location}),e.jsx("td",{children:r.status}),e.jsxs("td",{children:[t("maintenance:assets","view")&&e.jsx(Re,{to:`/maintenance/assets/${r.id}?mode=view`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"View"}),t("maintenance:assets","edit")&&e.jsx(Re,{to:`/maintenance/assets/${r.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"})]})]},r.id))})]})})})]})}function EC(){const t=ps(),{id:s}=Ps(),r=!!s,{search:a}=Ur(),i=new URLSearchParams(a).get("mode")==="view",[l,o]=f.useState(!1),[d,u]=f.useState({assetNo:"",name:"",location:"",status:"ACTIVE"});f.useEffect(()=>{r&&(o(!0),setTimeout(()=>{u({assetNo:"AST-001",name:"Generator",location:"Plant 1",status:"ACTIVE"}),o(!1)},150))},[r]);function c(m,p){u(g=>({...g,[m]:p}))}async function h(m){m.preventDefault(),o(!0);try{t("/maintenance/assets")}finally{o(!1)}}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/maintenance/assets",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Assets"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:i?"View Asset":r?"Edit Asset":"New Asset"})]}),e.jsx("form",{onSubmit:h,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx("fieldset",{disabled:i,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Asset No"}),e.jsx("input",{className:"input",value:d.assetNo,onChange:m=>c("assetNo",m.target.value),placeholder:"Auto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Name *"}),e.jsx("input",{className:"input",value:d.name,onChange:m=>c("name",m.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Location"}),e.jsx("input",{className:"input",value:d.location,onChange:m=>c("location",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:d.status,onChange:m=>c("status",m.target.value),children:[e.jsx("option",{value:"ACTIVE",children:"Active"}),e.jsx("option",{value:"INACTIVE",children:"Inactive"})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/maintenance/assets",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",disabled:l||i,children:l?"Saving...":"Save"})]})]})})})]})}function tse(){const{canPerformAction:t}=Ls(),s=[{id:1,woNo:"MWO-0001",asset:"AST-001 Generator",priority:"HIGH",status:"OPEN"},{id:2,woNo:"MWO-0002",asset:"AST-002 Forklift",priority:"MEDIUM",status:"IN_PROGRESS"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/maintenance",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Maintenance"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Maintenance Work Orders"}),e.jsx("p",{className:"text-sm mt-1",children:"Corrective and preventive maintenance execution"})]}),e.jsx(Re,{to:"/maintenance/work-orders/new",className:"btn-success",children:"+ New Work Order"})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"WO No"}),e.jsx("th",{children:"Asset"}),e.jsx("th",{children:"Priority"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:r.woNo}),e.jsx("td",{children:r.asset}),e.jsx("td",{children:r.priority}),e.jsx("td",{children:r.status}),e.jsxs("td",{children:[t("maintenance:work-orders","view")&&e.jsx(Re,{to:`/maintenance/work-orders/${r.id}?mode=view`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"View"}),t("maintenance:work-orders","edit")&&e.jsx(Re,{to:`/maintenance/work-orders/${r.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"})]})]},r.id))})]})})})]})}function BC(){const t=ps(),{id:s}=Ps(),r=!!s,{search:a}=Ur(),i=new URLSearchParams(a).get("mode")==="view",[l,o]=f.useState(!1),[d,u]=f.useState(""),[c,h]=f.useState({woNo:"",assetNo:"AST-001",description:"",priority:"MEDIUM",status:"OPEN"});f.useEffect(()=>{r&&m()},[s]);async function m(){var x,b,y;try{o(!0),u("");const j=await Z.get(`/maintenance/work-orders/${s}`);(x=j.data)!=null&&x.item&&h(j.data.item)}catch(j){u(((y=(b=j==null?void 0:j.response)==null?void 0:b.data)==null?void 0:y.message)||"Error fetching work order")}finally{o(!1)}}function p(x,b){h(y=>({...y,[x]:b}))}async function g(x){var b,y;x.preventDefault(),o(!0),u("");try{r?await Z.put(`/maintenance/work-orders/${s}`,c):await Z.post("/maintenance/work-orders",c),t("/maintenance/work-orders")}catch(j){u(((y=(b=j==null?void 0:j.response)==null?void 0:b.data)==null?void 0:y.message)||"Error saving work order")}finally{o(!1)}}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/maintenance/work-orders",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Work Orders"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:i?"View Work Order":r?"Edit Work Order":"New Work Order"})]}),e.jsx("form",{onSubmit:g,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[d&&e.jsx("div",{className:"alert alert-error mb-4",children:d}),e.jsx("fieldset",{disabled:i,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"WO No"}),e.jsx("input",{className:"input",value:c.woNo,onChange:x=>p("woNo",x.target.value),placeholder:"Auto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Asset No"}),e.jsx("input",{className:"input",value:c.assetNo,onChange:x=>p("assetNo",x.target.value)})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("input",{className:"input",value:c.description,onChange:x=>p("description",x.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Priority"}),e.jsxs("select",{className:"input",value:c.priority,onChange:x=>p("priority",x.target.value),children:[e.jsx("option",{value:"LOW",children:"Low"}),e.jsx("option",{value:"MEDIUM",children:"Medium"}),e.jsx("option",{value:"HIGH",children:"High"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:c.status,onChange:x=>p("status",x.target.value),children:[e.jsx("option",{value:"OPEN",children:"Open"}),e.jsx("option",{value:"IN_PROGRESS",children:"In Progress"}),e.jsx("option",{value:"DONE",children:"Done"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/maintenance/work-orders",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",disabled:l||i,children:l?"Saving...":"Save"})]})]})})})]})}function sse(){const{canPerformAction:t}=Ls(),s=[{id:1,code:"PM-001",asset:"AST-001 Generator",frequency:"MONTHLY",active:!0}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Preventive Maintenance Schedules"}),e.jsx("p",{className:"text-sm mt-1",children:"Define PM frequency and tasks"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/maintenance",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/maintenance/pm-schedules/new",className:"btn-success",children:"+ New Schedule"})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Asset"}),e.jsx("th",{children:"Frequency"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:r.code}),e.jsx("td",{children:r.asset}),e.jsx("td",{children:r.frequency}),e.jsx("td",{children:r.active?e.jsx("span",{className:"badge badge-success",children:"Active"}):e.jsx("span",{className:"badge badge-error",children:"Inactive"})}),e.jsxs("td",{children:[t("maintenance:pm-schedules","view")&&e.jsx(Re,{to:`/maintenance/pm-schedules/${r.id}?mode=view`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"View"}),t("maintenance:pm-schedules","edit")&&e.jsx(Re,{to:`/maintenance/pm-schedules/${r.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"})]})]},r.id))})]})})})]})}function FC(){const t=ps(),{id:s}=Ps(),r=!!s,{search:a}=Ur(),i=new URLSearchParams(a).get("mode")==="view",[l,o]=f.useState(!1),[d,u]=f.useState({code:"",assetNo:"AST-001",frequency:"MONTHLY",active:!0});f.useEffect(()=>{r&&(o(!0),setTimeout(()=>{u({code:"PM-001",assetNo:"AST-001",frequency:"MONTHLY",active:!0}),o(!1)},150))},[r]);function c(m,p){u(g=>({...g,[m]:p}))}async function h(m){m.preventDefault(),o(!0);try{t("/maintenance/pm-schedules")}finally{o(!1)}}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/maintenance/pm-schedules",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to PM Schedules"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:i?"View Schedule":r?"Edit Schedule":"New Schedule"})]}),e.jsx("form",{onSubmit:h,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx("fieldset",{disabled:i,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Code"}),e.jsx("input",{className:"input",value:d.code,onChange:m=>c("code",m.target.value),placeholder:"Auto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Asset No"}),e.jsx("input",{className:"input",value:d.assetNo,onChange:m=>c("assetNo",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Frequency"}),e.jsxs("select",{className:"input",value:d.frequency,onChange:m=>c("frequency",m.target.value),children:[e.jsx("option",{value:"DAILY",children:"Daily"}),e.jsx("option",{value:"WEEKLY",children:"Weekly"}),e.jsx("option",{value:"MONTHLY",children:"Monthly"}),e.jsx("option",{value:"QUARTERLY",children:"Quarterly"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:d.active?"1":"0",onChange:m=>c("active",m.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/maintenance/pm-schedules",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",disabled:l||i,children:l?"Saving...":"Save"})]})]})})})]})}function rse(){const t=[{title:"Work Order Aging",description:"Open work orders by age (placeholder)"},{title:"Asset Downtime",description:"Downtime by asset (placeholder)"},{title:"Preventive Compliance",description:"PM schedules completed vs due (placeholder)"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/maintenance",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Maintenance"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Maintenance Reports"}),e.jsx("p",{className:"text-sm mt-1",children:"Asset and maintenance KPIs"})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map((s,r)=>e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:[e.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100",children:s.title}),e.jsx("div",{className:"text-sm mt-1",children:s.description})]},r))})})})]})}function ase(){const[t,s]=Is.useState([{rbac_key:"open-work-orders",icon:"",value:"8",label:"Open Work Orders",change:"2 critical",changeType:"negative",path:"/maintenance/work-orders"},{rbac_key:"overdue-pms",icon:"",value:"4",label:"Overdue PMs",change:"Needs attention",changeType:"negative",path:"/maintenance/pm-schedules"},{rbac_key:"asset-health",icon:"",value:"98%",label:"Asset Health",change:" 1% this month",changeType:"positive",path:"/maintenance/assets"}]);Is.useEffect(()=>{let a=!0;async function n(){var i,l,o,d,u,c,h,m,p;try{const g=await Z.get("/bi/dashboards"),x=Number(((o=(l=(i=g==null?void 0:g.data)==null?void 0:i.summary)==null?void 0:l.maintenance)==null?void 0:o.open_work_orders)||0),b=Number(((c=(u=(d=g==null?void 0:g.data)==null?void 0:d.summary)==null?void 0:u.maintenance)==null?void 0:c.overdue_pms)||0),y=Number(((p=(m=(h=g==null?void 0:g.data)==null?void 0:h.summary)==null?void 0:m.maintenance)==null?void 0:p.asset_health_percent)||0);a&&s(j=>{const N=[...j];return N[0]={...N[0],value:String(x)},N[1]={...N[1],value:String(b)},N[2]={...N[2],value:`${y}%`},N})}catch{}}return n(),()=>{a=!1}},[]);const r=[{title:"Master Data",features:[{name:"Assets",path:"/maintenance/assets",description:"Register and manage assets",icon:""},{name:"New Asset",path:"/maintenance/assets/new",description:"Add an asset",icon:""}]},{title:"Execution",features:[{name:"Work Orders",path:"/maintenance/work-orders",description:"Corrective and preventive work orders",icon:""},{name:"New Work Order",path:"/maintenance/work-orders/new",description:"Create a maintenance work order",icon:""}]},{title:"Preventive Maintenance",features:[{name:"PM Schedules",path:"/maintenance/pm-schedules",description:"Define preventive schedules",icon:""},{name:"New Schedule",path:"/maintenance/pm-schedules/new",description:"Create a new PM schedule",icon:""}]},{title:"Reports",features:[{name:"Maintenance Reports",path:"/maintenance/reports",description:"Asset and maintenance KPIs",icon:""}]}];return e.jsx(lo,{title:"Maintenance",description:"Asset maintenance and work order management",stats:t,sections:r,features:ise})}function nse(){return e.jsxs(hl,{children:[e.jsx(tt,{path:"/",element:e.jsx(ase,{})}),e.jsx(tt,{path:"/assets",element:e.jsx(ese,{})}),e.jsx(tt,{path:"/assets/new",element:e.jsx(EC,{})}),e.jsx(tt,{path:"/assets/:id",element:e.jsx(EC,{})}),e.jsx(tt,{path:"/work-orders",element:e.jsx(tse,{})}),e.jsx(tt,{path:"/work-orders/new",element:e.jsx(BC,{})}),e.jsx(tt,{path:"/work-orders/:id",element:e.jsx(BC,{})}),e.jsx(tt,{path:"/pm-schedules",element:e.jsx(sse,{})}),e.jsx(tt,{path:"/pm-schedules/new",element:e.jsx(FC,{})}),e.jsx(tt,{path:"/pm-schedules/:id",element:e.jsx(FC,{})}),e.jsx(tt,{path:"/reports",element:e.jsx(rse,{})})]})}const ise=[{module_key:"maintenance",label:"Assets",path:"/maintenance/assets",type:"feature"},{module_key:"maintenance",label:"New Asset",path:"/maintenance/assets/new",type:"feature"},{module_key:"maintenance",label:"Work Orders",path:"/maintenance/work-orders",type:"feature"},{module_key:"maintenance",label:"New Work Order",path:"/maintenance/work-orders/new",type:"feature"},{module_key:"maintenance",label:"PM Schedules",path:"/maintenance/pm-schedules",type:"feature"},{module_key:"maintenance",label:"New Schedule",path:"/maintenance/pm-schedules/new",type:"feature"},{module_key:"maintenance",label:"Maintenance Reports",path:"/maintenance/reports",type:"dashboard"}];function lse(){const t=[{id:1,code:"PRJ-001",name:"ERP Rollout",status:"IN_PROGRESS",budget:5e4},{id:2,code:"PRJ-002",name:"Warehouse Upgrade",status:"PLANNED",budget:2e4}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Projects"}),e.jsx("p",{className:"text-sm mt-1",children:"Project portfolio"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/project-management",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/project-management/projects/new",className:"btn-success",children:"+ New Project"})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"text-right",children:"Budget"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:t.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:s.code}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.status}),e.jsx("td",{className:"text-right",children:Number(s.budget).toFixed(2)}),e.jsx("td",{children:e.jsx(Re,{to:`/project-management/projects/${s.id}`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"Edit"})})]},s.id))})]})})})]})}function TC(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState(""),[o,d]=f.useState({code:"",name:"",status:"PLANNED",budget:0,startDate:"",endDate:""});f.useEffect(()=>{r&&u()},[s]);async function u(){var m,p,g;try{n(!0),l("");const x=await Z.get(`/projects/projects/${s}`);(m=x.data)!=null&&m.item&&d(x.data.item)}catch(x){l(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Error fetching project")}finally{n(!1)}}function c(m,p){d(g=>({...g,[m]:p}))}async function h(m){var p,g;m.preventDefault(),n(!0),l("");try{r?await Z.put(`/projects/projects/${s}`,o):await Z.post("/projects/projects",o),t("/project-management/projects")}catch(x){l(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Error saving project")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/project-management/projects",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Projects"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:r?"Edit Project":"New Project"})]}),e.jsx("form",{onSubmit:h,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[i&&e.jsx("div",{className:"alert alert-error mb-4",children:i}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Code"}),e.jsx("input",{className:"input",value:o.code,onChange:m=>c("code",m.target.value),placeholder:"Auto"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Name *"}),e.jsx("input",{className:"input",value:o.name,onChange:m=>c("name",m.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:o.status,onChange:m=>c("status",m.target.value),children:[e.jsx("option",{value:"PLANNED",children:"Planned"}),e.jsx("option",{value:"IN_PROGRESS",children:"In Progress"}),e.jsx("option",{value:"ON_HOLD",children:"On Hold"}),e.jsx("option",{value:"COMPLETED",children:"Completed"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Budget"}),e.jsx("input",{className:"input",type:"number",min:"0",step:"0.01",value:o.budget,onChange:m=>c("budget",Number(m.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Start Date"}),e.jsx("input",{className:"input",type:"date",value:o.startDate,onChange:m=>c("startDate",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"End Date"}),e.jsx("input",{className:"input",type:"date",value:o.endDate,onChange:m=>c("endDate",m.target.value)})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/project-management/projects",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",disabled:a,children:a?"Saving...":"Save"})]})]})})})]})}function ose(){const t=[{id:1,project:"PRJ-001",title:"Define chart of accounts",assignee:"Finance Team",due:"2025-02-15",status:"IN_PROGRESS"},{id:2,project:"PRJ-001",title:"Migrate opening balances",assignee:"Finance Team",due:"2025-02-28",status:"PLANNED"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Tasks"}),e.jsx("p",{className:"text-sm mt-1",children:"Task tracking across projects"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/project-management",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/project-management/tasks/new",className:"btn-success",children:"+ New Task"})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Project"}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Assignee"}),e.jsx("th",{children:"Due"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:t.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.project}),e.jsx("td",{className:"font-medium",children:s.title}),e.jsx("td",{children:s.assignee}),e.jsx("td",{children:new Date(s.due).toLocaleDateString()}),e.jsx("td",{children:s.status}),e.jsx("td",{children:e.jsx(Re,{to:`/project-management/tasks/${s.id}`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"Edit"})})]},s.id))})]})})})]})}function IC(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState(""),[o,d]=f.useState({projectCode:"PRJ-001",title:"",assignee:"",due:"",status:"PLANNED"});f.useEffect(()=>{r&&u()},[s]);async function u(){var m,p,g;try{n(!0),l("");const x=await Z.get(`/projects/tasks/${s}`);(m=x.data)!=null&&m.item&&d(x.data.item)}catch(x){l(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Error fetching task")}finally{n(!1)}}function c(m,p){d(g=>({...g,[m]:p}))}async function h(m){var p,g;m.preventDefault(),n(!0),l("");try{r?await Z.put(`/projects/tasks/${s}`,o):await Z.post("/projects/tasks",o),t("/project-management/tasks")}catch(x){l(((g=(p=x==null?void 0:x.response)==null?void 0:p.data)==null?void 0:g.message)||"Error saving task")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/project-management/tasks",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Tasks"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:r?"Edit Task":"New Task"})]}),e.jsx("form",{onSubmit:h,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[i&&e.jsx("div",{className:"alert alert-error mb-4",children:i}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Project"}),e.jsx("input",{className:"input",value:o.projectCode,onChange:m=>c("projectCode",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Assignee"}),e.jsx("input",{className:"input",value:o.assignee,onChange:m=>c("assignee",m.target.value)})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Title *"}),e.jsx("input",{className:"input",value:o.title,onChange:m=>c("title",m.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Due Date"}),e.jsx("input",{className:"input",type:"date",value:o.due,onChange:m=>c("due",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:o.status,onChange:m=>c("status",m.target.value),children:[e.jsx("option",{value:"PLANNED",children:"Planned"}),e.jsx("option",{value:"IN_PROGRESS",children:"In Progress"}),e.jsx("option",{value:"DONE",children:"Done"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/project-management/tasks",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",disabled:a,children:a?"Saving...":"Save"})]})]})})})]})}function cse(){const t=[{title:"Project Status Summary",description:"Planned vs in-progress vs completed (placeholder)"},{title:"Task Due Report",description:"Tasks due by date range (placeholder)"},{title:"Budget vs Actual",description:"Budget utilization (placeholder)"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/project-management",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Project Management"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Project Reports"}),e.jsx("p",{className:"text-sm mt-1",children:"Portfolio KPIs and reporting"})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map((s,r)=>e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:[e.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100",children:s.title}),e.jsx("div",{className:"text-sm mt-1",children:s.description})]},r))})})})]})}function dse(){const[t,s]=Is.useState([{rbac_key:"active-projects",icon:"",value:"8",label:"Active Projects",change:"2 due this week",changeType:"neutral",path:"/project-management/projects"},{rbac_key:"open-tasks",icon:"",value:"34",label:"Open Tasks",change:"12 high priority",changeType:"negative",path:"/project-management/tasks"},{rbac_key:"on-time-completion",icon:"",value:"92%",label:"On Time Completion",change:" 3% this month",changeType:"positive",path:"/project-management/reports"}]);Is.useEffect(()=>{let a=!0;async function n(){var i,l,o,d,u,c,h,m,p;try{const g=await Z.get("/bi/dashboards"),x=Number(((o=(l=(i=g==null?void 0:g.data)==null?void 0:i.summary)==null?void 0:l.projects)==null?void 0:o.active_projects)||0),b=Number(((c=(u=(d=g==null?void 0:g.data)==null?void 0:d.summary)==null?void 0:u.projects)==null?void 0:c.open_tasks)||0),y=Number(((p=(m=(h=g==null?void 0:g.data)==null?void 0:h.summary)==null?void 0:m.projects)==null?void 0:p.on_time_percent)||0);a&&s(j=>{const N=[...j];return N[0]={...N[0],value:String(x)},N[1]={...N[1],value:String(b)},N[2]={...N[2],value:`${y}%`},N})}catch{}}return n(),()=>{a=!1}},[]);const r=[{title:"Portfolio",badge:"Planning",items:[{title:"Projects",path:"/project-management/projects",description:"Create and manage projects",icon:"",actions:[{label:"View Projects",path:"/project-management/projects",type:"outline"},{label:"New Project",path:"/project-management/projects/new",type:"primary"}]}]},{title:"Execution",badge:"Tracking",items:[{title:"Tasks",path:"/project-management/tasks",description:"Assign and track tasks",icon:"",actions:[{label:"View Tasks",path:"/project-management/tasks",type:"outline"},{label:"New Task",path:"/project-management/tasks/new",type:"primary"}]}]},{title:"Reports",items:[{title:"Project Reports",path:"/project-management/reports",description:"Project KPIs and status reporting",icon:"",actions:[{label:"View Reports",path:"/project-management/reports",type:"primary"}]}]}];return e.jsx(lo,{title:"Project Management",description:"Project planning, tracking, and resource allocation",stats:t,sections:r,features:mse})}function use(){return e.jsxs(hl,{children:[e.jsx(tt,{path:"/",element:e.jsx(dse,{})}),e.jsx(tt,{path:"/projects",element:e.jsx(lse,{})}),e.jsx(tt,{path:"/projects/new",element:e.jsx(TC,{})}),e.jsx(tt,{path:"/projects/:id",element:e.jsx(TC,{})}),e.jsx(tt,{path:"/tasks",element:e.jsx(ose,{})}),e.jsx(tt,{path:"/tasks/new",element:e.jsx(IC,{})}),e.jsx(tt,{path:"/tasks/:id",element:e.jsx(IC,{})}),e.jsx(tt,{path:"/reports",element:e.jsx(cse,{})})]})}const mse=[{module_key:"project-management",label:"Projects",path:"/project-management/projects",type:"feature"},{module_key:"project-management",label:"New Project",path:"/project-management/projects/new",type:"feature"},{module_key:"project-management",label:"Tasks",path:"/project-management/tasks",type:"feature"},{module_key:"project-management",label:"New Task",path:"/project-management/tasks/new",type:"feature"},{module_key:"project-management",label:"Project Reports",path:"/project-management/reports",type:"dashboard"}];function hse(){const{canPerformAction:t}=Ls(),s=[{id:1,code:"BOM-001",product:"Finished Good A",version:"v1",active:!0},{id:2,code:"BOM-002",product:"Finished Good B",version:"v1",active:!0}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Bills of Materials (BOM)"}),e.jsx("p",{className:"text-sm mt-1",children:"Manage BOM definitions"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/production",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/production/bom/new",className:"btn-success",children:"+ New BOM"})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Version"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:r.code}),e.jsx("td",{children:r.product}),e.jsx("td",{children:r.version}),e.jsx("td",{children:r.active?e.jsx("span",{className:"badge badge-success",children:"Active"}):e.jsx("span",{className:"badge badge-error",children:"Inactive"})}),e.jsxs("td",{children:[t("production:bom","view")&&e.jsx(Re,{to:`/production/bom/${r.id}?mode=view`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"View"}),t("production:bom","edit")&&e.jsx(Re,{to:`/production/bom/${r.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"})]})]},r.id))})]})})})]})}function LC(){const t=ps(),{id:s}=Ps(),r=!!s,{search:a}=Ur(),i=new URLSearchParams(a).get("mode")==="view",[l,o]=f.useState(!1),[d,u]=f.useState({code:"",product:"",version:"v1",active:!0,lines:[{component:"",qty:1}]});f.useEffect(()=>{r&&(o(!0),setTimeout(()=>{u({code:"BOM-001",product:"Finished Good A",version:"v1",active:!0,lines:[{component:"Raw Material X",qty:2}]}),o(!1)},150))},[r]);function c(x,b){u(y=>({...y,[x]:b}))}function h(x,b,y){u(j=>{const N=[...j.lines];return N[x]={...N[x],[b]:y},{...j,lines:N}})}function m(){u(x=>({...x,lines:[...x.lines,{component:"",qty:1}]}))}function p(x){u(b=>({...b,lines:b.lines.filter((y,j)=>j!==x)}))}async function g(x){x.preventDefault(),o(!0);try{t("/production/bom")}finally{o(!1)}}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/production/bom",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to BOM"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:i?"View BOM":r?"Edit BOM":"New BOM"})]}),e.jsx("form",{onSubmit:g,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("fieldset",{disabled:i,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Code"}),e.jsx("input",{className:"input",value:d.code,onChange:x=>c("code",x.target.value),placeholder:"Auto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Product *"}),e.jsx("input",{className:"input",value:d.product,onChange:x=>c("product",x.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Version"}),e.jsx("input",{className:"input",value:d.version,onChange:x=>c("version",x.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:d.active?"1":"0",onChange:x=>c("active",x.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100",children:"Components"}),e.jsx("button",{type:"button",className:"btn-success",onClick:m,disabled:i,children:"+ Add"})]}),e.jsx("div",{className:"space-y-2",children:d.lines.map((x,b)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-2",children:[e.jsx("div",{className:"md:col-span-8",children:e.jsx("input",{className:"input",placeholder:"Component",value:x.component,onChange:y=>h(b,"component",y.target.value)})}),e.jsx("div",{className:"md:col-span-3",children:e.jsx("input",{className:"input",type:"number",min:"0",step:"0.01",placeholder:"Qty",value:x.qty,onChange:y=>h(b,"qty",Number(y.target.value))})}),e.jsx("div",{className:"md:col-span-1 flex md:justify-end",children:e.jsx("button",{type:"button",className:"btn-success",onClick:()=>p(b),disabled:i||d.lines.length<=1,children:""})})]},b))})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/production/bom",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",disabled:l||i,children:l?"Saving...":"Save"})]})]})})})]})}function Ase(){const{canPerformAction:t}=Ls(),s=[{id:1,woNo:"WO-0001",product:"Finished Good A",qty:10,status:"PLANNED"},{id:2,woNo:"WO-0002",product:"Finished Good B",qty:5,status:"RELEASED"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Work Orders"}),e.jsx("p",{className:"text-sm mt-1",children:"Production order tracking"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/production",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/production/work-orders/new",className:"btn-success",children:"+ New Work Order"})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"WO No"}),e.jsx("th",{children:"Product"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:r.woNo}),e.jsx("td",{children:r.product}),e.jsx("td",{className:"text-right",children:Number(r.qty).toFixed(2)}),e.jsx("td",{children:r.status}),e.jsxs("td",{children:[t("production:work-orders","view")&&e.jsx(Re,{to:`/production/work-orders/${r.id}?mode=view`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"View"}),t("production:work-orders","edit")&&e.jsx(Re,{to:`/production/work-orders/${r.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"})]})]},r.id))})]})})})]})}function DC(){const t=ps(),{id:s}=Ps(),r=!!s,{search:a}=Ur(),i=new URLSearchParams(a).get("mode")==="view",[l,o]=f.useState(!1),[d,u]=f.useState(""),[c,h]=f.useState({woNo:"",product:"",qty:0,status:"PLANNED"});f.useEffect(()=>{r&&m()},[s]);async function m(){var x,b,y;try{o(!0),u("");const j=await Z.get(`/production/work-orders/${s}`);(x=j.data)!=null&&x.item&&h(j.data.item)}catch(j){u(((y=(b=j==null?void 0:j.response)==null?void 0:b.data)==null?void 0:y.message)||"Error fetching work order")}finally{o(!1)}}function p(x,b){h(y=>({...y,[x]:b}))}async function g(x){var b,y;x.preventDefault(),o(!0),u("");try{r?await Z.put(`/production/work-orders/${s}`,c):await Z.post("/production/work-orders",c),t("/production/work-orders")}catch(j){u(((y=(b=j==null?void 0:j.response)==null?void 0:b.data)==null?void 0:y.message)||"Error saving work order")}finally{o(!1)}}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/production/work-orders",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Work Orders"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:i?"View Work Order":r?"Edit Work Order":"New Work Order"})]}),e.jsx("form",{onSubmit:g,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[d&&e.jsx("div",{className:"alert alert-error mb-4",children:d}),e.jsx("fieldset",{disabled:i,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"WO No"}),e.jsx("input",{className:"input",value:c.woNo,onChange:x=>p("woNo",x.target.value),placeholder:"Auto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Product *"}),e.jsx("input",{className:"input",value:c.product,onChange:x=>p("product",x.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Qty"}),e.jsx("input",{className:"input",type:"number",step:"0.01",min:"0",value:c.qty,onChange:x=>p("qty",Number(x.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:c.status,onChange:x=>p("status",x.target.value),children:[e.jsx("option",{value:"PLANNED",children:"Planned"}),e.jsx("option",{value:"RELEASED",children:"Released"}),e.jsx("option",{value:"IN_PROGRESS",children:"In Progress"}),e.jsx("option",{value:"COMPLETED",children:"Completed"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/production/work-orders",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",disabled:l||i,children:l?"Saving...":"Save"})]})]})})})]})}function fse(){const t=[{title:"Work Order Status",description:"Planned vs Released vs Completed (placeholder)"},{title:"BOM Usage",description:"Component usage by BOM (placeholder)"},{title:"Production Output",description:"Output by date range (placeholder)"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/production",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Production"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Production Reports"}),e.jsx("p",{className:"text-sm mt-1",children:"Manufacturing analytics and reports"})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map((s,r)=>e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:[e.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100",children:s.title}),e.jsx("div",{className:"text-sm mt-1",children:s.description})]},r))})})})]})}function pse(){const[t,s]=Is.useState([{rbac_key:"active-work-orders",icon:"",value:"12",label:"Active Work Orders",change:"3 due today",changeType:"neutral",path:"/production/work-orders"},{rbac_key:"efficiency",icon:"",value:"94%",label:"Efficiency",change:" 2% this week",changeType:"positive",path:"/production/reports"},{rbac_key:"active-boms",icon:"",value:"45",label:"Active BOMs",change:"5 new this month",changeType:"neutral",path:"/production/bom"}]);Is.useEffect(()=>{let a=!0;async function n(){var i,l,o,d,u,c,h,m,p;try{const g=await Z.get("/bi/dashboards"),x=Number(((o=(l=(i=g==null?void 0:g.data)==null?void 0:i.summary)==null?void 0:l.production)==null?void 0:o.active_work_orders)||0),b=Number(((c=(u=(d=g==null?void 0:g.data)==null?void 0:d.summary)==null?void 0:u.production)==null?void 0:c.efficiency_percent)||0),y=Number(((p=(m=(h=g==null?void 0:g.data)==null?void 0:h.summary)==null?void 0:m.production)==null?void 0:p.active_boms)||0);a&&s(j=>{const N=[...j];return N[0]={...N[0],value:String(x)},N[1]={...N[1],value:`${b}%`},N[2]={...N[2],value:String(y)},N})}catch{}}return n(),()=>{a=!1}},[]);const r=[{title:"Master Data",features:[{name:"Bills of Materials",path:"/production/bom",description:"Define BOMs and components",icon:""},{name:"New BOM",path:"/production/bom/new",description:"Create a new BOM",icon:""}]},{title:"Execution",features:[{name:"Work Orders",path:"/production/work-orders",description:"Create and track work orders",icon:""},{name:"New Work Order",path:"/production/work-orders/new",description:"Start a work order",icon:""}]},{title:"Reports",features:[{name:"Production Reports",path:"/production/reports",description:"Manufacturing analytics",icon:""}]}];return e.jsx(lo,{title:"Production",description:"Manufacturing and production planning",stats:t,sections:r,features:gse})}function xse(){return e.jsxs(hl,{children:[e.jsx(tt,{path:"/",element:e.jsx(pse,{})}),e.jsx(tt,{path:"/bom",element:e.jsx(hse,{})}),e.jsx(tt,{path:"/bom/new",element:e.jsx(LC,{})}),e.jsx(tt,{path:"/bom/:id",element:e.jsx(LC,{})}),e.jsx(tt,{path:"/work-orders",element:e.jsx(Ase,{})}),e.jsx(tt,{path:"/work-orders/new",element:e.jsx(DC,{})}),e.jsx(tt,{path:"/work-orders/:id",element:e.jsx(DC,{})}),e.jsx(tt,{path:"/reports",element:e.jsx(fse,{})})]})}const gse=[{module_key:"production",label:"Bills of Materials",path:"/production/bom",type:"feature"},{module_key:"production",label:"New BOM",path:"/production/bom/new",type:"feature"},{module_key:"production",label:"Work Orders",path:"/production/work-orders",type:"feature"},{module_key:"production",label:"New Work Order",path:"/production/work-orders/new",type:"feature"},{module_key:"production",label:"Production Reports",path:"/production/reports",type:"dashboard"}];function vse(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState(!1),[l,o]=f.useState(""),[d,u]=f.useState([]),[c,h]=f.useState([]),[m,p]=f.useState([]);f.useEffect(()=>{const x=new Date,b=x.getFullYear(),y=String(x.getMonth()+1).padStart(2,"0"),j=String(x.getDate()).padStart(2,"0");a(`${b}-${y}-${j}`);const N=new Date(x.getTime()-8640*60*1e3),_=N.getFullYear(),F=String(N.getMonth()+1).padStart(2,"0"),I=String(N.getDate()).padStart(2,"0");s(`${_}-${F}-${I}`)},[]),f.useEffect(()=>{if(!t||!r)return;let x=!0;return i(!0),o(""),Promise.all([Z.get("/pos/reports/daily-sales",{params:{startDate:t,endDate:r}}),Z.get("/pos/reports/payment-breakdown",{params:{startDate:t,endDate:r}}),Z.get("/pos/reports/top-items",{params:{startDate:t,endDate:r,limit:20}})]).then(([b,y,j])=>{var N,_,F;x&&(u(Array.isArray((N=b.data)==null?void 0:N.items)?b.data.items:[]),h(Array.isArray((_=y.data)==null?void 0:_.items)?y.data.items:[]),p(Array.isArray((F=j.data)==null?void 0:F.items)?j.data.items:[]))}).catch(b=>{var y,j;x&&o(((j=(y=b==null?void 0:b.response)==null?void 0:y.data)==null?void 0:j.message)||"Failed to load reports")}).finally(()=>{x&&i(!1)}),()=>{x=!1}},[t,r]);const g=x=>`GH${Number(x||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/pos",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to POS"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"POS Reports"}),e.jsx("p",{className:"text-sm mt-1",children:"Sales analytics and end-of-day reporting"})]}),l?e.jsx("div",{className:"text-sm text-red-600",children:l}):null,e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-sm",children:"Start"}),e.jsx("input",{type:"date",value:t,onChange:x=>s(x.target.value)}),e.jsx("div",{className:"text-sm",children:"End"}),e.jsx("input",{type:"date",value:r,onChange:x=>a(x.target.value)}),e.jsx("span",{className:"badge",children:n?"Loading":"Updated"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-slate-50 rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Daily Sales Summary"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Totals per day"})]}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{className:"text-right",children:"Orders"}),e.jsx("th",{className:"text-right",children:"Gross"}),e.jsx("th",{className:"text-right",children:"Discount"}),e.jsx("th",{className:"text-right",children:"Tax"}),e.jsx("th",{className:"text-right",children:"Net"})]})}),e.jsx("tbody",{children:d.map((x,b)=>e.jsxs("tr",{children:[e.jsx("td",{children:String(x.date)}),e.jsx("td",{className:"text-right",children:Number(x.count||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:g(x.gross)}),e.jsx("td",{className:"text-right",children:g(x.discount)}),e.jsx("td",{className:"text-right",children:g(x.tax)}),e.jsx("td",{className:"text-right font-semibold",children:g(x.net)})]},b))})]})})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-slate-50 rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Payment Method Breakdown"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Totals by method"})]}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Method"}),e.jsx("th",{className:"text-right",children:"Orders"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:c.map((x,b)=>e.jsxs("tr",{children:[e.jsx("td",{children:String(x.method||"").toUpperCase()}),e.jsx("td",{className:"text-right",children:Number(x.count||0).toLocaleString()}),e.jsx("td",{className:"text-right font-semibold",children:g(x.total)})]},b))})]})})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-slate-50 rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Top Selling Items"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Best performers"})]}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:m.map((x,b)=>e.jsxs("tr",{children:[e.jsx("td",{children:String(x.item||"")}),e.jsx("td",{className:"text-right",children:Number(x.qty||0).toLocaleString()}),e.jsx("td",{className:"text-right font-semibold",children:g(x.amount)})]},b))})]})})})]})]})}const PC="pos_payment_settings",UC="pos_general_settings",bse=({active:t,onClick:s,children:r})=>e.jsx("button",{type:"button",onClick:s,className:`px-4 py-2 rounded-md border ${t?"bg-slate-100 border-slate-300 text-slate-900":"bg-white border-slate-200 text-slate-600"}`,children:r});function yse({emoji:t,title:s,subtitle:r}){return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:[t," ",s]}),r?e.jsx("p",{className:"text-sm mt-1",children:r}):null]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(Re,{to:"/pos",className:"btn btn-secondary",children:"Return to Menu"})})]})}function mF({title:t,children:s}){return e.jsxs("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-4 text-sm",children:[e.jsx("div",{className:"font-semibold text-blue-900 mb-1",children:t}),e.jsx("div",{className:"text-blue-800",children:s})]})}function RC({value:t,onChange:s,options:r,placeholder:a,disabled:n,filterPlaceholder:i}){const l=Array.isArray(r)?r:[];return e.jsx("div",{children:e.jsxs("select",{className:"input",value:t,onChange:o=>s(o.target.value),disabled:n,children:[e.jsx("option",{value:"",children:a||"Select..."}),l.map(o=>e.jsx("option",{value:String(o.value),children:o.label},String(o.value)))]})})}function jse(){const{scope:t}=Kr(),{canPerformAction:s}=Ls(),[r,a]=f.useState([]),[n,i]=f.useState(!0),[l,o]=f.useState(!1),[d,u]=f.useState(-1),[c,h]=f.useState([]),[m,p]=f.useState(!1),[g,x]=f.useState(null),[b,y]=f.useState(!1),[j,N]=f.useState(!1),[_,F]=f.useState([]),[I,w]=f.useState([]),[E,W]=f.useState({}),[R,U]=f.useState(""),[T,Y]=f.useState({name:"",code:"AUTO",warehouse:"",ip_address:"",active:!0});function H(){const K=r.reduce((J,te)=>{const se=String(te.code||"").match(/^T(\d{3})$/);if(!se)return J;const ae=parseInt(se[1],10);return Number.isFinite(ae)&&ae>J?ae:J},0)+1;return`T${String(K).padStart(3,"0")}`}function M(){i(!0),Z.get("/pos/terminals").then(O=>{var J;const K=Array.isArray((J=O.data)==null?void 0:J.items)?O.data.items:[];a(K.map(te=>({...te,active:!!te.is_active})))}).catch(()=>a([])).finally(()=>i(!1))}f.useEffect(()=>{M()},[]),f.useEffect(()=>{let O=!0;return Z.get("/inventory/warehouses").then(K=>{var J;O&&h(Array.isArray((J=K.data)==null?void 0:J.items)?K.data.items:[])}).catch(()=>{O&&h([])}),()=>{O=!1}},[]);function q(){u(-1),Y({name:"",code:H(),warehouse:"",ip_address:"",active:!0}),o(!0)}function z(O){const K=r[O];u(O),Y({name:(K==null?void 0:K.name)||"",code:(K==null?void 0:K.code)||"AUTO",warehouse:(K==null?void 0:K.warehouse)||"",ip_address:(K==null?void 0:K.ip_address)||"",active:!!(K!=null&&K.active)}),o(!0)}async function Q(){var J,te,se,ae;const O=String(T.name||"").trim();let K=String(T.code||"").trim();if(!O){ct.warn("Provide terminal name");return}(!K||K==="AUTO")&&(K=H());try{if(d>=0){const ne=r[d];if(!ne||!ne.id){ct.error("Terminal id is missing");return}await Z.put(`/pos/terminals/${ne.id}`,{code:K,name:O,warehouse:T.warehouse||null,counter_no:ne.counter_no||null,ip_address:T.ip_address||null,active:!!T.active})}else await Z.post("/pos/terminals",{code:K,name:O,warehouse:T.warehouse||null,counter_no:null,ip_address:T.ip_address||null,active:!!T.active});o(!1),u(-1),M(),ct.success("Terminal saved")}catch(ne){const ue=((te=(J=ne==null?void 0:ne.response)==null?void 0:J.data)==null?void 0:te.message)||((ae=(se=ne==null?void 0:ne.response)==null?void 0:se.data)==null?void 0:ae.error)||"Failed to save terminal";ct.error(ue)}}async function L(O){var J,te,se,ae;const K=r[O];if(!K||!K.id){a(ne=>ne.filter((ue,oe)=>oe!==O));return}try{await Z.put(`/pos/terminals/${K.id}`,{code:K.code,name:K.name,warehouse:K.warehouse||null,counter_no:K.counter_no||null,ip_address:K.ip_address||null,active:!1}),M(),ct.success("Terminal deactivated")}catch(ne){const ue=((te=(J=ne==null?void 0:ne.response)==null?void 0:J.data)==null?void 0:te.message)||((ae=(se=ne==null?void 0:ne.response)==null?void 0:se.data)==null?void 0:ae.error)||"Failed to deactivate terminal";ct.error(ue)}}async function V(O){var te,se,ae,ne,ue,oe,le;const K=Number((t==null?void 0:t.companyId)||0)||void 0,J=Number((t==null?void 0:t.branchId)||0)||void 0;y(!0);try{const[X,me]=await Promise.all([Z.get("/admin/users",{params:{...K?{company_id:K}:{},...J?{branch_id:J}:{},active:1,limit:100}}),Z.get("/pos/terminal-users",{params:{terminalId:O}})]),we=Array.isArray((se=(te=X.data)==null?void 0:te.data)==null?void 0:se.items)?X.data.data.items:[],Ie=Array.isArray((ae=me.data)==null?void 0:ae.items)?me.data.items:[];F(we),W(Ie.reduce((_e,Fe)=>{const Le=String(Fe.user_id);return _e[Le]=String(Fe.username||Le),_e},{})),w(Ie.map(_e=>Number(_e.user_id)).filter(_e=>Number.isFinite(_e)&&_e>0).map(String)),U("")}catch(X){F([]),w([]),W({}),U("");const me=((ue=(ne=X==null?void 0:X.response)==null?void 0:ne.data)==null?void 0:ue.message)||((le=(oe=X==null?void 0:X.response)==null?void 0:oe.data)==null?void 0:le.error)||"Failed to load users for terminal";ct.error(me)}finally{y(!1)}}function P(O){O!=null&&O.id&&(x(O),p(!0),U(""),V(O.id))}async function C(){var se,ae,ne,ue;const O=g==null?void 0:g.id;if(!O)return;const K=String(R||"").trim(),J=K?[...I,K]:I,te=Array.from(new Set(J)).map(oe=>Number(oe)).filter(oe=>Number.isFinite(oe)&&oe>0);N(!0);try{await Z.put("/pos/terminal-users",{terminalId:O,userIds:te}),ct.success("Terminal users updated"),p(!1),x(null),w([]),U("")}catch(oe){const le=((ae=(se=oe==null?void 0:oe.response)==null?void 0:se.data)==null?void 0:ae.message)||((ue=(ne=oe==null?void 0:oe.response)==null?void 0:ne.data)==null?void 0:ue.error)||"Failed to update terminal users";ct.error(le)}finally{N(!1)}}const k=f.useMemo(()=>{const O=new Map;for(const K of _)K!=null&&K.id&&O.set(String(K.id),K);return O},[_]),B=f.useMemo(()=>new Set(I),[I]),G=f.useMemo(()=>_.filter(O=>(O==null?void 0:O.id)&&!B.has(String(O.id))),[_,B]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(mF,{title:"About POS Terminals",children:"Configure and manage point-of-sale terminals. Each terminal represents a physical checkout counter or device in your store."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"btn-success",onClick:q,children:"+ Add Terminal"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:M,children:"Refresh"})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"text-sm mb-3",children:"Manage register identifiers, warehouse/location binding, printer/IP, and activation status."}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Terminal Name"}),e.jsx("th",{children:"Terminal ID"}),e.jsx("th",{children:"Warehouse"}),e.jsx("th",{children:"Receipt Printer"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:n?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",children:"Loading..."})}):r.length?r.map(O=>e.jsxs("tr",{children:[e.jsx("td",{children:O.name}),e.jsx("td",{children:O.code}),e.jsx("td",{children:O.warehouse||"-"}),e.jsx("td",{children:O.ip_address||"Not configured"}),e.jsx("td",{children:e.jsx("span",{className:O.active?"badge-success":"badge-secondary",children:O.active?"Active":"Inactive"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[s("pos:setup","edit")&&e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>z(r.indexOf(O)),children:"Edit"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>P(O),children:"Users"}),e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>L(r.indexOf(O)),children:"Delete"})]})})]},O.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",children:e.jsx("div",{className:"text-center text-slate-600 py-4",children:"No terminals found"})})})})]})})]})}),l?e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-erp w-full max-w-lg overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-slate-200 bg-brand text-white",children:e.jsx("div",{className:"text-lg font-bold",children:d>=0?"Edit Terminal":"Add Terminal"})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Terminal Name"}),e.jsx("input",{className:"input",value:T.name,onChange:O=>Y(K=>({...K,name:O.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Terminal ID"}),e.jsx("input",{className:"input",value:T.code,onChange:O=>Y(K=>({...K,code:O.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Warehouse"}),e.jsx(RC,{value:T.warehouse,onChange:O=>Y(K=>({...K,warehouse:O})),options:c.map(O=>{const K=`${O.warehouse_code?`${O.warehouse_code} - `:""}${O.warehouse_name||""}`;return{value:K,label:K}}),placeholder:"Select warehouse",filterPlaceholder:"Filter warehouses..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Receipt Printer / IP"}),e.jsx("input",{className:"input",value:T.ip_address,onChange:O=>Y(K=>({...K,ip_address:O.target.value})),placeholder:"Printer name or IP"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!T.active,onChange:O=>Y(K=>({...K,active:O.target.checked}))}),e.jsx("span",{className:"text-sm",children:"Active"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{o(!1),u(-1)},children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:Q,children:"Save"})]})]})]})}):null,m?e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-erp w-full max-w-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 bg-brand text-white",children:[e.jsx("div",{className:"text-lg font-bold",children:"Assign Users"}),e.jsxs("div",{className:"text-sm opacity-90",children:[g==null?void 0:g.name," (",g==null?void 0:g.code,")"]})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[b?e.jsx("div",{className:"py-8 text-center text-slate-600",children:"Loading users..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Add User"}),e.jsx(RC,{value:R,onChange:O=>U(String(O)),options:G.map(O=>({value:String(O.id),label:String(O.username||"")})),placeholder:"Select user",filterPlaceholder:"Filter users..."})]}),e.jsx("button",{type:"button",className:"btn btn-secondary",disabled:!R||j,onClick:()=>{const O=String(R||"").trim();O&&(w(K=>K.includes(O)?K:[...K,O]),U(""))},children:"Add"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Assigned Users"}),e.jsx("button",{type:"button",className:"btn btn-secondary",disabled:!I.length||j,onClick:()=>w([]),children:"Clear All"})]}),e.jsx("div",{className:"mt-2 overflow-x-auto rounded-lg border border-slate-200",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 text-xs uppercase text-slate-600",children:"Username"}),e.jsx("th",{className:"text-right p-2 text-xs uppercase text-slate-600",children:"Action"})]})}),e.jsx("tbody",{children:I.length?I.map(O=>{var J;const K=((J=k.get(String(O)))==null?void 0:J.username)||E[String(O)]||String(O);return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:K}),e.jsx("td",{className:"p-2 text-right",children:e.jsx("button",{type:"button",className:"btn btn-danger",disabled:j,onClick:()=>w(te=>te.filter(se=>se!==String(O))),children:"Remove"})})]},O)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"2",className:"p-4 text-center text-slate-500",children:"No users assigned"})})})]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",disabled:j,onClick:()=>{p(!1),x(null)},children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",disabled:b||j,onClick:C,children:j?"Saving...":"Save"})]})]})]})}):null]})}function Nse(){const[t,s]=f.useState([]),[r,a]=f.useState(!0),[n,i]=f.useState(!1),[l,o]=f.useState(-1),[d,u]=f.useState([]),[c,h]=f.useState({name:"",type:"cash",account:"",requireReference:!1,active:!0}),[m,p]=f.useState(!0),[g,x]=f.useState(!0),[b,y]=f.useState(""),[j,N]=f.useState("10000"),[_,F]=f.useState(!0),[I,w]=f.useState(""),[E,W]=f.useState("2.5"),[R,U]=f.useState(!0),T=f.useMemo(()=>{const L=new Map;for(const V of d){if(!V||V.id===void 0||V.id===null)continue;const P=String(V.id),C=String(V.name||"").trim();L.set(P,C||P)}return L},[d]);function Y(){a(!0),Z.get("/pos/payment-modes").then(L=>{var C;const P=(Array.isArray((C=L.data)==null?void 0:C.items)?L.data.items:[]).map(k=>({id:k.id,name:k.name,type:k.type,account:k.account||"",requireReference:!!k.require_reference,active:!!k.is_active}));s(P)}).catch(()=>{s([])}).finally(()=>a(!1))}f.useEffect(()=>{Y()},[]),f.useEffect(()=>{let L=!0;return Z.get("/finance/accounts",{params:{postable:1,active:1}}).then(V=>{var C;if(!L)return;const P=Array.isArray((C=V.data)==null?void 0:C.items)?V.data.items:[];u(P)}).catch(()=>{L&&u([])}),()=>{L=!1}},[]),f.useEffect(()=>{try{const L=localStorage.getItem(PC);if(!L)return;const V=JSON.parse(L);if(!V||typeof V!="object")return;typeof V.cashEnabled=="boolean"&&p(V.cashEnabled),typeof V.cardEnabled=="boolean"&&x(V.cardEnabled),V.cashAccountId&&y(String(V.cashAccountId)),V.maxCashAmount!==void 0&&N(String(V.maxCashAmount)),typeof V.requireChangeCalc=="boolean"&&F(V.requireChangeCalc),V.cardBankAccountId&&w(String(V.cardBankAccountId)),V.cardProcessingFee!==void 0&&W(String(V.cardProcessingFee)),typeof V.requireCardLast4=="boolean"&&U(V.requireCardLast4)}catch{}},[]);function H(){o(-1),h({name:"",type:"cash",account:"",requireReference:!1,active:!0}),i(!0)}function M(L){const V=t[L];o(L),h({name:(V==null?void 0:V.name)||"",type:(V==null?void 0:V.type)||"cash",account:(V==null?void 0:V.account)||"",requireReference:!!(V!=null&&V.requireReference),active:!!(V!=null&&V.active)}),i(!0)}async function q(L){var P,C,k,B;const V=t[L];if(!V||!V.id){s(G=>G.filter((O,K)=>K!==L));return}try{await Z.put(`/pos/payment-modes/${V.id}`,{name:V.name,type:V.type,account:V.account||"",requireReference:V.requireReference||!1,active:!1}),Y(),ct.success("Payment mode deactivated")}catch(G){const O=((C=(P=G==null?void 0:G.response)==null?void 0:P.data)==null?void 0:C.message)||((B=(k=G==null?void 0:G.response)==null?void 0:k.data)==null?void 0:B.error)||"Failed to deactivate payment mode";ct.error(O)}}async function z(){var P,C,k,B;const L=String(c.name||"").trim(),V=String(c.type||"").trim();if(!L||!V){ct.warn("Provide payment name and type");return}try{if(l>=0){const G=t[l];if(!G||!G.id){ct.error("Payment mode id is missing");return}await Z.put(`/pos/payment-modes/${G.id}`,{name:L,type:V,account:c.account||"",requireReference:!!c.requireReference,active:!!c.active})}else await Z.post("/pos/payment-modes",{name:L,type:V,account:c.account||"",requireReference:!!c.requireReference,active:!!c.active});i(!1),o(-1),Y(),ct.success("Payment mode saved")}catch(G){const O=((C=(P=G==null?void 0:G.response)==null?void 0:P.data)==null?void 0:C.message)||((B=(k=G==null?void 0:G.response)==null?void 0:k.data)==null?void 0:B.error)||"Failed to save payment mode";ct.error(O)}}function Q(){const L={cashEnabled:!!m,cardEnabled:!!g,cashAccountId:b||"",maxCashAmount:j===""?"":Number(j||0).toString(),requireChangeCalc:!!_,cardBankAccountId:I||"",cardProcessingFee:E===""?"":Number(E||0).toString(),requireCardLast4:!!R};try{localStorage.setItem(PC,JSON.stringify(L)),ct.success("Payment settings saved")}catch{ct.error("Failed to save payment settings")}}return e.jsxs("div",{className:"space-y-6",children:[e.jsx(mF,{title:"About Payment Methods",children:"Configure available payment methods for your POS system. Enable or disable payment options and set processing preferences."}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-900",children:"Payment Methods"}),e.jsx("button",{type:"button",className:"btn-success",onClick:H,children:"+ Add Payment Mode"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Payment Name"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Account"}),e.jsx("th",{children:"Require Reference"}),e.jsx("th",{children:"Active"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:r?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500",children:"Loading..."})}):t.length?t.map((L,V)=>e.jsxs("tr",{children:[e.jsx("td",{children:L.name}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-success",children:L.type})}),e.jsx("td",{children:L.account?T.get(String(L.account))||String(L.account):"N/A"}),e.jsx("td",{children:L.requireReference?"Yes":"No"}),e.jsx("td",{children:e.jsx("span",{className:L.active?"badge-success badge":"badge-secondary badge",children:L.active?"Active":"Inactive"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>M(V),children:"Edit"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>q(V),children:"Delete"})]})})]},L.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-slate-500",children:"No payment modes configured"})})})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-900",children:"Cash Payment"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:L=>p(L.target.checked)}),e.jsx("span",{className:"text-sm",children:"Enable Cash Payments"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Cash Account"}),e.jsxs("select",{className:"input",value:b,onChange:L=>y(L.target.value),children:[e.jsx("option",{value:"",children:"Select cash account"}),d.map(L=>e.jsxs("option",{value:String(L.id),children:[L.code," - ",L.name]},L.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Max Cash Amount"}),e.jsx("input",{className:"input",type:"number",step:"0.01",value:j,onChange:L=>N(L.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Require Change Calculation"}),e.jsxs("select",{className:"input",value:_?"YES":"NO",onChange:L=>F(L.target.value==="YES"),children:[e.jsx("option",{value:"YES",children:"Yes"}),e.jsx("option",{value:"NO",children:"No"})]})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-900",children:"Card Payment"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:L=>x(L.target.checked)}),e.jsx("span",{className:"text-sm",children:"Enable Card Payments"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Bank Account"}),e.jsxs("select",{className:"input",value:I,onChange:L=>w(L.target.value),children:[e.jsx("option",{value:"",children:"Select bank account"}),d.map(L=>e.jsxs("option",{value:String(L.id),children:[L.code," - ",L.name]},L.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Processing Fee %"}),e.jsx("input",{className:"input",type:"number",step:"0.01",value:E,onChange:L=>W(L.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Require Card Last 4 Digits"}),e.jsxs("select",{className:"input",value:R?"YES":"NO",onChange:L=>U(L.target.value==="YES"),children:[e.jsx("option",{value:"YES",children:"Yes"}),e.jsx("option",{value:"NO",children:"No"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Card Types Accepted"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"text-sm",children:"Visa"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"text-sm",children:"Mastercard"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"text-sm",children:"American Express"})]})]})]})]})})]}),e.jsx("div",{children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:Q,children:"Save Payment Settings"})}),n?e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-erp w-full max-w-md overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-slate-200 bg-brand text-white",children:e.jsx("div",{className:"text-lg font-bold",children:l>=0?"Edit Payment Mode":"Add Payment Mode"})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Payment Name"}),e.jsx("input",{className:"input",value:c.name,onChange:L=>h(V=>({...V,name:L.target.value})),placeholder:"e.g., Cash, Credit Card"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Payment Type"}),e.jsxs("select",{className:"input",value:c.type,onChange:L=>h(V=>({...V,type:L.target.value})),children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"mobile",children:"Mobile Money"}),e.jsx("option",{value:"bank",children:"Bank Transfer"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Account"}),e.jsxs("select",{className:"input",value:c.account,onChange:L=>h(V=>({...V,account:L.target.value})),children:[e.jsx("option",{value:"",children:"Select account"}),d.map(L=>e.jsxs("option",{value:String(L.id),children:[L.code," - ",L.name]},L.id))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:c.requireReference,onChange:L=>h(V=>({...V,requireReference:L.target.checked}))}),e.jsx("span",{className:"text-sm",children:"Require Reference Number"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:c.active,onChange:L=>h(V=>({...V,active:L.target.checked}))}),e.jsx("span",{className:"text-sm",children:"Active"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{i(!1),o(-1)},children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:z,children:"Save Payment Mode"})]})]})]})}):null]})}function wse(){const[t,s]=f.useState([]),[r,a]=f.useState(""),[n,i]=f.useState(!0),[l,o]=f.useState("Inclusive"),[d,u]=f.useState(!0),[c,h]=f.useState([]),[m,p]=f.useState(""),[g,x]=f.useState(!0);f.useEffect(()=>{let y=!0;return Z.get("/finance/tax-codes").then(j=>{var N;y&&s(Array.isArray((N=j.data)==null?void 0:N.items)?j.data.items:[])}).catch(()=>{y&&s([])}).finally(()=>{y&&i(!1)}),()=>{y=!1}},[]),f.useEffect(()=>{let y=!0;return Z.get("/pos/tax-settings").then(j=>{var _;if(!y)return;const N=((_=j.data)==null?void 0:_.item)||null;N&&(N.tax_code_id&&a(String(N.tax_code_id)),N.tax_account_id&&p(String(N.tax_account_id)),N.tax_type&&o(String(N.tax_type)),N.is_active!==void 0&&u(!!N.is_active))}).catch(()=>{}),()=>{y=!1}},[]);async function b(){const y={taxCodeId:r||"",taxAccountId:m||"",taxType:l||"",isActive:!!d};try{await Z.put("/pos/tax-settings",y),ct.success("Tax settings saved")}catch{ct.error("Failed to save tax settings")}}return f.useEffect(()=>{let y=!0;return Z.get("/finance/accounts",{params:{postable:1,active:1}}).then(j=>{var _;if(!y)return;const N=Array.isArray((_=j.data)==null?void 0:_.items)?j.data.items:[];h(N)}).catch(()=>{y&&h([])}).finally(()=>{y&&x(!1)}),()=>{y=!1}},[]),e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-900",children:"Tax Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Default Tax Code"}),e.jsxs("select",{className:"input",value:r,onChange:y=>a(y.target.value),disabled:n,children:[e.jsx("option",{value:"",children:"Select tax code"}),t.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Tax Type"}),e.jsxs("select",{className:"input",value:l,onChange:y=>o(y.target.value),children:[e.jsx("option",{value:"Inclusive",children:"Inclusive"}),e.jsx("option",{value:"Exclusive",children:"Exclusive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Tax Account"}),e.jsxs("select",{className:"input",value:m,onChange:y=>p(y.target.value),disabled:g,children:[e.jsx("option",{value:"",children:"Select tax account"}),c.map(y=>e.jsxs("option",{value:y.id,children:[y.code,"  ",y.name]},y.id))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:y=>u(y.target.checked)}),e.jsx("label",{className:"label mb-0",children:"Tax Active"})]}),e.jsx("div",{children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:b,children:"Save Tax Settings"})})]})})})}function _se(){const[t,s]=f.useState(""),[r,a]=f.useState(""),[n,i]=f.useState(""),[l,o]=f.useState(""),[d,u]=f.useState(""),[c,h]=f.useState(""),[m,p]=f.useState(!1),[g,x]=f.useState({name:"",address:"",city:"",state:"",country:"",phone:"",email:"",website:"",taxId:"",registrationNo:"",logoUrl:Ws}),[b,y]=f.useState(!1);f.useEffect(()=>{let N=!0;async function _(){var F;try{const w=((F=(await Z.get("/pos/receipt-settings")).data)==null?void 0:F.item)||null;if(!N)return;w&&(w.company_name&&s(String(w.company_name)),w.header_text&&i(String(w.header_text)),w.footer_text&&o(String(w.footer_text)),w.contact_number&&a(String(w.contact_number)),w.address_line1&&u(String(w.address_line1)),w.address_line2&&h(String(w.address_line2)),p(w.show_logo===1||w.show_logo===!0||String(w.show_logo).toLowerCase()==="true"))}catch{}}return _(),()=>{N=!1}},[]),f.useEffect(()=>{let N=!0;async function _(){var F,I,w;try{y(!0);const W=(I=(F=(await Z.get("/admin/me")).data)==null?void 0:F.scope)==null?void 0:I.companyId;if(!W){if(!N)return;x(T=>({...T,logoUrl:T.logoUrl||Ws}));return}const U=((w=(await Z.get(`/admin/companies/${W}`)).data)==null?void 0:w.item)||{};if(!N)return;x(T=>({...T,name:U.name||T.name||"",address:U.address||T.address||"",city:U.city||T.city||"",state:U.state||T.state||"",country:U.country||T.country||"",phone:U.telephone||T.phone||"",email:U.email||T.email||"",website:U.website||T.website||"",taxId:U.tax_id||T.taxId||"",registrationNo:U.registration_no||T.registrationNo||"",logoUrl:U.has_logo===1||U.has_logo===!0?`/api/admin/companies/${W}/logo`:T.logoUrl||Ws}))}catch{if(!N)return;x(E=>({...E,logoUrl:E.logoUrl||Ws}))}finally{N&&y(!1)}}return _(),()=>{N=!1}},[]);async function j(){var _,F,I,w;const N={companyName:t.trim(),contactNumber:r.trim(),headerText:n.trim(),footerText:l.trim(),addressLine1:d.trim(),addressLine2:c.trim(),logoUrl:g.logoUrl||"",showLogo:!!m};try{await Z.put("/pos/receipt-settings",N),ct.success("Receipt settings saved")}catch(E){const W=((F=(_=E==null?void 0:E.response)==null?void 0:_.data)==null?void 0:F.message)||((w=(I=E==null?void 0:E.response)==null?void 0:I.data)==null?void 0:w.error)||"Failed to save receipt settings";ct.error(W)}}return e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-900",children:"Receipt Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 border rounded bg-white flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:g.logoUrl,alt:g.name||"Company Logo",className:"max-w-full max-h-full object-contain"})}),e.jsxs("div",{className:"text-xs text-slate-700",children:[e.jsx("div",{className:"font-semibold text-sm",children:g.name||"Company Name"}),e.jsxs("div",{children:[g.address,g.city?`, ${g.city}`:"",g.country?`, ${g.country}`:""]}),e.jsx("div",{children:g.phone?`Mobile: ${g.phone}`:g.email||""}),e.jsx("div",{children:g.taxId?`TIN: ${g.taxId}`:""})]})]}),e.jsx("div",{className:"md:col-span-2 text-xs text-slate-500",children:b?"Loading company information from profile...":"Company details are loaded from the company profile (adm_companies)."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-center",children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Upload Logo"}),e.jsx("input",{type:"file",accept:"image/*",className:"input",onChange:async N=>{var F,I,w,E,W,R;const _=(F=N.target.files)==null?void 0:F[0];if(_)try{const U=new FormData;U.append("logo",_);const T=await Z.post("/pos/receipt-settings/logo",U,{headers:{"Content-Type":"multipart/form-data"}}),Y=((I=T==null?void 0:T.data)==null?void 0:I.logoUrl)||g.logoUrl||"";x(H=>({...H,logoUrl:Y})),p(!0),ct.success("Logo uploaded and linked to receipts")}catch(U){const T=((E=(w=U==null?void 0:U.response)==null?void 0:w.data)==null?void 0:E.message)||((R=(W=U==null?void 0:U.response)==null?void 0:W.data)==null?void 0:R.error)||"Failed to upload logo";ct.error(T)}finally{N.target.value=""}}})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Company Name"}),e.jsx("input",{className:"input",type:"text",placeholder:"Company name",value:t,onChange:N=>s(N.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Contact Number"}),e.jsx("input",{className:"input",type:"text",placeholder:"+1234567890",value:r,onChange:N=>a(N.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Receipt Header Text"}),e.jsx("textarea",{className:"input h-28",placeholder:"Thank you for your purchase",value:n,onChange:N=>i(N.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Receipt Footer Text"}),e.jsx("textarea",{className:"input h-28",placeholder:"Please visit again",value:l,onChange:N=>o(N.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Address Line 1"}),e.jsx("input",{className:"input",type:"text",placeholder:"Street address",value:d,onChange:N=>u(N.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Address Line 2"}),e.jsx("input",{className:"input",type:"text",placeholder:"City, State, ZIP",value:c,onChange:N=>h(N.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:N=>p(N.target.checked)}),e.jsx("span",{className:"text-sm",children:"Show Logo on Receipt"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",disabled:!0}),e.jsx("span",{className:"text-sm",children:"Show Barcode on Receipt"})]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:j,children:"Save Receipt Settings"})})]})})})}function Sse(){const[t,s]=f.useState("GHS - Ghana Cedi"),[r,a]=f.useState("2"),[n,i]=f.useState("MM/DD/YYYY"),[l,o]=f.useState("12 Hour"),[d,u]=f.useState(!1),[c,h]=f.useState(!1),[m,p]=f.useState(!1),[g,x]=f.useState(!1);f.useEffect(()=>{try{const y=localStorage.getItem(UC);if(!y)return;const j=JSON.parse(y);if(!j||typeof j!="object")return;j.defaultCurrency&&s(String(j.defaultCurrency)),j.decimalPlaces!==void 0&&a(String(j.decimalPlaces)),j.dateFormat&&i(String(j.dateFormat)),j.timeFormat&&o(String(j.timeFormat)),typeof j.allowDiscounts=="boolean"&&u(j.allowDiscounts),typeof j.requireCustomer=="boolean"&&h(j.requireCustomer),typeof j.autoLogoutAfterShiftClose=="boolean"&&p(j.autoLogoutAfterShiftClose),typeof j.autoPrintReceipt=="boolean"&&x(j.autoPrintReceipt)}catch{}},[]);function b(){const y={defaultCurrency:t,decimalPlaces:r||"2",dateFormat:n,timeFormat:l,allowDiscounts:!!d,requireCustomer:!!c,autoLogoutAfterShiftClose:!!m,autoPrintReceipt:!!g};try{localStorage.setItem(UC,JSON.stringify(y)),ct.success("General settings saved")}catch{ct.error("Failed to save general settings")}}return e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-900",children:"General Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Default Currency"}),e.jsxs("select",{className:"input",value:t,onChange:y=>s(y.target.value),children:[e.jsx("option",{value:"USD - US Dollar",children:"USD - US Dollar"}),e.jsx("option",{value:"EUR - Euro",children:"EUR - Euro"}),e.jsx("option",{value:"GBP - British Pound",children:"GBP - British Pound"}),e.jsx("option",{value:"GHS - Ghana Cedi",children:"GHS - Ghana Cedi"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Decimal Places"}),e.jsxs("select",{className:"input",value:r,onChange:y=>a(y.target.value),children:[e.jsx("option",{value:"0",children:"0"}),e.jsx("option",{value:"2",children:"2"}),e.jsx("option",{value:"3",children:"3"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Date Format"}),e.jsxs("select",{className:"input",value:n,onChange:y=>i(y.target.value),children:[e.jsx("option",{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx("option",{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),e.jsx("option",{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Time Format"}),e.jsxs("select",{className:"input",value:l,onChange:y=>o(y.target.value),children:[e.jsx("option",{value:"12 Hour",children:"12 Hour"}),e.jsx("option",{value:"24 Hour",children:"24 Hour"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:y=>u(y.target.checked)}),e.jsx("span",{className:"text-sm",children:"Allow Discounts"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:y=>h(y.target.checked)}),e.jsx("span",{className:"text-sm",children:"Require Customer for Sales"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:y=>p(y.target.checked)}),e.jsx("span",{className:"text-sm",children:"Auto Logout After Shift Close"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:y=>x(y.target.checked)}),e.jsx("span",{className:"text-sm",children:"Auto Print Receipt"})]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:b,children:"Save General Settings"})})]})})})}function Cse(){const[t,s]=f.useState("terminals"),r=[{key:"terminals",label:" Terminals"},{key:"payment",label:" Payment Modes"},{key:"taxes",label:" Tax Settings"},{key:"receipts",label:" Receipt Settings"},{key:"general",label:" General Settings"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(yse,{emoji:"",title:"POS Setup & Configuration",subtitle:"Configure terminals, payment methods, and system settings"}),e.jsx("div",{className:"flex gap-2",children:r.map(a=>e.jsx(bse,{active:t===a.key,onClick:()=>s(a.key),children:a.label},a.key))}),t==="terminals"&&e.jsx(jse,{}),t==="payment"&&e.jsx(Nse,{}),t==="taxes"&&e.jsx(wse,{}),t==="receipts"&&e.jsx(_se,{}),t==="general"&&e.jsx(Sse,{})]})}function Jb({value:t,onChange:s,options:r,placeholder:a,disabled:n,filterPlaceholder:i}){const l=Array.isArray(r)?r:[];return e.jsx("div",{children:e.jsxs("select",{className:"input",value:t,onChange:o=>s(o.target.value),disabled:n,children:[e.jsx("option",{value:"",children:a||"Select..."}),l.map(o=>e.jsx("option",{value:String(o.value),children:o.label},String(o.value)))]})})}function OC(){const[t,s]=f.useState(new Date),[r,a]=f.useState(""),[n,i]=f.useState(""),[l,o]=f.useState(""),[d,u]=f.useState(""),[c,h]=f.useState(!1),[m,p]=f.useState(null),[g,x]=f.useState([]),[b,y]=f.useState("cash"),[j,N]=f.useState(""),[_,F]=f.useState(!1),[I,w]=f.useState({amount:0,method:"",ref:""}),[E,W]=f.useState(null),[R,U]=f.useState([]),[T,Y]=f.useState(!1),[H,M]=f.useState(!0),[q,z]=f.useState(""),[Q,L]=f.useState([]),[V,P]=f.useState(!1),[C,k]=f.useState(""),[B,G]=f.useState([]),[O,K]=f.useState(!1),[J,te]=f.useState("");f.useEffect(()=>{const He=setInterval(()=>s(new Date),1e3);return()=>clearInterval(He)},[]),f.useEffect(()=>{let He=!1;return M(!0),Z.get("/pos/day/status").then(st=>{var Ce;if(He)return;const De=((Ce=st==null?void 0:st.data)==null?void 0:Ce.item)||null,Te=String((De==null?void 0:De.status)||"").toUpperCase()==="OPEN";Y(Te)}).catch(()=>{He||Y(!1)}).finally(()=>{He||M(!1)}),()=>{He=!0}},[]),f.useEffect(()=>{let He=!0;return P(!0),k(""),Z.get("/sales/price-types").then(st=>{var Te;if(!He)return;const De=Array.isArray((Te=st.data)==null?void 0:Te.items)?st.data.items:[];if(L(De),!q&&De.length){let Ce=De.find(Pe=>String(Pe.name||"").trim().toLowerCase()==="retail")||De[0];Ce&&Ce.id&&z(String(Ce.id))}}).catch(st=>{var De,Te;He&&k(((Te=(De=st==null?void 0:st.response)==null?void 0:De.data)==null?void 0:Te.message)||"Failed to load price types")}).finally(()=>{He&&P(!1)}),()=>{He=!1}},[q]),f.useEffect(()=>{let He=!0;return K(!0),te(""),Z.get("/inventory/items").then(st=>{var Ce;if(!He)return;const Te=(Array.isArray((Ce=st.data)==null?void 0:Ce.items)?st.data.items:[]).filter(Pe=>Pe&&Pe.is_active!==!1).map(Pe=>({id:Pe.id,name:Pe.item_name||"",code:Pe.item_code||""}));G(Te)}).catch(st=>{var De,Te;He&&te(((Te=(De=st==null?void 0:st.response)==null?void 0:De.data)==null?void 0:Te.message)||"Failed to load items")}).finally(()=>{He&&K(!1)}),()=>{He=!1}},[]),f.useEffect(()=>{let He=!1;async function st(){if(!Array.isArray(g)||!g.length)return;const De=await Promise.all(g.map(async Te=>{const Ce=B.find(fe=>String(fe.name||"").trim().toLowerCase()===String(Te.name||"").trim().toLowerCase())||null,Pe=Ce?await se(Ce.id,q,Te.price):Te.price;return{...Te,price:Pe}}));He||x(De)}return st(),()=>{He=!0}},[q]);async function se(He,st,De){var Te;try{const Ce={product_id:He,quantity:1,price_type:st||"",only_standard:!0},Pe=await Z.post("/sales/prices/best-price",Ce),fe=Number((Te=Pe.data)==null?void 0:Te.price);return Number.isFinite(fe)?fe:Number(De||0)}catch{return Number(De||0)}}f.useEffect(()=>{let He=!1;async function st(){var Te,Ce;const De=String(n||"").trim();if(a(""),o(""),u(""),p(null),x([]),!De){h(!0);try{const Pe=await Z.get("/pos/sales",{params:{limit:200}}),he=(Array.isArray((Te=Pe.data)==null?void 0:Te.items)?Pe.data.items:Array.isArray((Ce=Pe.data)==null?void 0:Ce.item)?Pe.data.item:[]).map(Ue=>({id:Ue.id,receiptNo:String(Ue.sale_no||""),date:String(Ue.sale_date||"").slice(0,10),customer:String(Ue.customer_id||""),payment:String(Ue.payment_method||"").replace(/^./,Ye=>Ye.toUpperCase())}));U(he)}catch{U([])}finally{h(!1)}return}h(!0);try{async function Pe(Ue){var Je,xe;const Ye=await Z.get("/pos/sales",{params:{limit:1e3,...Ue}});return Array.isArray((Je=Ye.data)==null?void 0:Je.items)?Ye.data.items:Array.isArray((xe=Ye.data)==null?void 0:xe.item)?Ye.data.item:[]}let fe=[];try{fe=await Pe({date:De})}catch{}if(!He&&!fe.length)try{fe=await Pe({sale_date:De})}catch{}if(!He&&!fe.length)try{fe=await Pe({from:De,to:De})}catch{}if(!He&&!fe.length)try{fe=(await Pe({})).filter(Ye=>String(Ye.sale_date||Ye.date||"").slice(0,10)===De)}catch{}if(He)return;const he=fe.map(Ue=>({id:Ue.id,receiptNo:String(Ue.sale_no||""),date:String(Ue.sale_date||"").slice(0,10),customer:String(Ue.customer_id||""),payment:String(Ue.payment_method||"").replace(/^./,Ye=>Ye.toUpperCase())}));U(he)}catch{if(He)return;U([])}finally{if(He)return;h(!1)}}return st(),()=>{He=!0}},[n]);const ae=f.useMemo(()=>g.reduce((He,st)=>He+st.price*st.returnQuantity,0),[g]),ne=f.useMemo(()=>ae*.125,[ae]),ue=f.useMemo(()=>ae+ne,[ae,ne]);async function oe(){var De;const He=Number(r||0);if(!He)return;const st=R.find(Te=>Number(Te.id)===He)||null;if(st)try{const Te=await Z.get(`/pos/sales/${st.id}`),Pe=(Array.isArray((De=Te.data)==null?void 0:De.details)?Te.data.details:[]).map((fe,he)=>({id:he+1,name:String(fe.item_name||""),price:Number(fe.unit_price||0),quantity:Number(fe.qty||0)}));p({...st,items:Pe}),x([])}catch{p({...st,items:[]}),x([])}}function le(He,st){if(!m)return;const De=m.items.find(Te=>Te.id===He);De&&(st?(async()=>{const Te=B.find(fe=>String(fe.name||"").trim().toLowerCase()===String(De.name||"").trim().toLowerCase())||null,Ce=Te?await se(Te.id,q,De.price):De.price,Pe={id:De.id,name:De.name,price:Ce,soldQty:De.quantity,returnQuantity:1,reason:"defective"};x(fe=>{const he=fe.findIndex(Ue=>Ue.id===He);if(he>=0){const Ue=fe.slice();return Ue[he]=Pe,Ue}return[...fe,Pe]})})():x(Te=>Te.filter(Ce=>Ce.id!==He)))}function X(He,st){const De=Math.max(1,Number(st||1));x(Te=>Te.map(Ce=>Ce.id===He?{...Ce,returnQuantity:De}:Ce))}function me(He,st){x(De=>De.map(Te=>Te.id===He?{...Te,reason:st}:Te))}function we(He){x(st=>st.filter(De=>De.id!==He))}function Ie(){g.length&&x([])}function _e(){if(!g.length)return;const He="RTN-"+Date.now(),st=new Date;w({amount:ue,method:b==="cash"?"Cash":b==="card"?"Card Refund":b==="mobile"?"Mobile Money":"Store Credit",ref:He}),W(st),F(!0)}function Fe(){F(!1),p(null),x([]),a(""),i(""),o(""),u(""),N("")}function Le(){var Ue;if(!m||!g.length)return;const st=(E?new Date(E):new Date).toLocaleString(),De=g.map(Ye=>{const Ke=Number(Ye.returnQuantity||0),Je=Number(Ye.price||0),xe=Ke*Je,ye=String(Ye.reason||"").replace(/^./,Ae=>Ae.toUpperCase());return`<tr>
          <td>${String(Ye.name||"")}</td>
          <td class="right">${Ke}</td>
          <td class="right">${Je.toFixed(2)}</td>
          <td class="right">${xe.toFixed(2)}</td>
          <td>${ye}</td>
        </tr>`}).join(""),Te=String(j||"").trim()?`<div class="muted" style="margin-top:8px;">Notes: ${String(j||"")}</div>`:"",Ce=`
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="utf-8" />
        <title>POS Return Receipt</title>
        <style>
          body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; padding: 16px; max-width: 480px; margin: 0 auto; }
          h1 { text-align: center; margin: 0 0 4px; font-size: 18px; }
          .center { text-align: center; }
          .muted { font-size: 12px; color: #555; }
          .row { display: flex; justify-content: space-between; font-size: 13px; margin: 2px 0; }
          table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; }
          th, td { padding: 4px; border-bottom: 1px solid #eee; vertical-align: top; }
          th { text-align: left; }
          th.right, td.right { text-align: right; }
          .totals { margin-top: 8px; border-top: 1px solid #000; padding-top: 4px; }
          @media print { button { display: none; } }
        </style>
      </head>
      <body>
        <h1>RETURN RECEIPT</h1>
        <div class="center muted">Sales Return & Refund</div>
        <hr />
        <div class="row"><span>Return Ref:</span><span>${String(I.ref||"-")}</span></div>
        <div class="row"><span>Original Receipt:</span><span>${String(m.receiptNo||"-")}</span></div>
        <div class="row"><span>Sale Date:</span><span>${String(m.date||"-")}</span></div>
        <div class="row"><span>Return Date:</span><span>${st}</span></div>
        <div class="row"><span>Refund Method:</span><span>${String(I.method||"-")}</span></div>
        <table>
          <thead>
            <tr>
              <th>Item</th>
              <th class="right">Qty</th>
              <th class="right">Price</th>
              <th class="right">Total</th>
              <th>Reason</th>
            </tr>
          </thead>
          <tbody>
            ${De}
          </tbody>
        </table>
        <div class="totals">
          <div class="row"><span>Items Subtotal</span><span>${ae.toFixed(2)}</span></div>
          <div class="row"><span>Tax Refund</span><span>${ne.toFixed(2)}</span></div>
          <div class="row"><strong>Total Refund</strong><strong>${ue.toFixed(2)}</strong></div>
        </div>
        ${Te}
        <button onclick="window.print()">Print</button>
      </body>
      </html>
    `,Pe=document.createElement("iframe");Pe.style.position="fixed",Pe.style.right="0",Pe.style.bottom="0",Pe.style.width="0",Pe.style.height="0",Pe.style.border="0",document.body.appendChild(Pe);const fe=((Ue=Pe.contentWindow)==null?void 0:Ue.document)||Pe.contentDocument||null;if(!fe)return;fe.open(),fe.write(Ce),fe.close();const he=Pe.contentWindow;he&&(he.focus(),setTimeout(()=>{try{he.print()}catch{}setTimeout(()=>{try{document.body.removeChild(Pe)}catch{}},500)},150))}const rt=f.useMemo(()=>(Array.isArray(R)?R:[]).filter(He=>{const st=String(l||"").trim().toLowerCase(),De=String(d||"").trim().toLowerCase();return!(st&&!String(He.customer||"").toLowerCase().includes(st)||De&&String(He.payment||"").toLowerCase()!==De)}).map(He=>{const st=String(He.receiptNo||"-"),De=String(He.date||""),Te=De?`${st}  ${De}`:st;return{value:String(He.id),label:Te}}),[R,l,d]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/pos",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to POS"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Sales Return & Refund"}),e.jsx("p",{className:"text-sm mt-1",children:"Process returns from original receipts"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-slate-700",children:t.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("div",{className:"text-sm font-semibold text-brand-700",children:t.toLocaleTimeString()})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[!H&&!T&&e.jsxs("div",{className:"alert-danger rounded-lg p-4",children:["Day is not open. Open day before processing returns.",e.jsx("div",{className:"mt-2",children:e.jsx(Re,{to:"/pos/day-management",className:"btn-secondary",children:"Open Day Management"})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"font-semibold",children:"Find Original Sale"})}),e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Sale Date"}),e.jsx("input",{type:"date",className:"input",value:n,onChange:He=>i(He.target.value),disabled:!T})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Receipt Number"}),e.jsx(Jb,{value:r,onChange:a,options:rt,placeholder:c?"Loading receipts...":"Select receipt",disabled:!T||c,filterPlaceholder:"Filter receipts..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Customer Phone"}),e.jsx("input",{className:"input",placeholder:"e.g., 0244123456",value:l,onChange:He=>o(He.target.value),disabled:!T})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Payment Method"}),e.jsx(Jb,{value:d,onChange:u,options:[{value:"cash",label:"Cash"},{value:"card",label:"Card"},{value:"mobile",label:"Mobile Money"}],placeholder:"All Methods",disabled:!T,filterPlaceholder:"Filter methods..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Price Type"}),e.jsx(Jb,{value:q,onChange:He=>{z(He),x(st=>st.map(De=>({...De})))},options:Q.map(He=>({value:String(He.id),label:String(He.name||"")})),placeholder:V?"Loading price types...":"Select Price Type",disabled:!T||V||!Q.length,filterPlaceholder:"Filter price types..."})]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",className:"btn-primary w-full",onClick:oe,disabled:!T||!r,children:"Search Receipt"})})]})]}),m?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"text-slate-500",children:"Receipt Number"}),e.jsx("div",{className:"font-medium",children:m.receiptNo})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"text-slate-500",children:"Sale Date"}),e.jsx("div",{className:"font-medium",children:m.date})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"text-slate-500",children:"Customer"}),e.jsx("div",{className:"font-medium",children:m.customer})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"text-slate-500",children:"Payment Method"}),e.jsx("div",{className:"font-medium",children:m.payment})]}),e.jsxs("div",{className:"flex justify-between md:col-span-2",children:[e.jsx("div",{className:"text-slate-500",children:"Original Total"}),e.jsx("div",{className:"font-medium",children:(()=>{const He=m.items.reduce((De,Te)=>De+Te.price*Te.quantity,0),st=He*.125;return`GH ${(He+st).toFixed(2)}`})()})]})]})})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("div",{className:"font-semibold",children:"Select Items to Return"})}),e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Return"}),e.jsx("th",{children:"Item Name"}),e.jsx("th",{className:"text-right",children:"Price"}),e.jsx("th",{className:"text-right",children:"Sold Qty"}),e.jsx("th",{className:"text-right",children:"Return Qty"}),e.jsx("th",{children:"Reason"})]})}),e.jsx("tbody",{children:m.items.map(He=>{const st=g.find(De=>De.id===He.id);return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",className:"checkbox",checked:!!st,onChange:De=>le(He.id,De.target.checked)})}),e.jsx("td",{className:"font-medium",children:He.name}),e.jsx("td",{className:"text-right",children:`GH ${Number(He.price).toFixed(2)}`}),e.jsx("td",{className:"text-right",children:He.quantity}),e.jsx("td",{className:"text-right",children:e.jsx("input",{type:"number",className:"input w-24 text-right",min:1,max:He.quantity,value:st?st.returnQuantity:1,disabled:!st,onChange:De=>X(He.id,De.target.value)})}),e.jsx("td",{children:e.jsxs("select",{className:"input",value:st?st.reason:"defective",disabled:!st,onChange:De=>me(He.id,De.target.value),children:[e.jsx("option",{value:"defective",children:"Defective"}),e.jsx("option",{value:"wrong",children:"Wrong Item"}),e.jsx("option",{value:"damaged",children:"Damaged"}),e.jsx("option",{value:"unwanted",children:"Unwanted"}),e.jsx("option",{value:"other",children:"Other"})]})})]},He.id)})})]})})]})]}):e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"text-center text-slate-600",children:"Search for a receipt to process returns"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"font-semibold",children:"Return Summary"})}),e.jsxs("div",{className:"card-body space-y-3",children:[e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:g.length?g.map(He=>e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-slate-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium text-slate-900",children:He.name}),e.jsx("div",{className:"text-red-600 font-semibold",children:`-GH ${(He.price*He.returnQuantity).toFixed(2)}`})]}),e.jsxs("div",{className:"text-xs text-slate-600 mt-1",children:[He.returnQuantity,"  GH"," ",Number(He.price).toFixed(2)," "," ",String(He.reason||"").replace(/^./,st=>st.toUpperCase())]}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{type:"button",className:"btn-danger",onClick:()=>we(He.id),children:"Remove"})})]},He.id)):e.jsx("div",{className:"text-center text-slate-600",children:"No items selected for return"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Items Subtotal"}),e.jsx("div",{children:`GH ${ae.toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Tax Refund"}),e.jsx("div",{children:`GH ${ne.toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-between font-bold pt-2 border-t",children:[e.jsx("div",{children:"Total Refund"}),e.jsx("div",{className:"text-red-700",children:`GH ${ue.toFixed(2)}`})]})]})]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-3",children:[e.jsx("div",{className:"font-semibold",children:"Refund Method"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",className:`btn ${b==="cash"?"btn-primary":"btn-secondary"}`,onClick:()=>y("cash"),children:"Cash"}),e.jsx("button",{type:"button",className:`btn ${b==="card"?"btn-primary":"btn-secondary"}`,onClick:()=>y("card"),children:"Card"}),e.jsx("button",{type:"button",className:`btn ${b==="mobile"?"btn-primary":"btn-secondary"}`,onClick:()=>y("mobile"),children:"Mobile Money"}),e.jsx("button",{type:"button",className:`btn ${b==="credit"?"btn-primary":"btn-secondary"}`,onClick:()=>y("credit"),children:"Store Credit"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Additional Notes"}),e.jsx("textarea",{className:"input",value:j,onChange:He=>N(He.target.value),rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx("button",{type:"button",className:"btn-primary w-full",onClick:_e,disabled:!T||!g.length,children:"Process Return"}),e.jsx("button",{type:"button",className:"btn-secondary w-full",onClick:Ie,disabled:!T||!g.length,children:"Clear Selection"})]})]})})]})]}),_&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:"Return Processed"}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Refund Amount"}),e.jsx("div",{className:"font-semibold",children:`GH ${Number(I.amount).toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Refund Method"}),e.jsx("div",{className:"font-semibold",children:I.method})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Return Reference"}),e.jsx("div",{className:"font-semibold",children:I.ref})]})]}),e.jsxs("div",{className:"mt-6 flex gap-2",children:[e.jsx("button",{type:"button",className:"btn-primary",onClick:Fe,children:"New Return"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>{Le(),Fe()},children:"Print Return Receipt"})]})]})})]})}function Zb({value:t,onChange:s,options:r,placeholder:a,disabled:n,filterPlaceholder:i}){const l=Array.isArray(r)?r:[];return e.jsx("div",{children:e.jsxs("select",{className:"input",value:t,onChange:o=>s(o.target.value),disabled:n,children:[e.jsx("option",{value:"",children:a||"All"}),l.map(o=>e.jsx("option",{value:String(o.value),children:o.label},String(o.value)))]})})}function kse(){const{user:t}=Kr(),{canPerformAction:s}=Ls(),[r,a]=f.useState(new Date),[n,i]=f.useState(""),[l,o]=f.useState(""),[d,u]=f.useState(""),[c,h]=f.useState(""),[m,p]=f.useState(""),[g,x]=f.useState([]),[b,y]=f.useState(null),[j,N]=f.useState(1),_=10,[F,I]=f.useState(""),[w,E]=f.useState([]),[W,R]=f.useState(!1);f.useEffect(()=>{const K=setInterval(()=>a(new Date),1e3);return()=>clearInterval(K)},[]),f.useEffect(()=>{let K=!1;async function J(){var te,se,ae;R(!0);try{const[ne,ue]=await Promise.all([Z.get("/pos/terminals"),Z.get("/pos/terminal-users")]);if(K)return;const oe=Array.isArray((te=ne.data)==null?void 0:te.items)?ne.data.items:[],le=Array.isArray((se=ue.data)==null?void 0:se.items)?ue.data.items:[],X=Number((t==null?void 0:t.sub)||0)||Number((t==null?void 0:t.id)||0)||void 0,me=new Set(le.filter(_e=>Number(_e==null?void 0:_e.user_id)===X).map(_e=>Number(_e==null?void 0:_e.terminal_id)).filter(_e=>Number.isFinite(_e)&&_e>0)),we=oe.filter(_e=>me.has(Number(_e==null?void 0:_e.id)));E(we);const Ie=(we.length?String(((ae=we[0])==null?void 0:ae.code)||""):"")||"";I(Ie)}catch{if(K)return;E([]),I("")}finally{if(K)return;R(!1)}}return J(),()=>{K=!0}},[t==null?void 0:t.id,t==null?void 0:t.sub]),f.useEffect(()=>{let K=!1;const J=F?{params:{terminal:F}}:{};return Z.get("/pos/sales",J).then(te=>{var ne;if(K)return;const ae=(Array.isArray((ne=te.data)==null?void 0:ne.items)?te.data.items:[]).map(ue=>{const oe=String(ue.sale_date||""),le=oe.slice(0,10),X=oe.includes("T")?oe.split("T")[1].slice(0,8):"";return{id:ue.id,receiptNo:String(ue.sale_no||""),date:le,time:X,customer:String(ue.customer_id||""),phone:"",payment:String(ue.payment_method||"").toLowerCase(),status:String(ue.payment_status||"").toLowerCase(),items:[],total_amount:Number(ue.total_amount||0),items_count:Number(ue.items_count||0)}});x(ae)}).catch(()=>{K||x([])}),()=>{K=!0}},[F]);const U=K=>{const J=K.reduce((se,ae)=>se+ae.price*ae.quantity,0),te=J*.125;return J+te},T=K=>K.reduce((J,te)=>J+te.price*te.quantity,0),Y=f.useMemo(()=>{const K=String(m||"").toLowerCase();return g.filter(J=>{const te=(!n||J.date>=n)&&(!l||J.date<=l),se=!d||J.status===d,ae=!c||J.payment===c,ne=!K||J.receiptNo.toLowerCase().includes(K)||J.customer.toLowerCase().includes(K);return te&&se&&ae&&ne})},[g,n,l,d,c,m]),H=Math.max(1,Math.ceil(Y.length/_)),M=f.useMemo(()=>{const K=(j-1)*_,J=K+_;return Y.slice(K,J)},[Y,j]);f.useEffect(()=>{N(1)},[n,l,d,c,m]);function q(){const K=["Receipt","Date","Time","Customer","Phone","Payment","Status","Items","Total"],J=Y.map(ue=>[ue.receiptNo,ue.date,ue.time,ue.customer,ue.phone,ue.payment,ue.status,ue.items.reduce((oe,le)=>oe+le.quantity,0),U(ue.items).toFixed(2)]),te=[K.join(","),...J.map(ue=>ue.join(","))].join(`
`),se=new Blob([te],{type:"text/csv;charset=utf-8;"}),ae=URL.createObjectURL(se),ne=document.createElement("a");ne.href=ae,ne.download="pos_register.csv",ne.click(),URL.revokeObjectURL(ae)}function z(){window.print()}function Q(){alert("Register closing flow will be implemented with sessions.")}function L(K){alert("Printing transaction "+K)}function V(K){x(J=>J.filter(te=>te.id!==K))}async function P(K){var J;try{const te=await Z.get(`/pos/sales/${K.id}`),ae=(Array.isArray((J=te.data)==null?void 0:J.details)?te.data.details:[]).map(ne=>({name:String(ne.item_name||""),price:Number(ne.unit_price||0),quantity:Number(ne.qty||0)}));y({...K,items:ae})}catch{y(K)}}function C(){y(null)}function k(){alert("Printing receipt "+String((b==null?void 0:b.receiptNo)||""))}function B(){alert("Emailing receipt "+String((b==null?void 0:b.receiptNo)||""))}const G=Y.length?(j-1)*_+1:0,O=Math.min(j*_,Y.length);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/pos",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to POS"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"POS Register"}),e.jsx("p",{className:"text-sm mt-1",children:"Transactions listing and details"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-slate-700",children:r.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("div",{className:"text-sm font-semibold text-brand-700",children:r.toLocaleTimeString()})]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3 flex-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Terminal"}),e.jsx(Zb,{value:F,onChange:I,placeholder:W?"Loading terminals...":"All Terminals (assigned)",options:(Array.isArray(w)?w:[]).map(K=>({value:String(K.code||""),label:String(K.code||K.name||"")})),disabled:W,filterPlaceholder:"Filter terminals..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{type:"date",className:"input",value:n,onChange:K=>i(K.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{type:"date",className:"input",value:l,onChange:K=>o(K.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsx(Zb,{value:d,onChange:u,placeholder:"All Status",options:[{value:"completed",label:"Completed"},{value:"pending",label:"Pending"},{value:"returned",label:"Returned"}],filterPlaceholder:"Filter status..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Payment"}),e.jsx(Zb,{value:c,onChange:h,placeholder:"All Payments",options:[{value:"cash",label:"Cash"},{value:"card",label:"Card"},{value:"mobile",label:"Mobile Money"}],filterPlaceholder:"Filter payments..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Search"}),e.jsx("input",{className:"input",placeholder:"Search receipt or customer",value:m,onChange:K=>p(K.target.value)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-success",onClick:q,children:"Export CSV"}),e.jsx("button",{className:"btn-primary",onClick:z,children:"Print"}),e.jsx("button",{className:"btn-danger",onClick:Q,children:"Close Register"})]})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Receipt #"}),e.jsx("th",{children:"Date/Time"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Items"}),e.jsx("th",{children:"Payment"}),e.jsx("th",{className:"text-right",children:"Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:M.length?M.map(K=>{const J=Number(K.total_amount||0),te=Number(K.items_count||0);return e.jsxs("tr",{onClick:()=>P(K),className:"cursor-pointer",children:[e.jsx("td",{className:"font-medium",children:K.receiptNo}),e.jsxs("td",{children:[K.date,e.jsx("div",{className:"text-xs text-slate-500",children:K.time})]}),e.jsxs("td",{children:[K.customer,e.jsx("div",{className:"text-xs text-slate-500",children:K.phone})]}),e.jsx("td",{children:te}),e.jsx("td",{children:e.jsx("span",{className:"px-2 py-1 rounded bg-slate-100 text-slate-700 text-xs",children:String(K.payment||"").toUpperCase()})}),e.jsx("td",{className:"text-right",children:`GH ${Number(J).toFixed(2)}`}),e.jsx("td",{children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${K.status==="completed"?"bg-green-100 text-green-700":K.status==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:String(K.status||"").toUpperCase()})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[s("pos:register","view")&&e.jsx("button",{className:"btn btn-secondary",onClick:se=>{se.stopPropagation(),P(K)},children:"View"}),e.jsx("button",{className:"btn btn-secondary",onClick:se=>{se.stopPropagation(),L(K.id)},children:"Print"}),e.jsx("button",{className:"btn btn-danger",onClick:se=>{se.stopPropagation(),V(K.id)},children:"Delete"})]})})]},K.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"8",children:e.jsx("div",{className:"text-center text-slate-600 py-6",children:"No transactions found"})})})})]})})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:["Showing ",G," to ",O," of ",Y.length," transactions"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>N(K=>Math.max(1,K-1)),disabled:j===1,children:" Previous"}),Array.from({length:H},(K,J)=>J+1).map(K=>e.jsx("button",{className:`btn ${j===K?"btn-primary":"btn-secondary"}`,onClick:()=>N(K),children:K},K)),e.jsx("button",{className:"btn btn-secondary",onClick:()=>N(K=>Math.min(H,K+1)),disabled:j>=H,children:"Next "})]})]}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xl font-bold",children:"Transaction Details"}),e.jsx("button",{className:"btn btn-secondary",onClick:C,children:"Close"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mt-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500 text-sm",children:"Receipt Number"}),e.jsx("div",{className:"font-medium",children:b.receiptNo})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500 text-sm",children:"Date & Time"}),e.jsxs("div",{className:"font-medium",children:[b.date," ",b.time]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500 text-sm",children:"Customer"}),e.jsx("div",{className:"font-medium",children:b.customer})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500 text-sm",children:"Payment Method"}),e.jsx("div",{className:"font-medium",children:String(b.payment||"").toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500 text-sm",children:"Cashier"}),e.jsx("div",{className:"font-medium",children:b.cashier})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500 text-sm",children:"Status"}),e.jsx("div",{className:"font-medium",children:String(b.status||"").toUpperCase()})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Items Purchased"}),e.jsx("div",{className:"space-y-2",children:b.items.map((K,J)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:K.name}),e.jsxs("div",{className:"text-xs text-slate-600",children:[K.quantity,"  GH ",Number(K.price).toFixed(2)]})]}),e.jsx("div",{className:"font-semibold",children:`GH ${(K.quantity*K.price).toFixed(2)}`})]},J))})]}),e.jsxs("div",{className:"mt-4 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Subtotal"}),e.jsx("div",{children:`GH ${T(b.items).toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Tax"}),e.jsx("div",{children:`GH ${(T(b.items)*.125).toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-between font-bold pt-2 border-t",children:[e.jsx("div",{children:"Total"}),e.jsx("div",{children:`GH ${U(b.items).toFixed(2)}`})]})]}),e.jsxs("div",{className:"mt-6 flex gap-2",children:[e.jsx("button",{className:"btn btn-primary",onClick:k,children:"Print Receipt"}),e.jsx("button",{className:"btn btn-secondary",onClick:B,children:"Email Receipt"})]})]})})]})}function Ese({value:t,onChange:s,options:r,placeholder:a,disabled:n,filterPlaceholder:i}){const l=Array.isArray(r)?r:[];return e.jsx("div",{children:e.jsxs("select",{className:"input",value:t,onChange:o=>s(o.target.value),disabled:n,children:[e.jsx("option",{value:"",children:a||"Select..."}),l.map(o=>e.jsx("option",{value:String(o.value),children:o.label},String(o.value)))]})})}function Bse(){const{user:t}=Kr(),[s,r]=f.useState(new Date),[a,n]=f.useState(""),[i,l]=f.useState([]),[o,d]=f.useState(!1),[u,c]=f.useState(""),[h,m]=f.useState(""),[p,g]=f.useState(""),[x,b]=f.useState(""),[y,j]=f.useState(1),[N,_]=f.useState(""),[F,I]=f.useState([]),[w,E]=f.useState([]),[W,R]=f.useState(!1),[U,T]=f.useState(""),[Y,H]=f.useState([]),[M,q]=f.useState(!1),[z,Q]=f.useState(""),[L,V]=f.useState(!1),[P,C]=f.useState(null),[k,B]=f.useState([]),[G,O]=f.useState(!1),[K,J]=f.useState(""),[te,se]=f.useState(""),[ae,ne]=f.useState(12.5),[ue,oe]=f.useState("Exclusive"),[le,X]=f.useState(""),[me,we]=f.useState(!0),[Ie,_e]=f.useState(!1),[Fe,Le]=f.useState(!1),[rt,He]=f.useState(""),[st,De]=f.useState(!0),[Te,Ce]=f.useState(""),[Pe,fe]=f.useState(""),[he,Ue]=f.useState({name:"",address:"",city:"",state:"",country:"",phone:"",email:"",website:"",taxId:"",registrationNo:"",logoUrl:Ws});f.useMemo(()=>{const ge=String(a||"").toLowerCase();return ge?w.filter(Me=>Me.name.toLowerCase().includes(ge)||Me.code.toLowerCase().includes(ge)):w},[w,a]);const Ye=f.useMemo(()=>(Array.isArray(w)?w:[]).map(ge=>({value:String(ge.id),label:(ge.code?`${ge.code} - `:"")+String(ge.name||"")})),[w]),Ke=f.useMemo(()=>{const ge=String(x||"").trim().toLowerCase();return ge?Ye.filter(Me=>String(Me.label||"").trim().toLowerCase().includes(ge)).slice(0,10):[]},[x,Ye]);f.useEffect(()=>{const ge=setInterval(()=>r(new Date),1e3);return()=>clearInterval(ge)},[]),f.useEffect(()=>{let ge=!1;async function Me(){var Ve,vt,St,xt;De(!0);try{const Ct=Number((t==null?void 0:t.sub)||0)||Number((t==null?void 0:t.id)||0)||void 0,[Tt,bt]=await Promise.all([Z.get("/pos/terminals"),Z.get("/pos/terminal-users")]),Jt=Array.isArray((Ve=Tt.data)==null?void 0:Ve.items)?Tt.data.items:[],Gt=Array.isArray((vt=bt.data)==null?void 0:vt.items)?bt.data.items:[],Ht=new Set(Gt.filter(br=>Number(br==null?void 0:br.user_id)===Number(Ct)).map(br=>Number(br==null?void 0:br.terminal_id)).filter(br=>Number.isFinite(br)&&br>0)),es=Jt.filter(br=>Ht.has(Number(br==null?void 0:br.id))),js=(es.length?String(((St=es[0])==null?void 0:St.code)||""):"")||"";Ce(js);const Zs=js?{params:{terminal:js}}:void 0,Xs=await Z.get("/pos/day/status",Zs),Hs=((xt=Xs==null?void 0:Xs.data)==null?void 0:xt.item)||null,Bs=String((Hs==null?void 0:Hs.status)||"").toUpperCase();Le(!!Hs),He(Bs),_e(Bs==="OPEN")}catch{if(ge)return;Le(!1),He(""),_e(!1)}finally{if(ge)return;De(!1)}}return Me(),()=>{ge=!0}},[t==null?void 0:t.id,t==null?void 0:t.sub]),f.useEffect(()=>{let ge=!0;return O(!0),J(""),Z.get("/pos/payment-modes").then(Me=>{var St;if(!ge)return;const vt=(Array.isArray((St=Me.data)==null?void 0:St.items)?Me.data.items:[]).filter(xt=>xt&&xt.is_active!==0&&xt.is_active!==!1);if(B(vt),!te&&vt.length){let xt=vt.find(Ct=>String(Ct.type||"").trim().toLowerCase()==="cash")||vt[0];xt&&xt.id&&se(String(xt.id))}}).catch(Me=>{var Ve,vt;ge&&J(((vt=(Ve=Me==null?void 0:Me.response)==null?void 0:Ve.data)==null?void 0:vt.message)||"Failed to load payment modes")}).finally(()=>{ge&&O(!1)}),()=>{ge=!1}},[te]),f.useEffect(()=>{let ge=!0;return Z.get("/pos/tax-settings").then(Me=>{var bt;if(!ge)return;const Ve=((bt=Me.data)==null?void 0:bt.item)||null;if(!Ve){we(!1),ne(0),oe("Exclusive"),X("");return}const vt=Ve.is_active!==0&&Ve.is_active!==!1;if(we(vt),!vt){ne(0),oe("Exclusive"),X("");return}Ve.tax_type&&oe(String(Ve.tax_type));const St=Number(Ve.tax_rate_percent??12.5);ne(Number.isFinite(St)?St:12.5);const xt=String(Ve.tax_name||"").trim(),Ct=String(Ve.tax_code||"").trim(),Tt=String(Ve.tax_code_id||"").trim();X(xt||Ct||Tt||"")}).catch(()=>{ge&&(we(!1),ne(0),oe("Exclusive"),X(""))}),()=>{ge=!1}},[]),f.useEffect(()=>{let ge=!0;async function Me(){var Ve,vt,St;try{const Ct=(vt=(Ve=(await Z.get("/admin/me")).data)==null?void 0:Ve.scope)==null?void 0:vt.companyId;if(!Ct){if(!ge)return;Ue(Jt=>({...Jt,logoUrl:Jt.logoUrl||Ws}));return}const bt=((St=(await Z.get(`/admin/companies/${Ct}`)).data)==null?void 0:St.item)||{};if(!ge)return;Ue(Jt=>({...Jt,name:bt.name||Jt.name||"",address:bt.address||Jt.address||"",city:bt.city||Jt.city||"",state:bt.state||Jt.state||"",country:bt.country||Jt.country||"",phone:bt.telephone||Jt.phone||"",email:bt.email||Jt.email||"",website:bt.website||Jt.website||"",taxId:bt.tax_id||Jt.taxId||"",registrationNo:bt.registration_no||Jt.registrationNo||"",logoUrl:bt.has_logo===1||bt.has_logo===!0?`/api/admin/companies/${Ct}/logo`:Jt.logoUrl||Ws}))}catch{if(!ge)return;Ue(xt=>({...xt,logoUrl:xt.logoUrl||Ws}))}}return Me(),()=>{ge=!1}},[]),f.useEffect(()=>{let ge=!0;return q(!0),Q(""),Z.get("/sales/price-types").then(Me=>{var vt;if(!ge)return;const Ve=Array.isArray((vt=Me.data)==null?void 0:vt.items)?Me.data.items:[];if(H(Ve),!N&&Ve.length){let St=Ve.find(xt=>String(xt.name||"").trim().toLowerCase()==="retail")||Ve[0];St&&St.id&&_(String(St.id))}}).catch(Me=>{var Ve,vt;ge&&Q(((vt=(Ve=Me==null?void 0:Me.response)==null?void 0:Ve.data)==null?void 0:vt.message)||"Failed to load price types")}).finally(()=>{ge&&q(!1)}),()=>{ge=!1}},[N]),f.useEffect(()=>{let ge=!0;return R(!0),T(""),Z.get("/inventory/items").then(Me=>{var St;if(!ge)return;const vt=(Array.isArray((St=Me.data)==null?void 0:St.items)?Me.data.items:[]).filter(xt=>xt&&xt.is_active!==!1).map(xt=>({id:xt.id,name:xt.item_name||"",code:xt.item_code||"",price:Number(xt.selling_price??0),availQty:Number(xt.avail_qty??0),image_url:xt.image_url||"",barcode:xt.barcode||""}));E(vt)}).catch(Me=>{var Ve,vt;ge&&T(((vt=(Ve=Me==null?void 0:Me.response)==null?void 0:Ve.data)==null?void 0:vt.message)||"Failed to load items")}).finally(()=>{ge&&R(!1)}),()=>{ge=!1}},[]);const Je=f.useMemo(()=>i.reduce((ge,Me)=>{const Ve=Number(Me.quantity||0),vt=Number(Me.price||0);return ge+Ve*vt},0),[i]),xe=f.useMemo(()=>i.reduce((ge,Me)=>{const Ve=Number(Me.quantity||0),vt=Number(Me.price||0),St=Number(Me.discount||0),xt=Math.max(0,Ve*vt-St);return ge+xt},0),[i]),ye=f.useMemo(()=>{const ge=Je-xe;return!Number.isFinite(ge)||ge<0?0:ge},[Je,xe]),Ae=f.useMemo(()=>{const ge=Number(ae||0)/100;return!ge||xe<=0?0:xe*ge},[xe,ae]),be=f.useMemo(()=>xe+Ae,[xe,Ae]),Ee=f.useMemo(()=>{const ge=Number(Pe||0);return Number.isFinite(ge)?ge:0},[Pe]),dt=f.useMemo(()=>{const ge=Ee-be;return Number.isFinite(ge)?ge:0},[Ee,be]),mt=f.useRef(null),it=f.useRef(null),ht=f.useRef(null),ft=f.useMemo(()=>!k.length||!te?null:k.find(ge=>String(ge.id)===String(te))||null,[k,te]);function Rt(ge){const Me=String((ge==null?void 0:ge.type)||"").toLowerCase();return Me==="cash"?"CASH":Me==="card"||Me==="bank"?"CARD":Me==="mobile"?"MOBILE":"CASH"}async function Ge(ge,Me,Ve){var vt;try{const St={product_id:ge,quantity:1,price_type:Me||"",only_standard:!0},xt=await Z.post("/sales/prices/best-price",St),Ct=Number((vt=xt.data)==null?void 0:vt.price);return Number.isFinite(Ct)?Ct:Number(Ve||0)}catch{return Number(Ve||0)}}async function at(ge,Me){const vt=Math.max(1,Number(Me));if(!ge||!vt)return;const St=await Ge(ge.id,N,ge.price);if(l(xt=>xt.find(Tt=>Tt.id===ge.id)?xt.map(Tt=>{if(Tt.id!==ge.id)return Tt;const bt=Tt.quantity+vt;return{...Tt,quantity:bt,price:St,discount:Number(Tt.discount||0)}}):[...xt,{id:ge.id,name:ge.name,code:ge.code,price:St,quantity:vt,discount:0}]),I(xt=>xt.some(Ct=>Ct.id===ge.id)?xt:[...xt,ge]),g(String(ge.id)),m(""),j(1),ht.current)try{ht.current.focus()}catch{}if(mt.current)try{mt.current.scrollIntoView({behavior:"smooth",block:"start"})}catch{}}function je(ge){const Me=w.find(Ve=>String(Ve.id)===String(ge))||null;Me&&at(Me,1),b("")}function Se(ge,Me){l(Ve=>Ve.map(St=>St.id===ge?{...St,quantity:Math.max(0,Number(St.quantity||0)+Me)}:St).filter(St=>Number(St.quantity||0)>0))}function nt(ge,Me,Ve){l(vt=>vt.map(St=>{if(St.id!==ge)return St;if(Me==="quantity"){const xt=Number(Ve||0);return{...St,quantity:xt>0?xt:0}}if(Me==="discount"){const xt=Number(Ve||0);return{...St,discount:xt>=0?xt:0}}return St}).filter(St=>Number(St.quantity||0)>0))}function Ze(ge){l(Me=>Me.filter(Ve=>Ve.id!==ge)),I(Me=>Me.filter(Ve=>Ve.id!==ge)),Number(p||0)===ge&&(g(""),j(1))}function gt(ge){Ze(ge)}function jt(){i.length&&(l([]),I([]))}f.useEffect(()=>{it.current&&(clearTimeout(it.current),it.current=null);const ge=String(h||"").trim().toLowerCase();if(!ge)return;const Me=w.find(Ve=>{const vt=String(Ve.code||"").toLowerCase(),St=String(Ve.name||"").toLowerCase(),xt=String(Ve.barcode||"").toLowerCase();return vt===ge||St===ge||xt===ge});return Me&&(it.current=setTimeout(()=>{at(Me,1)},120)),()=>{it.current&&(clearTimeout(it.current),it.current=null)}},[h,w]),f.useEffect(()=>{const ge=Number(p||0);if(!ge)return;const Me=i.find(vt=>vt.id===ge);if(!Me){j(1);return}const Ve=Number(Me.quantity||0);j(Ve||0)},[i,p]),f.useEffect(()=>{I(ge=>(Array.isArray(ge)?ge:[]).filter(Me=>i.some(Ve=>Ve.id===Me.id)))},[i]),f.useEffect(()=>{if(ht.current)try{ht.current.focus()}catch{}},[Ie]);async function Mt(){var ge,Me,Ve,vt,St;if(!(!i.length||o)){if(!Fe){alert("Please open POS Day for today before making sales. Go to POS  Start/End Business Day to open the day.");return}try{d(!0);let xt=te?String(te):"";if(!xt){const Ht=Array.isArray(k)?k:[],es=Ht.find(js=>String(js.type||"").trim().toLowerCase()==="cash")||Ht[0];es!=null&&es.id&&(xt=String(es.id),se(String(es.id)))}if(!xt){alert("Please configure a POS payment mode before completing a sale.");return}const Ct=i.map(Ht=>({item_id:Ht.id,name:Ht.name,quantity:Number(Ht.quantity||0),price:Number(Ht.price||0),discount:Number(Ht.discount||0)})),bt={payment_method:Rt(ft),payment_mode_id:Number(xt),customer_name:null,lines:Ct,status:"COMPLETED",terminal:Te||"",tax_rate_percent:me?ae:0,tax_type:me?ue:"Exclusive"},Jt=await Z.post("/pos/sales",bt),Gt=String(((ge=Jt.data)==null?void 0:ge.receipt_no)||"");c(Gt),C(new Date),V(!0)}catch(xt){const Ct=((Ve=(Me=xt==null?void 0:xt.response)==null?void 0:Me.data)==null?void 0:Ve.message)||((St=(vt=xt==null?void 0:xt.response)==null?void 0:vt.data)==null?void 0:St.error)||"Failed to complete sale";alert(Ct)}finally{d(!1)}}}function Ne(){if(V(!1),l([]),I([]),c(""),m(""),g(""),j(1),C(null),ht.current)try{ht.current.focus()}catch{}}async function ke(){var ge;try{const Ve=((ge=(await Z.get("/pos/receipt-settings")).data)==null?void 0:ge.item)||null;return Ve?{companyName:Ve.company_name||"",showLogo:Ve.show_logo===1||Ve.show_logo===!0||Ve.show_logo==="1",headerText:Ve.header_text||"",footerText:Ve.footer_text||"",contactNumber:Ve.contact_number||"",addressLine1:Ve.address_line1||"",addressLine2:Ve.address_line2||"",logoUrl:Ve.logo_url||""}:{}}catch{return{}}}async function qe(){var fl;if(!i.length)return;const ge=await ke(),Ve=(P?new Date(P):new Date).toLocaleString(),vt=(t==null?void 0:t.username)||(t==null?void 0:t.name)||(t==null?void 0:t.fullName)||"Cashier",St=(ft==null?void 0:ft.name)||(function(){const Za=String((ft==null?void 0:ft.type)||"").toLowerCase();return Za==="cash"?"Cash":Za==="card"?"Card":Za==="mobile"?"Mobile Money":Za==="bank"?"Bank":"Other"})(),xt=String(ge.companyName||he.name||"Company Name"),Ct=[];he.address&&Ct.push(he.address);const Tt=[he.city,he.state].filter(Boolean).join(", ");Tt&&Ct.push(Tt),he.country&&Ct.push(he.country);const bt=String(Ct[0]||ge.addressLine1||"Street address"),Jt=String(Ct.slice(1).join("  ")||ge.addressLine2||"City, State, ZIP"),Gt=String(he.phone||ge.contactNumber||"+1234567890"),Ht=String(ge.headerText||"Thank you for your purchase"),es=String(ge.footerText||"Please visit again"),js=[];he.taxId&&js.push(`TIN: ${he.taxId}`),he.website&&js.push(he.website);const Zs=js.join("  ");let Hs=!!ge.showLogo?String(ge.logoUrl||"").trim():"";if(Hs&&!(Hs.startsWith("http://")||Hs.startsWith("https://")||Hs.startsWith("data:"))){const Sa=window.location.origin||"";Hs.startsWith("/")?Hs=Sa+Hs:Hs=Sa+"/"+Hs}const Bs=Hs?`<div class="center"><img src="${Hs}" alt="${xt}" style="max-height:100px;margin-bottom:8px;object-fit:contain;" /></div>`:"",Ln=i.map(Za=>{const Sa=Number(Za.quantity||0),Ci=Number(Za.price||0),Vi=Number(Za.discount||0),va=Math.max(0,Sa*Ci-Vi);return`
          <tr>
            <td>${Za.name||""}</td>
            <td class="right">${Sa}</td>
            <td class="right">GH ${Ci.toFixed(2)}</td>
            <td class="right">GH ${Vi.toFixed(2)}</td>
            <td class="right">GH ${va.toFixed(2)}</td>
          </tr>
        `}).join(""),br=`
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="utf-8" />
        <title>POS Receipt</title>
        <style>
          body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; padding: 16px; max-width: 480px; margin: 0 auto; }
          h1 { text-align: center; margin: 0 0 4px; font-size: 18px; }
          .center { text-align: center; }
          .muted { font-size: 12px; color: #555; }
          .row { display: flex; justify-content: space-between; font-size: 13px; margin: 2px 0; }
          table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; }
          th, td { padding: 4px; border-bottom: 1px solid #eee; }
          th { text-align: left; }
          th.right, td.right { text-align: right; }
          .totals { margin-top: 8px; border-top: 1px solid #000; padding-top: 4px; }
          .footer { margin-top: 10px; text-align: center; font-size: 11px; white-space: pre-wrap; }
          @media print { button { display: none; } }
        </style>
      </head>
      <body>
        ${Bs}
        <h1>${xt}</h1>
        <div class="center muted">${bt}</div>
        <div class="center muted">${Jt}</div>
        <div class="center muted">Mobile: ${Gt}</div>
        ${Zs?`<div class="center muted">${Zs}</div>`:""}
        <div class="center muted" style="margin-top:6px;">${Ht}</div>
        <hr />
        <div class="row"><span>Receipt No:</span><span>${u||"-"}</span></div>
        <div class="row"><span>Date:</span><span>${Ve}</span></div>
        <div class="row"><span>Cashier:</span><span>${vt}</span></div>
        <div class="row"><span>Payment:</span><span>${St}</span></div>
        <table>
          <thead>
            <tr>
              <th>Item</th>
              <th class="right">Qty</th>
              <th class="right">Price</th>
              <th class="right">Disc</th>
              <th class="right">Total</th>
            </tr>
          </thead>
          <tbody>
            ${Ln}
          </tbody>
        </table>
        <div class="totals">
          <div class="row"><span>Subtotal</span><span>GH ${xe.toFixed(2)}</span></div>${me?`<div class="row"><span>Tax</span><span>GH ${Ae.toFixed(2)}</span></div>`:""}
          <div class="row"><strong>Grand Total</strong><strong>GH ${be.toFixed(2)}</strong></div>
          <div class="row"><span>Amount Paid</span><span>GH ${Ee.toFixed(2)}</span></div>
          <div class="row"><span>${dt>=0?"Change":"Amount Due"}</span><span>GH ${Math.abs(dt).toFixed(2)}</span></div>
        </div>
        <div class="footer">${es}</div>
      </body>
      </html>
    `,mr=document.createElement("iframe");mr.style.position="fixed",mr.style.right="0",mr.style.bottom="0",mr.style.width="0",mr.style.height="0",mr.style.border="0",document.body.appendChild(mr);const Ja=((fl=mr.contentWindow)==null?void 0:fl.document)||mr.contentDocument||null;if(!Ja){document.body.removeChild(mr);return}Ja.open(),Ja.write(br),Ja.close();const Tr=mr.contentWindow||window;setTimeout(()=>{Tr.focus();try{Tr.print()}catch{}setTimeout(()=>{document.body.removeChild(mr)},100)},200)}return e.jsxs("div",{className:"space-y-6 pos-sales-entry",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/pos",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to POS"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"POS Sales Entry"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-slate-700",children:s.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("div",{className:"text-sm font-semibold text-brand-700",children:s.toLocaleTimeString()}),e.jsxs("div",{className:"mt-1 text-xs",children:[e.jsx("span",{className:"mr-2",children:"Terminal:"}),e.jsx("span",{className:"font-semibold",children:Te||"-"}),e.jsxs("span",{className:"ml-3",children:["Status:",e.jsx("span",{className:`ml-1 px-2 py-0.5 rounded ${Ie?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:Ie?"Open":Fe?"Closed":"Not Opened"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[!Fe&&!st?e.jsx("div",{className:"alert alert-warning",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"POS Day not opened"}),e.jsx("div",{className:"text-sm",children:"Open todays POS Day before making sales."})]}),e.jsx(Re,{to:"/pos/day-management",className:"btn btn-primary",children:"Open Day"})]})}):null,null,e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-2",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Barcode"}),e.jsx("input",{className:"input",placeholder:"Scan or type barcode",value:h,onChange:ge=>m(ge.target.value),ref:ht,autoFocus:!0,disabled:!1})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Item"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"input",placeholder:W?"Loading items...":"Type to search items",value:x,onChange:ge=>b(ge.target.value),onKeyDown:ge=>{ge.key==="Enter"&&Ke.length&&je(Ke[0].value)},disabled:W||!w.length}),x&&Ke.length?e.jsx("div",{className:"absolute z-50 mt-1 w-full bg-white border border-slate-200 rounded-lg shadow-lg max-h-48 overflow-auto",children:Ke.map(ge=>e.jsx("button",{type:"button",className:"block w-full text-left px-3 py-2 hover:bg-slate-50",onClick:()=>je(ge.value),children:ge.label},ge.value))}):null]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Quantity"}),e.jsx("input",{type:"number",className:"input",min:1,value:y,onChange:ge=>{const Me=ge.target.value;j(Me);const Ve=Number(p||0);Ve&&nt(Ve,"quantity",Me)},disabled:!1})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Price Type"}),e.jsx(Ese,{value:N,onChange:ge=>_(ge),options:Y.map(ge=>({value:String(ge.id),label:String(ge.name||"")})),placeholder:M?"Loading price types...":"Select Price Type",disabled:M||!Y.length,filterPlaceholder:"Filter price types..."})]})]})})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Item Information"}),F.length?e.jsx("div",{className:"overflow-x-auto rounded-lg border border-slate-200 bg-white",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50 text-slate-700",children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Item Code"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Item Name"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Price"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Avail_Qty"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"QTY"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Discount"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Total"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:F.map(ge=>{const Me=i.find(Ct=>Ct.id===ge.id)||null,Ve=Number((Me==null?void 0:Me.quantity)||0),vt=Number((Me==null?void 0:Me.price)||0),St=Number((Me==null?void 0:Me.discount)||0),xt=Math.max(0,Ve*vt-St);return e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2",children:ge.code}),e.jsx("td",{className:"px-3 py-2",children:ge.name}),e.jsx("td",{className:"px-3 py-2 text-right",children:`GH ${vt.toFixed(2)}`}),e.jsx("td",{className:"px-3 py-2 text-right",children:Number(ge.availQty||0)}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("input",{type:"number",className:"input text-right w-24",min:0,value:Ve,onChange:Ct=>nt(ge.id,"quantity",Ct.target.value)})}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("input",{type:"number",className:"input text-right w-24",min:0,step:"0.01",value:St,onChange:Ct=>nt(ge.id,"discount",Ct.target.value)})}),e.jsx("td",{className:"px-3 py-2 text-right",children:`GH ${xt.toFixed(2)}`}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("button",{type:"button",className:"btn-danger inline-flex items-center justify-center",onClick:()=>gt(ge.id),children:e.jsx(ol,{className:"w-4 h-4"})})})]},ge.id)})})]})}):e.jsx("div",{className:"rounded-lg border border-slate-200 bg-white p-6 text-center text-sm text-slate-600",children:"Select an item by barcode or from the item filter to view details"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"font-semibold",children:"Shopping Cart"})}),e.jsxs("div",{className:"card-body space-y-3",ref:mt,children:[e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:i.length?i.map(ge=>e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-white flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900",children:ge.name}),e.jsxs("div",{className:"text-xs text-slate-600",children:["GH ",Number(ge.price).toFixed(2)," each",Number(ge.discount||0)>0?e.jsxs("span",{className:"ml-2 text-amber-600",children:["Disc GH ",Number(ge.discount||0).toFixed(2)]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>Se(ge.id,-1),children:"-"}),e.jsx("span",{className:"text-sm font-semibold",children:ge.quantity}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>Se(ge.id,1),children:"+"}),e.jsx("button",{type:"button",className:"btn-danger inline-flex items-center justify-center",onClick:()=>Ze(ge.id),children:e.jsx(ol,{className:"w-4 h-4"})})]})]},ge.id)):e.jsx("div",{className:"text-center text-slate-600",children:"Cart is empty"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Discount"}),e.jsx("div",{children:`GH ${ye.toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Subtotal"}),e.jsx("div",{children:`GH ${xe.toFixed(2)}`})]}),me?e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Tax"}),e.jsx("div",{children:`GH ${Ae.toFixed(2)}`})]}):null,e.jsxs("div",{className:"flex justify-between font-bold pt-2 border-t",children:[e.jsx("div",{children:"Total"}),e.jsx("div",{children:`GH ${be.toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2",children:[e.jsx("label",{htmlFor:"amountPaid",className:"mr-2",children:"Amount Paid"}),e.jsx("input",{id:"amountPaid",type:"number",inputMode:"decimal",className:"input text-right w-36",step:"0.01",min:"0",value:Pe,onChange:ge=>fe(ge.target.value),placeholder:"0.00",disabled:!1})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:dt>=0?"Change":"Amount Due"}),e.jsx("div",{className:dt>=0?"text-emerald-600":"text-red-600",children:`GH ${Math.abs(dt).toFixed(2)}`})]})]})]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-3",children:[e.jsx("div",{className:"grid grid-cols-2 gap-2",children:G?e.jsx("div",{className:"col-span-2 text-center text-sm text-slate-500",children:"Loading payment modes..."}):k.length?k.map(ge=>e.jsx("button",{type:"button",className:`btn ${String(te)===String(ge.id)?"btn-primary":"btn-secondary"}`,onClick:()=>se(String(ge.id)),disabled:!1,children:ge.name},ge.id)):e.jsx("div",{className:"col-span-2 text-center text-sm text-slate-500",children:"No payment modes configured"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{type:"button",className:"btn-success w-full",onClick:jt,disabled:!1,children:"Clear Cart"}),e.jsx("button",{type:"button",className:"btn-success w-full",onClick:Mt,disabled:!i.length||o||G||!k.length||!te,children:"Complete Sale"})]})]})})]})]}),L&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("div",{className:"text-2xl font-bold text-brand-700",children:"Sale Completed"}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Receipt No"}),e.jsx("div",{className:"font-semibold",children:u||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Total"}),e.jsx("div",{className:"font-semibold",children:`GH ${be.toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Amount Paid"}),e.jsx("div",{className:"font-semibold",children:`GH ${Ee.toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:dt>=0?"Change":"Amount Due"}),e.jsx("div",{className:"font-semibold",children:`GH ${Math.abs(dt).toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:"Payment Method"}),e.jsx("div",{className:"font-semibold",children:(ft==null?void 0:ft.name)||(function(){const ge=String((ft==null?void 0:ft.type)||"").toLowerCase();return ge==="cash"?"Cash":ge==="card"?"Card":ge==="mobile"?"Mobile Money":ge==="bank"?"Bank":"Other"})()})]})]}),e.jsxs("div",{className:"mt-6 flex gap-2",children:[e.jsx("button",{type:"button",className:"btn-primary",onClick:Ne,children:"New Sale"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:qe,children:"Print Receipt"})]})]})})]})}function Fse({value:t,onChange:s,options:r,disabled:a,filterPlaceholder:n}){const i=Array.isArray(r)?r:[];return e.jsx("div",{className:"space-y-2",children:e.jsx("select",{className:"input",value:t,onChange:l=>s(l.target.value),disabled:a,children:i.map(l=>e.jsx("option",{value:String(l.value),children:l.label},String(l.value)))})})}function Tse(){const{canPerformAction:t}=Ls(),[s,r]=f.useState(!1),[a,n]=f.useState([]),[i,l]=f.useState("ALL"),[o,d]=f.useState(""),[u,c]=f.useState(""),[h,m]=f.useState(""),[p,g]=f.useState("ALL"),[x,b]=f.useState(null),[y,j]=f.useState({name:"",address:"",city:"",state:"",country:"",phone:"",email:"",website:"",taxId:"",registrationNo:"",logoUrl:Ws}),[N,_]=f.useState(!1),[F,I]=f.useState(""),[w,E]=f.useState({});f.useEffect(()=>{let L=!1;return r(!0),Z.get("/pos/sales").then(V=>{var P;L||n(Array.isArray((P=V.data)==null?void 0:P.items)?V.data.items:[])}).catch(()=>{L||n([])}).finally(()=>{L||r(!1)}),()=>{L=!0}},[]),f.useEffect(()=>{let L=!0;async function V(){var P;try{const k=((P=(await Z.get("/pos/receipt-settings")).data)==null?void 0:P.item)||null;if(!L)return;if(!k){E({});return}E({companyName:k.company_name||"",showLogo:k.show_logo===1||k.show_logo===!0||String(k.show_logo).toLowerCase()==="true",headerText:k.header_text||"",footerText:k.footer_text||"",contactNumber:k.contact_number||"",addressLine1:k.address_line1||"",addressLine2:k.address_line2||"",logoUrl:k.logo_url||""})}catch{if(!L)return;E({})}}return V(),()=>{L=!1}},[]),f.useEffect(()=>{let L=!0;async function V(){var P,C,k;try{const G=(C=(P=(await Z.get("/admin/me")).data)==null?void 0:P.scope)==null?void 0:C.companyId;if(!G){if(!L)return;j(J=>({...J,logoUrl:J.logoUrl||Ws}));return}const K=((k=(await Z.get(`/admin/companies/${G}`)).data)==null?void 0:k.item)||{};if(!L)return;j(J=>({...J,name:K.name||J.name||"",address:K.address||J.address||"",city:K.city||J.city||"",state:K.state||J.state||"",country:K.country||J.country||"",phone:K.telephone||J.phone||"",email:K.email||J.email||"",website:K.website||J.website||"",taxId:K.tax_id||J.taxId||"",registrationNo:K.registration_no||J.registrationNo||"",logoUrl:K.has_logo===1||K.has_logo===!0?`/api/admin/companies/${G}/logo`:J.logoUrl||Ws}))}catch{if(!L)return;j(B=>({...B,logoUrl:B.logoUrl||Ws}))}}return V(),()=>{L=!1}},[]);const W=f.useMemo(()=>{const L=new Map;for(const V of a){const P=String(V.collector_username||"").trim(),C=String(V.collector_full_name||"").trim(),k=P||C;k&&(L.has(k)||L.set(k,{key:k,label:P||C}))}return Array.from(L.values()).sort((V,P)=>String(V.label||"").localeCompare(String(P.label||"")))},[a]),R=f.useMemo(()=>[{value:"ALL",label:"All collectors"},...W.map(L=>({value:L.key,label:L.label}))],[W]),U=f.useMemo(()=>{const L=String(h||"").trim().toLowerCase(),V=p==="ALL"?"":String(p||"").trim();return a.filter(P=>{const C=L?String(P.sale_no||"").toLowerCase().includes(L):!0,k=i==="ALL"?!0:String(P.payment_status||"")===i,B=String(P.sale_date||"").slice(0,10),G=o?B>=o:!0,O=u?B<=u:!0,K=String(P.collector_username||P.collector_full_name||"").trim();return C&&k&&G&&O&&(V?K===V:!0)})},[a,h,i,o,u,p]),T=f.useMemo(()=>{const L=U.reduce((C,k)=>C+Number(k.total_amount||0),0),V=U.reduce((C,k)=>C+(String(k.payment_status||"")==="PAID"?Number(k.total_amount||0):0),0),P=L-V;return{count:U.length,totalAmount:L,cashCollected:V,outstanding:P}},[U]),Y=f.useMemo(()=>{const L={};for(const V of U){const P=String(V.payment_method||"").toUpperCase()||"UNKNOWN",C=Number(V.total_amount||0),k=String(V.payment_status||"")==="PAID";L[P]||(L[P]={method:P,invoices:0,totalAmount:0,collectedAmount:0}),L[P].invoices+=1,L[P].totalAmount+=C,k&&(L[P].collectedAmount+=C)}return Object.values(L)},[U]);function H(L,V){const P=w||{},C=String(y.name||P.companyName||"Company Name"),k=[];y.address&&k.push(y.address);const B=[y.city,y.state].filter(Boolean).join(", ");B&&k.push(B),y.country&&k.push(y.country);const G=String(k[0]||P.addressLine1||"Street address"),O=String(k.slice(1).join("  ")||P.addressLine2||"City, State, ZIP"),K=String(y.phone||P.contactNumber||"+1234567890"),J=String(P.headerText||"Thank you for your purchase"),te=String(P.footerText||"Please visit again"),se=[];y.taxId&&se.push(`TIN: ${y.taxId}`),y.website&&se.push(y.website);const ae=se.join("  ");let ne=String(P.logoUrl||y.logoUrl||"").trim();if(ne&&!(ne.startsWith("http://")||ne.startsWith("https://")||ne.startsWith("data:"))){const st=window.location.origin||"";ne.startsWith("/")?ne=st+ne:ne=st+"/"+ne}const ue=ne?`<div class="center"><img src="${ne}" alt="${C}" style="max-height:100px;margin-bottom:8px;object-fit:contain;" /></div>`:"",le=(L&&L.sale_date?new Date(L.sale_date):new Date).toLocaleString(),X=(function(){const He=String((L==null?void 0:L.payment_method)||"").toUpperCase();return He==="CASH"?"Cash":He==="CARD"?"Card":He==="MOBILE"?"Mobile Money":He==="BANK"?"Bank":"Other"})(),me=(Array.isArray(V)?V:[]).map(He=>{const st=Number(He.qty||0),De=Number(He.unit_price||0),Te=Number(He.line_total||st*De||0);return`
          <tr>
            <td>${He.item_name||""}</td>
            <td class="right">${st.toFixed(2)}</td>
            <td class="right">${De.toFixed(2)}</td>
            <td class="right">${Te.toFixed(2)}</td>
          </tr>
        `}).join(""),we=Number((L==null?void 0:L.gross_amount)||0),Ie=Number((L==null?void 0:L.discount_amount)||0),_e=Number((L==null?void 0:L.tax_amount)||0),Fe=we-Ie,Le=Number((L==null?void 0:L.net_amount)||(L==null?void 0:L.total_amount)||Fe+_e);return`
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="utf-8" />
        <title>POS Invoice</title>
        <style>
          body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; padding: 16px; max-width: 480px; margin: 0 auto; }
          h1 { text-align: center; margin: 0 0 4px; font-size: 18px; }
          .center { text-align: center; }
          .muted { font-size: 12px; color: #555; }
          .row { display: flex; justify-content: space-between; font-size: 13px; margin: 2px 0; }
          table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; }
          th, td { padding: 4px; border-bottom: 1px solid #eee; }
          th { text-align: left; }
          th.right, td.right { text-align: right; }
          .totals { margin-top: 8px; border-top: 1px solid #000; padding-top: 4px; }
          .footer { margin-top: 10px; text-align: center; font-size: 11px; }
          @media print { button { display: none; } }
        </style>
      </head>
      <body>
        ${ue}
        <h1>${C}</h1>
        <div class="center muted">${G}</div>
        <div class="center muted">${O}</div>
        <div class="center muted">Mobile: ${K}</div>
        ${ae?`<div class="center muted">${ae}</div>`:""}
        <div class="center muted" style="margin-top:6px;">${J}</div>
        <hr />
        <div class="row"><span>Receipt No:</span><span>${(L==null?void 0:L.sale_no)||"-"}</span></div>
        <div class="row"><span>Date:</span><span>${le}</span></div>
        <div class="row"><span>Payment:</span><span>${X}</span></div>
        <table>
          <thead>
            <tr>
              <th>Item</th>
              <th class="right">Qty</th>
              <th class="right">Price</th>
              <th class="right">Total</th>
            </tr>
          </thead>
          <tbody>
            ${me}
          </tbody>
        </table>
        <div class="totals">
          <div class="row"><span>Subtotal</span><span>${Fe.toFixed(2)}</span></div>
          <div class="row"><span>Discount</span><span>${Ie.toFixed(2)}</span></div>
          <div class="row"><span>Tax</span><span>${_e.toFixed(2)}</span></div>
          <div class="row"><strong>Total</strong><strong>${Le.toFixed(2)}</strong></div>
        </div>
        <div class="footer">${te}</div>
      </body>
      </html>
    `}async function M(L){var V,P;if(!(!L||!L.id)){b(L.id);try{const C=await Z.get(`/pos/sales/${L.id}`),k=((V=C.data)==null?void 0:V.item)||null,B=Array.isArray((P=C.data)==null?void 0:P.details)?C.data.details:[];if(!k){alert("Invoice not found");return}const G=H(k,B);I(G),_(!0)}catch{alert("Failed to load invoice")}finally{b(null)}}}async function q(L){var V,P,C;if(!(!L||!L.id)){b(L.id);try{const k=await Z.get(`/pos/sales/${L.id}`),B=((V=k.data)==null?void 0:V.item)||null,G=Array.isArray((P=k.data)==null?void 0:P.details)?k.data.details:[];if(!B){alert("Invoice not found");return}const O=H(B,G),K=document.createElement("iframe");K.style.position="fixed",K.style.right="0",K.style.bottom="0",K.style.width="0",K.style.height="0",K.style.border="0",document.body.appendChild(K);const J=((C=K.contentWindow)==null?void 0:C.document)||K.contentDocument||null;if(!J){document.body.removeChild(K);return}J.open(),J.write(O),J.close();const te=K.contentWindow||window;setTimeout(()=>{te.focus();try{te.print()}catch{}setTimeout(()=>{document.body.removeChild(K)},100)},200)}catch{alert("Failed to load invoice"),b(null)}}}async function z(L){var V,P;if(!(!L||!L.id)){b(L.id);try{const C=await Z.get(`/pos/sales/${L.id}`),k=((V=C.data)==null?void 0:V.item)||null,B=Array.isArray((P=C.data)==null?void 0:P.details)?C.data.details:[];if(!k){alert("Invoice not found");return}const G=loadReceiptSettings(),O=String(y.name||G.companyName||"Company Name"),K=[];y.address&&K.push(y.address);const J=[y.city,y.state].filter(Boolean).join(", ");J&&K.push(J),y.country&&K.push(y.country);const te=String(K[0]||G.addressLine1||"Street address"),se=String(K.slice(1).join("  ")||G.addressLine2||"City, State, ZIP"),ae=String(y.phone||G.contactNumber||"+1234567890"),ne=String(G.headerText||"Thank you for your purchase"),oe=(k&&k.sale_date?new Date(k.sale_date):new Date).toLocaleString(),le=(function(){const De=String((k==null?void 0:k.payment_method)||"").toUpperCase();return De==="CASH"?"Cash":De==="CARD"?"Card":De==="MOBILE"?"Mobile Money":De==="BANK"?"Bank":"Other"})(),X=Number((k==null?void 0:k.gross_amount)||0),me=Number((k==null?void 0:k.discount_amount)||0),we=Number((k==null?void 0:k.tax_amount)||0),Ie=X-me,_e=Number((k==null?void 0:k.net_amount)||(k==null?void 0:k.total_amount)||Ie+we),Fe=new hs("p","mm","a4");let Le=15;Fe.setFontSize(14),Fe.text(O,10,Le),Le+=6,Fe.setFontSize(10),Fe.text(te,10,Le),Le+=5,Fe.text(se,10,Le),Le+=5,Fe.text("Mobile: "+ae,10,Le),Le+=5;const rt=[];y.taxId&&rt.push(`TIN: ${y.taxId}`),y.website&&rt.push(y.website);const He=rt.join("  ");He&&(Fe.text(He,10,Le),Le+=5),Le+=1,Fe.text(ne,10,Le),Le+=8,Fe.setFontSize(11),Fe.text("Receipt No: "+(k.sale_no||"-"),10,Le),Le+=5,Fe.text("Date: "+oe,10,Le),Le+=5,Fe.text("Payment: "+le,10,Le),Le+=8,Fe.setFontSize(10),Fe.text("Item",10,Le),Fe.text("Qty",90,Le),Fe.text("Price",120,Le),Fe.text("Total",160,Le),Le+=4,Fe.line(10,Le,200,Le),Le+=5,(Array.isArray(B)?B:[]).forEach(De=>{const Te=Number(De.qty||0),Ce=Number(De.unit_price||0),Pe=Number(De.line_total||Te*Ce||0);Le>270&&(Fe.addPage(),Le=15);const fe=String(De.item_name||""),he=40;(fe.length>he?[fe.slice(0,he),fe.slice(he)]:[fe]).forEach(Ye=>{Fe.text(Ye,10,Le),Fe.text(Te.toFixed(2),90,Le,{align:"right"}),Fe.text(Ce.toFixed(2),120,Le,{align:"right"}),Fe.text(Pe.toFixed(2),160,Le,{align:"right"}),Le+=5})}),Le+=4,Fe.line(10,Le,200,Le),Le+=6,Fe.text("Subtotal:",120,Le,{align:"right"}),Fe.text(Ie.toFixed(2),160,Le,{align:"right"}),Le+=5,Fe.text("Discount:",120,Le,{align:"right"}),Fe.text(me.toFixed(2),160,Le,{align:"right"}),Le+=5,Fe.text("Tax:",120,Le,{align:"right"}),Fe.text(we.toFixed(2),160,Le,{align:"right"}),Le+=5,Fe.text("Total:",120,Le,{align:"right"}),Fe.text(_e.toFixed(2),160,Le,{align:"right"});const st=`POS_Invoice_${k.sale_no||L.id}.pdf`;Fe.save(st)}catch{alert("Failed to download invoice")}finally{b(null)}}}function Q(){_(!1),I("")}return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/pos",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to POS"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Cash Collection Details"}),e.jsx("p",{className:"text-sm mt-1",children:"List of all invoices from POS sales with collection summary"})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4",children:[e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-2",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"From Date"}),e.jsx("input",{type:"date",className:"input",value:o,onChange:L=>d(L.target.value)})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"To Date"}),e.jsx("input",{type:"date",className:"input",value:u,onChange:L=>c(L.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:i,onChange:L=>l(L.target.value),children:[e.jsx("option",{value:"ALL",children:"All"}),e.jsx("option",{value:"PAID",children:"Paid"}),e.jsx("option",{value:"PENDING",children:"Pending"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Collector"}),e.jsx(Fse,{value:p,onChange:g,options:R,disabled:!R.length,filterPlaceholder:"Filter collectors..."})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("label",{className:"label",children:"Invoice No"}),e.jsx("input",{className:"input",placeholder:"Search by invoice number",value:h,onChange:L=>m(L.target.value)})]})]})})}),e.jsxs("div",{className:"xl:col-span-2 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 bg-white",children:[e.jsx("div",{className:"text-xs uppercase text-slate-500",children:"Invoices"}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:T.count})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 bg-white",children:[e.jsx("div",{className:"text-xs uppercase text-slate-500",children:"Total Amount"}),e.jsx("div",{className:"text-2xl font-bold text-brand-700",children:`GH ${Number(T.totalAmount).toFixed(2)}`})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 bg-white",children:[e.jsx("div",{className:"text-xs uppercase text-slate-500",children:"Cash Collected"}),e.jsx("div",{className:"text-2xl font-bold text-green-700",children:`GH ${Number(T.cashCollected).toFixed(2)}`})]})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-erp w-full max-w-lg max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-900",children:"Invoice Preview"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-link",onClick:Q,children:""})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:F?e.jsx("iframe",{title:"Invoice Preview",srcDoc:F,className:"w-full h-[70vh] border-0"}):e.jsx("div",{className:"p-4 text-center text-sm text-slate-500",children:"Loading invoice..."})})]})})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Payment Mode Summary"}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-slate-200 mt-3",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-100 text-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"Payment Mode"}),e.jsx("th",{className:"text-right p-2 text-xs uppercase",children:"Invoices"}),e.jsx("th",{className:"text-right p-2 text-xs uppercase",children:"Total Amount"}),e.jsx("th",{className:"text-right p-2 text-xs uppercase",children:"Amount Collected"})]})}),e.jsx("tbody",{className:"bg-white",children:Y.length?Y.map(L=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:L.method}),e.jsx("td",{className:"p-2 text-right",children:Number(L.invoices||0).toLocaleString()}),e.jsx("td",{className:"p-2 text-right",children:`GH ${Number(L.totalAmount||0).toFixed(2)}`}),e.jsx("td",{className:"p-2 text-right",children:`GH ${Number(L.collectedAmount||0).toFixed(2)}`})]},L.method)):e.jsx("tr",{children:e.jsx("td",{className:"p-3 text-center text-slate-500",colSpan:4,children:"No data for selected filters"})})})]})})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-x-auto rounded-lg border border-slate-200",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-800 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"Invoice No"}),e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"Date"}),e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"Payment Mode"}),e.jsx("th",{className:"text-right p-2 text-xs uppercase",children:"Amount Collected"}),e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"Collector"}),e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"Status"}),e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white",children:s?e.jsx("tr",{children:e.jsx("td",{className:"p-3",colSpan:6,children:"Loading..."})}):U.length?U.map(L=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:L.sale_no}),e.jsx("td",{className:"p-2",children:String(L.sale_date||"").replace("T"," ").slice(0,16)}),e.jsx("td",{className:"p-2",children:String(L.payment_method||"").toUpperCase()||"-"}),e.jsx("td",{className:"p-2 text-right",children:`GH ${Number(L.total_amount||0).toFixed(2)}`}),e.jsx("td",{className:"p-2",children:L.collector_username||L.collector_full_name||"-"}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:String(L.payment_status||"")==="PAID"?"inline-block px-2 py-1 rounded bg-green-100 text-green-800":"inline-block px-2 py-1 rounded bg-yellow-100 text-yellow-800",children:String(L.payment_status||"")||"-"})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex gap-2",children:[t("pos:cash-collection","view")&&e.jsx("button",{type:"button",className:"text-brand hover:text-brand-600 font-medium text-sm",onClick:()=>M(L),disabled:x===L.id,children:"View"}),e.jsx("button",{type:"button",className:"btn-primary text-xs px-3 py-1.5",onClick:()=>q(L),disabled:x===L.id,children:"Print"}),e.jsx("button",{type:"button",className:"btn-outline text-xs px-3 py-1.5",onClick:()=>z(L),disabled:x===L.id,children:"Download"})]})})]},L.id)):e.jsx("tr",{children:e.jsx("td",{className:"p-3",colSpan:6,children:"No invoices found"})})}),e.jsx("tfoot",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("td",{className:"p-2 font-semibold",colSpan:4,children:"Totals"}),e.jsx("td",{className:"p-2 text-right font-bold",children:`GH ${Number(T.totalAmount).toFixed(2)}`}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex flex-col text-xs",children:[e.jsxs("span",{className:"text-green-700",children:["Collected:"," ",`GH ${Number(T.cashCollected).toFixed(2)}`]}),e.jsxs("span",{className:"text-red-700",children:["Outstanding:"," ",`GH ${Number(T.outstanding).toFixed(2)}`]})]})})]})})]})})})})]})}function Ise(){const{user:t}=Kr(),{canPerformAction:s}=Ls(),[r,a]=f.useState(new Date),[n,i]=f.useState(!1),[l,o]=f.useState([]),[d,u]=f.useState(""),[c,h]=f.useState(""),[m,p]=f.useState("ALL"),[g,x]=f.useState(""),[b,y]=f.useState(null),[j,N]=f.useState(""),[_,F]=f.useState([]),[I,w]=f.useState(!1),[E,W]=f.useState({name:"",address:"",city:"",state:"",country:"",phone:"",email:"",website:"",taxId:"",registrationNo:"",logoUrl:Ws}),[R,U]=f.useState(!1),[T,Y]=f.useState(""),[H,M]=f.useState({});f.useEffect(()=>{const G=setInterval(()=>a(new Date),1e3);return()=>clearInterval(G)},[]),f.useEffect(()=>{let G=!0;async function O(){var K;try{const te=((K=(await Z.get("/pos/receipt-settings")).data)==null?void 0:K.item)||null;if(!G)return;if(!te){M({});return}M({companyName:te.company_name||"",showLogo:te.show_logo===1||te.show_logo===!0||String(te.show_logo).toLowerCase()==="true",headerText:te.header_text||"",footerText:te.footer_text||"",contactNumber:te.contact_number||"",addressLine1:te.address_line1||"",addressLine2:te.address_line2||"",logoUrl:te.logo_url||""})}catch{if(!G)return;M({})}}return O(),()=>{G=!1}},[]),f.useEffect(()=>{let G=!1;async function O(){var K,J,te;w(!0);try{const[se,ae]=await Promise.all([Z.get("/pos/terminals"),Z.get("/pos/terminal-users")]);if(G)return;const ne=Array.isArray((K=se.data)==null?void 0:K.items)?se.data.items:[],ue=Array.isArray((J=ae.data)==null?void 0:J.items)?ae.data.items:[],oe=Number((t==null?void 0:t.sub)||0)||Number((t==null?void 0:t.id)||0)||void 0,le=new Set(ue.filter(we=>Number(we==null?void 0:we.user_id)===oe).map(we=>Number(we==null?void 0:we.terminal_id)).filter(we=>Number.isFinite(we)&&we>0)),X=ne.filter(we=>le.has(Number(we==null?void 0:we.id)));F(X);const me=(X.length?String(((te=X[0])==null?void 0:te.code)||""):"")||"";N(me)}catch{if(G)return;F([]),N("")}finally{if(G)return;w(!1)}}return O(),()=>{G=!0}},[t==null?void 0:t.id,t==null?void 0:t.sub]),f.useEffect(()=>{let G=!1;i(!0);const O=j?{params:{terminal:j}}:{};return Z.get("/pos/sales",O).then(K=>{var J;G||o(Array.isArray((J=K.data)==null?void 0:J.items)?K.data.items:[])}).catch(()=>{G||o([])}).finally(()=>{G||i(!1)}),()=>{G=!0}},[j]),f.useEffect(()=>{let G=!0;async function O(){var K,J,te;try{const ae=(J=(K=(await Z.get("/admin/me")).data)==null?void 0:K.scope)==null?void 0:J.companyId;if(!ae){if(!G)return;W(oe=>({...oe,logoUrl:oe.logoUrl||Ws}));return}const ue=((te=(await Z.get(`/admin/companies/${ae}`)).data)==null?void 0:te.item)||{};if(!G)return;W(oe=>({...oe,name:ue.name||oe.name||"",address:ue.address||oe.address||"",city:ue.city||oe.city||"",state:ue.state||oe.state||"",country:ue.country||oe.country||"",phone:ue.telephone||oe.phone||"",email:ue.email||oe.email||"",website:ue.website||oe.website||"",taxId:ue.tax_id||oe.taxId||"",registrationNo:ue.registration_no||oe.registrationNo||"",logoUrl:ue.has_logo===1||ue.has_logo===!0?`/api/admin/companies/${ae}/logo`:oe.logoUrl||Ws}))}catch{if(!G)return;W(se=>({...se,logoUrl:se.logoUrl||Ws}))}}return O(),()=>{G=!1}},[]);const q=f.useMemo(()=>{const G=String(g||"").trim().toLowerCase();return l.filter(O=>{const K=!G||String(O.sale_no||"").toLowerCase().includes(G)||String(O.customer_id||"").toLowerCase().includes(G),J=m==="ALL"?!0:String(O.payment_status||"")===m,te=String(O.sale_date||"").slice(0,10),se=d?te>=d:!0,ae=c?te<=c:!0;return K&&J&&se&&ae})},[l,g,m,d,c]),z=f.useMemo(()=>{const G=q.length,O=q.reduce((te,se)=>te+Number(se.total_amount||0),0),K=q.reduce((te,se)=>te+(String(se.payment_status||"")==="PAID"?Number(se.total_amount||0):0),0),J=O-K;return{count:G,totalAmount:O,paid:K,pending:J}},[q]);function Q(){const G=["Invoice No","Date","Customer","Amount","Status"],O=q.map(ae=>[String(ae.sale_no||""),String(ae.sale_date||"").replace("T"," ").slice(0,16),ae.customer_id?`#${ae.customer_id}`:"-",Number(ae.total_amount||0).toFixed(2),String(ae.payment_status||"")]),K=[G.join(","),...O.map(ae=>ae.join(","))].join(`
`),J=new Blob([K],{type:"text/csv;charset=utf-8;"}),te=URL.createObjectURL(J),se=document.createElement("a");se.href=te,se.download="pos_invoices.csv",se.click(),URL.revokeObjectURL(te)}function L(){window.print()}function V(G,O){const K=H||{},J=String(E.name||K.companyName||"Company Name"),te=[];E.address&&te.push(E.address);const se=[E.city,E.state].filter(Boolean).join(", ");se&&te.push(se),E.country&&te.push(E.country);const ae=String(te[0]||K.addressLine1||"Street address"),ne=String(te.slice(1).join("  ")||K.addressLine2||"City, State, ZIP"),ue=String(E.phone||K.contactNumber||"+1234567890"),oe=String(K.headerText||"Thank you for your purchase"),le=String(K.footerText||"Please visit again"),X=[];E.taxId&&X.push(`TIN: ${E.taxId}`),E.website&&X.push(E.website);const me=X.join("  ");let we=String(K.logoUrl||E.logoUrl||"").trim();if(we&&!(we.startsWith("http://")||we.startsWith("https://")||we.startsWith("data:"))){const he=window.location.origin||"";we.startsWith("/")?we=he+we:we=he+"/"+we}const Ie=we?`<div class="center"><img src="${we}" alt="${J}" style="max-height:100px;margin-bottom:8px;object-fit:contain;" /></div>`:"",Fe=(G&&G.sale_date?new Date(G.sale_date):new Date).toLocaleString(),Le=(function(){const fe=String((G==null?void 0:G.payment_method)||"").toUpperCase();return fe==="CASH"?"Cash":fe==="CARD"?"Card":fe==="MOBILE"?"Mobile Money":fe==="BANK"?"Bank":"Other"})(),rt=(Array.isArray(O)?O:[]).map(fe=>{const he=Number(fe.qty||0),Ue=Number(fe.unit_price||0),Ye=Number(fe.line_total||he*Ue||0);return`
          <tr>
            <td>${fe.item_name||""}</td>
            <td class="right">${he.toFixed(2)}</td>
            <td class="right">GH ${Ue.toFixed(2)}</td>
            <td class="right">GH ${Ye.toFixed(2)}</td>
          </tr>
        `}).join(""),He=Number((G==null?void 0:G.gross_amount)||0),st=Number((G==null?void 0:G.discount_amount)||0),De=Number((G==null?void 0:G.tax_amount)||0),Te=He-st,Ce=Number((G==null?void 0:G.net_amount)||(G==null?void 0:G.total_amount)||Te+De);return`
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="utf-8" />
        <title>POS Invoice</title>
        <style>
          body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; padding: 16px; max-width: 480px; margin: 0 auto; }
          h1 { text-align: center; margin: 0 0 4px; font-size: 18px; }
          .center { text-align: center; }
          .muted { font-size: 12px; color: #555; }
          .row { display: flex; justify-content: space-between; font-size: 13px; margin: 2px 0; }
          table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; }
          th, td { padding: 4px; border-bottom: 1px solid #eee; }
          th { text-align: left; }
          th.right, td.right { text-align: right; }
          .totals { margin-top: 8px; border-top: 1px solid #000; padding-top: 4px; }
          .footer { margin-top: 10px; text-align: center; font-size: 11px; white-space: pre-wrap; }
          @media print { button { display: none; } }
        </style>
      </head>
      <body>
        ${Ie}
        <h1>${J}</h1>
        <div class="center muted">${ae}</div>
        <div class="center muted">${ne}</div>
        <div class="center muted">Mobile: ${ue}</div>
        ${me?`<div class="center muted">${me}</div>`:""}
        <div class="center muted" style="margin-top:6px;">${oe}</div>
        <hr />
        <div class="row"><span>Receipt No:</span><span>${(G==null?void 0:G.sale_no)||"-"}</span></div>
        <div class="row"><span>Date:</span><span>${Fe}</span></div>
        <div class="row"><span>Payment:</span><span>${Le}</span></div>
        <table>
          <thead>
            <tr>
              <th>Item</th>
              <th class="right">Qty</th>
              <th class="right">Price</th>
              <th class="right">Total</th>
            </tr>
          </thead>
          <tbody>
            ${rt.replace(/<td class="right">(\d+(?:\.\d{1,2})?)<\/td>\s*<td class="right">(\d+(?:\.\d{1,2})?)<\/td>$/gm,'<td class="right">$1</td><td class="right">GH $2')}
          </tbody>
        </table>
        <div class="totals">
          <div class="row"><span>Subtotal</span><span>GH ${Te.toFixed(2)}</span></div>
          <div class="row"><span>Discount</span><span>GH ${st.toFixed(2)}</span></div>
          <div class="row"><span>Tax</span><span>GH ${De.toFixed(2)}</span></div>
          <div class="row"><strong>Total</strong><strong>GH ${Ce.toFixed(2)}</strong></div>
        </div>
        <div class="footer">${le}</div>
      </body>
      </html>
    `}async function P(G){var O,K;if(!(!G||!G.id)){y(G.id);try{const J=await Z.get(`/pos/sales/${G.id}`),te=((O=J.data)==null?void 0:O.item)||null,se=Array.isArray((K=J.data)==null?void 0:K.details)?J.data.details:[];if(!te){alert("Invoice not found");return}const ae=V(te,se);Y(ae),U(!0)}catch{alert("Failed to load invoice")}finally{y(null)}}}async function C(G){var O,K,J;if(!(!G||!G.id)){y(G.id);try{const te=await Z.get(`/pos/sales/${G.id}`),se=((O=te.data)==null?void 0:O.item)||null,ae=Array.isArray((K=te.data)==null?void 0:K.details)?te.data.details:[];if(!se){alert("Invoice not found");return}const ne=V(se,ae),ue=document.createElement("iframe");ue.style.position="fixed",ue.style.right="0",ue.style.bottom="0",ue.style.width="0",ue.style.height="0",ue.style.border="0",document.body.appendChild(ue);const oe=((J=ue.contentWindow)==null?void 0:J.document)||ue.contentDocument||null;if(!oe){document.body.removeChild(ue);return}oe.open(),oe.write(ne),oe.close();const le=ue.contentWindow||window;setTimeout(()=>{le.focus();try{le.print()}catch{}setTimeout(()=>{document.body.removeChild(ue)},100)},200)}catch{alert("Failed to load invoice"),y(null)}}}async function k(G){var O,K,J;if(!(!G||!G.id)){y(G.id);try{const te=await Z.get(`/pos/sales/${G.id}`),se=((O=te.data)==null?void 0:O.item)||null,ae=Array.isArray((K=te.data)==null?void 0:K.details)?te.data.details:[];if(!se){alert("Invoice not found");return}const ne=H||{},ue=String(E.name||ne.companyName||"Company Name"),oe=[];E.address&&oe.push(E.address);const le=[E.city,E.state].filter(Boolean).join(", ");le&&oe.push(le),E.country&&oe.push(E.country);const X=String(oe[0]||ne.addressLine1||"Street address"),me=String(oe.slice(1).join("  ")||ne.addressLine2||"City, State, ZIP"),we=String(E.phone||ne.contactNumber||"+1234567890"),Ie=String(ne.headerText||"Thank you for your purchase"),_e=String(ne.footerText||"Please visit again"),Le=(se&&se.sale_date?new Date(se.sale_date):new Date).toLocaleString(),rt=(function(){const xe=String((se==null?void 0:se.payment_method)||"").toUpperCase();return xe==="CASH"?"Cash":xe==="CARD"?"Card":xe==="MOBILE"?"Mobile Money":xe==="BANK"?"Bank":"Other"})(),He=Number((se==null?void 0:se.gross_amount)||0),st=Number((se==null?void 0:se.discount_amount)||0),De=Number((se==null?void 0:se.tax_amount)||0),Te=He-st,Ce=Number((se==null?void 0:se.net_amount)||(se==null?void 0:se.total_amount)||Te+De),Pe=new hs("p","mm","a4");let fe=15;Pe.setFontSize(14),Pe.text(ue,10,fe),fe+=6,Pe.setFontSize(10),Pe.text(X,10,fe),fe+=5,Pe.text(me,10,fe),fe+=5,Pe.text("Mobile: "+we,10,fe),fe+=5;const he=[];E.taxId&&he.push(`TIN: ${E.taxId}`),E.website&&he.push(E.website);const Ue=he.join("  ");Ue&&(Pe.text(Ue,10,fe),fe+=5),fe+=1,Pe.text(Ie,10,fe),fe+=8,Pe.setFontSize(11),Pe.text("Receipt No: "+(se.sale_no||"-"),10,fe),fe+=5,Pe.text("Date: "+Le,10,fe),fe+=5,Pe.text("Payment: "+rt,10,fe),fe+=8,Pe.setFontSize(10),Pe.text("Item",10,fe),Pe.text("Qty",90,fe),Pe.text("Price",120,fe),Pe.text("Total",160,fe),fe+=4,Pe.line(10,fe,200,fe),fe+=5,(Array.isArray(ae)?ae:[]).forEach(xe=>{const ye=Number(xe.qty||0),Ae=Number(xe.unit_price||0),be=Number(xe.line_total||ye*Ae||0);fe>270&&(Pe.addPage(),fe=15);const Ee=String(xe.item_name||""),dt=40;(Ee.length>dt?[Ee.slice(0,dt),Ee.slice(dt)]:[Ee]).forEach(it=>{Pe.text(it,10,fe),Pe.text(ye.toFixed(2),90,fe,{align:"right"}),Pe.text(Ae.toFixed(2),120,fe,{align:"right"}),Pe.text(be.toFixed(2),160,fe,{align:"right"}),fe+=5})}),fe+=4,Pe.line(10,fe,200,fe),fe+=6,Pe.text("Subtotal:",120,fe,{align:"right"}),Pe.text(Te.toFixed(2),160,fe,{align:"right"}),fe+=5,Pe.text("Discount:",120,fe,{align:"right"}),Pe.text(st.toFixed(2),160,fe,{align:"right"}),fe+=5,Pe.text("Tax:",120,fe,{align:"right"}),Pe.text(De.toFixed(2),160,fe,{align:"right"}),fe+=5,Pe.text("Total:",120,fe,{align:"right"}),Pe.text(Ce.toFixed(2),160,fe,{align:"right"}),fe+=8;const Ye=_e.replace(/\r\n/g,`
`).split(`
`),Ke=((J=Pe.getFont())==null?void 0:J.fontName)||"helvetica";try{Pe.setFont("courier","normal")}catch{}Pe.setFontSize(10),Ye.forEach(xe=>{fe>270&&(Pe.addPage(),fe=15),Pe.text(xe,10,fe),fe+=5});try{Pe.setFont(Ke,"normal")}catch{}const Je=`POS_Invoice_${se.sale_no||G.id}.pdf`;Pe.save(Je)}catch{alert("Failed to download invoice")}finally{y(null)}}}function B(){U(!1),Y("")}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/pos",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to POS"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"POS Invoices"}),e.jsx("p",{className:"text-sm mt-1",children:"List of all invoices created from POS sales entry"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-slate-700",children:r.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("div",{className:"text-sm font-semibold text-brand-700",children:r.toLocaleTimeString()})]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3 flex-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Terminal"}),e.jsxs("select",{className:"input",value:j,onChange:G=>N(G.target.value),disabled:I,children:[e.jsx("option",{value:"",children:I?"Loading terminals...":"All Terminals (assigned)"}),(Array.isArray(_)?_:[]).map(G=>e.jsx("option",{value:String(G.code||""),children:String(G.code||G.name||"")},String(G.code)))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"From"}),e.jsx("input",{type:"date",className:"input",value:d,onChange:G=>u(G.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"To"}),e.jsx("input",{type:"date",className:"input",value:c,onChange:G=>h(G.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:m,onChange:G=>p(G.target.value),children:[e.jsx("option",{value:"ALL",children:"All"}),e.jsx("option",{value:"PAID",children:"Paid"}),e.jsx("option",{value:"PENDING",children:"Pending"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Search"}),e.jsx("input",{className:"input",placeholder:"Search invoice no or customer",value:g,onChange:G=>x(G.target.value)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-success",onClick:Q,children:"Export CSV"}),e.jsx("button",{className:"btn-primary",onClick:L,children:"Print"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 bg-white",children:[e.jsx("div",{className:"text-xs uppercase text-slate-500",children:"Invoices"}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:z.count})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 bg-white",children:[e.jsx("div",{className:"text-xs uppercase text-slate-500",children:"Total Amount"}),e.jsx("div",{className:"text-2xl font-bold text-brand-700",children:`GH ${Number(z.totalAmount).toFixed(2)}`})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 bg-white",children:[e.jsx("div",{className:"text-xs uppercase text-slate-500",children:"Paid"}),e.jsx("div",{className:"text-2xl font-bold text-green-700",children:`GH ${Number(z.paid).toFixed(2)}`})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Invoice No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{className:"text-right",children:"Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:n?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",children:"Loading..."})}):q.length?q.map(G=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"font-medium",children:G.sale_no}),e.jsx("td",{children:String(G.sale_date||"").replace("T"," ").slice(0,16)}),e.jsx("td",{children:G.customer_id?`#${G.customer_id}`:"-"}),e.jsx("td",{className:"text-right",children:`GH ${Number(G.total_amount||0).toFixed(2)}`}),e.jsx("td",{children:e.jsx("span",{className:String(G.payment_status||"")==="PAID"?"px-2 py-1 rounded bg-green-100 text-green-700 text-xs":"px-2 py-1 rounded bg-yellow-100 text-yellow-700 text-xs",children:String(G.payment_status||"")})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[s("pos:invoices","view")&&e.jsx("button",{type:"button",className:"text-brand hover:text-brand-600 font-medium text-sm",onClick:()=>P(G),disabled:b===G.id,children:"View"}),e.jsx("button",{type:"button",className:"inline-flex items-center px-3 py-1.5 rounded bg-green-600 hover:bg-green-700 text-white text-xs font-semibold",onClick:()=>C(G),disabled:b===G.id,children:"Print"}),e.jsx("button",{type:"button",className:"inline-flex items-center px-3 py-1.5 rounded bg-purple-600 hover:bg-purple-700 text-white text-xs font-semibold",onClick:()=>k(G),disabled:b===G.id,children:"Download"})]})})]},G.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",children:e.jsx("div",{className:"text-center text-slate-600 py-6",children:"No invoices found"})})})})]})})}),R&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-erp w-full max-w-lg max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-900",children:"Invoice Preview"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-link",onClick:B,children:""})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:T?e.jsx("iframe",{title:"Invoice Preview",srcDoc:T,className:"w-full h-[70vh] border-0"}):e.jsx("div",{className:"p-4 text-center text-sm text-slate-500",children:"Loading invoice..."})})]})})]})}const Qx=[200,100,50,20,10,5,2,1,.5,.2];function MC({value:t,onChange:s,options:r,placeholder:a,disabled:n,filterPlaceholder:i}){const l=Array.isArray(r)?r:[];return e.jsx("div",{children:e.jsxs("select",{className:"input",value:t,onChange:o=>s(o.target.value),disabled:n,children:[e.jsx("option",{value:"",children:a||"Select..."}),l.map(o=>e.jsx("option",{value:String(o.value),children:o.label},String(o.value)))]})})}function Lse(){const[t,s]=f.useState(!1),[r,a]=f.useState([]),[n,i]=f.useState(""),[l,o]=f.useState(new Date().toISOString().slice(0,10)),[d,u]=f.useState(""),[c,h]=f.useState(""),[m,p]=f.useState(""),[g,x]=f.useState(50),[b,y]=f.useState(!1),[j,N]=f.useState([]),[_,F]=f.useState(Qx.map(()=>0));f.useEffect(()=>{let k=!1;return s(!0),Z.get("/pos/terminals").then(B=>{var O;if(k)return;const G=Array.isArray((O=B.data)==null?void 0:O.items)?B.data.items:[];if(a(G),!d&&G.length){const K=G[0];u(String(K.id)),h(String(K.warehouse||""))}}).catch(()=>{k||a([])}).finally(()=>{k||s(!1)}),()=>{k=!0}},[]),f.useEffect(()=>{const k=r.find(B=>String(B.id)===String(d));k&&k.warehouse&&String(c||"").trim()===""&&h(String(k.warehouse))},[d,r]);const I=f.useMemo(()=>{const k=new Set;for(const B of r){const G=String((B==null?void 0:B.warehouse)||"").trim();G&&k.add(G)}return Array.from(k.values())},[r]),w=f.useMemo(()=>(Array.isArray(r)?r:[]).map(k=>({value:String(k.id),label:String(k.code||k.name||"")})),[r]),E=f.useMemo(()=>{const k=(Array.isArray(I)?I:[]).map(B=>({value:String(B),label:String(B)}));return!k.length&&String(c||"").trim()?[{value:String(c),label:String(c)}]:k},[I,c]),W=f.useMemo(()=>{const k=String(m||"").trim().toLowerCase();return k?j.filter(B=>String(B.account||"").toLowerCase().includes(k)):j},[j,m]),R=f.useMemo(()=>{const k=Math.max(1,Number(g||0)||1);return W.slice(0,k)},[W,g]),U=f.useMemo(()=>j.reduce((k,B)=>(k.credit+=Number(B.credit||0),k.debit+=Number(B.debit||0),k),{credit:0,debit:0}),[j]),T=f.useMemo(()=>Qx.map((k,B)=>H(k*Number(_[B]||0))),[_]),Y=f.useMemo(()=>H(T.reduce((k,B)=>k+Number(B||0),0)),[T]);function H(k){return Math.round(Number(k||0)*100)/100}function M(k,B){const G=k.get(String(B));if(!G)return String(B||"");const O=String(G.code||"").trim(),K=String(G.name||"").trim();return O&&K?`${O} - ${K}`:K||O||String(B||"")}function q(k,B,G){const O=String(G||"").trim();if(!O)return"";const K=Number(O);if(Number.isFinite(K)&&K>0)return M(B,K);const J=k.find(te=>String(te.code||"")===O);return J?M(B,J.id):O}function z(k){const B=Array.isArray(k)?k.slice():[];B.sort((O,K)=>{const J=String((O==null?void 0:O.code)||""),te=String((K==null?void 0:K.code)||""),se=String((O==null?void 0:O.name)||"").toLowerCase(),ae=String((K==null?void 0:K.name)||"").toLowerCase(),ne=J==="4000"||J==="400000"?0:se.includes("sales")?1:J.toLowerCase().startsWith("4")?2:3,ue=te==="4000"||te==="400000"?0:ae.includes("sales")?1:te.toLowerCase().startsWith("4")?2:3;return ne!==ue?ne-ue:J.localeCompare(te)});const G=B[0];return G!=null&&G.id?Number(G.id):0}function Q(k){return String(k||"").slice(0,10)}async function L(){var k,B,G,O;s(!0);try{const[K,J,te,se]=await Promise.all([Z.get("/pos/sales"),Z.get("/finance/accounts",{params:{postable:1,active:1}}),Z.get("/pos/tax-settings"),Z.get("/pos/payment-modes")]),ae=Array.isArray((k=K.data)==null?void 0:k.items)?K.data.items:[],ne=Array.isArray((B=J.data)==null?void 0:B.items)?J.data.items:[],ue=new Map(ne.map(fe=>[String(fe.id),fe])),oe=((G=te.data)==null?void 0:G.item)||null,le=Array.isArray((O=se.data)==null?void 0:O.items)?se.data.items:[],X=Q(l),me=ae.filter(fe=>{const he=Q(fe.sale_date);return String(fe.payment_status||"").toUpperCase()==="PAID"&&he===X});if(!me.length){N([]),window.alert("No completed POS sales found for the selected date.");return}const we=String((oe==null?void 0:oe.tax_type)||"Exclusive").toLowerCase(),Ie=oe&&Number(oe.is_active)===0?0:1,_e=Ie&&Number((oe==null?void 0:oe.tax_account_id)||0)>0?Number(oe.tax_account_id):0,Fe=ne.filter(fe=>String(fe.nature||"").toUpperCase()==="INCOME"),Le=z(Fe);if(!Le)throw new Error("Sales account not configured for posting");let rt=0,He=0;const st=new Map;for(const fe of me){const he=Number(fe.gross_amount||0),Ue=Number(fe.discount_amount||0),Ye=H(he-Ue),Ke=H(Number(fe.tax_amount||0)),Je=H(Number(fe.total_amount||0));let xe=Ye;Ie&&we==="inclusive"&&Ke>0&&Ye>0&&(xe=H(Ye-Ke)),rt=H(rt+Math.max(0,xe)),He=H(He+Math.max(0,Ke));const ye=String(fe.payment_method||"CASH").toUpperCase();st.set(ye,H((st.get(ye)||0)+Je))}if(He>0&&!_e)throw new Error("Tax account not configured in POS Tax Settings");const De=[];rt>0&&De.push({account:M(ue,Le),credit:rt,debit:0}),He>0&&_e&&De.push({account:M(ue,_e),credit:He,debit:0});const Te=new Map;for(const fe of le){if(Number(fe.is_active)===0)continue;const he=String(fe.type||"").toLowerCase();Te.has(he)||Te.set(he,fe)}const Ce=["CASH","CARD","MOBILE"],Pe=Array.from(st.keys()).sort((fe,he)=>{const Ue=Ce.indexOf(fe),Ye=Ce.indexOf(he);return Ue===-1&&Ye===-1?fe.localeCompare(he):Ue===-1?1:Ye===-1?-1:Ue-Ye});for(const fe of Pe){const he=H(st.get(fe)||0);if(he<=0)continue;const Ue=fe==="CARD"?"card":fe==="MOBILE"?"mobile":"cash",Ye=Te.get(Ue),Ke=q(ne,ue,Ye==null?void 0:Ye.account);if(!Ke)throw new Error(`No linked Finance account found for payment type: ${Ue}`);De.push({account:Ke,credit:0,debit:he})}N(De)}catch(K){N([]),window.alert(String((K==null?void 0:K.message)||"Failed to populate transactions"))}finally{s(!1)}}function V(){i(""),N([]),p(""),F(Qx.map(()=>0))}function P(){const k=r.find(se=>String(se.id)===String(d)),B=k?String(k.code||k.name||"").trim():"",G=String(n||"").trim()||"Auto-generated",O=l,K=String(c||"").trim()||"-",J=Y.toFixed(2);window.confirm(`Post transaction to finance?

Voucher: ${G}
Date: ${O}
Till: ${B||"-"}
Warehouse: ${K}
Cash Total: GHS ${J}`)&&(window.alert("Transaction posted to finance successfully!"),V())}const C=f.useMemo(()=>{const k=R.length?1:0,B=R.length;return`${k} - ${B}`},[R.length]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/pos",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to POS"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"POS Finance Posting"})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher no."}),e.jsx("input",{className:"input",value:n,onChange:k=>i(k.target.value),placeholder:"Auto-generated"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Voucher Date"}),e.jsx("input",{className:"input",type:"date",value:l,onChange:k=>o(k.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Till"}),e.jsx(MC,{value:d,onChange:k=>{const B=String(k||"");u(B);const G=r.find(O=>String(O.id)===String(B));G&&h(String(G.warehouse||""))},options:w,placeholder:r.length?"Select till":"Loading...",filterPlaceholder:"Filter tills...",disabled:t||!r.length})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Warehouse"}),e.jsx(MC,{value:c,onChange:k=>h(String(k||"")),options:E,placeholder:E.length?"Select":"-",filterPlaceholder:"Filter warehouses...",disabled:t||!E.length})]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",className:"btn-primary",onClick:L,disabled:t,children:"POPULATE DATA"})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_350px] gap-5",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{className:"input",placeholder:"Search...",value:m,onChange:k=>p(k.target.value)})}),e.jsx("button",{type:"button",className:"btn-primary",onClick:L,disabled:t,children:"Go"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Rows"}),e.jsxs("select",{className:"input",value:String(g),onChange:k=>x(Number(k.target.value)),children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"25",children:"25"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>y(k=>!k),children:"Actions "}),b&&e.jsx("div",{className:"absolute right-0 mt-2 w-40 rounded border border-slate-200 bg-white shadow-lg z-10",children:e.jsx("button",{type:"button",className:"w-full text-left px-3 py-2 text-sm hover:bg-slate-50",onClick:()=>{y(!1),V()},children:"Clear"})})]})]}),e.jsx("div",{className:"overflow-x-auto rounded border border-slate-200",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-800 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"Sr No"}),e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"Account Name"}),e.jsx("th",{className:"text-right p-2 text-xs uppercase",children:"Credit"}),e.jsx("th",{className:"text-right p-2 text-xs uppercase",children:"Debit"})]})}),e.jsx("tbody",{className:"bg-white",children:j.length?e.jsxs(e.Fragment,{children:[R.map((k,B)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2 text-center",children:B+1}),e.jsx("td",{className:"p-2",children:k.account}),e.jsx("td",{className:"p-2 text-right",children:Number(k.credit||0)>0?Number(k.credit||0).toFixed(2):""}),e.jsx("td",{className:"p-2 text-right",children:Number(k.debit||0)>0?Number(k.debit||0).toFixed(2):""})]},B)),e.jsxs("tr",{className:"border-t bg-slate-50 font-semibold",children:[e.jsx("td",{className:"p-2"}),e.jsx("td",{className:"p-2"}),e.jsx("td",{className:"p-2 text-right",children:U.credit.toFixed(2)}),e.jsx("td",{className:"p-2 text-right",children:U.debit.toFixed(2)})]})]}):e.jsx("tr",{children:e.jsx("td",{className:"p-10 text-center text-slate-500",colSpan:4,children:'Click "POPULATE DATA" to load transactions'})})})]})}),e.jsx("div",{className:"flex justify-end text-xs text-slate-600",children:C})]}),e.jsxs("div",{className:"rounded-lg bg-brand text-white p-4 h-fit",children:[e.jsx("div",{className:"text-center text-base font-semibold",children:"Denomination Cash Count"}),e.jsx("div",{className:"mt-4 space-y-2",children:Qx.map((k,B)=>e.jsxs("div",{className:"grid grid-cols-[1fr_90px_110px] gap-2 items-center",children:[e.jsx("div",{className:"text-sm",children:`GHS ${Number(k).toFixed(2)}`}),e.jsx("input",{type:"number",min:"0",className:"rounded px-2 py-1 text-slate-900",value:String(_[B]??0),onChange:G=>{const O=_.slice();O[B]=Number(G.target.value||0),F(O)}}),e.jsx("div",{className:"rounded px-2 py-1 bg-white/20 text-right text-sm",children:T[B].toFixed(2)})]},String(k)))}),e.jsxs("div",{className:"mt-4 rounded bg-white/20 px-3 py-3 flex items-center justify-between font-semibold",children:[e.jsx("div",{children:"TOTAL:"}),e.jsx("div",{children:Y.toFixed(2)})]}),e.jsx("button",{type:"button",className:"btn-primary w-full mt-4",onClick:P,disabled:t||!j.length,children:"POST TO FINANCE"})]})]})]})})]})}function Dse(){const{user:t,scope:s}=Kr();function r(le){try{const X=new Date(le);if(Number.isNaN(X.getTime()))return"";const me=He=>String(He).padStart(2,"0"),we=X.getFullYear(),Ie=me(X.getMonth()+1),_e=me(X.getDate()),Fe=me(X.getHours()),Le=me(X.getMinutes()),rt=me(X.getSeconds());return`${we}-${Ie}-${_e}T${Fe}:${Le}:${rt}`}catch{return""}}const[a,n]=f.useState(new Date),[i,l]=f.useState(""),[o,d]=f.useState([]),[u,c]=f.useState(!1),[h,m]=f.useState([]),[p,g]=f.useState({open:!1,mode:"details",index:-1,item:null,actualCash:"",notes:""}),x=f.useMemo(()=>Number((t==null?void 0:t.sub)||(t==null?void 0:t.id)||0),[t]),b=f.useMemo(()=>{const le=(t==null?void 0:t.username)||(t==null?void 0:t.name)||(t==null?void 0:t.fullName)||"Cashier";return String(le)},[t]),[y,j]=f.useState(!1),[N,_]=f.useState({dateTime:r(new Date),float:"",supervisor:"",notes:""}),[F,I]=f.useState(new Array(6).fill(!1)),w=f.useMemo(()=>{const le=F.length||1,X=F.filter(Boolean).length;return Math.round(X/le*100)},[F]),[E,W]=f.useState({cash:{count:0,amount:0},card:{count:0,amount:0},mobile:{count:0,amount:0}}),R=f.useMemo(()=>{const le=Number(E.cash.amount||0)+Number(E.card.amount||0)+Number(E.mobile.amount||0),X=Number(E.cash.count||0)+Number(E.card.count||0)+Number(E.mobile.count||0);return{totalAmount:le,totalCount:X}},[E]),U=f.useMemo(()=>Number(N.float||0)+Number(E.cash.amount||0),[N.float,E.cash.amount]),[T,Y]=f.useState({dateTime:r(new Date),actualCash:"",notes:""}),H=f.useMemo(()=>Number(T.actualCash||0)-Number(U||0),[T.actualCash,U]),[M,q]=f.useState([{time:new Date,title:"Waiting",description:"No activity yet"}]),[z,Q]=f.useState({open:!1,title:"",icon:"",message:""}),[L,V]=f.useState([]),P=f.useMemo(()=>({cashCount:Number(E.cash.count||0),cashAmount:Number(E.cash.amount||0),cardCount:Number(E.card.count||0),cardAmount:Number(E.card.amount||0),mobileCount:Number(E.mobile.count||0),mobileAmount:Number(E.mobile.amount||0)}),[E]),C=f.useMemo(()=>p.open?p.index>=0&&p.index<L.length?L[p.index]:p.item:null,[p.open,p.index,p.item,L]);f.useEffect(()=>{const le=setInterval(()=>n(new Date),1e3);return()=>clearInterval(le)},[]),f.useEffect(()=>{const le=String((t==null?void 0:t.username)||"").trim();le&&!N.supervisor&&_(X=>({...X,supervisor:le}))},[t==null?void 0:t.username]),f.useEffect(()=>{let le=!1;async function X(){var me,we,Ie;if(x){c(!0);try{const[_e,Fe]=await Promise.all([Z.get("/pos/terminals"),Z.get("/pos/terminal-users")]);if(le)return;const Le=Array.isArray((me=_e.data)==null?void 0:me.items)?_e.data.items:[],rt=Array.isArray((we=Fe.data)==null?void 0:we.items)?Fe.data.items:[],He=new Set(rt.filter(Ce=>Number(Ce==null?void 0:Ce.user_id)===Number(x)).map(Ce=>Number(Ce==null?void 0:Ce.terminal_id)).filter(Ce=>Number.isFinite(Ce)&&Ce>0)),st=Le.filter(Ce=>He.has(Number(Ce==null?void 0:Ce.id)));d(st);const Te=st.some(Ce=>String((Ce==null?void 0:Ce.code)||"")===String(i||""))?i:((Ie=st[0])==null?void 0:Ie.code)||"";l(Te?String(Te):"")}catch{if(le)return;d([]),l("")}finally{le||c(!1)}}}return X(),()=>{le=!0}},[x,b]),f.useEffect(()=>{let le=!1;async function X(){var me;try{const we=Number((s==null?void 0:s.companyId)||0)||void 0,Ie=Number((s==null?void 0:s.branchId)||0)||void 0,_e=await Z.get("/admin/users",{params:{...we?{company_id:we}:{},...Ie?{branch_id:Ie}:{},active:1,limit:100}});if(le)return;m(Array.isArray((me=_e.data)==null?void 0:me.items)?_e.data.items:[])}catch{if(le)return;m([])}}return X(),()=>{le=!0}},[s==null?void 0:s.companyId,s==null?void 0:s.branchId]),f.useEffect(()=>{let le=!1;return Z.get("/pos/analytics/day-summary").then(X=>{var Ie;if(le)return;const me=((Ie=X==null?void 0:X.data)==null?void 0:Ie.summary)||{},we={cash:{count:Number(me.cashCount||0),amount:Number(me.cashAmount||0)},card:{count:Number(me.cardCount||0),amount:Number(me.cardAmount||0)},mobile:{count:Number(me.mobileCount||0),amount:Number(me.mobileAmount||0)}};W(we)}).catch(()=>{}),()=>{le=!0}},[]),f.useEffect(()=>{let le=!1;const X=i;if(X)return Z.get("/pos/day/status",{params:{terminal:X}}).then(me=>{var Fe;if(le)return;const we=(Fe=me==null?void 0:me.data)==null?void 0:Fe.item;if(!we){j(!1),V([]);return}const Ie=String(we.status||"").toUpperCase()==="OPEN";j(Ie),_({dateTime:r(we.open_datetime||""),float:we.opening_float===null||we.opening_float===void 0?"":String(we.opening_float),supervisor:we.supervisor_name||"",notes:we.open_notes||""}),Y(Le=>({...Le,dateTime:r(we.close_datetime||""),actualCash:we.actual_cash===null||we.actual_cash===void 0?"":String(we.actual_cash),notes:we.close_notes||""}));const _e={dayStatusId:Number(we.id||0)||null,no:`DAY-${String(we.id||"").padStart(6,"0")}`,terminal:String(we.terminal_code||X||""),cashier:b,start:we.open_datetime?new Date(we.open_datetime).toLocaleString():"-",startTime:we.open_datetime||null,end:we.close_datetime?new Date(we.close_datetime).toLocaleString():"-",endTime:we.close_datetime||null,opening:Number(we.opening_float||0),status:Ie?"Open":"Closed",startSummary:se({}),endSummary:Ie?null:P,expectedCash:null,actualCash:we.actual_cash===null||we.actual_cash===void 0?null:Number(we.actual_cash||0),cashVariance:null,closeNotes:we.close_notes||""};if(!Ie&&_e.actualCash!==null){const Le=Number(_e.opening||0)+Number(P.cashAmount||0);_e.expectedCash=Le,_e.cashVariance=Number(_e.actualCash||0)-Le}V([_e]),k(Ie?"Day Status":"Last Day Status",Ie?"Day is currently open":"Last day is closed")}).catch(()=>{}),()=>{le=!0}},[i]);function k(le,X){const me={time:new Date,title:le,description:X};q(we=>{var Fe;const _e=we.length===1&&String((Fe=we[0])==null?void 0:Fe.title).includes("Waiting")?[]:we.slice();return[me,..._e].slice(0,50)})}function B(le,X,me){Q({open:!0,title:le,icon:X,message:me})}function G(){Q(le=>({...le,open:!1}))}function O(le){I(X=>{const me=X.slice();me[le]=!me[le];const we=["Verify cash float count","Check POS system connectivity","Verify printer and receipt paper","Test card payment terminal","Review pending transactions","Confirm inventory sync"][le];return k(me[le]?"Checklist Completed":"Checklist Unchecked",we),me})}async function K(le){var me,we,Ie,_e,Fe;if(le.preventDefault(),!F.every(Boolean)){ct.warn("Complete all opening checklist items");return}if(!N.dateTime||!N.supervisor){ct.warn("Provide opening date/time and supervisor");return}try{const Le={terminal:i,openingDateTime:N.dateTime,openingFloat:Number(N.float||0),supervisor:N.supervisor,notes:N.notes},rt=await Z.post("/pos/day/open",Le),He=(me=rt==null?void 0:rt.data)==null?void 0:me.item;He?(j(String(He.status||"").toUpperCase()==="OPEN"),_({dateTime:r(He.open_datetime||"")||N.dateTime,float:He.opening_float===null||He.opening_float===void 0?String(N.float||""):String(He.opening_float),supervisor:He.supervisor_name||N.supervisor,notes:He.open_notes||N.notes}),V([{dayStatusId:Number(He.id||0)||null,no:`DAY-${String(He.id||"").padStart(6,"0")}`,terminal:String(He.terminal_code||i||""),cashier:b,start:He.open_datetime?new Date(He.open_datetime).toLocaleString():new Date(N.dateTime).toLocaleString(),startTime:He.open_datetime||N.dateTime,end:"-",endTime:null,opening:Number(He.opening_float??N.float??0),status:"Open",startSummary:se({}),endSummary:null,expectedCash:null,actualCash:null,cashVariance:null,closeNotes:""}])):j(!0),B("Day Opened","","Day is open. Complete transactions and close day when finished."),k("Day Opened","Operations started")}catch(Le){const rt=((Ie=(we=Le==null?void 0:Le.response)==null?void 0:we.data)==null?void 0:Ie.message)||((Fe=(_e=Le==null?void 0:Le.response)==null?void 0:_e.data)==null?void 0:Fe.error)||"Failed to open day";ct.error(rt)}}async function J(le){var X,me,we,Ie,_e,Fe;if(le.preventDefault(),!y){ct.error("Open the day first");return}if(!T.dateTime){ct.warn("Provide closing date/time");return}try{const Le={terminal:i,closingDateTime:T.dateTime,actualCash:Number(T.actualCash||0),notes:T.notes},rt=await Z.post("/pos/day/close",Le),He=(X=rt==null?void 0:rt.data)==null?void 0:X.item;if(He){Y(De=>({...De,dateTime:r(He.close_datetime||"")||T.dateTime,actualCash:He.actual_cash===null||He.actual_cash===void 0?String(T.actualCash||""):String(He.actual_cash),notes:He.close_notes||T.notes})),j(String(He.status||"").toUpperCase()==="OPEN");let st=P;try{const De=await Z.get("/pos/analytics/day-summary");st=se(((me=De==null?void 0:De.data)==null?void 0:me.summary)||{})}catch{}V(De=>{const Te=Array.isArray(De)&&De.length?De[0]:{},Ce=Number(Te.opening??N.float??He.opening_float??0),Pe=Ce+Number(st.cashAmount||0),fe=Number(He.actual_cash??T.actualCash??0);return[{...Te,dayStatusId:Number(He.id||Te.dayStatusId||0)||null,no:Te.no||`DAY-${String(He.id||"").padStart(6,"0")}`,terminal:String(He.terminal_code||i||Te.terminal||""),cashier:b,start:Te.start||(N.dateTime?new Date(N.dateTime).toLocaleString():"-"),startTime:Te.startTime||N.dateTime||null,end:He.close_datetime?new Date(He.close_datetime).toLocaleString():new Date(T.dateTime).toLocaleString(),endTime:He.close_datetime||T.dateTime,opening:Ce,status:"Closed",startSummary:Te.startSummary||se({}),endSummary:st,expectedCash:Pe,actualCash:fe,cashVariance:fe-Pe,closeNotes:He.close_notes||T.notes||""}]})}else j(!1);B("Day Closed","","End-of-day reconciliation complete. See report summary below."),k("Day Closed","Operations ended")}catch(Le){const rt=((Ie=(we=Le==null?void 0:Le.response)==null?void 0:we.data)==null?void 0:Ie.message)||((Fe=(_e=Le==null?void 0:Le.response)==null?void 0:_e.data)==null?void 0:Fe.error)||"Failed to close day";ct.error(rt)}}function te(le){return`${Number(le||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}function se(le){const X=le||{};return{cashCount:Number(X.cashCount||0),cashAmount:Number(X.cashAmount||0),cardCount:Number(X.cardCount||0),cardAmount:Number(X.cardAmount||0),mobileCount:Number(X.mobileCount||0),mobileAmount:Number(X.mobileAmount||0)}}function ae(le,X){const me=se(le),we=se(X),Ie=(_e,Fe)=>Math.max(0,Number(_e||0)-Number(Fe||0));return{cashCount:Ie(me.cashCount,we.cashCount),cashAmount:Ie(me.cashAmount,we.cashAmount),cardCount:Ie(me.cardCount,we.cardCount),cardAmount:Ie(me.cardAmount,we.cardAmount),mobileCount:Ie(me.mobileCount,we.mobileCount),mobileAmount:Ie(me.mobileAmount,we.mobileAmount)}}function ne(le){const X=(le==null?void 0:le.startSummary)!==null&&(le==null?void 0:le.startSummary)!==void 0,me=(le==null?void 0:le.endSummary)||P,we=X?ae(me,(le==null?void 0:le.startSummary)||null):{cashCount:0,cashAmount:0,cardCount:0,cardAmount:0,mobileCount:0,mobileAmount:0},Ie=Number(we.cashCount||0)+Number(we.cardCount||0)+Number(we.mobileCount||0),_e=Number(we.cashAmount||0)+Number(we.cardAmount||0)+Number(we.mobileAmount||0),Fe=X?_e:Number((le==null?void 0:le.sales)||0),Le=(le==null?void 0:le.status)==="Closed"&&(le==null?void 0:le.expectedCash)!==null&&(le==null?void 0:le.expectedCash)!==void 0?Number(le.expectedCash||0):Number((le==null?void 0:le.opening)||0)+Number(we.cashAmount||0),rt=(le==null?void 0:le.status)==="Closed"&&(le==null?void 0:le.actualCash)!==null&&(le==null?void 0:le.actualCash)!==void 0?Number(le.actualCash||0):(le==null?void 0:le.actualCash)===null||(le==null?void 0:le.actualCash)===void 0?null:Number(le.actualCash||0),He=(le==null?void 0:le.status)==="Closed"&&(le==null?void 0:le.cashVariance)!==null&&(le==null?void 0:le.cashVariance)!==void 0?Number(le.cashVariance||0):rt===null?null:rt-Le;return{diff:we,totalCount:Ie,totalAmount:Fe,expectedCashAtClose:Le,actualCashAtClose:rt,cashVarianceAtClose:He}}function ue(le){try{return new Date(le).toLocaleTimeString()}catch{return"--:--"}}function oe(){const le=R.totalAmount,X=R.totalCount,me=window.open("","_blank");if(!me)return;const we=a.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),Ie=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>POS End of Day Report</title>
        <style>
          body { font-family: 'Courier New', monospace; padding: 20px; max-width: 700px; margin: 0 auto; }
          h1 { text-align: center; border-bottom: 2px solid #0E3646; padding-bottom: 10px; color: #0E3646; }
          .row { display: flex; justify-content: space-between; margin: 5px 0; }
          table { width: 100%; border-collapse: collapse; margin: 20px 0; }
          th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
          th { background: #0E3646; color: white; }
          .totals { background: #f0f0f0; font-weight: bold; }
          .footer { margin-top: 20px; }
          @media print { button { display: none; } }
        </style>
      </head>
      <body>
        <h1>END OF DAY REPORT</h1>
        <div class="row"><strong>Terminal:</strong><span>${i}</span></div>
        <div class="row"><strong>Cashier:</strong><span>${b}</span></div>
        <div class="row"><strong>Date:</strong><span>${we}</span></div>
        <div class="row"><strong>Opening Float:</strong><span>${te(N.float)}</span></div>
        <table>
          <thead>
            <tr><th>Payment Method</th><th>Transactions</th><th>Amount Received</th></tr>
          </thead>
          <tbody>
            <tr><td>Cash</td><td>${E.cash.count}</td><td>${te(E.cash.amount)}</td></tr>
            <tr><td>Card</td><td>${E.card.count}</td><td>${te(E.card.amount)}</td></tr>
            <tr><td>Mobile Money</td><td>${E.mobile.count}</td><td>${te(E.mobile.amount)}</td></tr>
            <tr class="totals"><td><strong>TOTAL</strong></td><td><strong>${X}</strong></td><td><strong>${te(le)}</strong></td></tr>
          </tbody>
        </table>
        <div class="footer">
          <div class="row"><strong>Expected Cash:</strong><span>${te(U)}</span></div>
          <div class="row"><strong>Actual Cash Count:</strong><span>${te(T.actualCash||0)}</span></div>
          <div class="row"><strong>Variance:</strong><span>${te(H)}</span></div>
        </div>
        <button onclick="window.print()">Print</button>
      </body>
      </html>
    `;me.document.write(Ie),me.document.close()}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/pos",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to POS"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"POS Day Management"}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Open and close POS business day with reconciliation"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-slate-700 dark:text-slate-300",children:a.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("div",{className:"text-sm font-semibold text-brand-700 dark:text-brand-300",children:a.toLocaleTimeString()})]})]}),e.jsx("div",{className:"rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-slate-500 text-sm",children:"Terminal"}),e.jsx("div",{className:"space-y-1",children:e.jsxs("select",{className:"input py-1 px-2 text-sm",value:i,onChange:le=>l(le.target.value),disabled:u||!o.length,children:[!o.length&&e.jsx("option",{value:"",children:u?"Loading...":"No terminals assigned"}),o.map(le=>e.jsx("option",{value:String(le.code||""),children:String(le.code||"")},le.id))]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-slate-500 text-sm",children:"Cashier"}),e.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100 text-sm",children:b})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-slate-500 text-sm",children:"Date"}),e.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100 text-sm",children:a.toLocaleDateString()})]}),e.jsx("div",{children:e.jsx("span",{className:y?"badge-success":"badge-danger",children:y?"OPEN":"CLOSED"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("div",{className:"card-title",children:"Open Day"}),e.jsx("div",{className:"text-2xl",children:""})]}),e.jsxs("div",{className:"card-body",children:[!y&&e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-4 text-sm",children:[e.jsx("div",{className:"font-semibold text-blue-900 mb-1",children:"Day Opening Procedure"}),e.jsx("div",{className:"text-blue-800",children:"Complete the checklist and verify opening float before starting operations."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Opening Date & Time"}),e.jsx("input",{type:"datetime-local",className:"input",value:N.dateTime,onChange:le=>_(X=>({...X,dateTime:le.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Opening Float ()"}),e.jsx("input",{type:"number",className:"input",step:"1",value:N.float,onChange:le=>_(X=>({...X,float:le.target.value})),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Supervisor Name"}),e.jsxs("select",{className:"input",value:N.supervisor,onChange:le=>_(X=>({...X,supervisor:le.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Select supervisor"}),N.supervisor&&!h.some(le=>String((le==null?void 0:le.username)||"")===String(N.supervisor))&&e.jsx("option",{value:N.supervisor,children:N.supervisor}),h.map(le=>e.jsx("option",{value:String(le.username||""),children:String(le.username||"")},le.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes"}),e.jsx("textarea",{className:"input",rows:3,value:N.notes,onChange:le=>_(X=>({...X,notes:le.target.value}))})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-semibold text-slate-700",children:"Opening Checklist"}),e.jsxs("div",{className:"font-semibold text-brand-700",children:[w,"%"]})]}),e.jsx("div",{className:"w-full h-3 bg-slate-200 rounded",children:e.jsx("div",{className:"h-3 rounded bg-gradient-to-r from-brand-700 to-brand-500",style:{width:`${w}%`}})}),e.jsx("ul",{className:"mt-3 space-y-2",children:["Verify cash float count","Check POS system connectivity","Verify printer and receipt paper","Test card payment terminal","Review pending transactions","Confirm inventory sync"].map((le,X)=>e.jsxs("li",{className:`flex items-center gap-3 p-3 rounded-lg border ${F[X]?"bg-green-50 border-green-200":"bg-slate-50 border-slate-200"}`,children:[e.jsx("input",{type:"checkbox",className:"checkbox",checked:F[X],onChange:()=>O(X)}),e.jsx("div",{className:`text-sm ${F[X]?"line-through":""}`,children:le})]},X))})]}),e.jsx("button",{type:"submit",className:"btn-success w-full",children:" Open Day"})]}),y&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"alert-success rounded-lg p-4 flex items-center gap-2",children:[e.jsx("span",{children:""}),e.jsx("div",{children:"Day is currently open. Complete transactions and close day when finished."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-slate-50",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Opened At"}),e.jsx("div",{className:"font-semibold",children:ue(N.dateTime)})]}),e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-slate-50",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Opening Float"}),e.jsx("div",{className:"font-bold",children:te(N.float)})]})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("div",{className:"card-title",children:"Close Day"}),e.jsx("div",{className:"text-2xl",children:""})]}),e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-4 text-sm",children:[e.jsx("div",{className:"font-semibold text-blue-900 mb-1",children:"Day Closing Procedure"}),e.jsx("div",{className:"text-blue-800",children:"Complete end-of-day reconciliation and verify all transactions before closing."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Closing Date & Time"}),e.jsx("input",{type:"datetime-local",className:"input",value:T.dateTime,onChange:le=>Y(X=>({...X,dateTime:le.target.value})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-slate-50",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Total Sales"}),e.jsx("div",{className:"font-bold",children:te(R.totalAmount)})]}),e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-slate-50",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Transactions"}),e.jsx("div",{className:"font-semibold",children:R.totalCount})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Actual Cash Count ()"}),e.jsx("input",{type:"number",className:"input",step:"1",value:T.actualCash,onChange:le=>Y(X=>({...X,actualCash:le.target.value})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Expected Cash"}),e.jsx("input",{type:"text",className:"input",disabled:!0,value:te(U)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Cash Variance"}),e.jsx("input",{type:"text",className:"input",disabled:!0,value:te(H),style:{color:H>=0?"#28a745":"#dc3545",fontWeight:700}})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Closing Notes"}),e.jsx("textarea",{className:"input",rows:3,value:T.notes,onChange:le=>Y(X=>({...X,notes:le.target.value}))})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200",children:[e.jsx("div",{className:"p-3 font-semibold",children:"Sales Report"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Payment Method"}),e.jsx("th",{children:"Transactions"}),e.jsx("th",{children:"Amount Received"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Cash"}),e.jsx("td",{children:E.cash.count}),e.jsx("td",{children:te(E.cash.amount)})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Card"}),e.jsx("td",{children:E.card.count}),e.jsx("td",{children:te(E.card.amount)})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Mobile Money"}),e.jsx("td",{children:E.mobile.count}),e.jsx("td",{children:te(E.mobile.amount)})]}),e.jsxs("tr",{className:"bg-blue-50 font-semibold",children:[e.jsx("td",{children:"TOTAL"}),e.jsx("td",{children:R.totalCount}),e.jsx("td",{children:te(R.totalAmount)})]})]})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-danger flex-1",children:" Close Day"}),e.jsx("button",{type:"button",className:"btn-info flex-1",onClick:oe,children:" Print Report"})]})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("div",{className:"card-title",children:"Activity Timeline"}),e.jsx("div",{className:"text-2xl",children:""})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"space-y-3",children:[M.map((le,X)=>e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-slate-50",children:[e.jsxs("div",{className:"text-sm font-semibold text-brand-700",children:[new Date(le.time).toLocaleTimeString()," - ",le.title]}),e.jsx("div",{className:"text-sm",children:le.description})]},X)),!M.length&&e.jsx("div",{className:"text-sm text-slate-500",children:"No activity yet"})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("div",{className:"card-title",children:"Sessions/Shifts"}),e.jsx("div",{className:"text-2xl",children:""})]}),e.jsx("div",{className:"card-body space-y-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Session History"}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-slate-200",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-slate-800 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"Session #"}),e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"Terminal"}),e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"Cashier"}),e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"Start Time"}),e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"End Time"}),e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"Opening Cash"}),e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"Total Sales"}),e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"Status"}),e.jsx("th",{className:"text-left p-2 text-xs uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white",children:L.map((le,X)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:le.no}),e.jsx("td",{className:"p-2",children:le.terminal}),e.jsx("td",{className:"p-2",children:le.cashier}),e.jsx("td",{className:"p-2",children:le.start}),e.jsx("td",{className:"p-2",children:le.end}),e.jsx("td",{className:"p-2",children:Number(le.opening).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{className:"p-2",children:Number(le.sales).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${le.status==="Open"?"bg-blue-100 text-blue-700":le.status==="Closed"?"bg-green-100 text-green-700":"bg-slate-100 text-slate-700"}`,children:le.status})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-info",onClick:()=>g({open:!0,mode:"details",index:X,item:le,actualCash:"",notes:""}),children:"Details"}),le.status==="Open"?e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{g({open:!0,mode:"close",index:X,item:le,actualCash:"",notes:""})},children:"Close"}):e.jsx("button",{type:"button",className:"btn btn-info",disabled:!0,children:"Closed"})]})})]},X))})]})})]})})]}),p.open&&C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"rounded-xl bg-white dark:bg-slate-800 shadow-lg w-full max-w-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:p.mode==="close"?`Close ${C.no}`:`Session ${C.no}`}),e.jsx("button",{type:"button",className:"btn btn-sm btn-link",onClick:()=>g({open:!1,mode:"details",index:-1,item:null,actualCash:"",notes:""}),children:""})]}),(()=>{const le=C,X=ne(le),me=le.start||(le.startTime?new Date(le.startTime).toLocaleString():"-"),we=le.end&&le.end!=="-"?le.end:le.endTime?new Date(le.endTime).toLocaleString():"-",Ie=X.cashVarianceAtClose!==null;return p.mode==="close"?e.jsxs("div",{className:"max-h-[70vh] overflow-y-auto p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-slate-50",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Terminal"}),e.jsx("div",{className:"font-semibold",children:le.terminal})]}),e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-slate-50",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Cashier"}),e.jsx("div",{className:"font-semibold",children:le.cashier})]}),e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-slate-50",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Start Time"}),e.jsx("div",{className:"font-semibold",children:me})]}),e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-slate-50",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Expected Cash"}),e.jsx("div",{className:"font-bold",children:te(X.expectedCashAtClose)})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"p-3 font-semibold bg-slate-50",children:"Sales (Since Session Start)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Payment Method"}),e.jsx("th",{children:"Transactions"}),e.jsx("th",{children:"Amount Received"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Cash"}),e.jsx("td",{children:X.diff.cashCount}),e.jsx("td",{children:te(X.diff.cashAmount)})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Card"}),e.jsx("td",{children:X.diff.cardCount}),e.jsx("td",{children:te(X.diff.cardAmount)})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Mobile Money"}),e.jsx("td",{children:X.diff.mobileCount}),e.jsx("td",{children:te(X.diff.mobileAmount)})]}),e.jsxs("tr",{className:"bg-blue-50 font-semibold",children:[e.jsx("td",{children:"TOTAL"}),e.jsx("td",{children:X.totalCount}),e.jsx("td",{children:te(X.totalAmount)})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Actual Cash Count ()"}),e.jsx("input",{type:"number",className:"input",step:"1",value:p.actualCash,onChange:_e=>g(Fe=>({...Fe,actualCash:_e.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Closing Notes"}),e.jsx("textarea",{className:"input",rows:3,value:p.notes,onChange:_e=>g(Fe=>({...Fe,notes:_e.target.value}))})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>g({open:!1,mode:"details",index:-1,item:null,actualCash:"",notes:""}),children:"Cancel"}),e.jsx("button",{type:"button",className:"btn-danger",onClick:async()=>{var He;const _e=p.index;if(_e<0||_e>=L.length)return;if(String(p.actualCash||"").trim()===""){ct.warn("Provide actual cash count");return}let Fe=P;try{const st=await Z.get("/pos/analytics/day-summary");Fe=se(((He=st==null?void 0:st.data)==null?void 0:He.summary)||{})}catch{}const Le=new Date,rt=Number(p.actualCash||0);V(st=>st.map((De,Te)=>{if(Te!==_e)return De;const Ce=ae(Fe,(De==null?void 0:De.startSummary)||null),Pe=Number(Ce.cashAmount||0)+Number(Ce.cardAmount||0)+Number(Ce.mobileAmount||0),fe=Number((De==null?void 0:De.opening)||0)+Number(Ce.cashAmount||0),he=rt-fe;return{...De,end:Le.toLocaleString(),endTime:Le.toISOString(),status:"Closed",sales:Pe,endSummary:Fe,expectedCash:fe,actualCash:rt,cashVariance:he,closeNotes:p.notes||""}})),k("Session Closed",`${C.cashier} on ${C.terminal}`),g({open:!1,mode:"details",index:-1,item:null,actualCash:"",notes:""})},children:"Close Session"})]})]}):e.jsxs("div",{className:"max-h-[70vh] overflow-y-auto p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-slate-50",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Terminal"}),e.jsx("div",{className:"font-semibold",children:le.terminal})]}),e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-slate-50",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Cashier"}),e.jsx("div",{className:"font-semibold",children:le.cashier})]}),e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-slate-50",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Status"}),e.jsx("div",{className:"font-semibold",children:le.status})]}),e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-slate-50",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Start Time"}),e.jsx("div",{className:"font-semibold",children:me})]}),e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-slate-50",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"End Time"}),e.jsx("div",{className:"font-semibold",children:we})]}),e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-slate-50",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Opening Cash"}),e.jsx("div",{className:"font-bold",children:te(le.opening)})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"p-3 font-semibold bg-slate-50",children:"Sales Breakdown"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Payment Method"}),e.jsx("th",{children:"Transactions"}),e.jsx("th",{children:"Amount Received"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Cash"}),e.jsx("td",{children:X.diff.cashCount}),e.jsx("td",{children:te(X.diff.cashAmount)})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Card"}),e.jsx("td",{children:X.diff.cardCount}),e.jsx("td",{children:te(X.diff.cardAmount)})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Mobile Money"}),e.jsx("td",{children:X.diff.mobileCount}),e.jsx("td",{children:te(X.diff.mobileAmount)})]}),e.jsxs("tr",{className:"bg-blue-50 font-semibold",children:[e.jsx("td",{children:"TOTAL"}),e.jsx("td",{children:X.totalCount}),e.jsx("td",{children:te(X.totalAmount)})]})]})]})})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"p-3 font-semibold bg-slate-50",children:"Cash Reconciliation"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4",children:[e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-white",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Expected Cash"}),e.jsx("div",{className:"font-bold",children:te(X.expectedCashAtClose)})]}),e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-white",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Actual Cash"}),e.jsx("div",{className:"font-bold",children:X.actualCashAtClose===null?"-":te(X.actualCashAtClose)})]}),e.jsxs("div",{className:"p-3 rounded-lg border border-slate-200 bg-white",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"Variance"}),e.jsx("div",{className:"font-bold",style:{color:X.cashVarianceAtClose===null?void 0:X.cashVarianceAtClose>=0?"#28a745":"#dc3545"},children:Ie?te(X.cashVarianceAtClose):"-"})]})]}),(le.closeNotes||(C==null?void 0:C.closeNotes))&&e.jsx("div",{className:"px-4 pb-4 text-sm text-slate-700",children:le.closeNotes||(C==null?void 0:C.closeNotes)})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>g({open:!1,mode:"details",index:-1,item:null,actualCash:"",notes:""}),children:"Close"})})]})})()]})}),z.open&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"rounded-xl bg-white dark:bg-slate-800 shadow-lg w-full max-w-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:z.title}),e.jsx("button",{type:"button",className:"btn btn-sm btn-link",onClick:G,children:""})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"text-center text-6xl",children:z.icon}),e.jsx("div",{className:"text-center",children:z.message}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(Re,{to:"/pos",className:"btn-secondary",children:"Return to POS"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:G,children:"Continue"})]})]})]})})]})}function Pse({data:t,xKey:s,yKey:r,height:a=160,xLabel:n,yLabel:i,formatY:l,color:o="#3b82f6"}){const d=Math.max(1,...t.map(c=>Number(c[r]||0))),u=t.map(c=>({label:String(c[s]),value:Number(c[r]||0),h:Math.round(Number(c[r]||0)/d*a)}));return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"flex items-end gap-4 w-full",style:{height:a},children:u.map((c,h)=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-[10px] font-semibold",children:l?l(c.value):Number(c.value||0).toLocaleString()}),e.jsx("div",{className:"w-8 rounded-t",style:{height:`${Math.max(4,c.h)}px`,backgroundColor:o},title:`${c.label}  ${l?l(c.value):c.value.toLocaleString()}`}),e.jsx("div",{className:"text-[10px] mt-1 text-center w-12 truncate",children:c.label})]},h))}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("div",{className:"text-[10px] text-slate-500",children:i||""}),e.jsx("div",{className:"text-[10px] text-slate-500",children:n||""})]})]})}function ey({points:t,height:s=180,xLabel:r,yLabel:a,formatY:n,color:i="#ef4444",areaColor:l="rgba(239,68,68,0.2)"}){const o=Math.max(1,...t.map(p=>Number(p.y||0))),d=Math.max(240,t.length*32),u=d/Math.max(1,t.length-1),c=t.map((p,g)=>{const x=Math.round(g*u),b=Math.round(s-Number(p.y||0)/o*s);return{x,y:b,label:p.x,value:Number(p.y||0)}}),h=c.length?c.map((p,g)=>`${g===0?"M":"L"} ${p.x} ${p.y}`).join(" "):`M 0 ${s}`,m=c.length?`${h} L ${c[c.length-1].x} ${s} L 0 ${s} Z`:`M 0 ${s} L ${d} ${s}`;return e.jsxs("div",{className:"w-full",children:[e.jsxs("svg",{width:"100%",viewBox:`0 0 ${d} ${s}`,preserveAspectRatio:"none",children:[e.jsx("path",{d:m,fill:l}),e.jsx("path",{d:h,fill:"none",stroke:i,strokeWidth:"2"}),c.map((p,g)=>e.jsxs("g",{children:[e.jsx("circle",{cx:p.x,cy:p.y,r:"3",fill:i}),e.jsx("text",{x:p.x,y:Math.max(10,p.y-6),fontSize:"10",textAnchor:"middle",fill:"#0f172a",children:n?n(p.value):p.value.toLocaleString()})]},g))]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("div",{className:"text-[10px] text-slate-500",children:a||""}),e.jsx("div",{className:"text-[10px] text-slate-500",children:r||""})]})]})}function Use({data:t,size:s=160,label:r}){const a=t.reduce((u,c)=>u+Number(c.value||0),0),n=s/2,i=n,l=n;let o=0;const d=t.map((u,c)=>{const h=Number(u.value||0),m=a?h/a:0,p=o*2*Math.PI,g=(o+m)*2*Math.PI;o+=m;const x=i+n*Math.cos(p),b=l+n*Math.sin(p),y=i+n*Math.cos(g),j=l+n*Math.sin(g),N=g-p>Math.PI?1:0,_=["#0e3646","#0f6b83","#12a3bf","#5cc2d4","#9bd9e2","#cfeef1","#fcd34d","#fb7185"],F=_[c%_.length];return{d:`M ${i} ${l} L ${x} ${b} A ${n} ${n} 0 ${N} 1 ${y} ${j} Z`,fill:F,label:u.label,value:h}});return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{width:s,height:s,children:d.map((u,c)=>e.jsx("path",{d:u.d,fill:u.fill},c))}),e.jsxs("div",{className:"text-xs space-y-1",children:[r?e.jsx("div",{className:"font-semibold text-slate-600 mb-1",children:r}):null,t.map((u,c)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block w-3 h-3 rounded",style:{backgroundColor:["#0e3646","#0f6b83","#12a3bf","#5cc2d4","#9bd9e2","#cfeef1","#fcd34d","#fb7185"][c%8]}}),e.jsx("span",{className:"flex-1",children:u.label}),e.jsx("span",{className:"font-semibold",children:Number(u.value||0).toLocaleString()})]},c))]})]})}function Rse({categories:t,series:s,height:r=160,xLabel:a,yLabel:n,formatY:i}){const l=Math.max(1,...s.flatMap(o=>t.map(d=>Number(o.data[d]||0))));return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"flex items-end gap-3 w-full",style:{height:r},children:t.map((o,d)=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"flex items-end gap-1",children:s.map((u,c)=>{const h=Number(u.data[o]||0),m=Math.round(h/l*r);return e.jsx("div",{className:"rounded-t",style:{width:10,height:`${Math.max(4,m)}px`,backgroundColor:u.color},title:`${u.label} @ ${o}  ${i?i(h):h.toLocaleString()}`},c)})}),e.jsx("div",{className:"text-[10px] mt-1 text-center w-16 truncate",children:o})]},d))}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("div",{className:"text-[10px] text-slate-500",children:n||""}),e.jsx("div",{className:"text-[10px] text-slate-500",children:a||""})]}),e.jsx("div",{className:"flex gap-4 mt-2",children:s.map((o,d)=>e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-slate-600",children:[e.jsx("span",{className:"inline-block w-3 h-3 rounded",style:{backgroundColor:o.color}}),e.jsx("span",{children:o.label})]},d))})]})}function Ose({data:t,height:s=180,xLabel:r,yLabel:a,formatY:n,color:i="#3b82f6"}){const l=t.map(m=>Number(m.total||0)),o=Math.max(0,...l.filter(m=>m>=0)),d=Math.max(0,...l.filter(m=>m<0).map(m=>Math.abs(m))),u=o+d||1,c=Math.round(o/u*s),h=s-c;return e.jsxs("div",{className:"w-full",children:[e.jsxs("svg",{width:"100%",viewBox:`0 0 ${t.length*36} ${s}`,preserveAspectRatio:"none",children:[e.jsx("line",{x1:"0",y1:h,x2:t.length*36,y2:h,stroke:"#94a3b8",strokeWidth:"1"}),t.map((m,p)=>{const g=Number(m.total||0),x=Math.round(Math.abs(g)/u*s)||0,b=p*36+12,y=g>=0?h-x:h;return e.jsxs("g",{children:[e.jsx("rect",{x:b,y,width:"16",height:x,fill:i}),e.jsx("text",{x:b+8,y:g>=0?y-4:y+x+10,fontSize:"10",textAnchor:"middle",fill:"#0f172a",children:n?n(g):g.toLocaleString()}),e.jsx("text",{x:b+8,y:s-2,fontSize:"10",textAnchor:"middle",fill:"#64748b",children:String(m.label||"")})]},p)})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("div",{className:"text-[10px] text-slate-500",children:a||""}),e.jsx("div",{className:"text-[10px] text-slate-500",children:r||""})]})]})}function Mse(){const[t,s]=f.useState(!1),[r,a]=f.useState(""),[n,i]=f.useState(null),[l,o]=f.useState([]),[d,u]=f.useState([]),[c,h]=f.useState([]),[m,p]=f.useState([]),[g,x]=f.useState([]),[b,y]=f.useState([]),[j,N]=f.useState([]),[_,F]=f.useState([]),[I,w]=f.useState(30);f.useEffect(()=>{let z=!0;return s(!0),a(""),Promise.all([Z.get("/pos/analytics/day-summary"),Z.get("/pos/analytics/day-terminal-methods"),Z.get("/pos/analytics/day-user-sales"),Z.get("/pos/analytics/sales-30-days"),Z.get("/pos/analytics/sales-monthly"),Z.get("/pos/analytics/weekday-current-week"),Z.get("/pos/analytics/hourly-today"),Z.get("/pos/analytics/category-share"),Z.get("/pos/reports/top-items",{params:{limit:10}})]).then(([Q,L,V,P,C,k,B,G,O])=>{var K,J,te,se,ae,ne,ue,oe,le;z&&(i(((K=Q.data)==null?void 0:K.summary)||null),o(Array.isArray((J=L.data)==null?void 0:J.items)?L.data.items:[]),u(Array.isArray((te=V.data)==null?void 0:te.items)?V.data.items:[]),h(Array.isArray((se=P.data)==null?void 0:se.items)?P.data.items:[]),p(Array.isArray((ae=C.data)==null?void 0:ae.items)?C.data.items:[]),x(Array.isArray((ne=k.data)==null?void 0:ne.items)?k.data.items:[]),y(Array.isArray((ue=B.data)==null?void 0:ue.items)?B.data.items:[]),N(Array.isArray((oe=G.data)==null?void 0:oe.items)?G.data.items:[]),F(Array.isArray((le=O.data)==null?void 0:le.items)?O.data.items:[]))}).catch(Q=>{var L,V;z&&a(((V=(L=Q==null?void 0:Q.response)==null?void 0:L.data)==null?void 0:V.message)||"Failed to load dashboard")}).finally(()=>{z&&s(!1)}),()=>{z=!1}},[]),f.useMemo(()=>{const z=n||{};return[{method:"Cash",amount:Number(z.cashAmount||0)},{method:"Card",amount:Number(z.cardAmount||0)},{method:"Mobile",amount:Number(z.mobileAmount||0)}]},[n]);const E=f.useMemo(()=>{const z=l.map(V=>String(V.terminal||"UNKNOWN")),Q=Array.from(new Set(z)),L=[{label:"Mobile Money",key:"mobile_total",color:"#3b82f6"},{label:"Cash",key:"cash_total",color:"#22c55e"},{label:"Card",key:"card_total",color:"#f59e0b"}].map(V=>({label:V.label,color:V.color,data:Object.fromEntries(Q.map(P=>{const C=l.find(k=>String(k.terminal||"UNKNOWN")===P);return[P,Number(C&&C[V.key]||0)]}))}));return{categories:Q,series:L}},[l]),W=f.useMemo(()=>d.map(z=>({label:String(z.user_label||""),total:Number(z.total||0)})),[d]),R=f.useMemo(()=>c.map(z=>({x:String(z.date),y:Number(z.total||0)})),[c]),U=f.useMemo(()=>m.map(z=>({x:String(z.ym),y:Number(z.total||0)})),[m]),T=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Y=f.useMemo(()=>{const z=new Map;for(const Q of g)z.set(Number(Q.dow||0),Number(Q.total||0));return T.map((Q,L)=>({label:Q,total:Number(z.get((L+1)%7+1)||0)}))},[g]),H=f.useMemo(()=>{const z=new Map;for(const Q of b)z.set(Number(Q.hr||0),Number(Q.total||0));return Array.from({length:16},(Q,L)=>{const V=L+7;return{x:`${String(V).padStart(2,"0")}-${String(V+1).padStart(2,"0")}`,y:Number(z.get(V)||0)}})},[b]),M=f.useMemo(()=>j.map(z=>({label:String(z.category||"Uncategorized"),value:Number(z.total||0)})),[j]),q=z=>`GH${Number(z||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/pos",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to POS"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"POS Dashboard"}),e.jsx("p",{className:"text-sm mt-1",children:"Today and recent sales analytics"})]}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"badge",children:t?"Loading":"Updated"})})]}),r?e.jsx("div",{className:"text-sm text-red-600",children:r}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-slate-50 rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Terminal Collection (Today)"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Terminals on X; Sales grouped by payment"})]}),e.jsx("div",{className:"card-body",children:e.jsx(Rse,{categories:E.categories,series:E.series,xLabel:"Terminal",yLabel:"Sales (GH)",formatY:q})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-slate-50 rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Users Sales (Today)"}),e.jsx("div",{className:"text-xs text-slate-500",children:"By cashier"})]}),e.jsx("div",{className:"card-body",children:e.jsx(Ose,{data:W,xLabel:"User",yLabel:"Sales (GH)",formatY:q})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-slate-50 rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Sales Trend"}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Last ",I," days"]})]}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-[10px]",children:"Days"}),e.jsx("input",{type:"range",min:7,max:60,value:I,onChange:z=>w(Number(z.target.value))}),e.jsx("span",{className:"badge",children:I})]}),e.jsx(ey,{points:R.slice(-I),xLabel:"Date",yLabel:"Sales (GH)",formatY:q})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-slate-50 rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Month-to-Month Sales"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Last 12 months"})]}),e.jsx("div",{className:"card-body",children:e.jsx(ey,{points:U,xLabel:"Month",yLabel:"Sales (GH)",formatY:q})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-slate-50 rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Weekday Sales"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Monday to Sunday"})]}),e.jsx("div",{className:"card-body",children:e.jsx(Pse,{data:Y,xKey:"label",yKey:"total",xLabel:"Weekday",yLabel:"Sales (GH)",formatY:q,color:"#0ea5e9"})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-slate-50 rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Hourly Sales (Today)"}),e.jsx("div",{className:"text-xs text-slate-500",children:"0708 to 2223"})]}),e.jsx("div",{className:"card-body",children:e.jsx(ey,{points:H,xLabel:"Date",yLabel:"Sales (GH)",formatY:q,color:"#2563eb",areaColor:"rgba(37,99,235,0.2)"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-slate-50 rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Sales by Item Category"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Last 30 days"})]}),e.jsx("div",{className:"card-body",children:e.jsx(Use,{data:M,label:"Category  Sales (GH)"})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-slate-50 rounded-t-lg",children:[e.jsx("div",{className:"font-semibold",children:"Top Selling Items"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Best performers (Today)"})]}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:_.map((z,Q)=>e.jsxs("tr",{children:[e.jsx("td",{children:String(z.item||"")}),e.jsx("td",{className:"text-right",children:Number(z.qty||0).toLocaleString()}),e.jsx("td",{className:"text-right font-semibold",children:q(z.amount)})]},Q))})]})})})]})]})]})}function Qse(){const[t,s]=f.useState(null),[r,a]=f.useState(new Date),{token:n}=Kr();f.useEffect(()=>{let d=!1;return Z.get("/pos/analytics/overview").then(u=>{d||s(u.data||null)}).catch(()=>{d||s(null)}),()=>{d=!0}},[n]),f.useEffect(()=>{const d=setInterval(()=>a(new Date),1e3);return()=>clearInterval(d)},[]);const i=d=>`GH${Number(d||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`,l=[{rbac_key:"today-sales",icon:"",value:i((t==null?void 0:t.todaySales)||0),label:"Today Sales",path:"/pos/reports"},{rbac_key:"total-customers",icon:"",value:String((t==null?void 0:t.totalCustomers)??0),label:"Total Customers",path:"/sales/customers"},{rbac_key:"average-order",icon:"",value:i((t==null?void 0:t.averageOrder)||0),label:"Average Order",path:"/pos/reports"},{rbac_key:"monthly-revenue",icon:"",value:i((t==null?void 0:t.monthlyRevenue)||0),label:"Monthly Revenue",path:"/finance/reports"}],o=[{title:"Transactions",features:[{name:"Sales Entry",path:"/pos/sales-entry",description:"Quick sales entry",icon:""},{name:"Start/End Business Day",path:"/pos/day-management",description:"Open/close POS business day and reconciliation",icon:""},{name:"Cash Collection",path:"/pos/cash-collection",description:"Invoices list and collection summary",icon:""},{name:"POS Invoices",path:"/pos/invoices",description:"All invoices created from sales entry",icon:""},{name:"Post to Finance",path:"/pos/post-to-finance",description:"Post POS sales as finance sales vouchers",icon:""},{name:"POS Returns",path:"/pos/returns",description:"Process sales returns and refunds",icon:""},{name:"POS Register",path:"/pos/register",description:"Transactions listing and details",icon:""}]},{title:"Setup",features:[{name:"POS Setup",path:"/pos/setup",description:"Configure terminals, shifts, payments, and settings",icon:""}]},{title:"Reports",features:[{name:"POS Reports",path:"/pos/reports",description:"Daily sales and performance reports",icon:""},{name:"Dashboard",path:"/pos/dashboard",description:"Charts and analytics for POS",icon:""}]}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("a",{href:"/pos/dashboard",className:"btn-primary",children:"Dashboard"})}),e.jsx(lo,{title:"Point of Sale",description:"Retail sales and transaction management",stats:l,sections:o,features:qse})]})}function Hse(){return e.jsxs(hl,{children:[e.jsx(tt,{path:"/",element:e.jsx(Qse,{})}),e.jsx(tt,{path:"/returns",element:e.jsx(OC,{})}),e.jsx(tt,{path:"/returns/new",element:e.jsx(OC,{})}),e.jsx(tt,{path:"/register",element:e.jsx(kse,{})}),e.jsx(tt,{path:"/sales-entry",element:e.jsx(Bse,{})}),e.jsx(tt,{path:"/cash-collection",element:e.jsx(Tse,{})}),e.jsx(tt,{path:"/invoices",element:e.jsx(Ise,{})}),e.jsx(tt,{path:"/post-to-finance",element:e.jsx(Lse,{})}),e.jsx(tt,{path:"/day-management",element:e.jsx(Dse,{})}),e.jsx(tt,{path:"/reports",element:e.jsx(vse,{})}),e.jsx(tt,{path:"/setup",element:e.jsx(Cse,{})}),e.jsx(tt,{path:"/dashboard",element:e.jsx(Mse,{})})]})}const qse=[{module_key:"pos",label:"Sales Entry",path:"/pos/sales-entry",type:"feature"},{module_key:"pos",label:"Start/End Business Day",path:"/pos/day-management",type:"feature"},{module_key:"pos",label:"Cash Collection",path:"/pos/cash-collection",type:"feature"},{module_key:"pos",label:"POS Invoices",path:"/pos/invoices",type:"feature"},{module_key:"pos",label:"Post to Finance",path:"/pos/post-to-finance",type:"feature"},{module_key:"pos",label:"POS Returns",path:"/pos/returns",type:"feature"},{module_key:"pos",label:"POS Register",path:"/pos/register",type:"feature"},{module_key:"pos",label:"POS Setup",path:"/pos/setup",type:"feature"},{module_key:"pos",label:"POS Reports",path:"/pos/reports",type:"dashboard"},{module_key:"pos",label:"Dashboard",path:"/pos/dashboard",type:"dashboard"}];function $se(){const{canPerformAction:t}=Ls(),s=[{id:1,name:"Executive Overview",description:"Enterprise KPIs across all modules",active:!0,icon:"",color:"from-emerald-600 to-emerald-800"},{id:2,name:"Sales KPIs",description:"Revenue, average order, customer growth, profitability",active:!0,icon:"",color:"from-blue-600 to-blue-800"},{id:3,name:"Purchase KPIs",description:"Spend, supplier performance, order cycle times",active:!0,icon:"",color:"from-indigo-600 to-indigo-800"},{id:4,name:"Inventory KPIs",description:"Stock valuation, turns, low-stock, aging",active:!0,icon:"",color:"from-purple-600 to-purple-800"},{id:5,name:"Finance KPIs",description:"P&L highlights, cash flow, ratios, ledger health",active:!0,icon:"",color:"from-rose-600 to-rose-800"},{id:6,name:"Human Resources KPIs",description:"Headcount, attendance, payroll, attrition",active:!0,icon:"",color:"from-teal-600 to-teal-800"},{id:7,name:"POS KPIs",description:"Terminal sales, peak hours, basket size, payment mix",active:!0,icon:"",color:"from-orange-600 to-orange-800"},{id:8,name:"Production KPIs",description:"WO throughput, yield, downtime, OEE",active:!0,icon:"",color:"from-yellow-600 to-yellow-700"},{id:9,name:"Project Management KPIs",description:"Progress, burn-down, cycle time, blockers",active:!0,icon:"",color:"from-cyan-600 to-cyan-800"},{id:10,name:"Maintenance KPIs",description:"Work orders, MTTR, compliance, asset health",active:!0,icon:"",color:"from-lime-600 to-lime-700"},{id:11,name:"Administration KPIs",description:"User activity, permissions, audit status",active:!0,icon:"",color:"from-slate-600 to-slate-800"},{id:12,name:"Custom Analytics",description:"Cross-module insights and ad-hoc dashboards",active:!0,icon:"",color:"from-fuchsia-600 to-fuchsia-800"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Dashboards"}),e.jsx("p",{className:"text-sm mt-1",children:"Saved KPI dashboards covering all modules"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/business-intelligence",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/business-intelligence/dashboards/new",className:"btn-success",children:"+ New Dashboard"})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(r=>e.jsx("div",{className:`rounded-xl shadow-erp border border-slate-200 dark:border-slate-700 overflow-hidden bg-gradient-to-br ${r.color} text-white`,children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-2xl",children:r.icon}),e.jsx("span",{className:r.active?"badge badge-success":"badge badge-error",children:r.active?"Active":"Inactive"})]}),e.jsx("div",{className:"mt-3 font-bold text-lg",children:r.name}),e.jsx("div",{className:"mt-1 text-sm opacity-90",children:r.description}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[t("business-intelligence:dashboards","view")&&e.jsx(Re,{to:`/business-intelligence/dashboards/${r.id}?mode=view`,className:"btn btn-sm btn-secondary",children:"View"}),t("business-intelligence:dashboards","edit")&&e.jsx(Re,{to:`/business-intelligence/dashboards/${r.id}?mode=edit`,className:"btn btn-sm btn-secondary",children:"Edit"})]})]})},r.id))})]})}function QC(){var I,w,E,W,R,U,T;const t=ps(),{id:s}=Ps(),r=!!s,{search:a}=Ur(),i=new URLSearchParams(a).get("mode")==="view",[l,o]=f.useState(!1),[d,u]=f.useState({name:"",description:"",active:!0}),[c,h]=f.useState(null),[m,p]=f.useState([]),[g,x]=f.useState([]),[b,y]=f.useState([]);f.useEffect(()=>{r&&(o(!0),setTimeout(()=>{u({name:"Executive Overview",description:"High-level KPIs across modules",active:!0}),o(!1)},150))},[r]),f.useEffect(()=>{if(!i)return;let Y=!1;return o(!0),Promise.all([Z.get("/bi/dashboards").catch(()=>({data:{}})),Z.get("/bi/sales-report").catch(()=>({data:{items:[]}})),Z.get("/bi/purchase-report").catch(()=>({data:{items:[]}})),Z.get("/bi/inventory-report").catch(()=>({data:{items:[]}}))]).then(([H,M,q,z])=>{var L,V,P;if(Y)return;const Q=H.data||{};h(Q.summary||null),p(Array.isArray((L=M.data)==null?void 0:L.items)?M.data.items:[]),x(Array.isArray((V=q.data)==null?void 0:V.items)?q.data.items:[]),y(Array.isArray((P=z.data)==null?void 0:P.items)?z.data.items:[])}).finally(()=>{Y||o(!1)}),()=>{Y=!0}},[i]);function j(Y,H){u(M=>({...M,[Y]:H}))}async function N(Y){Y.preventDefault(),o(!0);try{t("/business-intelligence/dashboards")}finally{o(!1)}}function _(Y){return`${Number(Y||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}function F({data:Y}){const H=Math.max(1,...Y.map(M=>Number(M.total||M.count||0)));return e.jsx("div",{className:"flex items-end gap-1 h-24",children:Y.slice().reverse().map((M,q)=>{const z=Number(M.total||M.count||0),Q=Math.max(4,Math.round(z/H*96));return e.jsx("div",{className:"w-3 bg-brand-500/70 rounded-t",style:{height:`${Q}px`},title:`${M.date||""}  ${_(M.total||0)}  ${M.count||0}`},q)})})}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/business-intelligence/dashboards",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Dashboards"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:i?"Executive Overview":r?"Edit Dashboard":"New Dashboard"})]}),i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Sales (30 days)"}),e.jsx("div",{className:"text-2xl font-bold mt-2",children:_(((I=c==null?void 0:c.sales)==null?void 0:I.total)||0)}),e.jsxs("div",{className:"text-xs mt-1",children:[((w=c==null?void 0:c.sales)==null?void 0:w.documents)||0," documents"]})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Purchases (30 days)"}),e.jsx("div",{className:"text-2xl font-bold mt-2",children:_(((E=c==null?void 0:c.purchase)==null?void 0:E.total)||0)}),e.jsxs("div",{className:"text-xs mt-1",children:[((W=c==null?void 0:c.purchase)==null?void 0:W.documents)||0," orders"]})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Inventory Items"}),e.jsx("div",{className:"text-2xl font-bold mt-2",children:Number(((R=c==null?void 0:c.inventory)==null?void 0:R.items)||0).toLocaleString()}),e.jsxs("div",{className:"text-xs mt-1",children:[Number(((U=c==null?void 0:c.inventory)==null?void 0:U.quantity)||0).toLocaleString()," units"]})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Active Employees"}),e.jsx("div",{className:"text-2xl font-bold mt-2",children:Number(((T=c==null?void 0:c.hr)==null?void 0:T.employees)||0).toLocaleString()}),e.jsx("div",{className:"text-xs mt-1",children:"HR status"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-slate-50 rounded-t-lg",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:"Sales Trend"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Last 30 days"})]})}),e.jsxs("div",{className:"card-body",children:[e.jsx(F,{data:m}),e.jsx("div",{className:"mt-3 text-xs text-slate-500",children:"Bars show totals by day"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-slate-50 rounded-t-lg",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:"Purchase Trend"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Last 30 days"})]})}),e.jsxs("div",{className:"card-body",children:[e.jsx(F,{data:g}),e.jsx("div",{className:"mt-3 text-xs text-slate-500",children:"Bars show totals by day"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-slate-50 rounded-t-lg",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Low Stock Watchlist"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Least available items"})]}),e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{className:"text-right",children:"Reorder"}),e.jsx("th",{className:"text-right",children:"Max"})]})}),e.jsxs("tbody",{children:[b.map((Y,H)=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:Y.item_code}),e.jsx("td",{children:Y.item_name}),e.jsx("td",{className:"text-right",children:Number(Y.qty||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(Y.reorder_level||0).toLocaleString()}),e.jsx("td",{className:"text-right",children:Number(Y.max_stock_level||0).toLocaleString()})]},H)),b.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center text-slate-500 text-sm",children:"No low stock items"})}):null]})]})})]})]}):e.jsx("form",{onSubmit:N,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx("fieldset",{disabled:i,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Name *"}),e.jsx("input",{className:"input",value:d.name,onChange:Y=>j("name",Y.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:d.active?"1":"0",onChange:Y=>j("active",Y.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("input",{className:"input",value:d.description,onChange:Y=>j("description",Y.target.value)})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/business-intelligence/dashboards",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",disabled:l||i,children:l?"Saving...":"Save"})]})]})})})]})}function Vse(){const{canPerformAction:t}=Ls(),s=[{id:1,name:"Sales Summary",module:"Sales",active:!0},{id:2,name:"Voucher Register",module:"Finance",active:!0}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Saved Reports"}),e.jsx("p",{className:"text-sm mt-1",children:"Report definitions and schedules"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/business-intelligence",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/business-intelligence/reports/new",className:"btn-success",children:"+ New Report"})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Module"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium",children:r.name}),e.jsx("td",{children:r.module}),e.jsx("td",{children:r.active?e.jsx("span",{className:"badge badge-success",children:"Active"}):e.jsx("span",{className:"badge badge-error",children:"Inactive"})}),e.jsxs("td",{children:[t("business-intelligence:reports","view")&&e.jsx(Re,{to:`/business-intelligence/reports/${r.id}?mode=view`,className:"text-brand hover:text-brand-600 text-sm font-medium",children:"View"}),t("business-intelligence:reports","edit")&&e.jsx(Re,{to:`/business-intelligence/reports/${r.id}?mode=edit`,className:"text-blue-600 hover:text-blue-700 text-sm font-medium ml-2",children:"Edit"})]})]},r.id))})]})})})]})}function HC(){const t=ps(),{id:s}=Ps(),r=!!s,[a,n]=f.useState(!1),[i,l]=f.useState({name:"",module:"Sales",query:"",active:!0});f.useEffect(()=>{r&&(n(!0),setTimeout(()=>{l({name:"Sales Summary",module:"Sales",query:"SELECT ...",active:!0}),n(!1)},150))},[r]);function o(u,c){l(h=>({...h,[u]:c}))}async function d(u){u.preventDefault(),n(!0);try{t("/business-intelligence/reports")}finally{n(!1)}}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/business-intelligence/reports",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Reports"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:r?"Edit Report":"New Report"})]}),e.jsx("form",{onSubmit:d,children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Name *"}),e.jsx("input",{className:"input",value:i.name,onChange:u=>o("name",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Module"}),e.jsxs("select",{className:"input",value:i.module,onChange:u=>o("module",u.target.value),children:[e.jsx("option",{value:"Sales",children:"Sales"}),e.jsx("option",{value:"Finance",children:"Finance"}),e.jsx("option",{value:"Inventory",children:"Inventory"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Query/Definition"}),e.jsx("input",{className:"input",value:i.query,onChange:u=>o("query",u.target.value),placeholder:"Placeholder"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:i.active?"1":"0",onChange:u=>o("active",u.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Re,{to:"/business-intelligence/reports",className:"btn-success",children:"Cancel"}),e.jsx("button",{className:"btn-success",disabled:a,children:a?"Saving...":"Save"})]})]})})})]})}function qC(){const t=[{title:"Executive Dashboard",description:"KPIs across ERP modules (placeholder)"},{title:"Trend Analysis",description:"Time series trends (placeholder)"},{title:"Operational KPIs",description:"Daily operational performance (placeholder)"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-header bg-brand text-white rounded-t-lg",children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-brand-300",children:"Business Intelligence Reports"}),e.jsx("p",{className:"text-sm mt-1",children:"Dashboards and analytics"})]})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map((s,r)=>e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:[e.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100",children:s.title}),e.jsx("div",{className:"text-sm mt-1",children:s.description})]},r))})})})]})}function Wse(){const[t,s]=Is.useState([{rbac_key:"active-dashboards",icon:"",value:"15",label:"Active Dashboards",change:"2 created this week",changeType:"positive",path:"/business-intelligence/dashboards"},{rbac_key:"scheduled-reports",icon:"",value:"8",label:"Scheduled Reports",change:"Running daily",changeType:"neutral",path:"/business-intelligence/reports"},{rbac_key:"data-sources",icon:"",value:"Connected",label:"Data Sources",change:"All systems online",changeType:"positive",path:"/business-intelligence/bi-reports"}]);Is.useEffect(()=>{let a=!0;async function n(){var i,l,o,d,u,c,h,m,p;try{const g=await Z.get("/bi/dashboards"),x=Number(((o=(l=(i=g==null?void 0:g.data)==null?void 0:i.summary)==null?void 0:l.bi)==null?void 0:o.active_dashboards)||0),b=Number(((c=(u=(d=g==null?void 0:g.data)==null?void 0:d.summary)==null?void 0:u.bi)==null?void 0:c.scheduled_reports)||0),y=String(((p=(m=(h=g==null?void 0:g.data)==null?void 0:h.summary)==null?void 0:m.bi)==null?void 0:p.data_sources_status)||"").trim();a&&s(j=>{const N=[...j];return N[0]={...N[0],value:String(x)},N[1]={...N[1],value:String(b)},N[2]={...N[2],value:y||N[2].value},N})}catch{}}return n(),()=>{a=!1}},[]);const r=[{title:"Dashboards",features:[{name:"Dashboard List",path:"/business-intelligence/dashboards",description:"Manage KPI dashboards",icon:""},{name:"New Dashboard",path:"/business-intelligence/dashboards/new",description:"Create a new dashboard",icon:""},{name:"Analytics",path:"/business-intelligence/analytics",description:"Interactive analytics workspace",icon:""}]},{title:"Reports",features:[{name:"Saved Reports",path:"/business-intelligence/reports",description:"Report definitions and schedules",icon:""},{name:"New Report",path:"/business-intelligence/reports/new",description:"Create a new report definition",icon:""},{name:"BI Reports",path:"/business-intelligence/bi-reports",description:"Quick report shortcuts",icon:""}]}];return e.jsx(lo,{title:"Business Intelligence",description:"Analytics, reporting, and data insights",stats:t,sections:r,features:Kse})}function Gse(){return e.jsxs(hl,{children:[e.jsx(tt,{path:"/",element:e.jsx(Wse,{})}),e.jsx(tt,{path:"/dashboards",element:e.jsx($se,{})}),e.jsx(tt,{path:"/dashboards/new",element:e.jsx(QC,{})}),e.jsx(tt,{path:"/dashboards/:id",element:e.jsx(QC,{})}),e.jsx(tt,{path:"/reports",element:e.jsx(Vse,{})}),e.jsx(tt,{path:"/reports/new",element:e.jsx(HC,{})}),e.jsx(tt,{path:"/reports/:id",element:e.jsx(HC,{})}),e.jsx(tt,{path:"/bi-reports",element:e.jsx(qC,{})}),e.jsx(tt,{path:"/analytics",element:e.jsx(qC,{})})]})}const Kse=[{module_key:"business-intelligence",label:"Dashboard List",path:"/business-intelligence/dashboards",type:"dashboard"},{module_key:"business-intelligence",label:"New Dashboard",path:"/business-intelligence/dashboards/new",type:"dashboard"},{module_key:"business-intelligence",label:"Analytics",path:"/business-intelligence/analytics",type:"dashboard"},{module_key:"business-intelligence",label:"Saved Reports",path:"/business-intelligence/reports",type:"dashboard"},{module_key:"business-intelligence",label:"New Report",path:"/business-intelligence/reports/new",type:"dashboard"},{module_key:"business-intelligence",label:"BI Reports",path:"/business-intelligence/bi-reports",type:"dashboard"}];function zse(){const[t,s]=f.useState([]),[r,a]=f.useState(!0),[n,i]=f.useState(""),[l,o]=f.useState(""),[d,u]=f.useState(null),{canPerformAction:c}=Ls();f.useEffect(()=>{let m=!0;return(async()=>{var p,g,x;try{a(!0);const b=await Z.get("/purchase/service-requests"),y=Array.isArray((p=b.data)==null?void 0:p.items)?b.data.items:[];m&&s(y)}catch(b){const y=((x=(g=b==null?void 0:b.response)==null?void 0:g.data)==null?void 0:x.message)||"Failed to load service requests";i(y),ct.error(y)}finally{m&&a(!1)}})(),()=>{m=!1}},[]);const h=f.useMemo(()=>{const m=String(l||"").toLowerCase();return m?t.filter(p=>String(p.request_no||"").toLowerCase().includes(m)||String(p.requester_company||"").toLowerCase().includes(m)||String(p.requester_full_name||"").toLowerCase().includes(m)||String(p.service_type||"").toLowerCase().includes(m)||String(p.status||"").toLowerCase().includes(m)):t},[t,l]);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-semibold",children:"Service Requests"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/service-management",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/service-management/service-requests/new",className:"btn-success",children:"+ New Request"})]})]})}),e.jsxs("div",{className:"card-body",children:[n?e.jsx("div",{className:"text-sm text-red-600 mb-4",children:n}):null,e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by no, customer, service, status...",className:"input max-w-md",value:l,onChange:m=>o(m.target.value)})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Priority"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[r?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-8 text-slate-500 dark:text-slate-400",children:"Loading..."})}):null,!r&&!h.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-8 text-slate-500",children:"No service requests found"})}):null,!r&&h.map(m=>e.jsxs("tr",{children:[e.jsx("td",{children:m.request_no}),e.jsx("td",{children:m.request_date}),e.jsx("td",{children:m.requester_company||m.requester_full_name}),e.jsx("td",{children:String(m.service_type||"").replace(/_/g," ")}),e.jsx("td",{className:"capitalize",children:m.priority}),e.jsx("td",{children:m.status}),e.jsxs("td",{className:"whitespace-nowrap",children:[c("service-management:service-requests","view")&&e.jsx("button",{type:"button",className:"btn-secondary btn-sm mr-2",onClick:async()=>{var p,g,x;try{const b=await Z.get(`/purchase/service-requests/${m.id}`);u(((p=b.data)==null?void 0:p.item)||null)}catch(b){ct.error(((x=(g=b==null?void 0:b.response)==null?void 0:g.data)==null?void 0:x.message)||"Failed to load request")}},children:"View"}),c("service-management:service-requests","edit")&&e.jsx(Re,{to:`/service-management/service-requests/new?id=${m.id}`,className:"btn-primary btn-sm",children:"Edit"})]})]},m.id))]})]})})]})]}),d&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/40 z-50",children:e.jsxs("div",{className:"card w-full max-w-lg",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"font-semibold",children:"Service Request Details"})}),e.jsxs("div",{className:"card-body space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Request No"}),e.jsx("div",{className:"text-sm",children:d.request_no})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Date"}),e.jsx("div",{className:"text-sm",children:d.request_date})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Customer"}),e.jsx("div",{className:"text-sm",children:d.requester_full_name})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Address"}),e.jsx("div",{className:"text-sm",children:d.requester_address})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Email"}),e.jsx("div",{className:"text-sm",children:d.requester_email})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Phone"}),e.jsx("div",{className:"text-sm",children:d.requester_phone})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Service Type"}),e.jsx("div",{className:"text-sm",children:d.service_type})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Priority"}),e.jsx("div",{className:"text-sm capitalize",children:d.priority})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Title"}),e.jsx("div",{className:"text-sm",children:d.request_title})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Description"}),e.jsx("div",{className:"text-sm",children:d.description})]})]}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>u(null),children:"Close"})})]})]})})]})}function ty({number:t,title:s}){return e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-100 text-brand-700 flex items-center justify-center font-semibold",children:t}),e.jsx("div",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:s})]})}function Yse(){const t=ps(),s=Ur();function r(M){return M?(typeof M=="string"?M:(()=>{try{return new Date(M).toISOString()}catch{return String(M)}})()).slice(0,10):""}const[a,n]=f.useState({customerType:"",customerId:"",accountEmail:"",email:"",phone:"",company:"",address:"",city:"",state:"",country:"",serviceType:"",department:"",requestTitle:"",description:"",urgency:"normal",preferredDate:"",preferredTime:"",contactMethod:"email",recurring:"no",additionalNotes:"",terms:!1}),[i,l]=f.useState([]),[o,d]=f.useState([]),[u,c]=f.useState([]),[h,m]=f.useState(!1),[p,g]=f.useState(!1),[x,b]=f.useState({id:null,request_no:""}),[y,j]=f.useState(!1),[N,_]=f.useState([]),F=f.useMemo(()=>{const M=["customerType","serviceType","requestTitle","description","urgency","terms"];return a.customerType==="existing"?M.push("customerId"):M.push("company","email","phone"),M},[a.customerType]),I=f.useMemo(()=>{let M=0;for(const q of F){const z=a[q];q==="terms"?z===!0&&M++:typeof z=="string"&&z.trim()!==""&&M++}return Math.round(M/F.length*100)},[a,F]);function w(M,q){n(z=>({...z,[M]:q}))}f.useEffect(()=>{let M=!0;async function q(){var Q;try{const L=await Z.get("/sales/customers"),V=Array.isArray((Q=L.data)==null?void 0:Q.items)?L.data.items:[];M&&l(V)}catch{M&&l([])}}async function z(Q=""){var L;try{const V=await Z.get("/sales/prospects",{params:{q:Q||null}}),P=Array.isArray((L=V.data)==null?void 0:L.items)?V.data.items:[];M&&d(P)}catch{M&&d([])}}return a.customerType==="existing"&&q(),z(""),()=>{M=!1}},[a.customerType]),f.useEffect(()=>{let M=!0;async function q(){var z;try{const Q=await Z.get("/admin/departments"),L=Array.isArray((z=Q.data)==null?void 0:z.items)?Q.data.items:[];M&&_(L)}catch{M&&_([])}}return q(),()=>{M=!1}},[]),f.useEffect(()=>{const q=new URLSearchParams(s.search).get("id");let z=!1;async function Q(){var L;try{if(!q)return;const P=(L=(await Z.get(`/purchase/service-requests/${q}`)).data)==null?void 0:L.item;if(!P||z)return;n(C=>({...C,customerType:"general",customerId:"",accountEmail:P.requester_email||"",email:P.requester_email||"",phone:P.requester_phone||"",company:P.requester_full_name||"",address:P.requester_address||"",city:"",state:"",country:"",serviceType:P.service_type||"",department:P.department||"",requestTitle:P.request_title||"",description:P.description||"",urgency:P.priority==="high"?"emergency":P.priority==="medium"?"urgent":"normal",preferredDate:r(P.preferred_date)||"",preferredTime:P.preferred_time||"",contactMethod:P.contact_method||"email",recurring:P.recurring||"no",additionalNotes:P.additional_notes||"",terms:!!P.agreed_terms}))}catch{}}return Q(),()=>{z=!0}},[s.search]);function E(M){const q=String(M||"");w("customerId",q);const z=i.find(V=>String(V.id)===q)||i.find(V=>String(V.customer_code||"")===q)||null,Q=z.email||a.email||"",L=z.phone||z.mobile||a.phone||"";n(V=>({...V,company:z.customer_name||V.company||"",email:Q,phone:L,accountEmail:z.email||V.accountEmail||"",address:z.address||V.address||"",city:z.city||V.city||"",state:z.state||V.state||"",country:z.country||V.country||""}))}function W(M){const q=Array.from(M.target.files||[]);R(q),M.target.value=""}function R(M){const q=[...u];for(const z of M){if(z.size>10*1024*1024){alert(`File ${z.name} is too large. Max size is 10MB.`);continue}q.push(z)}c(q)}function U(M){c(q=>q.filter(z=>z.name!==M))}function T(){const q=Date.now().toString().slice(-6),z=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`SR-${q}-${z}`}function Y(){n({email:"",phone:"",company:"",address:"",city:"",state:"",country:"",serviceType:"",department:"",requestTitle:"",description:"",urgency:"normal",preferredDate:"",preferredTime:"",contactMethod:"email",recurring:"no",additionalNotes:"",terms:!1}),c([])}function H(M){if(M.preventDefault(),F.filter(O=>{const K=a[O];return O==="terms"?!K:!String(K||"").trim()}).length){alert("Please complete all required fields.");return}if(y)return;j(!0);const z=String(a.company||"").trim(),L=[String(a.address||"").trim(),String(a.city||"").trim(),String(a.state||"").trim(),String(a.country||"").trim()].filter(Boolean).join(", "),P={normal:"low",urgent:"medium",emergency:"high"}[String(a.urgency||"normal")]||"low",C={customer_type:a.customerType,customer_id:a.customerId||null,account_email:a.accountEmail||null,full_name:z,email:a.email,phone:a.phone,company:a.company||null,address:L||null,service_type:String(a.serviceType||"").trim(),department:a.department||null,request_title:a.requestTitle,description:a.description,priority:P,preferred_date:(()=>{const O=r(a.preferredDate);return O||null})(),preferred_time:a.preferredTime||null,contact_method:a.contactMethod||"email",recurring:a.recurring||"no",additional_notes:a.additionalNotes||null,agreed_terms:a.terms?1:0,attachments:u.map(O=>({name:O.name,size:O.size,type:O.type})),prospect:{prospect_customer:a.company||null,address:a.address||null,city:a.city||null,state:a.state||null,country:a.country||null,telephone:a.phone||null,email:a.email||null}},B=new URLSearchParams(s.search).get("id");(B?Z.put(`/purchase/service-requests/${B}`,C):Z.post("/purchase/service-requests",C)).then(O=>{var J;const K=((J=O==null?void 0:O.data)==null?void 0:J.request_no)||"";ct.success(K?`Service request ${K} submitted successfully`:"Service request submitted successfully"),t("/service-management/service-requests")}).catch(O=>{var K,J;ct.error(((J=(K=O==null?void 0:O.response)==null?void 0:K.data)==null?void 0:J.message)||"Failed to submit request. Please try again.")}).finally(()=>{j(!1)})}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Re,{to:"/service-management/service-requests",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Request List"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mt-2",children:"Service Request"}),e.jsx("p",{className:"text-sm mt-1",children:"Submit your service request and we will get back to you shortly"})]}),e.jsxs("div",{className:"w-64",children:[e.jsx("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-brand-600 transition-all",style:{width:`${I}%`}})}),e.jsxs("div",{className:"text-xs mt-1 text-right",children:[I,"%"]})]})]}),e.jsxs("form",{onSubmit:H,className:"space-y-6",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx(ty,{number:"0",title:"Customer Type"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",className:"rounded-lg border px-4 py-3 text-left "+(a.customerType==="existing"?"bg-brand text-white border-brand":"border-slate-300 bg-white"),onClick:()=>w("customerType","existing"),children:[e.jsx("div",{className:"text-sm font-semibold",children:"Existing Customer"}),e.jsx("div",{className:"text-xs",children:"You have an account with us"})]}),e.jsxs("button",{type:"button",className:"rounded-lg border px-4 py-3 text-left "+(a.customerType==="general"?"bg-brand text-white border-brand":"border-slate-300 bg-white"),onClick:()=>w("customerType","general"),children:[e.jsx("div",{className:"text-sm font-semibold",children:"New Customer"}),e.jsx("div",{className:"text-xs",children:"First time requesting service"})]})]}),String(a.customerType||"")===""&&e.jsx("div",{className:"text-xs text-red-600",children:"Please select a customer type"}),a.customerType==="existing"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Customer ID ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{className:"input",value:a.customerId,onChange:M=>E(M.target.value),children:[e.jsx("option",{value:"",children:"Select Customer"}),i.map(M=>e.jsx("option",{value:M.id,children:M.customer_name},M.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Account Email"}),e.jsx("input",{className:"input",type:"email",value:a.accountEmail,readOnly:!0,placeholder:"your.email@example.com"})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx(ty,{number:"2",title:"Company & Address"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.customerType==="general"&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Company"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"input",list:"prospectsList",value:a.company,onChange:async M=>{var z;const q=M.target.value;w("company",q);try{const Q=await Z.get("/sales/prospects",{params:{q:q||null}}),L=Array.isArray((z=Q.data)==null?void 0:z.items)?Q.data.items:[];d(L)}catch{}},placeholder:"Requester / Company"}),e.jsx("datalist",{id:"prospectsList",children:o.map(M=>e.jsx("option",{value:M.prospect_customer},`${M.company_id}-${M.id}`))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Address"}),e.jsx("input",{className:"input",value:a.address,onChange:M=>w("address",M.target.value),placeholder:"123 Main Street"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"City"}),e.jsx("input",{className:"input",value:a.city,onChange:M=>w("city",M.target.value),placeholder:"Accra"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"State"}),e.jsx("input",{className:"input",value:a.state,onChange:M=>w("state",M.target.value),placeholder:"Greater Accra"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Country"}),e.jsx("input",{className:"input",value:a.country,onChange:M=>w("country",M.target.value),placeholder:"Ghana"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Email ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{className:"input",type:"email",value:a.email,onChange:M=>w("email",M.target.value),placeholder:"customer@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Telephone"}),e.jsx("input",{className:"input",value:a.phone,onChange:M=>w("phone",M.target.value),placeholder:"+233 ..."})]})]}),e.jsx(ty,{number:"3",title:"Service Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Service Type"}),e.jsxs("select",{className:"input",value:a.serviceType,onChange:M=>w("serviceType",M.target.value),children:[e.jsx("option",{value:"",children:"Select service"}),e.jsx("option",{value:"general",children:"General Services"}),e.jsx("option",{value:"installation",children:"Installation"}),e.jsx("option",{value:"maintenance",children:"Maintenance"}),e.jsx("option",{value:"repair",children:"Repair"}),e.jsx("option",{value:"consultation",children:"Consultation"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Department"}),e.jsxs("select",{className:"input",value:a.department,onChange:M=>w("department",M.target.value),children:[e.jsx("option",{value:"",children:"Select department"}),N.map(M=>e.jsx("option",{value:M.name,children:M.name},M.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"label",children:["Request Title ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{className:"input",value:a.requestTitle,onChange:M=>w("requestTitle",M.target.value),placeholder:"Brief title of the request"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"label",children:["Description ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("textarea",{className:"input",value:a.description,onChange:M=>w("description",M.target.value),rows:4,placeholder:"Detailed description of the issue or service needed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Urgency"}),e.jsxs("select",{className:"input",value:a.urgency,onChange:M=>w("urgency",M.target.value),children:[e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"urgent",children:"Urgent"}),e.jsx("option",{value:"emergency",children:"Emergency"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Preferred Date"}),e.jsx("input",{className:"input",type:"date",value:a.preferredDate,onChange:M=>w("preferredDate",M.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Preferred Time"}),e.jsx("input",{className:"input",type:"time",value:a.preferredTime,onChange:M=>w("preferredTime",M.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Preferred Contact Method"}),e.jsxs("select",{className:"input",value:a.contactMethod,onChange:M=>w("contactMethod",M.target.value),children:[e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"phone",children:"Phone"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Recurring Service"}),e.jsxs("select",{className:"input",value:a.recurring,onChange:M=>w("recurring",M.target.value),children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"quarterly",children:"Quarterly"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Additional Notes"}),e.jsx("textarea",{className:"input",value:a.additionalNotes,onChange:M=>w("additionalNotes",M.target.value),rows:3,placeholder:"Any additional information"})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:a.terms,onChange:M=>w("terms",M.target.checked)}),"I agree to the terms and conditions"]})})]})]})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-semibold",children:"Attachments (optional)"}),e.jsxs("div",{className:"text-xs text-slate-200",children:["Ref: ",x.request_no||T()]})]})}),e.jsxs("div",{className:"card-body space-y-3",children:[e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center transition "+(h?"border-brand-400 bg-brand-50":"border-slate-300"),onDragOver:M=>{M.preventDefault(),m(!0)},onDragLeave:M=>{M.preventDefault(),m(!1)},onDrop:M=>{M.preventDefault(),m(!1);const q=Array.from(M.dataTransfer.files||[]);R(q)},children:[e.jsx("div",{className:"text-sm",children:"Drag & drop files here or click to upload"}),e.jsx("div",{className:"mt-3",children:e.jsx("input",{type:"file",multiple:!0,onChange:W})})]}),u.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Selected Files"}),e.jsx("div",{className:"space-y-2",children:u.map(M=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border border-slate-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:M.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:[(M.size/1024).toFixed(1)," KB "," ",M.type||"unknown"]})]}),e.jsx("button",{type:"button",className:"btn-danger",onClick:()=>U(M.name),children:"Remove"})]},M.name))})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>Y(),children:"Reset"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:y,children:"Submit Request"})]})]}),p&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/40 z-50",children:e.jsxs("div",{className:"card w-full max-w-md",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"font-semibold",children:"Request Submitted"})}),e.jsxs("div",{className:"card-body space-y-3",children:[e.jsx("div",{className:"text-sm",children:"Thank you. Your service request has been submitted successfully."}),e.jsxs("div",{className:"text-sm",children:["Reference No: ",x.request_no||"(pending)"]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>g(!1),children:"Close"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{g(!1),Y()},children:"New Request"})]})]})]})})]})}function sy(t){try{const s=t instanceof Date?t:new Date(t),r=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0");return`${r}-${a}-${n}`}catch{return""}}function $C({html:t}){return e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",dangerouslySetInnerHTML:{__html:t}})})}function VC(){const t=ps(),s=Ps(),r=s.id?String(s.id):"",[a,n]=f.useState("internal"),[i,l]=f.useState(""),o=new Date().toISOString().split("T")[0],[d,u]=f.useState([]),[c,h]=f.useState([]),[m,p]=f.useState([]),[g,x]=f.useState(""),[b,y]=f.useState(!1),[j,N]=f.useState(""),[_,F]=f.useState({custId:"",accEmail:""}),[I,w]=f.useState({customer:"",email:"",phone:""}),[E,W]=f.useState({servCat:"",items:[]}),[R,U]=f.useState({addr:"",date:"",time:""}),[T,Y]=f.useState({dept:"",cost:""}),[H,M]=f.useState({name:"",title:"",email:"",phone:""}),[q,z]=f.useState({name:"",id:"",email:"",phone:""}),[Q,L]=f.useState([]),[V,P]=f.useState({cat:"",scope:""}),[C,k]=f.useState({loc:"",start:"",end:""}),[B,G]=f.useState({estCost:"",currency:"USD"}),[O,K]=f.useState([]),[J,te]=f.useState([]),[se,ae]=f.useState([]),[ne,ue]=f.useState([]),[oe,le]=f.useState([]);function X(){return`ORD-${Date.now().toString().slice(-8)}`}f.useEffect(()=>{let De=!0;async function Te(){var ye;try{const Ae=await Z.get("/purchase/service-requests"),be=Array.isArray((ye=Ae.data)==null?void 0:ye.items)?Ae.data.items:[];De&&u(be)}catch{De&&u([])}}async function Ce(){var ye;try{const Ae=await Z.get("/inventory/items"),Ee=(Array.isArray((ye=Ae.data)==null?void 0:ye.items)?Ae.data.items:[]).filter(dt=>{const mt=String(dt.item_type||"").toUpperCase(),it=String(dt.item_type_name||"").toLowerCase(),ht=String(dt.service_item||"").toUpperCase();return mt==="SERVICE"||it.includes("service")||ht==="Y"||Number(dt.service_item)===1});De&&h(Ee)}catch{De&&h([])}}Te(),Ce();async function Pe(){var ye;try{const Ae=await Z.get("/purchase/suppliers",{params:{contractor:"Y"}}),be=Array.isArray((ye=Ae.data)==null?void 0:ye.items)?Ae.data.items:[];L(be)}catch{L([])}}Pe();async function fe(){var ye;try{const Ae=await Z.get("/admin/departments"),be=Array.isArray((ye=Ae.data)==null?void 0:ye.items)?Ae.data.items:[];De&&K(be)}catch{De&&K([])}}async function he(){var ye;try{const Ae=await Z.get("/finance/cost-centers"),be=Array.isArray((ye=Ae.data)==null?void 0:ye.items)?Ae.data.items:[];De&&te(be)}catch{De&&te([])}}async function Ue(){var ye;try{const Ae=await Z.get("/purchase/service-setup/categories"),be=Array.isArray((ye=Ae.data)==null?void 0:ye.items)?Ae.data.items:[];De&&ue(be)}catch{De&&ue([])}}async function Ye(){var ye;try{const Ae=await Z.get("/purchase/service-setup/work-locations"),be=Array.isArray((ye=Ae.data)==null?void 0:ye.items)?Ae.data.items:[];De&&le(be)}catch{De&&le([])}}async function Ke(){var ye;try{const Ae=await Z.get("/finance/currencies"),be=Array.isArray((ye=Ae.data)==null?void 0:ye.items)?Ae.data.items:[];De&&ae(be)}catch{De&&ae([])}}fe(),he(),Ue(),Ye(),Ke();async function Je(){var ye;try{const Ae=await Z.get("/purchase/service-setup/supervisors"),be=Array.isArray((ye=Ae.data)==null?void 0:ye.items)?Ae.data.items:[];De&&p(be)}catch{De&&p([])}}Je();async function xe(){var ye,Ae;if(r)try{const be=await Z.get(`/purchase/service-orders/${r}`),Ee=((ye=be==null?void 0:be.data)==null?void 0:ye.item)||{},dt=Array.isArray((Ae=be==null?void 0:be.data)==null?void 0:Ae.lines)?be.data.lines:[],mt=String(Ee.order_type||"INTERNAL").toUpperCase();n(mt==="EXTERNAL"?"external":"internal"),l(Ee.order_no||""),mt==="INTERNAL"?(w({customer:Ee.customer_name||"",email:Ee.customer_email||"",phone:Ee.customer_phone||""}),W({servCat:Ee.service_category||"",items:dt.map(it=>({id:crypto.randomUUID(),item_id:it.item_id||"",desc:it.description||"",qty:Number(it.qty||0),price:Number(it.unit_price||0),sub:Number(it.line_total||0)}))}),U({addr:Ee.schedule_address||Ee.work_location||"",date:sy(Ee.schedule_date||Ee.order_date||""),time:Ee.schedule_time||""})):(Y({dept:Ee.department||"",cost:Ee.cost_center||""}),M({name:Ee.requestor_name||"",title:Ee.requestor_title||"",email:Ee.requestor_email||"",phone:Ee.requestor_phone||""}),z({name:Ee.contractor_name||"",id:Ee.contractor_code||"",email:Ee.contractor_email||"",phone:Ee.contractor_phone||""}),P({cat:Ee.ext_category||"",scope:Ee.scope_of_work||""}),k({loc:Ee.work_location||"",start:sy(Ee.start_date||""),end:sy(Ee.end_date||"")}),G({estCost:Ee.estimated_cost||"",currency:Ee.currency_code||"USD"})),Ee.assigned_supervisor_user_id&&x(String(Ee.assigned_supervisor_user_id))}catch{}}return xe(),r||W(ye=>Array.isArray(ye.items)&&ye.items.length?ye:{...ye,items:[{id:crypto.randomUUID(),item_id:"",desc:"",qty:1,price:0,sub:0}]}),()=>{De=!1}},[]);async function me(De){var Ce;const Te=Number(De);if(!(!Number.isFinite(Te)||Te<=0))try{const fe=((Ce=(await Z.get(`/purchase/service-requests/${Te}`)).data)==null?void 0:Ce.item)||{},he=String(fe.requester_full_name||"").trim();w({customer:he,email:fe.requester_email||"",phone:fe.requester_phone||""});const Ue=String(fe.service_type||"").toLowerCase(),Ye={consultation:"consulting",consulting:"consulting",installation:"installation",maintenance:"maintenance",repair:"repair",general:"custom"};W(Ke=>({...Ke,servCat:Ye[Ue]||Ke.servCat||""})),U({addr:fe.requester_address||"",date:fe.preferred_date||"",time:fe.preferred_time||""})}catch{}}function we(){W(De=>({...De,items:[...De.items,{id:crypto.randomUUID(),item_id:"",desc:"",qty:1,price:0,sub:0}]}))}function Ie(De,Te,Ce){W(Pe=>{const fe=Pe.items.map(he=>{if(he.id===De){const Ue={...he,[Te]:Ce};if(Te==="item_id"){const Je=c.find(xe=>String(xe.id)===String(Ce))||null;if(Je){Ue.desc=Je.item_name||Ue.desc;const xe=Number(Je.selling_price||0);Number.isFinite(xe)&&(Ue.price=xe)}}const Ye=parseFloat(Ue.qty||0),Ke=parseFloat(Ue.price||0);return Ue.sub=Ye*Ke,Ue}return he});return{...Pe,items:fe}})}function _e(De){W(Te=>({...Te,items:Te.items.filter(Ce=>Ce.id!==De)}))}const Fe=f.useMemo(()=>{var Pe,fe;let De=0;const Te=((Pe=se.find(he=>Number(he.is_base)===1))==null?void 0:Pe.symbol)||((fe=se.find(he=>String(he.code).toUpperCase()==="GHS"))==null?void 0:fe.symbol)||"";let Ce='<div class="sum-item"><strong>Services</strong></div>';for(const he of E.items){const Ue=String(he.desc||"Service"),Ye=parseFloat(he.qty||0),Ke=parseFloat(he.price||0),Je=Ye*Ke;Je>0&&(Ce+=`<div class="sum-item"><span>${Ue} (x${Ye})</span><span>${Te}${Je.toFixed(2)}</span></div>`),De+=Je}if(j==="existing"){const he=De*.1;Ce+=`<div class="sum-item"><span>Discount (10%)</span><span style="color:#27ae60">-${Te}${he.toFixed(2)}</span></div>`,De-=he}return De>0?Ce+=`<div class="sum-total"><span>Total</span><span>${Te}${De.toFixed(2)}</span></div>`:Ce='<p style="text-align:center;color:#7f8c8d;padding:20px">Add services to see summary</p>',Ce},[E.items,j,se]);function Le(){N(""),F({custId:"",accEmail:""}),w({customer:"",email:"",phone:""}),W({servCat:"",items:[]}),U({addr:"",date:"",time:""})}function rt(){Y({dept:"",cost:""}),M({name:"",title:"",email:"",phone:""}),z({name:"",id:"",email:"",phone:""}),P({cat:"",scope:""}),k({loc:"",start:"",end:""}),G({estCost:"",currency:"USD"})}function He(De){var he;De.preventDefault();const Te=(E.items||[]).map(Ue=>{var Je;const Ye=parseFloat(Ue.qty||0),Ke=parseFloat(Ue.price||0);return{item_id:Ue.item_id||null,item_name:((Je=c.find(xe=>String(xe.id)===String(Ue.item_id)))==null?void 0:Je.item_name)||null,description:Ue.desc||null,qty:Ye,unit_price:Ke,line_total:Ye*Ke}}),Ce=Te.reduce((Ue,Ye)=>Ue+Number(Ye.line_total||0),0),Pe={order_type:"INTERNAL",customer_name:I.customer||null,customer_email:I.email||null,customer_phone:I.phone||null,service_category:E.servCat||null,schedule_address:R.addr||null,schedule_date:R.date||null,schedule_time:R.time||null,lines:Te,total_amount:Ce,assigned_supervisor_user_id:g?Number(g):null,assigned_supervisor_username:((he=m.find(Ue=>String(Ue.user_id)===String(g)))==null?void 0:he.username)||null};(r&&r!==""?Z.put(`/purchase/service-orders/${r}`,Pe):Z.post("/purchase/service-orders",Pe)).then(Ue=>{var Ke;const Ye=((Ke=Ue==null?void 0:Ue.data)==null?void 0:Ke.order_no)||i||(r?`ORD-${r}`:X());l(Ye),ct.success(Ye?`Service order ${Ye} saved successfully`:"Service order saved successfully"),t("/service-management/service-orders")}).catch(()=>{alert("Failed to submit service order")})}function st(De){var Pe;De.preventDefault();const Te={order_type:"EXTERNAL",department:T.dept||null,cost_center:T.cost||null,requestor_name:H.name||null,requestor_title:H.title||null,requestor_email:H.email||null,requestor_phone:H.phone||null,contractor_name:q.name||null,contractor_code:q.id||null,contractor_email:q.email||null,contractor_phone:q.phone||null,ext_category:V.cat||null,scope_of_work:V.scope||null,work_location:C.loc||null,start_date:C.start||null,end_date:C.end||null,estimated_cost:B.estCost||null,currency_code:B.currency||null,total_amount:Number(B.estCost||0),assigned_supervisor_user_id:g?Number(g):null,assigned_supervisor_username:((Pe=m.find(fe=>String(fe.user_id)===String(g)))==null?void 0:Pe.username)||null};(r&&r!==""?Z.put(`/purchase/service-orders/${r}`,Te):Z.post("/purchase/service-orders",Te)).then(fe=>{var Ue;const he=((Ue=fe==null?void 0:fe.data)==null?void 0:Ue.order_no)||i||(r?`ORD-${r}`:X());l(he),ct.success(he?`Service order ${he} saved successfully`:"Service order saved successfully"),t("/service-management/service-orders")}).catch(()=>{alert("Failed to submit service order")})}return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/service-management/service-orders",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back to Service Order List"}),e.jsx("h1",{className:"text-2xl font-bold mt-2",children:"Service Order Management"}),e.jsx("p",{className:"text-sm mt-1",children:"Comprehensive order system for internal services and external contractors"})]})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold dark:text-brand-300",children:"Service Orders"}),e.jsx("p",{className:"text-sm mt-1",children:"Internal services and external contractor orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:a==="internal"?"btn-primary":"btn-secondary",onClick:()=>n("internal"),children:"Internal"}),e.jsx("button",{type:"button",className:a==="external"?"btn-primary":"btn-secondary",onClick:()=>n("external"),children:"External"})]})]})}),e.jsxs("div",{className:"card-body",children:[a==="internal"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsxs("form",{onSubmit:He,children:[e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Link Service Request ",e.jsx("span",{className:"req",children:"*"})]}),e.jsxs("select",{className:"input",onChange:De=>me(De.target.value),children:[e.jsx("option",{value:"",children:"-- Select Service Request --"}),d.map(De=>e.jsxs("option",{value:De.id,children:[De.request_no,"  ",De.requester_full_name," "," ",De.service_type]},De.id))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-4",children:[e.jsxs("div",{className:"group md:col-span-2",children:[e.jsxs("label",{children:["Customer ",e.jsx("span",{className:"req",children:"*"})]}),e.jsx("input",{className:"input",value:I.customer,onChange:De=>w(Te=>({...Te,customer:De.target.value})),placeholder:"Company / Customer name",required:!0})]}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Email ",e.jsx("span",{className:"req",children:"*"})]}),e.jsx("input",{className:"input",type:"email",value:I.email,onChange:De=>w(Te=>({...Te,email:De.target.value})),placeholder:"customer@example.com",required:!0})]}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Phone ",e.jsx("span",{className:"req",children:"*"})]}),e.jsx("input",{className:"input",value:I.phone,onChange:De=>w(Te=>({...Te,phone:De.target.value})),placeholder:"+1 (555) 123-4567",required:!0})]})]}),e.jsxs("div",{className:"group mt-4",children:[e.jsxs("label",{children:["Service Category ",e.jsx("span",{className:"req",children:"*"})]}),e.jsxs("select",{className:"input",value:E.servCat,onChange:De=>W(Te=>({...Te,servCat:De.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Category --"}),ne.map(De=>e.jsx("option",{value:De.name,children:De.name},De.id))]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h4",{style:{color:"var(--primary)",marginBottom:10},children:" Service Items"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 100px 120px 40px",gap:12,marginBottom:8,padding:"4px 10px",background:"var(--white)",border:"2px solid var(--border)",borderRadius:6,fontWeight:600},children:[e.jsx("div",{children:"Item"}),e.jsx("div",{children:"Qty"}),e.jsx("div",{children:"Rate"}),e.jsx("div",{children:"Amount"}),e.jsx("div",{})]}),e.jsx("div",{children:E.items.map(De=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 100px 120px 40px",gap:12,marginBottom:10,padding:10,background:"var(--white)",border:"2px solid var(--border)",borderRadius:6},children:[e.jsxs("select",{className:"input",value:De.item_id||"",onChange:Te=>Ie(De.id,"item_id",Te.target.value),children:[e.jsx("option",{value:"",children:"-- Select Service Item --"}),c.map(Te=>e.jsx("option",{value:Te.id,children:Te.item_name},Te.id))]}),e.jsx("input",{className:"input",type:"number",min:"1",value:De.qty,onChange:Te=>Ie(De.id,"qty",Te.target.value)}),e.jsx("input",{className:"input",type:"number",step:"0.01",min:"0",value:De.price,onChange:Te=>Ie(De.id,"price",Te.target.value),placeholder:"0.00"}),e.jsx("input",{className:"input",readOnly:!0,value:(parseFloat(De.qty||0)*parseFloat(De.price||0)).toFixed(2)}),e.jsx("button",{type:"button",className:"btn-danger",onClick:()=>_e(De.id),children:""})]},De.id))}),e.jsx("button",{type:"button",className:"btn-primary mt-2",onClick:we,children:"+ Add Service Item"})]})}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Work Location ",e.jsx("span",{className:"req",children:"*"})]}),e.jsxs("select",{className:"input",value:R.addr,onChange:De=>U(Te=>({...Te,addr:De.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Work Location --"}),oe.map(De=>e.jsx("option",{value:De.name,children:De.name},De.id))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Service Date ",e.jsx("span",{className:"req",children:"*"})]}),e.jsx("input",{className:"input",type:"date",value:R.date,onChange:De=>U(Te=>({...Te,date:De.target.value})),min:o,required:!0})]}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Time Slot ",e.jsx("span",{className:"req",children:"*"})]}),e.jsxs("select",{className:"input",value:R.time,onChange:De=>U(Te=>({...Te,time:De.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Time --"}),e.jsx("option",{value:"08-10",children:"8:00 AM - 10:00 AM"}),e.jsx("option",{value:"10-12",children:"10:00 AM - 12:00 PM"}),e.jsx("option",{value:"12-14",children:"12:00 PM - 2:00 PM"}),e.jsx("option",{value:"14-16",children:"2:00 PM - 4:00 PM"}),e.jsx("option",{value:"16-18",children:"4:00 PM - 6:00 PM"})]})]})]}),e.jsxs("div",{className:"group",children:[e.jsx("label",{children:"Assigned Supervisor"}),e.jsxs("select",{className:"input",value:g,onChange:De=>x(De.target.value),children:[e.jsx("option",{value:"",children:"-- Select Supervisor --"}),m.map(De=>e.jsx("option",{value:De.user_id,children:De.username},De.id))]})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:Le,children:"Clear"}),e.jsx("button",{type:"submit",className:"btn-primary",children:"Submit Order"})]})]})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Order Summary"}),e.jsx($C,{html:Fe})]})]}),a==="external"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsxs("form",{onSubmit:st,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Department ",e.jsx("span",{className:"req",children:"*"})]}),e.jsxs("select",{className:"input",value:T.dept,onChange:De=>Y(Te=>({...Te,dept:De.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Department --"}),O.map(De=>e.jsx("option",{value:De.name,children:De.name},De.id))]})]}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Cost Center ",e.jsx("span",{className:"req",children:"*"})]}),e.jsxs("select",{className:"input",value:T.cost,onChange:De=>Y(Te=>({...Te,cost:De.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Cost Center --"}),J.map(De=>e.jsxs("option",{value:De.code,children:[De.code,"  ",De.name]},De.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Requestor Name ",e.jsx("span",{className:"req",children:"*"})]}),e.jsx("input",{className:"input",value:H.name,onChange:De=>M(Te=>({...Te,name:De.target.value})),placeholder:"Full name",required:!0})]}),e.jsxs("div",{className:"group",children:[e.jsx("label",{children:"Job Title"}),e.jsx("input",{className:"input",value:H.title,onChange:De=>M(Te=>({...Te,title:De.target.value})),placeholder:"Position"})]}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Email ",e.jsx("span",{className:"req",children:"*"})]}),e.jsx("input",{className:"input",type:"email",value:H.email,onChange:De=>M(Te=>({...Te,email:De.target.value})),placeholder:"requestor@company.com",required:!0})]}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Phone ",e.jsx("span",{className:"req",children:"*"})]}),e.jsx("input",{className:"input",value:H.phone,onChange:De=>M(Te=>({...Te,phone:De.target.value})),placeholder:"+1 (555) 123-4567",required:!0})]})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Contractor Name ",e.jsx("span",{className:"req",children:"*"})]}),e.jsxs("select",{className:"input",value:q.name,onChange:De=>{const Te=De.target.value;z(Pe=>({...Pe,name:Te}));const Ce=Q.find(Pe=>String(Pe.supplier_name)===String(Te));if(Ce){z({name:Ce.supplier_name||"",id:Ce.supplier_code||"",email:Ce.email||"",phone:Ce.phone||""});const Pe=se.find(fe=>Number(fe.id)===Number(Ce.currency_id));Pe!=null&&Pe.code&&G(fe=>({...fe,currency:Pe.code}))}},required:!0,children:[e.jsx("option",{value:"",children:"-- Select Contractor --"}),Q.map(De=>e.jsx("option",{value:De.supplier_name,children:De.supplier_name},De.id))]})]}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Contractor ID"," ",e.jsx("span",{className:"text-slate-500",children:"(Optional)"})]}),e.jsx("input",{className:"input",value:q.id,onChange:De=>z(Te=>({...Te,id:De.target.value})),placeholder:"CONT-12345",readOnly:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Contractor Email ",e.jsx("span",{className:"req",children:"*"})]}),e.jsx("input",{className:"input",type:"email",value:q.email,onChange:De=>z(Te=>({...Te,email:De.target.value})),placeholder:"contractor@company.com",required:!0})]}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Contractor Phone ",e.jsx("span",{className:"req",children:"*"})]}),e.jsx("input",{className:"input",value:q.phone,onChange:De=>z(Te=>({...Te,phone:De.target.value})),placeholder:"+1 (555) 987-6543",required:!0})]})]}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Service Category ",e.jsx("span",{className:"req",children:"*"})]}),e.jsxs("select",{className:"input",value:V.cat,onChange:De=>P(Te=>({...Te,cat:De.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Category --"}),ne.map(De=>e.jsx("option",{value:De.name,children:De.name},De.id))]})]}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Scope of Work ",e.jsx("span",{className:"req",children:"*"})]}),e.jsx("textarea",{className:"input",value:V.scope,onChange:De=>P(Te=>({...Te,scope:De.target.value})),placeholder:"Detailed description of work to be performed",required:!0})]}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Work Location ",e.jsx("span",{className:"req",children:"*"})]}),e.jsxs("select",{className:"input",value:C.loc,onChange:De=>k(Te=>({...Te,loc:De.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Work Location --"}),oe.map(De=>e.jsx("option",{value:De.name,children:De.name},De.id))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Start Date ",e.jsx("span",{className:"req",children:"*"})]}),e.jsx("input",{className:"input",type:"date",value:C.start,onChange:De=>k(Te=>({...Te,start:De.target.value})),min:o,required:!0})]}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["End Date ",e.jsx("span",{className:"req",children:"*"})]}),e.jsx("input",{className:"input",type:"date",value:C.end,onChange:De=>k(Te=>({...Te,end:De.target.value})),min:o,required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Estimated Cost ",e.jsx("span",{className:"req",children:"*"})]}),e.jsx("input",{className:"input",type:"number",step:"0.01",min:"0",value:B.estCost,onChange:De=>G(Te=>({...Te,estCost:De.target.value})),placeholder:"0.00",required:!0})]}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{children:["Currency ",e.jsx("span",{className:"req",children:"*"})]}),e.jsxs("select",{className:"input",value:B.currency,onChange:De=>G(Te=>({...Te,currency:De.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Currency --"}),se.map(De=>e.jsx("option",{value:De.code,children:De.code},De.id))]})]})]}),e.jsxs("div",{className:"group",children:[e.jsx("label",{children:"Assigned Supervisor"}),e.jsxs("select",{className:"input",value:g,onChange:De=>x(De.target.value),children:[e.jsx("option",{value:"",children:"-- Select Supervisor --"}),m.map(De=>e.jsx("option",{value:De.user_id,children:De.username},De.id))]})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:rt,children:"Clear"}),e.jsx("button",{type:"submit",className:"btn-primary",children:"Submit Order"})]})]})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Order Summary"}),e.jsx($C,{html:'<p style="text-align:center;color:#7f8c8d;padding:20px">Fill in details to see summary</p>'})]})]})]})]}),b&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/40 z-50",children:e.jsxs("div",{className:"card w-full max-w-md",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"font-semibold",children:"Order Submitted"})}),e.jsxs("div",{className:"card-body space-y-3 text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:""}),e.jsx("div",{className:"text-sm",children:"Your order has been received and is being processed."}),e.jsxs("div",{className:"order-num",children:["Order #: ",i]}),e.jsx("div",{className:"flex justify-center gap-2",children:e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>y(!1),children:"Done"})})]})]})})]})}function Xse(){var m;const t=Ur(),{canPerformAction:s}=Ls(),[r,a]=f.useState([]),[n,i]=f.useState(!1),[l,o]=f.useState(""),[d,u]=f.useState(""),c=((m=t.state)==null?void 0:m.success)||"";f.useEffect(()=>{let p=!0;return i(!0),o(""),(async()=>{var g;try{const x=await Z.get("/purchase/service-orders"),b=Array.isArray((g=x.data)==null?void 0:g.items)?x.data.items:[];p&&a(b)}catch{p&&(o("No service order API found. Showing placeholder list."),a([]))}finally{p&&i(!1)}})(),()=>{p=!1}},[]);const h=f.useMemo(()=>{const p=String(d||"").toLowerCase();return p?(r||[]).filter(g=>([g.order_no,g.customer_name,g.service_type,g.status,g.work_location].filter(Boolean).join(" ").toLowerCase()||"").includes(p)):r},[r,d]);return e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-semibold",children:"Service Orders"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/service-management",className:"btn btn-secondary",children:"Return to Menu"}),e.jsx(Re,{to:"/service-management/service-orders/new",className:"btn-success",children:"+ New Order"})]})]})}),e.jsxs("div",{className:"card-body",children:[c?e.jsx("div",{className:"mb-3 p-3 rounded bg-green-50 border border-green-200 text-green-700 text-sm",children:c}):null,l?e.jsx("div",{className:"text-sm text-red-600 mb-3",children:l}):null,e.jsx("div",{className:"mb-3",children:e.jsx("input",{value:d,onChange:p=>u(p.target.value)})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Order No"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[!n&&h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center text-slate-500",children:"No service orders"})}):null,h.map(p=>e.jsxs("tr",{children:[e.jsx("td",{children:p.order_no}),e.jsx("td",{children:p.order_date}),e.jsx("td",{children:p.customer_name}),e.jsx("td",{children:p.service_type}),e.jsx("td",{children:p.status}),e.jsx("td",{className:"text-right",children:Number(p.total_amount||0).toFixed(2)}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[s("service-management:service-orders","view")&&e.jsx(Re,{to:`/service-management/service-orders/${p.id}`,className:"btn btn-secondary btn-sm",children:"View"}),s("service-management:service-orders","edit")&&e.jsx(Re,{to:`/service-management/service-orders/${p.id}`,className:"btn btn-primary btn-sm",children:"Edit"})]})})]},p.id))]})]})})]})]})})}function Jse(t){const s=t instanceof Date?t:new Date(t),r=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0");return`${r}-${a}-${n}`}function Zse(){const t=ps(),[s,r]=f.useState(1),[a,n]=f.useState(""),[i,l]=f.useState([]),[o,d]=f.useState(null),[u,c]=f.useState(""),[h,m]=f.useState(""),[p,g]=f.useState(""),[x,b]=f.useState([]),[y,j]=f.useState(""),[N,_]=f.useState([]),[F,I]=f.useState([]),[w,E]=f.useState(new Set),[W,R]=f.useState(""),[U,T]=f.useState(""),[Y,H]=f.useState(""),[M,q]=f.useState([]),[z,Q]=f.useState({qc1:!1,qc2:!1,qc3:!1,qc4:!1,qc5:!1,qc6:!1}),[L,V]=f.useState(""),P=f.useMemo(()=>{try{const[xe,ye]=(W||"00:00").split(":").map(it=>Number(it||0)),[Ae,be]=(L||"00:00").split(":").map(it=>Number(it||0)),Ee=xe+ye/60,mt=Ae+be/60-Ee;return mt>0?mt.toFixed(2):""}catch{return""}},[W,L]),[C,k]=f.useState(""),[B,G]=f.useState(""),[O,K]=f.useState(""),[J,te]=f.useState(""),[se,ae]=f.useState(""),[ne,ue]=f.useState(!1),[oe,le]=f.useState(""),[X,me]=f.useState(""),[we,Ie]=f.useState([]),[_e,Fe]=f.useState(!1),[Le,rt]=f.useState(!1),[He,st]=f.useState("");f.useMemo(()=>{const xe=a.toLowerCase();return i.filter(ye=>ye.orderNumber.toLowerCase().includes(xe)||ye.customer.toLowerCase().includes(xe)||ye.serviceType.toLowerCase().includes(xe))},[a]),f.useEffect(()=>{let xe=!0;async function ye(){var be;try{const Ee=await Z.get("/purchase/service-orders",{params:{type:"INTERNAL"}}),mt=(Array.isArray((be=Ee.data)==null?void 0:be.items)?Ee.data.items:[]).map(it=>({id:it.id,orderNumber:it.order_no,customer:it.customer_name||"",serviceType:it.service_type||"",location:it.work_location||"",scheduledDate:it.order_date||"",status:it.status||"",estimatedCost:Number(it.total_amount||0),assigned_supervisor_username:it.assigned_supervisor_username||"",assigned_supervisor_user_id:it.assigned_supervisor_user_id||null}));xe&&l(mt)}catch{xe&&l([])}}const Ae=new Date;return c(Jse(Ae)),m(`${String(Ae.getHours()).padStart(2,"0")}:${String(Ae.getMinutes()).padStart(2,"0")}`),ye(),()=>{xe=!1}},[]),f.useEffect(()=>{o&&g(o.assigned_supervisor_username||"")},[o]);function De(xe){r(xe)}function Te(xe){r(xe)}function Ce(){b(xe=>[...xe,{id:crypto.randomUUID(),code:"",name:"",qty:1,unit:"",note:""}])}function Pe(xe,ye,Ae){b(be=>be.map(Ee=>Ee.id===xe?{...Ee,[ye]:Ae}:Ee))}function fe(xe){b(ye=>ye.filter(Ae=>Ae.id!==xe))}function he(xe){E(ye=>{const Ae=new Set(Array.from(ye));return Ae.has(xe)?Ae.delete(xe):Ae.add(xe),Ae})}function Ue(xe){return ye=>{const Ae=Array.from(ye.target.files||[]);xe(be=>[...be,...Ae]),ye.target.value=""}}function Ye(xe){return Number(xe||0).toLocaleString("en-US",{minimumFractionDigits:2})}f.useEffect(()=>{let xe=!0;async function ye(){var be;try{const Ee=await Z.get("/inventory/items",{params:{active:1}}),dt=Array.isArray((be=Ee.data)==null?void 0:be.items)?Ee.data.items:[];xe&&_(dt)}catch{xe&&_([])}}async function Ae(){var be;try{const Ee=await Z.get("/purchase/service-setup/supervisors"),dt=Array.isArray((be=Ee.data)==null?void 0:be.items)?Ee.data.items:[];xe&&I(dt)}catch{xe&&I([])}}return ye(),Ae(),()=>{xe=!1}},[]);async function Ke(xe){var be;xe.preventDefault();const Ae={order_id:(o==null?void 0:o.id)||null,execution_no:"",execution_date:u||null,scheduled_time:h||null,assigned_supervisor_user_id:(o==null?void 0:o.assigned_supervisor_user_id)||null,assigned_supervisor_username:(o==null?void 0:o.assigned_supervisor_username)||null,requisition_notes:y||null,status:"PENDING",materials:x.map(Ee=>({code:Ee.code||null,name:Ee.name||"",unit:Ee.unit||"",qty:Number(Ee.qty||0)||0,note:Ee.note||""}))};try{const dt=((be=(await Z.post("/purchase/service-executions",Ae)).data)==null?void 0:be.execution_no)||`EXEC-${Date.now().toString().slice(-8)}`;st(dt),t("/service-management/service-executions",{state:{success:"Service execution saved successfully"}})}catch{alert("Failed to save service execution"),st("")}}const Je=f.useMemo(()=>{if(!o)return'<p style="text-align:center;color:#64748b;padding:20px;">Select a service order to begin</p>';const xe=x.length,ye=Object.values(z).filter(Boolean).length;return`
      <div class="space-y-2">
        <div class="summary-item"><span class="label">Order</span><span class="value">${o.orderNumber}</span></div>
        <div class="summary-item"><span class="label">Customer</span><span class="value">${o.customer}</span></div>
        <div class="summary-item"><span class="label">Type</span><span class="value">${o.serviceType}</span></div>
        <div class="summary-item"><span class="label">Scheduled</span><span class="value">${o.scheduledDate}</span></div>
        <div class="summary-item"><span class="label">Materials</span><span class="value">${xe}</span></div>
        <div class="summary-item"><span class="label">Techs</span><span class="value">${Array.from(w).length}</span></div>
        <div class="summary-item"><span class="label">QC Checks</span><span class="value">${ye} / 6</span></div>
        <div class="summary-item"><span class="label">Est. Cost</span><span class="value">$${Ye(o.estimatedCost)}</span></div>
        <div class="status-badge ${s<3?"status-pending":s<5?"status-in-progress":"status-completed"}">
          ${s<3?"Pending":s<5?"In Progress":"Completed"}
        </div>
      </div>
    `},[o,x,w,z,s]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Re,{to:"/service-management/service-executions",className:"text-sm text-brand hover:text-brand-600 dark:text-brand-400 dark:hover:text-brand-300",children:" Back"}),e.jsx("h1",{className:"text-2xl font-bold mt-2",children:"Service Execution Management"}),e.jsx("p",{className:"text-sm mt-1",children:"Track and manage service execution from assignment to completion"})]})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsxs("div",{className:"flex justify-between items-center text-white",children:[e.jsx("div",{className:"font-semibold",children:"Execution Progress"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(xe=>e.jsx("button",{type:"button",className:s===xe?"btn-primary":"btn-secondary",onClick:()=>r(xe),children:xe},xe))})]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[1fr_380px] gap-6",children:[e.jsx("div",{children:e.jsxs("form",{onSubmit:Ke,className:"space-y-4",children:[s===1&&e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-3",children:[e.jsx("div",{className:"text-lg font-semibold",children:" Service Order Reference"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"label",children:["Search Service Order"," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{className:"input",value:(o==null?void 0:o.id)||"",onChange:xe=>{const ye=xe.target.value,Ae=i.find(be=>String(be.id)===String(ye));Ae?(d(Ae),n(Ae.orderNumber)):(d(null),n(""))},children:[e.jsx("option",{value:"",children:"-- Select Internal Service Order --"}),i.map(xe=>e.jsxs("option",{value:xe.id,children:[xe.orderNumber,"  ",xe.customer,"  ",xe.serviceType]},xe.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Execution Date"," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{className:"input",type:"date",value:u,onChange:xe=>c(xe.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Scheduled Time"," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{className:"input",type:"time",value:h,onChange:xe=>m(xe.target.value)})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"label",children:["Assigned Supervisor"," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{className:"input",value:p,onChange:xe=>g(xe.target.value),placeholder:"Auto-filled from service order",readOnly:!0})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>De(2),children:"Next: Material Requisition "})})]})}),s===2&&e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-3",children:[e.jsx("div",{className:"text-lg font-semibold",children:" Material Requisition from Stores"}),e.jsx("div",{className:"text-sm bg-blue-50 border-l-4 border-blue-400 p-3 rounded",children:"Materials will be checked against store inventory. Unavailable items will be flagged for procurement."}),e.jsxs("div",{className:"space-y-2",children:[x.map(xe=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[2fr_1fr_120px_120px_40px] gap-2 items-end p-3 bg-slate-50 rounded border",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Description"}),e.jsxs("select",{className:"input",value:xe.code,onChange:ye=>{const Ae=ye.target.value,be=N.find(Ee=>String(Ee.id)===String(Ae));Pe(xe.id,"code",Ae),Pe(xe.id,"name",(be==null?void 0:be.item_name)||""),Pe(xe.id,"unit",(be==null?void 0:be.uom)||"")},children:[e.jsx("option",{value:"",children:"-- Select Item --"}),N.map(ye=>e.jsx("option",{value:ye.id,children:ye.item_name},ye.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Qty"}),e.jsx("input",{className:"input",type:"number",min:"1",value:xe.qty,onChange:ye=>Pe(xe.id,"qty",ye.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Unit"}),e.jsx("input",{className:"input",value:xe.unit,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note"}),e.jsx("input",{className:"input",value:xe.note,onChange:ye=>Pe(xe.id,"note",ye.target.value),placeholder:"Optional note"})]}),e.jsx("button",{type:"button",className:"btn-danger",onClick:()=>fe(xe.id),children:""})]},xe.id)),e.jsx("button",{type:"button",className:"btn-primary",onClick:Ce,children:"+ Add Material Item"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Requisition Notes"}),e.jsx("textarea",{className:"input",value:y,onChange:xe=>j(xe.target.value),placeholder:"Any special requirements or notes"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>Te(1),children:" Back"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>De(3),children:"Next: Execution Details "})]})]})}),s===3&&e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-3",children:[e.jsx("div",{className:"text-lg font-semibold",children:" Service Execution Details"}),e.jsx("div",{className:"space-y-2",children:F.map(xe=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded border",children:[e.jsx("div",{className:"font-medium text-brand-700",children:xe.username}),e.jsx("input",{type:"checkbox",checked:w.has(xe.user_id),onChange:()=>he(xe.user_id)})]},xe.id))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Actual Start Time"," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{className:"input",type:"time",value:W,onChange:xe=>R(xe.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Estimated Duration (hours)"," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{className:"input",type:"number",step:"0.5",min:"0",value:U,onChange:xe=>T(xe.target.value)})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Work Performed Description"," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("textarea",{className:"input",value:Y,onChange:xe=>H(xe.target.value),placeholder:"Detailed description of work performed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Service Execution Photos"}),e.jsx("input",{type:"file",multiple:!0,accept:".jpg,.jpeg,.png",onChange:Ue(q)}),M.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:M.map(xe=>e.jsx("div",{className:"flex items-center justify-between p-2 border rounded",children:e.jsxs("div",{className:"text-xs",children:[xe.name,"  ",(xe.size/1024).toFixed(1)," KB"]})},xe.name))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>Te(2),children:" Back"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>De(4),children:"Next: Quality Check "})]})]})}),s===4&&e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-3",children:[e.jsx("div",{className:"text-lg font-semibold",children:" Quality Check & Verification"}),e.jsx("div",{className:"space-y-2",children:Object.keys(z).map((xe,ye)=>e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm p-2 border rounded",children:[e.jsx("input",{type:"checkbox",checked:z[xe],onChange:Ae=>Q(be=>({...be,[xe]:Ae.target.checked}))}),["All work completed as per service order specifications","All materials used are documented and accounted for","Work area cleaned and restored to original condition","All safety protocols followed during execution","Equipment/systems tested and functioning properly","No additional issues or defects identified"][ye]]},xe))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Actual End Time"," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{className:"input",type:"time",value:L,onChange:xe=>V(xe.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Total Duration (hours)"}),e.jsx("input",{className:"input",value:P,readOnly:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Quality Check Notes"}),e.jsx("textarea",{className:"input",value:C,onChange:xe=>k(xe.target.value),placeholder:"Any observations, recommendations, or issues"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>Te(3),children:" Back"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>De(5),children:"Next: Service Closing "})]})]})}),s===5&&e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-3",children:[e.jsx("div",{className:"text-lg font-semibold",children:" Service Closing"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:ne,onChange:xe=>ue(xe.target.checked)}),e.jsx("span",{children:"Follow-up service required"})]}),ne&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Follow-up Details"}),e.jsx("textarea",{className:"input",value:oe,onChange:xe=>le(xe.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Closing Remarks"," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("textarea",{className:"input",value:X,onChange:xe=>me(xe.target.value),placeholder:"Final summary and recommendations"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Completion Certificate/Photos"}),e.jsx("input",{type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png",onChange:Ue(Ie)}),we.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:we.map(xe=>e.jsx("div",{className:"flex items-center justify-between p-2 border rounded",children:e.jsxs("div",{className:"text-xs",children:[xe.name,"  ",(xe.size/1024).toFixed(1)," KB"]})},xe.name))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:_e,onChange:xe=>Fe(xe.target.checked)}),e.jsx("span",{children:"I confirm that all work has been completed satisfactorily and customer has approved the service"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>Te(4),children:" Back"}),e.jsx("button",{type:"submit",className:"btn-success",disabled:!_e,children:"Complete Service Execution"})]})]})})]})}),e.jsx("div",{children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Execution Summary"}),e.jsx("div",{dangerouslySetInnerHTML:{__html:Je}})]})})})]})})]})]})}function ere(){var c;const{canPerformAction:t}=Ls(),[s,r]=f.useState([]),[a,n]=f.useState(!1),[i,l]=f.useState(""),d=((c=useLocation().state)==null?void 0:c.success)||"";async function u(){var h;n(!0),l("");try{const m=await Z.get("/purchase/service-executions"),p=m.data&&m.data.data&&m.data.data.items||((h=m.data)==null?void 0:h.items)||[];r(p)}catch{l("Failed to load")}finally{n(!1)}}return f.useEffect(()=>{u()},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h2",{className:"text-xl font-semibold",children:"Service Executions"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{to:"/service-management",className:"btn-secondary",children:"Back to Menu"}),e.jsx(Re,{to:"/service-management/service-execution",className:"btn",children:"New Execution"})]})]}),d?e.jsx("div",{className:"p-2 rounded bg-green-50 text-green-700 border border-green-200",children:d}):null,i?e.jsx("div",{className:"text-red-600",children:i}):null,e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:a?e.jsx("div",{children:"Loading..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Execution No"}),e.jsx("th",{children:"Order No"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Supervisor"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[s.map(h=>e.jsxs("tr",{children:[e.jsx("td",{children:h.execution_no||""}),e.jsx("td",{children:h.order_no||""}),e.jsx("td",{children:String(h.order_type||"")}),e.jsx("td",{children:h.assigned_supervisor_username||h.assigned_supervisor_user_id||""}),e.jsx("td",{children:h.execution_date||""}),e.jsx("td",{children:h.status||""}),e.jsxs("td",{children:[t("service-management:service-executions","view")&&e.jsx(Re,{to:`/service-management/service-executions/${h.id}`,className:"btn-secondary btn-sm",children:"View"}),t("service-management:service-executions","edit")&&e.jsx(Re,{to:`/service-management/service-execution?id=${h.id}&mode=edit`,className:"btn-primary btn-sm ml-2",children:"Edit"})]})]},h.id)),!s.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center text-slate-500",children:"No service executions found"})})]})]})})})})]})}function tre(){const{id:t}=Ps(),[s,r]=f.useState(null),[a,n]=f.useState(!1),[i,l]=f.useState("");async function o(){var d;n(!0),l("");try{const u=await Z.get(`/purchase/service-executions/${t}`),c=((d=u.data)==null?void 0:d.item)||u.data||null;r(c)}catch{l("Failed to load")}finally{n(!1)}}return f.useEffect(()=>{o()},[t]),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Service Execution"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/service-management/service-executions",className:"btn-secondary",children:"Back to List"}),e.jsx(Re,{to:"/service-management",className:"btn-secondary",children:"Back to Menu"})]})]}),i?e.jsx("div",{className:"text-red-600",children:i}):null,e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:a?e.jsx("div",{children:"Loading..."}):s?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Execution No"}),e.jsx("div",{className:"font-semibold",children:s.execution_no||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Order No"}),e.jsx("div",{className:"font-semibold",children:s.order_no||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Type"}),e.jsx("div",{className:"font-semibold",children:s.order_type||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Supervisor"}),e.jsx("div",{className:"font-semibold",children:s.assigned_supervisor_username||s.assigned_supervisor_user_id||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Date"}),e.jsx("div",{className:"font-semibold",children:s.execution_date||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Status"}),e.jsx("div",{className:"font-semibold",children:s.status||"-"})]})]}),Array.isArray(s.materials)&&s.materials.length?e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Materials"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Note"})]})}),e.jsx("tbody",{children:s.materials.map((d,u)=>e.jsxs("tr",{children:[e.jsx("td",{children:d.code||""}),e.jsx("td",{children:d.name||""}),e.jsx("td",{children:d.unit||""}),e.jsx("td",{children:d.qty||""}),e.jsx("td",{children:d.note||""})]},u))})]})})]}):null,s.requisition_notes?e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"Notes"}),e.jsx("div",{className:"text-sm",children:s.requisition_notes})]}):null]}):e.jsx("div",{className:"text-slate-500",children:"No data"})})})]})}function sre(){const[t,s]=f.useState([]),[r,a]=f.useState([]),[n,i]=f.useState([]),[l,o]=f.useState(""),[d,u]=f.useState(""),[c,h]=f.useState(""),[m,p]=f.useState([]),[g,x]=f.useState([]),[b,y]=f.useState("");f.useEffect(()=>{let w=!0;async function E(){var W,R,U,T;try{const[Y,H,M,q]=await Promise.all([Z.get("/purchase/service-setup/work-locations"),Z.get("/purchase/service-setup/service-types"),Z.get("/purchase/service-setup/categories"),Z.get("/purchase/service-setup/supervisors")]);w&&(s(Array.isArray((W=Y.data)==null?void 0:W.items)?Y.data.items:[]),a(Array.isArray((R=H.data)==null?void 0:R.items)?H.data.items:[]),i(Array.isArray((U=M.data)==null?void 0:U.items)?M.data.items:[]),p(Array.isArray((T=q.data)==null?void 0:T.items)?q.data.items:[]))}catch{w&&(s([]),a([]),i([]),p([]))}}return E(),()=>{w=!1}},[]);const j=async w=>{var W;w.preventDefault();const E=String(l||"").trim();if(E)try{const R=await Z.post("/purchase/service-setup/work-locations",{name:E}),U=(W=R==null?void 0:R.data)==null?void 0:W.item;s(T=>U?[U,...T]:T),o("")}catch{}},N=async w=>{var W;w.preventDefault();const E=String(d||"").trim();if(E)try{const R=await Z.post("/purchase/service-setup/service-types",{name:E}),U=(W=R==null?void 0:R.data)==null?void 0:W.item;a(T=>U?[U,...T]:T),u("")}catch{}},_=async w=>{var W;w.preventDefault();const E=String(c||"").trim();if(E)try{const R=await Z.post("/purchase/service-setup/categories",{name:E}),U=(W=R==null?void 0:R.data)==null?void 0:W.item;i(T=>U?[U,...T]:T),h("")}catch{}},F=async(w,E)=>{try{await Z.delete(`/purchase/service-setup/${w}/${E}`),w==="work-locations"?s(W=>W.filter(R=>Number(R.id)!==Number(E))):w==="service-types"?a(W=>W.filter(R=>Number(R.id)!==Number(E))):w==="categories"?i(W=>W.filter(R=>Number(R.id)!==Number(E))):w==="supervisors"&&p(W=>W.filter(R=>Number(R.id)!==Number(E)))}catch{}};f.useEffect(()=>{let w=!0;async function E(){var W;try{const R=await Z.get("/purchase/service-setup/users"),U=Array.isArray((W=R==null?void 0:R.data)==null?void 0:W.items)?R.data.items:[];w&&x(U)}catch{w&&x([])}}return E(),()=>{w=!1}},[]);const I=async()=>{var w;try{const E=await Z.post("/purchase/service-setup/supervisors",{user_id:Number(b||0)}),W=(w=E==null?void 0:E.data)==null?void 0:w.item;p(R=>W?[W,...R]:R),y("")}catch{}};return e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-brand text-white rounded-t-lg",children:e.jsx("div",{className:"font-semibold",children:"Service Setup"})}),e.jsx("div",{className:"card-body space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:"Work Locations"}),e.jsxs("div",{className:"card-body space-y-3",children:[e.jsxs("form",{onSubmit:j,className:"flex gap-2",children:[e.jsx("input",{className:"input flex-1",value:l,onChange:w=>o(w.target.value),placeholder:"e.g., HQ Facility"}),e.jsx("button",{className:"btn-primary",children:"Add"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:t.map(w=>e.jsxs("tr",{children:[e.jsx("td",{children:w.name}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>F("work-locations",w.id),children:"Remove"})})]},w.id))})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:"Service Types"}),e.jsxs("div",{className:"card-body space-y-3",children:[e.jsxs("form",{onSubmit:N,className:"flex gap-2",children:[e.jsx("input",{className:"input flex-1",value:d,onChange:w=>u(w.target.value),placeholder:"e.g., Installation"}),e.jsx("button",{className:"btn-primary",children:"Add"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:r.map(w=>e.jsxs("tr",{children:[e.jsx("td",{children:w.name}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>F("service-types",w.id),children:"Remove"})})]},w.id))})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:"Service Categories"}),e.jsxs("div",{className:"card-body space-y-3",children:[e.jsxs("form",{onSubmit:_,className:"flex gap-2",children:[e.jsx("input",{className:"input flex-1",value:c,onChange:w=>h(w.target.value),placeholder:"e.g., Maintenance"}),e.jsx("button",{className:"btn-primary",children:"Add"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:n.map(w=>e.jsxs("tr",{children:[e.jsx("td",{children:w.name}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>F("categories",w.id),children:"Remove"})})]},w.id))})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:"Supervisors"}),e.jsxs("div",{className:"card-body space-y-3",children:[e.jsxs("form",{onSubmit:w=>{w.preventDefault(),I()},className:"flex gap-2",children:[e.jsxs("select",{className:"input flex-1",value:b,onChange:w=>y(w.target.value),children:[e.jsx("option",{value:"",children:"-- Select User --"}),g.map(w=>e.jsx("option",{value:w.id,children:w.username},w.id))]}),e.jsx("button",{disabled:!b,className:"btn-primary",children:"Add"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Username"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:m.map(w=>e.jsxs("tr",{children:[e.jsx("td",{children:w.username}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>F("supervisors",w.id),children:"Remove"})})]},w.id))})]})})]})]})]})})]})})}function rre(){const[t,s]=Is.useState([{rbac_key:"open-requests",icon:"",value:"12",label:"Open Requests",change:" 3 new today",changeType:"positive",path:"/service-management/service-requests"},{rbac_key:"pending-bills",icon:"",value:"7",label:"Pending Bills",change:" stable",changeType:"neutral",path:"/service-management/service-bills"},{rbac_key:"confirmed-services",icon:"",value:"19",label:"Confirmed Services",change:" 5 this week",changeType:"positive",path:"/service-management/service-confirmation"}]);Is.useEffect(()=>{let a=!0;async function n(){var i,l,o,d,u,c,h,m,p;try{const g=await Z.get("/bi/dashboards"),x=Number(((o=(l=(i=g==null?void 0:g.data)==null?void 0:i.summary)==null?void 0:l.services)==null?void 0:o.open_requests)||0),b=Number(((c=(u=(d=g==null?void 0:g.data)==null?void 0:d.summary)==null?void 0:u.services)==null?void 0:c.pending_bills)||0),y=Number(((p=(m=(h=g==null?void 0:g.data)==null?void 0:h.summary)==null?void 0:m.services)==null?void 0:p.confirmed)||0);a&&s(j=>{const N=[...j];return N[0]={...N[0],value:String(x)},N[1]={...N[1],value:String(b)},N[2]={...N[2],value:String(y)},N})}catch{}}return n(),()=>{a=!1}},[]);const r=[{title:"Requests",items:[{title:"Service Requests",description:"Submit and track service requests",path:"/service-management/service-requests",icon:"",actions:[{label:"New Request",path:"/service-management/service-requests/new",type:"primary"}]},{title:"Service Orders",description:"Create internal/external service orders",path:"/service-management/service-orders",icon:"",actions:[{label:"New Order",path:"/service-management/service-orders/new",type:"primary"}]},{title:"Service Execution",description:"Execute, verify and close service orders",path:"/service-management/service-executions",icon:"",actions:[{label:"Start Execution",path:"/service-management/service-execution",type:"primary"}]},{title:"Service Confirmation",description:"Confirm delivered services from suppliers",path:"/service-management/service-confirmation",icon:"",actions:[{label:"New Confirmation",path:"/service-management/service-confirmation/new",type:"primary"}]},{title:"Service Bills",description:"Prepare and issue service bills",path:"/service-management/service-bills",icon:"",actions:[{label:"New Bill",path:"/service-management/service-bills",type:"primary"}]},{title:"Service Setup",description:"Configure work locations, service types, categories",path:"/service-management/setup",icon:"",actions:[]}]}];return e.jsx(lo,{title:"Service Management",description:"End-to-end service request, confirmation, and billing",stats:t,sections:r,features:nre})}function are(){return e.jsxs(hl,{children:[e.jsx(tt,{path:"/",element:e.jsx(rre,{})}),e.jsx(tt,{path:"service-requests",element:e.jsx(zse,{})}),e.jsx(tt,{path:"service-requests/new",element:e.jsx(Yse,{})}),e.jsx(tt,{path:"service-orders",element:e.jsx(Xse,{})}),e.jsx(tt,{path:"service-orders/new",element:e.jsx(VC,{})}),e.jsx(tt,{path:"service-orders/:id",element:e.jsx(VC,{})}),e.jsx(tt,{path:"service-executions",element:e.jsx(ere,{})}),e.jsx(tt,{path:"service-executions/:id",element:e.jsx(tre,{})}),e.jsx(tt,{path:"service-execution",element:e.jsx(Zse,{})}),e.jsx(tt,{path:"service-confirmation",element:e.jsx(uF,{})}),e.jsx(tt,{path:"service-confirmation/:id",element:e.jsx(yj,{})}),e.jsx(tt,{path:"service-bills",element:e.jsx(dF,{})}),e.jsx(tt,{path:"setup",element:e.jsx(sre,{})})]})}const nre=[{module_key:"service-management",label:"Service Requests",path:"/service-management/service-requests",type:"feature"},{module_key:"service-management",label:"Service Orders",path:"/service-management/service-orders",type:"feature"},{module_key:"service-management",label:"Service Execution",path:"/service-management/service-executions",type:"feature"},{module_key:"service-management",label:"Service Confirmation",path:"/service-management/service-confirmation",type:"feature"},{module_key:"service-management",label:"Service Bills",path:"/service-management/service-bills",type:"feature"},{module_key:"service-management",label:"Service Setup",path:"/service-management/setup",type:"feature"}];function ire(){const[t,s]=f.useState([]),[r,a]=f.useState(!1),n=ps(),i=f.useMemo(()=>t.filter(u=>Number(u.is_read)!==1).length,[t]),l=f.useMemo(()=>t.filter(u=>Number(u.is_read)!==1),[t]);async function o(){var u;a(!0);try{const c=await Z.get("/workflows/notifications");s(Array.isArray((u=c.data)==null?void 0:u.items)?c.data.items:[])}catch{s([])}finally{a(!1)}}f.useEffect(()=>{o()},[]);async function d(u){try{await Z.put(`/workflows/notifications/${u}/read`),s(c=>c.map(h=>h.id===u?{...h,is_read:1}:h))}catch{}}return e.jsxs("div",{className:"max-w-5xl mx-auto p-4 space-y-6",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"Notifications"}),e.jsxs("p",{className:"text-slate-500 mt-1",children:[i," unread  ",t.length," total"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{to:"/",className:"btn btn-secondary",children:"Home"}),e.jsx("button",{className:"btn btn-outline",onClick:o,disabled:r,children:"Refresh"})]})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 p-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Message"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:r?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-4",children:"Loading..."})}):l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-8 text-slate-500",children:"No notifications"})}):l.map(u=>e.jsxs("tr",{className:"hover",children:[e.jsx("td",{className:"font-medium",children:u.title}),e.jsx("td",{children:u.message}),e.jsx("td",{children:u.created_at?new Date(u.created_at).toLocaleString():"-"}),e.jsx("td",{children:Number(u.is_read)===1?e.jsx("span",{className:"badge bg-green-100 text-green-800 border-green-300 dark:bg-green-900 dark:text-green-200 dark:border-green-800",children:"Read"}):e.jsx("span",{className:"badge bg-yellow-100 text-yellow-800 border-yellow-300 dark:bg-yellow-900 dark:text-yellow-200 dark:border-yellow-800",children:"Unread"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[u.link?e.jsx("button",{className:"btn btn-ghost btn-xs text-blue-600",onClick:()=>n(u.link),title:"Open",children:"Open"}):null,Number(u.is_read)!==1?e.jsx("button",{className:"btn btn-ghost btn-xs text-slate-600",onClick:()=>d(u.id),title:"Mark Read",children:"Mark Read"}):null]})})]},u.id))})]})})})]})}function WC(){const t=Ps(),s=t!=null&&t.id?Number(t.id):null,r=ps(),{user:a}=Kr(),[n,i]=f.useState(!1),[l,o]=f.useState(!1),[d,u]=f.useState(null),[c,h]=f.useState(null),[m,p]=f.useState([]),[g,x]=f.useState(null),[b,y]=f.useState(null);f.useEffect(()=>{if(!(Number.isFinite(s)&&s>0)||!a){i(!1),h(null),p([]),u(null),o(!1);return}(async()=>{try{i(!0),o(!0),u(null);const F=Number((a==null?void 0:a.sub)||(a==null?void 0:a.id))||"",I={Authorization:`Bearer ${localStorage.getItem("token")}`,"x-user-id":String(F)},w=await fetch(`/api/social-feed/${s}`,{headers:I});if(!w.ok)throw new Error("Failed to load post");const E=await w.json(),W=(E==null?void 0:E.data)||null;h(W);try{const U=String((W==null?void 0:W.image_url)||"");if(U){let T=U;if(!/^(data:|https?:)/i.test(T)&&T.startsWith("/uploads")){const Y=String(Z.defaults.baseURL||"");let H="";if(/^https?:\/\//i.test(Y))try{const M=new URL(Y);H=`${M.protocol}//${M.host}`}catch{}else typeof window<"u"&&window.location&&(H=window.location.origin);T=H?H+T:T}x(T)}else x(null)}catch{x((W==null?void 0:W.image_url)||null)}const R=await fetch(`/api/social-feed/${s}/likes`,{headers:I});if(R.ok){const U=await R.json();p(Array.isArray(U.data)?U.data:[])}else p([])}catch(F){u(F.message||"Failed to load post"),h(null),p([])}finally{o(!1)}})()},[s,a]);const j=()=>{i(!1),r("/social-feed")};f.useEffect(()=>()=>{try{b&&b.startsWith("blob:")&&URL.revokeObjectURL(b)}catch{}},[b]);const N=async()=>{try{const _=String((c==null?void 0:c.image_url)||""),F=typeof window<"u"&&window.location?window.location.origin:"",I=String(Z.defaults.baseURL||"");let w="";if(/^https?:\/\//i.test(I))try{const W=new URL(I);w=`${W.protocol}//${W.host}`}catch{}const E=[];try{if(/^https?:\/\//i.test(_)){const W=new URL(_);(W.hostname==="localhost"||W.hostname==="127.0.0.1")&&(E.push(`${F}${W.pathname}`),w&&E.push(`${w}${W.pathname}`))}}catch{}_.startsWith("/uploads")?(E.push(`${F}${_}`),w&&E.push(`${w}${_}`)):_.startsWith("uploads")&&(E.push(`${F}/${_}`),w&&E.push(`${w}/${_}`)),E.push(_);for(const W of E)if(!(!W||W===g))try{const R=await fetch(W,{mode:"cors"});if(R&&R.ok){const U=await R.blob(),T=URL.createObjectURL(U);try{b&&b.startsWith("blob:")&&URL.revokeObjectURL(b)}catch{}y(T),x(T);return}}catch{}}catch{}};return e.jsxs("div",{className:"bg-white rounded-xl shadow-erp p-6 border border-slate-100 relative",children:[e.jsx(S5,{focusId:s,hideCreator:!0}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-erp-lg w-full max-w-6xl overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-brand text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:(c==null?void 0:c.full_name)||"Post"}),e.jsx("button",{onClick:j,className:"text-white hover:text-slate-200 text-xl font-bold",children:""})]}),e.jsx("div",{className:"p-4",children:l?e.jsx("div",{className:"text-sm text-slate-600",children:"Loading"}):d?e.jsx("div",{className:"text-sm text-red-600",children:d}):c?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:c.profile_picture_url||"/default-avatar.png",alt:c.full_name,className:"w-10 h-10 rounded-full border border-slate-200"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:c.full_name}),e.jsx("div",{className:"text-xs text-slate-500",children:c.created_at?new Date(c.created_at).toLocaleString():""})]})]}),c.image_url&&e.jsx("img",{src:g||c.image_url,alt:"Post",className:"w-full max-h-[60vh] object-contain rounded-md border border-slate-200 mt-3",onError:N,crossOrigin:"anonymous"}),e.jsx("div",{className:"mt-3 text-sm text-slate-700",children:c.content}),e.jsxs("div",{className:"mt-3 text-sm text-slate-600",children:[" ",Number(c.like_count||0)," Likes  "," ",Number(c.comment_count||0)," Comments"]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Users who liked this post"}),m.length===0?e.jsx("div",{className:"text-xs text-slate-500",children:"No likes yet."}):e.jsx("div",{className:"flex flex-wrap gap-3",children:m.map(_=>e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 rounded-lg border border-slate-200",children:[e.jsx("img",{src:_.profile_picture_url||"/default-avatar.png",alt:_.full_name,className:"w-6 h-6 rounded-full border border-slate-200"}),e.jsx("div",{className:"text-xs",children:_.full_name})]},_.user_id))})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Comments"}),e.jsx("div",{className:"space-y-3",children:Array.isArray(c.comments)&&c.comments.length>0?c.comments.map(_=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("img",{src:_.profile_picture_url||"/default-avatar.png",alt:_.full_name,className:"w-7 h-7 rounded-full border border-slate-200"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs font-semibold",children:_.full_name}),e.jsx("div",{className:"text-sm",children:_.comment_text}),e.jsx("div",{className:"text-[11px] text-slate-500",children:new Date(_.created_at).toLocaleString()})]})]},_.id)):e.jsx("div",{className:"text-xs text-slate-500",children:"No comments yet."})})]})]}):null})]})})]})}function lre(){const t=ps(),{refreshPermissions:s}=Ls(),[r,a]=f.useState([]),[n,i]=f.useState(null),[l,o]=f.useState([]),[d,u]=f.useState([]),[c,h]=f.useState(!1),[m,p]=f.useState(""),[g,x]=f.useState(""),[b,y]=f.useState(!1),[j,N]=f.useState({name:"",code:"",is_active:!0}),[_,F]=f.useState({name:"",code:"",is_active:!0}),[I,w]=f.useState(new Set),[E,W]=f.useState(new Set),[R,U]=f.useState(new Set),[T,Y]=f.useState(new Set),H=[{key:"total-customers",label:"Total Customers"}],M=Object.entries(Bn).reduce((K,[J,te])=>(K[J]={name:te.name,icon:te.icon,features:(te.features||[]).map(se=>({key:se.key,label:se.label})),dashboards:(te.dashboards||[]).map(se=>({key:se.key,label:se.label}))},K),{});f.useEffect(()=>{q()},[]);async function q(){try{const K=await Z.get("/admin/roles");a(K.data||[])}catch{p("Failed to load roles")}}async function z(){var K,J;try{if(!j.name||!j.code){p("Name and code are required");return}await Z.post("/admin/roles",j),y(!1),N({name:"",code:"",is_active:!0}),x("Role created successfully"),q(),setTimeout(()=>x(""),3e3)}catch(te){p(((J=(K=te.response)==null?void 0:K.data)==null?void 0:J.message)||"Failed to create role")}}async function Q(){var K,J;try{if(!_.name||!_.code){p("Name and code are required");return}await Z.put(`/admin/roles/${n.id}`,_),x("Role updated successfully"),q(),setTimeout(()=>x(""),3e3)}catch(te){p(((J=(K=te.response)==null?void 0:K.data)==null?void 0:J.message)||"Failed to update role")}}async function L(K){var J;h(!0);try{const se=((J=(await Z.get(`/access/roles/${K}/permissions`)).data)==null?void 0:J.permissions)||{},ae=await Z.get(`/admin/role-features/${K}`),ne=Array.isArray(ae.data)?ae.data:[],ue=new Set,oe=new Set,le=new Set,X=new Set;Object.entries(se).forEach(([me,we])=>{we.enabled&&(ue.add(me),we.features&&Object.entries(we.features).forEach(([Ie,_e])=>{_e&&oe.add(`${me}:${Ie}`)}),we.dashboards&&Object.entries(we.dashboards).forEach(([Ie,_e])=>{_e&&le.add(`${me}:${Ie}`)}))}),w(ue),W(oe),U(le);for(const me of ne){const we=String(me||"").trim();we.startsWith("home:")&&X.add(we)}Y(X)}catch{p("Failed to load role details")}finally{h(!1)}}function V(K,J){const te=new Set(I),se=new Set(E),ae=new Set(R),ne=M[K];if(ne){te.add(K);for(const ue of ne.features||[]){const oe=`${K}:${ue.key}`;J?se.add(oe):se.delete(oe)}for(const ue of ne.dashboards||[]){const oe=`${K}:${ue.key}`;J?ae.add(oe):ae.delete(oe)}w(te),W(se),U(ae)}}function P(K,J){const te=`home:${K}`,se=new Set(T);J?se.add(te):se.delete(te),Y(se)}function C(K){i(K),F({name:K.name,code:K.code,is_active:K.is_active}),L(K.id)}function k(K,J){const te=new Set(I),se=new Set(E),ae=new Set(R);if(J)te.add(K);else{te.delete(K);const ne=M[K];ne.features.forEach(ue=>se.delete(`${K}:${ue.key}`)),ne.dashboards.forEach(ue=>ae.delete(`${K}:${ue.key}`))}w(te),W(se),U(ae)}function B(K,J){const[te]=K.split(":"),se=new Set(I),ae=new Set(E);J?(se.add(te),ae.add(K)):ae.delete(K),w(se),W(ae)}function G(K,J){const[te]=K.split(":"),se=new Set(I),ae=new Set(R);J?(se.add(te),ae.add(K)):ae.delete(K),w(se),U(ae)}async function O(){var K,J;if(n){h(!0);try{const te=Number(n.id);await Z.post("/admin/role-modules",{role_id:te,modules:Array.from(I)});const se=[...Array.from(E),...Array.from(R),...Array.from(T)];await Z.post("/admin/role-features",{role_id:te,features:se});const ae=se.map(ne=>{const[ue]=String(ne).split(":");return{role_id:te,module_key:String(ue||""),feature_key:String(ne),can_view:!0,can_create:!1,can_edit:!1,can_delete:!1}});ae.length>0&&await Z.post("/admin/role-permissions",{permissions:ae}),x("Role saved successfully"),ct.success("Role saved successfully"),setTimeout(()=>x(""),2e3),t("/administration/access/roles");try{window.dispatchEvent(new Event("rbac:changed"))}catch{}try{await s()}catch{}}catch(te){const se=((J=(K=te.response)==null?void 0:K.data)==null?void 0:J.message)||te.message||"Failed to save assignments";p(se)}finally{h(!1)}}}return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Role Setup"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Create roles and assign module permissions"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>t("/admin"),children:"Back to Admin"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>y(!0),children:"Create Role"})]})]}),m&&e.jsx("div",{className:"alert alert-error",children:m}),g&&e.jsx("div",{className:"alert alert-success",children:g}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Roles"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:r.map(K=>e.jsxs("tr",{className:(n==null?void 0:n.id)===K.id?"bg-blue-50":"",children:[e.jsx("td",{className:"font-medium",children:K.name}),e.jsx("td",{children:K.code}),e.jsx("td",{children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${K.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:K.is_active?"Active":"Inactive"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>C(K),children:"Configure"}),e.jsx("button",{className:"btn btn-sm btn-secondary",onClick:()=>{F({name:K.name,code:K.code,is_active:K.is_active}),i(K)},children:"Edit"})]})})]},K.id))})]})})]})}),n&&e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold",children:["Configure: ",n.name]}),e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsx("input",{type:"text",className:"input",placeholder:"Role Name",value:_.name,onChange:K=>F({..._,name:K.target.value})}),e.jsx("input",{type:"text",className:"input",placeholder:"Role Code",value:_.code,onChange:K=>F({..._,code:K.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"checkbox",checked:_.is_active,onChange:K=>F({..._,is_active:K.target.checked})}),"Active"]}),e.jsx("button",{className:"btn btn-secondary",onClick:Q,children:"Update Role"})]})]}),e.jsx("button",{className:"btn btn-success",onClick:O,disabled:c,children:c?"Saving...":"Save Role"})]}),e.jsx("div",{className:"space-y-6",children:Object.entries(M).map(([K,J])=>{const te=I.has(K),se=(J.features||[]).map(le=>`${K}:${le.key}`),ae=(J.dashboards||[]).map(le=>`${K}:${le.key}`),ne=se.length+ae.length,ue=se.filter(le=>E.has(le)).length+ae.filter(le=>R.has(le)).length,oe=ne>0&&ue===ne;return e.jsxs("div",{className:"border rounded-lg",children:[e.jsx("div",{className:"px-4 py-3 bg-slate-50 border-b",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",className:"checkbox",checked:te,onChange:le=>k(K,le.target.checked)}),e.jsxs("span",{className:"font-semibold text-lg",children:[J.icon," ",J.name]})]}),te&&e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:oe,onChange:le=>V(K,le.target.checked)}),"Select All"]})]})}),te&&e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Features:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:J.features.map(le=>{const X=`${K}:${le.key}`,me=E.has(X);return e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:me,onChange:we=>B(X,we.target.checked)}),e.jsx("span",{className:"text-sm",children:le.label})]},le.key)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Dashboards:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:J.dashboards.map(le=>{const X=`${K}:${le.key}`,me=R.has(X);return e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:me,onChange:we=>G(X,we.target.checked)}),e.jsx("span",{className:"text-sm",children:le.label})]},le.key)})})]})]})]},K)})}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsx("div",{className:"px-4 py-3 bg-slate-50 border-b",children:e.jsx("div",{className:"font-semibold text-lg",children:"Homepage Dashboards"})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:H.map(K=>{const J=`home:${K.key}`,te=T.has(J);return e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:te,onChange:se=>P(K.key,se.target.checked)}),e.jsx("span",{className:"text-sm",children:K.label})]},K.key)})})})]})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow max-w-md w-full",children:[e.jsx("div",{className:"px-5 py-4 border-b",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Create New Role"})}),e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Role Name"}),e.jsx("input",{type:"text",className:"input",value:j.name,onChange:K=>N({...j,name:K.target.value}),placeholder:"e.g., Sales Manager"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Role Code"}),e.jsx("input",{type:"text",className:"input",value:j.code,onChange:K=>N({...j,code:K.target.value}),placeholder:"e.g., SALES_MANAGER"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"checkbox",checked:j.is_active,onChange:K=>N({...j,is_active:K.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]})]}),e.jsxs("div",{className:"px-5 py-4 border-t flex justify-end gap-2",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>y(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:z,children:"Create Role"})]})]})})]})}function ore(){const t=ps(),{refreshPermissions:s}=Ls(),[r,a]=f.useState([]),[n,i]=f.useState(null),[l,o]=f.useState([]),[d,u]=f.useState([]),[c,h]=f.useState(!1),[m,p]=f.useState(""),[g,x]=f.useState(""),b=Bn;f.useEffect(()=>{y()},[]);async function y(){try{const w=await Z.get("/admin/roles");a(w.data||[])}catch{p("Failed to load roles")}}async function j(w){h(!0);try{const[E,W]=await Promise.all([Z.get(`/admin/role-modules/${w}`),Z.get(`/admin/role-permissions/${w}`)]);o(E.data||[]),u(W.data||[])}catch{p("Failed to load role permissions"),o([]),u([])}finally{h(!1)}}function N(w){const E=r.find(W=>Number(W.id)===Number(w));i(E),j(w)}f.useEffect(()=>{if(n){const w=[];Object.entries(b).forEach(([E,W])=>{W.features.forEach(R=>{w.push(`${E}:${R.key}`)}),W.dashboards.forEach(R=>{w.push(`${E}:${R.key}`)})}),u(E=>{const W=new Set(E.map(U=>U.feature_key)),R=[];return w.forEach(U=>{if(!W.has(U)){const[T]=U.split(":");R.push({role_id:n.id,module_key:T,feature_key:U,can_view:!1,can_create:!1,can_edit:!1,can_delete:!1})}}),[...E,...R]})}},[n]);function _(w,E,W){u(R=>{if(R.find(T=>T.feature_key===w))return R.map(T=>T.feature_key===w?{...T,[E]:W}:T);{const[T]=w.split(":");return[...R,{role_id:n.id,module_key:T,feature_key:w,can_view:E==="can_view"?W:!1,can_create:E==="can_create"?W:!1,can_edit:E==="can_edit"?W:!1,can_delete:E==="can_delete"?W:!1}]}})}async function F(){var w,E;if(n){h(!0);try{await Z.post("/admin/role-permissions",{permissions:d});try{window.dispatchEvent(new Event("rbac:changed"))}catch{}try{await s()}catch{}x("Permissions saved successfully"),ct.success("Permissions saved successfully"),setTimeout(()=>x(""),1500),t("/administration/access/user-permissions")}catch(W){p(((E=(w=W.response)==null?void 0:w.data)==null?void 0:E.message)||"Failed to save permissions")}finally{h(!1)}}}function I(){return Object.entries(b)}return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"User Permissions"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Assign action-level permissions for role features"})]}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>t("/admin"),children:"Back to Admin"})]}),m&&e.jsx("div",{className:"alert alert-error",children:m}),g&&e.jsx("div",{className:"alert alert-success",children:g}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Select Role"}),e.jsxs("div",{className:"max-w-md",children:[e.jsx("label",{className:"label",children:"Role"}),e.jsxs("select",{className:"input",value:(n==null?void 0:n.id)||"",onChange:w=>N(Number(w.target.value)),children:[e.jsx("option",{value:"",children:"Choose a role..."}),r.map(w=>e.jsxs("option",{value:w.id,children:[w.name," (",w.code,")"]},w.id))]})]})]})}),n&&e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold",children:["Permissions for: ",n.name]}),e.jsx("button",{className:"btn btn-success",onClick:F,disabled:c,children:c?"Saving...":"Save Permissions"})]}),c?e.jsx("div",{className:"text-center py-8",children:"Loading permissions..."}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Module"}),e.jsx("th",{children:"Feature"}),e.jsx("th",{className:"text-center w-20",children:"View"}),e.jsx("th",{className:"text-center w-20",children:"Create"}),e.jsx("th",{className:"text-center w-20",children:"Edit"}),e.jsx("th",{className:"text-center w-20",children:"Delete"})]})}),e.jsx("tbody",{children:I().map(([w,E])=>{const W=l.some(T=>String(T.module_key)===String(w)),R=Array.isArray(E==null?void 0:E.features)?E.features:[],U=Array.isArray(E==null?void 0:E.dashboards)?E.dashboards:[];return e.jsxs(Is.Fragment,{children:[R.map(T=>{const Y=`${w}:${T.key}`;let H=d.find(M=>M.feature_key===Y);return H||(H={role_id:n.id,module_key:w,feature_key:Y,can_view:!1,can_create:!1,can_edit:!1,can_delete:!1}),e.jsxs("tr",{children:[e.jsxs("td",{className:"font-medium",children:[E.icon," ",E.name]}),e.jsx("td",{children:T.label}),e.jsx("td",{className:"text-center",children:e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:H.can_view,disabled:!W,onChange:M=>_(Y,"can_view",M.target.checked)})}),e.jsx("td",{className:"text-center",children:e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:H.can_create,disabled:!W,onChange:M=>_(Y,"can_create",M.target.checked)})}),e.jsx("td",{className:"text-center",children:e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:H.can_edit,disabled:!W,onChange:M=>_(Y,"can_edit",M.target.checked)})}),e.jsx("td",{className:"text-center",children:e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:H.can_delete,disabled:!W,onChange:M=>_(Y,"can_delete",M.target.checked)})})]},Y)}),U.map(T=>{const Y=`${w}:${T.key}`;let H=d.find(M=>M.feature_key===Y);return H||(H={role_id:n.id,module_key:w,feature_key:Y,can_view:!1,can_create:!1,can_edit:!1,can_delete:!1}),e.jsxs("tr",{children:[e.jsxs("td",{className:"font-medium",children:[E.icon," ",E.name]}),e.jsx("td",{className:"italic",children:T.label}),e.jsx("td",{className:"text-center",children:e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:H.can_view,disabled:!W,onChange:M=>_(Y,"can_view",M.target.checked)})}),e.jsx("td",{className:"text-center",colSpan:"3",children:e.jsx("span",{className:"text-xs text-slate-500",children:"Dashboard - View only"})})]},Y)})]},w)})})]}),d.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-500",children:"No permissions configured for this role. Please configure the role in Role Setup first."})]})]})})]})}function cre(){const[t,s]=f.useState([]),[r,a]=f.useState(!1),n=fg(),i=ps();f.useEffect(()=>{if(n)return n.on("new_post",d=>{s(u=>[...u,{id:`post_${d.id}`,type:"post",postId:d.id,post:d,timestamp:new Date}]),"Notification"in window&&Notification.permission==="granted"&&new Notification(`${d.full_name} posted`,{body:d.content.substring(0,100),icon:d.profile_picture_url||"/default-avatar.png"})}),n.on("post_commented",d=>{s(u=>[...u,{id:`comment_${d.comment.id}`,type:"comment",postId:d.postId,comment:d.comment,timestamp:new Date}]),"Notification"in window&&Notification.permission==="granted"&&new Notification(`${d.comment.full_name} commented`,{body:d.comment.comment_text.substring(0,100),icon:d.comment.profile_picture||" "})}),()=>{n.off("new_post"),n.off("post_commented")}},[n]);const l=()=>{a(!0)},o=d=>{a(!1),s(u=>u.filter(c=>c.postId!==d.postId)),i(`/social-feed/${d.postId}`)};return e.jsxs(e.Fragment,{children:[t.length>0&&e.jsxs("button",{onClick:l,className:"social-feed-notification-badge",title:`${t.length} unread item${t.length!==1?"s":""}`,children:[e.jsx("div",{className:"badge-pulse"}),e.jsx("div",{className:"badge-content",children:t.length>99?"99+":t.length})]}),r&&e.jsx("div",{className:"social-feed-notification-overlay",children:e.jsxs("div",{className:"social-feed-notification-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["Unread Activity (",t.length,")"]}),e.jsx("button",{onClick:()=>a(!1),className:"close-button",children:""})]}),e.jsx("div",{className:"modal-list",children:t.map(d=>e.jsx("div",{onClick:()=>o(d),className:"modal-item",children:d.type==="post"?e.jsxs("div",{children:[e.jsx("p",{className:"item-user",children:d.post.full_name}),e.jsx("p",{className:"item-content",children:d.post.content}),e.jsx("p",{className:"item-type",children:"New Post"})]}):e.jsxs("div",{children:[e.jsx("p",{className:"item-user",children:d.comment.full_name}),e.jsx("p",{className:"item-content",children:d.comment.comment_text}),e.jsx("p",{className:"item-type",children:"New Comment"})]})},d.id))})]})})]})}function dre(){const t=ps(),[s,r]=f.useState([]),[a,n]=f.useState(""),[i,l]=f.useState(!1),[o,d]=f.useState(""),[u,c]=f.useState(""),[h,m]=f.useState([]),p=f.useMemo(()=>{const j=Object.entries(Bn).map(([N,_])=>({key:N,name:_.name,icon:_.icon,dashboards:_.dashboards||[]}));return j.unshift({key:"home",name:"Home",icon:"",dashboards:[]}),j},[]),g=f.useMemo(()=>({home:[{key:"today-sales",label:"Today Sales"},{key:"total-customers",label:"Total Customers"},{key:"average-order",label:"Average Order"},{key:"monthly-revenue",label:"Monthly Revenue"}],administration:[{key:"total-users",label:"Total Users"},{key:"active-sessions",label:"Active Sessions"},{key:"pending-workflows",label:"Pending Workflows"}],sales:[{key:"total-sales",label:"Total Sales"},{key:"open-orders",label:"Open Orders"},{key:"pending-deliveries",label:"Pending Deliveries"}],inventory:[{key:"items-tracked",label:"Items Tracked"},{key:"pending-requisitions",label:"Pending Requisitions"},{key:"incoming-transfers",label:"Incoming Transfers"}],finance:[{key:"cash-balance",label:"Cash Balance"},{key:"pending-vouchers",label:"Pending Vouchers"},{key:"monthly-expenses",label:"Monthly Expenses"}],"human-resources":[{key:"active-employees",label:"Active Employees"},{key:"on-leave",label:"On Leave"},{key:"payroll-status",label:"Payroll Status"}],maintenance:[{key:"open-work-orders",label:"Open Work Orders"},{key:"overdue-pms",label:"Overdue PMs"},{key:"asset-health",label:"Asset Health"}],production:[{key:"active-work-orders",label:"Active Work Orders"},{key:"efficiency",label:"Efficiency"},{key:"active-boms",label:"Active BOMs"}],"project-management":[{key:"active-projects",label:"Active Projects"},{key:"open-tasks",label:"Open Tasks"},{key:"on-time-completion",label:"On Time Completion"}],pos:[{key:"today-sales",label:"Today Sales"},{key:"total-customers",label:"Total Customers"},{key:"average-order",label:"Average Order"},{key:"monthly-revenue",label:"Monthly Revenue"}],"business-intelligence":[{key:"active-dashboards",label:"Active Dashboards"},{key:"scheduled-reports",label:"Scheduled Reports"},{key:"data-sources",label:"Data Sources"}],"service-management":[{key:"open-requests",label:"Open Requests"},{key:"pending-bills",label:"Pending Bills"},{key:"confirmed-services",label:"Confirmed Services"}]}),[]);f.useEffect(()=>{async function j(){var N;try{const _=await Z.get("/admin/users"),F=(_.data&&_.data.data&&Array.isArray(_.data.data.items)?_.data.data.items:Array.isArray((N=_.data)==null?void 0:N.items)?_.data.items:[])||[];r(F)}catch{r([])}}j()},[]),f.useEffect(()=>{async function j(){var N;if(!a){m([]);return}try{const _=await Z.get(`/access/dashboard-permissions?user_id=${a}`),F=Array.isArray((N=_.data)==null?void 0:N.items)?_.data.items:[];m(F)}catch{m([])}}j()},[a]);const x=(j,N,_=null,F=null)=>{const I=h.find(w=>String(w.module_key)===String(j)&&String(w.dashboard_key||"")===String(N||"")&&String(w.card_key||"")===String(_||"")&&String(w.ticker_key||"")===String(F||""));return!!(I!=null&&I.can_view)},b=(j,N,_,F,I)=>{m(w=>{const E=[...w],W=E.findIndex(R=>String(R.module_key)===String(j)&&String(R.dashboard_key||"")===String(N||"")&&String(R.card_key||"")===String(_||"")&&String(R.ticker_key||"")==="");return W>=0?E[W]={...E[W],can_view:I?1:0}:E.push({user_id:Number(a),module_key:j,dashboard_key:N||null,card_key:_||null,ticker_key:null,can_view:I?1:0}),E})},y=async(j,N,_,F)=>{var I,w;if(a)try{await Z.put("/access/dashboard-permissions",{user_id:Number(a),permissions:[{user_id:Number(a),module_key:j,dashboard_key:N==="dashboard"?_:null,card_key:N==="card"?_:null,ticker_key:N==="ticker"?_:null,can_view:F?1:0}]}),ct.success("Permission updated")}catch(E){ct.error(((w=(I=E==null?void 0:E.response)==null?void 0:I.data)==null?void 0:w.message)||"Failed to update permission")}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Dashboard Permissions"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Control which dashboards/cards/tickers a user can view"})]}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>t("/administration"),children:"Back to Admin"})]}),o&&e.jsx("div",{className:"alert alert-error",children:o}),u&&e.jsx("div",{className:"alert alert-success",children:u}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"max-w-md",children:[e.jsx("label",{className:"label",children:"User"}),e.jsxs("select",{className:"input w-full",value:a,onChange:j=>n(j.target.value),children:[e.jsx("option",{value:"",children:"Choose a user"}),s.map(j=>e.jsx("option",{value:j.id,children:j.username||j.full_name||`User #${j.id}`},j.id))]})]}),a&&e.jsx("div",{className:"space-y-6",children:p.map(j=>e.jsxs("div",{className:"border rounded-lg",children:[e.jsx("div",{className:"px-4 py-3 bg-slate-50 border-b",children:e.jsxs("div",{className:"font-semibold",children:[j.icon," ",j.name]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Dashboards"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:j.dashboards.map(N=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:x(j.key,N.key),onChange:_=>{b(j.key,N.key,null,null,_.target.checked),y(j.key,"dashboard",N.key,_.target.checked)}}),e.jsx("span",{className:"text-sm",children:N.name||N.label})]},N.key))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Cards"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:(g[j.key]||[]).map(N=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm",checked:x(j.key,null,N.key,null),onChange:_=>{b(j.key,null,N.key,null,_.target.checked),y(j.key,"card",N.key,_.target.checked)}}),e.jsx("span",{className:"text-sm",children:N.label})]},N.key))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Tickers"}),e.jsx(ure,{entries:h.filter(N=>N.module_key===j.key&&!N.dashboard_key&&!N.card_key&&N.ticker_key),onChange:N=>{m(_=>{const F=_.filter(w=>!(w.module_key===j.key&&!w.dashboard_key&&!w.card_key&&w.ticker_key)),I=N.map(w=>({user_id:Number(a),module_key:j.key,dashboard_key:null,card_key:null,ticker_key:w,can_view:1}));return I.forEach(w=>y(j.key,"ticker",w.ticker_key,!0)),F.concat(I)})}})]})]})]},j.key))})]})})]})}function ure({entries:t=[],onChange:s}){const[r,a]=f.useState(""),n=t.filter(o=>o.can_view).map(o=>o.card_key||o.ticker_key).filter(Boolean),i=o=>{const d=n.filter(u=>String(u)!==String(o));s(d)},l=()=>{const o=r.trim();o&&(n.includes(o)||s([...n,o]),a(""))};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"input flex-1",placeholder:"Enter key (e.g., total-sales)",value:r,onChange:o=>a(o.target.value)}),e.jsx("button",{type:"button",className:"btn",onClick:l,children:"Add"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.map(o=>e.jsxs("span",{className:"px-2 py-1 rounded-full bg-slate-100 text-slate-700 text-xs flex items-center gap-2",children:[o,e.jsx("button",{type:"button",className:"text-slate-500 hover:text-slate-700",onClick:()=>i(o),title:"Remove",children:""})]},o)),!n.length&&e.jsx("span",{className:"text-xs text-slate-500",children:"No entries. Add keys to allow viewing."})]})]})}const mre="/assets/OMNISUITE_WHITE_LOGO-C3pcEyUY.png";function hre(){const[t,s]=f.useState(()=>Pk()),[r,a]=f.useState(null);f.useEffect(()=>{const d=ZI(({event:u,snapshot:c})=>{s(c),a(u)});return()=>d()},[]);const n=f.useMemo(()=>t.pending||0,[t.pending]),i=f.useMemo(()=>t.failed||0,[t.failed]),l=f.useMemo(()=>t.completed||0,[t.completed]),o=f.useMemo(()=>t.items||[],[t.items]);return{lastEvent:r,pending:n,failed:i,completed:l,items:o}}function Are(){const[t,s]=f.useState(null),[r,a]=f.useState(!1),[n,i]=f.useState(!1);f.useEffect(()=>{i("serviceWorker"in navigator);function u(p){s(p)}function c(){a(!0),s(null)}window.addEventListener("beforeinstallprompt",u),window.addEventListener("appinstalled",c);const h=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches,m=navigator.standalone===!0;return(h||m)&&a(!0),()=>{window.removeEventListener("beforeinstallprompt",u),window.removeEventListener("appinstalled",c)}},[]);const l=f.useMemo(()=>!!t,[t]);async function o(){var c;if(!t)return!1;const u=await((c=t.prompt)==null?void 0:c.call(t));return s(null),u}function d(){s(null)}return{isInstallable:l,isInstalled:r,isPWASupported:n,handleInstall:o,dismissPrompt:d}}function fre(){const{isInstallable:t,isInstalled:s,isPWASupported:r,handleInstall:a}=Are(),[n,i]=f.useState(!1),[l,o]=f.useState(!1),[d,u]=f.useState(typeof window<"u"?window.innerWidth:1920);return f.useEffect(()=>{function c(){u(window.innerWidth)}return window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]),f.useEffect(()=>{const c=r&&!s&&(t||/Mobile|Android|iPad|iPhone/.test(navigator.userAgent))&&d<=1024;o(c)},[t,s,r,d]),l?e.jsxs("div",{className:"fixed bottom-4 right-4 z-[60] flex flex-col items-end gap-2",children:[n&&e.jsxs("div",{className:"card p-3 shadow-erp-lg bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Install"}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:/iPad|iPhone|iPod/.test(navigator.userAgent)?"Tap Share  Add to Home Screen":"Tap menu  Install / Add to Home Screen"}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx("button",{type:"button",className:"btn-secondary px-2 py-1",onClick:()=>i(!1),children:"Close"})})]}),e.jsx("button",{type:"button",className:"btn-primary rounded-full w-12 h-12 shadow-erp-lg flex items-center justify-center","aria-label":"Install app",onClick:async()=>{t?await a()||i(!0):(i(!0),setTimeout(()=>i(!1),4e3))},title:"Install OmniSuite",children:e.jsx(Cc,{className:"w-5 h-5"})})]}):null}function pre({items:t,activeId:s,onOpen:r}){return e.jsxs("div",{className:"w-[290px] border-r border-slate-200 bg-slate-50 h-full overflow-auto",children:[e.jsx("div",{className:"p-2 font-semibold text-slate-700",children:"Chats"}),t.map(a=>e.jsxs("button",{onClick:()=>r(a),className:"w-full text-left px-3 py-2 flex items-center gap-3 hover:bg-white "+(s===a.id?"bg-white":""),children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-800",children:a.title||`Conversation #${a.id}`}),e.jsx("div",{className:"text-[11px] text-slate-500",children:a.last_preview||""})]}),e.jsxs("div",{className:"text-right w-14",children:[e.jsx("div",{className:"text-[10px] text-slate-500",children:a.last_time?new Date(a.last_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""}),!!a.unread_count&&e.jsx("div",{className:"mt-1 inline-flex min-w-5 h-5 items-center justify-center rounded-full bg-green-600 text-white text-[10px] px-1",children:a.unread_count})]})]},a.id))]})}function xre({items:t,myId:s}){const r=f.useRef(null);return f.useEffect(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)},[t]),e.jsx("div",{ref:r,className:"flex-1 overflow-auto p-4 space-y-2 bg-[url('/whatsapp-paper.png')] bg-repeat",children:t.map(a=>{const n=Number(a.sender_id)===Number(s),i=a.status==="read"||a.status==="delivered"?"":"",l=a.status==="read"?"text-blue-500":"text-slate-400",o=String(a.message_type||"text").toLowerCase();return e.jsx("div",{className:"flex "+(n?"justify-end":"justify-start"),children:e.jsxs("div",{className:"max-w-[70%] px-3 py-2 rounded-2xl text-sm shadow "+(n?"bg-green-100 text-slate-900 rounded-br-sm":"bg-white text-slate-900 rounded-bl-sm border border-slate-200"),children:[o==="text"&&e.jsx("span",{children:a.content}),o==="image"&&e.jsx("img",{src:a.content,alt:a.file_name||"image",className:"max-w-full rounded",loading:"lazy"}),o==="video"&&e.jsx("video",{src:a.content,className:"max-w-full rounded",controls:!0,preload:"metadata"}),o==="document"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:""}),e.jsx("a",{href:a.content,target:"_blank",rel:"noreferrer",className:"underline",children:a.file_name||"Document"}),a.file_size!=null&&e.jsxs("span",{className:"text-[10px] text-slate-500",children:["(",Math.round(Number(a.file_size)/1024)," KB)"]})]}),o==="contact"&&e.jsx(gre,{content:a.content}),e.jsxs("div",{className:"text-[10px] text-slate-500 mt-1 text-right flex items-center gap-1",children:[e.jsx("span",{children:new Date(a.sent_at||a.created_at||Date.now()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),n&&e.jsx("span",{className:l,children:i})]})]})},a.id)})})}function gre({content:t}){let s=null;try{s=typeof t=="string"?JSON.parse(t):t}catch{}return s?e.jsxs("div",{className:"border rounded-lg p-2 bg-white",children:[e.jsx("div",{className:"font-semibold text-sm",children:s.name||s.username}),e.jsx("div",{className:"text-[11px] text-slate-600",children:s.email||""}),e.jsx("div",{className:"text-[11px] text-slate-600",children:s.phone||""})]}):e.jsx("div",{className:"text-sm",children:"Contact"})}function vre({onClose:t}){const s=fg(),{user:r}=Kr(),a=Number((r==null?void 0:r.sub)||(r==null?void 0:r.id)),[n,i]=f.useState([]),[l,o]=f.useState(null),[d,u]=f.useState([]),[c,h]=f.useState(""),[m,p]=f.useState(new Set),[g,x]=f.useState(!1),[b,y]=f.useState(""),[j,N]=f.useState([]),[_,F]=f.useState(!1),[I,w]=f.useState(0);async function E(){var q;try{const z=await Z.get("/chat/conversations");i(Array.isArray((q=z.data)==null?void 0:q.items)?z.data.items:[])}catch{i([])}}async function W(q){var z;o(q);try{const Q=await Z.get(`/chat/conversations/${q.id}/messages`);u(Array.isArray((z=Q.data)==null?void 0:z.items)?Q.data.items:[]),await Z.post(`/chat/conversations/${q.id}/read`)}catch{u([])}s&&s.emit("join_conversation",q.id)}f.useEffect(()=>{E()},[]),f.useEffect(()=>{if(!s)return;const q=L=>{l&&Number(L.conversation_id)===Number(l.id)&&u(V=>V.concat(L)),E()},z=({conversation_id:L,user_id:V})=>{!l||Number(L)!==Number(l.id)||Number(V)!==a&&p(P=>new Set(P).add(V))},Q=({conversation_id:L,user_id:V})=>{!l||Number(L)!==Number(l.id)||p(P=>{const C=new Set(P);return C.delete(V),C})};return s.on("receive_message",q),s.on("typing_start",z),s.on("typing_stop",Q),()=>{s.off("receive_message",q),s.off("typing_start",z),s.off("typing_stop",Q)}},[s,l,a]);async function R(){if(!l||!c.trim())return;const q=c.trim(),z={id:`tmp-${Date.now()}`,conversation_id:l.id,sender_id:a,message_type:"text",content:q,status:"sent",sent_at:new Date().toISOString()};u(Q=>Q.concat(z)),h("");try{await Z.post("/chat/messages",{conversation_id:l.id,content:q})}catch{}}function U(){if(!s||!l)return;s.emit("typing_start",{conversation_id:l.id});const q=setTimeout(()=>{s.emit("typing_stop",{conversation_id:l.id})},1200);return()=>clearTimeout(q)}const T=f.useMemo(()=>m.size>0,[m]);async function Y(){var q;try{const z=await Z.get(`/chat/users?q=${encodeURIComponent(b||"")}`),Q=Array.isArray((q=z.data)==null?void 0:q.items)?z.data.items:[];N(Q)}catch{N([])}}f.useEffect(()=>{g&&Y()},[g,b]);async function H(q){var z;try{const Q=await Z.post("/chat/conversations/direct",{user_id:q.id}),L=Number(((z=Q.data)==null?void 0:z.id)||0)||null;if(L){x(!1),await E();const V={id:L,title:q.username};await W(V)}}catch{}}async function M(q){var L,V,P,C;if(!q||!l)return;const z=q.type||"",Q=z.startsWith("image/")?"image":z.startsWith("video/")?"video":"document";F(!0),w(0);try{const k=new FormData;k.append("file",q);const B=await Z.post("/chat/upload",k,{onUploadProgress:J=>{if(!J||!J.total)return;const te=Math.round(J.loaded*100/J.total);w(te)},headers:{"Content-Type":"multipart/form-data"}}),G=((L=B.data)==null?void 0:L.url)||((V=B.data)==null?void 0:V.path),O=((P=B.data)==null?void 0:P.file_name)||q.name,K=((C=B.data)==null?void 0:C.file_size)||q.size;u(J=>J.concat({id:`tmp-${Date.now()}`,conversation_id:l.id,sender_id:a,message_type:Q,content:G,file_name:O,file_size:K,status:"sent",sent_at:new Date().toISOString()})),await Z.post("/chat/messages",{conversation_id:l.id,content:G,message_type:Q,file_name:O,file_size:K}),await E()}catch{}finally{F(!1),w(0)}}return e.jsxs("div",{className:"fixed right-4 bottom-20 md:right-6 md:bottom-20 z-50",children:[e.jsxs("div",{className:"w-[880px] max-w-[95vw] h-[520px] rounded-xl shadow-erp-lg bg-white border border-slate-200 overflow-hidden flex",children:[e.jsx(pre,{items:n,activeId:l==null?void 0:l.id,onOpen:W}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"px-3 py-2 border-b border-slate-200 flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold text-slate-800",children:l?l.title||`Conversation #${l.id}`:"Chat"}),e.jsx("div",{className:"text-[11px] text-slate-500",children:T?"typing":""}),e.jsx("button",{onClick:t,className:"rounded px-2 py-1 text-sm hover:bg-slate-100",children:"Close"})]}),l?e.jsx(xre,{items:d,myId:a}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("button",{className:"btn",onClick:()=>x(!0),children:"New Chat"})}),e.jsx("div",{className:"p-2 border-t border-slate-200 flex items-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",accept:"image/*,video/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/zip",onChange:q=>{var Q;const z=(Q=q.target.files)==null?void 0:Q[0];z&&M(z),q.target.value=""}}),_&&e.jsxs("div",{className:"text-xs text-slate-500",children:[I,"%"]}),e.jsx("input",{value:c,onChange:q=>h(q.target.value),onKeyDown:q=>{q.key==="Enter"?R():U()},placeholder:"Type a message",className:"input flex-1"}),e.jsx("button",{className:"btn",onClick:R,children:"Send"})]}):e.jsx("button",{className:"btn",onClick:()=>x(!0),children:"Start Chat"})})]})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-[60]",children:e.jsxs("div",{className:"bg-white w-[520px] max-w-[95vw] rounded-lg shadow-erp-lg border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b border-slate-200 flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:"Select Recipient"}),e.jsx("button",{className:"px-2 py-1 rounded hover:bg-slate-100",onClick:()=>x(!1),children:"Close"})]}),e.jsx("div",{className:"p-3",children:e.jsx("input",{className:"input w-full",placeholder:"Search users",value:b,onChange:q=>y(q.target.value)})}),e.jsxs("div",{className:"max-h-[360px] overflow-auto",children:[j.map(q=>{var z;return e.jsxs("button",{className:"w-full flex items-center gap-3 px-3 py-2 hover:bg-slate-50",onClick:()=>H(q),children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-slate-200 flex items-center justify-center",children:e.jsx("span",{className:"text-xs",children:(z=q.username)==null?void 0:z.slice(0,2).toUpperCase()})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"text-sm font-semibold",children:q.username}),e.jsx("div",{className:"text-[11px] text-slate-500",children:q.full_name||""})]}),e.jsx("div",{className:"w-2 h-2 rounded-full "+(q.is_online?"bg-green-500":"bg-slate-400"),title:q.is_online?"Online":"Offline"})]},q.id)}),!j.length&&e.jsx("div",{className:"p-4 text-sm text-slate-500",children:"No users found"})]})]})})]})}function bre(){const[t,s]=f.useState(!1),[r,a]=f.useState(0),n=fg(),i=async()=>{var o;try{const d=await Z.get("/chat/unread-count");a(Number(((o=d==null?void 0:d.data)==null?void 0:o.unread)||0))}catch{a(0)}};f.useEffect(()=>{i()},[]),f.useEffect(()=>{if(!n)return;const o=()=>i();return n.on("receive_message",o),n.on("message_delivered",o),n.on("message_read",o),()=>{n.off("receive_message",o),n.off("message_delivered",o),n.off("message_read",o)}},[n]);const l=f.useMemo(()=>r?e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-600 text-white text-[10px] font-bold rounded-full px-1.5 py-[2px] shadow",children:r>99?"99+":r}):null,[r]);return e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button","aria-label":"Open chat",onClick:()=>s(!0),"data-rbac-exempt":"true",className:"fixed z-[9999] md:right-6 md:bottom-6 w-12 h-12 rounded-full shadow-xl text-white flex items-center justify-center hover:scale-105 active:scale-95 transition-transform",style:{backgroundColor:"#22C55E",right:16,bottom:"calc(env(safe-area-inset-bottom, 0px) + 16px)"},children:[e.jsxs("svg",{width:"26",height:"26",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("path",{d:"M20.52 3.48A11.5 11.5 0 0 0 3.48 20.52L2 22l3.02-.4A11.5 11.5 0 1 0 20.52 3.48zM12 20.5c-1.8 0-3.47-.53-4.87-1.44l-.35-.22-1.8.24.25-1.75-.23-.36A8.5 8.5 0 1 1 12 20.5z",fill:"white",opacity:"0.9"}),e.jsx("path",{d:"M16.4 13.3c-.25-.12-1.48-.73-1.7-.82-.23-.08-.4-.12-.57.12-.17.25-.65.82-.8.99-.15.17-.3.18-.55.06-.25-.12-1.07-.39-2.05-1.25-.76-.68-1.28-1.52-1.43-1.77-.15-.25-.02-.39.1-.51.1-.1.25-.28.37-.42.12-.14.16-.25.24-.42.08-.17.04-.31-.02-.43-.06-.12-.57-1.37-.78-1.87-.2-.48-.41-.41-.57-.41h-.49c-.17 0-.43.06-.66.31-.23.25-.88.85-.88 2.08s.9 2.41 1.03 2.58c.12.17 1.78 2.72 4.33 3.82.61.26 1.09.41 1.46.53.61.19 1.17.16 1.6.1.49-.07 1.48-.6 1.69-1.18.21-.58.21-1.07.15-1.18-.06-.1-.22-.16-.47-.28z",fill:"white"})]}),l]}),t&&e.jsx(vre,{onClose:()=>s(!1)})]})}const GC={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},KC=[{key:"administration",label:"Administration",path:"/administration",icon:""},{key:"sales",label:"Sales",path:"/sales",icon:""},{key:"inventory",label:"Inventory",path:"/inventory",icon:""},{key:"purchase",label:"Purchase",path:"/purchase",icon:""},{key:"finance",label:"Finance",path:"/finance",icon:""},{key:"human-resources",label:"Human Resources",path:"/human-resources",icon:""},{key:"maintenance",label:"Maintenance",path:"/maintenance",icon:""},{key:"project-management",label:"Project Management",path:"/project-management",icon:""},{key:"production",label:"Production",path:"/production",icon:""},{key:"pos",label:"POS",path:"/pos",icon:""},{key:"business-intelligence",label:"Business Intelligence",path:"/business-intelligence",icon:""},{key:"service-management",label:"Service Management",path:"/service-management",icon:""}];function yre(){const{token:t,user:s,scope:r,setScope:a,logout:n}=Kr(),{isModuleEnabled:i,canPerformAction:l,globalOverrides:o,canPerformPageAction:d,ensurePagePerms:u,basePathFrom:c}=Ls(),{theme:h}=Mk(),{pending:m,failed:p,completed:g,items:x,lastEvent:b}=hre(),y=ps(),j=Ur(),[N,_]=f.useState(!1),[F,I]=f.useState(!1);f.useEffect(()=>{if(b==="queued"){I(!0);const _e=setTimeout(()=>I(!1),3e3);return()=>clearTimeout(_e)}},[b]);const[w,E]=f.useState(typeof navigator<"u"?navigator.onLine!==!1:!0);f.useEffect(()=>{function _e(){E(!0)}function Fe(){E(!1)}return window.addEventListener("online",_e),window.addEventListener("offline",Fe),()=>{window.removeEventListener("online",_e),window.removeEventListener("offline",Fe)}},[]),f.useEffect(()=>{try{if("serviceWorker"in navigator){const _e=Fe=>{const Le=(Fe==null?void 0:Fe.data)||{};Le.type==="navigate"&&typeof Le.url=="string"&&y(Le.url)};return navigator.serviceWorker.addEventListener("message",_e),()=>navigator.serviceWorker.removeEventListener("message",_e)}}catch{}},[y]),f.useEffect(()=>{try{if(typeof sessionStorage<"u"){const _e=j.pathname+(j.search||"");sessionStorage.setItem("last_path",_e)}}catch{}},[j.pathname,j.search]),f.useEffect(()=>{async function _e(){try{const Fe=j.pathname||"/",rt=(Fe.split("/").filter(Boolean)[0]||"dashboard").replace(/-/g," ").replace(/\b\w/g,He=>He.toUpperCase());try{await Z.post("/admin/activity/log",{module_name:rt,action:"VIEW",ref_no:String((s==null?void 0:s.username)||""),message:"Page View",url_path:Fe,event_time:new Date().toISOString()})}catch{}}catch{}}_e()},[j.pathname]);const[W,R]=f.useState(()=>typeof window<"u"?window.matchMedia("(min-width: 768px)").matches:!1),[U,T]=f.useState(!1),Y=f.useRef(null),[H,M]=f.useState(!1),[q,z]=f.useState(!1),[Q,L]=f.useState(0),[V,P]=f.useState(0),C=f.useMemo(()=>{const _e=(s==null?void 0:s.username)||(s==null?void 0:s.name)||"Guest",Fe=(s==null?void 0:s.role)||(Array.isArray(s==null?void 0:s.roles)?s.roles[0]:null)||"Developer",Le=(s==null?void 0:s.companyName)||`Company #${(r==null?void 0:r.companyId)??"-"}`,rt=(s==null?void 0:s.branchName)||`Branch #${(r==null?void 0:r.branchId)??"-"}`;return{username:_e,role:Fe,companyName:Le,branchName:rt}},[r==null?void 0:r.branchId,r==null?void 0:r.companyId,s]),k=f.useMemo(()=>Array.isArray(s==null?void 0:s.roles)?s.roles:s!=null&&s.role?[s.role]:[],[s==null?void 0:s.roles,s==null?void 0:s.role]),[B,G]=f.useState(()=>Array.isArray(s==null?void 0:s.roles)?s.roles[0]:(s==null?void 0:s.role)||null),[O,K]=f.useState([]),[J,te]=f.useState(!1);f.useEffect(()=>{const _e=Number((s==null?void 0:s.sub)||(s==null?void 0:s.id));if(!Number.isFinite(_e)){K([]);return}let Fe=!0;async function Le(){var rt,He,st;te(!0);try{const De=await Z.get(`/admin/users/${_e}/roles`),Te=(De.data&&De.data.data&&Array.isArray(De.data.data.items)?De.data.data.items:Array.isArray((rt=De.data)==null?void 0:rt.items)?De.data.items:[])||[];Fe&&K(Te),Fe&&Te.length>0&&!B&&G(((He=Te[0])==null?void 0:He.name)||((st=Te[0])==null?void 0:st.code)||null)}catch{Fe&&K([])}finally{Fe&&te(!1)}}return Le(),()=>{Fe=!1}},[]),f.useEffect(()=>{z(!1),L(0),P(0)},[r==null?void 0:r.companyId,r==null?void 0:r.branchId]),f.useEffect(()=>{let _e=!1;async function Fe(){var Le;try{let rt=function(he){const Ue="=".repeat((4-he.length%4)%4),Ye=(he+Ue).replace(/-/g,"+").replace(/_/g,"/"),Ke=window.atob(Ye),Je=new Uint8Array(Ke.length);for(let xe=0;xe<Ke.length;++xe)Je[xe]=Ke.charCodeAt(xe);return Je};const He=typeof localStorage<"u"?localStorage.getItem("push_enabled"):null;if(!(He===null?!0:String(He)==="1")||typeof window>"u"||!("serviceWorker"in navigator)||!("PushManager"in window)||!("Notification"in window)||window.Notification.permission!=="granted")return;const De=await navigator.serviceWorker.ready;let Te="";try{const he=await Z.get("/push/public-key");Te=String(((Le=he.data)==null?void 0:Le.publicKey)||"")}catch{Te=""}if(!Te)return;const Ce=rt(Te),Pe=await De.pushManager.getSubscription();if(Pe&&Pe.endpoint){try{await Z.post("/push/subscribe",{subscription:Pe.toJSON()})}catch{}return}const fe=await De.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Ce});if(_e)return;try{await Z.post("/push/subscribe",{subscription:fe.toJSON()})}catch{}}catch{}}return Fe(),()=>{_e=!0}},[t]),f.useEffect(()=>{let _e=null;async function Fe(){var rt,He;try{const st=await Z.get("/workflows/notifications"),De=Array.isArray((rt=st.data)==null?void 0:rt.items)?st.data.items:[],Te=De.filter(Ce=>Number(Ce.is_read)!==1).length;if(P(Te),typeof window<"u")try{const Ce="notified_notification_ids",Pe=localStorage.getItem(Ce),fe=Pe?JSON.parse(Pe):[],he=new Set(Array.isArray(fe)?fe:[]),Ue="Notification"in window&&((He=window.Notification)==null?void 0:He.permission)==="granted",Ye="/OMNISUITE_ICON_CLEAR.png";for(const Ke of De){const Je=Number(Ke.id);if(Number(Ke.is_read)!==1&&!he.has(Je)){try{Gv({title:String(Ke.title||"Notification"),message:String(Ke.message||""),native:Ue,icon:Ye,onClick:()=>{Ke.link?y(String(Ke.link)):y("/notifications")}})}catch{}he.add(Je)}}localStorage.setItem(Ce,JSON.stringify(Array.from(he)))}catch{}}catch{}}async function Le(){var rt,He;try{if(q)return;const st=await Z.get("/inventory/alerts/low-stock"),De=Array.isArray((rt=st.data)==null?void 0:rt.items)?st.data.items:[];if(!De.length)return;z(!0),L(De.length);const Te=De.length,Ce=typeof window<"u"&&"Notification"in window&&((He=window.Notification)==null?void 0:He.permission)==="granted",Pe="/OMNISUITE_ICON_CLEAR.png";if(Te<=5)for(const fe of De){const he=Number(fe.qty||0),Ue=Number(fe.reorder_level||0);ct.warn(`${fe.item_code}: stock ${he}  reorder ${Ue} (${fe.item_name})`);try{Gv({title:"Low Stock",message:`${fe.item_code}: stock ${he}  reorder ${Ue}`,native:Ce,icon:Pe,onClick:()=>y("/inventory/alerts/low-stock")})}catch{}}else{ct.warn(`${Te} items are at or below reorder levels. Check Inventory.`);try{Gv({title:"Low Stock",message:`${Te} items are at or below reorder levels`,native:Ce,icon:Pe,onClick:()=>y("/inventory/alerts/low-stock")})}catch{}}}catch{}}return Le(),Fe(),_e=setInterval(Fe,6e4),()=>{_e&&clearInterval(_e)}},[r==null?void 0:r.companyId,r==null?void 0:r.branchId,q]),f.useEffect(()=>{if(typeof window<"u"&&"Notification"in window&&window.Notification.permission==="default")try{window.Notification.requestPermission().catch(()=>{})}catch{}},[]),f.useEffect(()=>{const _e=Array.isArray(s==null?void 0:s.roles)?s.roles:s!=null&&s.role?[s.role]:[];_e.length&&!_e.includes(B)&&G(_e[0])},[s==null?void 0:s.roles,s==null?void 0:s.role,B]);const se=f.useMemo(()=>Number((s==null?void 0:s.sub)||(s==null?void 0:s.id)),[s==null?void 0:s.sub,s==null?void 0:s.id]),[ae,ne]=f.useState([]),[ue,oe]=f.useState(null),[le,X]=f.useState([]);f.useEffect(()=>{let _e=!0;async function Fe(){var Le,rt;try{if(!Number.isFinite(se))return;const He=await Z.get(`/admin/users/${se}/branches`),st=(He.data&&He.data.data&&Array.isArray(He.data.data.items)?He.data.data.items:Array.isArray((Le=He.data)==null?void 0:Le.items)?He.data.items:[])||[];_e&&(ne(st),!ue&&st.length>0&&oe(Number(st[0].id)))}catch{try{const He=await Z.get("/admin/branches"),st=Array.isArray((rt=He.data)==null?void 0:rt.items)?He.data.items:[],De=Array.isArray(s==null?void 0:s.branchIds)?s.branchIds.map(Number).filter(Ce=>Number.isFinite(Ce)):[],Te=st.filter(Ce=>De.includes(Number(Ce.id)));_e&&(ne(Te),!ue&&Te.length>0&&oe(Number(Te[0].id)))}catch{}}}return Fe(),()=>{_e=!1}},[se,s==null?void 0:s.branchIds,ue]),f.useEffect(()=>{let _e=!0;async function Fe(){var Le;try{const rt=await Z.get("/admin/companies"),He=Array.isArray((Le=rt.data)==null?void 0:Le.items)?rt.data.items:[];_e&&X(He)}catch{}}return Fe(),()=>{_e=!1}},[]);const me=f.useMemo(()=>{const _e=Number((r==null?void 0:r.branchId)??ue),Fe=ae.find(Le=>Number(Le.id)===_e)||(ae.length?ae[0]:null);if(Fe){const Le=Fe.company_name||`Company #${Fe.company_id}`;return`${Fe.name} (${Le})`}return C.branchName},[ae,r==null?void 0:r.branchId,ue,C.branchName]),we=f.useMemo(()=>{const _e=ae.find(Le=>Number(Le.id)===Number(r==null?void 0:r.branchId));if(_e)return _e.company_name||`Company #${_e.company_id}`;if(ae.length===1){const Le=ae[0];return Le.company_name||`Company #${Le.company_id}`}const Fe=le.find(Le=>Number(Le.id)===Number(r==null?void 0:r.companyId));return Fe?Fe.name:(s==null?void 0:s.companyName)||`Company #${(r==null?void 0:r.companyId)??"-"}`},[ae,r==null?void 0:r.branchId,s==null?void 0:s.companyName,r==null?void 0:r.companyId,le]);f.useEffect(()=>{const _e=Array.isArray(O)&&O.length>1||Array.isArray(k)&&k.length>1,Fe=Array.isArray(ae)?ae.length>1:!1;_e&&Fe&&M(!0)},[O,k,ae]);const Ie=f.useMemo(()=>{const _e=j.pathname.replace(/\/+$/,"")||"/";return _e==="/"||_e==="/dashboard"?!0:KC.some(Fe=>Fe.path===_e)},[j.pathname]);return f.useEffect(()=>{typeof window<"u"&&(window.matchMedia("(min-width: 768px)").matches?R(Ie):R(!1))},[j.pathname,Ie]),f.useEffect(()=>{function _e(Fe){Y.current&&(Y.current.contains(Fe.target)||T(!1))}return document.addEventListener("mousedown",_e),()=>document.removeEventListener("mousedown",_e)},[]),f.useEffect(()=>{try{if(u&&typeof(j==null?void 0:j.pathname)=="string"){const _e=j.pathname||"/";u(_e)}}catch{}},[j.pathname,u]),f.useEffect(()=>{let _e=0;const Fe={create:["+","new","create","generate","add"],delete:["delete","deactivate","remove"],edit:["edit","update"],view:["view","open","details","preview"]},Le=he=>String(he||"").toLowerCase().replace(/\s+/g," ").trim(),rt=(he,Ue)=>{if(!he)return!1;if(Ue.includes("+")&&he.includes("+"))return!0;for(const Ye of Ue){if(Ye==="+")continue;if(new RegExp(`\\b${Ye.replace(/[.*+?^${}()|[\\]\\\\]/g,"\\$&")}\\b`,"i").test(he))return!0}return!1},He=()=>{const Ue=(window.location&&window.location.pathname||"/").split("/").filter(Boolean);return Ue.length>=2?`${Ue[0]}:${Ue[1]}`:null},st=()=>{const he=window.location&&window.location.pathname||"/";try{return c(he)}catch{const Ue=he.split("/").filter(Boolean);return Ue.length>=2?`/${Ue[0]}/${Ue[1]}`:Ue.length===1?`/${Ue[0]}`:"/"}},De=()=>{const he=He(),Ue=o||{view:!1,create:!1,edit:!1,delete:!1},Ye=st(),Ke={view:d?d(Ye,"view"):null,create:d?d(Ye,"create"):null,edit:d?d(Ye,"edit"):null,delete:d?d(Ye,"delete"):null};if((Ke.view===null||Ke.create===null||Ke.edit===null||Ke.delete===null)&&u)try{u(Ye)}catch{}const Je=Ee=>typeof Ee=="boolean",xe={view:typeof Ke.view=="boolean"?Ke.view:Je(Ue.view)?Ue.view:he?l(he,"view"):!0,create:typeof Ke.create=="boolean"?Ke.create:Je(Ue.create)?Ue.create:he?l(he,"create"):!0,edit:typeof Ke.edit=="boolean"?Ke.edit:Je(Ue.edit)?Ue.edit:he?l(he,"edit"):!0,delete:typeof Ke.delete=="boolean"?Ke.delete:Je(Ue.delete)?Ue.delete:he?l(he,"delete"):!1},ye=Array.from(document.querySelectorAll('button, a, [role="button"], input[type="button"], input[type="submit"]')),Ae=["aria-label","title","data-label","data-title","data-tooltip","name","alt","value"],be=Ee=>{for(const dt of Ae){const mt=Ee.getAttribute&&Ee.getAttribute(dt);if(mt&&String(mt).trim())return String(mt)}try{const dt=Ee.dataset||{};for(const mt of Object.keys(dt||{})){const it=dt[mt];if(it&&String(it).trim())return String(it)}}catch{}return Ee.textContent||""};for(const Ee of ye){try{if(Ee.getAttribute&&Ee.getAttribute("data-rbac-exempt")===""||Ee.getAttribute&&Ee.getAttribute("data-rbac-exempt")==="true")continue}catch{}const dt=be(Ee),mt=Le(dt);let it=null;try{const ft=Ee.dataset||{},Rt=String(ft.action||ft.permission||ft.permAction||"").toLowerCase().trim();(Rt==="view"||Rt==="create"||Rt==="edit"||Rt==="delete")&&(it=Rt)}catch{}if(rt(mt,Fe.create)?it="create":rt(mt,Fe.delete)?it="delete":rt(mt,Fe.edit)?it="edit":rt(mt,Fe.view)&&(it="view"),!it)continue;xe[it]?(Ee.hidden=!1,Ee.style.display="",Ee.style.pointerEvents="",Ee.style.opacity="",Ee.setAttribute("aria-disabled","false"),"disabled"in Ee&&(Ee.disabled=!1)):(Ee.hidden=!0,Ee.style.pointerEvents="none",Ee.style.opacity="0.6",Ee.setAttribute("aria-disabled","true"),"disabled"in Ee&&(Ee.disabled=!0))}},Te=()=>{cancelAnimationFrame(_e),_e=requestAnimationFrame(De)},Ce=new MutationObserver(()=>Te());Ce.observe(document.body,{childList:!0,subtree:!0}),Te();const Pe=()=>Te(),fe=he=>{try{const Ue=String((he==null?void 0:he.key)||"");(Ue==="rbac_allow_all_view"||Ue==="rbac_allow_all_create"||Ue==="rbac_allow_all_edit"||Ue==="rbac_allow_all_delete")&&Te()}catch{Te()}};return window.addEventListener("rbac:changed",Pe),window.addEventListener("rbac:updated",Pe),window.addEventListener("storage",fe),()=>{cancelAnimationFrame(_e),Ce.disconnect(),window.removeEventListener("rbac:changed",Pe),window.removeEventListener("rbac:updated",Pe),window.removeEventListener("storage",fe)}},[j.pathname,l,o]),e.jsxs("div",{className:"min-h-screen bg-slate-50 text-slate-900 dark:bg-slate-900 dark:text-slate-100 flex flex-col",children:[!W&&e.jsx("button",{type:"button","aria-label":"Open menu",className:"lg:hidden fixed left-3 top-3 z-[90] inline-flex items-center justify-center w-12 h-12 rounded-full shadow-erp bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700",onClick:()=>R(!0),"data-rbac-exempt":"true",children:e.jsx("span",{className:"text-2xl leading-none",children:""})}),e.jsx(cre,{}),e.jsxs("header",{className:"flex justify-between items-center px-6 py-1 border-b border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950 shadow-sm z-50 sticky top-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button","aria-label":"Open menu",onClick:()=>R(_e=>!_e),className:"inline-flex items-center justify-center w-9 h-9 rounded-lg text-slate-500 hover:bg-slate-100 dark:text-slate-400 dark:hover:bg-slate-800 transition-colors",children:e.jsx("span",{className:"text-xl leading-none","aria-hidden":"true",children:""})}),e.jsx(Re,{to:"/",className:"inline-flex items-center","aria-label":"Go to Home",children:e.jsx("img",{src:h==="dark"?mre:Ws,alt:"OmniSuite",className:"h-8 w-auto"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ND,{}),e.jsxs("div",{className:"relative",ref:Y,children:[e.jsxs("button",{type:"button",onClick:()=>T(_e=>!_e),className:"inline-flex items-center gap-2 px-3 py-1 rounded-lg text-slate-700 hover:bg-slate-100 dark:text-slate-200 dark:hover:bg-slate-800 transition-colors",children:[e.jsx("span",{className:"text-sm font-semibold",children:"User Profile"}),e.jsx("span",{"aria-hidden":"true",children:""})]}),U&&e.jsxs("div",{className:"absolute right-0 mt-2 w-80 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 shadow-erp-lg overflow-hidden z-50",children:[e.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700",children:e.jsx("div",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100",children:C.username})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"Company"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100 text-right",children:we})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"Branch"}),e.jsx("div",{className:"text-right",children:ae.length>1?e.jsx("select",{className:"input",value:String((r==null?void 0:r.branchId)||ue||""),onChange:_e=>{const Fe=Number(_e.target.value);oe(Fe),a(Le=>{const rt=ae.find(st=>Number(st.id)===Fe),He=rt?Number(rt.company_id):Le.companyId;return{...Le,companyId:He,branchId:Fe}}),T(!1)},children:ae.map(_e=>e.jsxs("option",{value:_e.id,children:[_e.name," (",_e.company_name||`Company #${_e.company_id}`,")"]},_e.id))}):e.jsx("div",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100",children:me})})]}),e.jsx("div",{className:"pt-1",children:e.jsx("button",{type:"button",onClick:()=>M(!0),className:"btn-primary w-full",disabled:(O.length>1||k.length>1)&&ae.length>1,children:"Switch Context"})}),e.jsx("div",{className:"pt-3 border-t border-slate-200 dark:border-slate-700 flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>{T(!1),n(),y("/login",{replace:!0})},className:"btn-secondary",children:"Logout"})})]})]})]})]})]}),F&&e.jsx("div",{className:"px-6 py-2 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 border-b border-green-300 dark:border-green-800 text-sm",children:"Saved Offline"}),!w&&e.jsx("div",{className:"px-6 py-2 bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 border-b border-yellow-300 dark:border-yellow-800 text-sm",children:"Offline mode enabled. Pages and assets are cached. Actions queue for sync."}),N&&e.jsxs("div",{className:"px-6 py-3 border-b border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950",children:[e.jsxs("div",{className:"text-sm",children:["Pending ",m,"  Failed ",p,"  Completed ",g]}),e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[x.map(_e=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-semibold",children:_e.method.toUpperCase()})," ",e.jsx("span",{className:"text-slate-500",children:_e.url})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:_e.status==="pending"?"badge bg-yellow-100 text-yellow-800 border-yellow-300 dark:bg-yellow-900 dark:text-yellow-200 dark:border-yellow-800":_e.status==="failed"?"badge bg-red-100 text-red-800 border-red-300 dark:bg-red-900 dark:text-red-200 dark:border-red-800":"badge bg-green-100 text-green-800 border-green-300 dark:bg-green-900 dark:text-green-200 dark:border-green-800",children:_e.status})})]},_e.id)),x.length===0&&e.jsx("div",{className:"text-xs text-slate-500",children:"No queued items"})]})})]}),H&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"w-full max-w-md card p-6 shadow-erp-lg bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Switch Role & Branch"}),e.jsx("button",{type:"button",className:"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",onClick:()=>M(!1),"aria-label":"Close",children:""})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Company"}),e.jsx("div",{className:"input",children:we})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Role"}),O.length>1||k.length>1?e.jsx("select",{className:"input w-full",value:B||"",onChange:_e=>G(_e.target.value),disabled:J,children:(O.length?O:k).map(_e=>{const Fe=typeof _e=="string"?_e:_e.name||_e.code,Le=typeof _e=="string"?_e:_e.id;return e.jsx("option",{value:Fe,children:Fe},Le)})}):e.jsx("div",{className:"input",children:B||C.role})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Branch"}),ae.length>1?e.jsx("select",{className:"input w-full",value:String(ue||(r==null?void 0:r.branchId)||""),onChange:_e=>oe(Number(_e.target.value)),children:ae.map(_e=>e.jsxs("option",{value:_e.id,children:[_e.name," (",_e.company_name||`Company #${_e.company_id}`,")"]},_e.id))}):e.jsx("div",{className:"input",children:me})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>M(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"btn-primary",disabled:(O.length>1||k.length>1)&&!B||ae.length>1&&!ue,onClick:()=>{const _e=ae.find(Fe=>Number(Fe.id)===Number(ue||(r==null?void 0:r.branchId)));a(Fe=>({...Fe,companyId:_e?Number(_e.company_id):Fe.companyId,branchId:_e?Number(_e.id):Fe.branchId})),M(!1),T(!1)},children:"Apply"})]})]})}),e.jsxs("div",{className:"flex-1 "+(W?"grid md:grid-cols-[280px_1fr]":"grid grid-cols-1"),children:[W&&e.jsx("button",{type:"button","aria-label":"Close menu",onClick:()=>R(!1),className:"fixed inset-0 z-40 bg-black/40 md:hidden"}),e.jsx("aside",{className:"border-b md:border-b-0 md:border-r border-slate-800 dark:border-slate-800 p-5 md:sticky md:top-[45px] md:h-[calc(100vh-45px)] bg-brand-950 dark:bg-slate-950 shadow-lg overflow-y-auto no-scrollbar z-40 "+(W?"fixed md:static inset-y-0 left-0 w-[280px] top-[45px]":"hidden"),children:e.jsxs("nav",{className:"space-y-1 pb-6",children:[e.jsxs(dw,{to:"/",end:!0,className:({isActive:_e})=>"flex items-center px-3 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 group "+(_e?"bg-brand-800 text-white shadow-lg border-l-4 border-primary-light":"text-brand-200 hover:bg-brand-800 hover:text-white border-l-4 border-transparent"),children:[e.jsx("span",{className:"w-6 text-lg leading-none opacity-80 group-hover:opacity-100 transition-opacity","aria-hidden":"true",children:""}),"Home"]}),KC.filter(_e=>i(_e.key)).map(_e=>e.jsxs(dw,{to:_e.path,className:({isActive:Fe})=>"flex items-center px-3 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 group "+(Fe?"bg-brand-800 text-white shadow-lg border-l-4 border-primary-light":"text-brand-200 hover:bg-brand-800 hover:text-white border-l-4 border-transparent"),children:[e.jsx("span",{className:"w-6 text-lg leading-none opacity-80 group-hover:opacity-100 transition-opacity","aria-hidden":"true",children:_e.icon}),e.jsx("span",{children:_e.label})]},_e.key))]})}),e.jsx("main",{className:"bg-slate-50 dark:bg-slate-900",children:e.jsx("div",{className:"w-full max-w-full lg:max-w-[1200px] mx-auto p-2 md:p-2 lg:p-3",children:e.jsxs(hl,{children:[e.jsx(tt,{path:"/",element:e.jsx(RU,{})}),e.jsx(tt,{path:"/dashboard",element:e.jsx(wD,{})}),e.jsx(tt,{path:"/administration/*",element:e.jsx(nR,{})}),e.jsx(tt,{path:"/sales/*",element:e.jsx(XZ,{})}),e.jsx(tt,{path:"/inventory/*",element:e.jsx($ee,{})}),e.jsx(tt,{path:"/purchase/*",element:e.jsx(ote,{})}),e.jsx(tt,{path:"/finance/*",element:e.jsx(Pte,{})}),e.jsx(tt,{path:"/human-resources/*",element:e.jsx(Jte,{})}),e.jsx(tt,{path:"/maintenance/*",element:e.jsx(nse,{})}),e.jsx(tt,{path:"/project-management/*",element:e.jsx(use,{})}),e.jsx(tt,{path:"/production/*",element:e.jsx(xse,{})}),e.jsx(tt,{path:"/pos/*",element:e.jsx(Hse,{})}),e.jsx(tt,{path:"/business-intelligence/*",element:e.jsx(Gse,{})}),e.jsx(tt,{path:"/service-management/*",element:e.jsx(are,{})}),e.jsx(tt,{path:"/administration/access/dashboard-permissions",element:e.jsx(dre,{})}),e.jsx(tt,{path:"/notifications",element:e.jsx(ire,{})}),e.jsx(tt,{path:"/social-feed",element:e.jsx(WC,{})}),e.jsx(tt,{path:"/social-feed/:id",element:e.jsx(WC,{})}),e.jsx(tt,{path:"/admin/roles",element:e.jsx(lre,{})}),e.jsx(tt,{path:"/admin/user-permissions",element:e.jsx(ore,{})})]})})})]}),e.jsx(fre,{}),e.jsx(bre,{})]})}function jre(){const t="/".replace(/\/+$/,""),s=t.startsWith("/")?t:"/";return e.jsx(tT,{basename:s,future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsx(h6,{store:gD,children:e.jsx(dL,{children:e.jsx(oL,{children:e.jsxs(cL,{children:[e.jsx(gT,{position:"top-right",theme:"dark"}),e.jsx(i5.Notifications,{}),e.jsxs(hl,{children:[e.jsx(tt,{path:"/login",element:e.jsx(YL,{})}),e.jsx(tt,{path:"/forgot-password",element:e.jsx(XL,{})}),e.jsx(tt,{path:"/reset-password",element:e.jsx(JL,{})}),e.jsx(tt,{path:"/select-branch",element:e.jsx(Dw,{children:e.jsx(vD,{})})}),e.jsx(tt,{path:"/*",element:e.jsx(Dw,{children:e.jsx(yre,{})})}),e.jsx(tt,{path:"*",element:e.jsx(dd,{to:"/",replace:!0})})]})]})})})})})}const Nre="/assets/OMNISUITE_ICON_CLEAR-n2Vk6MyQ.png";(function(){try{const s=document.head||document.getElementsByTagName("head")[0];["icon","shortcut icon","apple-touch-icon","apple-touch-icon-precomposed"].forEach(a=>{let n=document.querySelector(`link[rel="${a}"]`);n||(n=document.createElement("link"),n.setAttribute("rel",a),n.setAttribute("type","image/png"),a.startsWith("apple-touch-icon")&&n.setAttribute("sizes","180x180"),s.appendChild(n)),n.setAttribute("href",Nre)})}catch{}})();r3.createRoot(document.getElementById("root")).render(e.jsx(Is.StrictMode,{children:e.jsx(jre,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js")});export{Wr as _,_re as c,jj as g};
